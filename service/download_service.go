package DownloadService

import (
	"encoding/base64"
	"encoding/json"
	"godownloader/http"
	"io/ioutil"
	"log"
	"net/http"
	"strconv"
	"sync"
)

type DJob struct {
	Id         int
	FileName   string
	Size       int64
	Downloaded int64
	Progress   int64
	Speed      int64
}

type NewJob struct {
	Url       string
	PartCount int64
	FilePath  string
}

type DServ struct {
	dls    []*httpclient.Downloader
	oplock sync.Mutex
}

func (srv *DServ) Start(listenPort int) error {
	http.HandleFunc("/", srv.Redirect)
	http.HandleFunc("/progress.json", srv.progressJson)
	http.HandleFunc("/add_task", srv.addTask)
	http.HandleFunc("/remove_task", srv.removeTask)
	http.HandleFunc("/start_task", srv.startTask)
	http.HandleFunc("/stop_task", srv.stopTask)
	http.HandleFunc("/start_all_task", srv.startAllTask)
	http.HandleFunc("/stop_all_task", srv.stopAllTask)
	http.HandleFunc("/index.html", srv.index)
	if err := http.ListenAndServe(":"+strconv.Itoa(listenPort), nil); err != nil {
		return err
	}
	return nil
}

func (srv *DServ) SaveSettings(sf string) error {
	var ss ServiceSettings
	for _, i := range srv.dls {

		ss.Ds = append(ss.Ds, DownloadSettings{
			FI: i.Fi,
			Dp: i.GetProgress(),
		})
	}

	return ss.SaveToFile(sf)
}

func (srv *DServ) LoadSettings(sf string) error {
	ss, err := LoadFromFile(sf)
	if err != nil {
		log.Println("error: when try load settings", err)
		return err
	}
	log.Println(ss)
	for _, r := range ss.Ds {
		dl, err := httpclient.RestoreDownloader(r.FI.Url, r.FI.FileName, r.Dp)
		if err != nil {
			return err
		}
		srv.dls = append(srv.dls, dl)
	}
	return nil
}

const htmlData = "PCFkb2N0eXBlIGh0bWw+Cgo8aHRtbD4KCjxoZWFkPgoJPHRpdGxlPkdPIERPV05MT0FEPC90aXRsZT4KCTxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgiPgoJPHNjcmlwdD4KICAgICAgICAoZnVuY3Rpb24oYSwgcCkgewogICAgICAgICAgICBmdW5jdGlvbiBrKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gYS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgZiA9IHQudHlwZShhKTsKICAgICAgICAgICAgICAgIHJldHVybiB0LmlzV2luZG93KGEpID8gITEgOiAxID09PSBhLm5vZGVUeXBlICYmIGIgPyAhMCA6ICJhcnJheSIgPT09IGYgfHwgImZ1bmN0aW9uIiAhPT0gZiAmJiAoMCA9PT0gYiB8fCAibnVtYmVyIiA9PSB0eXBlb2YgYiAmJiAwIDwgYiAmJiBiIC0gMSBpbiBhKQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBEKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gRGFbYV0gPSB7fTsKICAgICAgICAgICAgICAgIHJldHVybiB0LmVhY2goYS5tYXRjaChpYSkgfHwgW10sIGZ1bmN0aW9uKGEsIGYpIHsKICAgICAgICAgICAgICAgICAgICBiW2ZdID0gITAKICAgICAgICAgICAgICAgIH0pLCBiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHYoKSB7CiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5jYWNoZSA9IHt9LCAwLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZG8gPSB0LmV4cGFuZG8gKyBNYXRoLnJhbmRvbSgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIEYoYSwgYiwgZikgewogICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gcCAmJiAxID09PSBhLm5vZGVUeXBlKQogICAgICAgICAgICAgICAgICAgIGlmIChlID0gImRhdGEtIiArIGIucmVwbGFjZSh0YSwgIi0kMSIpLnRvTG93ZXJDYXNlKCksIGYgPSBhLmdldEF0dHJpYnV0ZShlKSwgInN0cmluZyIgPT0gdHlwZW9mIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cnVlIiA9PT0gZiA/ICEwIDogImZhbHNlIiA9PT0gZiA/ICExIDogIm51bGwiID09PSBmID8gbnVsbCA6ICtmICsgIiIgPT09IGYgPyArZiA6IEthLnRlc3QoZikgPyBKU09OLnBhcnNlKGYpIDogZgogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fQogICAgICAgICAgICAgICAgICAgICAgICBaLnNldChhLCBiLCBmKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBmID0gcDsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIE0oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gSSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBTKCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTi5hY3RpdmVFbGVtZW50CiAgICAgICAgICAgICAgICB9IGNhdGNoIChhKSB7fQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBPKGEsIGIpIHsKICAgICAgICAgICAgICAgIGZvciAoOwogICAgICAgICAgICAgICAgICAgIChhID0gYVtiXSkgJiYgMSAhPT0gYS5ub2RlVHlwZTspOwogICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gUChhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICBpZiAodC5pc0Z1bmN0aW9uKGIpKSByZXR1cm4gdC5ncmVwKGEsIGZ1bmN0aW9uKGEsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFiLmNhbGwoYSwgZSwgYSkgIT09IGYKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKGIubm9kZVR5cGUpIHJldHVybiB0LmdyZXAoYSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBiICE9PSBmCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYikgewogICAgICAgICAgICAgICAgICAgIGlmIChMYS50ZXN0KGIpKSByZXR1cm4gdC5maWx0ZXIoYiwgYSwgZik7CiAgICAgICAgICAgICAgICAgICAgYiA9IHQuZmlsdGVyKGIsCiAgICAgICAgICAgICAgICAgICAgICAgIGEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdC5ncmVwKGEsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA8PSB4YS5jYWxsKGIsIGEpICE9PSBmCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBWKGEsIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0Lm5vZGVOYW1lKGEsICJ0YWJsZSIpICYmIHQubm9kZU5hbWUoMSA9PT0gYi5ub2RlVHlwZSA/IGIgOiBiLmZpcnN0Q2hpbGQsICJ0ciIpID8gYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKVswXSB8fCBhLmFwcGVuZENoaWxkKGEub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpKSA6IGEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gbWEoYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9IChudWxsICE9PSBhLmdldEF0dHJpYnV0ZSgidHlwZSIpKSArICIvIiArIGEudHlwZSwgYQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBmYShhKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IE1hLmV4ZWMoYS50eXBlKTsKICAgICAgICAgICAgICAgIHJldHVybiBiID8gYS50eXBlID0gYlsxXSA6IGEucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksIGEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWEoYSwgYikgewogICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IGEubGVuZ3RoLCBlID0gMDsgZiA+IGU7IGUrKykgVS5zZXQoYVtlXSwgImdsb2JhbEV2YWwiLCAhYiB8fCBVLmdldChiW2VdLCAiZ2xvYmFsRXZhbCIpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBXKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBmLCBlLCBjLCBtLCBoLCBkOwogICAgICAgICAgICAgICAgaWYgKDEgPT09IGIubm9kZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoVS5oYXNEYXRhKGEpICYmIChmID0gVS5hY2Nlc3MoYSksIGUgPSBVLnNldChiLCBmKSwgZCA9IGYuZXZlbnRzKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGRlbGV0ZSBlLmhhbmRsZSwgZS5ldmVudHMgPSB7fSwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDAsIGUgPSBkW2NdLmxlbmd0aDsgZSA+IGY7IGYrKykgdC5ldmVudC5hZGQoYiwgYywgZFtjXVtmXSk7CiAgICAgICAgICAgICAgICAgICAgWi5oYXNEYXRhKGEpICYmIChtID0gWi5hY2Nlc3MoYSksIGggPSB0LmV4dGVuZCh7fSwgbSksIFouc2V0KGIsIGgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBiKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBmID0gYS5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiB8fCAiKiIpIDogYS5xdWVyeVNlbGVjdG9yQWxsID8gYS5xdWVyeVNlbGVjdG9yQWxsKGIgfHwgIioiKSA6IFtdOwogICAgICAgICAgICAgICAgcmV0dXJuIGIgPT09IHAgfHwgYiAmJiB0Lm5vZGVOYW1lKGEsIGIpID8gdC5tZXJnZShbYV0sIGYpIDogZgogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjKGEsIGIpIHsKICAgICAgICAgICAgICAgIGlmIChiIGluIGEpIHJldHVybiBiOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IGIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKwogICAgICAgICAgICAgICAgICAgICAgICBiLnNsaWNlKDEpLCBlID0gYiwgYyA9IGxiLmxlbmd0aDsgYy0tOykKICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IGxiW2NdICsgZiwgYiBpbiBhKSByZXR1cm4gYjsKICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgPSBiIHx8IGEsICJub25lIiA9PT0gdC5jc3MoYSwgImRpc3BsYXkiKSB8fCAhdC5jb250YWlucyhhLm93bmVyRG9jdW1lbnQsIGEpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGcoYSwgYikgewogICAgICAgICAgICAgICAgZm9yICh2YXIgZiwgZSwgYywgbSA9IFtdLCBoID0gMCwgbCA9IGEubGVuZ3RoOyBsID4gaDsgaCsrKSBlID0gYVtoXSwgZS5zdHlsZSAmJiAobVtoXSA9IFUuZ2V0KGUsICJvbGRkaXNwbGF5IiksIGYgPSBlLnN0eWxlLmRpc3BsYXksIGIgPyAobVtoXSB8fCAibm9uZSIgIT09IGYgfHwgKGUuc3R5bGUuZGlzcGxheSA9ICIiKSwgIiIgPT09IGUuc3R5bGUuZGlzcGxheSAmJiBkKGUpICYmIChtW2hdID0gVS5hY2Nlc3MoZSwgIm9sZGRpc3BsYXkiLCB3KGUubm9kZU5hbWUpKSkpIDogbVtoXSB8fCAoYyA9IGQoZSksIChmICYmICJub25lIiAhPT0gZiB8fCAhYykgJiYgVS5zZXQoZSwgIm9sZGRpc3BsYXkiLCBjID8gZiA6IHQuY3NzKGUsICJkaXNwbGF5IikpKSk7CiAgICAgICAgICAgICAgICBmb3IgKGggPSAwOyBsID4gaDsgaCsrKSBlID0gYVtoXSwKICAgICAgICAgICAgICAgICAgICBlLnN0eWxlICYmIChiICYmICJub25lIiAhPT0gZS5zdHlsZS5kaXNwbGF5ICYmICIiICE9PSBlLnN0eWxlLmRpc3BsYXkgfHwgKGUuc3R5bGUuZGlzcGxheSA9IGIgPyBtW2hdIHx8ICIiIDogIm5vbmUiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBmKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoYSA9IHZhLmV4ZWMoYikpID8gTWF0aC5tYXgoMCwgYVsxXSAtIChmIHx8IDApKSArIChhWzJdIHx8ICJweCIpIDogYgogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtKGEsIGIsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgIGIgPSBmID09PSAoZSA/ICJib3JkZXIiIDogImNvbnRlbnQiKSA/IDQgOiAid2lkdGgiID09PSBiID8gMSA6IDA7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBoID0gMDsgNCA+IGI7IGIgKz0gMikgIm1hcmdpbiIgPT09IGYgJiYgKGggKz0gdC5jc3MoYSwgZiArIHlhW2JdLCAhMCwgYykpLCBlID8gKCJjb250ZW50IiA9PT0gZiAmJiAoaCAtPSB0LmNzcyhhLCAicGFkZGluZyIgKyB5YVtiXSwgITAsIGMpKSwgIm1hcmdpbiIgIT09IGYgJiYgKGggLT0gdC5jc3MoYSwgImJvcmRlciIgKyB5YVtiXSArICJXaWR0aCIsICEwLCBjKSkpIDogKGggKz0gdC5jc3MoYSwgInBhZGRpbmciICsgeWFbYl0sICEwLCBjKSwgInBhZGRpbmciICE9PSBmICYmIChoICs9IHQuY3NzKGEsICJib3JkZXIiICsgeWFbYl0gKwogICAgICAgICAgICAgICAgICAgICJXaWR0aCIsICEwLCBjKSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaChiLCBmLCBlKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9ICEwLAogICAgICAgICAgICAgICAgICAgIGMgPSAid2lkdGgiID09PSBmID8gYi5vZmZzZXRXaWR0aCA6IGIub2Zmc2V0SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgIGQgPSBhLmdldENvbXB1dGVkU3R5bGUoYiwgbnVsbCksCiAgICAgICAgICAgICAgICAgICAgdyA9IHQuc3VwcG9ydC5ib3hTaXppbmcgJiYgImJvcmRlci1ib3giID09PSB0LmNzcyhiLCAiYm94U2l6aW5nIiwgITEsIGQpOwogICAgICAgICAgICAgICAgaWYgKDAgPj0gYyB8fCBudWxsID09IGMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IGRhKGIsIGYsIGQpLCAoMCA+IGMgfHwgbnVsbCA9PSBjKSAmJiAoYyA9IGIuc3R5bGVbZl0pLCBOYS50ZXN0KGMpKSByZXR1cm4gYzsKICAgICAgICAgICAgICAgICAgICBoID0gdyAmJiAodC5zdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlIHx8IGMgPT09IGIuc3R5bGVbZl0pOwogICAgICAgICAgICAgICAgICAgIGMgPSBwYXJzZUZsb2F0KGMpIHx8IDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjICsgbShiLCBmLCBlIHx8ICh3ID8gImJvcmRlciIgOiAiY29udGVudCIpLCBoLCBkKSArICJweCIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdyhhKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IE4sCiAgICAgICAgICAgICAgICAgICAgZiA9IFhhW2FdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYgfHwgKGYgPSBsKGEsIGIpLCAibm9uZSIgIT09IGYgJiYgZiB8fCAocWEgPSAocWEgfHwgdCgiPGlmcmFtZSBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9JzAnIGhlaWdodD0nMCcvPiIpLmNzcygiY3NzVGV4dCIsCiAgICAgICAgICAgICAgICAgICAgImRpc3BsYXk6YmxvY2sgIWltcG9ydGFudCIpKS5hcHBlbmRUbyhiLmRvY3VtZW50RWxlbWVudCksIGIgPSAocWFbMF0uY29udGVudFdpbmRvdyB8fCBxYVswXS5jb250ZW50RG9jdW1lbnQpLmRvY3VtZW50LCBiLndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKSwgYi5jbG9zZSgpLCBmID0gbChhLCBiKSwgcWEuZGV0YWNoKCkpLCBYYVthXSA9IGYpLCBmCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGwoYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGYgPSB0KGIuY3JlYXRlRWxlbWVudChhKSkuYXBwZW5kVG8oYi5ib2R5KSwKICAgICAgICAgICAgICAgICAgICBlID0gdC5jc3MoZlswXSwgImRpc3BsYXkiKTsKICAgICAgICAgICAgICAgIHJldHVybiBmLnJlbW92ZSgpLCBlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGUoYSwgYiwgZiwgYykgewogICAgICAgICAgICAgICAgdmFyIGg7CiAgICAgICAgICAgICAgICBpZiAodC5pc0FycmF5KGIpKSB0LmVhY2goYiwgZnVuY3Rpb24oYiwgaCkgewogICAgICAgICAgICAgICAgICAgIGYgfHwgeGIudGVzdChhKSA/IGMoYSwgaCkgOiBlKGEgKyAiWyIgKyAoIm9iamVjdCIgPT0gdHlwZW9mIGggPyBiIDogIiIpICsgIl0iLCBoLCBmLCBjKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChmIHx8ICJvYmplY3QiICE9PSB0LnR5cGUoYikpIGMoYSwgYik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChoIGluIGIpIGUoYSArICJbIiArIGggKyAiXSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJbaF0sIGYsIGMpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG4oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiAhPSB0eXBlb2YgYiAmJiAoZiA9IGIsIGIgPSAiKiIpOwogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGIudG9Mb3dlckNhc2UoKS5tYXRjaChpYSkgfHwgW107CiAgICAgICAgICAgICAgICAgICAgaWYgKHQuaXNGdW5jdGlvbihmKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGUgPSBoW2MrK107KSAiKyIgPT09IGVbMF0gPyAoZSA9IGUuc2xpY2UoMSkgfHwgIioiLCAoYVtlXSA9IGFbZV0gfHwgW10pLnVuc2hpZnQoZikpIDogKGFbZV0gPSBhW2VdIHx8IFtdKS5wdXNoKGYpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIEIoYSwgYiwgZiwgZSkgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhbZF0gPSAhMCwgdC5lYWNoKGFbZF0gfHwgW10sIGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBkKGIsIGYsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIGwgfHwgbSB8fCBoW2xdID8gbSA/ICEodyA9IGwpIDogcCA6IChiLmRhdGFUeXBlcy51bnNoaWZ0KGwpLCBjKGwpLCAhMSkKICAgICAgICAgICAgICAgICAgICB9KSwgdwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGggPSB7fSwKICAgICAgICAgICAgICAgICAgICBtID0gYSA9PT0gYmI7CiAgICAgICAgICAgICAgICByZXR1cm4gYyhiLmRhdGFUeXBlc1swXSkgfHwgIWhbIioiXSAmJiBjKCIqIikKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcihhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgZiwgZSwKICAgICAgICAgICAgICAgICAgICBjID0gdC5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICBmb3IgKGYgaW4gYikgYltmXSAhPT0gcCAmJiAoKGNbZl0gPyBhIDogZSB8fCAoZSA9IHt9KSlbZl0gPSBiW2ZdKTsKICAgICAgICAgICAgICAgIHJldHVybiBlICYmIHQuZXh0ZW5kKCEwLCBhLCBlKSwgYQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBxKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgSWEgPSBwCiAgICAgICAgICAgICAgICB9KSwgSWEgPSB0Lm5vdygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHUoYSwgYiwgZikgewogICAgICAgICAgICAgICAgZm9yICh2YXIgZSwgYyA9IChPYVtiXSB8fCBbXSkuY29uY2F0KE9hWyIqIl0pLCBoID0gMCwgbSA9IGMubGVuZ3RoOyBtID4gaDsgaCsrKQogICAgICAgICAgICAgICAgICAgIGlmIChlID0gY1toXS5jYWxsKGYsIGIsIGEpKSByZXR1cm4gZQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiB6KGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgIHZhciBlLCBjID0gMCwKICAgICAgICAgICAgICAgICAgICBoID0gWWEubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIG0gPSB0LkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZC5lbGVtCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gSWEgfHwgcSgpLCBiID0gTWF0aC5tYXgoMCwgdy5zdGFydFRpbWUgKyB3LmR1cmF0aW9uIC0gYiksIGYgPSAxIC0gKGIgLyB3LmR1cmF0aW9uIHx8IDApLCBjID0gMCwgaCA9IHcudHdlZW5zLmxlbmd0aDsgaCA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjOyBjKyspIHcudHdlZW5zW2NdLnJ1bihmKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0ubm90aWZ5V2l0aChhLCBbdywgZiwgYl0pLCAxID4gZiAmJiBoID8gYiA6IChtLnJlc29sdmVXaXRoKGEsIFt3XSksICExKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdyA9IG0ucHJvbWlzZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW06IGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BzOiB0LmV4dGVuZCh7fSwgYiksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdHM6IHQuZXh0ZW5kKCEwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWFsRWFzaW5nOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9LCBmKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxQcm9wZXJ0aWVzOiBiLAogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE9wdGlvbnM6IGYsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogSWEgfHwgcSgpLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW5zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVHdlZW46IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdC5Ud2VlbihhLCB3Lm9wdHMsIGIsIGYsIHcub3B0cy5zcGVjaWFsRWFzaW5nW2JdIHx8IHcub3B0cy5lYXNpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHcudHdlZW5zLnB1c2goZSksIGUKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiID8gdy50d2VlbnMubGVuZ3RoIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9ICEwOyBjID4gZjsgZisrKSB3LnR3ZWVuc1tmXS5ydW4oMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA/IG0ucmVzb2x2ZVdpdGgoYSwgW3csIGJdKSA6IG0ucmVqZWN0V2l0aChhLCBbdywgYl0pLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGYgPSB3LnByb3BzOwogICAgICAgICAgICAgICAgZm9yICh5KGYsIHcub3B0cy5zcGVjaWFsRWFzaW5nKTsgaCA+IGM7IGMrKykKICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IFlhW2NdLmNhbGwodywgYSwgZiwgdy5vcHRzKSkgcmV0dXJuIGI7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5tYXAoZiwgdSwgdyksIHQuaXNGdW5jdGlvbih3Lm9wdHMuc3RhcnQpICYmIHcub3B0cy5zdGFydC5jYWxsKGEsIHcpLCB0LmZ4LnRpbWVyKHQuZXh0ZW5kKGQsIHsKICAgICAgICAgICAgICAgICAgICBlbGVtOiBhLAogICAgICAgICAgICAgICAgICAgIGFuaW06IHcsCiAgICAgICAgICAgICAgICAgICAgcXVldWU6IHcub3B0cy5xdWV1ZQogICAgICAgICAgICAgICAgfSkpLCB3LnByb2dyZXNzKHcub3B0cy5wcm9ncmVzcykuZG9uZSh3Lm9wdHMuZG9uZSwgdy5vcHRzLmNvbXBsZXRlKS5mYWlsKHcub3B0cy5mYWlsKS5hbHdheXMody5vcHRzLmFsd2F5cykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24geShhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgZiwgZSwgYywgaCwgbTsKICAgICAgICAgICAgICAgIGZvciAoZiBpbiBhKQogICAgICAgICAgICAgICAgICAgIGlmIChlID0gdC5jYW1lbENhc2UoZiksIGMgPSBiW2VdLCBoID0gYVtmXSwgdC5pc0FycmF5KGgpICYmIChjID0gaFsxXSwgaCA9IGFbZl0gPSBoWzBdKSwgZiAhPT0gZSAmJiAoYVtlXSA9IGgsIGRlbGV0ZSBhW2ZdKSwgbSA9IHQuY3NzSG9va3NbZV0sCiAgICAgICAgICAgICAgICAgICAgICAgIG0gJiYgImV4cGFuZCIgaW4gbSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmIGluIGggPSBtLmV4cGFuZChoKSwgZGVsZXRlIGFbZV0sIGgpIGYgaW4gYSB8fCAoYVtmXSA9IGhbZl0sIGJbZl0gPSBjKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGJbZV0gPSBjCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIEsoYSwgYiwgZiwgZSwgYykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBLLnByb3RvdHlwZS5pbml0KGEsIGIsIGYsIGUsIGMpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIEMoYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGYsIGUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGIgPSBiID8gMSA6IDA7IDQgPiBjOyBjICs9IDIgLSBiKSBmID0geWFbY10sIGVbIm1hcmdpbiIgKyBmXSA9IGVbInBhZGRpbmciICsgZl0gPSBhOwogICAgICAgICAgICAgICAgcmV0dXJuIGIgJiYgKGUub3BhY2l0eSA9IGUud2lkdGggPSBhKSwgZQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBUKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0LmlzV2luZG93KGEpID8gYSA6IDkgPT09IGEubm9kZVR5cGUgJiYgYS5kZWZhdWx0VmlldwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBBLCB4LCBIID0gdHlwZW9mIHAsCiAgICAgICAgICAgICAgICBFID0gYS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIE4gPSBhLmRvY3VtZW50LAogICAgICAgICAgICAgICAgTCA9IE4uZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgICAgICAgSiA9IGEualF1ZXJ5LAogICAgICAgICAgICAgICAgRyA9IGEuJCwKICAgICAgICAgICAgICAgIFEgPSB7fSwKICAgICAgICAgICAgICAgIGthID0gW10sCiAgICAgICAgICAgICAgICBSID0ga2EuY29uY2F0LAogICAgICAgICAgICAgICAgRWEgPSBrYS5wdXNoLAogICAgICAgICAgICAgICAgdWEgPSBrYS5zbGljZSwKICAgICAgICAgICAgICAgIHhhID0ga2EuaW5kZXhPZiwKICAgICAgICAgICAgICAgIEFhID0gUS50b1N0cmluZywKICAgICAgICAgICAgICAgIGNiID0gUS5oYXNPd25Qcm9wZXJ0eSwKICAgICAgICAgICAgICAgIFkgPSAiMi4wLjMiLnRyaW0sCiAgICAgICAgICAgICAgICB0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgdC5mbi5pbml0KGEsIGIsIEEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZWEgPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwKICAgICAgICAgICAgICAgIGlhID0gL1xTKy9nLAogICAgICAgICAgICAgICAgZGIgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLAogICAgICAgICAgICAgICAgRmEgPSAvXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT58KSQvLAogICAgICAgICAgICAgICAgeWIgPSAvXi1tcy0vLAogICAgICAgICAgICAgICAgR2EgPSAvLShbXGRhLXpdKS9naSwKICAgICAgICAgICAgICAgIHpiID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIE4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIG5hLCAhMSk7CiAgICAgICAgICAgICAgICAgICAgYS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgbmEsICExKTsKICAgICAgICAgICAgICAgICAgICB0LnJlYWR5KCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZm4gPSB0LnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgICAgIGpxdWVyeTogIjIuMC4zIiwKICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yOiB0LAogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjOwogICAgICAgICAgICAgICAgICAgIGlmICghYSkgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8IiA9PT0gYS5jaGFyQXQoMCkgJiYgIj4iID09PSBhLmNoYXJBdChhLmxlbmd0aCAtIDEpICYmIDMgPD0gYS5sZW5ndGggPyBbbnVsbCwgYSwgbnVsbF0gOiBkYi5leGVjKGEpLCAhZSB8fCAhZVsxXSAmJiBiKSByZXR1cm4gIWIgfHwgYi5qcXVlcnkgPyAoYiB8fCBmKS5maW5kKGEpIDogdGhpcy5jb25zdHJ1Y3RvcihiKS5maW5kKGEpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZVsxXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSBiIGluc3RhbmNlb2YgdCA/IGJbMF0gOiBiLCB0Lm1lcmdlKHRoaXMsIHQucGFyc2VIVE1MKGVbMV0sIGIgJiYgYi5ub2RlVHlwZSA/IGIub3duZXJEb2N1bWVudCB8fCBiIDogTiwgITApKSwgRmEudGVzdChlWzFdKSAmJiB0LmlzUGxhaW5PYmplY3QoYikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlIGluIGIpIHQuaXNGdW5jdGlvbih0aGlzW2VdKSA/IHRoaXNbZV0oYltlXSkgOiB0aGlzLmF0dHIoZSwgYltlXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjID0gTi5nZXRFbGVtZW50QnlJZChlWzJdKSwgYyAmJiBjLnBhcmVudE5vZGUgJiYgKHRoaXMubGVuZ3RoID0gMSwgdGhpc1swXSA9IGMpLCB0aGlzLmNvbnRleHQgPSBOLCB0aGlzLnNlbGVjdG9yID0gYSwgdGhpcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5ub2RlVHlwZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmNvbnRleHQgPSB0aGlzWzBdID0gYSwgdGhpcy5sZW5ndGggPSAxLCB0aGlzKSA6IHQuaXNGdW5jdGlvbihhKSA/IGYucmVhZHkoYSkgOiAoYS5zZWxlY3RvciAhPT0gcCAmJiAodGhpcy5zZWxlY3RvciA9IGEuc2VsZWN0b3IsIHRoaXMuY29udGV4dCA9IGEuY29udGV4dCksIHQubWFrZUFycmF5KGEsIHRoaXMpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAiIiwKICAgICAgICAgICAgICAgIGxlbmd0aDogMCwKICAgICAgICAgICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB1YS5jYWxsKHRoaXMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gYSA/IHRoaXMudG9BcnJheSgpIDogMCA+IGEgPyB0aGlzW3RoaXMubGVuZ3RoICsgYV0gOiB0aGlzW2FdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHVzaFN0YWNrOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IHQubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBhKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5wcmV2T2JqZWN0ID0gdGhpcywgYS5jb250ZXh0ID0gdGhpcy5jb250ZXh0LCBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZWFjaDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVhY2godGhpcywgYSwgYikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWFkeTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnJlYWR5LnByb21pc2UoKS5kb25lKGEpLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2xpY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh1YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpcnN0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lcSgwKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVxKC0xKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVxOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBhID0gK2EgKyAoMCA+IGEgPyBiIDogMCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKDAgPD0gYSAmJiBiID4gYSA/IFt0aGlzW2FdXSA6IFtdKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1hcDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh0Lm1hcCh0aGlzLCBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmNhbGwoYiwgZiwgYikKICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcihudWxsKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHB1c2g6IEVhLAogICAgICAgICAgICAgICAgc29ydDogW10uc29ydCwKICAgICAgICAgICAgICAgIHNwbGljZTogW10uc3BsaWNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZm4uaW5pdC5wcm90b3R5cGUgPSB0LmZuOwogICAgICAgICAgICB0LmV4dGVuZCA9IHQuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgYSwgYiwgZiwgZSwgYywgaCwKICAgICAgICAgICAgICAgICAgICBtID0gYXJndW1lbnRzWzBdIHx8IHt9LAogICAgICAgICAgICAgICAgICAgIGQgPSAxLAogICAgICAgICAgICAgICAgICAgIHcgPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGwgPSAhMTsKICAgICAgICAgICAgICAgICJib29sZWFuIiA9PSB0eXBlb2YgbSAmJiAobCA9IG0sIG0gPSBhcmd1bWVudHNbMV0gfHwge30sIGQgPSAyKTsKICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBtIHx8IHQuaXNGdW5jdGlvbihtKSB8fCAobSA9IHt9KTsKICAgICAgICAgICAgICAgIGZvciAodyA9PT0gZCAmJiAobSA9IHRoaXMsIC0tZCk7IHcgPiBkOyBkKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gKGEgPSBhcmd1bWVudHNbZF0pKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgaW4gYSkgZiA9IG1bYl0sIGUgPSBhW2JdLCBtICE9PSBlICYmIChsICYmIGUgJiYgKHQuaXNQbGFpbk9iamVjdChlKSB8fCAoYyA9IHQuaXNBcnJheShlKSkpID8gKGMgPyAoYyA9ICExLCBoID0gZiAmJiB0LmlzQXJyYXkoZikgPyBmIDogW10pIDogaCA9IGYgJiYgdC5pc1BsYWluT2JqZWN0KGYpID8gZiA6IHt9LCBtW2JdID0gdC5leHRlbmQobCwgaCwgZSkpIDogZSAhPT0gcCAmJiAobVtiXSA9IGUpKTsKICAgICAgICAgICAgICAgIHJldHVybiBtCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGV4cGFuZG86ICJqUXVlcnkiICsgKCIyLjAuMyIgKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCAiIiksCiAgICAgICAgICAgICAgICBub0NvbmZsaWN0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuJCA9PT0gdCAmJiAoYS4kID0KICAgICAgICAgICAgICAgICAgICAgICAgRyksIGIgJiYgYS5qUXVlcnkgPT09IHQgJiYgKGEualF1ZXJ5ID0gSiksIHQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1JlYWR5OiAhMSwKICAgICAgICAgICAgICAgIHJlYWR5V2FpdDogMSwKICAgICAgICAgICAgICAgIGhvbGRSZWFkeTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPyB0LnJlYWR5V2FpdCsrIDogdC5yZWFkeSghMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWFkeTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICghMCA9PT0gYSA/IC0tdC5yZWFkeVdhaXQgOiB0LmlzUmVhZHkpIHx8ICh0LmlzUmVhZHkgPSAhMCwgITAgIT09IGEgJiYgMCA8IC0tdC5yZWFkeVdhaXQgfHwgKHgucmVzb2x2ZVdpdGgoTiwgW3RdKSwgdC5mbi50cmlnZ2VyICYmIHQoTikudHJpZ2dlcigicmVhZHkiKS5vZmYoInJlYWR5IikpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzRnVuY3Rpb246IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdC50eXBlKGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNBcnJheTogQXJyYXkuaXNBcnJheSwKICAgICAgICAgICAgICAgIGlzV2luZG93OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT0gYSAmJiBhID09PSBhLndpbmRvdwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzTnVtZXJpYzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChhKSkgJiYgaXNGaW5pdGUoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0eXBlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gYSA/IGEgKyAiIiA6CiAgICAgICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBhIHx8ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGEgPyBRW0FhLmNhbGwoYSldIHx8ICJvYmplY3QiIDogdHlwZW9mIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1BsYWluT2JqZWN0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJvYmplY3QiICE9PSB0LnR5cGUoYSkgfHwgYS5ub2RlVHlwZSB8fCB0LmlzV2luZG93KGEpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgJiYgIWNiLmNhbGwoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIikpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBiIGluIGEpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGEpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHBhcnNlSFRNTDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIGlmICghYSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgImJvb2xlYW4iID09IHR5cGVvZiBiICYmIChmID0gYiwgYiA9ICExKTsKICAgICAgICAgICAgICAgICAgICBiID0gYiB8fCBOOwogICAgICAgICAgICAgICAgICAgIHZhciBlID0gRmEuZXhlYyhhKTsKICAgICAgICAgICAgICAgICAgICBmID0gIWYgJiYgW107CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPyBbYi5jcmVhdGVFbGVtZW50KGVbMV0pXSA6IChlID0gdC5idWlsZEZyYWdtZW50KFthXSwgYiwgZiksIGYgJiYgdChmKS5yZW1vdmUoKSwgdC5tZXJnZShbXSwgZS5jaGlsZE5vZGVzKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwYXJzZUpTT046IEpTT04ucGFyc2UsCiAgICAgICAgICAgICAgICBwYXJzZVhNTDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBmOwogICAgICAgICAgICAgICAgICAgIGlmICghYSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG5ldyBET01QYXJzZXIsIGIgPSBmLnBhcnNlRnJvbVN0cmluZyhhLCAidGV4dC94bWwiKQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICghYiB8fCBiLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aCkgJiYgdC5lcnJvcigiSW52YWxpZCBYTUw6ICIgKyBhKSwgYgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG5vb3A6IGZ1bmN0aW9uKCkge30sCiAgICAgICAgICAgICAgICBnbG9iYWxFdmFsOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGYgPSBldmFsOwogICAgICAgICAgICAgICAgICAgIChhID0gdC50cmltKGEpKSAmJiAoMSA9PT0gYS5pbmRleE9mKCJ1c2Ugc3RyaWN0IikgPyAoYiA9IE4uY3JlYXRlRWxlbWVudCgic2NyaXB0IiksIGIudGV4dCA9IGEsIE4uaGVhZC5hcHBlbmRDaGlsZChiKS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIGYoYSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2FtZWxDYXNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEucmVwbGFjZSh5YiwgIm1zLSIpLnJlcGxhY2UoR2EsIHpiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG5vZGVOYW1lOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBiLnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlYWNoOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUsIGMgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gYS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBrKGEpOwogICAgICAgICAgICAgICAgICAgIGlmIChmKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBoID4gYyAmJiAoZSA9IGIuYXBwbHkoYVtjXSwgZiksICExICE9PSBlKTsgYysrKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IGIuYXBwbHkoYVtjXSwgZiksICExID09PSBlKSBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBoID4gYyAmJiAoZSA9IGIuY2FsbChhW2NdLCBjLCBhW2NdKSwgITEgIT09IGUpOyBjKyspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IGIuY2FsbChhW2NdLCBjLCBhW2NdKSwgITEgPT09IGUpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdHJpbTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGEgPyAiIiA6IFkuY2FsbChhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1ha2VBcnJheTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0KICAgICAgICAgICAgICAgICAgICAgICAgYiB8fCBbXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBhICYmIChrKE9iamVjdChhKSkgPyB0Lm1lcmdlKGYsICJzdHJpbmciID09IHR5cGVvZiBhID8gW2FdIDogYSkgOiBFYS5jYWxsKGYsIGEpKSwgZgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGluQXJyYXk6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBiID8gLTEgOiB4YS5jYWxsKGIsIGEsIGYpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWVyZ2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGIubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgZikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGYgPiBjOyBjKyspIGFbZSsrXSA9IGJbY107CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYltjXSAhPT0gcDspIGFbZSsrXSA9IGJbYysrXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sZW5ndGggPSBlLCBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ3JlcDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gYS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gISFmOyBtID4gaDsgaCsrKSBlID0gISFiKGFbaF0sIGgpLCBmICE9PSBlICYmIGMucHVzaChhW2hdKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1hcDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYgKGsoYSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBoID4gYzsgYysrKSBlID0gYihhW2NdLCBjLCBmKSwgbnVsbCAhPSBlICYmIChtW20ubGVuZ3RoXSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBhKSBlID0gYihhW2NdLCBjLCBmKSwgbnVsbCAhPSBlICYmIChtW20ubGVuZ3RoXSA9IGUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBSLmFwcGx5KFtdLCBtKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGd1aWQ6IDEsCiAgICAgICAgICAgICAgICBwcm94eTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmLCBlLCBjOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiAoZiA9IGFbYl0sIGIgPSBhLCBhID0gZiksIHQuaXNGdW5jdGlvbihhKSA/IChlID0gdWEuY2FsbChhcmd1bWVudHMsIDIpLCBjID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmFwcGx5KGIgfHwgdGhpcywgZS5jb25jYXQodWEuY2FsbChhcmd1bWVudHMpKSkKICAgICAgICAgICAgICAgICAgICB9LCBjLmd1aWQgPSBhLmd1aWQgPSBhLmd1aWQgfHwgdC5ndWlkKyssIGMpIDogcAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFjY2VzczogZnVuY3Rpb24oYSwgYiwgZiwgZSwgYywgaCwgbSkgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgdyA9IGEubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gbnVsbCA9PSBmOwogICAgICAgICAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PT0gdC50eXBlKGYpKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgaW4gYyA9ICEwLCBmKSB0LmFjY2VzcyhhLCBiLCBkLCBmW2RdLCAhMCwgaCwgbSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZSAhPT0gcCAmJiAoYyA9ICEwLCB0LmlzRnVuY3Rpb24oZSkgfHwgKG0gPSAhMCksIGwgJiYgKG0gPyAoYi5jYWxsKGEsIGUpLCBiID0gbnVsbCkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGwgPSBiLCBiID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsLmNhbGwodChhKSwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSwgYikpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyB3ID4gZDsgZCsrKSBiKGFbZF0sIGYsIG0gPyBlIDogZS5jYWxsKGFbZF0sIGQsIGIoYVtkXSwgZikpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA/IGEgOiBsID8gYi5jYWxsKGEpIDogdyA/IGIoYVswXSwgZikgOiBoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbm93OiBEYXRlLm5vdywKICAgICAgICAgICAgICAgIHN3YXA6IGZ1bmN0aW9uKGEsIGIsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCA9IHt9OwogICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBiKSBoW2NdID0gYS5zdHlsZVtjXSwgYS5zdHlsZVtjXSA9IGJbY107CiAgICAgICAgICAgICAgICAgICAgZiA9IGYuYXBwbHkoYSwgZSB8fCBbXSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGIpIGEuc3R5bGVbY10gPSBoW2NdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geCB8fCAoeCA9IHQuRGVmZXJyZWQoKSwgImNvbXBsZXRlIiA9PT0gTi5yZWFkeVN0YXRlID8gc2V0VGltZW91dCh0LnJlYWR5KSA6IChOLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBuYSwgITEpLCBhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBuYSwgITEpKSksIHgucHJvbWlzZShiKQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgUVsiW29iamVjdCAiICsgYiArICJdIl0gPSBiLnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBBID0gdChOKTsKICAgICAgICAgICAgKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGYoYSwgYiwgZSwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBoLCBtLCBkLCB3LCBsOwogICAgICAgICAgICAgICAgICAgIGlmICgoYiA/IGIub3duZXJEb2N1bWVudCB8fCBiIDogTSkgIT09IEogJiYgY2EoYiksIGIgPSBiIHx8IEosIGUgPSBlIHx8IFtdLCAhYSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgYSkgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKDEgIT09ICh3ID0gYi5ub2RlVHlwZSkgJiYgOSAhPT0gdykgcmV0dXJuIFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChMICYmICFjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoID0gaWEuZXhlYyhhKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gaFsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoOSA9PT0gdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobSA9IGIuZ2V0RWxlbWVudEJ5SWQoZCksICFtIHx8ICFtLnBhcmVudE5vZGUpIHJldHVybiBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobS5pZCA9PT0gZCkgcmV0dXJuIGUucHVzaChtKSwgZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLm93bmVyRG9jdW1lbnQgJiYgKG0gPSBiLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZCkpICYmIHAoYiwgbSkgJiYgbS5pZCA9PT0gZCkgcmV0dXJuIGUucHVzaChtKSwgZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaFsyXSkgcmV0dXJuIFkuYXBwbHkoZSwgYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZCA9IGhbM10pICYmIEsuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHJldHVybiBZLmFwcGx5KGUsIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShkKSksIGUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSy5xc2EgJiYgKCFkYSB8fCAhZGEudGVzdChhKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtID0gaCA9IFEsIGQgPSBiLCBsID0gOSA9PT0gdyAmJiBhLCAxID09PSB3ICYmICJvYmplY3QiICE9PSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gcShhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaCA9IGIuZ2V0QXR0cmlidXRlKCJpZCIpKSA/IG0gPSBoLnJlcGxhY2UodGEsICJcXCQmIik6IGIuc2V0QXR0cmlidXRlKCJpZCIsIG0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSAiW2lkPSciICsgbSArICInXSAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IHcubGVuZ3RoOyBkLS07KSB3W2RdID0gbSArIHIod1tkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IFVhLnRlc3QoYSkgJiYgYi5wYXJlbnROb2RlIHx8IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHcuam9pbigiLCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobCkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWS5hcHBseShlLCBkLnF1ZXJ5U2VsZWN0b3JBbGwobCkpLCBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChuKSB7fSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoIHx8IGIucmVtb3ZlQXR0cmlidXRlKCJpZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGc7CiAgICAgICAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgICAgICAgICBhID0gYS5yZXBsYWNlKHhhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiQxIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnYSwgdTttID0gcShhKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjICYmIDEgPT09IG0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IG1bMF0gPSBtWzBdLnNsaWNlKDApLCAyIDwgZy5sZW5ndGggJiYgIklEIiA9PT0gKGdhID0gZ1swXSkudHlwZSAmJiBLLmdldEJ5SWQgJiYgOSA9PT0gYi5ub2RlVHlwZSAmJiBMICYmIEEucmVsYXRpdmVbZ1sxXS50eXBlXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gKEEuZmluZC5JRChnYS5tYXRjaGVzWzBdLnJlcGxhY2UoWCwgZWEpLCBiKSB8fCBbXSlbMF0sICFiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhLnNsaWNlKGcuc2hpZnQoKS52YWx1ZS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHcgPSBiYS5uZWVkc0NvbnRleHQudGVzdChhKSA/IDAgOiBnLmxlbmd0aDsgdy0tICYmIChnYSA9IGdbd10sICFBLnJlbGF0aXZlW2ggPSBnYS50eXBlXSk7KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodSA9IEEuZmluZFtoXSkgJiYgKGMgPSB1KGdhLm1hdGNoZXNbMF0ucmVwbGFjZShYLCBlYSksIFVhLnRlc3QoZ1swXS50eXBlKSAmJiBiLnBhcmVudE5vZGUgfHwgYikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnLnNwbGljZSh3LCAxKSwgYSA9IGMubGVuZ3RoICYmIHIoZyksICFhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gKFkuYXBwbHkoZSwgYyksIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgYQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPQogICAgICAgICAgICAgICAgICAgICAgICAodihhLCBtKShjLCBiLCAhTCwgZSwgVWEudGVzdChhKSksIGUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBhKGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIucHVzaChmICs9ICIgIikgPiBBLmNhY2hlTGVuZ3RoICYmIGRlbGV0ZSBhW2Iuc2hpZnQoKV0sIGFbZl0gPSBlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBiID0gW107CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVtRXSA9ICEwLCBhCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaChhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBKLmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWEoYikKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIucGFyZW50Tm9kZSAmJiBiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gbShhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IGEuc3BsaXQoInwiKSwgZSA9IGEubGVuZ3RoOyBlLS07KSBBLmF0dHJIYW5kbGVbZltlXV0gPSBiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiICYmIGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBmICYmIDEgPT09IGEubm9kZVR5cGUgJiYgMSA9PT0gYi5ub2RlVHlwZSAmJiAofmIuc291cmNlSW5kZXggfHwgLTIxNDc0ODM2NDgpIC0gKH5hLnNvdXJjZUluZGV4IHx8IC0yMTQ3NDgzNjQ4KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBmID0gZi5uZXh0U2libGluZzspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gYikgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID8gMSA6IC0xCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gdyhhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJpbnB1dCIgPT09IGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiBiLnR5cGUgPT09IGEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gbChhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoImlucHV0IiA9PT0gZiB8fCAiYnV0dG9uIiA9PT0gZikgJiYgYi50eXBlID09PSBhCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG4oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPSArYiwgYyhmdW5jdGlvbihmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjLCBoID0gYShbXSwgZi5sZW5ndGgsIGIpLCBtID0gaC5sZW5ndGg7IG0tLTspIGZbYyA9IGhbbV1dICYmIChmW2NdID0gIShlW2NdID0gZltjXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnKCkge30KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBxKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSwgYywgaCwgbSwgZCwgdywgbDsKICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IGthW2EgKyAiICJdKSByZXR1cm4gYiA/IDAgOiBkLnNsaWNlKDApOwogICAgICAgICAgICAgICAgICAgIGQgPQogICAgICAgICAgICAgICAgICAgICAgICBhOwogICAgICAgICAgICAgICAgICAgIHcgPSBbXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGwgPSBBLnByZUZpbHRlcjsgZDspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZSAmJiAhKGMgPSB5YS5leGVjKGQpKSB8fCAoYyAmJiAoZCA9IGQuc2xpY2UoY1swXS5sZW5ndGgpIHx8IGQpLCB3LnB1c2goaCA9IFtdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgKGMgPSBmYi5leGVjKGQpKSAmJiAoZSA9IGMuc2hpZnQoKSwgaC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogY1swXS5yZXBsYWNlKHhhLCAiICIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkID0gZC5zbGljZShlLmxlbmd0aCkpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKG0gaW4gQS5maWx0ZXIpICEoYyA9IGJhW21dLmV4ZWMoZCkpIHx8IGxbbV0gJiYgIShjID0gbFttXShjKSkgfHwgKGUgPSBjLnNoaWZ0KCksIGgucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBjCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkID0gZC5zbGljZShlLmxlbmd0aCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWUpIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiID8gZC5sZW5ndGggOiBkID8gZi5lcnJvcihhKSA6IGthKGEsIHcpLnNsaWNlKDApCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcihhKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiA9IDAsIGYgPSBhLmxlbmd0aCwgZSA9ICIiOyBmID4gYjsgYisrKSBlICs9IGFbYl0udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB1KGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGIuZGlyLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gZiAmJiAicGFyZW50Tm9kZSIgPT09CiAgICAgICAgICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBEKys7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuZmlyc3QgPyBmdW5jdGlvbihiLCBmLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBiID0gYltlXTspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gYi5ub2RlVHlwZSB8fCBjKSByZXR1cm4gYShiLCBmLCBoKQogICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbihiLCBmLCBtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCB3LCBsLCBuID0gSSArICIgIiArIGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGIgPSBiW2VdOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoMSA9PT0gYi5ub2RlVHlwZSB8fCBjKSAmJiBhKGIsIGYsIG0pKSByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBiID0gYltlXTspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBiLm5vZGVUeXBlIHx8IGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobCA9IGJbUV0gfHwgKGJbUV0gPSB7fSksICh3ID0gbFtlXSkgJiYgd1swXSA9PT0gbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gKGQgPSB3WzFdKSB8fCBkID09PSBIKSByZXR1cm4gITAgPT09IGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodyA9IGxbZV0gPSBbbl0sIHdbMV0gPSBhKGIsIGYsIG0pIHx8IEgsICEwID09PSB3WzFdKSByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gQihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgPCBhLmxlbmd0aCA/IGZ1bmN0aW9uKGIsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IGEubGVuZ3RoOyBjLS07KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhW2NdKGIsIGYsIGUpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgIH0gOiBhWzBdCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24geShhLCBiLCBmLCBlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBbXSwgZCA9IDAsIHcgPSBhLmxlbmd0aCwgbCA9IG51bGwgIT0gYjsgdyA+IGQ7IGQrKykoaCA9IGFbZF0pICYmICghZiB8fCBmKGgsIGUsIGMpKSAmJiAobS5wdXNoKGgpLCBsICYmIGIucHVzaChkKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB4KGEsIGIsIGUsIGgsIG0sIGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaCAmJiAhaFtRXSAmJiAoaCA9IHgoaCkpLCBtICYmICFtW1FdICYmIChtID0geChtLCBkKSksIGMoZnVuY3Rpb24oYywgZCwgdywgbCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiwgZywgZ2EgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBkLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHUgPSBjKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGIgfHwgIioiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgQiA9IHcubm9kZVR5cGUgPyBbd10gOiB3LCB4ID0gW10sIHQgPSAwLCBhYiA9IEIubGVuZ3RoOyBhYiA+IHQ7IHQrKykgZih1LCBCW3RdLCB4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSB4CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICFhIHx8ICFjICYmIGIgPyB1IDogeSh1LCBnYSwgYSwgdywgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBlID8gbSB8fCAoYyA/IGEgOiByIHx8IGgpID8gW10gOiBkIDogdTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgJiYgZSh1LCBCLCB3LCBsKSwgaCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiA9IHkoQiwgcSksIGgobiwgW10sIHcsIGwpLCB3ID0gbi5sZW5ndGg7IHctLTspKGcgPSBuW3ddKSAmJiAoQltxW3ddXSA9ICEodVtxW3ddXSA9IGcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtIHx8IGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodyA9IEIubGVuZ3RoOyB3LS07KShnID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJbd10pICYmIG4ucHVzaCh1W3ddID0gZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0obnVsbCwgQiA9IFtdLCBuLCBsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHcgPSBCLmxlbmd0aDsgdy0tOykoZyA9IEJbd10pICYmIC0xIDwgKG4gPSBtID8gaGEuY2FsbChjLCBnKSA6IGdhW3ddKSAmJiAoY1tuXSA9ICEoZFtuXSA9IGcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgQiA9IHkoQiA9PT0gZCA/IEIuc3BsaWNlKHIsIEIubGVuZ3RoKSA6IEIpLCBtID8gbShudWxsLCBkLCBCLCBsKSA6IFkuYXBwbHkoZCwgQikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHooYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBmLCBlLCBjID0gYS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBBLnJlbGF0aXZlW2FbMF0udHlwZV07CiAgICAgICAgICAgICAgICAgICAgZiA9IGggfHwgQS5yZWxhdGl2ZVsiICJdOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG0gPSBoID8gMSA6IDAsIGQgPSB1KGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGYsICEwKSwgdyA9IHUoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xIDwgaGEuY2FsbChiLCBhKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBmLCAhMCksIGwgPSBbZnVuY3Rpb24oYSwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFoICYmIChlIHx8IGYgIT09IEcpIHx8ICgoYiA9IGYpLm5vZGVUeXBlID8gZChhLCBmLCBlKSA6IHcoYSwgZiwgZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH1dOyBjID4gbTsgbSsrKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9IEEucmVsYXRpdmVbYVttXS50eXBlXSkgbCA9IFt1KEIobCksIGYpXTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9IEEuZmlsdGVyW2FbbV0udHlwZV0uYXBwbHkobnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYVttXS5tYXRjaGVzKSwgZltRXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9ICsrbTsgYyA+IGUgJiYgIUEucmVsYXRpdmVbYVtlXS50eXBlXTsgZSsrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCgxIDwgbSAmJiBCKGwpLCAxIDwgbSAmJiByKGEuc2xpY2UoMCwgbSAtIDEpLmNvbmNhdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAiICIgPT09IGFbbSAtIDJdLnR5cGUgPyAiKiIgOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKS5yZXBsYWNlKHhhLCAiJDEiKSwgZiwgZSA+IG0gJiYgeihhLnNsaWNlKG0sIGUpKSwgYyA+IGUgJiYgeihhID0gYS5zbGljZShlKSksIGMgPiBlICYmIHIoYSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLnB1c2goZikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBCKGwpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gQyhhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gMCA8IGIubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gMCA8IGEubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gZnVuY3Rpb24oYywgZCwgdywgbCwgbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcsIGdhLCBxID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICIwIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gYyAmJiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gbnVsbCAhPSBuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBHLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiID0gYyB8fCBtICYmIEEuZmluZC5UQUcoIioiLCBuICYmIGQucGFyZW50Tm9kZSB8fCBkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gSSArPSBudWxsID09IHQgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAuMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeCAmJiAoRyA9IGQgIT09IEogJiYgZCwgSCA9IGUpOyBudWxsICE9IChuID0gYWJbdV0pOyB1KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobSAmJiBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGdhID0gYVtnKytdOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYShuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLCB3KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwucHVzaChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ICYmIChJID0geiwgSCA9ICsrZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCAmJiAoKG4gPSAhZ2EgJiYgbikgJiYgci0tLCBjICYmIEIucHVzaChuKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyICs9IHUsIGggJiYgdSAhPT0gcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGdhID0gYltnKytdOykgZ2EoQiwgcSwgZCwgdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCByKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IHUtLTspIEJbdV0gfHwgcVt1XSB8fCAocVt1XSA9IE5hLmNhbGwobCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0geShxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZLmFwcGx5KGwsIHEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggJiYgIWMgJiYgMCA8IHEubGVuZ3RoICYmIDEgPCByICsgYi5sZW5ndGggJiYgZi51bmlxdWVTb3J0KGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCAmJiAoSSA9IHosIEcgPSB0KSwgQgogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBoID8gYyhkKSA6IGQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBFLCBLLCBILCBBLCBULCBrLCB2LCBHLCBGLCBjYSwgSiwgTiwgTCwgZGEsIHFhLCBSLCBwLCBRID0gInNpenpsZSIgKyAtbmV3IERhdGUsCiAgICAgICAgICAgICAgICAgICAgTSA9IGEuZG9jdW1lbnQsCiAgICAgICAgICAgICAgICAgICAgSSA9IDAsCiAgICAgICAgICAgICAgICAgICAgRCA9IDAsCiAgICAgICAgICAgICAgICAgICAgUmEgPSBlKCksCiAgICAgICAgICAgICAgICAgICAga2EgPSBlKCksCiAgICAgICAgICAgICAgICAgICAgWmEgPSBlKCksCiAgICAgICAgICAgICAgICAgICAgWiA9ICExLAogICAgICAgICAgICAgICAgICAgIEVhID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IChaID0gITAsIDApIDogMAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgUyA9IHR5cGVvZiBiLAogICAgICAgICAgICAgICAgICAgIFUgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgICAgICAgICAgICAgICAgICB2YSA9IFtdLAogICAgICAgICAgICAgICAgICAgIE5hID0gdmEucG9wLAogICAgICAgICAgICAgICAgICAgIFhhID0gdmEucHVzaCwKICAgICAgICAgICAgICAgICAgICBZID0gdmEucHVzaCwKICAgICAgICAgICAgICAgICAgICBBYSA9CiAgICAgICAgICAgICAgICAgICAgdmEuc2xpY2UsCiAgICAgICAgICAgICAgICAgICAgaGEgPSB2YS5pbmRleE9mIHx8IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiA9IDAsIGYgPSB0aGlzLmxlbmd0aDsgZiA+IGI7IGIrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzW2JdID09PSBhKSByZXR1cm4gYjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBPID0gIig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIi5yZXBsYWNlKCJ3IiwgIncjIiksCiAgICAgICAgICAgICAgICAgICAgU2EgPSAiXFxbW1xceDIwXFx0XFxyXFxuXFxmXSooKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSspW1xceDIwXFx0XFxyXFxuXFxmXSooPzooWypeJHwhfl0/PSlbXFx4MjBcXHRcXHJcXG5cXGZdKig/OihbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCIgKyBPICsgIil8KXwpW1xceDIwXFx0XFxyXFxuXFxmXSpcXF0iLAogICAgICAgICAgICAgICAgICAgIHVhID0gIjooKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSspKD86XFwoKChbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIFNhLnJlcGxhY2UoMywgOCkgKyAiKSopfC4qKVxcKXwpIiwKICAgICAgICAgICAgICAgICAgICB4YSA9IFJlZ0V4cCgiXltcXHgyMFxcdFxcclxcblxcZl0rfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKilbXFx4MjBcXHRcXHJcXG5cXGZdKyQiLAogICAgICAgICAgICAgICAgICAgICAgICAiZyIpLAogICAgICAgICAgICAgICAgICAgIHlhID0gL15bXHgyMFx0XHJcblxmXSosW1x4MjBcdFxyXG5cZl0qLywKICAgICAgICAgICAgICAgICAgICBmYiA9IC9eW1x4MjBcdFxyXG5cZl0qKFs+K35dfFtceDIwXHRcclxuXGZdKVtceDIwXHRcclxuXGZdKi8sCiAgICAgICAgICAgICAgICAgICAgVWEgPSAvW1x4MjBcdFxyXG5cZl0qWyt+XS8sCiAgICAgICAgICAgICAgICAgICAgZ2IgPSBSZWdFeHAoIj1bXFx4MjBcXHRcXHJcXG5cXGZdKihbXlxcXSdcIl0qKVtcXHgyMFxcdFxcclxcblxcZl0qXFxdIiwgImciKSwKICAgICAgICAgICAgICAgICAgICBsYSA9IFJlZ0V4cCh1YSksCiAgICAgICAgICAgICAgICAgICAgaGIgPSBSZWdFeHAoIl4iICsgTyArICIkIiksCiAgICAgICAgICAgICAgICAgICAgYmEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIElEOiAvXiMoKD86XFwufFtcdy1dfFteXHgwMC1ceGEwXSkrKS8sCiAgICAgICAgICAgICAgICAgICAgICAgIENMQVNTOiAvXlwuKCg/OlxcLnxbXHctXXxbXlx4MDAtXHhhMF0pKykvLAogICAgICAgICAgICAgICAgICAgICAgICBUQUc6IFJlZ0V4cCgiXigiICsgIig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIi5yZXBsYWNlKCJ3IiwgIncqIikgKyAiKSIpLAogICAgICAgICAgICAgICAgICAgICAgICBBVFRSOiBSZWdFeHAoIl4iICsgU2EpLAogICAgICAgICAgICAgICAgICAgICAgICBQU0VVRE86IFJlZ0V4cCgiXiIgKyB1YSksCiAgICAgICAgICAgICAgICAgICAgICAgIENISUxEOiAvXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XChbXHgyMFx0XHJcblxmXSooZXZlbnxvZGR8KChbKy1dfCkoXGQqKW58KVtceDIwXHRcclxuXGZdKig/OihbKy1dfClbXHgyMFx0XHJcblxmXSooXGQrKXwpKVtceDIwXHRcclxuXGZdKlwpfCkvaSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9vbDogL14oPzpjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCkkL2ksCiAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRzQ29udGV4dDogL15bXHgyMFx0XHJcblxmXSpbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlwoW1x4MjBcdFxyXG5cZl0qKCg/Oi1cZCk/XGQqKVtceDIwXHRcclxuXGZdKlwpfCkoPz1bXi1dfCQpL2kKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIFRhID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLAogICAgICAgICAgICAgICAgICAgIGlhID0gL14oPzojKFtcdy1dKyl8KFx3Kyl8XC4oW1x3LV0rKSkkLywKICAgICAgICAgICAgICAgICAgICBQID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKICAgICAgICAgICAgICAgICAgICByYSA9IC9eaFxkJC9pLAogICAgICAgICAgICAgICAgICAgIHRhID0gLyd8XFwvZywKICAgICAgICAgICAgICAgICAgICBYID0gUmVnRXhwKCJcXFxcKFtcXGRhLWZdezEsNn1bXFx4MjBcXHRcXHJcXG5cXGZdP3woW1xceDIwXFx0XFxyXFxuXFxmXSl8LikiLCAiaWciKSwKICAgICAgICAgICAgICAgICAgICBlYSA9IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiMHgiICsgYiAtIDY1NTM2OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSAhPT0gYSB8fCBmID8gYiA6IDAgPiBhID8gU3RyaW5nLmZyb21DaGFyQ29kZShhICsgNjU1MzYpIDogU3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NiB8IGEgPj4gMTAsIDU2MzIwIHwgMTAyMyAmIGEpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgWS5hcHBseSh2YSA9IEFhLmNhbGwoTS5jaGlsZE5vZGVzKSwgTS5jaGlsZE5vZGVzKSwgdmFbTS5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGUKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpiKSB7CiAgICAgICAgICAgICAgICAgICAgWSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHk6IHZhLmxlbmd0aCA/IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhhLmFwcGx5KGEsIEFhLmNhbGwoYikpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmID0gYS5sZW5ndGgsIGUgPSAwOyBhW2YrK10gPSBiW2UrK107KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEubGVuZ3RoID0gZiAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGsgPSBmLmlzWE1MID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYSA9IGEgJiYgKGEub3duZXJEb2N1bWVudCB8fCBhKS5kb2N1bWVudEVsZW1lbnQpID8gIkhUTUwiICE9PSBhLm5vZGVOYW1lIDogITEKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBLID0gZi5zdXBwb3J0ID0ge307CiAgICAgICAgICAgICAgICBjYSA9IGYuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBhID8gYS5vd25lckRvY3VtZW50IHx8IGEgOiBNOwogICAgICAgICAgICAgICAgICAgIGEgPQogICAgICAgICAgICAgICAgICAgICAgICBmLmRlZmF1bHRWaWV3OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmICE9PSBKICYmIDkgPT09IGYubm9kZVR5cGUgJiYgZi5kb2N1bWVudEVsZW1lbnQgPyAoSiA9IGYsIE4gPSBmLmRvY3VtZW50RWxlbWVudCwgTCA9ICFrKGYpLCBhICYmIGEuYXR0YWNoRXZlbnQgJiYgYSAhPT0gYS50b3AgJiYgYS5hdHRhY2hFdmVudCgib25iZWZvcmV1bmxvYWQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2EoKQogICAgICAgICAgICAgICAgICAgIH0pLCBLLmF0dHJpYnV0ZXMgPSBoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuY2xhc3NOYW1lID0gImkiLCAhYS5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpCiAgICAgICAgICAgICAgICAgICAgfSksIEsuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuYXBwZW5kQ2hpbGQoZi5jcmVhdGVDb21tZW50KCIiKSksICFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgfSksIEsuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5pbm5lckhUTUwgPSAiPGRpdiBjbGFzcz0nYSc+PC9kaXY+PGRpdiBjbGFzcz0nYSBpJz48L2Rpdj4iLCBhLmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gImkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMiA9PT0gYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJpIikubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgfSksIEsuZ2V0QnlJZCA9IGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTi5hcHBlbmRDaGlsZChhKS5pZCA9IFEsICFmLmdldEVsZW1lbnRzQnlOYW1lIHx8ICFmLmdldEVsZW1lbnRzQnlOYW1lKFEpLmxlbmd0aAogICAgICAgICAgICAgICAgICAgIH0pLCBLLmdldEJ5SWQgPyAoQS5maW5kLklEID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQgIT09IFMgJiYgTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmdldEVsZW1lbnRCeUlkKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYgJiYgZi5wYXJlbnROb2RlID8gW2ZdIDogW10KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIEEuZmlsdGVyLklEID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEucmVwbGFjZShYLCBlYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IGIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pIDogKGRlbGV0ZSBBLmZpbmQuSUQsIEEuZmlsdGVyLklEID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEucmVwbGFjZShYLCBlYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGEgPSB0eXBlb2YgYS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBTICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpKSAmJiBhLnZhbHVlID09PSBiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgQS5maW5kLlRBRyA9IEsuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPyBmdW5jdGlvbihhLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZi5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gUyA/IGYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSkgOiBiCiAgICAgICAgICAgICAgICAgICAgfSA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGUgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiKiIgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBmID0gaFtjKytdOykgMSA9PT0gZi5ub2RlVHlwZSAmJiBlLnB1c2goZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICAgICAgICAgICAgfSwgQS5maW5kLkNMQVNTID0gSy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKGEsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBmLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09IFMgJiYgTCA/IGYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhKSA6IGIKICAgICAgICAgICAgICAgICAgICB9LCBxYSA9IFtdLCBkYSA9IFtdLCAoSy5xc2EgPSBUYS50ZXN0KGYucXVlcnlTZWxlY3RvckFsbCkpICYmIChoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYS5pbm5lckhUTUwgPSAiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aCB8fCBkYS5wdXNoKCJcXFtbXFx4MjBcXHRcXHJcXG5cXGZdKig/OnZhbHVlfGNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkKSIpOwogICAgICAgICAgICAgICAgICAgICAgICBhLnF1ZXJ5U2VsZWN0b3JBbGwoIjpjaGVja2VkIikubGVuZ3RoIHx8IGRhLnB1c2goIjpjaGVja2VkIikKICAgICAgICAgICAgICAgICAgICB9KSwgaChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gZi5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5hcHBlbmRDaGlsZChiKS5zZXRBdHRyaWJ1dGUoInQiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiW3RePScnXSIpLmxlbmd0aCAmJiBkYS5wdXNoKCJbKl4kXT1bXFx4MjBcXHRcXHJcXG5cXGZdKig/OicnfFwiXCIpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiOmVuYWJsZWQiKS5sZW5ndGggfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhLnB1c2goIjplbmFibGVkIiwgIjpkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICBhLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGEucHVzaCgiLC4qOiIpCiAgICAgICAgICAgICAgICAgICAgfSkpLCAoSy5tYXRjaGVzU2VsZWN0b3IgPSBUYS50ZXN0KFIgPSBOLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBOLm1vek1hdGNoZXNTZWxlY3RvciB8fCBOLm9NYXRjaGVzU2VsZWN0b3IgfHwgTi5tc01hdGNoZXNTZWxlY3RvcikpICYmIGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICBLLmRpc2Nvbm5lY3RlZE1hdGNoID0gUi5jYWxsKGEsICJkaXYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgUi5jYWxsKGEsICJbcyE9JyddOngiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcWEucHVzaCgiIT0iLCB1YSkKICAgICAgICAgICAgICAgICAgICB9KSwgZGEgPSBkYS5sZW5ndGggJiYgUmVnRXhwKGRhLmpvaW4oInwiKSksIHFhID0gcWEubGVuZ3RoICYmIFJlZ0V4cChxYS5qb2luKCJ8IikpLCBwID0gVGEudGVzdChOLmNvbnRhaW5zKSB8fCBOLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IDkgPT09IGEubm9kZVR5cGUgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYiAmJiBiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBlIHx8ICEoIWUgfHwgMSAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubm9kZVR5cGUgfHwgIShmLmNvbnRhaW5zID8gZi5jb250YWlucyhlKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgMTYgJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGUpKSkKICAgICAgICAgICAgICAgICAgICB9IDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBiID0gYi5wYXJlbnROb2RlOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PT0gYSkgcmV0dXJuICEwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICB9LCBFYSA9IE4uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhID09PSBiKSByZXR1cm4gWiA9ICEwLCAwOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA/IDEgJiBlIHx8ICFLLnNvcnREZXRhY2hlZCAmJiBiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGEpID09PSBlID8gYSA9PT0gZiB8fCBwKE0sIGEpID8gLTEgOiBiID09PSBmIHx8IHAoTSwgYikgPyAxIDogRiA/IGhhLmNhbGwoRiwgYSkgLSBoYS5jYWxsKEYsIGIpIDogMCA6IDQgJiBlID8gLTEgOiAxIDogYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/IC0xIDogMQogICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbihhLAogICAgICAgICAgICAgICAgICAgICAgICBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBjID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBiLnBhcmVudE5vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gW2FdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IFtiXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgPT09IGIpIHJldHVybiBaID0gITAsIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZSB8fCAhaCkgcmV0dXJuIGEgPT09IGYgPyAtMSA6IGIgPT09IGYgPyAxIDogZSA/IC0xIDogaCA/IDEgOiBGID8gaGEuY2FsbChGLCBhKSAtIGhhLmNhbGwoRiwgYikgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9PT0gaCkgcmV0dXJuIGQoYSwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IGE7IGUgPSBlLnBhcmVudE5vZGU7KSBtLnVuc2hpZnQoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IGI7IGUgPSBlLnBhcmVudE5vZGU7KSB3LnVuc2hpZnQoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBtW2NdID09PSB3W2NdOykgYysrOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA/IGQobVtjXSwgd1tjXSkgOiBtW2NdID09PSBNID8gLTEgOiB3W2NdID09PSBNID8gMSA6IDAKICAgICAgICAgICAgICAgICAgICB9LCBmKSA6IEoKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmLm1hdGNoZXMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYoYSwgbnVsbCwgbnVsbCwgYikKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGEub3duZXJEb2N1bWVudCB8fCBhKSAhPT0gSiAmJiBjYShhKSwgYiA9IGIucmVwbGFjZShnYiwgIj0nJDEnXSIpLCAhKCFLLm1hdGNoZXNTZWxlY3RvciB8fCAhTCB8fCBxYSAmJiBxYS50ZXN0KGIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYSAmJiBkYS50ZXN0KGIpKSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBSLmNhbGwoYSwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlIHx8IEsuZGlzY29ubmVjdGVkTWF0Y2ggfHwgYS5kb2N1bWVudCAmJiAxMSAhPT0gYS5kb2N1bWVudC5ub2RlVHlwZSkgcmV0dXJuIGUKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgZihiLCBKLCBudWxsLCBbYV0pLmxlbmd0aAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGYuY29udGFpbnMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhLm93bmVyRG9jdW1lbnQgfHwgYSkgIT09IEogJiYgY2EoYSksIHAoYSwgYikKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmLmF0dHIgPSBmdW5jdGlvbihhLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgKGEub3duZXJEb2N1bWVudCB8fCBhKSAhPT0gSiAmJiBjYShhKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IEEuYXR0ckhhbmRsZVtmLnRvTG93ZXJDYXNlKCldLAogICAgICAgICAgICAgICAgICAgICAgICBlID0gZSAmJiBVLmNhbGwoQS5hdHRySGFuZGxlLCBmLnRvTG93ZXJDYXNlKCkpID8gZShhLCBmLCAhTCkgOiBiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBlID09PSBiID8gSy5hdHRyaWJ1dGVzIHx8ICFMID8gYS5nZXRBdHRyaWJ1dGUoZikgOiAoZSA9IGEuZ2V0QXR0cmlidXRlTm9kZShmKSkgJiYgZS5zcGVjaWZpZWQgPyBlLnZhbHVlIDogbnVsbCA6IGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmLmVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgYSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZi51bmlxdWVTb3J0ID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBmID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoWiA9ICFLLmRldGVjdER1cGxpY2F0ZXMsIEYgPSAhSy5zb3J0U3RhYmxlICYmIGEuc2xpY2UoMCksIGEuc29ydChFYSksIFopIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGIgPSBhW2MrK107KSBiID09PSBhW2NdICYmIChlID0gZi5wdXNoKGMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGUtLTspIGEuc3BsaWNlKGZbZV0sIDEpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgVCA9IGYuZ2V0VGV4dCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBlID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IGEubm9kZVR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBiIHx8IDkgPT09IGIgfHwgMTEgPT09IGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYS50ZXh0Q29udGVudCkgcmV0dXJuIGEudGV4dENvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGEgPSBhLmZpcnN0Q2hpbGQ7IGE7IGEgPSBhLm5leHRTaWJsaW5nKSBmICs9IFQoYSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgzID09PSBiIHx8IDQgPT09IGIpIHJldHVybiBhLm5vZGVWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGIgPSBhW2VdOyBlKyspIGYgKz0gVChiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIEEgPSBmLnNlbGVjdG9ycyA9IHsKICAgICAgICAgICAgICAgICAgICBjYWNoZUxlbmd0aDogNTAsCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUHNldWRvOiBjLAogICAgICAgICAgICAgICAgICAgIG1hdGNoOiBiYSwKICAgICAgICAgICAgICAgICAgICBhdHRySGFuZGxlOiB7fSwKICAgICAgICAgICAgICAgICAgICBmaW5kOiB7fSwKICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZTogewogICAgICAgICAgICAgICAgICAgICAgICAiPiI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogInBhcmVudE5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q6ICEwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICIgIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyOiAicGFyZW50Tm9kZSIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgIisiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXI6ICJwcmV2aW91c1NpYmxpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q6ICEwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ+IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyOiAicHJldmlvdXNTaWJsaW5nIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwcmVGaWx0ZXI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgQVRUUjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbMV0gPSBhWzFdLnJlcGxhY2UoWCwgZWEpLCBhWzNdID0gKGFbNF0gfHwgYVs1XSB8fCAiIikucmVwbGFjZShYLCBlYSksICJ+PSIgPT09IGFbMl0gJiYgKGFbM10gPSAiICIgKyBhWzNdICsgIiAiKSwgYS5zbGljZSgwLCA0KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBDSElMRDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbMV0gPSBhWzFdLnRvTG93ZXJDYXNlKCksICJudGgiID09PSBhWzFdLnNsaWNlKDAsIDMpID8gKGFbM10gfHwgZi5lcnJvcihhWzBdKSwgYVs0XSA9ICsoYVs0XSA/IGFbNV0gKyAoYVs2XSB8fCAxKSA6IDIgKiAoImV2ZW4iID09PSBhWzNdIHx8ICJvZGQiID09PSBhWzNdKSksIGFbNV0gPSArKGFbN10gKyBhWzhdIHx8ICJvZGQiID09PSBhWzNdKSkgOiBhWzNdICYmIGYuZXJyb3IoYVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBQU0VVRE86IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBlID0gIWFbNV0gJiYgYVsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiYS5DSElMRC50ZXN0KGFbMF0pID8gbnVsbCA6IChhWzNdICYmIGFbNF0gIT09IGIgPyBhWzJdID0gYVs0XSA6IGUgJiYgbGEudGVzdChlKSAmJiAoZiA9IHEoZSwgITApKSAmJiAoZiA9IGUuaW5kZXhPZigiKSIsIGUubGVuZ3RoIC0gZikgLSBlLmxlbmd0aCkgJiYgKGFbMF0gPSBhWzBdLnNsaWNlKDAsIGYpLCBhWzJdID0gZS5zbGljZSgwLCBmKSksIGEuc2xpY2UoMCwgMykpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogewogICAgICAgICAgICAgICAgICAgICAgICBUQUc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5yZXBsYWNlKFgsIGVhKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIqIiA9PT0gYSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgQ0xBU1M6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gUmFbYSArICIgIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiB8fCAoYiA9IFJlZ0V4cCgiKF58W1xceDIwXFx0XFxyXFxuXFxmXSkiICsgYSArICIoW1xceDIwXFx0XFxyXFxuXFxmXXwkKSIpKSAmJiBSYShhLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIudGVzdCgic3RyaW5nIiA9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgYS5jbGFzc05hbWUgJiYgYS5jbGFzc05hbWUgfHwgdHlwZW9mIGEuZ2V0QXR0cmlidXRlICE9PSBTICYmIGEuZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgQVRUUjogZnVuY3Rpb24oYSwgYiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZi5hdHRyKGMsIGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGMgPyAiIT0iID09PSBiIDogYiA/IChjICs9ICIiLCAiPSIgPT09IGIgPyBjID09PSBlIDogIiE9IiA9PT0gYiA/IGMgIT09IGUgOiAiXj0iID09PSBiID8gZSAmJiAwID09PSBjLmluZGV4T2YoZSkgOiAiKj0iID09PSBiID8gZSAmJiAtMSA8IGMuaW5kZXhPZihlKSA6ICIkPSIgPT09IGIgPyBlICYmIGMuc2xpY2UoLWUubGVuZ3RoKSA9PT0gZSA6ICJ+PSIgPT09IGIgPyAtMSA8ICgiICIgKyBjICsgIiAiKS5pbmRleE9mKGUpIDogInw9IiA9PT0gYiA/IGMgPT09IGUgfHwgYy5zbGljZSgwLCBlLmxlbmd0aCArIDEpID09PSBlICsgIi0iIDogITEpIDogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgQ0hJTEQ6IGZ1bmN0aW9uKGEsIGIsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gIm50aCIgIT09IGEuc2xpY2UoMCwgMyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICJsYXN0IiAhPT0gYS5zbGljZSgtNCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9ICJvZi10eXBlIiA9PT0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxID09PSBlICYmIDAgPT09IGMgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhYS5wYXJlbnROb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGZ1bmN0aW9uKGIsIGYsIHcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwsIG4sIGcsIGdhLCBxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gaCAhPT0gbSA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBiLnBhcmVudE5vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gZCAmJiBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSAhdyAmJiAhZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGY7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiA9IGI7IG4gPSBuW2ZdOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID8gbi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSB1IDogMSA9PT0gbi5ub2RlVHlwZSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gZiA9ICJvbmx5IiA9PT0gYSAmJiAhcSAmJiAibmV4dFNpYmxpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHEgPSBbbSA/IHIuZmlyc3RDaGlsZCA6IHIubGFzdENoaWxkXSwgbSAmJiB3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodyA9IHJbUV0gfHwgKHJbUV0gPSB7fSksIGwgPSB3W2FdIHx8IFtdLCBnYSA9IGxbMF0gPT09IEkgJiYgbFsxXSwgZyA9IGxbMF0gPT09IEkgJiYgbFsyXSwgbiA9IGdhICYmIHIuY2hpbGROb2Rlc1tnYV07IG4gPSArK2dhICYmIG4gJiYgbltmXSB8fCAoZyA9IGdhID0gMCkgfHwgcS5wb3AoKTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IG4ubm9kZVR5cGUgJiYgKytnICYmIG4gPT09IGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdbYV0gPSBbSSwgZ2EsIGddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodyAmJiAobCA9IChiW1FdIHx8IChiW1FdID0ge30pKVthXSkgJiYgbFswXSA9PT0gSSkgZyA9IGxbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuID0gKytnYSAmJiBuICYmIG5bZl0gfHwgKGcgPSBnYSA9IDApIHx8IHEucG9wKCkpICYmICgoZCA/IG4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gdSA6IDEgIT09IG4ubm9kZVR5cGUpIHx8ICErK2cgfHwgKHcgJiYgKChuW1FdIHx8IChuW1FdID0ge30pKVthXSA9IFtJLCBnXSksIG4gIT09IGIpKTspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcgLT0gYywgZyA9PT0gZSB8fCAwID09PSBnICUgZSAmJiAwIDw9IGcgLyBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFBTRVVETzogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIGggPSBBLnBzZXVkb3NbYV0gfHwgQS5zZXRGaWx0ZXJzW2EudG9Mb3dlckNhc2UoKV0gfHwgZi5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaFtRXSA/IGgoYikgOiAxIDwgaC5sZW5ndGggPyAoZSA9IFthLCBhLCAiIiwgYl0sIEEuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShhLnRvTG93ZXJDYXNlKCkpID8gYyhmdW5jdGlvbihhLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZSwgYyA9IGgoYSwgYiksIG0gPSBjLmxlbmd0aDsgbS0tOykgZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhLmNhbGwoYSwgY1ttXSksIGFbZV0gPSAhKGZbZV0gPSBjW21dKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGgoYSwgMCwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogaAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwc2V1ZG9zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdDogYyhmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gdihhLnJlcGxhY2UoeGEsICIkMSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlW1FdID8gYyhmdW5jdGlvbihhLCBiLCBmLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGUoYSwgbnVsbCwgYywgW10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IGEubGVuZ3RoOyBjLS07KShoID0gZltjXSkgJiYgKGFbY10gPSAhKGJbY10gPSBoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogZnVuY3Rpb24oYSwgYywgaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiWzBdID0gYSwgZShiLCBudWxsLCBoLCBmKSwgIWYucG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGhhczogYyhmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgZihhLCBiKS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBjKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xIDwgKGIudGV4dENvbnRlbnQgfHwgYi5pbm5lclRleHQgfHwgVChiKSkuaW5kZXhPZihhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFuZzogYyhmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGIudGVzdChhIHx8ICIiKSB8fCBmLmVycm9yKCJ1bnN1cHBvcnRlZCBsYW5nOiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSksIGEgPSBhLnJlcGxhY2UoWCwgZWEpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmID0gTCA/IGIubGFuZyA6IGIuZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpIHx8IGIuZ2V0QXR0cmlidXRlKCJsYW5nIikpIHJldHVybiBmID0gZi50b0xvd2VyQ2FzZSgpLCBmID09PSBhIHx8IDAgPT09IGYuaW5kZXhPZihhICsgIi0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChiID0gYi5wYXJlbnROb2RlKSAmJiAxID09PSBiLm5vZGVUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGEubG9jYXRpb24gJiYgYS5sb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYgJiYgZi5zbGljZSgxKSA9PT0gYi5pZAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICByb290OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gTgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmb2N1czogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPT09IEouYWN0aXZlRWxlbWVudCAmJiAoIUouaGFzRm9jdXMgfHwgSi5oYXNGb2N1cygpKSAmJiAhIShhLnR5cGUgfHwgYS5ocmVmIHx8IH5hLnRhYkluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEgPT09IGEuZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMCA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJpbnB1dCIgPT09IGIgJiYgISFhLmNoZWNrZWQgfHwgIm9wdGlvbiIgPT09IGIgJiYgISFhLnNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4LCAhMCA9PT0gYS5zZWxlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChhID0gYS5maXJzdENoaWxkOyBhOyBhID0gYS5uZXh0U2libGluZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIkAiIDwgYS5ub2RlTmFtZSB8fCAzID09PSBhLm5vZGVUeXBlIHx8IDQgPT09IGEubm9kZVR5cGUpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhQS5wc2V1ZG9zLmVtcHR5KGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJhLnRlc3QoYS5ub2RlTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQLnRlc3QoYS5ub2RlTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiaW5wdXQiID09PSBiICYmICJidXR0b24iID09PSBhLnR5cGUgfHwgImJ1dHRvbiIgPT09IGIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gImlucHV0IiA9PT0gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmICJ0ZXh0IiA9PT0gYS50eXBlICYmIChudWxsID09IChiID0gYS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgfHwgYi50b0xvd2VyQ2FzZSgpID09PSBhLnR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0OiBuKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFswXQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdDogbihmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2IgLSAxXQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZXE6IG4oZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFswID4gZiA/IGYgKyBiIDogZl0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW46IG4oZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IDA7IGIgPiBmOyBmICs9IDIpIGEucHVzaChmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICBvZGQ6IG4oZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IDE7IGIgPiBmOyBmICs9IDIpIGEucHVzaChmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICBsdDogbihmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwID4gZiA/IGYgKyBiIDogZjsgMCA8PSAtLWI7KSBhLnB1c2goYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZ3Q6IG4oZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDAgPiBmID8gZiArIGIgOiBmOyBiID4gKytmOykgYS5wdXNoKGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgQS5wc2V1ZG9zLm50aCA9IEEucHNldWRvcy5lcTsKICAgICAgICAgICAgICAgIGZvciAoRSBpbiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3g6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogITAKICAgICAgICAgICAgICAgICAgICB9KSBBLnBzZXVkb3NbRV0gPSB3KEUpOwogICAgICAgICAgICAgICAgZm9yIChFIGluIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0OiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXQ6ICEwCiAgICAgICAgICAgICAgICAgICAgfSkgQS5wc2V1ZG9zW0VdID0gbChFKTsKICAgICAgICAgICAgICAgIGcucHJvdG90eXBlID0gQS5maWx0ZXJzID0gQS5wc2V1ZG9zOwogICAgICAgICAgICAgICAgQS5zZXRGaWx0ZXJzID0gbmV3IGc7CiAgICAgICAgICAgICAgICB2ID0gZi5jb21waWxlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmLCBlID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IFphW2EgKyAiICJdOwogICAgICAgICAgICAgICAgICAgIGlmICghaCkgewogICAgICAgICAgICAgICAgICAgICAgICBiIHx8IChiID0gcShhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IGIubGVuZ3RoOyBmLS07KSBoID0geihiW2ZdKSwgaFtRXSA/IGUucHVzaChoKSA6IGMucHVzaChoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IFphKGEsIEMoYywgZSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgSy5zb3J0U3RhYmxlID0gUS5zcGxpdCgiIikuc29ydChFYSkuam9pbigiIikgPT09IFE7CiAgICAgICAgICAgICAgICBLLmRldGVjdER1cGxpY2F0ZXMgPSBaOwogICAgICAgICAgICAgICAgY2EoKTsKICAgICAgICAgICAgICAgIEsuc29ydERldGFjaGVkID0gaChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgJgogICAgICAgICAgICAgICAgICAgICAgICBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKEouY3JlYXRlRWxlbWVudCgiZGl2IikpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlubmVySFRNTCA9ICI8YSBocmVmPScjJz48L2E+IiwgIiMiID09PSBhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikKICAgICAgICAgICAgICAgIH0pIHx8IG0oInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbihhLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPyBiIDogYS5nZXRBdHRyaWJ1dGUoZiwgInR5cGUiID09PSBmLnRvTG93ZXJDYXNlKCkgPyAxIDogMikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgSy5hdHRyaWJ1dGVzICYmIGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlubmVySFRNTCA9ICI8aW5wdXQvPiIsIGEuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgIiIpLCAiIiA9PT0gYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgidmFsdWUiKQogICAgICAgICAgICAgICAgfSkgfHwgbSgidmFsdWUiLCBmdW5jdGlvbihhLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgfHwgImlucHV0IiAhPT0gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID8gYiA6IGEuZGVmYXVsdFZhbHVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGgoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpCiAgICAgICAgICAgICAgICB9KSB8fCBtKCJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsIGZ1bmN0aW9uKGEsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA/IGIgOiAoYyA9IGEuZ2V0QXR0cmlidXRlTm9kZShmKSkgJiYgYy5zcGVjaWZpZWQgPyBjLnZhbHVlIDogITAgPT09IGFbZl0gPyBmLnRvTG93ZXJDYXNlKCkgOiBudWxsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHQuZmluZCA9IGY7CiAgICAgICAgICAgICAgICB0LmV4cHIgPSBmLnNlbGVjdG9yczsKICAgICAgICAgICAgICAgIHQuZXhwclsiOiJdID0gdC5leHByLnBzZXVkb3M7CiAgICAgICAgICAgICAgICB0LnVuaXF1ZSA9IGYudW5pcXVlU29ydDsKICAgICAgICAgICAgICAgIHQudGV4dCA9IGYuZ2V0VGV4dDsKICAgICAgICAgICAgICAgIHQuaXNYTUxEb2MgPSBmLmlzWE1MOwogICAgICAgICAgICAgICAgdC5jb250YWlucyA9IGYuY29udGFpbnMKICAgICAgICAgICAgfSkoYSk7CiAgICAgICAgICAgIHZhciBEYSA9IHt9OwogICAgICAgICAgICB0LkNhbGxiYWNrcyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIGEgPSAic3RyaW5nIiA9PSB0eXBlb2YgYSA/IERhW2FdIHx8IEQoYSkgOiB0LmV4dGVuZCh7fSwgYSk7CiAgICAgICAgICAgICAgICB2YXIgYiwgZiwgZSwKICAgICAgICAgICAgICAgICAgICBjLCBoLCBtLCBkID0gW10sCiAgICAgICAgICAgICAgICAgICAgdyA9ICFhLm9uY2UgJiYgW10sCiAgICAgICAgICAgICAgICAgICAgbCA9IGZ1bmN0aW9uKGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEubWVtb3J5ICYmIGc7CiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGMgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBkLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlID0gITA7IGQgJiYgaCA+IG07IG0rKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMSA9PT0gZFttXS5hcHBseShnWzBdLCBnWzFdKSAmJiBhLnN0b3BPbkZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiAodyA/IHcubGVuZ3RoICYmIGwody5zaGlmdCgpKSA6IGIgPyBkID0gW10gOiBuLmRpc2FibGUoKSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG4gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uIEFiKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5lYWNoKGIsIGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdC50eXBlKGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gZSA/IGEudW5pcXVlICYmIG4uaGFzKGYpIHx8IGQucHVzaChmKSA6IGYgJiYgZi5sZW5ndGggJiYgInN0cmluZyIgIT09IGUgJiYgQWIoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KShhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPyBoID0gZC5sZW5ndGggOiBiICYmIChjID0gZiwgbChiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCAmJiB0LmVhY2goYXJndW1lbnRzLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZjsgLSAxIDwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGYgPSB0LmluQXJyYXkoYiwgZCwgZikpOykgZC5zcGxpY2UoZiwgMSksIGUgJiYgKGggPj0gZiAmJiBoLS0sIG0gPj0gZiAmJiBtLS0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBoYXM6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID8gLTEgPCB0LmluQXJyYXkoYSwgZCkgOiAhKCFkIHx8ICFkLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZW1wdHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPSBbXSwgaCA9IDAsIHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCA9IHcgPSBiID0gcCwgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWQKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jazogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdyA9IHAsIGIgfHwgbi5kaXNhYmxlKCksIHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9ja2VkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhdwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmaXJlV2l0aDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFkIHx8IGYgJiYgIXcgfHwgKGIgPSBiIHx8IFtdLCBiID0gW2EsIGIuc2xpY2UgPyBiLnNsaWNlKCkgOiBiXSwgZSA/IHcucHVzaChiKSA6IGwoYikpLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uZmlyZVdpdGgodGhpcywgYXJndW1lbnRzKSwgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmaXJlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFmCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5leHRlbmQoewogICAgICAgICAgICAgICAgRGVmZXJyZWQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsicmVzb2x2ZSIsICJkb25lIiwgdC5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZXNvbHZlZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgWyJyZWplY3QiLCAiZmFpbCIsIHQuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVqZWN0ZWQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsibm90aWZ5IiwgInByb2dyZXNzIiwgdC5DYWxsYmFja3MoIm1lbW9yeSIpXQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gInBlbmRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICBlID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx3YXlzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuRGVmZXJyZWQoZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmVhY2goYiwgZnVuY3Rpb24oYiwgaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBoWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0LmlzRnVuY3Rpb24oYVtiXSkgJiYgYVtiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbaFsxXV0oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBkICYmIGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICYmIHQuaXNGdW5jdGlvbihhLnByb21pc2UpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5wcm9taXNlKCkuZG9uZShmLnJlc29sdmUpLmZhaWwoZi5yZWplY3QpLnByb2dyZXNzKGYubm90aWZ5KSA6IGZbbSArICJXaXRoIl0odGhpcyA9PT0gZSA/IGYucHJvbWlzZSgpIDogdGhpcywgZCA/IFthXSA6IGFyZ3VtZW50cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnByb21pc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBhID8gdC5leHRlbmQoYSwgZSkgOiBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5waXBlID0gZS50aGVuLCB0LmVhY2goYiwgZnVuY3Rpb24oYSwgaCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gaFszXTsKICAgICAgICAgICAgICAgICAgICAgICAgZVtoWzFdXSA9IG0uYWRkOwogICAgICAgICAgICAgICAgICAgICAgICBkICYmIG0uYWRkKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGQKICAgICAgICAgICAgICAgICAgICAgICAgfSwgYlsxIF4gYV1bMl0uZGlzYWJsZSwgYlsyXVsyXS5sb2NrKTsKICAgICAgICAgICAgICAgICAgICAgICAgY1toWzBdXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNbaFswXSArICJXaXRoIl0odGhpcyA9PT0gYyA/IGUgOiB0aGlzLCBhcmd1bWVudHMpLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGNbaFswXSArICJXaXRoIl0gPSBtLmZpcmVXaXRoCiAgICAgICAgICAgICAgICAgICAgfSksIGUucHJvbWlzZShjKSwgYSAmJiBhLmNhbGwoYywgYyksIGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3aGVuOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gdWEuY2FsbChhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICAgICAgICBlID0gZi5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAxICE9PSBlIHx8IGEgJiYgdC5pc0Z1bmN0aW9uKGEucHJvbWlzZSkgPyBlIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IDEgPT09IGMgPyBhIDogdC5EZWZlcnJlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiW2FdID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmW2FdID0gMSA8IGFyZ3VtZW50cy5sZW5ndGggPyB1YS5jYWxsKGFyZ3VtZW50cykgOiBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPT09IGQgPyBoLm5vdGlmeVdpdGgoYiwgZikgOiAtLWMgfHwgaC5yZXNvbHZlV2l0aChiLCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBkLCB3LCBsOwogICAgICAgICAgICAgICAgICAgIGlmICgxIDwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gQXJyYXkoZSksIHcgPSBBcnJheShlKSwgbCA9IEFycmF5KGUpOyBlID4gYjsgYisrKSBmW2JdICYmIHQuaXNGdW5jdGlvbihmW2JdLnByb21pc2UpID8gZltiXS5wcm9taXNlKCkuZG9uZShtKGIsIGwsIGYpKS5mYWlsKGgucmVqZWN0KS5wcm9ncmVzcyhtKGIsIHcsIGQpKSA6IC0tYzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyB8fCBoLnJlc29sdmVXaXRoKGwsIGYpLCBoLnByb21pc2UoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5zdXBwb3J0ID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgdmFyIGYgPSBOLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksCiAgICAgICAgICAgICAgICAgICAgZSA9IE4uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAogICAgICAgICAgICAgICAgICAgIGMgPSBOLmNyZWF0ZUVsZW1lbnQoImRpdiIpLAogICAgICAgICAgICAgICAgICAgIGggPSBOLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpLAogICAgICAgICAgICAgICAgICAgIG0gPSBoLmFwcGVuZENoaWxkKE4uY3JlYXRlRWxlbWVudCgib3B0aW9uIikpOwogICAgICAgICAgICAgICAgcmV0dXJuIGYudHlwZSA/IChmLnR5cGUgPSAiY2hlY2tib3giLCBiLmNoZWNrT24gPSAiIiAhPT0gZi52YWx1ZSwgYi5vcHRTZWxlY3RlZCA9IG0uc2VsZWN0ZWQsIGIucmVsaWFibGVNYXJnaW5SaWdodCA9ICEwLCBiLmJveFNpemluZ1JlbGlhYmxlID0gITAsIGIucGl4ZWxQb3NpdGlvbiA9ICExLCBmLmNoZWNrZWQgPSAhMCwgYi5ub0Nsb25lQ2hlY2tlZCA9IGYuY2xvbmVOb2RlKCEwKS5jaGVja2VkLCBoLmRpc2FibGVkID0gITAsIGIub3B0RGlzYWJsZWQgPSAhbS5kaXNhYmxlZCwgZiA9IE4uY3JlYXRlRWxlbWVudCgiaW5wdXQiKSwgZi52YWx1ZSA9ICJ0IiwgZi50eXBlID0gInJhZGlvIiwgYi5yYWRpb1ZhbHVlID0gInQiID09PSBmLnZhbHVlLCBmLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsICJ0IiksIGYuc2V0QXR0cmlidXRlKCJuYW1lIiwgInQiKSwgZS5hcHBlbmRDaGlsZChmKSwgYi5jaGVja0Nsb25lID0KICAgICAgICAgICAgICAgICAgICBlLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCwgYi5mb2N1c2luQnViYmxlcyA9ICJvbmZvY3VzaW4iIGluIGEsIGMuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiY29udGVudC1ib3giLCBjLmNsb25lTm9kZSghMCkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIiwgYi5jbGVhckNsb25lU3R5bGUgPSAiY29udGVudC1ib3giID09PSBjLnN0eWxlLmJhY2tncm91bmRDbGlwLCB0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSwgaCA9IE4uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgaCAmJiAoZiA9IE4uY3JlYXRlRWxlbWVudCgiZGl2IiksIGYuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6LTk5OTlweDttYXJnaW4tdG9wOjFweCIsIGguYXBwZW5kQ2hpbGQoZikuYXBwZW5kQ2hpbGQoYyksIGMuaW5uZXJIVE1MID0gIiIsIGMuc3R5bGUuY3NzVGV4dCA9ICItd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDtib3gtc2l6aW5nOmJvcmRlci1ib3g7cGFkZGluZzoxcHg7Ym9yZGVyOjFweDtkaXNwbGF5OmJsb2NrO3dpZHRoOjRweDttYXJnaW4tdG9wOjElO3Bvc2l0aW9uOmFic29sdXRlO3RvcDoxJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN3YXAoaCwgbnVsbCAhPSBoLnN0eWxlLnpvb20gPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmJveFNpemluZyA9IDQgPT09IGMub2Zmc2V0V2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhLmdldENvbXB1dGVkU3R5bGUgJiYgKGIucGl4ZWxQb3NpdGlvbiA9ICIxJSIgIT09IChhLmdldENvbXB1dGVkU3R5bGUoYywgbnVsbCkgfHwge30pLnRvcCwgYi5ib3hTaXppbmdSZWxpYWJsZSA9ICI0cHgiID09PSAoYS5nZXRDb21wdXRlZFN0eWxlKGMsIG51bGwpIHx8IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogIjRweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLndpZHRoLCBlID0gYy5hcHBlbmRDaGlsZChOLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwgZS5zdHlsZS5jc3NUZXh0ID0gYy5zdHlsZS5jc3NUZXh0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5OmJsb2NrOy13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7Ym94LXNpemluZzpjb250ZW50LWJveCIsIGUuc3R5bGUubWFyZ2luUmlnaHQgPSBlLnN0eWxlLndpZHRoID0gIjAiLCBjLnN0eWxlLndpZHRoID0gIjFweCIsIGIucmVsaWFibGVNYXJnaW5SaWdodCA9ICFwYXJzZUZsb2F0KChhLmdldENvbXB1dGVkU3R5bGUoZSwgbnVsbCkgfHwge30pLm1hcmdpblJpZ2h0KSksIGgucmVtb3ZlQ2hpbGQoZikpCiAgICAgICAgICAgICAgICAgICAgfSksIGIpIDogYgogICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgdmFyIFosIFUsIEthID0gLyg/Olx7W1xzXFNdKlx9fFxbW1xzXFNdKlxdKSQvLAogICAgICAgICAgICAgICAgdGEgPSAvKFtBLVpdKS9nOwogICAgICAgICAgICB2LnVpZCA9IDE7CiAgICAgICAgICAgIHYuYWNjZXB0cyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLm5vZGVUeXBlID8gMSA9PT0gYS5ub2RlVHlwZSB8fCA5ID09PSBhLm5vZGVUeXBlIDogITAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdi5wcm90b3R5cGUgPSB7CiAgICAgICAgICAgICAgICBrZXk6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXYuYWNjZXB0cyhhKSkgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGFbdGhpcy5leHBhbmRvXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHYudWlkKys7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiW3RoaXMuZXhwYW5kb10gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGEsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJbdGhpcy5leHBhbmRvXSA9IGYsIHQuZXh0ZW5kKGEsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVbZl0gfHwgKHRoaXMuY2FjaGVbZl0gPSB7fSksIGYKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZTsKICAgICAgICAgICAgICAgICAgICBhID0gdGhpcy5rZXkoYSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNhY2hlW2FdOwogICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYikgY1tiXSA9IGY7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodC5pc0VtcHR5T2JqZWN0KGMpKSB0LmV4dGVuZCh0aGlzLmNhY2hlW2FdLCBiKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSBpbiBiKSBjW2VdID0gYltlXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5jYWNoZVt0aGlzLmtleShhKV07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPT09IHAgPyBmIDogZltiXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFjY2VzczogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiID09PSBwIHx8IGIgJiYgInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgZiA9PT0gcCA/IChlID0gdGhpcy5nZXQoYSwgYiksIGUgIT09IHAgPyBlIDogdGhpcy5nZXQoYSwgdC5jYW1lbENhc2UoYikpKSA6ICh0aGlzLnNldChhLCBiLCBmKSwgZiAhPT0gcCA/IGYgOiBiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmLCBlLCBjID0gdGhpcy5rZXkoYSksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0aGlzLmNhY2hlW2NdOwogICAgICAgICAgICAgICAgICAgIGlmIChiID09PSBwKSB0aGlzLmNhY2hlW2NdID0ge307CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHQuaXNBcnJheShiKSA/IGUgPSBiLmNvbmNhdChiLm1hcCh0LmNhbWVsQ2FzZSkpIDogKGYgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuY2FtZWxDYXNlKGIpLCBiIGluIGggPyBlID0gW2IsIGZdIDogKGUgPSBmLCBlID0gZSBpbiBoID8gW2VdIDogZS5tYXRjaChpYSkgfHwgW10pKSwgZiA9IGUubGVuZ3RoOyBmLS07KSBkZWxldGUgaFtlW2ZdXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhhc0RhdGE6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXQuaXNFbXB0eU9iamVjdCh0aGlzLmNhY2hlW2FbdGhpcy5leHBhbmRvXV0gfHwge30pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGlzY2FyZDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGFbdGhpcy5leHBhbmRvXSAmJiBkZWxldGUgdGhpcy5jYWNoZVthW3RoaXMuZXhwYW5kb11dCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIFogPSBuZXcgdjsKICAgICAgICAgICAgVSA9IG5ldyB2OwogICAgICAgICAgICB0LmV4dGVuZCh7CiAgICAgICAgICAgICAgICBhY2NlcHREYXRhOiB2LmFjY2VwdHMsCiAgICAgICAgICAgICAgICBoYXNEYXRhOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFouaGFzRGF0YShhKSB8fCBVLmhhc0RhdGEoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRhOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFouYWNjZXNzKGEsIGIsIGYpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVtb3ZlRGF0YTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIFoucmVtb3ZlKGEsIGIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RhdGE6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVS5hY2Nlc3MoYSwgYiwgZikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVtb3ZlRGF0YTogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBiKSB7CiAgICAgICAgICAgICAgICAgICAgVS5yZW1vdmUoYSwgYikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZm4uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSwgYyA9IHRoaXNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoYSA9PT0gcCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggJiYgKG0gPSBaLmdldChjKSwgMSA9PT0gYy5ub2RlVHlwZSAmJiAhVS5nZXQoYywgImhhc0RhdGFBdHRycyIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gYy5hdHRyaWJ1dGVzOyBmLmxlbmd0aCA+IGg7IGgrKykgZSA9IGZbaF0ubmFtZSwgMCA9PT0gZS5pbmRleE9mKCJkYXRhLSIpICYmIChlID0gdC5jYW1lbENhc2UoZS5zbGljZSg1KSksIEYoYywgZSwgbVtlXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVS5zZXQoYywgImhhc0RhdGFBdHRycyIsICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAib2JqZWN0IiA9PSB0eXBlb2YgYSA/IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgWi5zZXQodGhpcywgYSkKICAgICAgICAgICAgICAgICAgICB9KSA6IHQuYWNjZXNzKHRoaXMsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGUgPSB0LmNhbWVsQ2FzZShhKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgYiA9PT0gcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmID0gWi5nZXQoYywgYSksIGYgIT09IHApIHx8IChmID0gWi5nZXQoYywgZSksIGYgIT09IHApIHx8IChmID0gRihjLCBlLCBwKSwgZiAhPT0gcCkpIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWi5nZXQodGhpcywgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBaLnNldCh0aGlzLCBlLCBiKTsgLSAxICE9PSBhLmluZGV4T2YoIi0iKSAmJiBmICE9PSBwICYmIFouc2V0KHRoaXMsIGEsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCwgYiwgMSA8IGFyZ3VtZW50cy5sZW5ndGgsIG51bGwsICEwKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBaLnJlbW92ZSh0aGlzLCBhKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmV4dGVuZCh7CiAgICAgICAgICAgICAgICBxdWV1ZTogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID8gKGIgPSAoYiB8fCAiZngiKSArICJxdWV1ZSIsIGUgPSBVLmdldChhLCBiKSwgZiAmJiAoIWUgfHwgdC5pc0FycmF5KGYpID8gZSA9IFUuYWNjZXNzKGEsIGIsIHQubWFrZUFycmF5KGYpKSA6IGUucHVzaChmKSksIGUgfHwgW10pIDogcAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlcXVldWU6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gYiB8fCAiZngiOwogICAgICAgICAgICAgICAgICAgIHZhciBmID0gdC5xdWV1ZShhLCBiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGYubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gZi5zaGlmdCgpLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gdC5fcXVldWVIb29rcyhhLCBiKSwKICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kZXF1ZXVlKGEsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgImlucHJvZ3Jlc3MiID09PSBjICYmIChjID0gZi5zaGlmdCgpLCBlLS0pOwogICAgICAgICAgICAgICAgICAgIGMgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKCJmeCIgPT09IGIgJiYgZi51bnNoaWZ0KCJpbnByb2dyZXNzIiksIGRlbGV0ZSBoLnN0b3AsIGMuY2FsbChhLCBtLCBoKSk7CiAgICAgICAgICAgICAgICAgICAgIWUgJiYgaCAmJiBoLmVtcHR5LmZpcmUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9xdWV1ZUhvb2tzOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiICsgInF1ZXVlSG9va3MiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBVLmdldChhLCBmKSB8fCBVLmFjY2VzcyhhLCBmLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtcHR5OiB0LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVLnJlbW92ZShhLCBbYiArICJxdWV1ZSIsIGZdKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBxdWV1ZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIGEgJiYgKGIgPSBhLCBhID0gImZ4IiwgZi0tKSwgZiA+IGFyZ3VtZW50cy5sZW5ndGggPyB0LnF1ZXVlKHRoaXNbMF0sIGEpIDogYiA9PT0gcCA/IHRoaXMgOiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gdC5xdWV1ZSh0aGlzLCBhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdC5fcXVldWVIb29rcyh0aGlzLCBhKTsKICAgICAgICAgICAgICAgICAgICAgICAgImZ4IiA9PT0gYSAmJiAiaW5wcm9ncmVzcyIgIT09IGZbMF0gJiYgdC5kZXF1ZXVlKHRoaXMsIGEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkZXF1ZXVlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5kZXF1ZXVlKHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsYXk6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9IHQuZnggPyB0LmZ4LnNwZWVkc1thXSB8fCBhIDogYSwgYiA9IGIgfHwgImZ4IiwgdGhpcy5xdWV1ZShiLCBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gc2V0VGltZW91dChiLCBhKTsKICAgICAgICAgICAgICAgICAgICAgICAgZi5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xlYXJRdWV1ZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXVlKGEgfHwgImZ4IiwgW10pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvbWlzZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmLCBlID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHQuRGVmZXJyZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSB0aGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1lIHx8IGMucmVzb2x2ZVdpdGgoaCwgW2hdKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICJzdHJpbmciICE9IHR5cGVvZiBhICYmIChiID0gYSwgYSA9IHApOwogICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IGEgfHwgImZ4IjsgbS0tOykoZiA9IFUuZ2V0KGhbbV0sIGEgKyAicXVldWVIb29rcyIpKSAmJiBmLmVtcHR5ICYmIChlKyssIGYuZW1wdHkuYWRkKGQpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCgpLCBjLnByb21pc2UoYikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciByYSwgbGEgPSAvW1x0XHJcblxmXS9nLAogICAgICAgICAgICAgICAgSmEgPSAvXHIvZywKICAgICAgICAgICAgICAgIGhhID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaTsKICAgICAgICAgICAgdC5mbi5leHRlbmQoewogICAgICAgICAgICAgICAgYXR0cjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmFjY2Vzcyh0aGlzLCB0LmF0dHIsIGEsIGIsIDEgPCBhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZUF0dHI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0LnJlbW92ZUF0dHIodGhpcywgYSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByb3A6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5hY2Nlc3ModGhpcywgdC5wcm9wLCBhLCBiLCAxIDwgYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZW1vdmVQcm9wOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXNbdC5wcm9wRml4W2FdIHx8IGFdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhZGRDbGFzczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBmLCBlLCBjLCBoLCBtID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGIgPSAic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiBhOwogICAgICAgICAgICAgICAgICAgIGlmICh0LmlzRnVuY3Rpb24oYSkpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB0KHRoaXMpLmFkZENsYXNzKGEuY2FsbCh0aGlzLCBiLCB0aGlzLmNsYXNzTmFtZSkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSB8fCAiIikubWF0Y2goaWEpIHx8IFtdOyBkID4gbTsgbSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgPSB0aGlzW21dLCBlID0gMSA9PT0gZi5ub2RlVHlwZSAmJiAoZi5jbGFzc05hbWUgPyAoIiAiICsgZi5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UobGEsICIgIikgOiAiICIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gMDsgYyA9IGJbaCsrXTspIDAgPiBlLmluZGV4T2YoIiAiICsgYyArICIgIikgJiYgKGUgKz0gYyArICIgIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5jbGFzc05hbWUgPSB0LnRyaW0oZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGYsIGUsIGMsIGgsIG0gPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYiA9IDAgPT09IGFyZ3VtZW50cy5sZW5ndGggfHwgInN0cmluZyIgPT0gdHlwZW9mIGEgJiYgYTsKICAgICAgICAgICAgICAgICAgICBpZiAodC5pc0Z1bmN0aW9uKGEpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdCh0aGlzKS5yZW1vdmVDbGFzcyhhLmNhbGwodGhpcywgYiwgdGhpcy5jbGFzc05hbWUpKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAoYSB8fCAiIikubWF0Y2goaWEpIHx8IFtdOyBkID4gbTsgbSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgPSB0aGlzW21dLCBlID0gMSA9PT0gZi5ub2RlVHlwZSAmJiAoZi5jbGFzc05hbWUgPyAoIiAiICsgZi5jbGFzc05hbWUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiICIpLnJlcGxhY2UobGEsICIgIikgOiAiIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGggPSAwOyBjID0gYltoKytdOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IDAgPD0gZS5pbmRleE9mKCIgIiArIGMgKyAiICIpOykgZSA9IGUucmVwbGFjZSgiICIgKyBjICsgIiAiLCAiICIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xhc3NOYW1lID0gYSA/IHQudHJpbShlKSA6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0b2dnbGVDbGFzczogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gdHlwZW9mIGE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJib29sZWFuIiA9PSB0eXBlb2YgYiAmJiAic3RyaW5nIiA9PT0gZiA/IGIgPyB0aGlzLmFkZENsYXNzKGEpIDogdGhpcy5yZW1vdmVDbGFzcyhhKSA6IHQuaXNGdW5jdGlvbihhKSA/IHRoaXMuZWFjaChmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsIGYsIHRoaXMuY2xhc3NOYW1lLCBiKSwgYikKICAgICAgICAgICAgICAgICAgICB9KSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciID09PSBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiwgZSA9IDAsIGMgPSB0KHRoaXMpLCBoID0gYS5tYXRjaChpYSkgfHwgW107IGIgPSBoW2UrK107KSBjLmhhc0NsYXNzKGIpID8gYy5yZW1vdmVDbGFzcyhiKSA6IGMuYWRkQ2xhc3MoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UoZiA9PT0gSCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJvb2xlYW4iID09PSBmKSAmJiAodGhpcy5jbGFzc05hbWUgJiYgVS5zZXQodGhpcywgIl9fY2xhc3NOYW1lX18iLCB0aGlzLmNsYXNzTmFtZSksIHRoaXMuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWUgfHwgITEgPT09IGEgPyAiIiA6IFUuZ2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIikgfHwgIiIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBoYXNDbGFzczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSAiICIgKyBhICsgIiAiOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAwLCBmID0gdGhpcy5sZW5ndGg7IGYgPiBiOyBiKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSB0aGlzW2JdLm5vZGVUeXBlICYmIDAgPD0gKCIgIiArIHRoaXNbYl0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKGxhLCAiICIpLmluZGV4T2YoYSkpIHJldHVybiAhMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2YWw6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiwgZSwgYyA9IHRoaXNbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBlID0gdC5pc0Z1bmN0aW9uKGEpLCB0aGlzLmVhY2goZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICAgICAgMSA9PT0gdGhpcy5ub2RlVHlwZSAmJiAoYyA9IGUgPyBhLmNhbGwodGhpcywgZiwgdCh0aGlzKS52YWwoKSkgOiBhLCBudWxsID09IGMgPyBjID0gIiIgOiAibnVtYmVyIiA9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGMgPyBjICs9ICIiIDogdC5pc0FycmF5KGMpICYmIChjID0gdC5tYXAoYywgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGEgPyAiIiA6IGEgKyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBiID0gdC52YWxIb29rc1t0aGlzLnR5cGVdIHx8IHQudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSwgYiAmJiAic2V0IiBpbiBiICYmIGIuc2V0KHRoaXMsIGMsICJ2YWx1ZSIpICE9PSBwIHx8ICh0aGlzLnZhbHVlID0gYykpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHJldHVybiBiID0gdC52YWxIb29rc1tjLnR5cGVdIHx8IHQudmFsSG9va3NbYy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSwgYiAmJiAiZ2V0IiBpbiBiICYmIChmID0gYi5nZXQoYywgInZhbHVlIikpICE9PSBwID8gZiA6IChmID0gYy52YWx1ZSwgInN0cmluZyIgPT0gdHlwZW9mIGYgPyBmLnJlcGxhY2UoSmEsICIiKSA6IG51bGwgPT0gZiA/ICIiIDogZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHZhbEhvb2tzOiB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLmF0dHJpYnV0ZXMudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWIgfHwgYi5zcGVjaWZpZWQgPyBhLnZhbHVlIDogYS50ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogewogICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBhLm9wdGlvbnMsIGUgPSBhLnNlbGVjdGVkSW5kZXgsIGMgPSAic2VsZWN0LW9uZSIgPT09IGEudHlwZSB8fCAwID4gZSwgaCA9IGMgPyBudWxsIDogW10sIG0gPSBjID8gZSArIDEgOiBmLmxlbmd0aCwgZCA9IDAgPiBlID8gbSA6IGMgPyBlIDogMDsgbSA+IGQ7IGQrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IGZbZF0sICEoIWIuc2VsZWN0ZWQgJiYgZCAhPT0gZSB8fCAodC5zdXBwb3J0Lm9wdERpc2FibGVkID8gYi5kaXNhYmxlZCA6IG51bGwgIT09IGIuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpKSB8fCBiLnBhcmVudE5vZGUuZGlzYWJsZWQgJiYgdC5ub2RlTmFtZShiLnBhcmVudE5vZGUsICJvcHRncm91cCIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSA9IHQoYikudmFsKCksIGMpIHJldHVybiBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnB1c2goYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYsIGUsIGMgPSBhLm9wdGlvbnMsIGggPSB0Lm1ha2VBcnJheShiKSwgbSA9IGMubGVuZ3RoOyBtLS07KSBlID0gY1ttXSwgKGUuc2VsZWN0ZWQgPSAwIDw9IHQuaW5BcnJheSh0KGUpLnZhbCgpLCBoKSkgJiYgKGYgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZiB8fCAoYS5zZWxlY3RlZEluZGV4ID0gLTEpLCBoCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYXR0cjogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUsIGMsIGggPSBhLm5vZGVUeXBlOwogICAgICAgICAgICAgICAgICAgIGlmIChhICYmIDMgIT09IGggJiYgOCAhPT0gaCAmJiAyICE9PSBoKSByZXR1cm4gdHlwZW9mIGEuZ2V0QXR0cmlidXRlID09PSBIID8gdC5wcm9wKGEsIGIsIGYpIDogKDEgPT09IGggJiYgdC5pc1hNTERvYyhhKSB8fCAoYiA9IGIudG9Mb3dlckNhc2UoKSwgZSA9IHQuYXR0ckhvb2tzW2JdIHx8ICh0LmV4cHIubWF0Y2guYm9vbC50ZXN0KGIpID8gcmEgOiB2b2lkIDApKSwgZiA9PT0gcCA/IGUgJiYgImdldCIgaW4gZSAmJiBudWxsICE9PSAoYyA9IGUuZ2V0KGEsIGIpKSA/IGMgOiAoYyA9IHQuZmluZC5hdHRyKGEsIGIpLCBudWxsID09IGMgPyBwIDogYykgOiBudWxsICE9PSBmID8gZSAmJiAic2V0IiBpbiBlICYmIChjID0gZS5zZXQoYSwgZiwgYikpICE9PSBwID8gYyA6IChhLnNldEF0dHJpYnV0ZShiLCBmICsgIiIpLCBmKSA6ICh0LnJlbW92ZUF0dHIoYSwgYiksIHApKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZUF0dHI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSwgYyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBiICYmIGIubWF0Y2goaWEpOwogICAgICAgICAgICAgICAgICAgIGlmIChoICYmIDEgPT09IGEubm9kZVR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBmID0gaFtjKytdOykgZSA9IHQucHJvcEZpeFtmXSB8fCBmLCB0LmV4cHIubWF0Y2guYm9vbC50ZXN0KGYpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYVtlXSA9ICExKSwgYS5yZW1vdmVBdHRyaWJ1dGUoZikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhdHRySG9va3M6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0LnN1cHBvcnQucmFkaW9WYWx1ZSAmJiAicmFkaW8iID09PSBiICYmIHQubm9kZU5hbWUoYSwgImlucHV0IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc2V0QXR0cmlidXRlKCJ0eXBlIiwgYiksIGYgJiYgKGEudmFsdWUgPSBmKSwgYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByb3BGaXg6IHsKICAgICAgICAgICAgICAgICAgICAiZm9yIjogImh0bWxGb3IiLAogICAgICAgICAgICAgICAgICAgICJjbGFzcyI6ICJjbGFzc05hbWUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvcDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjLCBoLCBtID0gYS5ub2RlVHlwZTsKICAgICAgICAgICAgICAgICAgICBpZiAoYSAmJiAzICE9PSBtICYmIDggIT09IG0gJiYgMiAhPT0gbSkgcmV0dXJuIGggPSAxICE9PSBtIHx8ICF0LmlzWE1MRG9jKGEpLCBoICYmIChiID0gdC5wcm9wRml4W2JdIHx8IGIsIGMgPSB0LnByb3BIb29rc1tiXSksIGYgIT09IHAgPyBjICYmICJzZXQiIGluIGMgJiYgKGUgPSBjLnNldChhLCBmLCBiKSkgIT09IHAgPyBlIDogYVtiXSA9IGYgOiBjICYmICJnZXQiIGluIGMgJiYgbnVsbCAhPT0gKGUgPSBjLmdldChhLCBiKSkgPyBlIDogYVtiXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByb3BIb29rczogewogICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuaGFzQXR0cmlidXRlKCJ0YWJpbmRleCIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGEudGVzdChhLm5vZGVOYW1lKSB8fCBhLmhyZWYgPyBhLnRhYkluZGV4IDogLTEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJhID0gewogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExID09PSBiID8gdC5yZW1vdmVBdHRyKGEsIGYpIDogYS5zZXRBdHRyaWJ1dGUoZiwgZiksIGYKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5lYWNoKHQuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCgvXHcrL2cpLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgZiA9IHQuZXhwci5hdHRySGFuZGxlW2JdIHx8IHQuZmluZC5hdHRyOwogICAgICAgICAgICAgICAgdC5leHByLmF0dHJIYW5kbGVbYl0gPSBmdW5jdGlvbihhLCBiLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0LmV4cHIuYXR0ckhhbmRsZVtiXTsKICAgICAgICAgICAgICAgICAgICBhID0gZSA/IHAgOiAodC5leHByLmF0dHJIYW5kbGVbYl0gPSBwKSAhPSBmKGEsIGIsIGUpID8gYi50b0xvd2VyQ2FzZSgpIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5leHByLmF0dHJIYW5kbGVbYl0gPSBjLCBhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LnN1cHBvcnQub3B0U2VsZWN0ZWQgfHwgKHQucHJvcEhvb2tzLnNlbGVjdGVkID0gewogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IGEucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSAmJiBhLnBhcmVudE5vZGUgJiYgYS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZWFjaCgidGFiSW5kZXggcmVhZE9ubHkgbWF4TGVuZ3RoIGNlbGxTcGFjaW5nIGNlbGxQYWRkaW5nIHJvd1NwYW4gY29sU3BhbiB1c2VNYXAgZnJhbWVCb3JkZXIgY29udGVudEVkaXRhYmxlIi5zcGxpdCgiICIpLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHQucHJvcEZpeFt0aGlzLnRvTG93ZXJDYXNlKCldID0gdGhpcwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5lYWNoKFsicmFkaW8iLCAiY2hlY2tib3giXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0LnZhbEhvb2tzW3RoaXNdID0gewogICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5pc0FycmF5KGIpID8gYS5jaGVja2VkID0gMCA8PSB0LmluQXJyYXkodChhKS52YWwoKSwgYikgOiBwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHQuc3VwcG9ydC5jaGVja09uIHx8ICh0LnZhbEhvb2tzW3RoaXNdLmdldCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PT0gYS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPyAib24iIDogYS52YWx1ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBqYSA9IC9ea2V5LywKICAgICAgICAgICAgICAgIGJhID0gL14oPzptb3VzZXxjb250ZXh0bWVudSl8Y2xpY2svLAogICAgICAgICAgICAgICAgWCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywKICAgICAgICAgICAgICAgIHdhID0gL14oW14uXSopKD86XC4oLispfCkkLzsKICAgICAgICAgICAgdC5ldmVudCA9IHsKICAgICAgICAgICAgICAgIGdsb2JhbDoge30sCiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGEsIGIsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaCwgbSwgZCwgdywgbCwgbiwgZywgcSwgciwgdTsKICAgICAgICAgICAgICAgICAgICBpZiAobCA9IFUuZ2V0KGEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYuaGFuZGxlciAmJiAoaCA9IGYsIGYgPSBoLmhhbmRsZXIsIGMgPSBoLnNlbGVjdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgZi5ndWlkIHx8IChmLmd1aWQgPSB0Lmd1aWQrKyk7CiAgICAgICAgICAgICAgICAgICAgICAgICh3ID0gbC5ldmVudHMpIHx8ICh3ID0gbC5ldmVudHMgPSB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIChtID0gbC5oYW5kbGUpIHx8IChtID0gbC5oYW5kbGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHQgPT09IEggfHwgYSAmJiB0LmV2ZW50LnRyaWdnZXJlZCA9PT0gYS50eXBlID8gcCA6IHQuZXZlbnQuZGlzcGF0Y2guYXBwbHkobS5lbGVtLCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG0uZWxlbSA9IGEpOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gKGIgfHwgIiIpLm1hdGNoKGlhKSB8fCBbIiJdOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGwgPSBiLmxlbmd0aDsgbC0tOykgZCA9IHdhLmV4ZWMoYltsXSkgfHwgW10sIHIgPSB1ID0gZFsxXSwgZCA9IChkWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKSwgciAmJiAoZyA9IHQuZXZlbnQuc3BlY2lhbFtyXSB8fCB7fSwgciA9IChjID8gZy5kZWxlZ2F0ZVR5cGUgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5iaW5kVHlwZSkgfHwgciwgZyA9IHQuZXZlbnQuc3BlY2lhbFtyXSB8fCB7fSwgbiA9IHQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnVHlwZTogdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpZDogZi5ndWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkc0NvbnRleHQ6IGMgJiYgdC5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlOiBkLmpvaW4oIi4iKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBoKSwgKHEgPSB3W3JdKSB8fCAocSA9IHdbcl0gPSBbXSwgcS5kZWxlZ2F0ZUNvdW50ID0gMCwgZy5zZXR1cCAmJiAhMSAhPT0gZy5zZXR1cC5jYWxsKGEsIGUsIGQsIG0pIHx8IGEuYWRkRXZlbnRMaXN0ZW5lciAmJiBhLmFkZEV2ZW50TGlzdGVuZXIociwgbSwgITEpKSwgZy5hZGQgJiYgKGcuYWRkLmNhbGwoYSwgbiksIG4uaGFuZGxlci5ndWlkIHx8IChuLmhhbmRsZXIuZ3VpZCA9IGYuZ3VpZCkpLCBjID8gcS5zcGxpY2UocS5kZWxlZ2F0ZUNvdW50KyssIDAsIG4pIDogcS5wdXNoKG4pLCB0LmV2ZW50Lmdsb2JhbFtyXSA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYSA9IG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihhLCBiLCBmLCBlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGgsIG0sIGQsIHcsIGwsIG4sIGcsIHEsIHIsIHUsCiAgICAgICAgICAgICAgICAgICAgICAgIEIsIHggPSBVLmhhc0RhdGEoYSkgJiYgVS5nZXQoYSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJiYgKHcgPSB4LmV2ZW50cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IChiIHx8ICIiKS5tYXRjaChpYSkgfHwgWyIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsID0gYi5sZW5ndGg7IGwtLTspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IHdhLmV4ZWMoYltsXSkgfHwgW10sIHIgPSBCID0gZFsxXSwgdSA9IChkWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKSwgcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0LmV2ZW50LnNwZWNpYWxbcl0gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IChlID8gZy5kZWxlZ2F0ZVR5cGUgOiBnLmJpbmRUeXBlKSB8fCByOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB3W3JdIHx8IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBkWzJdICYmIFJlZ0V4cCgiKF58XFwuKSIgKyB1LmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChtID0gaCA9IHEubGVuZ3RoOyBoLS07KSBuID0gcVtoXSwgIWMgJiYgQiAhPT0gbi5vcmlnVHlwZSB8fCBmICYmIGYuZ3VpZCAhPT0gbi5ndWlkIHx8IGQgJiYgIWQudGVzdChuLm5hbWVzcGFjZSkgfHwgZSAmJiBlICE9PSBuLnNlbGVjdG9yICYmICgiKioiICE9PSBlIHx8ICFuLnNlbGVjdG9yKSB8fCAocS5zcGxpY2UoaCwgMSksIG4uc2VsZWN0b3IgJiYgcS5kZWxlZ2F0ZUNvdW50LS0sIGcucmVtb3ZlICYmIGcucmVtb3ZlLmNhbGwoYSwgbikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gJiYgIXEubGVuZ3RoICYmIChnLnRlYXJkb3duICYmICExICE9PSBnLnRlYXJkb3duLmNhbGwoYSwgdSwgeC5oYW5kbGUpIHx8IHQucmVtb3ZlRXZlbnQoYSwgciwgeC5oYW5kbGUpLCBkZWxldGUgd1tyXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAociBpbiB3KSB0LmV2ZW50LnJlbW92ZShhLCByICsgYltsXSwgZiwgZSwgITApOwogICAgICAgICAgICAgICAgICAgICAgICB0LmlzRW1wdHlPYmplY3QodykgJiYgKGRlbGV0ZSB4LmhhbmRsZSwgVS5yZW1vdmUoYSwgImV2ZW50cyIpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbihiLCBmLCBlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGgsIG0sIGQsIHcsIGwsIG4sIGcsIHEgPSBbZSB8fCBOXSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IGNiLmNhbGwoYiwgInR5cGUiKSA/IGIudHlwZSA6IGI7CiAgICAgICAgICAgICAgICAgICAgaCA9IGNiLmNhbGwoYiwgIm5hbWVzcGFjZSIpID8gYi5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChtID0gZCA9IGUgPSBlIHx8IE4sIDMgIT09IGUubm9kZVR5cGUgJiYgOCAhPT0gZS5ub2RlVHlwZSAmJiAhWC50ZXN0KHIgKyB0LmV2ZW50LnRyaWdnZXJlZCkgJiYgKDAgPD0gci5pbmRleE9mKCIuIikgJiYgKGggPSByLnNwbGl0KCIuIiksIHIgPSBoLnNoaWZ0KCksIGguc29ydCgpKSwgbCA9IDAgPiByLmluZGV4T2YoIjoiKSAmJiAib24iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIsIGIgPSBiW3QuZXhwYW5kb10gPyBiIDogbmV3IHQuRXZlbnQociwgIm9iamVjdCIgPT0gdHlwZW9mIGIgJiYgYiksIGIuaXNUcmlnZ2VyID0gYyA/IDIgOiAzLCBiLm5hbWVzcGFjZSA9IGguam9pbigiLiIpLCBiLm5hbWVzcGFjZV9yZSA9IGIubmFtZXNwYWNlID8gUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSA6IG51bGwsIGIucmVzdWx0ID0gcCwgYi50YXJnZXQgfHwgKGIudGFyZ2V0ID0gZSksIGYgPSBudWxsID09IGYgPyBbYl0gOiB0Lm1ha2VBcnJheShmLCBbYl0pLCBnID0gdC5ldmVudC5zcGVjaWFsW3JdIHx8IHt9LCBjIHx8ICFnLnRyaWdnZXIgfHwgITEgIT09IGcudHJpZ2dlci5hcHBseShlLCBmKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjICYmICFnLm5vQnViYmxlICYmICF0LmlzV2luZG93KGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gZy5kZWxlZ2F0ZVR5cGUgfHwgcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoWC50ZXN0KHcgKyByKSB8fCAobSA9IG0ucGFyZW50Tm9kZSk7IG07IG0gPSBtLnBhcmVudE5vZGUpIHEucHVzaChtKSwgZCA9IG07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID09PSAoZS5vd25lckRvY3VtZW50IHx8IE4pICYmIHEucHVzaChkLmRlZmF1bHRWaWV3IHx8IGQucGFyZW50V2luZG93IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0gPSBxW2grK10pICYmICFiLmlzUHJvcGFnYXRpb25TdG9wcGVkKCk7KSBiLnR5cGUgPSAxIDwgaCA/IHcgOiBnLmJpbmRUeXBlIHx8IHIsIChuID0gKFUuZ2V0KG0sICJldmVudHMiKSB8fCB7fSlbYi50eXBlXSAmJiBVLmdldChtLCAiaGFuZGxlIikpICYmIG4uYXBwbHkobSwgZiksIChuID0gbCAmJiBtW2xdKSAmJiB0LmFjY2VwdERhdGEobSkgJiYgbi5hcHBseSAmJiAhMSA9PT0gbi5hcHBseShtLCBmKSAmJiBiLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnR5cGUgPSByLCBjIHx8IGIuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZy5fZGVmYXVsdCAmJiAhMSAhPT0gZy5fZGVmYXVsdC5hcHBseShxLnBvcCgpLCBmKSB8fCAhdC5hY2NlcHREYXRhKGUpIHx8IGwgJiYgdC5pc0Z1bmN0aW9uKGVbcl0pICYmICF0LmlzV2luZG93KGUpICYmIChkID0gZVtsXSwgZCAmJiAoZVtsXSA9IG51bGwpLCB0LmV2ZW50LnRyaWdnZXJlZCA9IHIsIGVbcl0oKSwgdC5ldmVudC50cmlnZ2VyZWQgPSBwLCBkICYmIChlW2xdID0gZCkpLCBiLnJlc3VsdAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSB0LmV2ZW50LmZpeChhKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiwgZSwgYywgaCwgbSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gdWEuY2FsbChhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIGIgPSAoVS5nZXQodGhpcywgImV2ZW50cyIpIHx8IHt9KVthLnR5cGVdIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIHZhciB3ID0gdC5ldmVudC5zcGVjaWFsW2EudHlwZV0gfHwge307CiAgICAgICAgICAgICAgICAgICAgaWYgKGRbMF0gPSBhLCBhLmRlbGVnYXRlVGFyZ2V0ID0gdGhpcywgIXcucHJlRGlzcGF0Y2ggfHwgITEgIT09IHcucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCBhKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtID0gdC5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIGEsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMgPSBtW2IrK10pICYmICFhLmlzUHJvcGFnYXRpb25TdG9wcGVkKCk7KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChhLmN1cnJlbnRUYXJnZXQgPSBjLmVsZW0sIGYgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChoID0gYy5oYW5kbGVyc1tmKytdKSAmJiAhYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpOykgYS5uYW1lc3BhY2VfcmUgJiYgIWEubmFtZXNwYWNlX3JlLnRlc3QoaC5uYW1lc3BhY2UpIHx8IChhLmhhbmRsZU9iaiA9IGgsIGEuZGF0YSA9IGguZGF0YSwgZSA9ICgodC5ldmVudC5zcGVjaWFsW2gub3JpZ1R5cGVdIHx8IHt9KS5oYW5kbGUgfHwgaC5oYW5kbGVyKS5hcHBseShjLmVsZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCksIGUgPT09IHAgfHwgITEgIT09IChhLnJlc3VsdCA9IGUpIHx8IChhLnByZXZlbnREZWZhdWx0KCksIGEuc3RvcFByb3BhZ2F0aW9uKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHcucG9zdERpc3BhdGNoICYmIHcucG9zdERpc3BhdGNoLmNhbGwodGhpcywgYSksIGEucmVzdWx0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhhbmRsZXJzOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGUsIGMsIGgsIG0gPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGIuZGVsZWdhdGVDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgdyA9IGEudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChkICYmIHcubm9kZVR5cGUgJiYgKCFhLmJ1dHRvbiB8fCAiY2xpY2siICE9PSBhLnR5cGUpKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgdyAhPT0gdGhpczsgdyA9IHcucGFyZW50Tm9kZSB8fCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwICE9PSB3LmRpc2FibGVkIHx8ICJjbGljayIgIT09IGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBkID4gZjsgZisrKSBoID0gYltmXSwgYyA9IGguc2VsZWN0b3IgKyAiICIsIGVbY10gPT09IHAgJiYgKGVbY10gPSBoLm5lZWRzQ29udGV4dCA/IDAgPD0gdChjLCB0aGlzKS5pbmRleCh3KSA6IHQuZmluZChjLCB0aGlzLCBudWxsLCBbd10pLmxlbmd0aCksIGVbY10gJiYgZS5wdXNoKGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubGVuZ3RoICYmIG0ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW06IHcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXJzOiBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi5sZW5ndGggPgogICAgICAgICAgICAgICAgICAgICAgICBkICYmIG0ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtOiB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnM6IGIuc2xpY2UoZCkKICAgICAgICAgICAgICAgICAgICAgICAgfSksIG0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9wczogImFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgIGZpeEhvb2tzOiB7fSwKICAgICAgICAgICAgICAgIGtleUhvb2tzOiB7CiAgICAgICAgICAgICAgICAgICAgcHJvcHM6IFsiY2hhciIsICJjaGFyQ29kZSIsICJrZXkiLCAia2V5Q29kZSJdLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhLndoaWNoICYmIChhLndoaWNoID0gbnVsbCAhPSBiLmNoYXJDb2RlID8gYi5jaGFyQ29kZSA6IGIua2V5Q29kZSksIGEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbW91c2VIb29rczogewogICAgICAgICAgICAgICAgICAgIHByb3BzOiAiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50Ii5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSwgYywgaCA9IGIuYnV0dG9uOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5wYWdlWCAmJiBudWxsICE9IGIuY2xpZW50WCAmJiAoZiA9IGEudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgTiwgZSA9IGYuZG9jdW1lbnRFbGVtZW50LCBjID0gZi5ib2R5LCBhLnBhZ2VYID0gYi5jbGllbnRYICsgKGUgJiYgZS5zY3JvbGxMZWZ0IHx8IGMgJiYgYy5zY3JvbGxMZWZ0IHx8IDApIC0gKGUgJiYgZS5jbGllbnRMZWZ0IHx8IGMgJiYgYy5jbGllbnRMZWZ0IHx8IDApLCBhLnBhZ2VZID0gYi5jbGllbnRZICsgKGUgJiYgZS5zY3JvbGxUb3AgfHwgYyAmJiBjLnNjcm9sbFRvcCB8fCAwKSAtIChlICYmIGUuY2xpZW50VG9wIHx8IGMgJiYgYy5jbGllbnRUb3AgfHwgMCkpLCBhLndoaWNoIHx8IGggPT09IHAgfHwgKGEud2hpY2ggPSAxICYgaCA/IDEgOiAyICYgaCA/IDMgOiA0ICYgaCA/IDIgOiAwKSwgYQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmaXg6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYVt0LmV4cGFuZG9dKSByZXR1cm4gYTsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiwgZTsKICAgICAgICAgICAgICAgICAgICBiID0gYS50eXBlOwogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMuZml4SG9va3NbYl07CiAgICAgICAgICAgICAgICAgICAgaCB8fCAodGhpcy5maXhIb29rc1tiXSA9IGggPSBiYS50ZXN0KGIpID8gdGhpcy5tb3VzZUhvb2tzIDogamEudGVzdChiKSA/IHRoaXMua2V5SG9va3MgOiB7fSk7CiAgICAgICAgICAgICAgICAgICAgZSA9IGgucHJvcHMgPyB0aGlzLnByb3BzLmNvbmNhdChoLnByb3BzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHM7CiAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyB0LkV2ZW50KGMpOwogICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IGUubGVuZ3RoOyBiLS07KSBmID0gZVtiXSwgYVtmXSA9IGNbZl07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEudGFyZ2V0IHx8IChhLnRhcmdldCA9IE4pLCAzID09PSBhLnRhcmdldC5ub2RlVHlwZSAmJiAoYS50YXJnZXQgPSBhLnRhcmdldC5wYXJlbnROb2RlKSwgaC5maWx0ZXIgPyBoLmZpbHRlcihhLCBjKSA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzcGVjaWFsOiB7CiAgICAgICAgICAgICAgICAgICAgbG9hZDogewogICAgICAgICAgICAgICAgICAgICAgICBub0J1YmJsZTogITAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZvY3VzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgIT09IFMoKSAmJiB0aGlzLmZvY3VzID8gKHRoaXMuZm9jdXMoKSwgITEpIDogcAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0ZVR5cGU6ICJmb2N1c2luIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYmx1cjogewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzID09PSBTKCkgJiYgdGhpcy5ibHVyID8gKHRoaXMuYmx1cigpLCAhMSkgOiBwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gImNoZWNrYm94IiA9PT0gdGhpcy50eXBlICYmIHRoaXMuY2xpY2sgJiYgdC5ub2RlTmFtZSh0aGlzLCAiaW5wdXQiKSA/ICh0aGlzLmNsaWNrKCksICExKSA6IHAKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgX2RlZmF1bHQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm5vZGVOYW1lKGEudGFyZ2V0LCAiYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGJlZm9yZXVubG9hZDogewogICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucmVzdWx0ICE9PSBwICYmIChhLm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBhLnJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzaW11bGF0ZTogZnVuY3Rpb24oYSwgYiwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgIGEgPSB0LmV4dGVuZChuZXcgdC5FdmVudCwgZiwgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBhLAogICAgICAgICAgICAgICAgICAgICAgICBpc1NpbXVsYXRlZDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQ6IHt9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZSA/IHQuZXZlbnQudHJpZ2dlcihhLCBudWxsLCBiKSA6IHQuZXZlbnQuZGlzcGF0Y2guY2FsbChiLCBhKTsKICAgICAgICAgICAgICAgICAgICBhLmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIGYucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgYS5yZW1vdmVFdmVudExpc3RlbmVyICYmIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLCBmLCAhMSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5FdmVudCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgdC5FdmVudCA/IChhICYmIGEudHlwZSA/ICh0aGlzLm9yaWdpbmFsRXZlbnQgPQogICAgICAgICAgICAgICAgICAgIGEsIHRoaXMudHlwZSA9IGEudHlwZSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBhLmRlZmF1bHRQcmV2ZW50ZWQgfHwgYS5nZXRQcmV2ZW50RGVmYXVsdCAmJiBhLmdldFByZXZlbnREZWZhdWx0KCkgPyBNIDogSSkgOiB0aGlzLnR5cGUgPSBhLCBiICYmIHQuZXh0ZW5kKHRoaXMsIGIpLCB0aGlzLnRpbWVTdGFtcCA9IGEgJiYgYS50aW1lU3RhbXAgfHwgdC5ub3coKSwgdGhpc1t0LmV4cGFuZG9dID0gITAsIHApIDogbmV3IHQuRXZlbnQoYSwgYikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5FdmVudC5wcm90b3R5cGUgPSB7CiAgICAgICAgICAgICAgICBpc0RlZmF1bHRQcmV2ZW50ZWQ6IEksCiAgICAgICAgICAgICAgICBpc1Byb3BhZ2F0aW9uU3RvcHBlZDogSSwKICAgICAgICAgICAgICAgIGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiBJLAogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5vcmlnaW5hbEV2ZW50OwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gTTsKICAgICAgICAgICAgICAgICAgICBhICYmIGEucHJldmVudERlZmF1bHQgJiYgYS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMub3JpZ2luYWxFdmVudDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0KICAgICAgICAgICAgICAgICAgICAgICAgTTsKICAgICAgICAgICAgICAgICAgICBhICYmIGEuc3RvcFByb3BhZ2F0aW9uICYmIGEuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSBNOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5lYWNoKHsKICAgICAgICAgICAgICAgIG1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAogICAgICAgICAgICAgICAgbW91c2VsZWF2ZTogIm1vdXNlb3V0IgogICAgICAgICAgICB9LCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB0LmV2ZW50LnNwZWNpYWxbYV0gPSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZWdhdGVUeXBlOiBiLAogICAgICAgICAgICAgICAgICAgIGJpbmRUeXBlOiBiLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSA9IGEucmVsYXRlZFRhcmdldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhLmhhbmRsZU9iajsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICghZSB8fCBlICE9PSB0aGlzICYmICF0LmNvbnRhaW5zKHRoaXMsIGUpKSAmJiAoYS50eXBlID0gYy5vcmlnVHlwZSwgZiA9IGMuaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBhLnR5cGUgPSBiKSwgZgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuc3VwcG9ydC5mb2N1c2luQnViYmxlcyB8fCB0LmVhY2goewogICAgICAgICAgICAgICAgZm9jdXM6ICJmb2N1c2luIiwKICAgICAgICAgICAgICAgIGJsdXI6ICJmb2N1c291dCIKICAgICAgICAgICAgfSwgZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgIGIpIHsKICAgICAgICAgICAgICAgIHZhciBmID0gMCwKICAgICAgICAgICAgICAgICAgICBlID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0LmV2ZW50LnNpbXVsYXRlKGIsIGEudGFyZ2V0LCB0LmV2ZW50LmZpeChhKSwgITApCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHQuZXZlbnQuc3BlY2lhbFtiXSA9IHsKICAgICAgICAgICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGYrKyAmJiBOLmFkZEV2ZW50TGlzdGVuZXIoYSwgZSwgITApCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IC0tZiAmJiBOLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSwgZSwgITApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5mbi5leHRlbmQoewogICAgICAgICAgICAgICAgb246IGZ1bmN0aW9uKGEsIGIsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaCwgbTsKICAgICAgICAgICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIGIgJiYgKGYgPSBmIHx8IGIsIGIgPSBwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChtIGluIGEpIHRoaXMub24obSwgYiwgZiwgYVttXSwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGYgJiYgbnVsbCA9PSBlID8gKGUgPSBiLCBmID0gYiA9IHApIDogbnVsbCA9PSBlICYmICgic3RyaW5nIiA9PSB0eXBlb2YgYiA/IChlID0gZiwgZiA9IHApIDogKGUgPSBmLCBmID0gYiwgYiA9IHApKSwgITEgPT09IGUpIGUgPSBJOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFlKSByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSA9PT0gYyAmJiAoaCA9IGUsIGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0KCkub2ZmKGEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgfSwgZS5ndWlkID0gaC5ndWlkIHx8IChoLmd1aWQgPSB0Lmd1aWQrKykpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuZXZlbnQuYWRkKHRoaXMsIGEsIGUsIGYsIGIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbmU6IGZ1bmN0aW9uKGEsIGIsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vbihhLCBiLCBmLCBlLCAxKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9mZjogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjOwogICAgICAgICAgICAgICAgICAgIGlmIChhICYmIGEucHJldmVudERlZmF1bHQgJiYgYS5oYW5kbGVPYmopIHJldHVybiBlID0gYS5oYW5kbGVPYmosIHQoYS5kZWxlZ2F0ZVRhcmdldCkub2ZmKGUubmFtZXNwYWNlID8gZS5vcmlnVHlwZSArICIuIiArIGUubmFtZXNwYWNlIDogZS5vcmlnVHlwZSwgZS5zZWxlY3RvciwgZS5oYW5kbGVyKSwgdGhpczsKICAgICAgICAgICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGEpIHRoaXMub2ZmKGMsIGIsIGFbY10pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCExID09PSBiIHx8ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGIpICYmIChmID0gYiwgYiA9IHApLCAhMSA9PT0gZiAmJiAoZiA9IEkpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuZXZlbnQucmVtb3ZlKHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLCBmLCBiKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuZXZlbnQudHJpZ2dlcihhLCBiLCB0aGlzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IHRoaXNbMF07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYgPyB0LmV2ZW50LnRyaWdnZXIoYSwgYiwgZiwgITApIDogcAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIExhID0gL14uW146I1xbXC4sXSokLywKICAgICAgICAgICAgICAgIEJhID0gL14oPzpwYXJlbnRzfHByZXYoPzpVbnRpbHxBbGwpKS8sCiAgICAgICAgICAgICAgICBtYiA9IHQuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQsCiAgICAgICAgICAgICAgICB6YSA9IHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogITAsCiAgICAgICAgICAgICAgICAgICAgY29udGVudHM6ICEwLAogICAgICAgICAgICAgICAgICAgIG5leHQ6ICEwLAogICAgICAgICAgICAgICAgICAgIHByZXY6ICEwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB0LmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBmaW5kOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGYgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBlLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIGEpIHJldHVybiB0aGlzLnB1c2hTdGFjayh0KGEpLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYyA+IGI7IGIrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LmNvbnRhaW5zKGVbYl0sIHRoaXMpKSByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYyA+IGI7IGIrKykgdC5maW5kKGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGVbYl0sIGYpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmID0gdGhpcy5wdXNoU3RhY2soMSA8IGMgPyB0LnVuaXF1ZShmKSA6IGYpLCBmLnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgKyBhIDogYSwgZgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhhczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdChhLCB0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGIubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGYgPiBhOyBhKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5jb250YWlucyh0aGlzLCBiW2FdKSkgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBub3Q6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soUCh0aGlzLCBhIHx8IFtdLCAhMCkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKFAodGhpcywgYSB8fCBbXSwgITEpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhUCh0aGlzLCAic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiBtYi50ZXN0KGEpID8gdChhKSA6IGEgfHwgW10sICExKS5sZW5ndGgKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbG9zZXN0OiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiwgZSA9IDAsIGMgPSB0aGlzLmxlbmd0aCwgaCA9IFtdLCBtID0gbWIudGVzdChhKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIGEgPyB0KGEsIGIgfHwgdGhpcy5jb250ZXh0KSA6IDA7IGMgPiBlOyBlKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IHRoaXNbZV07IGYgJiYgZiAhPT0gYjsgZiA9IGYucGFyZW50Tm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxMSA+IGYubm9kZVR5cGUgJiYgKG0gPyAtMSA8IG0uaW5kZXgoZikgOiAxID09PSBmLm5vZGVUeXBlICYmIHQuZmluZC5tYXRjaGVzU2VsZWN0b3IoZiwgYSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5wdXNoKGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKDEgPCBoLmxlbmd0aCA/IHQudW5pcXVlKGgpIDogaCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpbmRleDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID8gInN0cmluZyIgPT0gdHlwZW9mIGEgPyB4YS5jYWxsKHQoYSksIHRoaXNbMF0pIDogeGEuY2FsbCh0aGlzLCBhLmpxdWVyeSA/IGFbMF0gOiBhKSA6IHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlID8gdGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGggOiAtMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gInN0cmluZyIgPT0gdHlwZW9mIGEgPyB0KGEsIGIpIDogdC5tYWtlQXJyYXkoYSAmJiBhLm5vZGVUeXBlID8gW2FdIDogYSksCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0Lm1lcmdlKHRoaXMuZ2V0KCksIGYpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh0LnVuaXF1ZShmKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhZGRCYWNrOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKG51bGwgPT0gYSA/IHRoaXMucHJldk9iamVjdCA6IHRoaXMucHJldk9iamVjdC5maWx0ZXIoYSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmVhY2goewogICAgICAgICAgICAgICAgcGFyZW50OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhID0gYS5wYXJlbnROb2RlKSAmJiAxMSAhPT0gYS5ub2RlVHlwZSA/IGEgOiBudWxsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyZW50czogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmRpcihhLCAicGFyZW50Tm9kZSIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyZW50c1VudGlsOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGlyKGEsICJwYXJlbnROb2RlIiwgZikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE8oYSwgIm5leHRTaWJsaW5nIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcmV2OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE8oYSwgInByZXZpb3VzU2libGluZyIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbmV4dEFsbDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmRpcihhLCAibmV4dFNpYmxpbmciKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByZXZBbGw6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5kaXIoYSwgInByZXZpb3VzU2libGluZyIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbmV4dFVudGlsOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGlyKGEsICJuZXh0U2libGluZyIsIGYpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJldlVudGlsOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGlyKGEsICJwcmV2aW91c1NpYmxpbmciLCBmKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpYmxpbmdzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuc2libGluZygoYS5wYXJlbnROb2RlIHx8IHt9KS5maXJzdENoaWxkLCBhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuc2libGluZyhhLmZpcnN0Q2hpbGQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudHM6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5jb250ZW50RG9jdW1lbnQgfHwgdC5tZXJnZShbXSwgYS5jaGlsZE5vZGVzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB0LmZuW2FdID0gZnVuY3Rpb24oZiwgZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdC5tYXAodGhpcywgYiwgZik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJVbnRpbCIgIT09IGEuc2xpY2UoLTUpICYmIChlID0gZiksIGUgJiYgInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgKGMgPSB0LmZpbHRlcihlLCBjKSksIDEgPCB0aGlzLmxlbmd0aCAmJiAoemFbYV0gfHwgdC51bmlxdWUoYyksIEJhLnRlc3QoYSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXZlcnNlKCkpLCB0aGlzLnB1c2hTdGFjayhjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5leHRlbmQoewogICAgICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBiWzBdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmICYmIChhID0gIjpub3QoIiArIGEgKyAiKSIpLCAxID09PSBiLmxlbmd0aCAmJiAxID09PSBlLm5vZGVUeXBlID8gdC5maW5kLm1hdGNoZXNTZWxlY3RvcihlLCBhKSA/IFtlXSA6IFtdIDogdC5maW5kLm1hdGNoZXMoYSwgdC5ncmVwKGIsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgPT09IGEubm9kZVR5cGUKICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkaXI6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0gW10sIGMgPSBmICE9PSBwOwogICAgICAgICAgICAgICAgICAgICAgICAoYSA9IGFbYl0pICYmIDkgIT09IGEubm9kZVR5cGU7KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gYS5ub2RlVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgdChhKS5pcyhmKSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnB1c2goYSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2libGluZzogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSBbXTsgYTsgYSA9IGEubmV4dFNpYmxpbmcpIDEgPT09IGEubm9kZVR5cGUgJiYgYSAhPT0gYiAmJiBmLnB1c2goYSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuYiA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksCiAgICAgICAgICAgICAgICBwYSA9IC88KFtcdzpdKykvLAogICAgICAgICAgICAgICAgb2EgPSAvPHwmIz9cdys7LywKICAgICAgICAgICAgICAgIHNhID0gLzwoPzpzY3JpcHR8c3R5bGV8bGluaykvaSwKICAgICAgICAgICAgICAgIG9iID0gL14oPzpjaGVja2JveHxyYWRpbykkL2ksCiAgICAgICAgICAgICAgICBQYSA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLAogICAgICAgICAgICAgICAgUWEgPSAvXiR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2ksCiAgICAgICAgICAgICAgICBNYSA9IC9edHJ1ZVwvKC4qKS8sCiAgICAgICAgICAgICAgICBlYiA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKICAgICAgICAgICAgICAgIGNhID0gewogICAgICAgICAgICAgICAgICAgIG9wdGlvbjogWzEsICI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwgIjwvc2VsZWN0PiJdLAogICAgICAgICAgICAgICAgICAgIHRoZWFkOiBbMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iXSwKICAgICAgICAgICAgICAgICAgICBjb2w6IFsyLCAiPHRhYmxlPjxjb2xncm91cD4iLCAiPC9jb2xncm91cD48L3RhYmxlPiJdLAogICAgICAgICAgICAgICAgICAgIHRyOiBbMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iXSwKICAgICAgICAgICAgICAgICAgICB0ZDogWzMsICI8dGFibGU+PHRib2R5Pjx0cj4iLCAiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sCiAgICAgICAgICAgICAgICAgICAgX2RlZmF1bHQ6IFswLCAiIiwgIiJdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBjYS5vcHRncm91cCA9IGNhLm9wdGlvbjsKICAgICAgICAgICAgY2EudGJvZHkgPQogICAgICAgICAgICAgICAgY2EudGZvb3QgPSBjYS5jb2xncm91cCA9IGNhLmNhcHRpb24gPSBjYS50aGVhZDsKICAgICAgICAgICAgY2EudGggPSBjYS50ZDsKICAgICAgICAgICAgdC5mbi5leHRlbmQoewogICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBwID8gdC50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgTikuY3JlYXRlVGV4dE5vZGUoYSkpCiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCwgYSwgYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAxICE9PSB0aGlzLm5vZGVUeXBlICYmIDExICE9PSB0aGlzLm5vZGVUeXBlICYmIDkgIT09IHRoaXMubm9kZVR5cGUgfHwgVih0aGlzLCBhKS5hcHBlbmRDaGlsZChhKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJlcGVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSB0aGlzLm5vZGVUeXBlIHx8IDExID09PSB0aGlzLm5vZGVUeXBlIHx8IDkgPT09IHRoaXMubm9kZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWKHRoaXMsIGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5pbnNlcnRCZWZvcmUoYSwgYi5maXJzdENoaWxkKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBiZWZvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCB0aGlzKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWZ0ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCB0aGlzLm5leHRTaWJsaW5nKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihhLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZSwgYyA9IGEgPyB0LmZpbHRlcihhLCB0aGlzKSA6IHRoaXMsIGggPSAwOyBudWxsICE9IChlID0gY1toXSk7IGgrKykgZiB8fCAxICE9PSBlLm5vZGVUeXBlIHx8IHQuY2xlYW5EYXRhKGIoZSkpLCBlLnBhcmVudE5vZGUgJiYgKGYgJiYgdC5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpICYmIGFhKGIoZSwgInNjcmlwdCIpKSwgZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGUpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhLCBmID0gMDsgbnVsbCAhPSAoYSA9IHRoaXNbZl0pOyBmKyspIDEgPT09IGEubm9kZVR5cGUgJiYgKHQuY2xlYW5EYXRhKGIoYSwgITEpKSwgYS50ZXh0Q29udGVudCA9ICIiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPSBudWxsID09IGEgPyAhMSA6IGEsIGIgPSBudWxsID09IGIgPyBhIDogYiwgdGhpcy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmNsb25lKHRoaXMsIGEsIGIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBodG1sOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuYWNjZXNzKHRoaXMsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzWzBdIHx8IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhID09PSBwICYmIDEgPT09IGYubm9kZVR5cGUpIHJldHVybiBmLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBhICYmICFzYS50ZXN0KGEpICYmICFjYVsocGEuZXhlYyhhKSB8fCBbIiIsICIiXSlbMV0udG9Mb3dlckNhc2UoKV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhLnJlcGxhY2UobmIsICI8JDE+PC8kMj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGMgPiBlOyBlKyspIGYgPSB0aGlzW2VdIHx8IHt9LCAxID09PSBmLm5vZGVUeXBlICYmICh0LmNsZWFuRGF0YShiKGYsICExKSksIGYuaW5uZXJIVE1MID0gYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGgpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZiAmJiB0aGlzLmVtcHR5KCkuYXBwZW5kKGEpCiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCwgYSwgYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXBsYWNlV2l0aDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0Lm1hcCh0aGlzLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2EubmV4dFNpYmxpbmcsIGEucGFyZW50Tm9kZV0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGFbYisrXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhW2IrK107CiAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYgKGUgJiYgZS5wYXJlbnROb2RlICE9PSBjICYmIChlID0gdGhpcy5uZXh0U2libGluZyksIHQodGhpcykucmVtb3ZlKCksIGMuaW5zZXJ0QmVmb3JlKGYsIGUpKQogICAgICAgICAgICAgICAgICAgIH0sICEwKSwgYiA/IHRoaXMgOiB0aGlzLnJlbW92ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGV0YWNoOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlKGEsICEwKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRvbU1hbmlwOiBmdW5jdGlvbihhLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IFIuYXBwbHkoW10sIGEpOwogICAgICAgICAgICAgICAgICAgIHZhciBjLCBoLCBtLCBkLCB3ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBuID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGwgLSAxLAogICAgICAgICAgICAgICAgICAgICAgICBxID0gYVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHQuaXNGdW5jdGlvbihxKTsKICAgICAgICAgICAgICAgICAgICBpZiAociB8fCAhKDEgPj0gbCB8fCAic3RyaW5nIiAhPSB0eXBlb2YgcSB8fCB0LnN1cHBvcnQuY2hlY2tDbG9uZSkgJiYgUGEudGVzdChxKSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gbi5lcShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgciAmJiAoYVswXSA9IHEuY2FsbCh0aGlzLCBiLCBjLmh0bWwoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjLmRvbU1hbmlwKGEsIGYsIGUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGwgJiYgKGMgPSB0LmJ1aWxkRnJhZ21lbnQoYSwgdGhpc1swXS5vd25lckRvY3VtZW50LCAhMSwgIWUgJiYgdGhpcyksIGggPSBjLmZpcnN0Q2hpbGQsIDEgPT09IGMuY2hpbGROb2Rlcy5sZW5ndGggJiYgKGMgPSBoKSwgaCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHQubWFwKGIoYywgInNjcmlwdCIpLCBtYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IGgubGVuZ3RoOyBsID4gdzsgdysrKSBkID0gYywgdyAhPT0gZyAmJiAoZCA9IHQuY2xvbmUoZCwgITAsICEwKSwgbSAmJiB0Lm1lcmdlKGgsIGIoZCwgInNjcmlwdCIpKSksIGYuY2FsbCh0aGlzW3ddLCBkLCB3KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSBoW2gubGVuZ3RoIC0gMV0ub3duZXJEb2N1bWVudCwgdC5tYXAoaCwgZmEpLCB3ID0gMDsgbSA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdzsgdysrKSBkID0gaFt3XSwgUWEudGVzdChkLnR5cGUgfHwgIiIpICYmICFVLmFjY2VzcyhkLCAiZ2xvYmFsRXZhbCIpICYmIHQuY29udGFpbnMoYywgZCkgJiYgKGQuc3JjID8gdC5fZXZhbFVybChkLnNyYykgOiB0Lmdsb2JhbEV2YWwoZC50ZXh0Q29udGVudC5yZXBsYWNlKGViLCAiIikpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5lYWNoKHsKICAgICAgICAgICAgICAgIGFwcGVuZFRvOiAiYXBwZW5kIiwKICAgICAgICAgICAgICAgIHByZXBlbmRUbzogInByZXBlbmQiLAogICAgICAgICAgICAgICAgaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwKICAgICAgICAgICAgICAgIGluc2VydEFmdGVyOiAiYWZ0ZXIiLAogICAgICAgICAgICAgICAgcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIgogICAgICAgICAgICB9LCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB0LmZuW2FdID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSBbXSwgZSA9IHQoYSksIGMgPSBlLmxlbmd0aCAtIDEsIGggPSAwOyBjID49IGg7IGgrKykgYSA9IGggPT09IGMgPyB0aGlzIDogdGhpcy5jbG9uZSghMCksIHQoZVtoXSlbYl0oYSksIEVhLmFwcGx5KGYsIGEuZ2V0KCkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhmKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5leHRlbmQoewogICAgICAgICAgICAgICAgY2xvbmU6IGZ1bmN0aW9uKGEsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCwgbSwgZCwgdyA9IGEuY2xvbmVOb2RlKCEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHQuY29udGFpbnMoYS5vd25lckRvY3VtZW50LCBhKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISh0LnN1cHBvcnQubm9DbG9uZUNoZWNrZWQgfHwgMSAhPT0gYS5ub2RlVHlwZSAmJiAxMSAhPT0gYS5ub2RlVHlwZSB8fCB0LmlzWE1MRG9jKGEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gYih3KSwgbSA9IGIoYSksIGMgPSAwLCBoID0gbS5sZW5ndGg7IGggPiBjOyBjKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbVtjXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZFtjXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gZy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0IiA9PT0gcSAmJiBvYi50ZXN0KG4udHlwZSkgPyBnLmNoZWNrZWQgPSBuLmNoZWNrZWQgOiAoImlucHV0IiA9PT0gcSB8fCAidGV4dGFyZWEiID09PSBxKSAmJiAoZy5kZWZhdWx0VmFsdWUgPSBuLmRlZmF1bHRWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChmKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IG0gfHwgYihhKSwgZCA9IGQgfHwgYih3KSwgYyA9IDAsIGggPSBtLmxlbmd0aDsgaCA+IGM7IGMrKykgVyhtW2NdLCBkW2NdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBXKGEsIHcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBkID0gYih3LCAic2NyaXB0IiksIDAgPCBkLmxlbmd0aCAmJiBhYShkLCAhbCAmJiBiKGEsICJzY3JpcHQiKSksIHcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBidWlsZEZyYWdtZW50OiBmdW5jdGlvbihhLCBmLCBlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaCwgbSwgZCwgdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAwLCBuID0gYS5sZW5ndGgsIGcgPSBmLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgcSA9IFtdOyBuID4gbDsgbCsrKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCA9IGFbbF0sIGggfHwgMCA9PT0gaCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PT0gdC50eXBlKGgpKSB0Lm1lcmdlKHEsIGgubm9kZVR5cGUgPyBbaF0gOiBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9hLnRlc3QoaCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbSA9IG0gfHwgZy5hcHBlbmRDaGlsZChmLmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IChwYS5leGVjKGgpIHx8IFsiIiwgIiJdKVsxXS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBkID0gY2FbZF0gfHwgY2EuX2RlZmF1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uaW5uZXJIVE1MID0gZFsxXSArIGgucmVwbGFjZShuYiwgIjwkMT48LyQyPiIpICsgZFsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gZFswXTsgZC0tOykgbSA9IG0ubGFzdENoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICB0Lm1lcmdlKHEsIG0uY2hpbGROb2Rlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBnLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIG0udGV4dENvbnRlbnQgPSAiIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBxLnB1c2goZi5jcmVhdGVUZXh0Tm9kZShoKSk7CiAgICAgICAgICAgICAgICAgICAgZy50ZXh0Q29udGVudCA9ICIiOwogICAgICAgICAgICAgICAgICAgIGZvciAobCA9IDA7IGggPSBxW2wrK107KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCFjIHx8IC0xID09PSB0LmluQXJyYXkoaCwgYykpICYmICh3ID0gdC5jb250YWlucyhoLm93bmVyRG9jdW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCksIG0gPSBiKGcuYXBwZW5kQ2hpbGQoaCksICJzY3JpcHQiKSwgdyAmJiBhYShtKSwgZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSAwOyBoID0gbVtkKytdOykgUWEudGVzdChoLnR5cGUgfHwgIiIpICYmIGUucHVzaChoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsZWFuRGF0YTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIsIGYsIGUsIGMsIGgsIG0sIGQgPSB0LmV2ZW50LnNwZWNpYWwsIHcgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAoZiA9IGFbd10pICE9PSBwOyB3KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuYWNjZXB0cyhmKSAmJiAoaCA9IGZbVS5leHBhbmRvXSwgaCAmJiAoYiA9IFUuY2FjaGVbaF0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBPYmplY3Qua2V5cyhiLmV2ZW50cyB8fCB7fSksIGUubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjID0gZVttXSkgIT09IHA7IG0rKykgZFtjXSA/IHQuZXZlbnQucmVtb3ZlKGYsIGMpIDogdC5yZW1vdmVFdmVudChmLCBjLCBiLmhhbmRsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVLmNhY2hlW2hdICYmIGRlbGV0ZSBVLmNhY2hlW2hdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIFouY2FjaGVbZltaLmV4cGFuZG9dXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZXZhbFVybDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogInNjcmlwdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgInRocm93cyI6ICEwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZm4uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHdyYXBBbGw6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5pc0Z1bmN0aW9uKGEpID8gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdCh0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLCBiKSkKICAgICAgICAgICAgICAgICAgICB9KSA6ICh0aGlzWzBdICYmIChiID0gdChhLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSwgdGhpc1swXS5wYXJlbnROb2RlICYmIGIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLCBiLm1hcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IHRoaXM7IGEuZmlyc3RFbGVtZW50Q2hpbGQ7KSBhID0gYS5maXJzdEVsZW1lbnRDaGlsZDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQodGhpcykpLCB0aGlzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHdyYXBJbm5lcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmlzRnVuY3Rpb24oYSkgPyB0aGlzLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB0KHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcywgYikpCiAgICAgICAgICAgICAgICAgICAgfSkgOiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdCh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBiLmNvbnRlbnRzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYubGVuZ3RoID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JhcEFsbChhKSA6IGIuYXBwZW5kKGEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3cmFwOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0LmlzRnVuY3Rpb24oYSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQodGhpcykud3JhcEFsbChiID8gYS5jYWxsKHRoaXMsIGYpIDogYSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHVud3JhcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5ub2RlTmFtZSh0aGlzLCAiYm9keSIpIHx8IHQodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKQogICAgICAgICAgICAgICAgICAgIH0pLmVuZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgZGEsIHFhLCBaYSA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywKICAgICAgICAgICAgICAgIFJhID0gL15tYXJnaW4vLAogICAgICAgICAgICAgICAgdmEgPSBSZWdFeHAoIl4oIiArIGVhICsgIikoLiopJCIsICJpIiksCiAgICAgICAgICAgICAgICBOYSA9IFJlZ0V4cCgiXigiICsgZWEgKyAiKSg/IXB4KVthLXolXSskIiwgImkiKSwKICAgICAgICAgICAgICAgIGZiID0gUmVnRXhwKCJeKFsrLV0pPSgiICsgZWEgKyAiKSIsICJpIiksCiAgICAgICAgICAgICAgICBYYSA9IHsKICAgICAgICAgICAgICAgICAgICBCT0RZOiAiYmxvY2siCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2IgPSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFNhID0gewogICAgICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmc6IDAsCiAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogNDAwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeWEgPSBbIlRvcCIsICJSaWdodCIsICJCb3R0b20iLCAiTGVmdCJdLAogICAgICAgICAgICAgICAgbGIgPSBbIldlYmtpdCIsICJPIiwgIk1veiIsICJtcyJdOwogICAgICAgICAgICB0LmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBjc3M6IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5hY2Nlc3ModGhpcywgZnVuY3Rpb24oYiwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LmlzQXJyYXkoZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBhLmdldENvbXB1dGVkU3R5bGUoYiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSBmLmxlbmd0aDsgYyA+IG07IG0rKykgaFtmW21dXSA9IHQuY3NzKGIsIGZbbV0sICExLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgIT09IHAgPyB0LnN0eWxlKGIsIGYsIGUpIDogdC5jc3MoYiwgZikKICAgICAgICAgICAgICAgICAgICB9LCBiLCBmLCAxIDwgYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZyh0aGlzLCAhMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZyh0aGlzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiYm9vbGVhbiIgPT0gdHlwZW9mIGEgPyBhID8gdGhpcy5zaG93KCkgOiB0aGlzLmhpZGUoKSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZCh0aGlzKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0KHRoaXMpLnNob3coKSA6IHQodGhpcykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGNzc0hvb2tzOiB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogewogICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkYShhLCAib3BhY2l0eSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIiA9PT0gZiA/ICIxIiA6IGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjc3NOdW1iZXI6IHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5Db3VudDogITAsCiAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6ICEwLAogICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICEwLAogICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICEwLAogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6ICEwLAogICAgICAgICAgICAgICAgICAgIG9yZGVyOiAhMCwKICAgICAgICAgICAgICAgICAgICBvcnBoYW5zOiAhMCwKICAgICAgICAgICAgICAgICAgICB3aWRvd3M6ICEwLAogICAgICAgICAgICAgICAgICAgIHpJbmRleDogITAsCiAgICAgICAgICAgICAgICAgICAgem9vbTogITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjc3NQcm9wczogewogICAgICAgICAgICAgICAgICAgICJmbG9hdCI6ICJjc3NGbG9hdCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdHlsZTogZnVuY3Rpb24oYSwgYiwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhICYmIDMgIT09IGEubm9kZVR5cGUgJiYgOCAhPT0gYS5ub2RlVHlwZSAmJiBhLnN0eWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoLCBtLCBkLCB3ID0gdC5jYW1lbENhc2UoYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5zdHlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPSB0LmNzc1Byb3BzW3ddIHx8ICh0LmNzc1Byb3BzW3ddID0gYyhsLCB3KSksIGQgPSB0LmNzc0hvb2tzW2JdIHx8IHQuY3NzSG9va3Nbd10sIGYgPT09IHAgPyBkICYmICJnZXQiIGluIGQgJiYgKGggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5nZXQoYSwgITEsIGUpKSAhPT0gcCA/IGggOiBsW2JdIDogKG0gPSB0eXBlb2YgZiwgInN0cmluZyIgPT09IG0gJiYgKGggPSBmYi5leGVjKGYpKSAmJiAoZiA9IChoWzFdICsgMSkgKiBoWzJdICsgcGFyc2VGbG9hdCh0LmNzcyhhLCBiKSksIG0gPSAibnVtYmVyIiksIG51bGwgPT0gZiB8fCAibnVtYmVyIiA9PT0gbSAmJiBpc05hTihmKSB8fCAoIm51bWJlciIgIT09IG0gfHwgdC5jc3NOdW1iZXJbd10gfHwgKGYgKz0gInB4IiksIHQuc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgfHwgIiIgIT09IGYgfHwgMCAhPT0gYi5pbmRleE9mKCJiYWNrZ3JvdW5kIikgfHwgKGxbYl0gPSAiaW5oZXJpdCIpLCBkICYmICJzZXQiIGluIGQgJiYgKGYgPSBkLnNldChhLCBmLCBlKSkgPT09IHAgfHwgKGxbYl0gPSBmKSksIHApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNzczogZnVuY3Rpb24oYSwgYiwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBoLCBtLCBkLCB3ID0gdC5jYW1lbENhc2UoYik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPSB0LmNzc1Byb3BzW3ddIHx8ICh0LmNzc1Byb3BzW3ddID0gYyhhLnN0eWxlLCB3KSksIGQgPSB0LmNzc0hvb2tzW2JdIHx8IHQuY3NzSG9va3Nbd10sIGQgJiYgImdldCIgaW4gZCAmJiAoaCA9IGQuZ2V0KGEsICEwLCBmKSksIGggPT09IHAgJiYgKGggPQogICAgICAgICAgICAgICAgICAgICAgICBkYShhLCBiLCBlKSksICJub3JtYWwiID09PSBoICYmIGIgaW4gU2EgJiYgKGggPSBTYVtiXSksICIiID09PSBmIHx8IGYgPyAobSA9IHBhcnNlRmxvYXQoaCksICEwID09PSBmIHx8IHQuaXNOdW1lcmljKG0pID8gbSB8fCAwIDogaCkgOiBoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkYSA9IGZ1bmN0aW9uKGIsIGYsIGUpIHsKICAgICAgICAgICAgICAgIHZhciBjLCBoLCBtLCBkID0gKGUgPSBlIHx8IGEuZ2V0Q29tcHV0ZWRTdHlsZShiLCBudWxsKSkgPyBlLmdldFByb3BlcnR5VmFsdWUoZikgfHwgZVtmXSA6IHAsCiAgICAgICAgICAgICAgICAgICAgdyA9IGIuc3R5bGU7CiAgICAgICAgICAgICAgICByZXR1cm4gZSAmJiAoIiIgIT09IGQgfHwgdC5jb250YWlucyhiLm93bmVyRG9jdW1lbnQsIGIpIHx8IChkID0gdC5zdHlsZShiLCBmKSksIE5hLnRlc3QoZCkgJiYgUmEudGVzdChmKSAmJiAoYyA9IHcud2lkdGgsIGggPSB3Lm1pbldpZHRoLCBtID0gdy5tYXhXaWR0aCwgdy5taW5XaWR0aCA9IHcubWF4V2lkdGggPSB3LndpZHRoID0gZCwgZCA9IGUud2lkdGgsIHcud2lkdGggPSBjLCB3Lm1pbldpZHRoID0gaCwgdy5tYXhXaWR0aCA9IG0pKSwgZAogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmVhY2goWyJoZWlnaHQiLCAid2lkdGgiXSwgZnVuY3Rpb24oYiwgZSkgewogICAgICAgICAgICAgICAgdC5jc3NIb29rc1tlXSA9IHsKICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gYS5vZmZzZXRXaWR0aCAmJiBaYS50ZXN0KHQuY3NzKGEsICJkaXNwbGF5IikpID8gdC5zd2FwKGEsIGdiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaChhLCBlLCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBoKGEsIGUsIGYpIDogcAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihiLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gaCAmJiBhLmdldENvbXB1dGVkU3R5bGUoYiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmKGIsIGMsIGggPyBtKGIsIGUsIGgsIHQuc3VwcG9ydC5ib3hTaXppbmcgJiYgImJvcmRlci1ib3giID09PSB0LmNzcyhiLCAiYm94U2l6aW5nIiwgITEsIGQpLCBkKSA6IDApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHQuc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0IHx8ICh0LmNzc0hvb2tzLm1hcmdpblJpZ2h0ID0gewogICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA/IHQuc3dhcChhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgICAgICAgICAgICAgICAgICB9LCBkYSwgW2EsICJtYXJnaW5SaWdodCJdKSA6IHAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICF0LnN1cHBvcnQucGl4ZWxQb3NpdGlvbiAmJiB0LmZuLnBvc2l0aW9uICYmIHQuZWFjaChbInRvcCIsICJsZWZ0Il0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB0LmNzc0hvb2tzW2JdID0gewogICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZiA/IChmID0gZGEoYSwgYiksIE5hLnRlc3QoZikgPyB0KGEpLnBvc2l0aW9uKClbYl0gKyAicHgiIDogZikgOiBwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5leHByICYmIHQuZXhwci5maWx0ZXJzICYmICh0LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMCA+PSBhLm9mZnNldFdpZHRoICYmIDAgPj0gYS5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfSwgdC5leHByLmZpbHRlcnMudmlzaWJsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhdC5leHByLmZpbHRlcnMuaGlkZGVuKGEpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmVhY2goewogICAgICAgICAgICAgICAgbWFyZ2luOiAiIiwKICAgICAgICAgICAgICAgIHBhZGRpbmc6ICIiLAogICAgICAgICAgICAgICAgYm9yZGVyOiAiV2lkdGgiCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHQuY3NzSG9va3NbYSArIGJdID0gewogICAgICAgICAgICAgICAgICAgIGV4cGFuZDogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9ICJzdHJpbmciID09IHR5cGVvZiBmID8gZi5zcGxpdCgiICIpIDogW2ZdOyA0ID4gZTsgZSsrKSBjW2EgKyB5YVtlXSArIGJdID0gZltlXSB8fCBmW2UgLSAyXSB8fCBmWzBdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBSYS50ZXN0KGEpIHx8ICh0LmNzc0hvb2tzW2EgKyBiXS5zZXQgPSBmKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGhiID0gLyUyMC9nLAogICAgICAgICAgICAgICAgeGIgPSAvXFtcXSQvLAogICAgICAgICAgICAgICAgcGIgPSAvXHI/XG4vZywKICAgICAgICAgICAgICAgIFRhID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAogICAgICAgICAgICAgICAgQmIgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7CiAgICAgICAgICAgIHQuZm4uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gdC5wcm9wKHRoaXMsICJlbGVtZW50cyIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA/IHQubWFrZUFycmF5KGEpIDogdGhpcwogICAgICAgICAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUgJiYgIXQodGhpcykuaXMoIjpkaXNhYmxlZCIpICYmIEJiLnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIVRhLnRlc3QoYSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhb2IudGVzdChhKSkKICAgICAgICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IHQodGhpcykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGYgPyBudWxsIDogdC5pc0FycmF5KGYpID8gdC5tYXAoZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBiLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLnJlcGxhY2UocGIsICJcclxuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGIubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmLnJlcGxhY2UocGIsICJcclxuIikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmdldCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LnBhcmFtID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGYsIGMgPSBbXSwKICAgICAgICAgICAgICAgICAgICBoID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICBiID0gdC5pc0Z1bmN0aW9uKGIpID8gYigpIDogbnVsbCA9PSBiID8gIiIgOiBiOwogICAgICAgICAgICAgICAgICAgICAgICBjW2MubGVuZ3RoXSA9IGVuY29kZVVSSUNvbXBvbmVudChhKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChiKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoYiA9PT0gcCAmJiAoYiA9IHQuYWpheFNldHRpbmdzICYmIHQuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKSwgdC5pc0FycmF5KGEpIHx8IGEuanF1ZXJ5ICYmICF0LmlzUGxhaW5PYmplY3QoYSkpIHQuZWFjaChhLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBoKHRoaXMubmFtZSwgdGhpcy52YWx1ZSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGZvciAoZiBpbiBhKSBlKGYsIGFbZl0sIGIsIGgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGMuam9pbigiJiIpLnJlcGxhY2UoaGIsICIrIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51Ii5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHQuZm5bYl0gPSBmdW5jdGlvbihhLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMub24oYiwgbnVsbCwgYSwgZikgOiB0aGlzLnRyaWdnZXIoYikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5mbi5leHRlbmQoewogICAgICAgICAgICAgICAgaG92ZXI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYiB8fCBhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJpbmQ6IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vbihhLCBudWxsLCBiLCBmKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHVuYmluZDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZihhLCBudWxsLCBiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbGVnYXRlOiBmdW5jdGlvbihhLCBiLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub24oYiwgYSwgZiwgZSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB1bmRlbGVnYXRlOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLm9mZihhLCAiKioiKSA6IHRoaXMub2ZmKGIsIGEgfHwgIioqIiwgZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBIYSwgQ2EsIGliID0gdC5ub3coKSwKICAgICAgICAgICAgICAgIGpiID0gL1w/LywKICAgICAgICAgICAgICAgIENiID0gLyMuKiQvLAogICAgICAgICAgICAgICAgcWIgPSAvKFs/Jl0pXz1bXiZdKi8sCiAgICAgICAgICAgICAgICBEYiA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sCiAgICAgICAgICAgICAgICBFYiA9IC9eKD86R0VUfEhFQUQpJC8sCiAgICAgICAgICAgICAgICBVYSA9IC9eXC9cLy8sCiAgICAgICAgICAgICAgICByYiA9IC9eKFtcdy4rLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKICAgICAgICAgICAgICAgIHNiID0gdC5mbi5sb2FkLAogICAgICAgICAgICAgICAgdGIgPSB7fSwKICAgICAgICAgICAgICAgIGJiID0ge30sCiAgICAgICAgICAgICAgICB1YiA9ICIqLyIuY29uY2F0KCIqIik7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBDYSA9IEUuaHJlZgogICAgICAgICAgICB9IGNhdGNoIChnYSkgewogICAgICAgICAgICAgICAgQ2EgPSBOLmNyZWF0ZUVsZW1lbnQoImEiKSwgQ2EuaHJlZiA9ICIiLCBDYSA9IENhLmhyZWYKICAgICAgICAgICAgfQogICAgICAgICAgICBIYSA9IHJiLmV4ZWMoQ2EudG9Mb3dlckNhc2UoKSkgfHwgW107CiAgICAgICAgICAgIHQuZm4ubG9hZCA9IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgYSAmJiBzYikgcmV0dXJuIHNiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICB2YXIgZSwgYywgaCwgbSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgZCA9IGEuaW5kZXhPZigiICIpOwogICAgICAgICAgICAgICAgcmV0dXJuIDAgPD0gZCAmJiAoZSA9IGEuc2xpY2UoZCksIGEgPSBhLnNsaWNlKDAsIGQpKSwgdC5pc0Z1bmN0aW9uKGIpID8gKGYgPSBiLCBiID0gcCkgOiBiICYmICJvYmplY3QiID09IHR5cGVvZiBiICYmIChjID0gIlBPU1QiKSwgMCA8IG0ubGVuZ3RoICYmIHQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBhLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IGMsCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJodG1sIiwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBiCiAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOwogICAgICAgICAgICAgICAgICAgIG0uaHRtbChlID8gdCgiPGRpdj4iKS5hcHBlbmQodC5wYXJzZUhUTUwoYSkpLmZpbmQoZSkgOiBhKQogICAgICAgICAgICAgICAgfSkuY29tcGxldGUoZiAmJiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgbS5lYWNoKGYsIGggfHwgW2EucmVzcG9uc2VUZXh0LCBiLCBhXSkKICAgICAgICAgICAgICAgIH0pLCB0aGlzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZWFjaCgiYWpheFN0YXJ0IGFqYXhTdG9wIGFqYXhDb21wbGV0ZSBhamF4RXJyb3IgYWpheFN1Y2Nlc3MgYWpheFNlbmQiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHQuZm5bYl0gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub24oYiwgYSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGFjdGl2ZTogMCwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDoge30sCiAgICAgICAgICAgICAgICBldGFnOiB7fSwKICAgICAgICAgICAgICAgIGFqYXhTZXR0aW5nczogewogICAgICAgICAgICAgICAgICAgIHVybDogQ2EsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgaXNMb2NhbDogL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8udGVzdChIYVsxXSksCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsOiAhMCwKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogITAsCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6ICEwLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICBhY2NlcHRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICIqIjogdWIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJ0ZXh0L3BsYWluIiwKICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogInRleHQvaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHhtbDogImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgeG1sOiAveG1sLywKICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogL2h0bWwvLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uOiAvanNvbi8KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlRmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHhtbDogInJlc3BvbnNlWE1MIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogInJlc3BvbnNlVGV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb246ICJyZXNwb25zZUpTT04iCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICIqIHRleHQiOiBTdHJpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IGh0bWwiOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgInRleHQganNvbiI6IHQucGFyc2VKU09OLAogICAgICAgICAgICAgICAgICAgICAgICAidGV4dCB4bWwiOiB0LnBhcnNlWE1MCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmbGF0T3B0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiAhMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhamF4U2V0dXA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA/IHIocihhLCB0LmFqYXhTZXR0aW5ncyksIGIpIDogcih0LmFqYXhTZXR0aW5ncywgYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhamF4UHJlZmlsdGVyOiBuKHRiKSwKICAgICAgICAgICAgICAgIGFqYXhUcmFuc3BvcnQ6IG4oYmIpLAogICAgICAgICAgICAgICAgYWpheDogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBiKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihhLCBiLCBtLCB3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuLCBCLCB6LCBDLCBFID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDIgIT09IEspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiBjbGVhclRpbWVvdXQoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSB3IHx8ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5yZWFkeVN0YXRlID0gMCA8IGEgPyA0IDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSAyMDAgPD0gYSAmJiAzMDAgPiBhIHx8IDMwNCA9PT0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgSCA9IEEsIFQsIGssIHYsIEcsIEYgPSB6LmNvbnRlbnRzLCBjYSA9IHouZGF0YVR5cGVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKiIgPT09IGNhWzBdOykgY2Euc2hpZnQoKSwgVCA9PT0gcCAmJiAoVCA9IHoubWltZVR5cGUgfHwgSC5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgaW4gRikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChGW2tdICYmIEZba10udGVzdChUKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhLnVuc2hpZnQoayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FbMF0gaW4gbSkgdiA9IGNhWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgaW4gbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYVswXSB8fCB6LmNvbnZlcnRlcnNbayArICIgIiArIGNhWzBdXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHIHx8IChHID0gaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdiB8fCBHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSB2ID8gKHYgIT09IGNhWzBdICYmIGNhLnVuc2hpZnQodiksIG1bdl0pIDogcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGc7VCA9IHo7ayA9IEE7diA9IHc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIE4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwsIGRhO3ogPSB7fTtIID0gbS5kYXRhVHlwZXMuc2xpY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSFsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChOIGluIG0uY29udmVydGVycykgeltOLnRvTG93ZXJDYXNlKCldID0gbS5jb252ZXJ0ZXJzW05dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoRyA9IEguc2hpZnQoKTsgRzspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtLnJlc3BvbnNlRmllbGRzW0ddICYmIChrW20ucmVzcG9uc2VGaWVsZHNbR11dID0gVCksICFkYSAmJiB2ICYmIG0uZGF0YUZpbHRlciAmJiAoVCA9IG0uZGF0YUZpbHRlcihULCBtLmRhdGFUeXBlKSksIGRhID0gRywgRyA9IEguc2hpZnQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiKiIgPT09IEcpIEcgPSBkYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCIqIiAhPT0gZGEgJiYgZGEgIT09IEcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE4gPSB6W2RhICsgIiAiICsgR10gfHwgelsiKiAiICsgR10sICFOKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChKIGluIHopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEwgPSBKLnNwbGl0KCIgIiksIExbMV0gPT09IEcgJiYgKE4gPSB6W2RhICsgIiAiICsgTFswXV0gfHwgelsiKiAiICsgTFswXV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBOID8gTiA9IHpbSl0gOiAhMCAhPT0geltKXSAmJiAoRyA9IExbMF0sIEgudW5zaGlmdChMWzFdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgIT09IE4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTiAmJiBtWyJ0aHJvd3MiXSkgVCA9IE4oVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVCA9IE4oVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGdhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJwYXJzZXJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBOID8gZ2EgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBkYSArICIgdG8gIiArIEcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogVAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSBKOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA/IChnLmlmTW9kaWZpZWQgJiYgKEMgPSBBLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIiksIEMgJiYgKHQubGFzdE1vZGlmaWVkW2NdID0gQyksIEMgPSBBLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIiksIEMgJiYgKHQuZXRhZ1tjXSA9IEMpKSwgMjA0ID09PSBhIHx8ICJIRUFEIiA9PT0gZy50eXBlID8gRSA9ICJub2NvbnRlbnQiIDogMzA0ID09PSBhID8gRSA9ICJub3Rtb2RpZmllZCIgOiAoRSA9IHouc3RhdGUsIG4gPSB6LmRhdGEsIEIgPSB6LmVycm9yLCB3ID0gIUIpKSA6IChCID0gRSwgKGEgfHwgIUUpICYmIChFID0gImVycm9yIiwgMCA+IGEgJiYgKGEgPSAwKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5zdGF0dXMgPSBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5zdGF0dXNUZXh0ID0gKGIgfHwgRSkgKyAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPyB1LnJlc29sdmVXaXRoKHEsIFtuLCBFLCBBXSkgOiB1LnJlamVjdFdpdGgocSwgW0EsIEUsIEJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEuc3RhdHVzQ29kZSh5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCAmJiByLnRyaWdnZXIodyA/ICJhamF4U3VjY2VzcyIgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhamF4RXJyb3IiLCBbQSwgZywgdyA/IG4gOiBCXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LmZpcmVXaXRoKHEsIFtBLCBFXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsICYmIChyLnRyaWdnZXIoImFqYXhDb21wbGV0ZSIsIFtBLCBnXSksIC0tdC5hY3RpdmUgfHwgdC5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBhICYmIChiID0gYSwgYSA9IHApOwogICAgICAgICAgICAgICAgICAgIGIgPSBiIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjLCBoLCBtLCBkLCB3LCBsLCBuLCBnID0gdC5hamF4U2V0dXAoe30sIGIpLAogICAgICAgICAgICAgICAgICAgICAgICBxID0gZy5jb250ZXh0IHx8IGcsCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBnLmNvbnRleHQgJiYgKHEubm9kZVR5cGUgfHwgcS5qcXVlcnkpID8gdChxKSA6IHQuZXZlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSB0LkRlZmVycmVkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHggPSB0LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGcuc3RhdHVzQ29kZSB8fCB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgeiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBDID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBFID0gImNhbmNlbGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgQSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWR5U3RhdGU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgyID09PSBLKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IHt9OyBiID0gRGIuZXhlYyhoKTspIG1bYlsxXS50b0xvd2VyQ2FzZSgpXSA9IGJbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBtW2EudG9Mb3dlckNhc2UoKV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA/IG51bGwgOiBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMiA9PT0gSyA/IGggOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVxdWVzdEhlYWRlcjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBLIHx8IChhID0gQ1tmXSA9IENbZl0gfHwgYSwgelthXSA9IGIpLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBLIHx8IChnLm1pbWVUeXBlID0gYSksIHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgyID4gSykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiBpbiBhKSB5W2JdID0gW3lbYl0sIGFbYl1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIEEuYWx3YXlzKGFbQS5zdGF0dXNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEgfHwgRTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSAmJiBlLmFib3J0KGEpLCBmKDAsIGEpLCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKHUucHJvbWlzZShBKS5jb21wbGV0ZSA9IHguYWRkLCBBLnN1Y2Nlc3MgPSBBLmRvbmUsIEEuZXJyb3IgPSBBLmZhaWwsIGcudXJsID0gKChhIHx8IGcudXJsIHx8IENhKSArICIiKS5yZXBsYWNlKENiLCAiIikucmVwbGFjZShVYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhWzFdICsgIi8vIiksIGcudHlwZSA9IGIubWV0aG9kIHx8IGIudHlwZSB8fCBnLm1ldGhvZCB8fCBnLnR5cGUsIGcuZGF0YVR5cGVzID0gdC50cmltKGcuZGF0YVR5cGUgfHwgIioiKS50b0xvd2VyQ2FzZSgpLm1hdGNoKGlhKSB8fCBbIiJdLCBudWxsID09IGcuY3Jvc3NEb21haW4gJiYgKHcgPSByYi5leGVjKGcudXJsLnRvTG93ZXJDYXNlKCkpLCBnLmNyb3NzRG9tYWluID0gISghdyB8fCB3WzFdID09PSBIYVsxXSAmJiB3WzJdID09PSBIYVsyXSAmJiAod1szXSB8fCAoImh0dHA6IiA9PT0gd1sxXSA/ICI4MCIgOiAiNDQzIikpID09PSAoSGFbM10gfHwgKCJodHRwOiIgPT09IEhhWzFdID8gIjgwIiA6ICI0NDMiKSkpKSwgZy5kYXRhICYmIGcucHJvY2Vzc0RhdGEgJiYgInN0cmluZyIgIT0gdHlwZW9mIGcuZGF0YSAmJiAoZy5kYXRhID0gdC5wYXJhbShnLmRhdGEsIGcudHJhZGl0aW9uYWwpKSwgQih0YiwgZywgYiwgQSksIDIgPT09IEspIHJldHVybiBBOwogICAgICAgICAgICAgICAgICAgIChsID0gZy5nbG9iYWwpICYmIDAgPT09IHQuYWN0aXZlKysgJiYgdC5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKTsKICAgICAgICAgICAgICAgICAgICBnLnR5cGUgPSBnLnR5cGUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBnLmhhc0NvbnRlbnQgPSAhRWIudGVzdChnLnR5cGUpOwogICAgICAgICAgICAgICAgICAgIGMgPSBnLnVybDsKICAgICAgICAgICAgICAgICAgICBnLmhhc0NvbnRlbnQgfHwgKGcuZGF0YSAmJiAoYyA9IGcudXJsICs9IChqYi50ZXN0KGMpID8gIiYiIDogIj8iKSArIGcuZGF0YSwgZGVsZXRlIGcuZGF0YSksICExID09PSBnLmNhY2hlICYmIChnLnVybCA9IHFiLnRlc3QoYykgPyBjLnJlcGxhY2UocWIsICIkMV89IiArIGliKyspIDogYyArIChqYi50ZXN0KGMpID8gIiYiIDogIj8iKSArICJfPSIgKyBpYisrKSk7CiAgICAgICAgICAgICAgICAgICAgZy5pZk1vZGlmaWVkICYmICh0Lmxhc3RNb2RpZmllZFtjXSAmJiBBLnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIiwgdC5sYXN0TW9kaWZpZWRbY10pLCB0LmV0YWdbY10gJiYgQS5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Ob25lLU1hdGNoIiwgdC5ldGFnW2NdKSk7CiAgICAgICAgICAgICAgICAgICAgKGcuZGF0YSAmJiBnLmhhc0NvbnRlbnQgJiYgITEgIT09IGcuY29udGVudFR5cGUgfHwgYi5jb250ZW50VHlwZSkgJiYgQS5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCBnLmNvbnRlbnRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBBLnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsIGcuZGF0YVR5cGVzWzBdICYmIGcuYWNjZXB0c1tnLmRhdGFUeXBlc1swXV0gPwogICAgICAgICAgICAgICAgICAgICAgICBnLmFjY2VwdHNbZy5kYXRhVHlwZXNbMF1dICsgKCIqIiAhPT0gZy5kYXRhVHlwZXNbMF0gPyAiLCAiICsgdWIgKyAiOyBxPTAuMDEiIDogIiIpIDogZy5hY2NlcHRzWyIqIl0pOwogICAgICAgICAgICAgICAgICAgIGZvciAobiBpbiBnLmhlYWRlcnMpIEEuc2V0UmVxdWVzdEhlYWRlcihuLCBnLmhlYWRlcnNbbl0pOwogICAgICAgICAgICAgICAgICAgIGlmIChnLmJlZm9yZVNlbmQgJiYgKCExID09PSBnLmJlZm9yZVNlbmQuY2FsbChxLCBBLCBnKSB8fCAyID09PSBLKSkgcmV0dXJuIEEuYWJvcnQoKTsKICAgICAgICAgICAgICAgICAgICBFID0gImFib3J0IjsKICAgICAgICAgICAgICAgICAgICBmb3IgKG4gaW4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfSkgQVtuXShnW25dKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IEIoYmIsIGcsIGIsIEEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEEucmVhZHlTdGF0ZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgJiYgci50cmlnZ2VyKCJhamF4U2VuZCIsIFtBLCBnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGcuYXN5bmMgJiYgMCA8IGcudGltZW91dCAmJiAoZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBLmFib3J0KCJ0aW1lb3V0IikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZy50aW1lb3V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gMSwgZS5zZW5kKHosIGYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKDIgPiBLKSkgdGhyb3cgSDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYoLTEsIEgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZigtMSwgIk5vIFRyYW5zcG9ydCIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBBCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0SlNPTjogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmdldChhLCBiLCBmLCAianNvbiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0U2NyaXB0OiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZ2V0KGEsIHAsIGIsICJzY3JpcHQiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5lYWNoKFsiZ2V0IiwgInBvc3QiXSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdFtiXSA9IGZ1bmN0aW9uKGEsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5pc0Z1bmN0aW9uKGYpICYmIChjID0gYyB8fCBlLCBlID0gZiwgZiA9IHApLCB0LmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBjLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmLAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBlCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuYWpheFNldHVwKHsKICAgICAgICAgICAgICAgIGFjY2VwdHM6IHsKICAgICAgICAgICAgICAgICAgICBzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50czogewogICAgICAgICAgICAgICAgICAgIHNjcmlwdDogLyg/OmphdmF8ZWNtYSlzY3JpcHQvCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udmVydGVyczogewogICAgICAgICAgICAgICAgICAgICJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZ2xvYmFsRXZhbChhKSwgYQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuYWpheFByZWZpbHRlcigic2NyaXB0IiwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBhLmNhY2hlID09PSBwICYmIChhLmNhY2hlID0gITEpOwogICAgICAgICAgICAgICAgICAgIGEuY3Jvc3NEb21haW4gJiYgKGEudHlwZSA9ICJHRVQiKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuYWpheFRyYW5zcG9ydCgic2NyaXB0IiwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgaWYgKGEuY3Jvc3NEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kOiBmdW5jdGlvbihlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gdCgiPHNjcmlwdD4iKS5wcm9wKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNldDogYS5zY3JpcHRDaGFyc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogYS51cmwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLm9uKCJsb2FkIGVycm9yIiwgZiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgJiYgYygiZXJyb3IiID09PSBhLnR5cGUgPyA0MDQgOiAyMDAsIGEudHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTi5oZWFkLmFwcGVuZENoaWxkKGJbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgJiYgZigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgdmIgPSBbXSwKICAgICAgICAgICAgICAgIGtiID0gLyg9KVw/KD89JnwkKXxcP1w/LzsKICAgICAgICAgICAgdC5hamF4U2V0dXAoewogICAgICAgICAgICAgICAganNvbnA6ICJjYWxsYmFjayIsCiAgICAgICAgICAgICAgICBqc29ucENhbGxiYWNrOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHZiLnBvcCgpIHx8IHQuZXhwYW5kbyArICJfIiArIGliKys7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbYV0gPSAhMCwgYQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5hamF4UHJlZmlsdGVyKCJqc29uIGpzb25wIiwgZnVuY3Rpb24oYiwgZiwgZSkgewogICAgICAgICAgICAgICAgdmFyIGMsIGgsIG0sIGQgPSAhMSAhPT0gYi5qc29ucCAmJiAoa2IudGVzdChiLnVybCkgPyAidXJsIiA6ICJzdHJpbmciID09IHR5cGVvZiBiLmRhdGEgJiYgIShiLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiBrYi50ZXN0KGIuZGF0YSkgJiYgImRhdGEiKTsKICAgICAgICAgICAgICAgIHJldHVybiBkIHx8ICJqc29ucCIgPT09IGIuZGF0YVR5cGVzWzBdID8gKGMgPSBiLmpzb25wQ2FsbGJhY2sgPSB0LmlzRnVuY3Rpb24oYi5qc29ucENhbGxiYWNrKSA/IGIuanNvbnBDYWxsYmFjaygpIDogYi5qc29ucENhbGxiYWNrLCBkID8gYltkXSA9IGJbZF0ucmVwbGFjZShrYiwgIiQxIiArIGMpIDogITEgIT09IGIuanNvbnAgJiYgKGIudXJsICs9IChqYi50ZXN0KGIudXJsKSA/ICImIiA6ICI/IikgKyBiLmpzb25wICsgIj0iICsgYyksIGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtIHx8IHQuZXJyb3IoYyArICIgd2FzIG5vdCBjYWxsZWQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgbVswXQogICAgICAgICAgICAgICAgfSwgYi5kYXRhVHlwZXNbMF0gPSAianNvbiIsIGggPSBhW2NdLCBhW2NdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgbSA9IGFyZ3VtZW50cwogICAgICAgICAgICAgICAgfSwgZS5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgYVtjXSA9IGg7CiAgICAgICAgICAgICAgICAgICAgYltjXSAmJiAoYi5qc29ucENhbGxiYWNrID0gZi5qc29ucENhbGxiYWNrLCB2Yi5wdXNoKGMpKTsKICAgICAgICAgICAgICAgICAgICBtICYmIHQuaXNGdW5jdGlvbihoKSAmJiBoKG1bMF0pOwogICAgICAgICAgICAgICAgICAgIG0gPSBoID0gcAogICAgICAgICAgICAgICAgfSksICJzY3JpcHQiKSA6IHAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuYWpheFNldHRpbmdzLnhociA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0CiAgICAgICAgICAgICAgICB9IGNhdGNoIChhKSB7fQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgVmEgPSB0LmFqYXhTZXR0aW5ncy54aHIoKSwKICAgICAgICAgICAgICAgIEZiID0gewogICAgICAgICAgICAgICAgICAgIDA6IDIwMCwKICAgICAgICAgICAgICAgICAgICAxMjIzOiAyMDQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBHYiA9IDAsCiAgICAgICAgICAgICAgICBXYSA9IHt9OwogICAgICAgICAgICBhLkFjdGl2ZVhPYmplY3QgJiYgdChhKS5vbigidW5sb2FkIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBhIGluIFdhKSBXYVthXSgpOwogICAgICAgICAgICAgICAgV2EgPSBwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LnN1cHBvcnQuY29ycyA9ICEhVmEgJiYgIndpdGhDcmVkZW50aWFscyIgaW4gVmE7CiAgICAgICAgICAgIHQuc3VwcG9ydC5hamF4ID0gVmEgPSAhIVZhOwogICAgICAgICAgICB0LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5zdXBwb3J0LmNvcnMgfHwKICAgICAgICAgICAgICAgICAgICBWYSAmJiAhYS5jcm9zc0RvbWFpbiA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24oZiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGgsIG0gPSBhLnhocigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0ub3BlbihhLnR5cGUsIGEudXJsLCBhLmFzeW5jLCBhLnVzZXJuYW1lLCBhLnBhc3N3b3JkKSwgYS54aHJGaWVsZHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGEueGhyRmllbGRzKSBtW2NdID0gYS54aHJGaWVsZHNbY107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLm1pbWVUeXBlICYmIG0ub3ZlcnJpZGVNaW1lVHlwZSAmJiBtLm92ZXJyaWRlTWltZVR5cGUoYS5taW1lVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNyb3NzRG9tYWluIHx8IGZbIlgtUmVxdWVzdGVkLVdpdGgiXSB8fCAoZlsiWC1SZXF1ZXN0ZWQtV2l0aCJdID0gIlhNTEh0dHBSZXF1ZXN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgaW4gZikgbS5zZXRSZXF1ZXN0SGVhZGVyKGMsIGZbY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgKGRlbGV0ZSBXYVtoXSwgYiA9IG0ub25sb2FkID0gbS5vbmVycm9yID0gbnVsbCwgImFib3J0IiA9PT0gYSA/IG0uYWJvcnQoKSA6ICJlcnJvciIgPT09IGEgPyBlKG0uc3RhdHVzIHx8IDQwNCwgbS5zdGF0dXNUZXh0KSA6IGUoRmJbbS5zdGF0dXNdIHx8IG0uc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5zdGF0dXNUZXh0LCAic3RyaW5nIiA9PSB0eXBlb2YgbS5yZXNwb25zZVRleHQgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbS5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBwLCBtLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5vbmxvYWQgPSBiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLm9uZXJyb3IgPSBiKCJlcnJvciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IFdhW2ggPSBHYisrXSA9IGIoImFib3J0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNlbmQoYS5oYXNDb250ZW50ICYmIGEuZGF0YSB8fCBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICYmIGIoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSA6IHAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBJYSwgJGEsIEhiID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAogICAgICAgICAgICAgICAgd2IgPSBSZWdFeHAoIl4oPzooWystXSk9fCkoIiArIGVhICsgIikoW2EteiVdKikkIiwgImkiKSwKICAgICAgICAgICAgICAgIEliID0gL3F1ZXVlSG9va3MkLywKICAgICAgICAgICAgICAgIFlhID0gW2Z1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSwgYywgaCwgbSwgdywgbCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIG4gPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEuc3R5bGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBhLm5vZGVUeXBlICYmIGQoYSksCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBVLmdldChhLCAiZnhzaG93Iik7CiAgICAgICAgICAgICAgICAgICAgZi5xdWV1ZSB8fCAobSA9IHQuX3F1ZXVlSG9va3MoYSwgImZ4IiksIG51bGwgPT0gbS51bnF1ZXVlZCAmJiAobS51bnF1ZXVlZCA9IDAsIHcgPSBtLmVtcHR5LmZpcmUsCiAgICAgICAgICAgICAgICAgICAgICAgIG0uZW1wdHkuZmlyZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS51bnF1ZXVlZCB8fCB3KCkKICAgICAgICAgICAgICAgICAgICAgICAgfSksIG0udW5xdWV1ZWQrKywgbC5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGwuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS51bnF1ZXVlZC0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5xdWV1ZShhLCAiZngiKS5sZW5ndGggfHwgbS5lbXB0eS5maXJlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgMSA9PT0gYS5ub2RlVHlwZSAmJiAoImhlaWdodCIgaW4gYiB8fCAid2lkdGgiIGluIGIpICYmIChmLm92ZXJmbG93ID0gW2cub3ZlcmZsb3csIGcub3ZlcmZsb3dYLCBnLm92ZXJmbG93WV0sICJpbmxpbmUiID09PSB0LmNzcyhhLCAiZGlzcGxheSIpICYmICJub25lIiA9PT0gdC5jc3MoYSwgImZsb2F0IikgJiYgKGcuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSk7CiAgICAgICAgICAgICAgICAgICAgZi5vdmVyZmxvdyAmJiAoZy5vdmVyZmxvdyA9ICJoaWRkZW4iLCBsLmFsd2F5cyhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZy5vdmVyZmxvdyA9IGYub3ZlcmZsb3dbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIGcub3ZlcmZsb3dYID0gZi5vdmVyZmxvd1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgZy5vdmVyZmxvd1kgPSBmLm92ZXJmbG93WzJdCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIGZvciAoZSBpbiBiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IGJbZV0sIEhiLmV4ZWMoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGUgYltlXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gaCB8fCAidG9nZ2xlIiA9PT0gYywgYyA9PT0gKHEgPyAiaGlkZSIgOiAic2hvdyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJzaG93IiAhPT0gYyB8fCAhciB8fCByW2VdID09PSBwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5bZV0gPSByICYmIHJbZV0gfHwgdC5zdHlsZShhLCBlKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmlzRW1wdHlPYmplY3QobikpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSBpbiByID8gImhpZGRlbiIgaW4gciAmJiAocSA9IHIuaGlkZGVuKSA6IHIgPSBVLmFjY2VzcyhhLCAiZnhzaG93Iiwge30pLCBoICYmIChyLmhpZGRlbiA9ICFxKSwgcSA/IHQoYSkuc2hvdygpIDogbC5kb25lKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQoYSkuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgbC5kb25lKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFUucmVtb3ZlKGEsICJmeHNob3ciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgaW4gbikgdC5zdHlsZShhLCBiLCBuW2JdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIG4pIGIgPSB1KHEgPyByW2VdIDogMCwgZSwgbCksIGUgaW4gciB8fCAocltlXSA9IGIuc3RhcnQsIHEgJiYgKGIuZW5kID0gYi5zdGFydCwgYi5zdGFydCA9ICJ3aWR0aCIgPT09IGUgfHwgImhlaWdodCIgPT09IGUgPyAxIDogMCkpCiAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIE9hID0gewogICAgICAgICAgICAgICAgICAgICIqIjogW2Z1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzLmNyZWF0ZVR3ZWVuKGEsIGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGYuY3VyKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdiLmV4ZWMoYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYyAmJiBjWzNdIHx8ICh0LmNzc051bWJlclthXSA/ICIiIDogInB4IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gKHQuY3NzTnVtYmVyW2FdIHx8ICJweCIgIT09IGggJiYgK2UpICYmIHdiLmV4ZWModC5jc3MoZi5lbGVtLCBhKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSAyMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0gJiYgbVszXSAhPT0gaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGggfHwgbVszXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBjIHx8IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICtlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBkID0gZCB8fCAiLjUiLCBtIC89IGQsIHQuc3R5bGUoZi5lbGVtLCBhLCBtICsgaCk7IHdoaWxlIChkICE9PSAoZCA9IGYuY3VyKCkgLyBlKSAmJiAxICE9PSBkICYmIC0tdykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyAmJiAobSA9IGYuc3RhcnQgPSArbSB8fCArZSB8fCAwLCBmLnVuaXQgPSBoLCBmLmVuZCA9IGNbMV0gPyBtICsgKGNbMV0gKyAxKSAqIGNbMl0gOiArY1syXSksIGYKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5BbmltYXRpb24gPSB0LmV4dGVuZCh6LCB7CiAgICAgICAgICAgICAgICB0d2VlbmVyOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdC5pc0Z1bmN0aW9uKGEpID8gKGIgPSBhLCBhID0gWyIqIl0pIDogYSA9IGEuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmLCBlID0gMCwgYyA9IGEubGVuZ3RoOyBjID4gZTsgZSsrKSBmID0gYVtlXSwgT2FbZl0gPSBPYVtmXSB8fCBbXSwgT2FbZl0udW5zaGlmdChiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByZWZpbHRlcjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgIGIgPwogICAgICAgICAgICAgICAgICAgICAgICBZYS51bnNoaWZ0KGEpIDogWWEucHVzaChhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5Ud2VlbiA9IEs7CiAgICAgICAgICAgIEsucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgY29uc3RydWN0b3I6IEssCiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihhLCBiLCBmLCBlLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtID0gYTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3AgPSBmOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWFzaW5nID0gYyB8fCAic3dpbmciOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydCA9IHRoaXMubm93ID0gdGhpcy5jdXIoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZCA9IGU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51bml0ID0gaCB8fCAodC5jc3NOdW1iZXJbZl0gPyAiIiA6ICJweCIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY3VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IEsucHJvcEhvb2tzW3RoaXMucHJvcF07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgJiYgYS5nZXQgPyBhLmdldCh0aGlzKSA6IEsucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBmID0gSy5wcm9wSG9va3NbdGhpcy5wcm9wXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wb3MgPSBiID0gdGhpcy5vcHRpb25zLmR1cmF0aW9uID8gdC5lYXNpbmdbdGhpcy5lYXNpbmddKGEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIGEsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbikgOgogICAgICAgICAgICAgICAgICAgICAgICBhLCB0aGlzLm5vdyA9ICh0aGlzLmVuZCAtIHRoaXMuc3RhcnQpICogYiArIHRoaXMuc3RhcnQsIHRoaXMub3B0aW9ucy5zdGVwICYmIHRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLCB0aGlzLm5vdywgdGhpcyksIGYgJiYgZi5zZXQgPyBmLnNldCh0aGlzKSA6IEsucHJvcEhvb2tzLl9kZWZhdWx0LnNldCh0aGlzKSwgdGhpcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBLLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IEsucHJvdG90eXBlOwogICAgICAgICAgICBLLnByb3BIb29rcyA9IHsKICAgICAgICAgICAgICAgIF9kZWZhdWx0OiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhLmVsZW1bYS5wcm9wXSB8fCBhLmVsZW0uc3R5bGUgJiYgbnVsbCAhPSBhLmVsZW0uc3R5bGVbYS5wcm9wXSA/IChiID0gdC5jc3MoYS5lbGVtLCBhLnByb3AsICIiKSwgYiAmJiAiYXV0byIgIT09IGIgPyBiIDogMCkgOiBhLmVsZW1bYS5wcm9wXQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuZnguc3RlcFthLnByb3BdID8gdC5meC5zdGVwW2EucHJvcF0oYSkgOiBhLmVsZW0uc3R5bGUgJiYgKG51bGwgIT0gYS5lbGVtLnN0eWxlW3QuY3NzUHJvcHNbYS5wcm9wXV0gfHwgdC5jc3NIb29rc1thLnByb3BdKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN0eWxlKGEuZWxlbSwgYS5wcm9wLCBhLm5vdyArIGEudW5pdCkgOiBhLmVsZW1bYS5wcm9wXSA9IGEubm93CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBLLnByb3BIb29rcy5zY3JvbGxUb3AgPSBLLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYS5lbGVtLm5vZGVUeXBlICYmIGEuZWxlbS5wYXJlbnROb2RlICYmIChhLmVsZW1bYS5wcm9wXSA9IGEubm93KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmVhY2goWyJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIl0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBmID0gdC5mbltiXTsKICAgICAgICAgICAgICAgIHQuZm5bYl0gPSBmdW5jdGlvbihhLCBlLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gYSB8fCAiYm9vbGVhbiIgPT0gdHlwZW9mIGEgPyBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiB0aGlzLmFuaW1hdGUoQyhiLCAhMCksIGEsIGUsIGMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBmYWRlVG86IGZ1bmN0aW9uKGEsIGIsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZCkuY3NzKCJvcGFjaXR5IiwgMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBiCiAgICAgICAgICAgICAgICAgICAgfSwgYSwgZiwgZSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhbmltYXRlOiBmdW5jdGlvbihhLCBiLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICB0LmlzRW1wdHlPYmplY3QoYSksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0LnNwZWVkKGIsIGYsIGUpOwogICAgICAgICAgICAgICAgICAgIGIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB6KHRoaXMsIHQuZXh0ZW5kKHt9LCBhKSwgaCk7CiAgICAgICAgICAgICAgICAgICAgICAgIChjIHx8IFUuZ2V0KHRoaXMsICJmaW5pc2giKSkgJiYgYi5zdG9wKCEwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuZmluaXNoID0gYiwgYyB8fCAhMSA9PT0gaC5xdWV1ZSA/IHRoaXMuZWFjaChiKSA6IHRoaXMucXVldWUoaC5xdWV1ZSwgYikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5zdG9wOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYS5zdG9wOwogICAgICAgICAgICAgICAgICAgICAgICBiKGYpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIGEgJiYgKGYgPSBiLCBiID0gYSwgYSA9IHApLCBiICYmICExICE9PSBhICYmIHRoaXMucXVldWUoYSB8fCAiZngiLCBbXSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBudWxsICE9IGEgJiYgYSArICJxdWV1ZUhvb2tzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0LnRpbWVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBVLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIG1bY10gJiYgbVtjXS5zdG9wICYmIGUobVtjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBtKSBtW2NdICYmIG1bY10uc3RvcCAmJiBJYi50ZXN0KGMpICYmIGUobVtjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmxlbmd0aDsgYy0tOykgaFtjXS5lbGVtICE9PSB0aGlzIHx8IG51bGwgIT0gYSAmJiBoW2NdLnF1ZXVlICE9PSBhIHx8IChoW2NdLmFuaW0uc3RvcChmKSwgYiA9ICExLCBoLnNwbGljZShjLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICFiICYmIGYgfHwgdC5kZXF1ZXVlKHRoaXMsIGEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEgIT09IGEgJiYgKGEgPSBhIHx8ICJmeCIpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBmID0gVS5nZXQodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gZlthICsgInF1ZXVlIl07CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBmW2EgKyAicXVldWVIb29rcyJdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHQudGltZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGUgPyBlLmxlbmd0aCA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGYuZmluaXNoID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgIHQucXVldWUodGhpcywgYSwgW10pOwogICAgICAgICAgICAgICAgICAgICAgICBiICYmIGIuc3RvcCAmJiBiLnN0b3AuY2FsbCh0aGlzLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IGMubGVuZ3RoOyBiLS07KSBjW2JdLmVsZW0gPT09IHRoaXMgJiYgY1tiXS5xdWV1ZSA9PT0gYSAmJiAoY1tiXS5hbmltLnN0b3AoITApLCBjLnNwbGljZShiLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IGggPiBiOyBiKyspIGVbYl0gJiYgZVtiXS5maW5pc2ggJiYgZVtiXS5maW5pc2guY2FsbCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGYuZmluaXNoCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZWFjaCh7CiAgICAgICAgICAgICAgICBzbGlkZURvd246IEMoInNob3ciKSwKICAgICAgICAgICAgICAgIHNsaWRlVXA6IEMoImhpZGUiKSwKICAgICAgICAgICAgICAgIHNsaWRlVG9nZ2xlOiBDKCJ0b2dnbGUiKSwKICAgICAgICAgICAgICAgIGZhZGVJbjogewogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6ICJzaG93IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZhZGVPdXQ6IHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAiaGlkZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmYWRlVG9nZ2xlOiB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogInRvZ2dsZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdC5mblthXSA9IGZ1bmN0aW9uKGEsIGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlKGIsIGEsIGYsIGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LnNwZWVkID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgdmFyIGUgPSBhICYmICJvYmplY3QiID09IHR5cGVvZiBhID8gdC5leHRlbmQoe30sIGEpIDogewogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmIHx8ICFmICYmIGIgfHwgdC5pc0Z1bmN0aW9uKGEpICYmIGEsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGEsCiAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiBmICYmIGIgfHwgYiAmJiAhdC5pc0Z1bmN0aW9uKGIpICYmIGIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gZS5kdXJhdGlvbiA9IHQuZngub2ZmID8gMCA6ICJudW1iZXIiID09IHR5cGVvZiBlLmR1cmF0aW9uID8gZS5kdXJhdGlvbiA6IGUuZHVyYXRpb24gaW4gdC5meC5zcGVlZHMgPyB0LmZ4LnNwZWVkc1tlLmR1cmF0aW9uXSA6IHQuZnguc3BlZWRzLl9kZWZhdWx0LAogICAgICAgICAgICAgICAgICAgIChudWxsID09IGUucXVldWUgfHwgITAgPT09IGUucXVldWUpICYmIChlLnF1ZXVlID0gImZ4IiksIGUub2xkID0gZS5jb21wbGV0ZSwgZS5jb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0LmlzRnVuY3Rpb24oZS5vbGQpICYmIGUub2xkLmNhbGwodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUucXVldWUgJiYgdC5kZXF1ZXVlKHRoaXMsIGUucXVldWUpCiAgICAgICAgICAgICAgICAgICAgfSwgZQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmVhc2luZyA9IHsKICAgICAgICAgICAgICAgIGxpbmVhcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3dpbmc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLjUgLSBNYXRoLmNvcyhhICogTWF0aC5QSSkgLyAyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQudGltZXJzID0gW107CiAgICAgICAgICAgIHQuZnggPSBLLnByb3RvdHlwZS5pbml0OwogICAgICAgICAgICB0LmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBhLCBiID0gdC50aW1lcnMsCiAgICAgICAgICAgICAgICAgICAgZiA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKElhID0gdC5ub3coKTsgYi5sZW5ndGggPiBmOyBmKyspIGEgPSBiW2ZdLCBhKCkgfHwgYltmXSAhPT0gYSB8fCBiLnNwbGljZShmLS0sIDEpOwogICAgICAgICAgICAgICAgYi5sZW5ndGggfHwgdC5meC5zdG9wKCk7CiAgICAgICAgICAgICAgICBJYSA9IHAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5meC50aW1lciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIGEoKSAmJiB0LnRpbWVycy5wdXNoKGEpICYmIHQuZnguc3RhcnQoKQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmZ4LmludGVydmFsID0gMTM7CiAgICAgICAgICAgIHQuZnguc3RhcnQgPQogICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJGEgfHwgKCRhID0gc2V0SW50ZXJ2YWwodC5meC50aWNrLCB0LmZ4LmludGVydmFsKSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCgkYSk7CiAgICAgICAgICAgICAgICAkYSA9IG51bGwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5meC5zcGVlZHMgPSB7CiAgICAgICAgICAgICAgICBzbG93OiA2MDAsCiAgICAgICAgICAgICAgICBmYXN0OiAyMDAsCiAgICAgICAgICAgICAgICBfZGVmYXVsdDogNDAwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQuZnguc3RlcCA9IHt9OwogICAgICAgICAgICB0LmV4cHIgJiYgdC5leHByLmZpbHRlcnMgJiYgKHQuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQuZ3JlcCh0LnRpbWVycywgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBiLmVsZW0KICAgICAgICAgICAgICAgIH0pLmxlbmd0aAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5mbi5vZmZzZXQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGEgPT09IHAgPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0Lm9mZnNldC5zZXRPZmZzZXQodGhpcywgYSwgYikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIGIsIGYsIGUgPSB0aGlzWzBdLAogICAgICAgICAgICAgICAgICAgIGMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaCA9IGUgJiYgZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICAgICAgaWYgKGgpIHJldHVybiBiID0gaC5kb2N1bWVudEVsZW1lbnQsIHQuY29udGFpbnMoYiwKICAgICAgICAgICAgICAgICAgICBlKSA/ICh0eXBlb2YgZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgIT09IEggJiYgKGMgPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSwgZiA9IFQoaCksIHsKICAgICAgICAgICAgICAgICAgICB0b3A6IGMudG9wICsgZi5wYWdlWU9mZnNldCAtIGIuY2xpZW50VG9wLAogICAgICAgICAgICAgICAgICAgIGxlZnQ6IGMubGVmdCArIGYucGFnZVhPZmZzZXQgLSBiLmNsaWVudExlZnQKICAgICAgICAgICAgICAgIH0pIDogYwogICAgICAgICAgICB9OwogICAgICAgICAgICB0Lm9mZnNldCA9IHsKICAgICAgICAgICAgICAgIHNldE9mZnNldDogZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBlLCBjLCBoLCBtLCBkLCB3LCBsID0gdC5jc3MoYSwgInBvc2l0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgICAgIG4gPSB0KGEpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0ge307CiAgICAgICAgICAgICAgICAgICAgInN0YXRpYyIgPT09IGwgJiYgKGEuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiKTsKICAgICAgICAgICAgICAgICAgICBkID0gbi5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICBoID0gdC5jc3MoYSwgInRvcCIpOwogICAgICAgICAgICAgICAgICAgIHcgPSB0LmNzcyhhLCAibGVmdCIpOwogICAgICAgICAgICAgICAgICAgICgiYWJzb2x1dGUiID09PSBsIHx8ICJmaXhlZCIgPT09IGwpICYmIC0xIDwgKGggKyB3KS5pbmRleE9mKCJhdXRvIikgPyAoZSA9IG4ucG9zaXRpb24oKSwgbSA9IGUudG9wLCBjID0gZS5sZWZ0KSA6IChtID0gcGFyc2VGbG9hdChoKSB8fCAwLCBjID0gcGFyc2VGbG9hdCh3KSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICB0LmlzRnVuY3Rpb24oYikgJiYgKGIgPSBiLmNhbGwoYSwgZiwgZCkpOwogICAgICAgICAgICAgICAgICAgIG51bGwgIT0gYi50b3AgJiYgKGcudG9wID0gYi50b3AgLSBkLnRvcCArIG0pOwogICAgICAgICAgICAgICAgICAgIG51bGwgIT0gYi5sZWZ0ICYmIChnLmxlZnQgPSBiLmxlZnQgLSBkLmxlZnQgKyBjKTsKICAgICAgICAgICAgICAgICAgICAidXNpbmciIGluIGIgPyBiLnVzaW5nLmNhbGwoYSwgZykgOiBuLmNzcyhnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0LmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEsIGIsIGYgPSB0aGlzWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJmaXhlZCIgPT09IHQuY3NzKGYsICJwb3NpdGlvbiIpID8gYiA9IGYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiAoYSA9IHRoaXMub2Zmc2V0UGFyZW50KCksIGIgPSB0aGlzLm9mZnNldCgpLCB0Lm5vZGVOYW1lKGFbMF0sICJodG1sIikgfHwgKGUgPSBhLm9mZnNldCgpKSwgZS50b3AgKz0gdC5jc3MoYVswXSwgImJvcmRlclRvcFdpZHRoIiwgITApLCBlLmxlZnQgKz0gdC5jc3MoYVswXSwgImJvcmRlckxlZnRXaWR0aCIsICEwKSksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYi50b3AgLSBlLnRvcCAtIHQuY3NzKGYsICJtYXJnaW5Ub3AiLCAhMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBiLmxlZnQgLSBlLmxlZnQgLSB0LmNzcyhmLCAibWFyZ2luTGVmdCIsICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgTDsgYSAmJiAhdC5ub2RlTmFtZShhLCAiaHRtbCIpICYmICJzdGF0aWMiID09PSB0LmNzcyhhLCAicG9zaXRpb24iKTspIGEgPSBhLm9mZnNldFBhcmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgfHwgTAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0LmVhY2goewogICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0IiwKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0IgogICAgICAgICAgICB9LCBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9ICJwYWdlWU9mZnNldCIgPT09IGY7CiAgICAgICAgICAgICAgICB0LmZuW2JdID0gZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbihiLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gVChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGggPT09IHAgPyBtID8gbVtmXSA6IGJbY10gOiAobSA/IG0uc2Nyb2xsVG8oZSA/IGEucGFnZVhPZmZzZXQgOiBoLCBlID8gaCA6IGEucGFnZVlPZmZzZXQpIDogYltjXSA9IGgsIHApCiAgICAgICAgICAgICAgICAgICAgfSwgYiwgYywgYXJndW1lbnRzLmxlbmd0aCwgbnVsbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHQuZWFjaCh7CiAgICAgICAgICAgICAgICBIZWlnaHQ6ICJoZWlnaHQiLAogICAgICAgICAgICAgICAgV2lkdGg6ICJ3aWR0aCIKICAgICAgICAgICAgfSwgZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgIGIpIHsKICAgICAgICAgICAgICAgIHQuZWFjaCh7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogImlubmVyIiArIGEsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogYiwKICAgICAgICAgICAgICAgICAgICAiIjogIm91dGVyIiArIGEKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGYsIGUpIHsKICAgICAgICAgICAgICAgICAgICB0LmZuW2VdID0gZnVuY3Rpb24oZSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGFyZ3VtZW50cy5sZW5ndGggJiYgKGYgfHwgImJvb2xlYW4iICE9IHR5cGVvZiBlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBmIHx8ICghMCA9PT0gZSB8fCAhMCA9PT0gYyA/ICJtYXJnaW4iIDogImJvcmRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5hY2Nlc3ModGhpcywgZnVuY3Rpb24oYiwgZiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5pc1dpbmRvdyhiKSA/IGIuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiICsgYV0gOiA5ID09PSBiLm5vZGVUeXBlID8gKGMgPSBiLmRvY3VtZW50RWxlbWVudCwgTWF0aC5tYXgoYi5ib2R5WyJzY3JvbGwiICsgYV0sIGNbInNjcm9sbCIgKyBhXSwgYi5ib2R5WyJvZmZzZXQiICsgYV0sIGNbIm9mZnNldCIgKyBhXSwgY1siY2xpZW50IiArIGFdKSkgOiBlID09PSBwID8gdC5jc3MoYiwgZiwgbSkgOiB0LnN0eWxlKGIsIGYsIGUsIG0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIsIGggPyBlIDogcCwgaCwgbnVsbCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdC5mbi5zaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGgKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdC5mbi5hbmRTZWxmID0gdC5mbi5hZGRCYWNrOwogICAgICAgICAgICAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlICYmIG1vZHVsZSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPyBtb2R1bGUuZXhwb3J0cyA9IHQgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUoImpxdWVyeSIsIFtdLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAib2JqZWN0IiA9PSB0eXBlb2YgYSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgYS5kb2N1bWVudCAmJiAoYS5qUXVlcnkgPSBhLiQgPSB0KQogICAgICAgIH0pKHdpbmRvdyk7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBqUXVlcnkpIHRocm93IEVycm9yKCJCb290c3RyYXAncyBKYXZhU2NyaXB0IHJlcXVpcmVzIGpRdWVyeSIpOyArIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgYSA9IGEuZm4uanF1ZXJ5LnNwbGl0KCIgIilbMF0uc3BsaXQoIi4iKTsKICAgICAgICAgICAgaWYgKDIgPiBhWzBdICYmIDkgPiBhWzFdIHx8IDEgPT0gYVswXSAmJiA5ID09IGFbMV0gJiYgMSA+IGFbMl0pIHRocm93IEVycm9yKCJCb290c3RyYXAncyBKYXZhU2NyaXB0IHJlcXVpcmVzIGpRdWVyeSB2ZXJzaW9uIDEuOS4xIG9yIGhpZ2hlciIpOwogICAgICAgIH0oalF1ZXJ5KTsgKyBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvb3RzdHJhcCIpLAogICAgICAgICAgICAgICAgICAgIHAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdlYmtpdFRyYW5zaXRpb246ICJ3ZWJraXRUcmFuc2l0aW9uRW5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgTW96VHJhbnNpdGlvbjogInRyYW5zaXRpb25lbmQiLAogICAgICAgICAgICAgICAgICAgICAgICBPVHJhbnNpdGlvbjogIm9UcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogInRyYW5zaXRpb25lbmQiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB2OwogICAgICAgICAgICAgICAgZm9yICh2IGluIHApCiAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYS5zdHlsZVt2XSkgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBwW3ZdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZm4uZW11bGF0ZVRyYW5zaXRpb25FbmQgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9ICExLAogICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzOwogICAgICAgICAgICAgICAgYSh0aGlzKS5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHAgPSAhMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBwIHx8IGEodikudHJpZ2dlcihhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpCiAgICAgICAgICAgICAgICB9LCBrKSwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICBhKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYS5zdXBwb3J0LnRyYW5zaXRpb24gPSBwKCk7CiAgICAgICAgICAgICAgICBhLnN1cHBvcnQudHJhbnNpdGlvbiAmJgogICAgICAgICAgICAgICAgICAgIChhLmV2ZW50LnNwZWNpYWwuYnNUcmFuc2l0aW9uRW5kID0gewogICAgICAgICAgICAgICAgICAgICAgICBiaW5kVHlwZTogYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0ZVR5cGU6IGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCwKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYShrLnRhcmdldCkuaXModGhpcykgPyBrLmhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfShqUXVlcnkpOyArIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdmFyIHAgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICBhKGspLm9uKCJjbGljayIsICdbZGF0YS1kaXNtaXNzPSJhbGVydCJdJywgdGhpcy5jbG9zZSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5WRVJTSU9OID0gIjMuMy40IjsKICAgICAgICAgICAgcC5UUkFOU0lUSU9OX0RVUkFUSU9OID0gMTUwOwogICAgICAgICAgICBwLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHYoKSB7CiAgICAgICAgICAgICAgICAgICAgSS5kZXRhY2goKS50cmlnZ2VyKCJjbG9zZWQuYnMuYWxlcnQiKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIEYgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIE0gPSBGLmF0dHIoImRhdGEtdGFyZ2V0Iik7CiAgICAgICAgICAgICAgICBNIHx8IChNID0gRi5hdHRyKCJocmVmIiksIE0gPSBNICYmIE0ucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCAiIikpOwogICAgICAgICAgICAgICAgdmFyIEkgPSBhKE0pOwogICAgICAgICAgICAgICAgayAmJiBrLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBJLmxlbmd0aCB8fCAoSSA9IEYuY2xvc2VzdCgiLmFsZXJ0IikpOwogICAgICAgICAgICAgICAgSS50cmlnZ2VyKGsgPSBhLkV2ZW50KCJjbG9zZS5icy5hbGVydCIpKTsKICAgICAgICAgICAgICAgIGsuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgKEkucmVtb3ZlQ2xhc3MoImluIiksIGEuc3VwcG9ydC50cmFuc2l0aW9uICYmIEkuaGFzQ2xhc3MoImZhZGUiKSA/CiAgICAgICAgICAgICAgICAgICAgSS5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIHYpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKHAuVFJBTlNJVElPTl9EVVJBVElPTikgOiB2KCkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBrID0gYS5mbi5hbGVydDsKICAgICAgICAgICAgYS5mbi5hbGVydCA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBGID0gdi5kYXRhKCJicy5hbGVydCIpOwogICAgICAgICAgICAgICAgICAgIEYgfHwgdi5kYXRhKCJicy5hbGVydCIsIEYgPSBuZXcgcCh0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGsgJiYgRltrXS5jYWxsKHYpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmFsZXJ0LkNvbnN0cnVjdG9yID0gcDsKICAgICAgICAgICAgYS5mbi5hbGVydC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5mbi5hbGVydCA9IGssIHRoaXMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYShkb2N1bWVudCkub24oImNsaWNrLmJzLmFsZXJ0LmRhdGEtYXBpIiwgJ1tkYXRhLWRpc21pc3M9ImFsZXJ0Il0nLCBwLnByb3RvdHlwZS5jbG9zZSkKICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKHYpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEYgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gRi5kYXRhKCJicy5idXR0b24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgSSA9ICJvYmplY3QiID09IHR5cGVvZiB2ICYmIHY7CiAgICAgICAgICAgICAgICAgICAgcCB8fCBGLmRhdGEoImJzLmJ1dHRvbiIsIHAgPSBuZXcgayh0aGlzLCBJKSk7CiAgICAgICAgICAgICAgICAgICAgInRvZ2dsZSIgPT0gdiA/IHAudG9nZ2xlKCkgOiB2ICYmIHAuc2V0U3RhdGUodikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGsgPSBmdW5jdGlvbih2LCBGKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50ID0gYSh2KTsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGEuZXh0ZW5kKHt9LCBrLkRFRkFVTFRTLCBGKTsKICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gITEKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5WRVJTSU9OID0gIjMuMy40IjsKICAgICAgICAgICAgay5ERUZBVUxUUyA9IHsKICAgICAgICAgICAgICAgIGxvYWRpbmdUZXh0OiAibG9hZGluZy4uLiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICB2YXIgRiA9IHRoaXMuJGVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgcCA9IEYuaXMoImlucHV0IikgPyAidmFsIiA6ICJodG1sIiwKICAgICAgICAgICAgICAgICAgICBJID0gRi5kYXRhKCk7CiAgICAgICAgICAgICAgICBrICs9ICJUZXh0IjsKICAgICAgICAgICAgICAgIG51bGwgPT0gSS5yZXNldFRleHQgJiYgRi5kYXRhKCJyZXNldFRleHQiLCBGW3BdKCkpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIEZbcF0obnVsbCA9PQogICAgICAgICAgICAgICAgICAgICAgICBJW2tdID8gdGhpcy5vcHRpb25zW2tdIDogSVtrXSk7CiAgICAgICAgICAgICAgICAgICAgImxvYWRpbmdUZXh0IiA9PSBrID8gKHRoaXMuaXNMb2FkaW5nID0gITAsIEYuYWRkQ2xhc3MoImRpc2FibGVkIikuYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKSkgOiB0aGlzLmlzTG9hZGluZyAmJiAodGhpcy5pc0xvYWRpbmcgPSAhMSwgRi5yZW1vdmVDbGFzcygiZGlzYWJsZWQiKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpKQogICAgICAgICAgICAgICAgfSwgdGhpcyksIDApCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSAhMCwKICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy4kZWxlbWVudC5jbG9zZXN0KCdbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXScpOwogICAgICAgICAgICAgICAgaWYgKGsubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLiRlbGVtZW50LmZpbmQoImlucHV0Iik7CiAgICAgICAgICAgICAgICAgICAgInJhZGlvIiA9PSBwLnByb3AoInR5cGUiKSAmJiAocC5wcm9wKCJjaGVja2VkIikgJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiYWN0aXZlIikgPyBhID0gITEgOiBrLmZpbmQoIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIikpOwogICAgICAgICAgICAgICAgICAgIGEgJiYgcC5wcm9wKCJjaGVja2VkIiwgIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImFjdGl2ZSIpKS50cmlnZ2VyKCJjaGFuZ2UiKQogICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuJGVsZW1lbnQuYXR0cigiYXJpYS1wcmVzc2VkIiwgIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImFjdGl2ZSIpKTsKICAgICAgICAgICAgICAgIGEgJiYgdGhpcy4kZWxlbWVudC50b2dnbGVDbGFzcygiYWN0aXZlIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIEQgPSBhLmZuLmJ1dHRvbjsKICAgICAgICAgICAgYS5mbi5idXR0b24gPSBwOwogICAgICAgICAgICBhLmZuLmJ1dHRvbi5Db25zdHJ1Y3RvciA9IGs7CiAgICAgICAgICAgIGEuZm4uYnV0dG9uLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLmZuLmJ1dHRvbiA9IEQsIHRoaXMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYShkb2N1bWVudCkub24oImNsaWNrLmJzLmJ1dHRvbi5kYXRhLWFwaSIsICdbZGF0YS10b2dnbGVePSJidXR0b24iXScsIGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHZhciBGID0gYShrLnRhcmdldCk7CiAgICAgICAgICAgICAgICBGLmhhc0NsYXNzKCJidG4iKSB8fCAoRiA9IEYuY2xvc2VzdCgiLmJ0biIpKTsKICAgICAgICAgICAgICAgIHAuY2FsbChGLCAidG9nZ2xlIik7CiAgICAgICAgICAgICAgICBrLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgfSkub24oImZvY3VzLmJzLmJ1dHRvbi5kYXRhLWFwaSBibHVyLmJzLmJ1dHRvbi5kYXRhLWFwaSIsICdbZGF0YS10b2dnbGVePSJidXR0b24iXScsIGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIGEoay50YXJnZXQpLmNsb3Nlc3QoIi5idG4iKS50b2dnbGVDbGFzcygiZm9jdXMiLAogICAgICAgICAgICAgICAgICAgIC9eZm9jdXMoaW4pPyQvLnRlc3Qoay50eXBlKSkKICAgICAgICAgICAgfSkKICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKHYpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBJID0gcC5kYXRhKCJicy5jYXJvdXNlbCIpLAogICAgICAgICAgICAgICAgICAgICAgICBEID0gYS5leHRlbmQoe30sIGsuREVGQVVMVFMsIHAuZGF0YSgpLCAib2JqZWN0IiA9PSB0eXBlb2YgdiAmJiB2KSwKICAgICAgICAgICAgICAgICAgICAgICAgTyA9ICJzdHJpbmciID09IHR5cGVvZiB2ID8gdiA6IEQuc2xpZGU7CiAgICAgICAgICAgICAgICAgICAgSSB8fCBwLmRhdGEoImJzLmNhcm91c2VsIiwgSSA9IG5ldyBrKHRoaXMsIEQpKTsKICAgICAgICAgICAgICAgICAgICAibnVtYmVyIiA9PSB0eXBlb2YgdiA/IEkudG8odikgOiBPID8gSVtPXSgpIDogRC5pbnRlcnZhbCAmJiBJLnBhdXNlKCkuY3ljbGUoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgayA9IGZ1bmN0aW9uKGssIHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQgPSBhKGspOwogICAgICAgICAgICAgICAgdGhpcy4kaW5kaWNhdG9ycyA9IHRoaXMuJGVsZW1lbnQuZmluZCgiLmNhcm91c2VsLWluZGljYXRvcnMiKTsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHY7CiAgICAgICAgICAgICAgICB0aGlzLiRpdGVtcyA9IHRoaXMuJGFjdGl2ZSA9IHRoaXMuaW50ZXJ2YWwgPSB0aGlzLnNsaWRpbmcgPSB0aGlzLnBhdXNlZCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMua2V5Ym9hcmQgJiYgdGhpcy4kZWxlbWVudC5vbigia2V5ZG93bi5icy5jYXJvdXNlbCIsCiAgICAgICAgICAgICAgICAgICAgYS5wcm94eSh0aGlzLmtleWRvd24sIHRoaXMpKTsKICAgICAgICAgICAgICAgICJob3ZlciIgIT0gdGhpcy5vcHRpb25zLnBhdXNlIHx8ICJvbnRvdWNoc3RhcnQiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCB0aGlzLiRlbGVtZW50Lm9uKCJtb3VzZWVudGVyLmJzLmNhcm91c2VsIiwgYS5wcm94eSh0aGlzLnBhdXNlLCB0aGlzKSkub24oIm1vdXNlbGVhdmUuYnMuY2Fyb3VzZWwiLCBhLnByb3h5KHRoaXMuY3ljbGUsIHRoaXMpKQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLlZFUlNJT04gPSAiMy4zLjQiOwogICAgICAgICAgICBrLlRSQU5TSVRJT05fRFVSQVRJT04gPSA2MDA7CiAgICAgICAgICAgIGsuREVGQVVMVFMgPSB7CiAgICAgICAgICAgICAgICBpbnRlcnZhbDogNUUzLAogICAgICAgICAgICAgICAgcGF1c2U6ICJob3ZlciIsCiAgICAgICAgICAgICAgICB3cmFwOiAhMCwKICAgICAgICAgICAgICAgIGtleWJvYXJkOiAhMAogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5rZXlkb3duID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgaWYgKCEvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KGEudGFyZ2V0LnRhZ05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhLndoaWNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuY3ljbGUgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gayB8fCAodGhpcy5wYXVzZWQgPSAhMSksIHRoaXMuaW50ZXJ2YWwgJiYgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKSwgdGhpcy5vcHRpb25zLmludGVydmFsICYmICF0aGlzLnBhdXNlZCAmJiAodGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGEucHJveHkodGhpcy5uZXh0LCB0aGlzKSwgdGhpcy5vcHRpb25zLmludGVydmFsKSksIHRoaXMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuZ2V0SXRlbUluZGV4ID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGl0ZW1zID0gYS5wYXJlbnQoKS5jaGlsZHJlbigiLml0ZW0iKSwgdGhpcy4kaXRlbXMuaW5kZXgoYSB8fCB0aGlzLiRhY3RpdmUpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmdldEl0ZW1Gb3JEaXJlY3Rpb24gPSBmdW5jdGlvbihhLCBrKSB7CiAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuZ2V0SXRlbUluZGV4KGspOwogICAgICAgICAgICAgICAgcmV0dXJuICgicHJldiIgPT0gYSAmJiAwID09PSB2IHx8ICJuZXh0IiA9PSBhICYmIHYgPT0gdGhpcy4kaXRlbXMubGVuZ3RoIC0gMSkgJiYgIXRoaXMub3B0aW9ucy53cmFwID8gayA6IHRoaXMuJGl0ZW1zLmVxKCh2ICsKICAgICAgICAgICAgICAgICAgICAoInByZXYiID09IGEgPyAtMSA6IDEpKSAlIHRoaXMuJGl0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUudG8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICB2YXIgayA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgdiA9IHRoaXMuZ2V0SXRlbUluZGV4KHRoaXMuJGFjdGl2ZSA9IHRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0uYWN0aXZlIikpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEgPiB0aGlzLiRpdGVtcy5sZW5ndGggLSAxIHx8IDAgPiBhID8gdm9pZCAwIDogdGhpcy5zbGlkaW5nID8gdGhpcy4kZWxlbWVudC5vbmUoInNsaWQuYnMuY2Fyb3VzZWwiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBrLnRvKGEpCiAgICAgICAgICAgICAgICB9KSA6IHYgPT0gYSA/IHRoaXMucGF1c2UoKS5jeWNsZSgpIDogdGhpcy5zbGlkZShhID4gdiA/ICJuZXh0IiA6ICJwcmV2IiwgdGhpcy4kaXRlbXMuZXEoYSkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oaykgewogICAgICAgICAgICAgICAgcmV0dXJuIGsgfHwgKHRoaXMucGF1c2VkID0gITApLCB0aGlzLiRlbGVtZW50LmZpbmQoIi5uZXh0LCAucHJldiIpLmxlbmd0aCAmJiBhLnN1cHBvcnQudHJhbnNpdGlvbiAmJiAodGhpcy4kZWxlbWVudC50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCksCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jeWNsZSghMCkpLCB0aGlzLmludGVydmFsID0gY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKSwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zbGlkaW5nID8gdm9pZCAwIDogdGhpcy5zbGlkZSgibmV4dCIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNsaWRpbmcgPyB2b2lkIDAgOiB0aGlzLnNsaWRlKCJwcmV2IikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuc2xpZGUgPSBmdW5jdGlvbih2LCBwKSB7CiAgICAgICAgICAgICAgICB2YXIgSSA9IHRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0uYWN0aXZlIiksCiAgICAgICAgICAgICAgICAgICAgRCA9IHAgfHwgdGhpcy5nZXRJdGVtRm9yRGlyZWN0aW9uKHYsIEkpLAogICAgICAgICAgICAgICAgICAgIE8gPSB0aGlzLmludGVydmFsLAogICAgICAgICAgICAgICAgICAgIFAgPSAibmV4dCIgPT0gdiA/ICJsZWZ0IiA6ICJyaWdodCIsCiAgICAgICAgICAgICAgICAgICAgViA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoRC5oYXNDbGFzcygiYWN0aXZlIikpIHJldHVybiB0aGlzLnNsaWRpbmcgPSAhMTsKICAgICAgICAgICAgICAgIHZhciBtYSA9IERbMF0sCiAgICAgICAgICAgICAgICAgICAgZmEgPSBhLkV2ZW50KCJzbGlkZS5icy5jYXJvdXNlbCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogbWEsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogUAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihmYSksICFmYS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNsaWRpbmcgPSAhMCwgTyAmJiB0aGlzLnBhdXNlKCksIHRoaXMuJGluZGljYXRvcnMubGVuZ3RoKSB0aGlzLiRpbmRpY2F0b3JzLmZpbmQoIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIiksIChmYSA9IGEodGhpcy4kaW5kaWNhdG9ycy5jaGlsZHJlbigpW3RoaXMuZ2V0SXRlbUluZGV4KEQpXSkpICYmIGZhLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYWEgPSBhLkV2ZW50KCJzbGlkLmJzLmNhcm91c2VsIiwgewogICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBtYSwKICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBQCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoInNsaWRlIikgPyAoRC5hZGRDbGFzcyh2KSwgRFswXS5vZmZzZXRXaWR0aCwgSS5hZGRDbGFzcyhQKSwgRC5hZGRDbGFzcyhQKSwgSS5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBELnJlbW92ZUNsYXNzKFt2LCBQXS5qb2luKCIgIikpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgSS5yZW1vdmVDbGFzcyhbImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQCiAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbigiICIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgVi5zbGlkaW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWLiRlbGVtZW50LnRyaWdnZXIoYWEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApCiAgICAgICAgICAgICAgICAgICAgfSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoay5UUkFOU0lUSU9OX0RVUkFUSU9OKSkgOiAoSS5yZW1vdmVDbGFzcygiYWN0aXZlIiksIEQuYWRkQ2xhc3MoImFjdGl2ZSIpLCB0aGlzLnNsaWRpbmcgPSAhMSwgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGFhKSksIE8gJiYgdGhpcy5jeWNsZSgpLCB0aGlzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBEID0gYS5mbi5jYXJvdXNlbDsKICAgICAgICAgICAgYS5mbi5jYXJvdXNlbCA9IHA7CiAgICAgICAgICAgIGEuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3IgPSBrOwogICAgICAgICAgICBhLmZuLmNhcm91c2VsLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLmZuLmNhcm91c2VsID0gRCwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgdiA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHZhciB2LCBJID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBEID0gYShJLmF0dHIoImRhdGEtdGFyZ2V0IikgfHwgKHYgPSBJLmF0dHIoImhyZWYiKSkgJiYgdi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICIiKSk7CiAgICAgICAgICAgICAgICBELmhhc0NsYXNzKCJjYXJvdXNlbCIpICYmCiAgICAgICAgICAgICAgICAgICAgKHYgPSBhLmV4dGVuZCh7fSwgRC5kYXRhKCksIEkuZGF0YSgpKSwgKEkgPSBJLmF0dHIoImRhdGEtc2xpZGUtdG8iKSkgJiYgKHYuaW50ZXJ2YWwgPSAhMSksIHAuY2FsbChELCB2KSwgSSAmJiBELmRhdGEoImJzLmNhcm91c2VsIikudG8oSSksIGsucHJldmVudERlZmF1bHQoKSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYShkb2N1bWVudCkub24oImNsaWNrLmJzLmNhcm91c2VsLmRhdGEtYXBpIiwgIltkYXRhLXNsaWRlXSIsIHYpLm9uKCJjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaSIsICJbZGF0YS1zbGlkZS10b10iLCB2KTsKICAgICAgICAgICAgYSh3aW5kb3cpLm9uKCJsb2FkIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBhKCdbZGF0YS1yaWRlPSJjYXJvdXNlbCJdJykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgcC5jYWxsKGssIGsuZGF0YSgpKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKGspIHsKICAgICAgICAgICAgICAgIHZhciB2OwogICAgICAgICAgICAgICAgayA9IGsuYXR0cigiZGF0YS10YXJnZXQiKSB8fCAodiA9IGsuYXR0cigiaHJlZiIpKSAmJiB2LnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywgIiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEoaykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gayhrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHYuZGF0YSgiYnMuY29sbGFwc2UiKSwKICAgICAgICAgICAgICAgICAgICAgICAgUyA9IGEuZXh0ZW5kKHt9LCBELkRFRkFVTFRTLCB2LmRhdGEoKSwgIm9iamVjdCIgPT0gdHlwZW9mIGsgJiYgayk7CiAgICAgICAgICAgICAgICAgICAgIXAgJiYgUy50b2dnbGUgJiYgL3Nob3d8aGlkZS8udGVzdChrKSAmJiAoUy50b2dnbGUgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgcCB8fCB2LmRhdGEoImJzLmNvbGxhcHNlIiwgcCA9IG5ldyBEKHRoaXMsIFMpKTsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgayAmJiBwW2tdKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIEQgPSBmdW5jdGlvbihrLCB2KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50ID0gYShrKTsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGEuZXh0ZW5kKHt9LCBELkRFRkFVTFRTLCB2KTsKICAgICAgICAgICAgICAgIHRoaXMuJHRyaWdnZXIgPSBhKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl1baHJlZj0iIycgKwogICAgICAgICAgICAgICAgICAgIGsuaWQgKyAnIl0sW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2RhdGEtdGFyZ2V0PSIjJyArIGsuaWQgKyAnIl0nKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucGFyZW50ID8gdGhpcy4kcGFyZW50ID0gdGhpcy5nZXRQYXJlbnQoKSA6IHRoaXMuYWRkQXJpYUFuZENvbGxhcHNlZENsYXNzKHRoaXMuJGVsZW1lbnQsIHRoaXMuJHRyaWdnZXIpOwogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvZ2dsZSAmJiB0aGlzLnRvZ2dsZSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEQuVkVSU0lPTiA9ICIzLjMuNCI7CiAgICAgICAgICAgIEQuVFJBTlNJVElPTl9EVVJBVElPTiA9IDM1MDsKICAgICAgICAgICAgRC5ERUZBVUxUUyA9IHsKICAgICAgICAgICAgICAgIHRvZ2dsZTogITAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgRC5wcm90b3R5cGUuZGltZW5zaW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWxlbWVudC5oYXNDbGFzcygid2lkdGgiKSA/ICJ3aWR0aCIgOiAiaGVpZ2h0IgogICAgICAgICAgICB9OwogICAgICAgICAgICBELnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudHJhbnNpdGlvbmluZyAmJiAhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKSkgewogICAgICAgICAgICAgICAgICAgIHZhciB2LCBwID0gdGhpcy4kcGFyZW50ICYmIHRoaXMuJHBhcmVudC5jaGlsZHJlbigiLnBhbmVsIikuY2hpbGRyZW4oIi5pbiwgLmNvbGxhcHNpbmciKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIShwICYmIHAubGVuZ3RoICYmICh2ID0gcC5kYXRhKCJicy5jb2xsYXBzZSIpLCB2ICYmIHYudHJhbnNpdGlvbmluZykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBJID0gYS5FdmVudCgic2hvdy5icy5jb2xsYXBzZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kZWxlbWVudC50cmlnZ2VyKEkpLCAhSS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCAmJiBwLmxlbmd0aCAmJiAoay5jYWxsKHAsICJoaWRlIiksIHYgfHwgcC5kYXRhKCJicy5jb2xsYXBzZSIsIG51bGwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBTID0gdGhpcy5kaW1lbnNpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIikuYWRkQ2xhc3MoImNvbGxhcHNpbmciKVtTXSgwKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHJpZ2dlci5yZW1vdmVDbGFzcygiY29sbGFwc2VkIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSBpbiIpW1NdKCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25pbmcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcigic2hvd24uYnMuY29sbGFwc2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYS5zdXBwb3J0LnRyYW5zaXRpb24pIHJldHVybiB2LmNhbGwodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gYS5jYW1lbENhc2UoWyJzY3JvbGwiLCBTXS5qb2luKCItIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIGEucHJveHkodiwgdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKEQuVFJBTlNJVElPTl9EVVJBVElPTilbU10odGhpcy4kZWxlbWVudFswXVtwXSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgRC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnRyYW5zaXRpb25pbmcgJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYS5FdmVudCgiaGlkZS5icy5jb2xsYXBzZSIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbGVtZW50LnRyaWdnZXIoayksICFrLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLmRpbWVuc2lvbigpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50W2tdKHRoaXMuJGVsZW1lbnRba10oKSlbMF0ub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LmFkZENsYXNzKCJjb2xsYXBzaW5nIikucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIGluIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICExKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHJpZ2dlci5hZGRDbGFzcygiY29sbGFwc2VkIikuYXR0cigiYXJpYS1leHBhbmRlZCIsICExKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uaW5nID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJjb2xsYXBzaW5nIikuYWRkQ2xhc3MoImNvbGxhcHNlIikudHJpZ2dlcigiaGlkZGVuLmJzLmNvbGxhcHNlIikKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3VwcG9ydC50cmFuc2l0aW9uID8gdm9pZCB0aGlzLiRlbGVtZW50W2tdKDApLm9uZSgiYnNUcmFuc2l0aW9uRW5kIiwgYS5wcm94eSh2LCB0aGlzKSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoRC5UUkFOU0lUSU9OX0RVUkFUSU9OKSA6IHYuY2FsbCh0aGlzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgRC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzW3RoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIikgPyAiaGlkZSIgOiAic2hvdyJdKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgRC5wcm90b3R5cGUuZ2V0UGFyZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYSh0aGlzLm9wdGlvbnMucGFyZW50KS5maW5kKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl1bZGF0YS1wYXJlbnQ9IicgKwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXJlbnQgKyAnIl0nKS5lYWNoKGEucHJveHkoZnVuY3Rpb24oaywgdikgewogICAgICAgICAgICAgICAgICAgIHZhciBJID0gYSh2KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyhwKEkpLCBJKQogICAgICAgICAgICAgICAgfSwgdGhpcykpLmVuZCgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEQucHJvdG90eXBlLmFkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyA9IGZ1bmN0aW9uKGEsIGspIHsKICAgICAgICAgICAgICAgIHZhciB2ID0gYS5oYXNDbGFzcygiaW4iKTsKICAgICAgICAgICAgICAgIGEuYXR0cigiYXJpYS1leHBhbmRlZCIsIHYpOwogICAgICAgICAgICAgICAgay50b2dnbGVDbGFzcygiY29sbGFwc2VkIiwgIXYpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCB2KQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgdiA9IGEuZm4uY29sbGFwc2U7CiAgICAgICAgICAgIGEuZm4uY29sbGFwc2UgPSBrOwogICAgICAgICAgICBhLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yID0gRDsKICAgICAgICAgICAgYS5mbi5jb2xsYXBzZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5mbi5jb2xsYXBzZSA9IHYsIHRoaXMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYShkb2N1bWVudCkub24oImNsaWNrLmJzLmNvbGxhcHNlLmRhdGEtYXBpIiwgJ1tkYXRhLXRvZ2dsZT0iY29sbGFwc2UiXScsIGZ1bmN0aW9uKHYpIHsKICAgICAgICAgICAgICAgIHZhciBEID0gYSh0aGlzKTsKICAgICAgICAgICAgICAgIEQuYXR0cigiZGF0YS10YXJnZXQiKSB8fAogICAgICAgICAgICAgICAgICAgIHYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHYgPSBwKEQpOwogICAgICAgICAgICAgICAgRCA9IHYuZGF0YSgiYnMuY29sbGFwc2UiKSA/ICJ0b2dnbGUiIDogRC5kYXRhKCk7CiAgICAgICAgICAgICAgICBrLmNhbGwodiwgRCkKICAgICAgICAgICAgfSkKICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKHApIHsKICAgICAgICAgICAgICAgIHAgJiYgMyA9PT0gcC53aGljaCB8fCAoYShEKS5yZW1vdmUoKSwgYSh2KS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgRiA9IGsodiksCiAgICAgICAgICAgICAgICAgICAgICAgIEQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgRi5oYXNDbGFzcygib3BlbiIpICYmIChGLnRyaWdnZXIocCA9IGEuRXZlbnQoImhpZGUuYnMuZHJvcGRvd24iLCBEKSksIHAuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgKHYuYXR0cigiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpLCBGLnJlbW92ZUNsYXNzKCJvcGVuIikudHJpZ2dlcigiaGlkZGVuLmJzLmRyb3Bkb3duIiwgRCkpKQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGsoaykgewogICAgICAgICAgICAgICAgdmFyIHYgPSBrLmF0dHIoImRhdGEtdGFyZ2V0Iik7CiAgICAgICAgICAgICAgICB2IHx8ICh2ID0gay5hdHRyKCJocmVmIiksIHYgPSB2ICYmIC8jW0EtWmEtel0vLnRlc3QodikgJiYgdi5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sICIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gKHYgPSB2ICYmIGEodikpICYmIHYubGVuZ3RoID8gdiA6IGsucGFyZW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgRCA9ICIuZHJvcGRvd24tYmFja2Ryb3AiLAogICAgICAgICAgICAgICAgdiA9ICdbZGF0YS10b2dnbGU9ImRyb3Bkb3duIl0nLAogICAgICAgICAgICAgICAgRiA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgICAgICBhKGspLm9uKCJjbGljay5icy5kcm9wZG93biIsIHRoaXMudG9nZ2xlKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgRi5WRVJTSU9OID0gIjMuMy40IjsKICAgICAgICAgICAgRi5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24odikgewogICAgICAgICAgICAgICAgdmFyIEYgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKCFGLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEQgPSBrKEYpLAogICAgICAgICAgICAgICAgICAgICAgICBNID0gRC5oYXNDbGFzcygib3BlbiIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwKCksICFNKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvbnRvdWNoc3RhcnQiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiAhRC5jbG9zZXN0KCIubmF2YmFyLW5hdiIpLmxlbmd0aCAmJiBhKCc8ZGl2IGNsYXNzPSJkcm9wZG93bi1iYWNrZHJvcCIvPicpLmluc2VydEFmdGVyKGEodGhpcykpLm9uKCJjbGljayIsIHApOwogICAgICAgICAgICAgICAgICAgICAgICBNID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoRC50cmlnZ2VyKHYgPSBhLkV2ZW50KCJzaG93LmJzLmRyb3Bkb3duIiwgTSkpLCB2LmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIEYudHJpZ2dlcigiZm9jdXMiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgRC50b2dnbGVDbGFzcygib3BlbiIpLnRyaWdnZXIoInNob3duLmJzLmRyb3Bkb3duIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBGLnByb3RvdHlwZS5rZXlkb3duID0gZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgaWYgKC8oMzh8NDB8Mjd8MzIpLy50ZXN0KHAud2hpY2gpICYmICEvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KHAudGFyZ2V0LnRhZ05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEYgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChwLnByZXZlbnREZWZhdWx0KCksIHAuc3RvcFByb3BhZ2F0aW9uKCksICFGLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEID0gayhGKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBELmhhc0NsYXNzKCJvcGVuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghTSAmJiAyNyAhPSBwLndoaWNoIHx8IE0gJiYgMjcgPT0gcC53aGljaCkgcmV0dXJuIDI3ID09IHAud2hpY2ggJiYgRC5maW5kKHYpLnRyaWdnZXIoImZvY3VzIiksIEYudHJpZ2dlcigiY2xpY2siKTsKICAgICAgICAgICAgICAgICAgICAgICAgRiA9IEQuZmluZCgnW3JvbGU9Im1lbnUiXSBsaTpub3QoLmRpc2FibGVkKTp2aXNpYmxlIGEsIFtyb2xlPSJsaXN0Ym94Il0gbGk6bm90KC5kaXNhYmxlZCk6dmlzaWJsZSBhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIEYubGVuZ3RoICYmIChEID0gRi5pbmRleChwLnRhcmdldCksIDM4ID09IHAud2hpY2ggJiYgMCA8IEQgJiYgRC0tLCA0MCA9PSBwLndoaWNoICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEIDwgRi5sZW5ndGggLSAxICYmIEQrKywgfkQgfHwgKEQgPSAwKSwgRi5lcShEKS50cmlnZ2VyKCJmb2N1cyIpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIE0gPSBhLmZuLmRyb3Bkb3duOwogICAgICAgICAgICBhLmZuLmRyb3Bkb3duID0gZnVuY3Rpb24oaykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSB2LmRhdGEoImJzLmRyb3Bkb3duIik7CiAgICAgICAgICAgICAgICAgICAgcCB8fCB2LmRhdGEoImJzLmRyb3Bkb3duIiwgcCA9IG5ldyBGKHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgayAmJiBwW2tdLmNhbGwodikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZHJvcGRvd24uQ29uc3RydWN0b3IgPSBGOwogICAgICAgICAgICBhLmZuLmRyb3Bkb3duLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLmZuLmRyb3Bkb3duID0gTSwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICBhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLCBwKS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLCAiLmRyb3Bkb3duIGZvcm0iLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICBhLnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgIH0pLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsIHYsCiAgICAgICAgICAgICAgICBGLnByb3RvdHlwZS50b2dnbGUpLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIiwgdiwgRi5wcm90b3R5cGUua2V5ZG93bikub24oImtleWRvd24uYnMuZHJvcGRvd24uZGF0YS1hcGkiLCAnW3JvbGU9Im1lbnUiXScsIEYucHJvdG90eXBlLmtleWRvd24pLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIiwgJ1tyb2xlPSJsaXN0Ym94Il0nLCBGLnByb3RvdHlwZS5rZXlkb3duKQogICAgICAgIH0oalF1ZXJ5KTsgKyBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHAodiwgcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBELmRhdGEoImJzLm1vZGFsIiksCiAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBhLmV4dGVuZCh7fSwgay5ERUZBVUxUUywgRC5kYXRhKCksICJvYmplY3QiID09IHR5cGVvZiB2ICYmIHYpOwogICAgICAgICAgICAgICAgICAgIEkgfHwgRC5kYXRhKCJicy5tb2RhbCIsIEkgPSBuZXcgayh0aGlzLCBTKSk7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIHYgPyBJW3ZdKHApIDogUy5zaG93ICYmIEkuc2hvdyhwKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgayA9IGZ1bmN0aW9uKGssIHApIHsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHA7CiAgICAgICAgICAgICAgICB0aGlzLiRib2R5ID0gYShkb2N1bWVudC5ib2R5KTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQgPSBhKGspOwogICAgICAgICAgICAgICAgdGhpcy4kZGlhbG9nID0gdGhpcy4kZWxlbWVudC5maW5kKCIubW9kYWwtZGlhbG9nIik7CiAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsQm9keVBhZCA9IHRoaXMuaXNTaG93biA9IHRoaXMuJGJhY2tkcm9wID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsYmFyV2lkdGggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVCYWNrZHJvcENsaWNrID0gITE7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVtb3RlICYmIHRoaXMuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWNvbnRlbnQiKS5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsCiAgICAgICAgICAgICAgICAgICAgYS5wcm94eShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJsb2FkZWQuYnMubW9kYWwiKQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLlZFUlNJT04gPSAiMy4zLjQiOwogICAgICAgICAgICBrLlRSQU5TSVRJT05fRFVSQVRJT04gPSAzMDA7CiAgICAgICAgICAgIGsuQkFDS0RST1BfVFJBTlNJVElPTl9EVVJBVElPTiA9IDE1MDsKICAgICAgICAgICAgay5ERUZBVUxUUyA9IHsKICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAhMCwKICAgICAgICAgICAgICAgIGtleWJvYXJkOiAhMCwKICAgICAgICAgICAgICAgIHNob3c6ICEwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzU2hvd24gPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hvdyhhKQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24odikgewogICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIEQgPSBhLkV2ZW50KCJzaG93LmJzLm1vZGFsIiwgewogICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB2CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoRCk7CiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd24gfHwgRC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCAodGhpcy5pc1Nob3duID0gITAsIHRoaXMuY2hlY2tTY3JvbGxiYXIoKSwgdGhpcy5zZXRTY3JvbGxiYXIoKSwgdGhpcy4kYm9keS5hZGRDbGFzcygibW9kYWwtb3BlbiIpLAogICAgICAgICAgICAgICAgICAgIHRoaXMuZXNjYXBlKCksIHRoaXMucmVzaXplKCksIHRoaXMuJGVsZW1lbnQub24oImNsaWNrLmRpc21pc3MuYnMubW9kYWwiLCAnW2RhdGEtZGlzbWlzcz0ibW9kYWwiXScsIGEucHJveHkodGhpcy5oaWRlLCB0aGlzKSksIHRoaXMuJGRpYWxvZy5vbigibW91c2Vkb3duLmRpc21pc3MuYnMubW9kYWwiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC4kZWxlbWVudC5vbmUoIm1vdXNldXAuZGlzbWlzcy5icy5tb2RhbCIsIGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoay50YXJnZXQpLmlzKHAuJGVsZW1lbnQpICYmIChwLmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSAhMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5iYWNrZHJvcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEQgPSBhLnN1cHBvcnQudHJhbnNpdGlvbiAmJiBwLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RoIHx8IHAuJGVsZW1lbnQuYXBwZW5kVG8ocC4kYm9keSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuJGVsZW1lbnQuc2hvdygpLnNjcm9sbFRvcCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcC5hZGp1c3REaWFsb2coKTsKICAgICAgICAgICAgICAgICAgICAgICAgRCAmJiBwLiRlbGVtZW50WzBdLm9mZnNldFdpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICBwLiRlbGVtZW50LmFkZENsYXNzKCJpbiIpLmF0dHIoImFyaWEtaGlkZGVuIiwgITEpOwogICAgICAgICAgICAgICAgICAgICAgICBwLmVuZm9yY2VGb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgTSA9IGEuRXZlbnQoInNob3duLmJzLm1vZGFsIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogdgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgRCA/IHAuJGRpYWxvZy5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC4kZWxlbWVudC50cmlnZ2VyKCJmb2N1cyIpLnRyaWdnZXIoTSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoay5UUkFOU0lUSU9OX0RVUkFUSU9OKSA6IHAuJGVsZW1lbnQudHJpZ2dlcigiZm9jdXMiKS50cmlnZ2VyKE0pCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbih2KSB7CiAgICAgICAgICAgICAgICB2ICYmIHYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHYgPSBhLkV2ZW50KCJoaWRlLmJzLm1vZGFsIik7CiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIodik7CiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd24gJiYgIXYuaXNEZWZhdWx0UHJldmVudGVkKCkgJiYgKHRoaXMuaXNTaG93biA9ICExLCB0aGlzLmVzY2FwZSgpLCB0aGlzLnJlc2l6ZSgpLCBhKGRvY3VtZW50KS5vZmYoImZvY3VzaW4uYnMubW9kYWwiKSwKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJpbiIpLmF0dHIoImFyaWEtaGlkZGVuIiwgITApLm9mZigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIpLm9mZigibW91c2V1cC5kaXNtaXNzLmJzLm1vZGFsIiksIHRoaXMuJGRpYWxvZy5vZmYoIm1vdXNlZG93bi5kaXNtaXNzLmJzLm1vZGFsIiksIGEuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImZhZGUiKSA/IHRoaXMuJGVsZW1lbnQub25lKCJic1RyYW5zaXRpb25FbmQiLCBhLnByb3h5KHRoaXMuaGlkZU1vZGFsLCB0aGlzKSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoay5UUkFOU0lUSU9OX0RVUkFUSU9OKSA6IHRoaXMuaGlkZU1vZGFsKCkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmVuZm9yY2VGb2N1cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIikub24oImZvY3VzaW4uYnMubW9kYWwiLCBhLnByb3h5KGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50WzBdID09PSBhLnRhcmdldCB8fCB0aGlzLiRlbGVtZW50LmhhcyhhLnRhcmdldCkubGVuZ3RoIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcigiZm9jdXMiKQogICAgICAgICAgICAgICAgfSwgdGhpcykpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmVzY2FwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5rZXlib2FyZCA/IHRoaXMuJGVsZW1lbnQub24oImtleWRvd24uZGlzbWlzcy5icy5tb2RhbCIsIGEucHJveHkoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIDI3ID09IGEud2hpY2ggJiYgdGhpcy5oaWRlKCkKICAgICAgICAgICAgICAgIH0sIHRoaXMpKSA6IHRoaXMuaXNTaG93biB8fCB0aGlzLiRlbGVtZW50Lm9mZigia2V5ZG93bi5kaXNtaXNzLmJzLm1vZGFsIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd24gPyBhKHdpbmRvdykub24oInJlc2l6ZS5icy5tb2RhbCIsIGEucHJveHkodGhpcy5oYW5kbGVVcGRhdGUsIHRoaXMpKSA6IGEod2luZG93KS5vZmYoInJlc2l6ZS5icy5tb2RhbCIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmhpZGVNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmJhY2tkcm9wKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGEuJGJvZHkucmVtb3ZlQ2xhc3MoIm1vZGFsLW9wZW4iKTsKICAgICAgICAgICAgICAgICAgICBhLnJlc2V0QWRqdXN0bWVudHMoKTsKICAgICAgICAgICAgICAgICAgICBhLnJlc2V0U2Nyb2xsYmFyKCk7CiAgICAgICAgICAgICAgICAgICAgYS4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMubW9kYWwiKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUucmVtb3ZlQmFja2Ryb3AgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGJhY2tkcm9wICYmIHRoaXMuJGJhY2tkcm9wLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kYmFja2Ryb3AgPSBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmJhY2tkcm9wID0gZnVuY3Rpb24odikgewogICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIEQgPSB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIikgPyAiZmFkZSIgOiAiIjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2hvd24gJiYgdGhpcy5vcHRpb25zLmJhY2tkcm9wKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEkgPSBhLnN1cHBvcnQudHJhbnNpdGlvbiAmJiBEOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRiYWNrZHJvcCA9IGEoJzxkaXYgY2xhc3M9Im1vZGFsLWJhY2tkcm9wICcgKyBEICsgJyIgLz4nKS5hcHBlbmRUbyh0aGlzLiRib2R5KSwgdGhpcy4kZWxlbWVudC5vbigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIsIGEucHJveHkoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWdub3JlQmFja2Ryb3BDbGljayA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCh0aGlzLmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSAhMSkgOiB2b2lkKGEudGFyZ2V0ID09PSBhLmN1cnJlbnRUYXJnZXQgJiYgKCJzdGF0aWMiID09IHRoaXMub3B0aW9ucy5iYWNrZHJvcCA/IHRoaXMuJGVsZW1lbnRbMF0uZm9jdXMoKSA6IHRoaXMuaGlkZSgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpLCBJICYmIHRoaXMuJGJhY2tkcm9wWzBdLm9mZnNldFdpZHRoLCB0aGlzLiRiYWNrZHJvcC5hZGRDbGFzcygiaW4iKSwgdikgSSA/IHRoaXMuJGJhY2tkcm9wLm9uZSgiYnNUcmFuc2l0aW9uRW5kIiwgdikuZW11bGF0ZVRyYW5zaXRpb25FbmQoay5CQUNLRFJPUF9UUkFOU0lUSU9OX0RVUkFUSU9OKSA6IHYoKQogICAgICAgICAgICAgICAgfSBlbHNlICF0aGlzLmlzU2hvd24gJiYgdGhpcy4kYmFja2Ryb3AgPyAodGhpcy4kYmFja2Ryb3AucmVtb3ZlQ2xhc3MoImluIiksIEQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBwLnJlbW92ZUJhY2tkcm9wKCk7CiAgICAgICAgICAgICAgICAgICAgdiAmJiB2KCkKICAgICAgICAgICAgICAgIH0sIGEuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImZhZGUiKSA/IHRoaXMuJGJhY2tkcm9wLm9uZSgiYnNUcmFuc2l0aW9uRW5kIiwKICAgICAgICAgICAgICAgICAgICBEKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChrLkJBQ0tEUk9QX1RSQU5TSVRJT05fRFVSQVRJT04pIDogRCgpKSA6IHYgJiYgdigpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmhhbmRsZVVwZGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5hZGp1c3REaWFsb2coKQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5hZGp1c3REaWFsb2cgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy4kZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0OwogICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgIHBhZGRpbmdMZWZ0OiAhdGhpcy5ib2R5SXNPdmVyZmxvd2luZyAmJiBhID8gdGhpcy5zY3JvbGxiYXJXaWR0aCA6ICIiLAogICAgICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogdGhpcy5ib2R5SXNPdmVyZmxvd2luZyAmJiAhYSA/IHRoaXMuc2Nyb2xsYmFyV2lkdGggOiAiIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUucmVzZXRBZGp1c3RtZW50cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgIHBhZGRpbmdMZWZ0OiAiIiwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICIiCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5jaGVja1Njcm9sbGJhciA9CiAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHdpbmRvdy5pbm5lcldpZHRoOwogICAgICAgICAgICAgICAgICAgIGEgfHwgKGEgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGEgPSBhLnJpZ2h0IC0gTWF0aC5hYnMoYS5sZWZ0KSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5SXNPdmVyZmxvd2luZyA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggPCBhOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsYmFyV2lkdGggPSB0aGlzLm1lYXN1cmVTY3JvbGxiYXIoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuc2V0U2Nyb2xsYmFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IHBhcnNlSW50KHRoaXMuJGJvZHkuY3NzKCJwYWRkaW5nLXJpZ2h0IikgfHwgMCwgMTApOwogICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEJvZHlQYWQgPSBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmdSaWdodCB8fCAiIjsKICAgICAgICAgICAgICAgIHRoaXMuYm9keUlzT3ZlcmZsb3dpbmcgJiYgdGhpcy4kYm9keS5jc3MoInBhZGRpbmctcmlnaHQiLCBhICsgdGhpcy5zY3JvbGxiYXJXaWR0aCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUucmVzZXRTY3JvbGxiYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGJvZHkuY3NzKCJwYWRkaW5nLXJpZ2h0IiwKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsQm9keVBhZCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUubWVhc3VyZVNjcm9sbGJhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgIGEuY2xhc3NOYW1lID0gIm1vZGFsLXNjcm9sbGJhci1tZWFzdXJlIjsKICAgICAgICAgICAgICAgIHRoaXMuJGJvZHkuYXBwZW5kKGEpOwogICAgICAgICAgICAgICAgdmFyIGsgPSBhLm9mZnNldFdpZHRoIC0gYS5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRib2R5WzBdLnJlbW92ZUNoaWxkKGEpLCBrCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBEID0gYS5mbi5tb2RhbDsKICAgICAgICAgICAgYS5mbi5tb2RhbCA9IHA7CiAgICAgICAgICAgIGEuZm4ubW9kYWwuQ29uc3RydWN0b3IgPSBrOwogICAgICAgICAgICBhLmZuLm1vZGFsLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLmZuLm1vZGFsID0gRCwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICBhKGRvY3VtZW50KS5vbigiY2xpY2suYnMubW9kYWwuZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlPSJtb2RhbCJdJywgZnVuY3Rpb24oaykgewogICAgICAgICAgICAgICAgdmFyIEQgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIE0gPSBELmF0dHIoImhyZWYiKSwKICAgICAgICAgICAgICAgICAgICBJID0gYShELmF0dHIoImRhdGEtdGFyZ2V0IikgfHwgTSAmJiBNLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywKICAgICAgICAgICAgICAgICAgICAgICAgIiIpKSwKICAgICAgICAgICAgICAgICAgICBNID0gSS5kYXRhKCJicy5tb2RhbCIpID8gInRvZ2dsZSIgOiBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW90ZTogIS8jLy50ZXN0KE0pICYmIE0KICAgICAgICAgICAgICAgICAgICB9LCBJLmRhdGEoKSwgRC5kYXRhKCkpOwogICAgICAgICAgICAgICAgRC5pcygiYSIpICYmIGsucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIEkub25lKCJzaG93LmJzLm1vZGFsIiwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgSS5vbmUoImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBELmlzKCI6dmlzaWJsZSIpICYmIEQudHJpZ2dlcigiZm9jdXMiKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHAuY2FsbChJLCBNLCB0aGlzKQogICAgICAgICAgICB9KQogICAgICAgIH0oalF1ZXJ5KTsgKyBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHZhciBwID0gZnVuY3Rpb24oYSwgaykgewogICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudCA9IHRoaXMuaG92ZXJTdGF0ZSA9IHRoaXMudGltZW91dCA9IHRoaXMuZW5hYmxlZCA9IHRoaXMub3B0aW9ucyA9IHRoaXMudHlwZSA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLmluaXQoInRvb2x0aXAiLCBhLCBrKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLlZFUlNJT04gPSAiMy4zLjQiOwogICAgICAgICAgICBwLlRSQU5TSVRJT05fRFVSQVRJT04gPSAxNTA7CiAgICAgICAgICAgIHAuREVGQVVMVFMgPSB7CiAgICAgICAgICAgICAgICBhbmltYXRpb246ICEwLAogICAgICAgICAgICAgICAgcGxhY2VtZW50OiAidG9wIiwKICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAhMSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0idG9vbHRpcCIgcm9sZT0idG9vbHRpcCI+PGRpdiBjbGFzcz0idG9vbHRpcC1hcnJvdyI+PC9kaXY+PGRpdiBjbGFzcz0idG9vbHRpcC1pbm5lciI+PC9kaXY+PC9kaXY+JywKICAgICAgICAgICAgICAgIHRyaWdnZXI6ICJob3ZlciBmb2N1cyIsCiAgICAgICAgICAgICAgICB0aXRsZTogIiIsCiAgICAgICAgICAgICAgICBkZWxheTogMCwKICAgICAgICAgICAgICAgIGh0bWw6ICExLAogICAgICAgICAgICAgICAgY29udGFpbmVyOiAhMSwKICAgICAgICAgICAgICAgIHZpZXdwb3J0OiB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6ICJib2R5IiwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihrLCB2LCBwKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmFibGVkID0gITAsIHRoaXMudHlwZSA9IGssIHRoaXMuJGVsZW1lbnQgPSBhKHYpLCB0aGlzLm9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnMocCksIHRoaXMuJHZpZXdwb3J0ID0gdGhpcy5vcHRpb25zLnZpZXdwb3J0ICYmIGEodGhpcy5vcHRpb25zLnZpZXdwb3J0LnNlbGVjdG9yIHx8IHRoaXMub3B0aW9ucy52aWV3cG9ydCksIHRoaXMuJGVsZW1lbnRbMF0gaW5zdGFuY2VvZiBkb2N1bWVudC5jb25zdHJ1Y3RvciAmJiAhdGhpcy5vcHRpb25zLnNlbGVjdG9yKSB0aHJvdyBFcnJvcigiYHNlbGVjdG9yYCBvcHRpb24gbXVzdCBiZSBzcGVjaWZpZWQgd2hlbiBpbml0aWFsaXppbmcgIiArIHRoaXMudHlwZSArICIgb24gdGhlIHdpbmRvdy5kb2N1bWVudCBvYmplY3QhIik7CiAgICAgICAgICAgICAgICBrID0gdGhpcy5vcHRpb25zLnRyaWdnZXIuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICAgIGZvciAodiA9IGsubGVuZ3RoOyB2LS07KQogICAgICAgICAgICAgICAgICAgIGlmIChwID0ga1t2XSwgImNsaWNrIiA9PSBwKSB0aGlzLiRlbGVtZW50Lm9uKCJjbGljay4iICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsIGEucHJveHkodGhpcy50b2dnbGUsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgibWFudWFsIiAhPSBwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIE0gPSAiaG92ZXIiID09IHAgPyAibW91c2VsZWF2ZSIgOiAiZm9jdXNvdXQiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQub24oKCJob3ZlciIgPT0gcCA/ICJtb3VzZWVudGVyIiA6ICJmb2N1c2luIikgKyAiLiIgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgYS5wcm94eSh0aGlzLmVudGVyLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5vbihNICsgIi4iICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsIGEucHJveHkodGhpcy5sZWF2ZSwgdGhpcykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2VsZWN0b3IgPyB0aGlzLl9vcHRpb25zID0gYS5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgewogICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6ICJtYW51YWwiLAogICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAiIgogICAgICAgICAgICAgICAgfSkgOiB0aGlzLmZpeFRpdGxlKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuZ2V0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLkRFRkFVTFRTCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gayA9IGEuZXh0ZW5kKHt9LCB0aGlzLmdldERlZmF1bHRzKCksIHRoaXMuJGVsZW1lbnQuZGF0YSgpLAogICAgICAgICAgICAgICAgICAgIGspLCBrLmRlbGF5ICYmICJudW1iZXIiID09IHR5cGVvZiBrLmRlbGF5ICYmIChrLmRlbGF5ID0gewogICAgICAgICAgICAgICAgICAgIHNob3c6IGsuZGVsYXksCiAgICAgICAgICAgICAgICAgICAgaGlkZTogay5kZWxheQogICAgICAgICAgICAgICAgfSksIGsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgayA9IHt9LAogICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLmdldERlZmF1bHRzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucyAmJiBhLmVhY2godGhpcy5fb3B0aW9ucywgZnVuY3Rpb24oYSwgcCkgewogICAgICAgICAgICAgICAgICAgIHZbYV0gIT0gcCAmJiAoa1thXSA9IHApCiAgICAgICAgICAgICAgICB9KSwgawogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHZhciB2ID0gayBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPyBrIDogYShrLmN1cnJlbnRUYXJnZXQpLmRhdGEoImJzLiIgKyB0aGlzLnR5cGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHYgJiYgdi4kdGlwICYmIHYuJHRpcC5pcygiOnZpc2libGUiKSA/IHZvaWQodi5ob3ZlclN0YXRlID0gImluIikgOiAodiB8fCAodiA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKGsuY3VycmVudFRhcmdldCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSksIGEoay5jdXJyZW50VGFyZ2V0KS5kYXRhKCJicy4iICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUsIHYpKSwgY2xlYXJUaW1lb3V0KHYudGltZW91dCksIHYuaG92ZXJTdGF0ZSA9ICJpbiIsIHYub3B0aW9ucy5kZWxheSAmJiB2Lm9wdGlvbnMuZGVsYXkuc2hvdyA/IHZvaWQodi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAiaW4iID09IHYuaG92ZXJTdGF0ZSAmJiB2LnNob3coKQogICAgICAgICAgICAgICAgfSwgdi5vcHRpb25zLmRlbGF5LnNob3cpKSA6IHYuc2hvdygpKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5sZWF2ZSA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHZhciB2ID0gayBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPyBrIDogYShrLmN1cnJlbnRUYXJnZXQpLmRhdGEoImJzLiIgKyB0aGlzLnR5cGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHYgfHwgKHYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihrLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLCBhKGsuY3VycmVudFRhcmdldCkuZGF0YSgiYnMuIiArIHRoaXMudHlwZSwgdikpLCBjbGVhclRpbWVvdXQodi50aW1lb3V0KSwgdi5ob3ZlclN0YXRlID0gIm91dCIsIHYub3B0aW9ucy5kZWxheSAmJiB2Lm9wdGlvbnMuZGVsYXkuaGlkZSA/CiAgICAgICAgICAgICAgICAgICAgdm9pZCh2LnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAib3V0IiA9PSB2LmhvdmVyU3RhdGUgJiYgdi5oaWRlKCkKICAgICAgICAgICAgICAgICAgICB9LCB2Lm9wdGlvbnMuZGVsYXkuaGlkZSkpIDogdi5oaWRlKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBhLkV2ZW50KCJzaG93LmJzLiIgKyB0aGlzLnR5cGUpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQ29udGVudCgpICYmIHRoaXMuZW5hYmxlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihrKTsKICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IGEuY29udGFpbnModGhpcy4kZWxlbWVudFswXS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgdGhpcy4kZWxlbWVudFswXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFrLmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEYgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHRoaXMudGlwKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy5nZXRVSUQodGhpcy50eXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGsuYXR0cigiaWQiLCB2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWxlbWVudC5hdHRyKCJhcmlhLWRlc2NyaWJlZGJ5Iiwgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hbmltYXRpb24gJiYgay5hZGRDbGFzcygiZmFkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQgPyB0aGlzLm9wdGlvbnMucGxhY2VtZW50LmNhbGwodGhpcywga1swXSwgdGhpcy4kZWxlbWVudFswXSkgOiB0aGlzLm9wdGlvbnMucGxhY2VtZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IC9ccz9hdXRvP1xzPy9pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA9IE0udGVzdCh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgSSAmJiAodiA9IHYucmVwbGFjZShNLCAiIikgfHwgInRvcCIpOwogICAgICAgICAgICAgICAgICAgICAgICBrLmRldGFjaCgpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIgogICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcyh2KS5kYXRhKCJicy4iICsgdGhpcy50eXBlLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNvbnRhaW5lciA/IGsuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcikgOiBrLmluc2VydEFmdGVyKHRoaXMuJGVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgTSA9IHRoaXMuZ2V0UG9zaXRpb24oKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBrWzBdLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTyA9IGtbMF0ub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEkgPSB2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyID8gYSh0aGlzLm9wdGlvbnMuY29udGFpbmVyKSA6IHRoaXMuJGVsZW1lbnQucGFyZW50KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUCA9IHRoaXMuZ2V0UG9zaXRpb24oUCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9ICJib3R0b20iID09IHYgJiYgTS5ib3R0b20gKyBPID4gUC5ib3R0b20gPyAidG9wIiA6ICJ0b3AiID09IHYgJiYgTS50b3AgLSBPIDwgUC50b3AgPyAiYm90dG9tIiA6ICJyaWdodCIgPT0gdiAmJiBNLnJpZ2h0ICsgUyA+IFAud2lkdGggPyAibGVmdCIgOiAibGVmdCIgPT0gdiAmJiBNLmxlZnQgLSBTIDwgUC5sZWZ0ID8gInJpZ2h0IiA6IHY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrLnJlbW92ZUNsYXNzKEkpLmFkZENsYXNzKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgTSA9IHRoaXMuZ2V0Q2FsY3VsYXRlZE9mZnNldCh2LCBNLCBTLCBPKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVBsYWNlbWVudChNLCB2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBGLmhvdmVyU3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGLiRlbGVtZW50LnRyaWdnZXIoInNob3duLmJzLiIgKyBGLnR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRi5ob3ZlclN0YXRlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvdXQiID09IGEgJiYgRi5sZWF2ZShGKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKSA/IGsub25lKCJic1RyYW5zaXRpb25FbmQiLCB2KS5lbXVsYXRlVHJhbnNpdGlvbkVuZChwLlRSQU5TSVRJT05fRFVSQVRJT04pIDogdigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5hcHBseVBsYWNlbWVudCA9CiAgICAgICAgICAgICAgICBmdW5jdGlvbihrLCB2KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLnRpcCgpLAogICAgICAgICAgICAgICAgICAgICAgICBNID0gcFswXS5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgSSA9IHBbMF0ub2Zmc2V0SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBTID0gcGFyc2VJbnQocC5jc3MoIm1hcmdpbi10b3AiKSwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICBPID0gcGFyc2VJbnQocC5jc3MoIm1hcmdpbi1sZWZ0IiksIDEwKTsKICAgICAgICAgICAgICAgICAgICBpc05hTihTKSAmJiAoUyA9IDApOwogICAgICAgICAgICAgICAgICAgIGlzTmFOKE8pICYmIChPID0gMCk7CiAgICAgICAgICAgICAgICAgICAgay50b3AgKz0gUzsKICAgICAgICAgICAgICAgICAgICBrLmxlZnQgKz0gTzsKICAgICAgICAgICAgICAgICAgICBhLm9mZnNldC5zZXRPZmZzZXQocFswXSwgYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICB1c2luZzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogTWF0aC5yb3VuZChhLnRvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogTWF0aC5yb3VuZChhLmxlZnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgayksIDApOwogICAgICAgICAgICAgICAgICAgIHAuYWRkQ2xhc3MoImluIik7CiAgICAgICAgICAgICAgICAgICAgdmFyIE8gPSBwWzBdLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBQID0gcFswXS5vZmZzZXRIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgInRvcCIgPT0gdiAmJiBQICE9IEkgJiYgKGsudG9wID0gay50b3AgKyBJIC0gUCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIFYgPSB0aGlzLmdldFZpZXdwb3J0QWRqdXN0ZWREZWx0YSh2LCBrLCBPLCBQKTsKICAgICAgICAgICAgICAgICAgICBWLmxlZnQgPyBrLmxlZnQgKz0gVi5sZWZ0IDogay50b3AgKz0gVi50b3A7CiAgICAgICAgICAgICAgICAgICAgTSA9IChTID0gL3RvcHxib3R0b20vLnRlc3QodikpID8KICAgICAgICAgICAgICAgICAgICAgICAgMiAqIFYubGVmdCAtIE0gKyBPIDogMiAqIFYudG9wIC0gSSArIFA7CiAgICAgICAgICAgICAgICAgICAgSSA9IFMgPyAib2Zmc2V0V2lkdGgiIDogIm9mZnNldEhlaWdodCI7CiAgICAgICAgICAgICAgICAgICAgcC5vZmZzZXQoayk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlQXJyb3coTSwgcFswXVtJXSwgUykKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLnJlcGxhY2VBcnJvdyA9IGZ1bmN0aW9uKGEsIGssIHApIHsKICAgICAgICAgICAgICAgIHRoaXMuYXJyb3coKS5jc3MocCA/ICJsZWZ0IiA6ICJ0b3AiLCA1MCAqICgxIC0gYSAvIGspICsgIiUiKS5jc3MocCA/ICJ0b3AiIDogImxlZnQiLCAiIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLnRpcCgpLAogICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLmdldFRpdGxlKCk7CiAgICAgICAgICAgICAgICBhLmZpbmQoIi50b29sdGlwLWlubmVyIilbdGhpcy5vcHRpb25zLmh0bWwgPyAiaHRtbCIgOiAidGV4dCJdKGspOwogICAgICAgICAgICAgICAgYS5yZW1vdmVDbGFzcygiZmFkZSBpbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oaykgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gdigpIHsKICAgICAgICAgICAgICAgICAgICAiaW4iICE9IEYuaG92ZXJTdGF0ZSAmJiBNLmRldGFjaCgpOwogICAgICAgICAgICAgICAgICAgIEYuJGVsZW1lbnQucmVtb3ZlQXR0cigiYXJpYS1kZXNjcmliZWRieSIpLnRyaWdnZXIoImhpZGRlbi5icy4iICsKICAgICAgICAgICAgICAgICAgICAgICAgRi50eXBlKTsKICAgICAgICAgICAgICAgICAgICBrICYmIGsoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIEYgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIE0gPSBhKHRoaXMuJHRpcCksCiAgICAgICAgICAgICAgICAgICAgSSA9IGEuRXZlbnQoImhpZGUuYnMuIiArIHRoaXMudHlwZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKEkpLCBJLmlzRGVmYXVsdFByZXZlbnRlZCgpID8gdm9pZCAwIDogKE0ucmVtb3ZlQ2xhc3MoImluIiksIGEuc3VwcG9ydC50cmFuc2l0aW9uICYmIE0uaGFzQ2xhc3MoImZhZGUiKSA/IE0ub25lKCJic1RyYW5zaXRpb25FbmQiLCB2KS5lbXVsYXRlVHJhbnNpdGlvbkVuZChwLlRSQU5TSVRJT05fRFVSQVRJT04pIDogdigpLCB0aGlzLmhvdmVyU3RhdGUgPSBudWxsLCB0aGlzKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5maXhUaXRsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLiRlbGVtZW50OwogICAgICAgICAgICAgICAgKGEuYXR0cigidGl0bGUiKSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgYS5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIikpICYmIGEuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIsIGEuYXR0cigidGl0bGUiKSB8fCAiIikuYXR0cigidGl0bGUiLCAiIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuaGFzQ29udGVudCA9CiAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIGsgPSBrIHx8IHRoaXMuJGVsZW1lbnQ7CiAgICAgICAgICAgICAgICB2YXIgdiA9IGtbMF0sCiAgICAgICAgICAgICAgICAgICAgcCA9ICJCT0RZIiA9PSB2LnRhZ05hbWUsCiAgICAgICAgICAgICAgICAgICAgdiA9IHYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBudWxsID09IHYud2lkdGggJiYgKHYgPSBhLmV4dGVuZCh7fSwgdiwgewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiB2LnJpZ2h0IC0gdi5sZWZ0LAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogdi5ib3R0b20gLSB2LnRvcAogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgdmFyIE0gPSBwID8gewogICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICB9IDogay5vZmZzZXQoKTsKICAgICAgICAgICAgICAgIGsgPSB7CiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsOiBwID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA6IGsuc2Nyb2xsVG9wKCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwID0gcCA/IHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogYSh3aW5kb3cpLndpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhKHdpbmRvdykuaGVpZ2h0KCkKICAgICAgICAgICAgICAgIH0gOiBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIGEuZXh0ZW5kKHt9LCB2LCBrLCBwLCBNKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5nZXRDYWxjdWxhdGVkT2Zmc2V0ID0gZnVuY3Rpb24oYSwgaywgcCwgTSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJib3R0b20iID09CiAgICAgICAgICAgICAgICAgICAgYSA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBrLnRvcCArIGsuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBrLmxlZnQgKyBrLndpZHRoIC8gMiAtIHAgLyAyCiAgICAgICAgICAgICAgICAgICAgfSA6ICJ0b3AiID09IGEgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogay50b3AgLSBNLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBrLmxlZnQgKyBrLndpZHRoIC8gMiAtIHAgLyAyCiAgICAgICAgICAgICAgICAgICAgfSA6ICJsZWZ0IiA9PSBhID8gewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGsudG9wICsgay5oZWlnaHQgLyAyIC0gTSAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGsubGVmdCAtIHAKICAgICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGsudG9wICsgay5oZWlnaHQgLyAyIC0gTSAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGsubGVmdCArIGsud2lkdGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmdldFZpZXdwb3J0QWRqdXN0ZWREZWx0YSA9IGZ1bmN0aW9uKGEsIGssIHAsIE0pIHsKICAgICAgICAgICAgICAgIHZhciBJID0gewogICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLiR2aWV3cG9ydCkgcmV0dXJuIEk7CiAgICAgICAgICAgICAgICB2YXIgUyA9IHRoaXMub3B0aW9ucy52aWV3cG9ydCAmJiB0aGlzLm9wdGlvbnMudmlld3BvcnQucGFkZGluZyB8fCAwLAogICAgICAgICAgICAgICAgICAgIE8gPSB0aGlzLmdldFBvc2l0aW9uKHRoaXMuJHZpZXdwb3J0KTsKICAgICAgICAgICAgICAgIC9yaWdodHxsZWZ0Ly50ZXN0KGEpID8gKHAgPSBrLnRvcCAtIFMgLSBPLnNjcm9sbCwgayA9IGsudG9wICsgUyAtIE8uc2Nyb2xsICsgTSwgcCA8IE8udG9wID8gSS50b3AgPSBPLnRvcCAtIHAgOiBrID4gTy50b3AgKyBPLmhlaWdodCAmJiAoSS50b3AgPQogICAgICAgICAgICAgICAgICAgIE8udG9wICsgTy5oZWlnaHQgLSBrKSkgOiAoTSA9IGsubGVmdCAtIFMsIGsgPSBrLmxlZnQgKyBTICsgcCwgTSA8IE8ubGVmdCA/IEkubGVmdCA9IE8ubGVmdCAtIE0gOiBrID4gTy53aWR0aCAmJiAoSS5sZWZ0ID0gTy5sZWZ0ICsgTy53aWR0aCAtIGspKTsKICAgICAgICAgICAgICAgIHJldHVybiBJCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmdldFRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuJGVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgayA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgIHJldHVybiBhLmF0dHIoImRhdGEtb3JpZ2luYWwtdGl0bGUiKSB8fCAoImZ1bmN0aW9uIiA9PSB0eXBlb2Ygay50aXRsZSA/IGsudGl0bGUuY2FsbChhWzBdKSA6IGsudGl0bGUpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmdldFVJRCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIGRvIGEgKz0gfn4oMUU2ICogTWF0aC5yYW5kb20oKSk7IHdoaWxlIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS50aXAgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiR0aXAgPSB0aGlzLiR0aXAgfHwgYSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmFycm93ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kYXJyb3cgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuJGFycm93IHx8IHRoaXMudGlwKCkuZmluZCgiLnRvb2x0aXAtYXJyb3ciKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9ICEwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9ICExCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLnRvZ2dsZUVuYWJsZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9ICF0aGlzLmVuYWJsZWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oaykgewogICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzOwogICAgICAgICAgICAgICAgayAmJiAocCA9IGEoay5jdXJyZW50VGFyZ2V0KS5kYXRhKCJicy4iICsgdGhpcy50eXBlKSwgcCB8fCAocCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKGsuY3VycmVudFRhcmdldCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSksIGEoay5jdXJyZW50VGFyZ2V0KS5kYXRhKCJicy4iICsgdGhpcy50eXBlLCBwKSkpOwogICAgICAgICAgICAgICAgcC50aXAoKS5oYXNDbGFzcygiaW4iKSA/IHAubGVhdmUocCkgOiBwLmVudGVyKHApCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gdGhpczsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGhpcy5oaWRlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGEuJGVsZW1lbnQub2ZmKCIuIiArIGEudHlwZSkucmVtb3ZlRGF0YSgiYnMuIiArIGEudHlwZSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBrID0gYS5mbi50b29sdGlwOwogICAgICAgICAgICBhLmZuLnRvb2x0aXAgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgRiA9IHYuZGF0YSgiYnMudG9vbHRpcCIpLAogICAgICAgICAgICAgICAgICAgICAgICBNID0gIm9iamVjdCIgPT0gdHlwZW9mIGsgJiYgazsKICAgICAgICAgICAgICAgICAgICAhRiAmJiAvZGVzdHJveXxoaWRlLy50ZXN0KGspIHx8IChGIHx8IHYuZGF0YSgiYnMudG9vbHRpcCIsIEYgPSBuZXcgcCh0aGlzLCBNKSksICJzdHJpbmciICE9IHR5cGVvZiBrIHx8IEZba10oKSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4udG9vbHRpcC5Db25zdHJ1Y3RvciA9IHA7CiAgICAgICAgICAgIGEuZm4udG9vbHRpcC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5mbi50b29sdGlwID0gaywgdGhpcwogICAgICAgICAgICB9CiAgICAgICAgfShqUXVlcnkpOyArIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdmFyIHAgPSBmdW5jdGlvbihhLCBrKSB7CiAgICAgICAgICAgICAgICB0aGlzLmluaXQoInBvcG92ZXIiLCBhLCBrKQogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoIWEuZm4udG9vbHRpcCkgdGhyb3cgRXJyb3IoIlBvcG92ZXIgcmVxdWlyZXMgdG9vbHRpcC5qcyIpOwogICAgICAgICAgICBwLlZFUlNJT04gPSAiMy4zLjQiOwogICAgICAgICAgICBwLkRFRkFVTFRTID0gYS5leHRlbmQoe30sIGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUywgewogICAgICAgICAgICAgICAgcGxhY2VtZW50OiAicmlnaHQiLAogICAgICAgICAgICAgICAgdHJpZ2dlcjogImNsaWNrIiwKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICIiLAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPSJwb3BvdmVyIiByb2xlPSJ0b29sdGlwIj48ZGl2IGNsYXNzPSJhcnJvdyI+PC9kaXY+PGgzIGNsYXNzPSJwb3BvdmVyLXRpdGxlIj48L2gzPjxkaXYgY2xhc3M9InBvcG92ZXItY29udGVudCI+PC9kaXY+PC9kaXY+JwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcC5wcm90b3R5cGUgPSBhLmV4dGVuZCh7fSwgYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSk7CiAgICAgICAgICAgIHAucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gcDsKICAgICAgICAgICAgcC5wcm90b3R5cGUuZ2V0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLkRFRkFVTFRTCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy50aXAoKSwKICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy5nZXRUaXRsZSgpLAogICAgICAgICAgICAgICAgICAgIHAgPSB0aGlzLmdldENvbnRlbnQoKTsKICAgICAgICAgICAgICAgIGEuZmluZCgiLnBvcG92ZXItdGl0bGUiKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICJodG1sIiA6ICJ0ZXh0Il0oayk7CiAgICAgICAgICAgICAgICBhLmZpbmQoIi5wb3BvdmVyLWNvbnRlbnQiKS5jaGlsZHJlbigpLmRldGFjaCgpLmVuZCgpW3RoaXMub3B0aW9ucy5odG1sID8gInN0cmluZyIgPT0gdHlwZW9mIHAgPyAiaHRtbCIgOiAiYXBwZW5kIiA6ICJ0ZXh0Il0ocCk7CiAgICAgICAgICAgICAgICBhLnJlbW92ZUNsYXNzKCJmYWRlIHRvcCBib3R0b20gbGVmdCByaWdodCBpbiIpOwogICAgICAgICAgICAgICAgYS5maW5kKCIucG9wb3Zlci10aXRsZSIpLmh0bWwoKSB8fCBhLmZpbmQoIi5wb3BvdmVyLXRpdGxlIikuaGlkZSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRpdGxlKCkgfHwgdGhpcy5nZXRDb250ZW50KCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUuZ2V0Q29udGVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLiRlbGVtZW50LAogICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5hdHRyKCJkYXRhLWNvbnRlbnQiKSB8fCAoImZ1bmN0aW9uIiA9PSB0eXBlb2Ygay5jb250ZW50ID8gay5jb250ZW50LmNhbGwoYVswXSkgOiBrLmNvbnRlbnQpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmFycm93ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kYXJyb3cgPSB0aGlzLiRhcnJvdyB8fCB0aGlzLnRpcCgpLmZpbmQoIi5hcnJvdyIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBrID0gYS5mbi5wb3BvdmVyOwogICAgICAgICAgICBhLmZuLnBvcG92ZXIgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgRiA9IHYuZGF0YSgiYnMucG9wb3ZlciIpLAogICAgICAgICAgICAgICAgICAgICAgICBNID0gIm9iamVjdCIgPT0gdHlwZW9mIGsgJiYgazsKICAgICAgICAgICAgICAgICAgICAhRiAmJiAvZGVzdHJveXxoaWRlLy50ZXN0KGspIHx8IChGIHx8IHYuZGF0YSgiYnMucG9wb3ZlciIsIEYgPSBuZXcgcCh0aGlzLCBNKSksICJzdHJpbmciICE9IHR5cGVvZiBrIHx8IEZba10oKSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4ucG9wb3Zlci5Db25zdHJ1Y3RvciA9IHA7CiAgICAgICAgICAgIGEuZm4ucG9wb3Zlci5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5mbi5wb3BvdmVyID0KICAgICAgICAgICAgICAgICAgICBrLCB0aGlzCiAgICAgICAgICAgIH0KICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKGssIEYpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGJvZHkgPSBhKGRvY3VtZW50LmJvZHkpOwogICAgICAgICAgICAgICAgdGhpcy4kc2Nyb2xsRWxlbWVudCA9IGEoYShrKS5pcyhkb2N1bWVudC5ib2R5KSA/IHdpbmRvdyA6IGspOwogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gYS5leHRlbmQoe30sIHAuREVGQVVMVFMsIEYpOwogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9ICh0aGlzLm9wdGlvbnMudGFyZ2V0IHx8ICIiKSArICIgLm5hdiBsaSA+IGEiOwogICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldHMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuJHNjcm9sbEVsZW1lbnQub24oInNjcm9sbC5icy5zY3JvbGxzcHkiLCBhLnByb3h5KHRoaXMucHJvY2VzcywgdGhpcykpOwogICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoKQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBrKGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEYgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBNID0gRi5kYXRhKCJicy5zY3JvbGxzcHkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgSSA9ICJvYmplY3QiID09IHR5cGVvZiBrICYmIGs7CiAgICAgICAgICAgICAgICAgICAgTSB8fCBGLmRhdGEoImJzLnNjcm9sbHNweSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBuZXcgcCh0aGlzLCBJKSk7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGsgJiYgTVtrXSgpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHAuVkVSU0lPTiA9ICIzLjMuNCI7CiAgICAgICAgICAgIHAuREVGQVVMVFMgPSB7CiAgICAgICAgICAgICAgICBvZmZzZXQ6IDEwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHAucHJvdG90eXBlLmdldFNjcm9sbEhlaWdodCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHNjcm9sbEVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0IHx8IE1hdGgubWF4KHRoaXMuJGJvZHlbMF0uc2Nyb2xsSGVpZ2h0LCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0KQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgayA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgcCA9ICJvZmZzZXQiLAogICAgICAgICAgICAgICAgICAgIE0gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldHMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGEuaXNXaW5kb3codGhpcy4kc2Nyb2xsRWxlbWVudFswXSkgfHwgKHAgPSAicG9zaXRpb24iLCBNID0gdGhpcy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSk7CiAgICAgICAgICAgICAgICB0aGlzLiRib2R5LmZpbmQodGhpcy5zZWxlY3RvcikubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0KICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgayA9IGsuZGF0YSgidGFyZ2V0IikgfHwgay5hdHRyKCJocmVmIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSAvXiMuLy50ZXN0KGspICYmIGEoayk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYgJiYgdi5sZW5ndGggJiYgdi5pcygiOnZpc2libGUiKSAmJiBbCiAgICAgICAgICAgICAgICAgICAgICAgIFt2W3BdKCkudG9wICsgTSwga10KICAgICAgICAgICAgICAgICAgICBdIHx8IG51bGwKICAgICAgICAgICAgICAgIH0pLnNvcnQoZnVuY3Rpb24oYSwgaykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhWzBdIC0ga1swXQogICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBrLm9mZnNldHMucHVzaCh0aGlzWzBdKTsKICAgICAgICAgICAgICAgICAgICBrLnRhcmdldHMucHVzaCh0aGlzWzFdKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcC5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGEsIGsgPSB0aGlzLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpICsgdGhpcy5vcHRpb25zLm9mZnNldCwKICAgICAgICAgICAgICAgICAgICBwID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICBJID0gdGhpcy5vcHRpb25zLm9mZnNldCArIHAgLSB0aGlzLiRzY3JvbGxFbGVtZW50LmhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgIEQgPSB0aGlzLm9mZnNldHMsCiAgICAgICAgICAgICAgICAgICAgTyA9IHRoaXMudGFyZ2V0cywKICAgICAgICAgICAgICAgICAgICBQID0gdGhpcy5hY3RpdmVUYXJnZXQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxIZWlnaHQgIT0gcCAmJiB0aGlzLnJlZnJlc2goKSwgayA+PSBJKSByZXR1cm4gUCAhPQogICAgICAgICAgICAgICAgICAgIChhID0gT1tPLmxlbmd0aCAtIDFdKSAmJiB0aGlzLmFjdGl2YXRlKGEpOwogICAgICAgICAgICAgICAgaWYgKFAgJiYgayA8IERbMF0pIHJldHVybiB0aGlzLmFjdGl2ZVRhcmdldCA9IG51bGwsIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGZvciAoYSA9IEQubGVuZ3RoOyBhLS07KSBQICE9IE9bYV0gJiYgayA+PSBEW2FdICYmICh2b2lkIDAgPT09IERbYSArIDFdIHx8IGsgPCBEW2EgKyAxXSkgJiYgdGhpcy5hY3RpdmF0ZShPW2FdKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVGFyZ2V0ID0gazsKICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGsgPSBhKHRoaXMuc2VsZWN0b3IgKyAnW2RhdGEtdGFyZ2V0PSInICsgayArICciXSwnICsgdGhpcy5zZWxlY3RvciArICdbaHJlZj0iJyArIGsgKyAnIl0nKS5wYXJlbnRzKCJsaSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGsucGFyZW50KCIuZHJvcGRvd24tbWVudSIpLmxlbmd0aCAmJiAoayA9IGsuY2xvc2VzdCgibGkuZHJvcGRvd24iKS5hZGRDbGFzcygiYWN0aXZlIikpOwogICAgICAgICAgICAgICAgay50cmlnZ2VyKCJhY3RpdmF0ZS5icy5zY3JvbGxzcHkiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYSh0aGlzLnNlbGVjdG9yKS5wYXJlbnRzVW50aWwodGhpcy5vcHRpb25zLnRhcmdldCwKICAgICAgICAgICAgICAgICAgICAiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgRCA9IGEuZm4uc2Nyb2xsc3B5OwogICAgICAgICAgICBhLmZuLnNjcm9sbHNweSA9IGs7CiAgICAgICAgICAgIGEuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yID0gcDsKICAgICAgICAgICAgYS5mbi5zY3JvbGxzcHkubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEuZm4uc2Nyb2xsc3B5ID0gRCwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICBhKHdpbmRvdykub24oImxvYWQuYnMuc2Nyb2xsc3B5LmRhdGEtYXBpIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBhKCdbZGF0YS1zcHk9InNjcm9sbCJdJykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgay5jYWxsKHAsIHAuZGF0YSgpKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KGpRdWVyeSk7ICsgZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmdW5jdGlvbiBwKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBJID0gdi5kYXRhKCJicy50YWIiKTsKICAgICAgICAgICAgICAgICAgICBJIHx8IHYuZGF0YSgiYnMudGFiIiwgSSA9IG5ldyBrKHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgcCAmJiBJW3BdKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGsgPSBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBhKGspCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsuVkVSU0lPTiA9ICIzLjMuNCI7CiAgICAgICAgICAgIGsuVFJBTlNJVElPTl9EVVJBVElPTiA9IDE1MDsKICAgICAgICAgICAgay5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGsgPSB0aGlzLmVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgcCA9IGsuY2xvc2VzdCgidWw6bm90KC5kcm9wZG93bi1tZW51KSIpLAogICAgICAgICAgICAgICAgICAgIHYgPSBrLmRhdGEoInRhcmdldCIpOwogICAgICAgICAgICAgICAgaWYgKHYgfHwgKHYgPSBrLmF0dHIoImhyZWYiKSwgdiA9IHYgJiYgdi5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sICIiKSksICFrLnBhcmVudCgibGkiKS5oYXNDbGFzcygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IHAuZmluZCgiLmFjdGl2ZTpsYXN0IGEiKSwKICAgICAgICAgICAgICAgICAgICAgICAgTyA9IGEuRXZlbnQoImhpZGUuYnMudGFiIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDoga1swXQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgUCA9IGEuRXZlbnQoInNob3cuYnMudGFiIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogRFswXQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAoRC50cmlnZ2VyKE8pLCBrLnRyaWdnZXIoUCksIFAuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgTy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgfHwgKHYgPSBhKHYpLCB0aGlzLmFjdGl2YXRlKGsuY2xvc2VzdCgibGkiKSwgcCksIHRoaXMuYWN0aXZhdGUodiwgdi5wYXJlbnQoKSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEQudHJpZ2dlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaGlkZGVuLmJzLnRhYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBrWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBrLnRyaWdnZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInNob3duLmJzLnRhYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBEWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24ocCwgdiwgSSkgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gRCgpIHsKICAgICAgICAgICAgICAgICAgICBPLnJlbW92ZUNsYXNzKCJhY3RpdmUiKS5maW5kKCI+IC5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKS5lbmQoKS5maW5kKCdbZGF0YS10b2dnbGU9InRhYiJdJykuYXR0cigiYXJpYS1leHBhbmRlZCIsICExKTsKICAgICAgICAgICAgICAgICAgICBwLmFkZENsYXNzKCJhY3RpdmUiKS5maW5kKCdbZGF0YS10b2dnbGU9InRhYiJdJykuYXR0cigiYXJpYS1leHBhbmRlZCIsICEwKTsKICAgICAgICAgICAgICAgICAgICBQID8gKHBbMF0ub2Zmc2V0V2lkdGgsIHAuYWRkQ2xhc3MoImluIikpIDogcC5yZW1vdmVDbGFzcygiZmFkZSIpOwogICAgICAgICAgICAgICAgICAgIHAucGFyZW50KCIuZHJvcGRvd24tbWVudSIpLmxlbmd0aCAmJiBwLmNsb3Nlc3QoImxpLmRyb3Bkb3duIikuYWRkQ2xhc3MoImFjdGl2ZSIpLmVuZCgpLmZpbmQoJ1tkYXRhLXRvZ2dsZT0idGFiIl0nKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgITApOwogICAgICAgICAgICAgICAgICAgIEkgJiYgSSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgTyA9IHYuZmluZCgiPiAuYWN0aXZlIiksCiAgICAgICAgICAgICAgICAgICAgUCA9IEkgJiYgYS5zdXBwb3J0LnRyYW5zaXRpb24gJiYgKE8ubGVuZ3RoICYmIE8uaGFzQ2xhc3MoImZhZGUiKSB8fCAhIXYuZmluZCgiPiAuZmFkZSIpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBPLmxlbmd0aCAmJiBQID8gTy5vbmUoImJzVHJhbnNpdGlvbkVuZCIsIEQpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKGsuVFJBTlNJVElPTl9EVVJBVElPTikgOiBEKCk7CiAgICAgICAgICAgICAgICBPLnJlbW92ZUNsYXNzKCJpbiIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBEID0KICAgICAgICAgICAgICAgIGEuZm4udGFiOwogICAgICAgICAgICBhLmZuLnRhYiA9IHA7CiAgICAgICAgICAgIGEuZm4udGFiLkNvbnN0cnVjdG9yID0gazsKICAgICAgICAgICAgYS5mbi50YWIubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEuZm4udGFiID0gRCwgdGhpcwogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgdiA9IGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICAgIGsucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHAuY2FsbChhKHRoaXMpLCAic2hvdyIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy50YWIuZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlPSJ0YWIiXScsIHYpLm9uKCJjbGljay5icy50YWIuZGF0YS1hcGkiLCAnW2RhdGEtdG9nZ2xlPSJwaWxsIl0nLCB2KQogICAgICAgIH0oalF1ZXJ5KTsgKyBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgRiA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIEQgPSBGLmRhdGEoImJzLmFmZml4IiksCiAgICAgICAgICAgICAgICAgICAgICAgIEkgPSAib2JqZWN0IiA9PSB0eXBlb2YgcCAmJiBwOwogICAgICAgICAgICAgICAgICAgIEQgfHwgRi5kYXRhKCJicy5hZmZpeCIsIEQgPSBuZXcgayh0aGlzLCBJKSk7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIHAgJiYgRFtwXSgpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBrID0gZnVuY3Rpb24ocCwgRikgewogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gYS5leHRlbmQoe30sIGsuREVGQVVMVFMsIEYpOwogICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0ID0gYSh0aGlzLm9wdGlvbnMudGFyZ2V0KS5vbigic2Nyb2xsLmJzLmFmZml4LmRhdGEtYXBpIiwgYS5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sIHRoaXMpKS5vbigiY2xpY2suYnMuYWZmaXguZGF0YS1hcGkiLCBhLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AsIHRoaXMpKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQgPSBhKHApOwogICAgICAgICAgICAgICAgdGhpcy5waW5uZWRPZmZzZXQgPSB0aGlzLnVucGluID0gdGhpcy5hZmZpeGVkID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tQb3NpdGlvbigpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsuVkVSU0lPTiA9ICIzLjMuNCI7CiAgICAgICAgICAgIGsuUkVTRVQgPSAiYWZmaXggYWZmaXgtdG9wIGFmZml4LWJvdHRvbSI7CiAgICAgICAgICAgIGsuREVGQVVMVFMgPSB7CiAgICAgICAgICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICB0YXJnZXQ6IHdpbmRvdwogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uKGEsIGssIHAsIEkpIHsKICAgICAgICAgICAgICAgIHZhciBEID0gdGhpcy4kdGFyZ2V0LnNjcm9sbFRvcCgpLAogICAgICAgICAgICAgICAgICAgIE8gPSB0aGlzLiRlbGVtZW50Lm9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgIFAgPSB0aGlzLiR0YXJnZXQuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBwICYmICJ0b3AiID09IHRoaXMuYWZmaXhlZCkgcmV0dXJuIHAgPiBEID8gInRvcCIgOiAhMTsKICAgICAgICAgICAgICAgIGlmICgiYm90dG9tIiA9PSB0aGlzLmFmZml4ZWQpIHJldHVybiBudWxsICE9IHAgPyBEICsgdGhpcy51bnBpbiA8PSBPLnRvcCA/ICExIDogImJvdHRvbSIgOiBhIC0gSSA+PSBEICsgUCA/ICExIDogImJvdHRvbSI7CiAgICAgICAgICAgICAgICB2YXIgViA9IG51bGwgPT0gdGhpcy5hZmZpeGVkLAogICAgICAgICAgICAgICAgICAgIE8gPSBWID8gRCA6IE8udG9wOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT0gcCAmJiBwID49IEQgPyAidG9wIiA6IG51bGwgIT0gSSAmJiBPICsgKFYgPyBQIDogaykgPj0gYSAtIEkgPyAiYm90dG9tIiA6ICExCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGsucHJvdG90eXBlLmdldFBpbm5lZE9mZnNldCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucGlubmVkT2Zmc2V0KSByZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQ7CiAgICAgICAgICAgICAgICB0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKGsuUkVTRVQpLmFkZENsYXNzKCJhZmZpeCIpOwogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLiR0YXJnZXQuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQgPSB0aGlzLiRlbGVtZW50Lm9mZnNldCgpLnRvcCAtIGEKICAgICAgICAgICAgfTsKICAgICAgICAgICAgay5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYS5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sIHRoaXMpLCAxKQogICAgICAgICAgICB9OwogICAgICAgICAgICBrLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy4kZWxlbWVudC5pcygiOnZpc2libGUiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwID0gdGhpcy4kZWxlbWVudC5oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgRiA9IHRoaXMub3B0aW9ucy5vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIEQgPSBGLnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgSSA9IEYuYm90dG9tLAogICAgICAgICAgICAgICAgICAgICAgICBTID0gYShkb2N1bWVudC5ib2R5KS5oZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICAib2JqZWN0IiAhPSB0eXBlb2YgRiAmJiAoSSA9IEQgPSBGKTsKICAgICAgICAgICAgICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBEICYmIChEID0gRi50b3AodGhpcy4kZWxlbWVudCkpOwogICAgICAgICAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIEkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKEkgPSBGLmJvdHRvbSh0aGlzLiRlbGVtZW50KSk7CiAgICAgICAgICAgICAgICAgICAgRiA9IHRoaXMuZ2V0U3RhdGUoUywgcCwgRCwgSSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWZmaXhlZCAhPSBGKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy51bnBpbiAmJiB0aGlzLiRlbGVtZW50LmNzcygidG9wIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgRCA9ICJhZmZpeCIgKyAoRiA/ICItIiArIEYgOiAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPID0gYS5FdmVudChEICsgIi5icy5hZmZpeCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kZWxlbWVudC50cmlnZ2VyKE8pLCBPLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWZmaXhlZCA9IEY7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5waW4gPSAiYm90dG9tIiA9PSBGID8gdGhpcy5nZXRQaW5uZWRPZmZzZXQoKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3Moay5SRVNFVCkuYWRkQ2xhc3MoRCkudHJpZ2dlcihELnJlcGxhY2UoImFmZml4IiwgImFmZml4ZWQiKSArICIuYnMuYWZmaXgiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAiYm90dG9tIiA9PSBGICYmIHRoaXMuJGVsZW1lbnQub2Zmc2V0KHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBTIC0gcCAtIEkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgRCA9IGEuZm4uYWZmaXg7CiAgICAgICAgICAgIGEuZm4uYWZmaXggPSBwOwogICAgICAgICAgICBhLmZuLmFmZml4LkNvbnN0cnVjdG9yID0gazsKICAgICAgICAgICAgYS5mbi5hZmZpeC5ub0NvbmZsaWN0ID0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmZuLmFmZml4ID0gRCwgdGhpcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgYSh3aW5kb3cpLm9uKCJsb2FkIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBhKCdbZGF0YS1zcHk9ImFmZml4Il0nKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgRCA9IGsuZGF0YSgpOwogICAgICAgICAgICAgICAgICAgIEQub2Zmc2V0ID0gRC5vZmZzZXQgfHwge307CiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBELm9mZnNldEJvdHRvbSAmJiAoRC5vZmZzZXQuYm90dG9tID0gRC5vZmZzZXRCb3R0b20pOwogICAgICAgICAgICAgICAgICAgIG51bGwgIT0gRC5vZmZzZXRUb3AgJiYgKEQub2Zmc2V0LnRvcCA9IEQub2Zmc2V0VG9wKTsKICAgICAgICAgICAgICAgICAgICBwLmNhbGwoaywgRCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfShqUXVlcnkpOwogICAgICAgIC8qCiAgICAgICAgIEd1cmlkZG8ganFHcmlkIEpTIC0gdjUuMC4xIC0gMjAxNS0xMC0zMAogICAgICAgICBDb3B5cmlnaHQoYykgMjAwOCwgVG9ueSBUb21vdiwgdG9ueUB0cmlyYW5kLmNvbQoKICAgICAgICAgTGljZW5zZTogaHR0cDovL2d1cmlkZG8ubmV0Lz9wYWdlX2lkPTEwMzMzNAogICAgICAgICovCiAgICAgICAgISBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsianF1ZXJ5Il0sIGEpIDogYShqUXVlcnkpCiAgICAgICAgfShmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHAoYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGMsIGQsIGwsIGUgPSBbXTsKICAgICAgICAgICAgICAgIGlmICghdGhpcyB8fCAiZnVuY3Rpb24iICE9IHR5cGVvZiBhIHx8IGEgaW5zdGFuY2VvZiBSZWdFeHApIHRocm93IG5ldyBUeXBlRXJyb3I7CiAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBsID4gYzsgYysrKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGMpICYmIChkID0gdGhpc1tjXSwgYS5jYWxsKGIsIGQsIGMsIHRoaXMpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBlLnB1c2goZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgICAgfQogICAgICAgICAgICBhLmpncmlkID0gYS5qZ3JpZCB8fCB7fTsKICAgICAgICAgICAgYS5qZ3JpZC5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdHMiKSB8fCAoYS5qZ3JpZC5kZWZhdWx0cyA9IHt9KTsKICAgICAgICAgICAgYS5leHRlbmQoYS5qZ3JpZCwgewogICAgICAgICAgICAgICAgdmVyc2lvbjogIjUuMC4xIiwKICAgICAgICAgICAgICAgIGh0bWxEZWNvZGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSAmJiAoIiZuYnNwOyIgPT09IGEgfHwgIiYjMTYwOyIgPT09IGEgfHwgMSA9PT0gYS5sZW5ndGggJiYgMTYwID09PQogICAgICAgICAgICAgICAgICAgICAgICBhLmNoYXJDb2RlQXQoMCkpID8gIiIgOiBhID8gU3RyaW5nKGEpLnJlcGxhY2UoLyZndDsvZywgIj4iKS5yZXBsYWNlKC8mbHQ7L2csICI8IikucmVwbGFjZSgvJnF1b3Q7L2csICciJykucmVwbGFjZSgvJmFtcDsvZywgIiYiKSA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBodG1sRW5jb2RlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPyBTdHJpbmcoYSkucmVwbGFjZSgvJi9nLCAiJmFtcDsiKS5yZXBsYWNlKC9cIi9nLCAiJnF1b3Q7IikucmVwbGFjZSgvPC9nLCAiJmx0OyIpLnJlcGxhY2UoLz4vZywgIiZndDsiKSA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBoID0gYS5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGgubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGIgJiYgKGIgPSAiIiksIGIucmVwbGFjZSgvXHsoW1x3XC1dKykoPzpcOihbXHdcLl0qKSg/OlwoKC4qPyk/XCkpPyk/XH0vZywgZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHBhcnNlSW50KGYsIDEwKSkpIHJldHVybiBoW3BhcnNlSW50KGYsIDEwKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IGQgPiBjOyBjKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pc0FycmF5KGhbY10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaFtjXSwgZyA9IG4ubGVuZ3RoOyBnLS07KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gbltnXS5ubSkgcmV0dXJuIG5bZ10udgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbXNpZTogIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlciIgPT09IG5hdmlnYXRvci5hcHBOYW1lLAogICAgICAgICAgICAgICAgbXNpZXZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSAtMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSAvTVNJRSAoWzAtOV17MSx9Wy4wLTldezAsfSkvLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgKGEgPSBwYXJzZUZsb2F0KFJlZ0V4cC4kMSkpLCBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0Q2VsbEluZGV4OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoYik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuaXMoInRyIikgPyAtMSA6IChiID0gKGIuaXMoInRkIikgfHwgYi5pcygidGgiKSA/IGIgOiBiLmNsb3Nlc3QoInRkLHRoIikpWzBdLCBhLmpncmlkLm1zaWUgPyBhLmluQXJyYXkoYiwgYi5wYXJlbnROb2RlLmNlbGxzKSA6IGIuY2VsbEluZGV4KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN0cmlwSHRtbDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSBTdHJpbmcoYSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSAvPCgiW14iXSoifCdbXiddKid8W14nIj5dKSo+L2dpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID8gKGEgPSBhLnJlcGxhY2UoYiwgIiIpLCBhICYmCiAgICAgICAgICAgICAgICAgICAgICAgICImbmJzcDsiICE9PSBhICYmICImIzE2MDsiICE9PSBhID8gYS5yZXBsYWNlKC9cIi9nLCAiJyIpIDogIiIpIDogYQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN0cmlwUHJlZjogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBoID0gYS50eXBlKGIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoInN0cmluZyIgPT09IGggfHwgIm51bWJlciIgPT09IGgpICYmIChiID0gU3RyaW5nKGIpLCBjID0gIiIgIT09IGIgPyBTdHJpbmcoYykucmVwbGFjZShTdHJpbmcoYiksICIiKSA6IGMpLCBjCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIndoaWxlKDEpOyIgPT09IGIuc3Vic3RyKDAsIDkpICYmIChiID0gYi5zdWJzdHIoOSkpLCAiLyoiID09PSBiLnN1YnN0cigwLCAyKSAmJiAoYiA9IGIuc3Vic3RyKDIsIGIubGVuZ3RoIC0gNCkpLCBiIHx8IChiID0gInt9IiksICEwID09PSBhLmpncmlkLnVzZUpTT04gJiYgIm9iamVjdCIgPT0gdHlwZW9mIEpTT04gJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgSlNPTi5wYXJzZSA/IEpTT04ucGFyc2UoYikgOiBldmFsKCIoIiArIGIgKyAiKSIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyc2VEYXRlOiBmdW5jdGlvbihiLCBjLCBoLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGwsIGUsIG4sIGcgPSAvXlwvRGF0ZVwoKChbLStdKT9bMC05XSspKChbLStdKShbMC05XXsyfSkoWzAtOV17Mn0pKT9cKVwvJC87CiAgICAgICAgICAgICAgICAgICAgbCA9ICJzdHJpbmciID09IHR5cGVvZiBjID8gYy5tYXRjaChnKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gU3RyaW5nKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gcGFyc2VJbnQoYiwgMTApIHx8IDI7IGEubGVuZ3RoIDwgYjspIGEgPSAiMCIgKyBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG06IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogMTk3MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgczogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHU6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gYSA/IDEyID09PSBiICYmIChiID0gMCkgOiAxMiAhPT0gYiAmJiAoYiArPSAxMiksIGIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gZCAmJiAoZCA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImZvcm1hdHRlci5kYXRlIikpLCB2b2lkIDAgPT09IGQucGFyc2VSZSAmJiAoZC5wYXJzZVJlID0gL1sjJVxcXC86XzsuLFx0XHMtXS8pLCBkLm1hc2tzLmhhc093blByb3BlcnR5KGIpICYmIChiID0gZC5tYXNrc1tiXSksIGMgJiYgbnVsbCAhPSBjKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oYyAtIDApIHx8ICJ1IiAhPT0gU3RyaW5nKGIpLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5jb25zdHJ1Y3RvciA9PT0gRGF0ZSkgcSA9IGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChudWxsICE9PSBsKSBxID0gbmV3IERhdGUocGFyc2VJbnQobFsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgMTApKSwgbFszXSAmJiAodSA9IDYwICogTnVtYmVyKGxbNV0pICsgTnVtYmVyKGxbNl0pLCB1ICo9ICItIiA9PT0gbFs0XSA/IDEgOiAtMSwgdSAtPSBxLmdldFRpbWV6b25lT2Zmc2V0KCksIHEuc2V0VGltZShOdW1iZXIoTnVtYmVyKHEpICsgNkU0ICogdSkpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIklTTzg2MDFMb25nIiA9PT0gZC5zcmNmb3JtYXQgJiYgIloiID09PSBjLmNoYXJBdChjLmxlbmd0aCAtIDEpICYmICh1IC09IChuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBTdHJpbmcoYykucmVwbGFjZSgvXFQvZywgIiMiKS5yZXBsYWNlKC9cdC8sICIlIikuc3BsaXQoZC5wYXJzZVJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGIucmVwbGFjZSgvXFQvZywgIiMiKS5yZXBsYWNlKC9cdC8sICIlIikuc3BsaXQoZC5wYXJzZVJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiA9IGIubGVuZ3RoOyBuID4gZTsgZSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGJbZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJNIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEuaW5BcnJheShjW2VdLCBkLm1vbnRoTmFtZXMpOyAtIDEgIT09IGwgJiYgMTIgPiBsICYmIChjW2VdID0gbCArIDEsIHIubSA9IGNbZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJGIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEuaW5BcnJheShjW2VdLCBkLm1vbnRoTmFtZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMik7IC0gMSAhPT0gbCAmJiAxMSA8IGwgJiYgKGNbZV0gPSBsICsgMSAtIDEyLCByLm0gPSBjW2VdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJbZV0gPSAibSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImoiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiW2VdID0gImQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEuaW5BcnJheShjW2VdLCBkLkFtUG0pOyAtIDEgIT09IGwgJiYgMiA+IGwgJiYgY1tlXSA9PT0gZC5BbVBtW2xdICYmIChjW2VdID0gbCwgci5oID0gcShjW2VdLCByLmgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiQSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLmluQXJyYXkoY1tlXSwgZC5BbVBtKTsgLSAxICE9PSBsICYmIDEgPCBsICYmIGNbZV0gPT09IGQuQW1QbVtsXSAmJiAoY1tlXSA9IGwgLSAyLCByLmggPSBxKGNbZV0sIHIuaCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJnIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5oID0gcGFyc2VJbnQoY1tlXSwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGNbZV0gJiYgKHJbYltlXS50b0xvd2VyQ2FzZSgpXSA9IHBhcnNlSW50KGNbZV0sIDEwKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoci5mICYmIChyLm0gPSByLmYpLCAwID09PSByLm0gJiYgMCA9PT0gci55ICYmIDAgPT09IHIuZCkgcmV0dXJuICImIzE2MDsiOwogICAgICAgICAgICAgICAgICAgICAgICByLm0gPSBwYXJzZUludChyLm0sIDEwKSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSByLnk7CiAgICAgICAgICAgICAgICAgICAgICAgIDcwIDw9IHEgJiYgOTkgPj0gcSA/IHIueSA9IDE5MDAgKyByLnkgOiAwIDw9IHEgJiYgNjkgPj0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgJiYgKHIueSA9IDJFMyArIHIueSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBuZXcgRGF0ZShyLnksIHIubSwgci5kLCByLmgsIHIuaSwgci5zLCByLnUpOwogICAgICAgICAgICAgICAgICAgICAgICAwIDwgdSAmJiBxLnNldFRpbWUoTnVtYmVyKE51bWJlcihxKSArIDZFNCAqIHUpKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBxID0gbmV3IERhdGUoMUUzICogcGFyc2VGbG9hdChjKSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBxID0gbmV3IERhdGUoci55LCByLm0sIHIuZCwgci5oLCByLmksIHIucywgci51KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZC51c2VyTG9jYWxUaW1lICYmIDAgPT09IHUgJiYgKHUgLT0gKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpLCAwIDwgdSAmJiBxLnNldFRpbWUoTnVtYmVyKE51bWJlcihxKSArIDZFNCAqIHUpKSksIHZvaWQgMCA9PT0gaCkgcmV0dXJuIHE7CiAgICAgICAgICAgICAgICAgICAgZC5tYXNrcy5oYXNPd25Qcm9wZXJ0eShoKSA/IGggPSBkLm1hc2tzW2hdIDogaCB8fCAoaCA9ICJZLW0tZCIpOwogICAgICAgICAgICAgICAgICAgIGIgPSBxLmdldEhvdXJzKCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IHEuZ2V0TWludXRlcygpOwogICAgICAgICAgICAgICAgICAgIHIgPSBxLmdldERhdGUoKTsKICAgICAgICAgICAgICAgICAgICB1ID0gcS5nZXRNb250aCgpICsgMTsKICAgICAgICAgICAgICAgICAgICBsID0gcS5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIGUgPSBxLmdldFNlY29uZHMoKTsKICAgICAgICAgICAgICAgICAgICBuID0gcS5nZXRNaWxsaXNlY29uZHMoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IHEuZ2V0RGF5KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBxLmdldEZ1bGxZZWFyKCksCiAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAoayArIDYpICUgNyArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIEMgPSAobmV3IERhdGUoeSwgdSAtIDEsIHIpIC0gbmV3IERhdGUoeSwgMCwgMSkpIC8gODY0RTUsCiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkOiBnKHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRDogZC5kYXlOYW1lc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGo6IHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsOiBkLmRheU5hbWVzW2sgKyA3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE46IEssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTOiBkLlMociksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3OiBrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgejogQywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFc6IDUgPiBLID8gTWF0aC5mbG9vcigoQyArIEsgLSAxKSAvIDcpICsgMSA6IE1hdGguZmxvb3IoKEMgKyBLIC0gMSkgLyA3KSB8fCAoNCA+ICgobmV3IERhdGUoeSAtIDEsIDAsIDEpKS5nZXREYXkoKSArIDYpICUgNyA/IDUzIDogNTIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRjogZC5tb250aE5hbWVzW3UgLSAxICsgMTJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbTogZyh1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE06IGQubW9udGhOYW1lc1t1IC0gMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuOiB1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdDogIj8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTDogIj8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbzogIj8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgWTogeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IFN0cmluZyh5KS5zdWJzdHJpbmcoMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiAxMiA+IGIgPyBkLkFtUG1bMF0gOiBkLkFtUG1bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBOiAxMiA+IGIgPyBkLkFtUG1bMl0gOiBkLkFtUG1bM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCOiAiPyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnOiBiICUgMTIgfHwgMTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogZyhiICUgMTIgfHwgMTIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSDogZyhiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGk6IGcoYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBnKGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdTogbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGU6ICI/IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEk6ICI/IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE86ICgwIDwgbCA/ICItIiA6ICIrIikgKyBnKDEwMCAqIE1hdGguZmxvb3IoTWF0aC5hYnMobCkgLyA2MCkgKyBNYXRoLmFicyhsKSAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNjAsIDQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUDogIj8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVDogKFN0cmluZyhxKS5tYXRjaCgvXGIoPzpbUE1DRUFdW1NEUF1UfCg/OlBhY2lmaWN8TW91bnRhaW58Q2VudHJhbHxFYXN0ZXJufEF0bGFudGljKSAoPzpTdGFuZGFyZHxEYXlsaWdodHxQcmV2YWlsaW5nKSBUaW1lfCg/OkdNVHxVVEMpKD86Wy0rXVxkezR9KT8pXGIvZykgfHwgWyIiXSkucG9wKCkucmVwbGFjZSgvW14tK1xkQS1aXS9nLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBaOiAiPyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjOiAiPyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByOiAiPyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVOiBNYXRoLmZsb29yKHEgLyAxRTMpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGgucmVwbGFjZSgvXFwufFtkRGpsTlN3eldGbU1udExvWXlhQUJnR2hIaXN1ZUlPUFRaY3JVXS9nLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwLmhhc093blByb3BlcnR5KGEpID8gcFthXSA6IGEuc3Vic3RyaW5nKDEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBqcUlEOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhhKS5yZXBsYWNlKC9bISIjJCUmJygpKissLlwvOjsgPD0+P0BcW1xcXF1cXmB7fH1+XS9nLCAiXFwkJiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ3VpZDogMSwKICAgICAgICAgICAgICAgIHVpZFByZWY6ICJqcWciLAogICAgICAgICAgICAgICAgcmFuZElkOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChiIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQudWlkUHJlZikgKyBhLmpncmlkLmd1aWQrKwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldEFjY2Vzc29yOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGwsIGUgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgYikgcmV0dXJuIGIoYSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPSBhW2JdLCB2b2lkIDAgPT09IGMpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiAoZSA9IGIuc3BsaXQoIi4iKSksIGwgPSBlLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IGE7IGMgJiYgbC0tOykgZCA9IGUuc2hpZnQoKSwgYyA9IGNbZF0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChnKSB7fQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0WG1sRGF0YTogZnVuY3Rpb24oYiwgYywgaCkgewogICAgICAgICAgICAgICAgICAgIHZhciBkLCBsID0gInN0cmluZyIgPT0gdHlwZW9mIGMgPyBjLm1hdGNoKC9eKC4qKVxbKFx3KylcXSQvKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGMgPyBjKGIpIDogbCAmJiBsWzJdID8gbFsxXSA/IGEobFsxXSwgYikuYXR0cihsWzJdKSA6IGEoYikuYXR0cihsWzJdKSA6IChkID0gYShjLCBiKSwgaCA/IGQgOiAwIDwgZC5sZW5ndGggPyBhKGQpLnRleHQoKSA6IHZvaWQgMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZWxsV2lkdGg6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSgiPGRpdiBjbGFzcz0ndWktanFncmlkJyBzdHlsZT0nbGVmdDoxMDAwMHB4Jz48dGFibGUgY2xhc3M9J3VpLWpxZ3JpZC1idGFibGUgdWktY29tbW9uLXRhYmxlJyBzdHlsZT0nd2lkdGg6NXB4Oyc+PHRyIGNsYXNzPSdqcWdyb3cnPjx0ZCBzdHlsZT0nd2lkdGg6NXB4O2Rpc3BsYXk6YmxvY2s7Jz48L3RkPjwvdHI+PC90YWJsZT48L2Rpdj4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIuYXBwZW5kVG8oImJvZHkiKS5maW5kKCJ0ZCIpLndpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIucmVtb3ZlKCksIC4xIDwgTWF0aC5hYnMoYyAtIDUpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNMb2NhbFN0b3JhZ2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAibG9jYWxTdG9yYWdlIiBpbiB3aW5kb3cgJiYgbnVsbCAhPT0gd2luZG93LmxvY2FsU3RvcmFnZQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldFJlZ2lvbmFsOiBmdW5jdGlvbihiLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gaCA/IGggOiAoYi5wICYmIGIucC5yZWdpb25hbCAmJiBhLmpncmlkLnJlZ2lvbmFsICYmIChkID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihhLmpncmlkLnJlZ2lvbmFsW2IucC5yZWdpb25hbF0gfHwge30sIGMpKSwgdm9pZCAwID09PSBkICYmIChkID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihhLmpncmlkLCBjKSksIGQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNNb2JpbGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAvQW5kcm9pZHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfHBvY2tldHxwc3B8a2luZGxlfGF2YW50Z298YmxhemVyfG1pZG9yaXxUYWJsZXR8UGFsbXxtYWVtb3xwbHVja2VyfHBob25lfEJsYWNrQmVycnl8c3ltYmlhbnxJRU1vYmlsZXxtb2JpbGV8WnVuZVdQN3xXaW5kb3dzIFBob25lfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwIDogITEKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZWxsX3dpZHRoOiAhMCwKICAgICAgICAgICAgICAgIGFqYXhPcHRpb25zOiB7fSwKICAgICAgICAgICAgICAgIGZyb206IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBiICYmIChiID0gYS5kYXRhKGIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSAvW1wkLCVdL2csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgib2JqZWN0IiAhPSB0eXBlb2YgYiB8fCAhYi5wdXNoKSB0aHJvdyAiZGF0YSBwcm92aWRlcyBpcyBub3QgYW4gYXJyYXkiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA8IGIubGVuZ3RoICYmIChBID0gIm9iamVjdCIgIT0gdHlwZW9mIGJbMF0gPyAhMSA6ICEwKSwgdGhpcy5faGFzRGF0YSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09PSBlID8gITEgOiAwID09PSBlLmxlbmd0aCA/ICExIDogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX2dldFN0ciA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCICYmIGIucHVzaCgialF1ZXJ5LnRyaW0oIiksIGIucHVzaCgiU3RyaW5nKCIgKyBhICsgIikiKSwgQiAmJiBiLnB1c2goIikiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyB8fCBiLnB1c2goIi50b0xvd2VyQ2FzZSgpIiksIGIuam9pbigiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX3N0ckNvbXAgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBhID8gIi50b1N0cmluZygpIiA6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9ncm91cCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogYS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWU6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX3RvU3RyID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCICYmIChiID0gYS50cmltKGIpKSwgYiA9IGIudG9TdHJpbmcoKS5yZXBsYWNlKC9cXC9nLCAiXFxcXCIpLnJlcGxhY2UoL1wiL2csICdcXCInKSwgZyA/IGIgOiBiLnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX2Z1bmNMb29wID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZWFjaChlLCBmdW5jdGlvbihhLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYucHVzaChiKGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9hcHBlbmQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gciA/IHIgPSAiIiA6IHIgKz0gIiIgPT09IEMgPyAiICYmICIgOiBDOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IHkgPiBiOyBiKyspIHIgKz0gIigiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgJiYgKHIgKz0gIiEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByICs9ICIoIiArIGEgKyAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fc2V0Q29tbWFuZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fcmVzZXROZWdhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX3JlcGVhdENvbW1hbmQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT09IHUgPyBkIDogbnVsbCAhPT0gYSAmJiBudWxsICE9PSBiID8gdShhLCBiKSA6IG51bGwgPT09IGsgPyB1KGEpIDogQSA/IHUoaywgYSkgOiB1KGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9lcXVhbHMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT09IGQuX2NvbXBhcmUoYSwgYiwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX2NvbXBhcmUgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgPT09IGYgJiYgKGYgPSAxKSwgdm9pZCAwID09PSBhICYmIChhID0gbnVsbCksIHZvaWQgMCA9PT0gYiAmJiAoYiA9IG51bGwpLCBudWxsID09PSBhICYmIG51bGwgPT09IGIgPyAwIDogbnVsbCA9PT0gYSAmJiBudWxsICE9PSBiID8gMSA6IG51bGwgIT09IGEgJiYgbnVsbCA9PT0gYiA/IC0xIDogIltvYmplY3QgRGF0ZV0iID09PSBlLmNhbGwoYSkgJiYgIltvYmplY3QgRGF0ZV0iID09PSBlLmNhbGwoYikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID4gYSA/IC1mIDogYSA+IGIgPyBmIDogMCA6IChnIHx8ICJudW1iZXIiID09IHR5cGVvZiBhIHx8ICJudW1iZXIiID09IHR5cGVvZiBiIHx8IChhID0gU3RyaW5nKGEpLCBiID0gU3RyaW5nKGIpKSwgYiA+IGEgPyAtZiA6IGEgPiBiID8gZiA6IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9wZXJmb3JtU29ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIT09IHAubGVuZ3RoICYmIChlID0gZC5fZG9Tb3J0KGUsIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fZG9Tb3J0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gcFtiXS5ieSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBbYl0uZGlyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gcFtiXS50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gcFtiXS5kYXRlZm10LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gcFtiXS5zZnVuYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PT0gcC5sZW5ndGggLSAxKSByZXR1cm4gZC5fZ2V0T3JkZXIoYSwgZiwgZSwgYywgaCwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBkLl9nZXRHcm91cChhLCBmLCBlLCBjLCBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGgubGVuZ3RoOyBmKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IGQuX2RvU29ydChoW2ZdLml0ZW1zLCBiKSwgZSA9IDA7IGUgPCBjLmxlbmd0aDsgZSsrKSBtLnB1c2goY1tlXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX2dldE9yZGVyID0gZnVuY3Rpb24oYiwgZiwgZSwgaCwgdywgcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1LCBCLCB5ID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9ICJhIiA9PT0gZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgOiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGggJiYgKGggPSAidGV4dCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSAiZmxvYXQiID09PSBoIHx8ICJudW1iZXIiID09PSBoIHx8ICJjdXJyZW5jeSIgPT09IGggfHwgIm51bWVyaWMiID09PSBoID8gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gcGFyc2VGbG9hdChTdHJpbmcoYSkucmVwbGFjZShxLCAiIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4oYSkgPyBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgOiBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6ICJpbnQiID09PSBoIHx8ICJpbnRlZ2VyIiA9PT0gaCA/IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPyBwYXJzZUZsb2F0KFN0cmluZyhhKS5yZXBsYWNlKHEsICIiKSkgOiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IDogImRhdGUiID09PSBoIHx8ICJkYXRldGltZSIgPT09IGggPyBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmpncmlkLnBhcnNlRGF0ZS5jYWxsKGMsIHcsIGIpLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBhLmlzRnVuY3Rpb24oaCkgPyBoIDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA9IGIgPyBhLnRyaW0oU3RyaW5nKGIpKSA6ICIiLCBnID8gYiA6IGIudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGIsIGZ1bmN0aW9uKGIsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICIiICE9PSBmID8gYS5qZ3JpZC5nZXRBY2Nlc3NvcihlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZikgOiBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IHUgJiYgKHUgPSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBCKHUsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlNvcnQ6IHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsuc29ydChhLmlzRnVuY3Rpb24ocikgPyBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID0gYS52U29ydCwgYiA9IGIudlNvcnQsIHIuY2FsbCh0aGlzLCBhLCBiLCB6KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID0gYS52U29ydCwgYiA9IGIudlNvcnQsIGQuX2NvbXBhcmUoYSwgYiwgeikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBDID0gYi5sZW5ndGg7IEMgPiBoOykgZSA9IGtbaF0uaW5kZXgsIHkucHVzaChiW2VdKSwgaCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9nZXRHcm91cCA9IGZ1bmN0aW9uKGIsIGYsIGUsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSwgdyA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZWFjaChkLl9nZXRPcmRlcihiLCBmLCBlLCBjLCBoKSwgZnVuY3Rpb24oYiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEuamdyaWQuZ2V0QWNjZXNzb3IoZSwgZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09IG0gJiYgKG0gPSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLl9lcXVhbHMobiwgbSkgfHwgKG4gPSBtLCBudWxsICE9PSBnICYmIHcucHVzaChnKSwgZyA9IGQuX2dyb3VwKGYsIG0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuaXRlbXMucHVzaChlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gZyAmJiB3LnB1c2goZyksIHcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuaWdub3JlQ2FzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnID0gITEsIGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMudXNlQ2FzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnID0gITAsIGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMudHJpbSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCID0gITAsIGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMubm9UcmltID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEIgPSAhMSwgZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5leGVjdXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSByLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT09IGIgPyBkIDogKGEuZWFjaChlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbChiKSAmJiBmLnB1c2godGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZSA9IGYsIGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmRhdGEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5zZWxlY3QgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuX3BlcmZvcm1Tb3J0KCksICFkLl9oYXNEYXRhKCkpIHJldHVybiBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5leGVjdXRlKCksIGEuaXNGdW5jdGlvbihiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5lYWNoKGUsIGZ1bmN0aW9uKGEsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYucHVzaChiKGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5oYXNNYXRjaCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9oYXNEYXRhKCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZC5leGVjdXRlKCksIDAgPCBlLmxlbmd0aCkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5hbmROb3QgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEsgPSAhSywgZC5hbmQoYSwgYiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMub3JOb3QgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEsgPSAhSywgZC5vcihhLCBiLCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5ub3QgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuYW5kTm90KGEsIGIsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmFuZCA9IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQyA9ICIgJiYgIiwgdm9pZCAwID09PSBhID8gZCA6IGQuX3JlcGVhdENvbW1hbmQoYSwgYiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMub3IgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMgPSAiIHx8ICIsIHZvaWQgMCA9PT0gYSA/IGQgOiBkLl9yZXBlYXRDb21tYW5kKGEsIGIsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLm9yQmVnaW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geSsrLCBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLm9yRW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IHIgJiYgKHIgKz0gIikiKSwgZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5pc05vdCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSyA9ICFLLCBkLmlzKGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmlzID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9hcHBlbmQoInRoaXMuIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEpLCBkLl9yZXNldE5lZ2F0ZSgpLCBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9jb21wYXJlVmFsdWVzID0gZnVuY3Rpb24oYiwgZiwgZSwgaCwgdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBBID8gImpRdWVyeS5qZ3JpZC5nZXRBY2Nlc3Nvcih0aGlzLCciICsgZiArICInKSIgOiAidGhpcyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gdm9pZCAwID09PSB3LnN0eXBlID8gInRleHQiIDogdy5zdHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gZSkgc3dpdGNoIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImludCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImludGVnZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGlzTmFOKE51bWJlcihuKSkgfHwgIiIgPT09IG4gPyAiMCIgOiBuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICJwYXJzZUludCgiICsgZyArICIsMTApIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAicGFyc2VJbnQoIiArIG4gKyAiLDEwKSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmxvYXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJudW1iZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJudW1lcmljIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBTdHJpbmcobikucmVwbGFjZShxLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gaXNOYU4oTnVtYmVyKG4pKSB8fCAiIiA9PT0gbiA/ICIwIiA6IG47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gInBhcnNlRmxvYXQoIiArIGcgKyAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gInBhcnNlRmxvYXQoIiArIG4gKyAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGF0ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRhdGV0aW1lIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBTdHJpbmcoYS5qZ3JpZC5wYXJzZURhdGUuY2FsbChjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcuc3JjZm10IHx8ICJZLW0tZCIsIG4pLmdldFRpbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gJ2pRdWVyeS5qZ3JpZC5wYXJzZURhdGUuY2FsbChqUXVlcnkoIiMnICsgYS5qZ3JpZC5qcUlEKGMucC5pZCkgKyAnIilbMF0sIicgKyB3LnNyY2ZtdCArICciLCcgKyBnICsgIikuZ2V0VGltZSgpIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGQuX2dldFN0cihnKSwgbiA9IGQuX2dldFN0cignIicgKyBkLl90b1N0cihuKSArICciJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuX2FwcGVuZChnICsgIiAiICsgaCArICIgIiArIG4pLCBkLl9zZXRDb21tYW5kKGIsIGYpLCBkLl9yZXNldE5lZ2F0ZSgpLCBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmVxdWFscyA9IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5fY29tcGFyZVZhbHVlcyhkLmVxdWFscywgYSwgYiwgIj09IiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMubm90RXF1YWxzID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9jb21wYXJlVmFsdWVzKGQuZXF1YWxzLCBhLCBiLCAiIT09IiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuaXNOdWxsID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9jb21wYXJlVmFsdWVzKGQuZXF1YWxzLCBhLCBudWxsLCAiPT09IiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZ3JlYXRlciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuX2NvbXBhcmVWYWx1ZXMoZC5ncmVhdGVyLCBhLCBiLCAiPiIsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmxlc3MgPSBmdW5jdGlvbihhLCBiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuX2NvbXBhcmVWYWx1ZXMoZC5sZXNzLCBhLCBiLCAiPCIsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdyZWF0ZXJPckVxdWFscyA9IGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5fY29tcGFyZVZhbHVlcyhkLmdyZWF0ZXJPckVxdWFscywgYSwgYiwgIj49IiwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMubGVzc09yRXF1YWxzID0gZnVuY3Rpb24oYSwgYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9jb21wYXJlVmFsdWVzKGQubGVzc09yRXF1YWxzLCBhLCBiLCAiPD0iLCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5zdGFydHNXaXRoID0gZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gbnVsbCA9PSBmID8gYiA6IGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBCID8gYS50cmltKGUudG9TdHJpbmcoKSkubGVuZ3RoIDogZS50b1N0cmluZygpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQSA/IGQuX2FwcGVuZChkLl9nZXRTdHIoImpRdWVyeS5qZ3JpZC5nZXRBY2Nlc3Nvcih0aGlzLCciICsgYiArICInKSIpICsgIi5zdWJzdHIoMCwiICsgZSArICIpID09ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLl9nZXRTdHIoJyInICsgZC5fdG9TdHIoZikgKyAnIicpKSA6IChudWxsICE9IGYgJiYgKGUgPSBCID8gYS50cmltKGYudG9TdHJpbmcoKSkubGVuZ3RoIDogZi50b1N0cmluZygpLmxlbmd0aCksIGQuX2FwcGVuZChkLl9nZXRTdHIoInRoaXMiKSArICIuc3Vic3RyKDAsIiArIGUgKyAiKSA9PSAiICsgZC5fZ2V0U3RyKCciJyArIGQuX3RvU3RyKGIpICsgJyInKSkpLCBkLl9zZXRDb21tYW5kKGQuc3RhcnRzV2l0aCwgYiksIGQuX3Jlc2V0TmVnYXRlKCksIGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZW5kc1dpdGggPSBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBudWxsID09IGYgPyBiIDogZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IEIgPyBhLnRyaW0oZS50b1N0cmluZygpKS5sZW5ndGggOiBlLnRvU3RyaW5nKCkubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLl9hcHBlbmQoQSA/IGQuX2dldFN0cigialF1ZXJ5LmpncmlkLmdldEFjY2Vzc29yKHRoaXMsJyIgKyBiICsgIicpIikgKyAiLnN1YnN0cigiICsgZC5fZ2V0U3RyKCJqUXVlcnkuamdyaWQuZ2V0QWNjZXNzb3IodGhpcywnIiArIGIgKyAiJykiKSArICIubGVuZ3RoLSIgKyBlICsgIiwiICsgZSArICcpID09ICInICsgZC5fdG9TdHIoZikgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIicgOiBkLl9nZXRTdHIoInRoaXMiKSArICIuc3Vic3RyKCIgKyBkLl9nZXRTdHIoInRoaXMiKSArICcubGVuZ3RoLSInICsgZC5fdG9TdHIoYikgKyAnIi5sZW5ndGgsIicgKyBkLl90b1N0cihiKSArICciLmxlbmd0aCkgPT0gIicgKyBkLl90b1N0cihiKSArICciJyksIGQuX3NldENvbW1hbmQoZC5lbmRzV2l0aCwgYiksIGQuX3Jlc2V0TmVnYXRlKCksIGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuY29udGFpbnMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuX2FwcGVuZChBID8gZC5fZ2V0U3RyKCJqUXVlcnkuamdyaWQuZ2V0QWNjZXNzb3IodGhpcywnIiArIGEgKyAiJykiKSArICcuaW5kZXhPZigiJyArIGQuX3RvU3RyKGIpICsgJyIsMCkgPiAtMScgOiBkLl9nZXRTdHIoInRoaXMiKSArICcuaW5kZXhPZigiJyArIGQuX3RvU3RyKGEpICsgJyIsMCkgPiAtMScpLCBkLl9zZXRDb21tYW5kKGQuY29udGFpbnMsIGEpLCBkLl9yZXNldE5lZ2F0ZSgpLCBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdyb3VwQnkgPSBmdW5jdGlvbihhLCBiLCBmLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuX2hhc0RhdGEoKSA/IGQuX2dldEdyb3VwKGUsIGEsIGIsIGYsIGMpIDogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JkZXJCeSA9IGZ1bmN0aW9uKGIsIGYsIGUsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZiA9IG51bGwgPT0gZiA/ICJhIiA6IGEudHJpbShmLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSksIG51bGwgPT0gZSAmJiAoZSA9ICJ0ZXh0IiksIG51bGwgPT0gYyAmJiAoYyA9ICJZLW0tZCIpLCBudWxsID09IGggJiYgKGggPSAhMSksICgiZGVzYyIgPT09IGYgfHwgImRlc2NlbmRpbmciID09PSBmKSAmJiAoZiA9ICJkIiksICgiYXNjIiA9PT0gZiB8fCAiYXNjZW5kaW5nIiA9PT0gZikgJiYgKGYgPSAiYSIpLCBwLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieTogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlZm10OiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZnVuYzogaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBkCiAgICAgICAgICAgICAgICAgICAgfShiLCBudWxsKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldE1ldGhvZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc29yKGEuZm4uanFHcmlkLCBiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGV4dGVuZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKGEuZm4uanFHcmlkLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm5vX2xlZ2FjeV9hcGkgfHwgYS5mbi5leHRlbmQoYikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGVhckJlZm9yZVVubG9hZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoYikpWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChjLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmdyaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihiLmVtcHR5Um93cykgJiYgYi5lbXB0eVJvd3MuY2FsbChjLCAhMCwgITApOwogICAgICAgICAgICAgICAgICAgICAgICBhKGRvY3VtZW50KS51bmJpbmQoIm1vdXNldXAuanFHcmlkIiArIGMucC5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5oRGl2KS51bmJpbmQoIm1vdXNlbW92ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBhKGMpLnVuYmluZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCwgZCA9IGIuaGVhZGVycy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gImZvcm1hdENvbCBzb3J0RGF0YSB1cGRhdGVwYWdlciByZWZyZXNoSW5kZXggc2V0SGVhZENoZWNrQm94IGNvbnN0cnVjdFRyIGZvcm1hdHRlciBhZGRYbWxEYXRhIGFkZEpTT05EYXRhIGdyaWQgcCIuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gMDsgZCA+IGg7IGgrKykgYi5oZWFkZXJzW2hdLmVsID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoIGluIGIpIGIuaGFzT3duUHJvcGVydHkoaCkgJiYgKGJbaF0gPSBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoIGluIGMucCkgYy5wLmhhc093blByb3BlcnR5KGgpICYmIChjLnBbaF0gPSBhLmlzQXJyYXkoYy5wW2hdKSA/IFtdIDogbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBsLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gMDsgZCA+IGg7IGgrKykgYy5oYXNPd25Qcm9wZXJ0eShsW2hdKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNbbFtoXV0gPSBudWxsLCBkZWxldGUgY1tsW2hdXSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ3JpZFVubG9hZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhLnRyaW0oYik7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGIuaW5kZXhPZigiIyIpICYmIChiID0gYi5zdWJzdHJpbmcoMSkpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEoIiMiICsgYS5qZ3JpZC5qcUlEKGIpKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBhKGMpLmF0dHIoImlkIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEoYykuYXR0cigiY2xhc3MiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucC5wYWdlciAmJiBhKGMucC5wYWdlcikudW5iaW5kKCkuZW1wdHkoKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1qcWdyaWQtcGFnZXIgdWktY29ybmVyLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbC5jbGFzc05hbWUgPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEuamdyaWQuanFJRChjLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEobCkucmVtb3ZlQ2xhc3MoInVpLWpxZ3JpZC1idGFibGUgdWktY29tbW9uLXRhYmxlIikuaW5zZXJ0QmVmb3JlKCIjZ2JveF8iICsgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxID09PSBhKGMucC5wYWdlcikucGFyZW50cygiI2dib3hfIiArIGQpLmxlbmd0aCAmJiBhKGMucC5wYWdlcikuaW5zZXJ0QmVmb3JlKCIjZ2JveF8iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuY2xlYXJCZWZvcmVVbmxvYWQoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjZ2JveF8iICsgZCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGwpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNhbGVydG1vZF8iICsgYS5qZ3JpZC5qcUlEKGIpKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdyaWREZXN0cm95OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEudHJpbShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gYi5pbmRleE9mKCIjIikgJiYgKGIgPSBiLnN1YnN0cmluZygxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoYikpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnAucGFnZXIgJiYgYShjLnAucGFnZXIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLmNsZWFyQmVmb3JlVW5sb2FkKGIpLCBhKCIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKGIpKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaCkge30KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdHlsZVVJOiB7CiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5VUk6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogInVpLXN0YXRlLWRpc2FibGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodDogInVpLXN0YXRlLWhpZ2hsaWdodCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3ZlcjogInVpLXN0YXRlLWhvdmVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcm5lcmFsbDogInVpLWNvcm5lci1hbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ybmVydG9wOiAidWktY29ybmVyLXRvcCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JuZXJib3R0b206ICJ1aS1jb3JuZXItYm90dG9tIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbjogInVpLWhlbHBlci1oaWRkZW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9iYXNlOiAidWktaWNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiAidWktd2lkZ2V0LW92ZXJsYXkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiAidWktc3RhdGUtYWN0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAidWktc3RhdGUtZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiAidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJ1aS13aWRnZXQtY29udGVudCIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllQm94OiAidWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0JveDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJUYWJsZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJCb3g6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1RhYmxlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0JveDogInVpLXdpZGdldC1jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlclRhYmxlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlckJveDogInVpLXdpZGdldC1jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlckRpdjogInVpLXN0YXRlLWRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZHRpdGxlQm94OiAidWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItdG9wIHVpLWhlbHBlci1jbGVhcmZpeCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b210b29sYmFyQm94OiAidWktc3RhdGUtZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQm94OiAidWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1hY3RpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93bnVtQm94OiAidWktc3RhdGUtZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxCb3g6ICJ1aS13aWRnZXQtY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aUJveDogImNib3giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXJCb3g6ICJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1ib3R0b20iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXJUYWJsZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BwYWdlckJveDogInVpLXN0YXRlLWRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGdJbnB1dDogInVpLWNvcm5lci1hbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGdTZWxlY3RCb3g6ICJ1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBnQnV0dG9uQm94OiAidWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2ZpcnN0OiAidWktaWNvbi1zZWVrLWZpcnN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fcHJldjogInVpLWljb24tc2Vlay1wcmV2IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbmV4dDogInVpLWljb24tc2Vlay1uZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fZW5kOiAidWktaWNvbi1zZWVrLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2FzYzogInVpLWljb24tdHJpYW5nbGUtMS1uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fZGVzYzogInVpLWljb24tdHJpYW5nbGUtMS1zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fY2FwdGlvbl9vcGVuOiAidWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2NhcHRpb25fY2xvc2U6ICJ1aS1pY29uLWNpcmNsZS10cmlhbmdsZS1zIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6ICJ1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6ICJ1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwgdWktaGVscGVyLWNsZWFyZml4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJ1aS13aWRnZXQtY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemFibGU6ICJ1aS1yZXNpemFibGUtaGFuZGxlIHVpLXJlc2l6YWJsZS1zZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2Nsb3NlOiAidWktaWNvbi1jbG9zZXRoaWNrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fcmVzaXphYmxlOiAidWktaWNvbi1ncmlwc21hbGwtZGlhZ29uYWwtc2UiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxlZGl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENsYXNzOiAidWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgaW5saW5lZGl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENsYXNzOiAidWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2VkaXRfbmF2OiAidWktaWNvbi1wZW5jaWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9hZGRfbmF2OiAidWktaWNvbi1wbHVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2F2ZV9uYXY6ICJ1aS1pY29uLWRpc2siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jYW5jZWxfbmF2OiAidWktaWNvbi1jYW5jZWwiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1lZGl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENsYXNzOiAidWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3ByZXY6ICJ1aS1pY29uLXRyaWFuZ2xlLTEtdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX25leHQ6ICJ1aS1pY29uLXRyaWFuZ2xlLTEtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3NhdmU6ICJ1aS1pY29uLWRpc2siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jbG9zZTogInVpLWljb24tY2xvc2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9kZWw6ICJ1aS1pY29uLXNjaXNzb3JzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fY2FuY2VsOiAidWktaWNvbi1jYW5jZWwiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvcjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9lZGl0X25hdjogInVpLWljb24tcGVuY2lsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fYWRkX25hdjogInVpLWljb24tcGx1cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2RlbF9uYXY6ICJ1aS1pY29uLXRyYXNoIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2VhcmNoX25hdjogInVpLWljb24tc2VhcmNoIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fcmVmcmVzaF9uYXY6ICJ1aS1pY29uLXJlZnJlc2giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl92aWV3X25hdjogInVpLWljb24tZG9jdW1lbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9uZXdidXR0b25fbmF2OiAidWktaWNvbi1uZXd3aW4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwaW5nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3BsdXM6ICJ1aS1pY29uLWNpcmNsZXNtYWxsLXBsdXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9taW51czogInVpLWljb24tY2lyY2xlc21hbGwtbWludXMiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVfd2lkZ2V0OiAidWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyU2VsZWN0OiAidWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcklucHV0OiAidWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51X3dpZGdldDogInVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2VhcmNoOiAidWktaWNvbi1zZWFyY2giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9yZXNldDogInVpLWljb24tYXJyb3dyZXR1cm50aGljay0xLXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9xdWVyeTogInVpLWljb24tY29tbWVudCIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ViZ3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9wbHVzOiAidWktaWNvbi1wbHVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbWludXM6ICJ1aS1pY29uLW1pbnVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fb3BlbjogInVpLWljb24tY2FyYXQtMS1zdyIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJlZWdyaWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fcGx1czogInVpLWljb24tdHJpYW5nbGUtMS0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9taW51czogInVpLWljb24tdHJpYW5nbGUtMS1zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbGVhZjogInVpLWljb24tcmFkaW8tb2ZmIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmbWF0dGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2VkaXQ6ICJ1aS1pY29uLXBlbmNpbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2FkZDogInVpLWljb24tcGx1cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3NhdmU6ICJ1aS1pY29uLWRpc2siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jYW5jZWw6ICJ1aS1pY29uLWNhbmNlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2RlbDogInVpLWljb24tdHJhc2giCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIEJvb3RzdHJhcDogewogICAgICAgICAgICAgICAgICAgICAgICBjb21tb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiAidWktZGlzYWJsZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0OiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3ZlcjogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JuZXJhbGw6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ybmVydG9wOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcm5lcmJvdHRvbTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9iYXNlOiAiZ2x5cGhpY29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXk6ICJ1aS1vdmVybGF5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogImJnLWRhbmdlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b246ICJidG4gYnRuLWRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllQm94OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdCb3g6ICJ0YWJsZS1yZXNwb25zaXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlclRhYmxlOiAidGFibGUgdGFibGUtYm9yZGVyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyQm94OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1RhYmxlOiAidGFibGUgdGFibGUtYm9yZGVyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93Qm94OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlclRhYmxlOiAidGFibGUgdGFibGUtYm9yZGVyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVyQm94OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlckRpdjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkdGl0bGVCb3g6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tdG9vbGJhckJveDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQm94OiAicm93IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd251bUJveDogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxCb3g6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlCb3g6ICJjaGVja2JveCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlckJveDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlclRhYmxlOiAidGFibGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wcGFnZXJCb3g6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGdJbnB1dDogImZvcm0tY29udHJvbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZ1NlbGVjdEJveDogImZvcm0tY29udHJvbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZ0J1dHRvbkJveDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2ZpcnN0OiAiZ2x5cGhpY29uLXN0ZXAtYmFja3dhcmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9wcmV2OiAiZ2x5cGhpY29uLWJhY2t3YXJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbmV4dDogImdseXBoaWNvbi1mb3J3YXJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fZW5kOiAiZ2x5cGhpY29uLXN0ZXAtZm9yd2FyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2FzYzogImdseXBoaWNvbi10cmlhbmdsZS10b3AiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9kZXNjOiAiZ2x5cGhpY29uLXRyaWFuZ2xlLWJvdHRvbSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2NhcHRpb25fb3BlbjogImdseXBoaWNvbi1jaXJjbGUtYXJyb3ctdXAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jYXB0aW9uX2Nsb3NlOiAiZ2x5cGhpY29uLWNpcmNsZS1hcnJvdy1kb3duIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6ICJtb2RhbC1jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogIm1vZGFsLWhlYWRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogIm1vZGFsLXRpdGxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJtb2RhbC1ib2R5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogInVpLXJlc2l6YWJsZS1oYW5kbGUgdWktcmVzaXphYmxlLXNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fY2xvc2U6ICJnbHlwaGljb24tcmVtb3ZlLWNpcmNsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3Jlc2l6YWJsZTogImdseXBoaWNvbi1pbXBvcnQiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxlZGl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENsYXNzOiAiZm9ybS1jb250cm9sIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBpbmxpbmVkaXQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICJmb3JtLWNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9lZGl0X25hdjogImdseXBoaWNvbi1lZGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fYWRkX25hdjogImdseXBoaWNvbi1wbHVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2F2ZV9uYXY6ICJnbHlwaGljb24tc2F2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2NhbmNlbF9uYXY6ICJnbHlwaGljb24tcmVtb3ZlLWNpcmNsZSIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWVkaXQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICJmb3JtLWNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9wcmV2OiAiZ2x5cGhpY29uLXN0ZXAtYmFja3dhcmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9uZXh0OiAiZ2x5cGhpY29uLXN0ZXAtZm9yd2FyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3NhdmU6ICJnbHlwaGljb24tc2F2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2Nsb3NlOiAiZ2x5cGhpY29uLXJlbW92ZS1jaXJjbGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9kZWw6ICJnbHlwaGljb24tdHJhc2giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jYW5jZWw6ICJnbHlwaGljb24tcmVtb3ZlLWNpcmNsZSIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2VkaXRfbmF2OiAiZ2x5cGhpY29uLWVkaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9hZGRfbmF2OiAiZ2x5cGhpY29uLXBsdXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9kZWxfbmF2OiAiZ2x5cGhpY29uLXRyYXNoIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2VhcmNoX25hdjogImdseXBoaWNvbi1zZWFyY2giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9yZWZyZXNoX25hdjogImdseXBoaWNvbi1yZWZyZXNoIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fdmlld19uYXY6ICJnbHlwaGljb24taW5mby1zaWduIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbmV3YnV0dG9uX25hdjogImdseXBoaWNvbi1uZXctd2luZG93IgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9wbHVzOiAiZ2x5cGhpY29uLXRyaWFuZ2xlLXJpZ2h0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbWludXM6ICJnbHlwaGljb24tdHJpYW5nbGUtYm90dG9tIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX3dpZGdldDogInRhYmxlIHRhYmxlLWNvbmRlbnNlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzclNlbGVjdDogImZvcm0tY29udHJvbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcklucHV0OiAiZm9ybS1jb250cm9sIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVfd2lkZ2V0OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fc2VhcmNoOiAiZ2x5cGhpY29uLXNlYXJjaCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3Jlc2V0OiAiZ2x5cGhpY29uLXJlZnJlc2giLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9xdWVyeTogImdseXBoaWNvbi1jb21tZW50IgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzdWJncmlkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX3BsdXM6ICJnbHlwaGljb24tdHJpYW5nbGUtcmlnaHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9taW51czogImdseXBoaWNvbi10cmlhbmdsZS1ib3R0b20iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9vcGVuOiAiZ2x5cGhpY29uLWluZGVudC1sZWZ0IgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB0cmVlZ3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9wbHVzOiAiZ2x5cGhpY29uLXRyaWFuZ2xlLXJpZ2h0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbWludXM6ICJnbHlwaGljb24tdHJpYW5nbGUtYm90dG9tIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fbGVhZjogImdseXBoaWNvbi11bmNoZWNrZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZtYXR0ZXI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fZWRpdDogImdseXBoaWNvbi1lZGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fYWRkOiAiZ2x5cGhpY29uLXBsdXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9zYXZlOiAiZ2x5cGhpY29uLXNhdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9jYW5jZWw6ICJnbHlwaGljb24tcmVtb3ZlLWNpcmNsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uX2RlbDogImdseXBoaWNvbi10cmFzaCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuZm4uanFHcmlkID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmpncmlkLmdldE1ldGhvZChiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWMpIHRocm93ICJqcUdyaWQgLSBObyBzdWNoIG1ldGhvZDogIiArIGI7CiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBhLm1ha2VBcnJheShhcmd1bWVudHMpLnNsaWNlKDEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjLmFwcGx5KHRoaXMsIGgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGIgJiYgdm9pZCAwICE9PSBiLmRhdGEgJiYgKGMgPSBiLmRhdGEsIGIuZGF0YSA9IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTUwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd051bTogMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dUb3RhbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHM6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlcjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZ2J1dHRvbnM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGdpbnB1dDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xNb2RlbDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dMaXN0OiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE5hbWVzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRvcmRlcjogImFzYyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0bmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhdHlwZTogInhtbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdHlwZTogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHRSb3dzOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGFycnJvdzogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFJvdzogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaHJpbmtUb0ZpdDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWxSZWFkZXI6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAganNvblJlYWRlcjoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJHcmlkOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YkdyaWRNb2RlbDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNjb3VudDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RwYWdlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdHNvcnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxyb3c6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZWxlY3RSb3c6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdFJvdzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU29ydENvbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZGJsQ2xpY2tSb3c6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJpZ2h0Q2xpY2tSb3c6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblBhZ2luZzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0QWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Jbml0R3JpZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRDb21wbGV0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRDb21wbGV0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRFcnJvcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRCZWZvcmVTZW5kOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJJbnNlcnRSb3c6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVSZXF1ZXN0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlUHJvY2Vzc2luZzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uSGVhZGVyQ2xpY2s6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cmVjb3JkczogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2Fkb25jZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXNlbGVjdDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWtleTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0dXJsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb246ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZWdyaWQ6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuZ3JpZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlR3JpZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlR3JpZE1vZGVsOiAibmVzdGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVSZWFkZXI6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZUFOb2RlOiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGFuZENvbHVtbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVfcm9vdF9sZXZlbDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBybU5hbWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogInBhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3M6ICJyb3dzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0OiAic2lkeCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6ICJzb3JkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2g6ICJfc2VhcmNoIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZDogIm5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAib3BlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9wZXI6ICJlZGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvcGVyOiAiYWRkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxvcGVyOiAiZGVsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJncmlkaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnBhZ2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxyb3dzOiAidG90YWxyb3dzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlRml0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRzdGF0ZTogInZpc2libGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbEVkaXQ6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHN1Ym1pdDogInJlbW90ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWR1aTogImVuYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFyOiBbITEsICIiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWJveG9ubHk6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZWxlY3RBZnRlclNvcnQ6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xscm93czogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvd2lkdGg6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsT2Zmc2V0OiAxOCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxMYXlvdXQ6IDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJHcmlkV2lkdGg6IDIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlzZWxlY3RXaWR0aDogMzAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkdmlldzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dudW1XaWR0aDogMzUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dudW1iZXJzOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VycG9zOiAiY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHBvczogInJpZ2h0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlcnJvdzogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YU9uRm9vdGVyOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVycm93czogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHRjbGFzczogInVpLXByaW9yaXR5LXNlY29uZGFyeSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3c29ydGNvbHM6IFshMSwgInZlcnRpY2FsIiwgITBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplY2xhc3M6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b2VuY29kZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1hcENvbHVtbnM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWpheEdyaWRPcHRpb25zOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogImx0ciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BwYWdlcjogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJ0aXRsZXM6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVGltZW91dDogNDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbmRleDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZzogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZ1ZpZXc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cEZpZWxkOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cE9yZGVyOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cFRleHQ6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwQ29sdW1uU2hvdzogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBTdW1tYXJ5OiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93U3VtbWFyeU9uSGlkZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGl0ZW1zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0bmFtZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1bW1hcnk6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1bW1hcnl2YWw6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdXNpY29uOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW51c2ljb246ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlGaWVsZDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBTdW1tYXJ5UG9zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXREaXNwbGF5RmllbGQ6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2NncjogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVDYXNlOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtVGVtcGxhdGU6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRQcmVmaXg6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlTb3J0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbkNvbFdpZHRoOiAzMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFBvcFVwOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcE9mZnNldDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbExlZnRPZmZzZXQ6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlTmF2T3B0aW9uczogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25hbDogImVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6ICJqUXVlcnlVSSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmVDZWxsb25GYWlsOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmpncmlkLmRlZmF1bHRzLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSBjICYmIChoLmRhdGEgPSBjLCBiLmRhdGEgPSBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb290ZXJzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnU3RhcnQ6IGZ1bmN0aW9uKGIsIGYsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBhKHRoaXMuYkRpdikub2Zmc2V0KCkubGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemluZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogZi5wYWdlWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNPTDogZi5wYWdlWCAtIG0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oRGl2LnN0eWxlLmN1cnNvciA9ICJjb2wtcmVzaXplIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJHYm94ID0gYSgiI3JzX20iICsgYS5qZ3JpZC5qcUlEKGguaWQpLCAiI2dib3hfIiArIGEuamdyaWQuanFJRChoLmlkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VyR2JveC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGYucGFnZVggLSBtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBjWzFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBjWzJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRSZXNpemVTdGFydCIsIFtmLCBiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihoLnJlc2l6ZVN0YXJ0KSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5yZXNpemVTdGFydC5jYWxsKGUsIGYsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ01vdmU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzaXppbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEucGFnZVggLSB0aGlzLnJlc2l6aW5nLnN0YXJ0WDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5oZWFkZXJzW3RoaXMucmVzaXppbmcuaWR4XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gImx0ciIgPT09IGguZGlyZWN0aW9uID8gZS53aWR0aCArIGEgOiBlLndpZHRoIC0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMzIDwgYyAmJiAodGhpcy5jdXJHYm94LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy5yZXNpemluZy5zT0wgKyBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITAgPT09IGguZm9yY2VGaXQgPyAoYiA9IHRoaXMuaGVhZGVyc1t0aGlzLnJlc2l6aW5nLmlkeCArIGgubnZdLCBmID0gImx0ciIgPT09IGguZGlyZWN0aW9uID8gYi53aWR0aCAtIGEgOiBiLndpZHRoICsgYSwgZiA+IGgubWluQ29sV2lkdGggJiYgKGUubmV3V2lkdGggPSBjLCBiLm5ld1dpZHRoID0gZikpIDogKHRoaXMubmV3V2lkdGggPSAibHRyIiA9PT0gaC5kaXJlY3Rpb24gPyBoLnRibHdpZHRoICsgYSA6IGgudGJsd2lkdGggLSBhLCBlLm5ld1dpZHRoID0gYykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdFbmQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaERpdi5zdHlsZS5jdXJzb3IgPSAiZGVmYXVsdCIsIHRoaXMucmVzaXppbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5yZXNpemluZy5pZHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuaGVhZGVyc1tmXS5uZXdXaWR0aCB8fCB0aGlzLmhlYWRlcnNbZl0ud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHBhcnNlSW50KGMsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzaXppbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNyc19tIiArIGEuamdyaWQuanFJRChoLmlkKSkuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguY29sTW9kZWxbZl0ud2lkdGggPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzW2ZdLndpZHRoID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVyc1tmXS5lbC5zdHlsZS53aWR0aCA9IGMgKyAicHgiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xzW2ZdLnN0eWxlLndpZHRoID0gYyArICJweCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgdGhpcy5mb290ZXJzLmxlbmd0aCAmJiAodGhpcy5mb290ZXJzW2ZdLnN0eWxlLndpZHRoID0gYyArICJweCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGguZm9yY2VGaXQgPyAoYyA9IHRoaXMuaGVhZGVyc1tmICsgaC5udl0ubmV3V2lkdGggfHwgdGhpcy5oZWFkZXJzW2YgKyBoLm52XS53aWR0aCwgdGhpcy5oZWFkZXJzW2YgKyBoLm52XS53aWR0aCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYywgdGhpcy5oZWFkZXJzW2YgKyBoLm52XS5lbC5zdHlsZS53aWR0aCA9IGMgKyAicHgiLCB0aGlzLmNvbHNbZiArIGgubnZdLnN0eWxlLndpZHRoID0gYyArICJweCIsIDAgPCB0aGlzLmZvb3RlcnMubGVuZ3RoICYmICh0aGlzLmZvb3RlcnNbZiArIGgubnZdLnN0eWxlLndpZHRoID0gYyArICJweCIpLCBoLmNvbE1vZGVsW2YgKyBoLm52XS53aWR0aCA9IGMpIDogKGgudGJsd2lkdGggPSB0aGlzLm5ld1dpZHRoIHx8IGgudGJsd2lkdGgsIGEoInRhYmxlOmZpcnN0IiwgdGhpcy5iRGl2KS5jc3MoIndpZHRoIiwgaC50Ymx3aWR0aCArICJweCIpLCBhKCJ0YWJsZTpmaXJzdCIsIHRoaXMuaERpdikuY3NzKCJ3aWR0aCIsIGgudGJsd2lkdGggKyAicHgiKSwgdGhpcy5oRGl2LnNjcm9sbExlZnQgPSB0aGlzLmJEaXYuc2Nyb2xsTGVmdCwgaC5mb290ZXJyb3cgJiYgKGEoInRhYmxlOmZpcnN0IiwgdGhpcy5zRGl2KS5jc3MoIndpZHRoIiwgaC50Ymx3aWR0aCArICJweCIpLCB0aGlzLnNEaXYuc2Nyb2xsTGVmdCA9IHRoaXMuYkRpdi5zY3JvbGxMZWZ0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICYmIChhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRSZXNpemVTdG9wIiwgW2MsIGZdKSwgYS5pc0Z1bmN0aW9uKGgucmVzaXplU3RvcCkgJiYgaC5yZXNpemVTdG9wLmNhbGwoZSwgYywgZikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJHYm94ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlVmlzaWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udGltZXIgJiYgY2xlYXJUaW1lb3V0KG0udGltZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnRpbWVyID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKG0uYkRpdikuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgYywgZCA9IGEoInRhYmxlOmZpcnN0IiwgbS5iRGl2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkWzBdLnJvd3MubGVuZ3RoKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAoZiA9IGRbMF0ucm93c1sxXSkgPyBhKGYpLm91dGVySGVpZ2h0KCkgfHwgbS5wcmV2Um93SGVpZ2h0IDogbS5wcmV2Um93SGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICh3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IG0ucHJldlJvd0hlaWdodAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnByZXZSb3dIZWlnaHQgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBxLCByLCB1ID0gaC5yb3dOdW07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IG0uc2Nyb2xsVG9wID0gbS5iRGl2LnNjcm9sbFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQiA9IE1hdGgucm91bmQoZC5wb3NpdGlvbigpLnRvcCkgLSBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gQiArIGQuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBjICogdTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYiA+IHkgJiYgMCA+PSBCICYmICh2b2lkIDAgPT09IGgubGFzdHBhZ2UgfHwgKHBhcnNlSW50KCh5ICsgZiArIHUgLSAxKSAvIHUsIDEwKSB8fCAwKSA8PSBoLmxhc3RwYWdlKSAmJiAocSA9IHBhcnNlSW50KChiIC0geSArIHUgLSAxKSAvIHUsIDEwKSB8fCAxLCAwIDw9IHkgfHwgMiA+IHEgfHwgITAgPT09IGguc2Nyb2xsID8gKGcgPSAoTWF0aC5yb3VuZCgoeSArIGYpIC8gdSkgfHwgMCkgKyAxLCBCID0gLTEpIDogQiA9IDEpLCAwIDwgQiAmJiAoZyA9IChwYXJzZUludChmIC8gdSwgMTApIHx8IDApICsgMSwgcSA9IChwYXJzZUludCgoZiArIGIpIC8gdSwgMTApIHx8IDApICsgMiAtIGcsIHIgPSAhMCksICFxKSB8fCBoLmxhc3RwYWdlICYmIChnID4gaC5sYXN0cGFnZSB8fCAxID09PSBoLmxhc3RwYWdlIHx8IGcgPT09IGgucGFnZSAmJiBnID09PSBoLmxhc3RwYWdlKSB8fCAobS5oRGl2LmxvYWRpbmcgPyBtLnRpbWVyID0gc2V0VGltZW91dChtLnBvcHVsYXRlVmlzaWJsZSwgaC5zY3JvbGxUaW1lb3V0KSA6IChoLnBhZ2UgPSBnLCByICYmIChtLnNlbGVjdGlvblByZXNlcnZlcihkWzBdKSwgbS5lbXB0eVJvd3MuY2FsbChkWzBdLCAhMSwgITEpKSwgbS5wb3B1bGF0ZShxKSksIGguc2Nyb2xsUG9wVXAgJiYgbnVsbCAhPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmxhc3RwYWdlICYmIChhKCIjc2Nyb2xsX2ciICsgaC5pZCkuc2hvdygpLmh0bWwoYS5qZ3JpZC50ZW1wbGF0ZShhLmpncmlkLmdldFJlZ2lvbmFsKGUsICJkZWZhdWx0cy5wZ3RleHQiLCBoLnBndGV4dCksIGgucGFnZSwgaC5sYXN0cGFnZSkpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGguc2Nyb2xsVG9wT2Zmc2V0ICsgZiAqICgocGFyc2VJbnQoaC5oZWlnaHQsIDEwKSAtIDQ1KSAvIChwYXJzZUludChjLCAxMCkgKiBwYXJzZUludChoLnJlY29yZHMsIDEwKSkpICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGguc2Nyb2xsTGVmdE9mZnNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSh0aGlzKS5tb3VzZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNzY3JvbGxfZyIgKyBoLmlkKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxHcmlkOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLnNjcm9sbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBtLmJEaXYuc2Nyb2xsVG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBtLnNjcm9sbFRvcCAmJiAobS5zY3JvbGxUb3AgPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgIT09IG0uc2Nyb2xsVG9wICYmIChtLnNjcm9sbFRvcCA9IGYsIG0udGltZXIgJiYgY2xlYXJUaW1lb3V0KG0udGltZXIpLCBtLnRpbWVyID0gc2V0VGltZW91dChtLnBvcHVsYXRlVmlzaWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnNjcm9sbFRpbWVvdXQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uaERpdi5zY3JvbGxMZWZ0ID0gbS5iRGl2LnNjcm9sbExlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguZm9vdGVycm93ICYmIChtLnNEaXYuc2Nyb2xsTGVmdCA9IG0uYkRpdi5zY3JvbGxMZWZ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5mcm96ZW5Db2x1bW5zICYmIGEobS5mYkRpdikuc2Nyb2xsVG9wKG0uYkRpdi5zY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICYmIGIuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvblByZXNlcnZlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGIucCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBmLnNlbHJvdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBmLnNlbGFycnJvdyA/IGEubWFrZUFycmF5KGYuc2VsYXJycm93KSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYi5ncmlkLmJEaXYuc2Nyb2xsTGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5zZWxyb3cgPSBudWxsLCBmLnNlbGFycnJvdyA9IFtdLCBmLm11bHRpc2VsZWN0ICYmIGMgJiYgMCA8IGMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykgY1tkXSAhPT0gZSAmJiBhKGIpLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgY1tkXSwgITEsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgJiYgYShiKS5qcUdyaWQoInNldFNlbGVjdGlvbiIsIGUsICExLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmdyaWQuYkRpdi5zY3JvbGxMZWZ0ID0gaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGIpLnVuYmluZCgiLnNlbGVjdGlvblByZXNlcnZlciIsIG0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGIpLmJpbmQoImpxR3JpZEdyaWRDb21wbGV0ZS5zZWxlY3Rpb25QcmVzZXJ2ZXIiLCBtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiVEFCTEUiICE9PSB0aGlzLnRhZ05hbWUudG9VcHBlckNhc2UoKSB8fCBudWxsID09IHRoaXMuaWQpIHJldHVybiB2b2lkIGFsZXJ0KCJFbGVtZW50IGlzIG5vdCBhIHRhYmxlIG9yIGhhcyBubyBpZCEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlICYmIDUgPj0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlKSByZXR1cm4gdm9pZCBhbGVydCgiR3JpZCBjYW4gbm90IGJlIHVzZWQgaW4gdGhpcyAoJ3F1aXJrcycpIG1vZGUhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnLCBxLCB1ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnIGluIGEuamdyaWQucmVnaW9uYWwpIGEuamdyaWQucmVnaW9uYWwuaGFzT3duUHJvcGVydHkoZykgJiYgKDAgPT09IHUgJiYgKGQgPSBnKSwgdSsrKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IHUgJiYgZCAhPT0gaC5yZWdpb25hbCAmJiAoaC5yZWdpb25hbCA9IGQpLCBhKHRoaXMpLmVtcHR5KCkuYXR0cigidGFiaW5kZXgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIwIiksIHRoaXMucCA9IGgsIHRoaXMucC51c2VQcm9wID0gISFhLmZuLnByb3AsIDAgPT09IHRoaXMucC5jb2xOYW1lcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSAwOyB1IDwgdGhpcy5wLmNvbE1vZGVsLmxlbmd0aDsgdSsrKSB0aGlzLnAuY29sTmFtZXNbdV0gPSB0aGlzLnAuY29sTW9kZWxbdV0ubGFiZWwgfHwgdGhpcy5wLmNvbE1vZGVsW3VdLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnAuY29sTmFtZXMubGVuZ3RoICE9PSB0aGlzLnAuY29sTW9kZWwubGVuZ3RoKSByZXR1cm4gdm9pZCBhbGVydChhLmpncmlkLmdldFJlZ2lvbmFsKHRoaXMsICJlcnJvcnMubW9kZWwiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrLCB5ID0gYS5qZ3JpZC5nZXRNZXRob2QoImdldFN0eWxlVUkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSBlLnAuc3R5bGVVSSArICIuY29tbW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSB5KEssICJkaXNhYmxlZCIsICEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSB5KEssICJoaWdobGlnaHQiLCAhMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0geShLLCAiaG92ZXIiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB5KEssICJjb3JuZXJhbGwiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0geShLLCAiaWNvbl9iYXNlIiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gYS5qZ3JpZC5tc2llOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgSCA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSyA9IGUucC5zdHlsZVVJICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIuYmFzZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhKCI8ZGl2ICIgKyB5KEssICJ2aWV3Qm94IiwgITEsICJ1aS1qcWdyaWQtdmlldyIpICsgIiByb2xlPSdncmlkJz48L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmRpcmVjdGlvbiA9IGEudHJpbShlLnAuZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBlLnAuX2FsZCA9ICExOyAtIDEgPT09IGEuaW5BcnJheShlLnAuZGlyZWN0aW9uLCBbImx0ciIsICJydGwiXSkgJiYgKGUucC5kaXJlY3Rpb24gPSAibHRyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBlLnAuZGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBhKGspLmluc2VydEJlZm9yZSh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hcHBlbmRUbyhrKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEwgPSBhKCI8ZGl2ICIgKyB5KEssICJlbnRyaWVCb3giLCAhMSwgInVpLWpxZ3JpZCIpICsgIj48L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgYShMKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiZ2JveF8iICsgdGhpcy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogcQogICAgICAgICAgICAgICAgICAgICAgICB9KS5pbnNlcnRCZWZvcmUoayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoaykuYXR0cigiaWQiLCAiZ3ZpZXdfIiArIHRoaXMuaWQpLmFwcGVuZFRvKEwpOwogICAgICAgICAgICAgICAgICAgICAgICBhKCI8ZGl2ICIgKyB5KGUucC5zdHlsZVVJICsgIi5jb21tb24iLCAib3ZlcmxheSIsICExLCAianFncmlkLW92ZXJsYXkiKSArICIgaWQ9J2x1aV8iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgKyAiJz48L2Rpdj4iKS5pbnNlcnRCZWZvcmUoayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoIjxkaXYgIiArIHkoSywgImxvYWRpbmdCb3giLCAhMSwgImxvYWRpbmciKSArICIgaWQ9J2xvYWRfIiArIHRoaXMuaWQgKyAiJz4iICsgYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZGVmYXVsdHMubG9hZHRleHQiLCB0aGlzLnAubG9hZHRleHQpICsgIjwvZGl2PiIpLmluc2VydEJlZm9yZShrKTsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtbXVsdGlzZWxlY3RhYmxlIjogISF0aGlzLnAubXVsdGlzZWxlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1sYWJlbGxlZGJ5IjogImdib3hfIiArIHRoaXMuaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBKLCBHID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID0gcGFyc2VJbnQoYSwgMTApLCBpc05hTihhKSA/IGIgfHwgMCA6IGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBRID0gZnVuY3Rpb24oYiwgZiwgYywgaCwgZCwgdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsLCBnLCBxID0gZS5wLmNvbE1vZGVsW2JdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcS5hbGlnbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICdzdHlsZT0iJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IHEuY2xhc3NlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHEubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByICYmICh1ICs9ICJ0ZXh0LWFsaWduOiIgKyByICsgIjsiKSwgITAgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEuaGlkZGVuICYmICh1ICs9ICJkaXNwbGF5Om5vbmU7IiksIDAgPT09IGYgPyB1ICs9ICJ3aWR0aDogIiArIG0uaGVhZGVyc1tiXS53aWR0aCArICJweDsiIDogKGEuaXNGdW5jdGlvbihxLmNlbGxhdHRyKSB8fCAic3RyaW5nIiA9PSB0eXBlb2YgcS5jZWxsYXR0ciAmJiBudWxsICE9IGEuamdyaWQuY2VsbGF0dHIgJiYgYS5pc0Z1bmN0aW9uKGEuamdyaWQuY2VsbGF0dHJbcS5jZWxsYXR0cl0pKSAmJiAobCA9IGEuaXNGdW5jdGlvbihxLmNlbGxhdHRyKSA/IHEuY2VsbGF0dHIgOiBhLmpncmlkLmNlbGxhdHRyW3EuY2VsbGF0dHJdLCBnID0gbC5jYWxsKGUsIGQsIGMsIGgsIHEsIHcpLCBnICYmICJzdHJpbmciID09IHR5cGVvZiBnICYmIChnID0gZy5yZXBsYWNlKC9zdHlsZS9pLCAic3R5bGUiKS5yZXBsYWNlKC90aXRsZS9pLCAidGl0bGUiKSwgLTEgPCBnLmluZGV4T2YoInRpdGxlIikgJiYgKHEudGl0bGUgPSAhMSksIC0xIDwgZy5pbmRleE9mKCJjbGFzcyIpICYmIChCID0gdm9pZCAwKSwgdCA9IGcucmVwbGFjZSgvXC1zdHlsZS9nLCAiLXN0aSIpLnNwbGl0KC9zdHlsZS8pLCAyID09PSB0Lmxlbmd0aCA/ICh0WzFdID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudHJpbSh0WzFdLnJlcGxhY2UoL1wtc3RpL2csICItc3R5bGUiKS5yZXBsYWNlKCI9IiwgIiIpKSwgKDAgPT09IHRbMV0uaW5kZXhPZigiJyIpIHx8IDAgPT09IHRbMV0uaW5kZXhPZignIicpKSAmJiAodFsxXSA9IHRbMV0uc3Vic3RyaW5nKDEpKSwgdSArPSB0WzFdLnJlcGxhY2UoLycvZ2ksICciJykpIDogdSArPSAnIicpKSwgdC5sZW5ndGggfHwgKHRbMF0gPSAiIiwgdSArPSAnIicpLCB1ICs9ICh2b2lkIDAgIT09IEIgPyAnIGNsYXNzPSInICsgQiArICciJyA6ICIiKSArIChxLnRpdGxlICYmIGMgPyAnIHRpdGxlPSInICsgYS5qZ3JpZC5zdHJpcEh0bWwoYykgKyAnIicgOiAiIiksIHUgKz0gJyBhcmlhLWRlc2NyaWJlZGJ5PSInICsgZS5wLmlkICsgIl8iICsgeSArICciJywgdSArIHRbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrYSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBiIHx8ICIiID09PSBiID8gIiYjMTYwOyIgOiBlLnAuYXV0b2VuY29kZSA/IGEuamdyaWQuaHRtbEVuY29kZShiKSA6IFN0cmluZyhiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIgPSBmdW5jdGlvbihiLCBmLCBjLCBoLCBtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBlLnAuY29sTW9kZWxbY107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSBkLmZvcm1hdHRlciA/IChiID0gIiIgIT09IFN0cmluZyhlLnAuaWRQcmVmaXgpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5zdHJpcFByZWYoZS5wLmlkUHJlZml4LCBiKSA6IGIsIGIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2lkOiBlLnAuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3M6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBlLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmID0gYS5pc0Z1bmN0aW9uKGQuZm9ybWF0dGVyKSA/IGQuZm9ybWF0dGVyLmNhbGwoZSwgZiwgYiwgaCwgbSkgOiBhLmZtYXR0ZXIgPyBhLmZuLmZtYXR0ZXIuY2FsbChlLCBkLmZvcm1hdHRlciwgZiwgYiwgaCwgbSkgOiBrYShmKSkgOiBmID0ga2EoZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEID0gZnVuY3Rpb24oYSwgYiwgZiwgZSwgYywgaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtLCBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtID0gUihhLCBiLCBmLCBjLCAiYWRkIiksIGQgPSBRKGYsIGUsIG0sIGMsIGEsIGgpLCAnPHRkIHJvbGU9ImdyaWRjZWxsIiAnICsgZCArICI+IiArIG0gKyAiPC90ZD4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA9IGZ1bmN0aW9uKGEsIGIsIGYsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gJzxpbnB1dCByb2xlPSJjaGVja2JveCIgdHlwZT0iY2hlY2tib3giIGlkPSJqcWdfJyArIGUucC5pZCArICJfIiArIGEgKyAnIiAnICsgaCArICcgbmFtZT0ianFnXycgKyBlLnAuaWQgKyAiXyIgKyBhICsgJyInICsgKGMgPyAnY2hlY2tlZD0iY2hlY2tlZCInIDogIiIpICsgIi8+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzx0ZCByb2xlPSJncmlkY2VsbCIgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEoYiwgZiwgIiIsIG51bGwsIGEsICEwKSArICI+IiArIGMgKyAiPC90ZD4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRiA9IGZ1bmN0aW9uKGEsIGIsIGYsIGUsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gKHBhcnNlSW50KGYsIDEwKSAtIDEpICogcGFyc2VJbnQoZSwgMTApICsgMSArIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IFEoYSwgYiwgZiwgbnVsbCwgYiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHRkIHJvbGU9ImdyaWRjZWxsIiAnICsgYyArICIgIiArIGEgKyAiPiIgKyBmICsgIjwvdGQ+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGYsIGMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGUucC5jb2xNb2RlbC5sZW5ndGg7IGYrKykgYiA9IGUucC5jb2xNb2RlbFtmXSwgImNiIiAhPT0gYi5uYW1lICYmICJzdWJncmlkIiAhPT0gYi5uYW1lICYmICJybiIgIT09IGIubmFtZSAmJiAoY1toXSA9ICJsb2NhbCIgPT09IGEgPyBiLm5hbWUgOiAieG1sIiA9PT0gYSB8fCAieG1sc3RyaW5nIiA9PT0gYSA/IGIueG1sbWFwIHx8IGIubmFtZSA6IGIuanNvbm1hcCB8fCBiLm5hbWUsICExICE9PSBlLnAua2V5TmFtZSAmJiAhMCA9PT0gYi5rZXkgJiYgKGUucC5rZXlOYW1lID0gY1toXSksIGgrKyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZS5wLnJlbWFwQ29sdW1uczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZiAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmxlbmd0aCB8fCAoZiA9IGEubWFwKGUucC5jb2xNb2RlbCwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBiICYmIChmID0gYS5tYXAoZiwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPiBhID8gbnVsbCA6IGEgLSBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSwgZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFkgPSBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmRlZXBlbXB0eSA/IGEodGhpcy5yb3dzKS5zbGljZSgxKS5yZW1vdmUoKSA6IChlID0gMCA8IHRoaXMucm93cy5sZW5ndGggPyB0aGlzLnJvd3NbMF0gOiBudWxsLCBhKHRoaXMuZmlyc3RDaGlsZCkuZW1wdHkoKS5hcHBlbmQoZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgdGhpcy5wLnNjcm9sbCAmJiAoYSh0aGlzLmdyaWQuYkRpdi5maXJzdENoaWxkKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICJhdXRvIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKHRoaXMuZ3JpZC5iRGl2LmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiMHB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIDAgIT09IHRoaXMuZ3JpZC5iRGl2LnNjcm9sbFRvcCAmJiAodGhpcy5ncmlkLmJEaXYuc2Nyb2xsVG9wID0gMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBmICYmIHRoaXMucC50cmVlR3JpZCAmJiAhdGhpcy5wLmxvYWRvbmNlICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnAuZGF0YSA9IFtdLCB0aGlzLnAuX2luZGV4ID0ge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBmLCBjLCBoLCBtLCBkLCB3LCBsLCBnLCBuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBlLnA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBiLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBxLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGIubG9jYWxSZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBiLmNvbE1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gdS5jZWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gKCEwID09PSBiLm11bHRpc2VsZWN0ID8gMSA6IDApICsgKCEwID09PSBiLnN1YkdyaWQgPyAxIDogMCkgKyAoITAgPT09IGIucm93bnVtYmVycyA/IDEgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGIuc2Nyb2xsID8gYS5qZ3JpZC5yYW5kSWQoKSA6IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJsb2NhbCIgPT09IGIuZGF0YXR5cGUgJiYgITAgPT09IHUucmVwZWF0aXRlbXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobCA9IE8odCksIGcgPSBNKCJsb2NhbCIpLCBoID0gITEgPT09IGIua2V5SW5kZXggPyBhLmlzRnVuY3Rpb24odS5pZCkgPyB1LmlkLmNhbGwoZSwgcSkgOiB1LmlkIDogYi5rZXlJbmRleCwgYiA9IDA7IHIgPiBiOyBiKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBxW2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGEuamdyaWQuZ2V0QWNjZXNzb3IoYywgaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGYgJiYgKCJudW1iZXIiID09IHR5cGVvZiBoICYmIG51bGwgIT0gQltoICsgdF0gJiYgKGYgPSBhLmpncmlkLmdldEFjY2Vzc29yKGMsIEJbaCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdF0ubmFtZSkpLCB2b2lkIDAgPT09IGYgJiYgKGYgPSBrICsgYiwgeSAmJiAobSA9IGEuamdyaWQuZ2V0QWNjZXNzb3IoYywgeSkgfHwgYywgZiA9IG51bGwgIT0gbSAmJiB2b2lkIDAgIT09IG1baF0gPyBtW2hdIDogZiwgbSA9IG51bGwpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3W3UuaWRdID0gZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgJiYgKGMgPSBhLmpncmlkLmdldEFjY2Vzc29yKGMsIHkpIHx8IGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGEuaXNBcnJheShjKSA/IGwgOiBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IG4ubGVuZ3RoOyBmKyspIGQgPSBhLmpncmlkLmdldEFjY2Vzc29yKGMsIG5bZl0pLCB3W0JbZiArIHRdLm5hbWVdID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKCEwLCBxW2JdLCB3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiwgYywgaCA9IGUucC5kYXRhLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gITEgPT09IGUucC5rZXlOYW1lIHx8ICEwID09PSBlLnAubG9hZG9uY2UgPyBlLnAubG9jYWxSZWFkZXIuaWQgOiBlLnAua2V5TmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuX2luZGV4ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgaCA+IGY7IGYrKykgYyA9IGEuamdyaWQuZ2V0QWNjZXNzb3IoZS5wLmRhdGFbZl0sIGIpLCB2b2lkIDAgPT09IGMgJiYgKGMgPSBTdHJpbmcoZiArIDEpKSwgZS5wLl9pbmRleFtjXSA9IGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpYSA9IGZ1bmN0aW9uKGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiwgYywgaCwgbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCB3ID0gIi0xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmID8gImRpc3BsYXk6bm9uZTsiIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRSb3dBdHRyIiwgW2gsIG0sIGJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIm9iamVjdCIgIT0gdHlwZW9mIGcgJiYgKGcgPSBhLmlzRnVuY3Rpb24oZS5wLnJvd2F0dHIpID8gZS5wLnJvd2F0dHIuY2FsbChlLCBoLCBtLCBiKSA6ICJzdHJpbmciID09IHR5cGVvZiBlLnAucm93YXR0ciAmJiBudWxsICE9IGEuamdyaWQucm93YXR0ciAmJiBhLmlzRnVuY3Rpb24oYS5qZ3JpZC5yb3dhdHRyW2UucC5yb3dhdHRyXSkgPyBhLmpncmlkLnJvd2F0dHJbZS5wLnJvd2F0dHJdLmNhbGwoZSwgaCwgbSwgYikgOiB7fSksICFhLmlzRW1wdHlPYmplY3QoZykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5oYXNPd25Qcm9wZXJ0eSgiaWQiKSAmJiAoYiA9IGcuaWQsIGRlbGV0ZSBnLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5oYXNPd25Qcm9wZXJ0eSgidGFiaW5kZXgiKSAmJiAodyA9IGcudGFiaW5kZXgsIGRlbGV0ZSBnLnRhYmluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5oYXNPd25Qcm9wZXJ0eSgic3R5bGUiKSAmJiAoZiArPSBnLnN0eWxlLCBkZWxldGUgZy5zdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuaGFzT3duUHJvcGVydHkoImNsYXNzIikgJiYgKGMgKz0gIiAiICsgZ1siY2xhc3MiXSwgZGVsZXRlIGdbImNsYXNzIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGcucm9sZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChuKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgaW4gZykgZy5oYXNPd25Qcm9wZXJ0eShkKSAmJiAobCArPSAiICIgKyBkICsgIj0iICsgZ1tkXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8dHIgcm9sZT0icm93IiBpZD0iJyArIGIgKyAnIiB0YWJpbmRleD0iJyArIHcgKyAnIiBjbGFzcz0iJyArIGMgKyAnIicgKyAoIiIgPT09IGYgPyAiIiA6ICcgc3R5bGU9IicgKyBmICsgJyInKSArIGwgKyAiPiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTID0gZnVuY3Rpb24oYiwgZiwgYywgaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gbmV3IERhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAibG9jYWwiICE9PSBlLnAuZGF0YXR5cGUgJiYgZS5wLmxvYWRvbmNlIHx8ICJ4bWxzdHJpbmciID09PSBlLnAuZGF0YXR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBlLnAueG1sUmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gImxvY2FsIiA9PT0gZS5wLmRhdGF0eXBlID8gImxvY2FsIiA6ICJ4bWwiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkICYmIChlLnAuZGF0YSA9IFtdLCBlLnAuX2luZGV4ID0ge30sIGUucC5sb2NhbFJlYWRlci5pZCA9ICJfaWRfIiksIGUucC5yZWNjb3VudCA9IDAsIGEuaXNYTUxEb2MoYikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLTEgIT09IGUucC50cmVlQU5vZGUgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5zY3JvbGwgPyBmID0gMSA8IGYgPyBmIDogMSA6IChZLmNhbGwoZSwgITEsICEwKSwgZiA9IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZywgbiwgcSwgciwgdSwgQiwgdCwgaywgeCwgeiA9IGEoZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAhMCA9PT0gZS5wLm11bHRpc2VsZWN0ID8gMSA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAhMCA9PT0gZS5wLnJvd251bWJlcnMgPyAxIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEogPSAhMCA9PT0gZS5wLmFsdFJvd3MgPyBlLnAuYWx0Y2xhc3MgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSB5KEssICJyb3dCb3giLCAhMCwgImpxZ3JvdyB1aS1yb3ctIiArIGUucC5kaXJlY3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gZS5wLnN1YkdyaWQgJiYgKHAgPSAxLCByID0gYS5qZ3JpZC5nZXRNZXRob2QoImFkZFN1YkdyaWRDZWxsIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LnJlcGVhdGl0ZW1zIHx8IChUID0gTShsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSAhMSA9PT0gZS5wLmtleU5hbWUgPyBhLmlzRnVuY3Rpb24ody5pZCkgPyB3LmlkLmNhbGwoZSwgYikgOiB3LmlkIDogZS5wLmtleU5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAtMSA9PT0gU3RyaW5nKHUpLmluZGV4T2YoIlsiKSA/IFQubGVuZ3RoID8gZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodSwgYikudGV4dCgpIHx8IGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKHcuY2VsbCwgYikuZXEodSkudGV4dCgpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZ2V0QXR0cmlidXRlKHUucmVwbGFjZSgvW1xbXF1dL2csICIiKSkgfHwgYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAudXNlckRhdGEgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnBhZ2UgPSBHKGEuamdyaWQuZ2V0WG1sRGF0YShiLCB3LnBhZ2UpLCBlLnAucGFnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5sYXN0cGFnZSA9IEcoYS5qZ3JpZC5nZXRYbWxEYXRhKGIsIHcudG90YWwpLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnJlY29yZHMgPSBHKGEuamdyaWQuZ2V0WG1sRGF0YShiLCB3LnJlY29yZHMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKHcudXNlcmRhdGEpID8gZS5wLnVzZXJEYXRhID0gdy51c2VyZGF0YS5jYWxsKGUsIGIpIHx8IHt9IDogYS5qZ3JpZC5nZXRYbWxEYXRhKGIsIHcudXNlcmRhdGEsICEwKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnVzZXJEYXRhW3RoaXMuZ2V0QXR0cmlidXRlKCJuYW1lIildID0gYSh0aGlzKS50ZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhLmpncmlkLmdldFhtbERhdGEoYiwgdy5yb290LCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChiID0gYS5qZ3JpZC5nZXRYbWxEYXRhKGIsIHcucm93LCAhMCkpIHx8IChiID0gW10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgTiA9IGIubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBaID0gcGFyc2VJbnQoZS5wLnJvd051bSwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2EgPSBlLnAuc2Nyb2xsID8gYS5qZ3JpZC5yYW5kSWQoKSA6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICIgdGJvZHk6Zmlyc3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCBOICYmIDAgPj0gZS5wLnBhZ2UgJiYgKGUucC5wYWdlID0gMSksIGIgJiYgTikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCAmJiAoWiAqPSBoICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYS5pc0Z1bmN0aW9uKGUucC5hZnRlckluc2VydFJvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYSA9IEUgPyB5KEssICJyb3dudW1Cb3giLCAhMSwgImpxZ3JpZC1yb3dudW0iKSA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFggPSBBID8geShLLCAibXVsdGlCb3giLCAhMSwgImNib3giKSA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlLnAuZ3JvdXBpbmcgJiYgKGxhID0gITAgPT09IGUucC5ncm91cGluZ1ZpZXcuZ3JvdXBDb2xsYXBzZSwgaGEgPSBhLmpncmlkLmdldE1ldGhvZCgiZ3JvdXBpbmdQcmVwYXJlIikpOyBOID4gUTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gYltRXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gbCh0LCBrYSArIFEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBlLnAuaWRQcmVmaXggKyBrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAwID09PSBmID8gMCA6IGYgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBMICsgKDEgPT09IChnICsgUSkgJSAyID8gIiAiICsgSiA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWEgPSB2Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5wdXNoKCIiKSwgRSAmJiB2LnB1c2goRigwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUSwgZS5wLnBhZ2UsIGUucC5yb3dOdW0sIGJhKSksIEEgJiYgdi5wdXNoKEkoaywgRSwgUSwgITEsIFgpKSwgcCAmJiB2LnB1c2goci5jYWxsKHosIEEgKyBFLCBRICsgZikpLCB3LnJlcGVhdGl0ZW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgfHwgKEIgPSBPKEEgKyBwICsgRSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmEgPSBhLmpncmlkLmdldFhtbERhdGEodCwgdy5jZWxsLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChCLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHJhW3RoaXNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgPyAocSA9IGIudGV4dENvbnRlbnQgfHwgYi50ZXh0LCBIW2UucC5jb2xNb2RlbFthICsgQSArIHAgKyBFXS5uYW1lXSA9IHEsIHZvaWQgdi5wdXNoKEQoaywgcSwgYSArIEEgKyBwICsgRSwgUSArIGYsIHQsIEgpKSkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgVC5sZW5ndGg7IGcrKykgcSA9IGEuamdyaWQuZ2V0WG1sRGF0YSh0LCBUW2ddKSwgSFtlLnAuY29sTW9kZWxbZyArIEEgKyBwICsgRV0ubmFtZV0gPSBxLCB2LnB1c2goRChrLCBxLCBnICsgQSArIHAgKyBFLCBRICsgZiwgdCwgSCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2W2VhXSA9IGlhKGssIGxhLCB4LCBILCB0KSwgdi5wdXNoKCI8L3RyPiIpLCBlLnAuZ3JvdXBpbmcgJiYgKFIucHVzaCh2KSwgZS5wLmdyb3VwaW5nVmlldy5fbG9jZ3IgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhLmNhbGwoeiwgSCwgUSksIHYgPSBbXSksIChkIHx8ICEwID09PSBlLnAudHJlZUdyaWQgJiYgIWUucC5fYWxkKSAmJiAoSC5faWRfID0gYS5qZ3JpZC5zdHJpcFByZWYoZS5wLmlkUHJlZml4LCBrKSwgZS5wLmRhdGEucHVzaChIKSwgZS5wLl9pbmRleFtILl9pZF9dID0gZS5wLmRhdGEubGVuZ3RoIC0gMSksICExID09PSBlLnAuZ3JpZHZpZXcgJiYgKFUuYXBwZW5kKHYuam9pbigiIikpLCB6LnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlckluc2VydFJvdyIsIFtrLCBILCB0XSksIGggJiYgZS5wLmFmdGVySW5zZXJ0Um93LmNhbGwoZSwgaywgSCwgdCksIHYgPSBbXSksIEggPSB7fSwgQysrLCBRKyssIEMgPT09IFopIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBlLnAuZ3JpZHZpZXcgJiYgKG4gPSAtMSA8IGUucC50cmVlQU5vZGUgPyBlLnAudHJlZUFOb2RlIDogMCwgZS5wLmdyb3VwaW5nID8gZCB8fCAoei5qcUdyaWQoImdyb3VwaW5nUmVuZGVyIiwgUiwgZS5wLmNvbE1vZGVsLmxlbmd0aCwgZS5wLnBhZ2UsIFopLCBSID0gbnVsbCkgOiAhMCA9PT0gZS5wLnRyZWVHcmlkICYmIDAgPCBuID8gYShlLnJvd3Nbbl0pLmFmdGVyKHYuam9pbigiIikpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoVS5hcHBlbmQodi5qb2luKCIiKSksIGUuZ3JpZC5jb2xzID0gZS5yb3dzWzBdLmNlbGxzKSksICEwID09PSBlLnAuc3ViR3JpZCkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHouanFHcmlkKCJhZGRTdWJHcmlkIiwgQSArIEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHRhKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLnRvdGFsdGltZSA9IG5ldyBEYXRlIC0gbSwgMCA8IEMgJiYgMCA9PT0gZS5wLnJlY29yZHMgJiYgKGUucC5yZWNvcmRzID0gTiksIHYgPSBudWxsLCAhMCA9PT0gZS5wLnRyZWVHcmlkKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgei5qcUdyaWQoInNldFRyZWVOb2RlIiwgbiArIDEsIEMgKyBuICsgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodGEpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnAucmVjY291bnQgPSBDLCBlLnAudHJlZUFOb2RlID0gLTEsIGUucC51c2VyRGF0YU9uRm9vdGVyICYmIHouanFHcmlkKCJmb290ZXJEYXRhIiwgInNldCIsIGUucC51c2VyRGF0YSwgITApLCBkICYmIChlLnAucmVjb3JkcyA9IE4sIGUucC5sYXN0cGFnZSA9IE1hdGguY2VpbChOIC8gWikpLCBjIHx8IGUudXBkYXRlcGFnZXIoITEsICEwKSwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IE4gPiBDOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ID0gYltDXSwgayA9IGwodCwgQyArIGthKSwgayA9IGUucC5pZFByZWZpeCArIGssIHcucmVwZWF0aXRlbXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiB8fCAoQiA9IE8oQSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwICsgRSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgUyA9IGEuamdyaWQuZ2V0WG1sRGF0YSh0LCB3LmNlbGwsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKEIsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gU1t0aGlzXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiID8gKHEgPSBiLnRleHRDb250ZW50IHx8IGIudGV4dCwgdm9pZChIW2UucC5jb2xNb2RlbFthICsgQSArIHAgKyBFXS5uYW1lXSA9IHEpKSA6ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBULmxlbmd0aDsgZysrKSBxID0gYS5qZ3JpZC5nZXRYbWxEYXRhKHQsIFRbZ10pLCBIW2UucC5jb2xNb2RlbFtnICsgQSArIHAgKyBFXS5uYW1lXSA9IHE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSC5faWRfID0gYS5qZ3JpZC5zdHJpcFByZWYoZS5wLmlkUHJlZml4LCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuZ3JvdXBpbmcgJiYgaGEuY2FsbCh6LCBILCBDKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuZGF0YS5wdXNoKEgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5faW5kZXhbSC5faWRfXSA9IGUucC5kYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMrKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmdyb3VwaW5nICYmIChlLnAuZ3JvdXBpbmdWaWV3Ll9sb2NnciA9ICEwLCB6LmpxR3JpZCgiZ3JvdXBpbmdSZW5kZXIiLCBSLCBlLnAuY29sTW9kZWwubGVuZ3RoLCBlLnAucGFnZSwgWiksIFIgPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgPSBmdW5jdGlvbihiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IG5ldyBEYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0xICE9PSBlLnAudHJlZUFOb2RlIHx8IGUucC5zY3JvbGwgPyBmID0gMSA8IGYgPyBmIDogMSA6IChZLmNhbGwoZSwgITEsICEwKSwgZiA9IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCwgdywgbCA9ICJsb2NhbCIgIT09IGUucC5kYXRhdHlwZSAmJiBlLnAubG9hZG9uY2UgfHwgImpzb25zdHJpbmciID09PSBlLnAuZGF0YXR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgJiYgKGUucC5kYXRhID0gW10sIGUucC5faW5kZXggPSB7fSwgZS5wLmxvY2FsUmVhZGVyLmlkID0gIl9pZF8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnJlY2NvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxvY2FsIiA9PT0gZS5wLmRhdGF0eXBlID8gKGQgPSBlLnAubG9jYWxSZWFkZXIsIHcgPSAibG9jYWwiKSA6IChkID0gZS5wLmpzb25SZWFkZXIsIHcgPSAianNvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZywgbiwgcSwgciwgdSwgQiwgdCwgaywgeiwgeCwgQyA9IGEoZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSBlLnAubXVsdGlzZWxlY3QgPyAxIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSAhMCA9PT0gZS5wLnN1YkdyaWQgPyAxIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEogPSAhMCA9PT0gZS5wLnJvd251bWJlcnMgPyAxIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSBPKEggKyB2ICsgSiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOID0gTSh3KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFogPSAhMCA9PT0gZS5wLmFsdFJvd3MgPyBlLnAuYWx0Y2xhc3MgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGthID0geShLLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyb3dCb3giLCAhMCwgImpxZ3JvdyB1aS1yb3ctIiArIGUucC5kaXJlY3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAucGFnZSA9IEcoYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCBkLnBhZ2UpLCBlLnAucGFnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5sYXN0cGFnZSA9IEcoYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCBkLnRvdGFsKSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5yZWNvcmRzID0gRyhhLmpncmlkLmdldEFjY2Vzc29yKGIsIGQucmVjb3JkcykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAudXNlckRhdGEgPSBhLmpncmlkLmdldEFjY2Vzc29yKGIsIGQudXNlcmRhdGEpIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ICYmICh1ID0gYS5qZ3JpZC5nZXRNZXRob2QoImFkZFN1YkdyaWRDZWxsIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gITEgPT09IGUucC5rZXlOYW1lID8gYS5pc0Z1bmN0aW9uKGQuaWQpID8gZC5pZC5jYWxsKGUsIGIpIDogZC5pZCA6IGUucC5rZXlOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCBkLnJvb3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09IHcgJiYgYS5pc0FycmF5KGIpICYmICh3ID0gYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgfHwgKHcgPSBbXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSB3Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPCBiICYmIDAgPj0gZS5wLnBhZ2UgJiYgKGUucC5wYWdlID0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBVLCBoYSA9IHBhcnNlSW50KGUucC5yb3dOdW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGEgPSBlLnAuc2Nyb2xsID8gYS5qZ3JpZC5yYW5kSWQoKSA6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYSA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoICYmIChoYSAqPSBoICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhbCIgIT09IGUucC5kYXRhdHlwZSB8fCBlLnAuZGVzZWxlY3RBZnRlclNvcnQgfHwgKGJhID0gITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgWCwgZWEgPSBhLmlzRnVuY3Rpb24oZS5wLmFmdGVySW5zZXJ0Um93KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICIgdGJvZHk6Zmlyc3QiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBKID8geShLLCAicm93bnVtQm94IiwgITEsICJqcWdyaWQtcm93bnVtIikgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgPSBIID8geShLLCAibXVsdGlCb3giLCAhMSwgImNib3giKSA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUucC5ncm91cGluZyAmJiAocmEgPSAhMCA9PT0gZS5wLmdyb3VwaW5nVmlldy5ncm91cENvbGxhcHNlLCBYID0gYS5qZ3JpZC5nZXRNZXRob2QoImdyb3VwaW5nUHJlcGFyZSIpKTsgYiA+IG47KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAociA9IHdbbl0sIHogPSBhLmpncmlkLmdldEFjY2Vzc29yKHIsIHQpLCB2b2lkIDAgPT09IHogJiYgKCJudW1iZXIiID09IHR5cGVvZiB0ICYmIG51bGwgIT0gZS5wLmNvbE1vZGVsW3QgKyBIICsgdiArIEpdICYmICh6ID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuY29sTW9kZWxbdCArIEggKyB2ICsgSl0ubmFtZSkpLCB2b2lkIDAgPT09IHogJiYgKHogPSBsYSArIG4sIDAgPT09IEUubGVuZ3RoICYmIGQuY2VsbCkpKSBnID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihyLCBkLmNlbGwpIHx8IHIsIHogPSBudWxsICE9IGcgJiYgdm9pZCAwICE9PSBnW3RdID8gZ1t0XSA6IHo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gZS5wLmlkUHJlZml4ICsgejsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAxID09PSBmID8gMCA6IGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0ga2EgKyAoMSA9PT0gKGcgKyBuKSAlIDIgPyAiICIgKyBaIDogIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmEgJiYgKFUgPSBlLnAubXVsdGlzZWxlY3QgPyAtMSAhPT0gYS5pbkFycmF5KHosIGUucC5zZWxhcnJyb3cpIDogeiA9PT0gZS5wLnNlbHJvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgS2EgPSBSLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIucHVzaCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKICYmIFIucHVzaChGKDAsIG4sIGUucC5wYWdlLCBlLnAucm93TnVtLCBTKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIICYmIFIucHVzaChJKHosIEosIG4sIFUsIFApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgJiYgUi5wdXNoKHUuY2FsbChDLCBIICsgSiwgbiArIGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBOOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXBlYXRpdGVtcyAmJiAoZC5jZWxsICYmIChyID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihyLCBkLmNlbGwpIHx8IHIpLCBhLmlzQXJyYXkocikgJiYgKEIgPSBMKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHEgPSAwOyBxIDwgQi5sZW5ndGg7IHErKykgZyA9IGEuamdyaWQuZ2V0QWNjZXNzb3IociwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCW3FdKSwgUVtlLnAuY29sTW9kZWxbcSArIEggKyB2ICsgSl0ubmFtZV0gPSBnLCBSLnB1c2goRCh6LCBnLCBxICsgSCArIHYgKyBKLCBuICsgZiwgciwgUSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggKz0gVSA/ICIgIiArIHAgOiAiIiwgUltLYV0gPSBpYSh6LCByYSwgeCwgUSwgciksIFIucHVzaCgiPC90cj4iKSwgZS5wLmdyb3VwaW5nICYmIChoLnB1c2goUiksIGUucC5ncm91cGluZ1ZpZXcuX2xvY2dyIHx8IFguY2FsbChDLCBRLCBuKSwgUiA9IFtdKSwgKGwgfHwgITAgPT09IGUucC50cmVlR3JpZCAmJiAhZS5wLl9hbGQpICYmIChRLl9pZF8gPSBhLmpncmlkLnN0cmlwUHJlZihlLnAuaWRQcmVmaXgsIHopLCBlLnAuZGF0YS5wdXNoKFEpLCBlLnAuX2luZGV4W1EuX2lkX10gPSBlLnAuZGF0YS5sZW5ndGggLSAxKSwgITEgPT09IGUucC5ncmlkdmlldyAmJiAodGEuYXBwZW5kKFIuam9pbigiIikpLCBDLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlckluc2VydFJvdyIsIFt6LCBRLCByXSksIGVhICYmIGUucC5hZnRlckluc2VydFJvdy5jYWxsKGUsIHosIFEsIHIpLCBSID0gW10pLCBRID0ge30sIEErKywgbisrLCBBID09PSBoYSkgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGUucC5ncmlkdmlldyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGsgPSAtMSA8IGUucC50cmVlQU5vZGUgPyBlLnAudHJlZUFOb2RlIDogMCwgZS5wLmdyb3VwaW5nID8gbCB8fCAoQy5qcUdyaWQoImdyb3VwaW5nUmVuZGVyIiwgaCwgZS5wLmNvbE1vZGVsLmxlbmd0aCwgZS5wLnBhZ2UsIGhhKSwgaCA9IG51bGwpIDogITAgPT09IGUucC50cmVlR3JpZCAmJiAwIDwgayA/IGEoZS5yb3dzW2tdKS5hZnRlcihSLmpvaW4oIiIpKSA6ICh0YS5hcHBlbmQoUi5qb2luKCIiKSksIGUuZ3JpZC5jb2xzID0gZS5yb3dzWzBdLmNlbGxzKSksICEwID09PSBlLnAuc3ViR3JpZCkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMuanFHcmlkKCJhZGRTdWJHcmlkIiwgSCArIEopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGRiKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLnRvdGFsdGltZSA9IG5ldyBEYXRlIC0gbSwgMCA8IEEgJiYgMCA9PT0gZS5wLnJlY29yZHMgJiYgKGUucC5yZWNvcmRzID0gYiksICEwID09PSBlLnAudHJlZUdyaWQpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLmpxR3JpZCgic2V0VHJlZU5vZGUiLCBrICsgMSwgQSArIGsgKyAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChkYikge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucC5yZWNjb3VudCA9IEEsIGUucC50cmVlQU5vZGUgPSAtMSwgZS5wLnVzZXJEYXRhT25Gb290ZXIgJiYgQy5qcUdyaWQoImZvb3RlckRhdGEiLCAic2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAudXNlckRhdGEsICEwKSwgbCAmJiAoZS5wLnJlY29yZHMgPSBiLCBlLnAubGFzdHBhZ2UgPSBNYXRoLmNlaWwoYiAvIGhhKSksIGMgfHwgZS51cGRhdGVwYWdlcighMSwgITApLCBsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYiA+IEEgJiYgd1tBXTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAociA9IHdbQV0sIHogPSBhLmpncmlkLmdldEFjY2Vzc29yKHIsIHQpLCB2b2lkIDAgPT09IHogJiYgKCJudW1iZXIiID09IHR5cGVvZiB0ICYmIG51bGwgIT0gZS5wLmNvbE1vZGVsW3QgKyBIICsgdiArIEpdICYmICh6ID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihyLCBlLnAuY29sTW9kZWxbdCArIEggKyB2ICsgSl0ubmFtZSkpLCB2b2lkIDAgPT09IHogJiYgKHogPSBsYSArIEEsIDAgPT09IEUubGVuZ3RoICYmIGQuY2VsbCkpKSBmID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihyLCBkLmNlbGwpIHx8IHIsIHogPSBudWxsICE9IGYgJiYgdm9pZCAwICE9PSBmW3RdID8gZlt0XSA6IHo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IGUucC5pZFByZWZpeCArIHo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBOOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnJlcGVhdGl0ZW1zICYmIChkLmNlbGwgJiYgKHIgPSBhLmpncmlkLmdldEFjY2Vzc29yKHIsIGQuY2VsbCkgfHwgciksIGEuaXNBcnJheShyKSAmJiAoQiA9IEwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChxID0gMDsgcSA8IEIubGVuZ3RoOyBxKyspIFFbZS5wLmNvbE1vZGVsW3EgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCArIHYgKyBKXS5uYW1lXSA9IGEuamdyaWQuZ2V0QWNjZXNzb3IociwgQltxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEuX2lkXyA9IGEuamdyaWQuc3RyaXBQcmVmKGUucC5pZFByZWZpeCwgeik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5ncm91cGluZyAmJiBYLmNhbGwoQywgUSwgQSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5kYXRhLnB1c2goUSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5faW5kZXhbUS5faWRfXSA9IGUucC5kYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBKysKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5ncm91cGluZyAmJiAoZS5wLmdyb3VwaW5nVmlldy5fbG9jZ3IgPSAhMCwgQy5qcUdyaWQoImdyb3VwaW5nUmVuZGVyIiwgaCwgZS5wLmNvbE1vZGVsLmxlbmd0aCwgZS5wLnBhZ2UsIGhhKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBoLCBtLCBkLCB3LCBsLCBuID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gZi5ncm91cHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChoID0gZi5ncm91cHMubGVuZ3RoICYmICJPUiIgPT09IGYuZ3JvdXBPcC50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkpICYmIGsub3JCZWdpbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGYuZ3JvdXBzLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IG4gJiYgaCAmJiBrLm9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYihmLmdyb3Vwc1tjXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4rKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsub3JFbmQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGYucnVsZXMpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobSA9IGYucnVsZXMubGVuZ3RoICYmICJPUiIgPT09IGYuZ3JvdXBPcC50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkpICYmIGsub3JCZWdpbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGYucnVsZXMubGVuZ3RoOyBjKyspIHcgPSBmLnJ1bGVzW2NdLCBkID0gZi5ncm91cE9wLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKSwgeVt3Lm9wXSAmJiB3LmZpZWxkICYmICgwIDwgbiAmJiBkICYmICJPUiIgPT09IGQgJiYgKGsgPSBrLm9yKCkpLCBsID0gZ1t3LmZpZWxkXSwgImRhdGUiID09PSBsLnN0eXBlICYmIGwuc3JjZm10ICYmIGwubmV3Zm10ICYmIGwuc3JjZm10ICE9PSBsLm5ld2ZtdCAmJiAody5kYXRhID0gYS5qZ3JpZC5wYXJzZURhdGUuY2FsbChlLCBsLm5ld2ZtdCwgdy5kYXRhLCBsLnNyY2ZtdCkpLCBrID0geVt3Lm9wXShrLCBkKSh3LmZpZWxkLCB3LmRhdGEsIGdbdy5maWVsZF0pKSwgbisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSAmJiBrLm9yRW5kKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAocSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQocSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgYywgaCwgbSwgZCA9IGUucC5tdWx0aVNvcnQgPyBbXSA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pc0FycmF5KGUucC5kYXRhKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciwgdSwgQiwgdCA9IGUucC5ncm91cGluZyA/IGUucC5ncm91cGluZ1ZpZXcgOiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZWFjaChlLnAuY29sTW9kZWwsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gdGhpcy5zb3J0dHlwZSB8fCAidGV4dCIsIEIgPSB0aGlzLmluZGV4IHx8IHRoaXMubmFtZSwgImRhdGUiID09PSBjIHx8ICJkYXRldGltZSIgPT09IGMgPyAodGhpcy5mb3JtYXR0ZXIgJiYgInN0cmluZyIgPT0gdHlwZW9mIHRoaXMuZm9ybWF0dGVyICYmICJkYXRlIiA9PT0gdGhpcy5mb3JtYXR0ZXIgPyAoZiA9IHRoaXMuZm9ybWF0b3B0aW9ucyAmJiB0aGlzLmZvcm1hdG9wdGlvbnMuc3JjZm9ybWF0ID8gdGhpcy5mb3JtYXRvcHRpb25zLnNyY2Zvcm1hdCA6IGEuamdyaWQuZ2V0UmVnaW9uYWwoZSwgImZvcm1hdHRlci5kYXRlLnNyY2Zvcm1hdCIpLCBoID0gdGhpcy5mb3JtYXRvcHRpb25zICYmIHRoaXMuZm9ybWF0b3B0aW9ucy5uZXdmb3JtYXQgPyB0aGlzLmZvcm1hdG9wdGlvbnMubmV3Zm9ybWF0IDogYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZm9ybWF0dGVyLmRhdGUubmV3Zm9ybWF0IikpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBoID0gdGhpcy5kYXRlZm10IHx8ICJZLW0tZCIsIGdbQl0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5cGU6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjZm10OiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld2ZtdDogaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZnVuYzogdGhpcy5zb3J0ZnVuYyB8fCBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGdbQl0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlwZTogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY2ZtdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdmbXQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Z1bmM6IHRoaXMuc29ydGZ1bmMgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBlLnAuZ3JvdXBpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodSA9IDAsIHIgPSB0Lmdyb3VwRmllbGQubGVuZ3RoOyByID4gdTsgdSsrKSB0aGlzLm5hbWUgPT09IHQuZ3JvdXBGaWVsZFt1XSAmJiAoblt1XSA9IGdbQl0sIHFbdV0gPSBCKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAubXVsdGlTb3J0IHx8IGwgfHwgQiAhPT0gZS5wLnNvcnRuYW1lIHx8IChkID0gQiwgbCA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGUucC5tdWx0aVNvcnQgJiYgKGQgPSBILCB3ID0gRSksIGUucC50cmVlR3JpZCAmJiBlLnAuX3NvcnQpIHJldHVybiB2b2lkIGEoZSkuanFHcmlkKCJTb3J0VHJlZSIsIGQsIGUucC5zb3J0b3JkZXIsIGdbZF0uc3R5cGUgfHwgInRleHQiLCBnW2RdLnNyY2ZtdCB8fCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmVxdWFscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubm90RXF1YWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sZXNzT3JFcXVhbHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmdyZWF0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmdyZWF0ZXJPckVxdWFscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY246IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuY29udGFpbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5jOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiT1IiID09PSBiID8gYS5vck5vdCgpLmNvbnRhaW5zIDogYS5hbmROb3QoKS5jb250YWlucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3RhcnRzV2l0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm46IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJPUiIgPT09IGIgPyBhLm9yTm90KCkuc3RhcnRzV2l0aCA6IGEuYW5kTm90KCkuc3RhcnRzV2l0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW46IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJPUiIgPT09IGIgPyBhLm9yTm90KCkuZW5kc1dpdGggOiBhLmFuZE5vdCgpLmVuZHNXaXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5lbmRzV2l0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmk6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJPUiIgPT09IGIgPyBhLm9yTm90KCkuZXF1YWxzIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYW5kTm90KCkuZXF1YWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW4iOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmVxdWFscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuaXNOdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBubjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk9SIiA9PT0gYiA/IGEub3JOb3QoKS5pc051bGwgOiBhLmFuZE5vdCgpLmlzTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gYS5qZ3JpZC5mcm9tLmNhbGwoZSwgZS5wLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLmlnbm9yZUNhc2UgJiYgKGsgPSBrLmlnbm9yZUNhc2UoKSksICEwID09PSBlLnAuc2VhcmNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeiA9IGUucC5wb3N0RGF0YS5maWx0ZXJzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHopICJzdHJpbmciID09IHR5cGVvZiB6ICYmICh6ID0gYS5qZ3JpZC5wYXJzZSh6KSksIGIoeik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGdbZS5wLnBvc3REYXRhLnNlYXJjaEZpZWxkXSwgImRhdGUiID09PSBtLnN0eXBlICYmIG0uc3JjZm10ICYmIG0ubmV3Zm10ICYmIG0uc3JjZm10ICE9PSBtLm5ld2ZtdCAmJiAoZS5wLnBvc3REYXRhLnNlYXJjaFN0cmluZyA9IGEuamdyaWQucGFyc2VEYXRlLmNhbGwoZSwgbS5uZXdmbXQsIGUucC5wb3N0RGF0YS5zZWFyY2hTdHJpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uc3JjZm10KSksIGsgPSB5W2UucC5wb3N0RGF0YS5zZWFyY2hPcGVyXShrKShlLnAucG9zdERhdGEuc2VhcmNoRmllbGQsIGUucC5wb3N0RGF0YS5zZWFyY2hTdHJpbmcsIGdbZS5wLnBvc3REYXRhLnNlYXJjaEZpZWxkXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHgpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBlLnAudHJlZUdyaWQgJiYgIm5lc3RlZCIgPT09IGUucC50cmVlR3JpZE1vZGVsICYmIGsub3JkZXJCeShlLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLCAiYXNjIiwgImludGVnZXIiLCAiIiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnAudHJlZUdyaWQgJiYgImFkamFjZW5jeSIgPT09IGUucC50cmVlR3JpZE1vZGVsICYmIChyID0gMCwgZCA9IG51bGwpLCBlLnAuZ3JvdXBpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSAwOyByID4gdTsgdSsrKSBrLm9yZGVyQnkocVt1XSwgdC5ncm91cE9yZGVyW3VdLCBuW3VdLnN0eXBlLCBuW3VdLnNyY2ZtdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5tdWx0aVNvcnQgPyBhLmVhY2goZCwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsub3JkZXJCeSh0aGlzLCB3W2FdLCBnW3RoaXNdLnN0eXBlLCBnW3RoaXNdLnNyY2ZtdCwgZ1t0aGlzXS5zZnVuYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogZCAmJiBlLnAuc29ydG9yZGVyICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsICYmICgiREVTQyIgPT09IGUucC5zb3J0b3JkZXIudG9VcHBlckNhc2UoKSA/IGsub3JkZXJCeShlLnAuc29ydG5hbWUsICJkIiwgZ1tkXS5zdHlwZSwgZ1tkXS5zcmNmbXQsIGdbZF0uc2Z1bmMpIDogay5vcmRlckJ5KGUucC5zb3J0bmFtZSwgImEiLCBnW2RdLnN0eXBlLCBnW2RdLnNyY2ZtdCwgZ1tkXS5zZnVuYykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gay5zZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHogPSBwYXJzZUludChlLnAucm93TnVtLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gbS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gcGFyc2VJbnQoZS5wLnBhZ2UsIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSBNYXRoLmNlaWwoQyAvIHopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGUucC5zZWFyY2ggfHwgZS5wLnJlc2V0c2VhcmNoKSAmJiBlLnAuZ3JvdXBpbmcgJiYgZS5wLmdyb3VwaW5nVmlldy5fbG9jZ3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5ncm91cGluZ1ZpZXcuZ3JvdXBzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgVCwgdiwgRywgSiA9IGEuamdyaWQuZ2V0TWV0aG9kKCJncm91cGluZ1ByZXBhcmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnAuZm9vdGVycm93ICYmIGUucC51c2VyRGF0YU9uRm9vdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2IGluIGUucC51c2VyRGF0YSkgZS5wLnVzZXJEYXRhLmhhc093blByb3BlcnR5KHYpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLnAudXNlckRhdGFbdl0gPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoVCA9IDA7IEMgPiBUOyBUKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2IGluIGUucC51c2VyRGF0YSkgZS5wLnVzZXJEYXRhLmhhc093blByb3BlcnR5KHYpICYmIChlLnAudXNlckRhdGFbdl0gKz0gcGFyc2VGbG9hdChtW1RdW3ZdIHx8IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKLmNhbGwoYShlKSwgbVtUXSwgVCwgeikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbSA9IGUucC50cmVlR3JpZCAmJiBlLnAuc2VhcmNoID8gYShlKS5qcUdyaWQoInNlYXJjaFRyZWUiLCBtKSA6IG0uc2xpY2UoKEEgLSAxKSAqIHosIEEgKiB6KSwgayA9IG51bGwsIGcgPSBudWxsLCBwW2UucC5sb2NhbFJlYWRlci50b3RhbF0gPSBLLCBwW2UucC5sb2NhbFJlYWRlci5wYWdlXSA9IEEsIHBbZS5wLmxvY2FsUmVhZGVyLnJlY29yZHNdID0gQywgcFtlLnAubG9jYWxSZWFkZXIucm9vdF0gPSBtLCBwW2UucC5sb2NhbFJlYWRlci51c2VyZGF0YV0gPSBlLnAudXNlckRhdGEsIG0gPSBudWxsLCBwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5ncmlkLmhEaXYubG9hZGluZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5oaWRkZW5ncmlkIHx8IGEoZSkuanFHcmlkKCJwcm9ncmVzc0JhciIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAic2hvdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWR0eXBlOiBlLnAubG9hZHVpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sY29udGVudDogYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZGVmYXVsdHMubG9hZHRleHQiLCBlLnAubG9hZHRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5ncmlkLmhEaXYubG9hZGluZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkuanFHcmlkKCJwcm9ncmVzc0JhciIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiaGlkZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWR0eXBlOiBlLnAubG9hZHVpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWUuZ3JpZC5oRGl2LmxvYWRpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGMsIGggPSBlLnAuc2Nyb2xsICYmICExID09PSBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gZS5wLnBybU5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID49IGUucC5wYWdlICYmIChlLnAucGFnZSA9IE1hdGgubWluKDEsIGUucC5sYXN0cGFnZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBtLnNlYXJjaCAmJiAoY1ttLnNlYXJjaF0gPSBlLnAuc2VhcmNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gbS5uZCAmJiAoY1ttLm5kXSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gbS5yb3dzICYmIChjW20ucm93c10gPSBlLnAucm93TnVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gbS5wYWdlICYmIChjW20ucGFnZV0gPSBlLnAucGFnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT09IG0uc29ydCAmJiAoY1ttLnNvcnRdID0gZS5wLnNvcnRuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gbS5vcmRlciAmJiAoY1ttLm9yZGVyXSA9IGUucC5zb3J0b3JkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBlLnAucm93VG90YWwgJiYgbnVsbCAhPT0gbS50b3RhbHJvd3MgJiYgKGNbbS50b3RhbHJvd3NdID0gZS5wLnJvd1RvdGFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhLmlzRnVuY3Rpb24oZS5wLmxvYWRDb21wbGV0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gZCA/IGUucC5sb2FkQ29tcGxldGUgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gYiB8fCAxLCAxIDwgYiA/IG51bGwgIT09IG0ubnBhZ2UgPyAoY1ttLm5wYWdlXSA9IGIsIGwgPSBiIC0gMSwgYiA9IDEpIDogdyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAucGFnZSsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZ3JpZC5oRGl2LmxvYWRpbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICYmIGUucC5sb2FkQ29tcGxldGUuY2FsbChlLCBhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYShiIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBudWxsICE9PSBtLm5wYWdlICYmIGRlbGV0ZSBlLnAucG9zdERhdGFbbS5ucGFnZV0sIGUucC5ncm91cGluZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShlKS5qcUdyaWQoImdyb3VwaW5nU2V0dXAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBuID0gZS5wLmdyb3VwaW5nVmlldywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgbi5ncm91cEZpZWxkLmxlbmd0aDsgZysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmdyb3VwRmllbGRbZ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGUucC5jb2xNb2RlbCwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLm5hbWUgPT09IHIgJiYgYi5pbmRleCAmJiAociA9IGIuaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSArPSByICsgIiAiICsgbi5ncm91cE9yZGVyW2ddICsgIiwgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY1ttLnNvcnRdID0gcSArIGNbbS5zb3J0XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKGUucC5wb3N0RGF0YSwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gZS5wLnNjcm9sbCA/IGUucm93cy5sZW5ndGggLSAxIDogMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEJlZm9yZVJlcXVlc3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCExICE9PSBjICYmICJzdG9wIiAhPT0gYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaXNGdW5jdGlvbihlLnAuZGF0YXR5cGUpKSByZXR1cm4gdm9pZCBlLnAuZGF0YXR5cGUuY2FsbChlLCBlLnAucG9zdERhdGEsICJsb2FkXyIgKyBlLnAuaWQsIHUsIGIsIGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmlzRnVuY3Rpb24oZS5wLmJlZm9yZVJlcXVlc3QpIHx8IChjID0gZS5wLmJlZm9yZVJlcXVlc3QuY2FsbChlKSwgdm9pZCAwID09PSBjICYmIChjID0gITApLCAhMSAhPT0gYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGYgPSBlLnAuZGF0YXR5cGUudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJqc29uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAianNvbnAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ4bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5hamF4KGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGUucC51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogZS5wLm10eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGEuaXNGdW5jdGlvbihlLnAuc2VyaWFsaXplR3JpZERhdGEpID8gZS5wLnNlcmlhbGl6ZUdyaWREYXRhLmNhbGwoZSwgZS5wLnBvc3REYXRhKSA6IGUucC5wb3N0RGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihjLCBtLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlzRnVuY3Rpb24oZS5wLmJlZm9yZVByb2Nlc3NpbmcpICYmICExID09PSBlLnAuYmVmb3JlUHJvY2Vzc2luZy5jYWxsKGUsIGMsIG0sIGQpID8gdm9pZCBWKCkgOiAoInhtbCIgPT09IGYgPyBTKGMsIHUsIDEgPCBiLCBsKSA6IFAoYywgdSwgMSA8IGIsIGwpLCBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRMb2FkQ29tcGxldGUiLCBbY10pLCB3ICYmIHcuY2FsbChlLCBjKSwgYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJMb2FkQ29tcGxldGUiLCBbY10pLCBoICYmIGUuZ3JpZC5wb3B1bGF0ZVZpc2libGUoKSwgKGUucC5sb2Fkb25jZSB8fCBlLnAudHJlZUdyaWQpICYmIChlLnAuZGF0YXR5cGUgPSAibG9jYWwiKSwgdm9pZCgxID09PSBiICYmIFYoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYywgaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oZS5wLmxvYWRFcnJvcikgJiYgZS5wLmxvYWRFcnJvci5jYWxsKGUsIGYsIGMsIGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxID09PSBiICYmIFYoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5pc0Z1bmN0aW9uKGUucC5sb2FkQmVmb3JlU2VuZCkgJiYgKGMgPSBlLnAubG9hZEJlZm9yZVNlbmQuY2FsbChlLCBiLCBmKSksIHZvaWQgMCA9PT0gYyAmJiAoYyA9ICEwKSwgITEgPT09IGMgPyAhMSA6IHZvaWQgR2EoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGEuamdyaWQuYWpheE9wdGlvbnMsIGUucC5hamF4R3JpZE9wdGlvbnMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ4bWxzdHJpbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2EoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAic3RyaW5nIiAhPSB0eXBlb2YgZS5wLmRhdGFzdHIgPyBlLnAuZGF0YXN0ciA6IGEucGFyc2VYTUwoZS5wLmRhdGFzdHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyhjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZExvYWRDb21wbGV0ZSIsIFtjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICYmIGUucC5sb2FkQ29tcGxldGUuY2FsbChlLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFmdGVyTG9hZENvbXBsZXRlIiwgW2NdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5kYXRhdHlwZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxvY2FsIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5kYXRhc3RyID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJqc29uc3RyaW5nIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gInN0cmluZyIgPT0gdHlwZW9mIGUucC5kYXRhc3RyID8gYS5qZ3JpZC5wYXJzZShlLnAuZGF0YXN0cikgOiBlLnAuZGF0YXN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRMb2FkQ29tcGxldGUiLCBbY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiBlLnAubG9hZENvbXBsZXRlLmNhbGwoZSwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlckxvYWRDb21wbGV0ZSIsIFtjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuZGF0YXR5cGUgPSAibG9jYWwiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmRhdGFzdHIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxvY2FsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2xpZW50c2lkZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYSgpLCBlLnAuZGF0YXR5cGUgPSAibG9jYWwiLCBlLnAuX2FsZCA9ICEwLCBjID0gVygpLCBQKGMsIHUsIDEgPCBiLCBsKSwgYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkTG9hZENvbXBsZXRlIiwgW2NdKSwgdyAmJiB3LmNhbGwoZSwgYyksIGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFmdGVyTG9hZENvbXBsZXRlIiwgW2NdKSwgaCAmJiBlLmdyaWQucG9wdWxhdGVWaXNpYmxlKCksIFYoKSwgZS5wLl9hbGQgPSAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuX3NvcnQgPSAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNjYl8iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCksIGUuZ3JpZC5oRGl2KVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuZnJvemVuQ29sdW1ucyAmJiBlLnAuaWQgKyAiX2Zyb3plbiIgJiYgYSgiI2NiXyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSwgZS5ncmlkLmZoRGl2KVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBoLCBtLCBkLCB3LCBsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICI8dGQgY2xhc3M9J3VpLXBnLWJ1dHRvbiAiICsgQyArICInPjxzcGFuIGNsYXNzPSd1aS1zZXBhcmF0b3InPjwvc3Bhbj48L3RkPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9ICI8dGFibGUgY2xhc3M9J3VpLXBnLXRhYmxlIHVpLWNvbW1vbi10YWJsZSB1aS1wYWdpbmctcGFnZXInPjx0Ym9keT48dHI+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlzRnVuY3Rpb24oZS5wLm9uUGFnaW5nKSAmJiAoYyA9IGUucC5vblBhZ2luZy5jYWxsKGUsIGIsIGYpKSwgInN0b3AiID09PSBjID8gITEgOiAoZS5wLnNlbHJvdyA9IG51bGwsIGUucC5tdWx0aXNlbGVjdCAmJiAoZS5wLnNlbGFycnJvdyA9IFtdLCBEYSghMSkpLCBlLnAuc2F2ZWRSb3cgPSBbXSwgITApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gYi5zdWJzdHIoMSksIGYgKz0gIl8iICsgYiwgYyA9ICJwZ18iICsgYiwgaCA9IGIgKyAiX2xlZnQiLCBtID0gYiArICJfY2VudGVyIiwgZCA9IGIgKyAiX3JpZ2h0IiwgYSgiIyIgKyBhLmpncmlkLmpxSUQoYikpLmFwcGVuZCgiPGRpdiBpZD0nIiArIGMgKyAiJyBjbGFzcz0ndWktcGFnZXItY29udHJvbCcgcm9sZT0nZ3JvdXAnPjx0YWJsZSAiICsgeShLLCAicGFnZXJUYWJsZSIsICExLCAidWktcGctdGFibGUgdWktY29tbW9uLXRhYmxlIHVpLXBhZ2VyLXRhYmxlIikgKyAiPjx0Ym9keT48dHI+PHRkIGlkPSciICsgaCArICInIGFsaWduPSdsZWZ0Jz48L3RkPjx0ZCBpZD0nIiArIG0gKyAiJyBhbGlnbj0nY2VudGVyJyBzdHlsZT0nd2hpdGUtc3BhY2U6cHJlOyc+PC90ZD48dGQgaWQ9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICsgIicgYWxpZ249J3JpZ2h0Jz48L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPjwvZGl2PiIpLmF0dHIoImRpciIsICJsdHIiKSwgMCA8IGUucC5yb3dMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAnPHRkIGRpcj0iJyArIHEgKyAnIj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gKz0gIjxzZWxlY3QgIiArIHkoSywgInBnU2VsZWN0Qm94IiwgITEsICJ1aS1wZy1zZWxib3giKSArICcgcm9sZT0ibGlzdGJveCIgdGl0bGU9IicgKyAoYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZGVmYXVsdHMucGdyZWNzIiwgZS5wLnBncmVjcykgfHwgIiIpICsgJyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGggPSAwOyBoIDwgZS5wLnJvd0xpc3QubGVuZ3RoOyBoKyspIG0gPSBlLnAucm93TGlzdFtoXS50b1N0cmluZygpLnNwbGl0KCI6IiksIDEgPT09IG0ubGVuZ3RoICYmIChtWzFdID0gbVswXSksIG4gKz0gJzxvcHRpb24gcm9sZT0ib3B0aW9uIiB2YWx1ZT0iJyArIG1bMF0gKyAnIicgKyAoRyhlLnAucm93TnVtLCAwKSA9PT0gRyhtWzBdLCAwKSA/ICcgc2VsZWN0ZWQ9InNlbGVjdGVkIicgOiAiIikgKyAiPiIgKyBtWzFdICsgIjwvb3B0aW9uPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSAiPC9zZWxlY3Q+PC90ZD4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KCJydGwiID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgJiYgKHcgKz0gbiksICEwID09PSBlLnAucGdpbnB1dCAmJiAoZyA9ICI8dGQgaWQ9J2lucHV0IiArIGYgKyAiJyBkaXI9JyIgKyBxICsgIic+IiArIGEuamdyaWQudGVtcGxhdGUoYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZGVmYXVsdHMucGd0ZXh0IiwgZS5wLnBndGV4dCkgfHwgIiIsICI8aW5wdXQgY2xhc3M9J3VpLXBnLWlucHV0JyB0eXBlPSd0ZXh0JyBzaXplPScyJyBtYXhsZW5ndGg9JzcnIHZhbHVlPScwJyByb2xlPSd0ZXh0Ym94Jy8+IiwgIjxzcGFuIGlkPSdzcF8xXyIgKyBhLmpncmlkLmpxSUQoYikgKyAiJz48L3NwYW4+IikgKyAiPC90ZD4iKSwgITAgPT09IGUucC5wZ2J1dHRvbnMpID8gKGggPSBbImZpcnN0IiArIGYsICJwcmV2IiArIGYsICJuZXh0IiArIGYsICJsYXN0IiArIGZdLCBtID0geShLLCAicGdCdXR0b25Cb3giLCAhMCwgInVpLXBnLWJ1dHRvbiIpLCBkID0gW2EuamdyaWQuZ2V0UmVnaW9uYWwoZSwgImRlZmF1bHRzLnBnZmlyc3QiLCBlLnAucGdmaXJzdCkgfHwgIiIsIGEuamdyaWQuZ2V0UmVnaW9uYWwoZSwgImRlZmF1bHRzLnBncHJldiIsIGUucC5wZ3ByZXYpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiLCBhLmpncmlkLmdldFJlZ2lvbmFsKGUsICJkZWZhdWx0cy5wZ25leHQiLCBlLnAucGduZXh0KSB8fCAiIiwgYS5qZ3JpZC5nZXRSZWdpb25hbChlLCAiZGVmYXVsdHMucGdsYXN0IiwgZS5wLnBnbGFzdCkgfHwgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLCAicnRsIiA9PT0gcSAmJiAoaC5yZXZlcnNlKCksIGQucmV2ZXJzZSgpKSwgdyArPSAiPHRkIGlkPSciICsgaFswXSArICInIGNsYXNzPSciICsgbSArICInIHRpdGxlPSciICsgZFswXSArICInPjxzcGFuICIgKyB5KEssICJpY29uX2ZpcnN0IiwgITEsIHgpICsgIj48L3NwYW4+PC90ZD4iLCB3ICs9ICI8dGQgaWQ9JyIgKyBoWzFdICsgIicgY2xhc3M9JyIgKyBtICsgIicgIHRpdGxlPSciICsgZFsxXSArICInPjxzcGFuICIgKyB5KEssICJpY29uX3ByZXYiLCAhMSwgeCkgKyAiPjwvc3Bhbj48L3RkPiIsIHcgPSB3ICsgKCIiICE9PSBnID8gbCArIGcgKyBsIDogIiIpICsgKCI8dGQgaWQ9JyIgKyBoWzJdICsgIicgY2xhc3M9JyIgKyBtICsgIicgdGl0bGU9JyIgKyBkWzJdICsgIic+PHNwYW4gIiArIHkoSywgImljb25fbmV4dCIsICExLCB4KSArICI+PC9zcGFuPjwvdGQ+IiksIHcgKz0gIjx0ZCBpZD0nIiArIGhbM10gKyAiJyBjbGFzcz0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSArICInIHRpdGxlPSciICsgZFszXSArICInPjxzcGFuICIgKyB5KEssICJpY29uX2VuZCIsICExLCB4KSArICI+PC9zcGFuPjwvdGQ+IikgOiAiIiAhPT0gZyAmJiAodyArPSBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsdHIiID09PSBxICYmICh3ICs9IG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdyArPSAiPC90cj48L3Rib2R5PjwvdGFibGU+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBlLnAudmlld3JlY29yZHMgJiYgYSgidGQjIiArIGIgKyAiXyIgKyBlLnAucmVjb3JkcG9zLCAiIyIgKyBjKS5hcHBlbmQoIjxkaXYgZGlyPSciICsgcSArICInIHN0eWxlPSd0ZXh0LWFsaWduOiIgKyBlLnAucmVjb3JkcG9zICsgIicgY2xhc3M9J3VpLXBhZ2luZy1pbmZvJz48L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRkIyIgKyBiICsgIl8iICsgZS5wLnBhZ2VycG9zLCAiIyIgKyBjKS5hcHBlbmQodyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYSgiI2dib3hfIiArIGEuamdyaWQuanFJRChlLnAuaWQpKS5jc3MoImZvbnQtc2l6ZSIpIHx8ICIxMXB4IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSkuYXBwZW5kKCI8ZGl2IGlkPSd0ZXN0cGcnICIgKyB5KEssICJlbnRyaWVCb3giLCAhMSwgInVpLWpxZ3JpZCIpICsgIiBzdHlsZT0nZm9udC1zaXplOiIgKyBsICsgIjt2aXNpYmlsaXR5OmhpZGRlbjsnID48L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBhKHcpLmNsb25lKCkuYXBwZW5kVG8oIiN0ZXN0cGciKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI3Rlc3RwZyIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IHcgJiYgKCIiICE9PSBnICYmICh3ICs9IDUwKSwgYSgidGQjIiArIGIgKyAiXyIgKyBlLnAucGFnZXJwb3MsICIjIiArIGMpLndpZHRoKHcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5fbnZ0ZCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLl9udnRkWzBdID0gTWF0aC5mbG9vcih3ID8gKGUucC53aWR0aCAtIHcpIC8gMiA6IGUucC53aWR0aCAvIDMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLl9udnRkWzFdID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLnVpLXBnLXNlbGJveCIsICIjIiArIGMpLmJpbmQoImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByKCJyZWNvcmRzIiwgdGhpcykgPyAoZS5wLnBhZ2UgPSBNYXRoLnJvdW5kKGUucC5yb3dOdW0gKiAoZS5wLnBhZ2UgLSAxKSAvIHRoaXMudmFsdWUgLSAuNSkgKyAxLCBlLnAucm93TnVtID0gdGhpcy52YWx1ZSwgZS5wLnBhZ2VyICYmIGEoIi51aS1wZy1zZWxib3giLCBlLnAucGFnZXIpLnZhbCh0aGlzLnZhbHVlKSwgZS5wLnRvcHBhZ2VyICYmIGEoIi51aS1wZy1zZWxib3giLCBlLnAudG9wcGFnZXIpLnZhbCh0aGlzLnZhbHVlKSwgbmEoKSwgITEpIDogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGUucC5wZ2J1dHRvbnMgJiYgKGEoIi51aS1wZy1idXR0b24iLCAiIyIgKyBjKS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmhhc0NsYXNzKEMpID8gdGhpcy5zdHlsZS5jdXJzb3IgPSAiZGVmYXVsdCIgOiAoYSh0aGlzKS5hZGRDbGFzcyhBKSwgdGhpcy5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmhhc0NsYXNzKEMpIHx8IChhKHRoaXMpLnJlbW92ZUNsYXNzKEEpLCB0aGlzLnN0eWxlLmN1cnNvciA9ICJkZWZhdWx0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjZmlyc3QiICsgYS5qZ3JpZC5qcUlEKGYpICsgIiwgI3ByZXYiICsgYS5qZ3JpZC5qcUlEKGYpICsgIiwgI25leHQiICsgYS5qZ3JpZC5qcUlEKGYpICsgIiwgI2xhc3QiICsgYS5qZ3JpZC5qcUlEKGYpKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSh0aGlzKS5oYXNDbGFzcyhDKSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gRyhlLnAucGFnZSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBHKGUucC5sYXN0cGFnZSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwID09PSBjIHx8IDEgPT09IGMgPyAobSA9ICExLCBkID0gITEsIHcgPSAhMSwgbCA9ICExKSA6IDEgPCBjICYmIDEgPD0gYiA/IDEgPT09IGIgPyAobSA9ICExLCBkID0gITEpIDogYiA9PT0gYyAmJiAodyA9ICExLCBsID0gITEpIDogMSA8IGMgJiYgMCA9PT0gYiAmJiAodyA9ICExLCBsID0gITEsIGIgPSBjIC0gMSksIHIodGhpcy5pZC5zcGxpdCgiXyIpWzBdLCB0aGlzKSA/ICh0aGlzLmlkID09PSAiZmlyc3QiICsgZiAmJiBtICYmIChlLnAucGFnZSA9IDEsIGggPSAhMCksIHRoaXMuaWQgPT09ICJwcmV2IiArIGYgJiYgZCAmJiAoZS5wLnBhZ2UgPSBiIC0gMSwgaCA9ICEwKSwgdGhpcy5pZCA9PT0gIm5leHQiICsgZiAmJiB3ICYmIChlLnAucGFnZSA9IGIgKyAxLCBoID0gITApLCB0aGlzLmlkID09PSAibGFzdCIgKyBmICYmIGwgJiYgKGUucC5wYWdlID0gYywgaCA9ICEwKSwgaCAmJiBuYSgpLCAhMSkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGUucC5wZ2lucHV0ICYmIGEoIiMiICsgYykub24oImtleXByZXNzIiwgImlucHV0LnVpLXBnLWlucHV0IiwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxMyA9PT0gKGIuY2hhckNvZGUgfHwgYi5rZXlDb2RlIHx8IDApID8gcigidXNlciIsIHRoaXMpID8gKGEodGhpcykudmFsKEcoYSh0aGlzKS52YWwoKSwgMSkpLCBlLnAucGFnZSA9IDAgPCBhKHRoaXMpLnZhbCgpID8gYSh0aGlzKS52YWwoKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5wYWdlLCBuYSgpLCAhMSkgOiAhMSA6IHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBaID0gZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBoID0gZS5wLmNvbE1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gZS5wLmZyb3plbkNvbHVtbnMgPyBmIDogZS5ncmlkLmhlYWRlcnNbYl0uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJzcGFuLnVpLWdyaWQtaWNvLXNvcnQiLCBtKS5hZGRDbGFzcyhDKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKG0pLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAiZmFsc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gaFtiXS5pbmRleCB8fCBoW2JdLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaFtiXS5sc28gPyAiYXNjIiA9PT0gaFtiXS5sc28gPyAoaFtiXS5sc28gKz0gIi1kZXNjIiwgZCA9ICJkZXNjIikgOiAiZGVzYyIgPT09IGhbYl0ubHNvID8gKGhbYl0ubHNvICs9ICItYXNjIiwgZCA9ICJhc2MiKSA6ICgiYXNjLWRlc2MiID09PSBoW2JdLmxzbyB8fCAiZGVzYy1hc2MiID09PSBoW2JdLmxzbykgJiYgKGhbYl0ubHNvID0gIiIpIDogaFtiXS5sc28gPSBkID0gaFtiXS5maXJzdHNvcnRvcmRlciB8fCAiYXNjIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID8gKGEoInNwYW4ucy1pY28iLCBtKS5zaG93KCksIGEoInNwYW4udWktaWNvbi0iICsgZCwgbSkucmVtb3ZlQ2xhc3MoQyksIGEobSkuYXR0cigiYXJpYS1zZWxlY3RlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cnVlIikpIDogZS5wLnZpZXdzb3J0Y29sc1swXSB8fCBhKCJzcGFuLnMtaWNvIiwgbSkuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBILmluZGV4T2YoYyk7IC0gMSA9PT0gaCA/IChILnB1c2goYyksIEUucHVzaChkKSkgOiBkID8gRVtoXSA9IGQgOiAoRS5zcGxpY2UoaCwgMSksIEguc3BsaWNlKGgsIDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuc29ydG9yZGVyID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnNvcnRuYW1lID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gSC5sZW5ndGg7IGQgPiBjOyBjKyspIDAgPCBjICYmIChlLnAuc29ydG5hbWUgKz0gIiwgIiksIGUucC5zb3J0bmFtZSArPSBIW2NdLCBjICE9PSBkIC0gMSAmJiAoZS5wLnNvcnRuYW1lICs9ICIgIiArIEVbY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5zb3J0b3JkZXIgPSBFW2QgLSAxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFUgPSBmdW5jdGlvbihiLCBmLCBjLCBoLCBtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucC5jb2xNb2RlbFtmXS5zb3J0YWJsZSAmJiAhKDAgPCBlLnAuc2F2ZWRSb3cubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyB8fCAoZS5wLmxhc3Rzb3J0ID09PSBmICYmICIiICE9PSBlLnAuc29ydG5hbWUgPyAiYXNjIiA9PT0gZS5wLnNvcnRvcmRlciA/IGUucC5zb3J0b3JkZXIgPSAiZGVzYyIgOiAiZGVzYyIgPT09IGUucC5zb3J0b3JkZXIgJiYgKGUucC5zb3J0b3JkZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhc2MiKSA6IGUucC5zb3J0b3JkZXIgPSBlLnAuY29sTW9kZWxbZl0uZmlyc3Rzb3J0b3JkZXIgfHwgImFzYyIsIGUucC5wYWdlID0gMSksIGUucC5tdWx0aVNvcnQpIFooZiwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLmxhc3Rzb3J0ID09PSBmICYmIGUucC5zb3J0b3JkZXIgPT09IGggJiYgIWMpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuc29ydG9yZGVyID0gaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGUuZ3JpZC5oZWFkZXJzW2UucC5sYXN0c29ydF0gPyBlLmdyaWQuaGVhZGVyc1tlLnAubGFzdHNvcnRdLmVsIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBlLnAuZnJvemVuQ29sdW1ucyA/IG0gOiBlLmdyaWQuaGVhZGVyc1tmXS5lbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gInNpbmdsZSIgPT09IGUucC52aWV3c29ydGNvbHNbMV0gPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEoYykuZmluZCgic3Bhbi51aS1ncmlkLWljby1zb3J0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmFkZENsYXNzKEMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiBhKG0pLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGMpLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAiZmFsc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5mcm96ZW5Db2x1bW5zICYmIChtID0gZS5ncmlkLmZoRGl2LmZpbmQoInNwYW4udWktZ3JpZC1pY28tc29ydCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYWRkQ2xhc3MoQyksIGQgJiYgbS5jc3MoImRpc3BsYXkiLCAibm9uZSIpLCBlLmdyaWQuZmhEaXYuZmluZCgidGgiKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEoaCkuZmluZCgic3Bhbi51aS1pY29uLSIgKyBlLnAuc29ydG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ucmVtb3ZlQ2xhc3MoQyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICYmIG0uY3NzKCJkaXNwbGF5IiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShoKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC52aWV3c29ydGNvbHNbMF0gfHwgKGUucC5sYXN0c29ydCAhPT0gZiA/IChlLnAuZnJvemVuQ29sdW1ucyAmJiBlLmdyaWQuZmhEaXYuZmluZCgic3Bhbi5zLWljbyIpLmhpZGUoKSwgYSgic3Bhbi5zLWljbyIsIGMpLmhpZGUoKSwgYSgic3Bhbi5zLWljbyIsIGgpLnNob3coKSkgOiAiIiA9PT0gZS5wLnNvcnRuYW1lICYmIGEoInNwYW4ucy1pY28iLCBoKS5zaG93KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGIuc3Vic3RyaW5nKDUgKyBlLnAuaWQubGVuZ3RoICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuc29ydG5hbWUgPSBlLnAuY29sTW9kZWxbZl0uaW5kZXggfHwgYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RvcCIgPT09IGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZFNvcnRDb2wiLCBbZS5wLnNvcnRuYW1lLCBmLCBlLnAuc29ydG9yZGVyXSkgfHwgYS5pc0Z1bmN0aW9uKGUucC5vblNvcnRDb2wpICYmICJzdG9wIiA9PT0gZS5wLm9uU29ydENvbC5jYWxsKGUsIGUucC5zb3J0bmFtZSwgZiwgZS5wLnNvcnRvcmRlcikpIHJldHVybiB2b2lkKGUucC5sYXN0c29ydCA9IGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImxvY2FsIiA9PT0gZS5wLmRhdGF0eXBlID8gZS5wLmRlc2VsZWN0QWZ0ZXJTb3J0ICYmIGEoZSkuanFHcmlkKCJyZXNldFNlbGVjdGlvbiIpIDogKGUucC5zZWxyb3cgPSBudWxsLCBlLnAubXVsdGlzZWxlY3QgJiYgRGEoITEpLCBlLnAuc2VsYXJycm93ID0gW10sIGUucC5zYXZlZFJvdyA9IFtdKSwgZS5wLnNjcm9sbCkgYyA9IGUuZ3JpZC5iRGl2LnNjcm9sbExlZnQsIFkuY2FsbChlLCAhMCwgITEpLCBlLmdyaWQuaERpdi5zY3JvbGxMZWZ0ID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnN1YkdyaWQgJiYgImxvY2FsIiA9PT0gZS5wLmRhdGF0eXBlICYmIGEoInRkLnNnZXhwYW5kZWQiLCAiIyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykudHJpZ2dlcigiY2xpY2siKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLl9zb3J0ID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5sYXN0c29ydCA9IGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5zb3J0bmFtZSAhPT0gYiAmJiBmICYmIChlLnAubGFzdHNvcnQgPSBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLYSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYShlLmdyaWQuaGVhZGVyc1tiXS5lbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IFtiLnBvc2l0aW9uKCkubGVmdCArIGIub3V0ZXJXaWR0aCgpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gInJ0bCIgPT09IGUucC5kaXJlY3Rpb24gJiYgKGJbMF0gPSBlLnAud2lkdGggLSBiWzBdKSwgYlswXSAtPSBlLmdyaWQuYkRpdi5zY3JvbGxMZWZ0LCBiLnB1c2goYShlLmdyaWQuaERpdikucG9zaXRpb24oKS50b3ApLCBiLnB1c2goYShlLmdyaWQuYkRpdikub2Zmc2V0KCkudG9wIC0gYShlLmdyaWQuaERpdikub2Zmc2V0KCkudG9wICsgYShlLmdyaWQuYkRpdikuaGVpZ2h0KCkpLCBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGEgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGMgPSBlLmdyaWQuaGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEuamdyaWQuZ2V0Q2VsbEluZGV4KGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBjLmxlbmd0aDsgZisrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PT0gY1tmXS5lbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5pZCA9IHRoaXMuaWQ7IC0gMSA9PT0gYS5pbkFycmF5KGUucC5tdWx0aWtleSwgWyJzaGlmdEtleSIsICJhbHRLZXkiLCAiY3RybEtleSJdKSAmJiAoZS5wLm11bHRpa2V5ID0gITEpOwogICAgICAgICAgICAgICAgICAgICAgICBlLnAua2V5TmFtZSA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSAwOyB1IDwgZS5wLmNvbE1vZGVsLmxlbmd0aDsgdSsrKSBKID0gInN0cmluZyIgPT0gdHlwZW9mIGUucC5jb2xNb2RlbFt1XS50ZW1wbGF0ZSA/IG51bGwgIT0gYS5qZ3JpZC5jbVRlbXBsYXRlICYmICJvYmplY3QiID09IHR5cGVvZiBhLmpncmlkLmNtVGVtcGxhdGVbZS5wLmNvbE1vZGVsW3VdLnRlbXBsYXRlXSA/IGEuamdyaWQuY21UZW1wbGF0ZVtlLnAuY29sTW9kZWxbdV0udGVtcGxhdGVdIDoge30gOiBlLnAuY29sTW9kZWxbdV0udGVtcGxhdGUsIGUucC5jb2xNb2RlbFt1XSA9IGEuZXh0ZW5kKCEwLCB7fSwgZS5wLmNtVGVtcGxhdGUsIEogfHwge30sIGUucC5jb2xNb2RlbFt1XSksICExID09PSBlLnAua2V5TmFtZSAmJiAhMCA9PT0gZS5wLmNvbE1vZGVsW3VdLmtleSAmJiAoZS5wLmtleU5hbWUgPSBlLnAuY29sTW9kZWxbdV0ubmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnAuc29ydG9yZGVyID0gZS5wLnNvcnRvcmRlci50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5jZWxsX3dpZHRoID0gYS5qZ3JpZC5jZWxsV2lkdGgoKSwgITAgPT09IGUucC5ncm91cGluZyAmJiAoZS5wLnNjcm9sbCA9ICExLCBlLnAucm93bnVtYmVycyA9ICExLCBlLnAudHJlZUdyaWQgPSAhMSwgZS5wLmdyaWR2aWV3ID0gITApLCAhMCA9PT0gdGhpcy5wLnRyZWVHcmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuanFHcmlkKCJzZXRUcmVlR3JpZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjYSkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhbCIgIT09IGUucC5kYXRhdHlwZSAmJiAoZS5wLmxvY2FsUmVhZGVyID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiX2lkXyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5zdWJHcmlkKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShlKS5qcUdyaWQoInNldFN1YkdyaWQiKQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjYSkge30KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLm11bHRpc2VsZWN0ICYmICh0aGlzLnAuY29sTmFtZXMudW5zaGlmdCgiPGlucHV0IHJvbGU9J2NoZWNrYm94JyBpZD0nY2JfIiArIHRoaXMucC5pZCArICInIGNsYXNzPSdjYm94JyB0eXBlPSdjaGVja2JveCcvPiIpLCB0aGlzLnAuY29sTW9kZWwudW5zaGlmdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiY2IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGEuamdyaWQuY2VsbF93aWR0aCA/IGUucC5tdWx0aXNlbGVjdFdpZHRoICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuY2VsbExheW91dCA6IGUucC5tdWx0aXNlbGVjdFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXphYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVkbGc6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb3plbjogITAKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAucm93bnVtYmVycyAmJiAodGhpcy5wLmNvbE5hbWVzLnVuc2hpZnQoIiIpLCB0aGlzLnAuY29sTW9kZWwudW5zaGlmdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAicm4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGUucC5yb3dudW1XaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRlZGxnOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlnbjogImNlbnRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXhlZDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm96ZW46ICEwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnhtbFJlYWRlciA9IGEuZXh0ZW5kKCEwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290OiAicm93cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6ICJyb3ciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogInJvd3M+cGFnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogInJvd3M+dG90YWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkczogInJvd3M+cmVjb3JkcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRpdGVtczogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogIltpZF0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRhdGE6ICJ1c2VyZGF0YSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJncmlkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdDogInJvd3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogInJvdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0aXRlbXM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGw6ICJjZWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBlLnAueG1sUmVhZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmpzb25SZWFkZXIgPSBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdDogInJvd3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogInBhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6ICJ0b3RhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzOiAicmVjb3JkcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRpdGVtczogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJkYXRhOiAidXNlcmRhdGEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViZ3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3Q6ICJyb3dzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRpdGVtczogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbDogImNlbGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGUucC5qc29uUmVhZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmxvY2FsUmVhZGVyID0gYS5leHRlbmQoITAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3Q6ICJyb3dzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6ICJwYWdlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiAidG90YWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkczogInJlY29yZHMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0aXRlbXM6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbDogImNlbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyZGF0YTogInVzZXJkYXRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmdyaWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290OiAicm93cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0aXRlbXM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGw6ICJjZWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBlLnAubG9jYWxSZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBlLnAuc2Nyb2xsICYmIChlLnAucGdidXR0b25zID0gITEsIGUucC5wZ2lucHV0ID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAucm93TGlzdCA9IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmRhdGEubGVuZ3RoICYmICh0KCksIGVhKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmEsIGxhLCBKYSwgaGEsIGphLCBiYSwgWDsKICAgICAgICAgICAgICAgICAgICAgICAgSiA9ICI8dGhlYWQ+PHRyIGNsYXNzPSd1aS1qcWdyaWQtbGFiZWxzJyByb2xlPSdyb3cnPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3YSA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGEgPSBsYSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGUucC5zaHJpbmtUb0ZpdCAmJiAhMCA9PT0gZS5wLmZvcmNlRml0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1ID0gZS5wLmNvbE1vZGVsLmxlbmd0aCAtIDE7IDAgPD0gdTsgdS0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZS5wLmNvbE1vZGVsW3VdLmhpZGRlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuY29sTW9kZWxbdV0ucmVzaXphYmxlID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoImhvcml6b250YWwiID09PSBlLnAudmlld3NvcnRjb2xzWzFdID8gKGxhID0gIiB1aS1pLWFzYyIsIExhID0gIiB1aS1pLWRlc2MiKSA6ICJzaW5nbGUiID09PSBlLnAudmlld3NvcnRjb2xzWzFdICYmIChsYSA9ICIgdWktc2luZ2xlLXNvcnQtYXNjIiwgTGEgPSAiIHVpLXNpbmdsZS1zb3J0LWRlc2MiLCB3YSA9ICIgc3R5bGU9J2Rpc3BsYXk6bm9uZSciLCBlLnAudmlld3NvcnRjb2xzWzBdID0gITEpLCByYSA9IGMgPyAiY2xhc3M9J3VpLXRoLWRpdi1pZSciIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiLCBYID0gIjxzcGFuIGNsYXNzPSdzLWljbycgc3R5bGU9J2Rpc3BsYXk6bm9uZSc+IiwgWCArPSAiPHNwYW4gc29ydD0nYXNjJyAgY2xhc3M9J3VpLWdyaWQtaWNvLXNvcnQgdWktaWNvbi1hc2MiICsgbGEgKyAiIHVpLXNvcnQtIiArIHEgKyAiICIgKyBDICsgIiAiICsgeCArICIgIiArIHkoSywgImljb25fYXNjIiwgITApICsgIiciICsgd2EgKyAiPjwvc3Bhbj4iLCBYICs9ICI8c3BhbiBzb3J0PSdkZXNjJyBjbGFzcz0ndWktZ3JpZC1pY28tc29ydCB1aS1pY29uLWRlc2MiICsgTGEgKyAiIHVpLXNvcnQtIiArIHEgKyAiICIgKyBDICsgIiAiICsgeCArICIgIiArIHkoSywgImljb25fZGVzYyIsICEwKSArICInIiArIHdhICsgIj48L3NwYW4+PC9zcGFuPiIsIGUucC5tdWx0aVNvcnQgJiYgZS5wLnNvcnRuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChIID0gZS5wLnNvcnRuYW1lLnNwbGl0KCIsIiksIHUgPSAwOyB1IDwgSC5sZW5ndGg7IHUrKykgdiA9IGEudHJpbShIW3VdKS5zcGxpdCgiICIpLCBIW3VdID0gYS50cmltKHZbMF0pLCBFW3VdID0gdlsxXSA/IGEudHJpbSh2WzFdKSA6IGUucC5zb3J0b3JkZXIgfHwgImFzYyI7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodSA9IDA7IHUgPCB0aGlzLnAuY29sTmFtZXMubGVuZ3RoOyB1KyspIGxhID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5oZWFkZXJ0aXRsZXMgPyAnIHRpdGxlPSInICsgYS5qZ3JpZC5zdHJpcEh0bWwoZS5wLmNvbE5hbWVzW3VdKSArICciJyA6ICIiLCBKICs9ICI8dGggaWQ9JyIgKyBlLnAuaWQgKyAiXyIgKyBlLnAuY29sTW9kZWxbdV0ubmFtZSArICInIHJvbGU9J2NvbHVtbmhlYWRlcicgIiArIHkoSywgImhlYWRlckJveCIsICExLCAidWktdGgtY29sdW1uIHVpLXRoLSIgKyBxKSArICIgIiArIGxhICsgIj4iLCBsYSA9IGUucC5jb2xNb2RlbFt1XS5pbmRleCB8fCBlLnAuY29sTW9kZWxbdV0ubmFtZSwgSiArPSAiPGRpdiBpZD0nanFnaF8iICsgZS5wLmlkICsgIl8iICsgZS5wLmNvbE1vZGVsW3VdLm5hbWUgKyAiJyAiICsgcmEgKyAiPiIgKyBlLnAuY29sTmFtZXNbdV0sIGUucC5jb2xNb2RlbFt1XS53aWR0aCA9IGUucC5jb2xNb2RlbFt1XS53aWR0aCA/IHBhcnNlSW50KGUucC5jb2xNb2RlbFt1XS53aWR0aCwgMTApIDogMTUwLCAiYm9vbGVhbiIgIT0gdHlwZW9mIGUucC5jb2xNb2RlbFt1XS50aXRsZSAmJiAoZS5wLmNvbE1vZGVsW3VdLnRpdGxlID0gITApLCBlLnAuY29sTW9kZWxbdV0ubHNvID0gIiIsIGxhID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnNvcnRuYW1lICYmIChlLnAubGFzdHNvcnQgPSB1KSwgZS5wLm11bHRpU29ydCAmJiAodiA9IGEuaW5BcnJheShsYSwgSCksIC0xICE9PSB2ICYmIChlLnAuY29sTW9kZWxbdV0ubHNvID0gRVt2XSkpLCBKICs9IFggKyAiPC9kaXY+PC90aD4iOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoSiArPSAiPC90cj48L3RoZWFkPiIsIFggPSBudWxsLCBhKHRoaXMpLmFwcGVuZChKKSwgYSgidGhlYWQgdHI6Zmlyc3QgdGgiLCB0aGlzKS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKEEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnJlbW92ZUNsYXNzKEEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5wLm11bHRpc2VsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQmEsIGZhID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjY2JfIiArIGEuamdyaWQuanFJRChlLnAuaWQpLCB0aGlzKS5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5zZWxhcnJyb3cgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9ICEwID09PSBlLnAuZnJvemVuQ29sdW1ucyA/IGUucC5pZCArICJfZnJvemVuIiA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZCA/IChhKGUucm93cykuZWFjaChmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPCBmICYmIChhKHRoaXMpLmhhc0NsYXNzKCJ1aS1zdWJncmlkIikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuaGFzQ2xhc3MoImpxZ3JvdXAiKSB8fCBhKHRoaXMpLmhhc0NsYXNzKEMpIHx8IGEodGhpcykuaGFzQ2xhc3MoImpxZm9vdCIpIHx8IChhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRCh0aGlzLmlkKSlbZS5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITApLCBhKHRoaXMpLmFkZENsYXNzKHApLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAidHJ1ZSIpLCBlLnAuc2VsYXJycm93LnB1c2godGhpcy5pZCksIGUucC5zZWxyb3cgPSB0aGlzLmlkLCBiICYmIChhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRCh0aGlzLmlkKSwgZS5ncmlkLmZiRGl2KVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMCksIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpLCBlLmdyaWQuZmJEaXYpLmFkZENsYXNzKHApKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIEJhID0gITAsIGZhID0gW10pIDogKGEoZS5yb3dzKS5lYWNoKGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IGYgJiYgKGEodGhpcykuaGFzQ2xhc3MoInVpLXN1YmdyaWQiKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5oYXNDbGFzcygianFncm91cCIpIHx8IGEodGhpcykuaGFzQ2xhc3MoQykgfHwgYSh0aGlzKS5oYXNDbGFzcygianFmb290IikgfHwgKGEoIiNqcWdfIiArIGEuamdyaWQuanFJRChlLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpKVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSksIGEodGhpcykucmVtb3ZlQ2xhc3MocCkuYXR0cigiYXJpYS1zZWxlY3RlZCIsICJmYWxzZSIpLCBmYS5wdXNoKHRoaXMuaWQpLCBiICYmIChhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRCh0aGlzLmlkKSwgZS5ncmlkLmZiRGl2KVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSksIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpLCBlLmdyaWQuZmJEaXYpLnJlbW92ZUNsYXNzKHApKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGUucC5zZWxyb3cgPSBudWxsLCBCYSA9ICExKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRTZWxlY3RBbGwiLCBbQmEgPyBlLnAuc2VsYXJycm93IDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmEsIEJhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGUucC5vblNlbGVjdEFsbCkgJiYgZS5wLm9uU2VsZWN0QWxsLmNhbGwoZSwgQmEgPyBlLnAuc2VsYXJycm93IDogZmEsIEJhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfSEwID09PSBlLnAuYXV0b3dpZHRoICYmIChYID0gYShMKS5pbm5lcldpZHRoKCksIGUucC53aWR0aCA9IDAgPCBYID8gWCA6ICJudyIpOwogICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZiwgYywgaCwgZCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IGEuamdyaWQuY2VsbF93aWR0aCA/IDAgOiBHKGUucC5jZWxsTGF5b3V0LCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gRyhlLnAuc2Nyb2xsT2Zmc2V0LCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goZS5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSB0aGlzLmhpZGRlbiAmJiAodGhpcy5oaWRkZW4gPSAhMSksIGUucC5ncm91cGluZyAmJiBlLnAuYXV0b3dpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5pbkFycmF5KHRoaXMubmFtZSwgZS5wLmdyb3VwaW5nVmlldy5ncm91cEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8PSBiICYmIGUucC5ncm91cGluZ1ZpZXcuZ3JvdXBDb2x1bW5TaG93Lmxlbmd0aCA+IGIgJiYgKHRoaXMuaGlkZGVuID0gIWUucC5ncm91cGluZ1ZpZXcuZ3JvdXBDb2x1bW5TaG93W2JdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoT3JnID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IEcodGhpcy53aWR0aCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgPT09IHRoaXMuaGlkZGVuICYmIChkICs9IGYgKyB3LCB0aGlzLmZpeGVkID8gciArPSBmICsgdyA6IGwrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNOYU4oZS5wLndpZHRoKSAmJiAoZS5wLndpZHRoID0gZCArICghMSAhPT0gZS5wLnNocmlua1RvRml0IHx8IGlzTmFOKGUucC5oZWlnaHQpID8gMCA6IGcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ud2lkdGggPSBlLnAud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAudGJsd2lkdGggPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgPT09IGUucC5zaHJpbmtUb0ZpdCAmJiAhMCA9PT0gZS5wLmZvcmNlRml0ICYmIChlLnAuZm9yY2VGaXQgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gZS5wLnNocmlua1RvRml0ICYmIDAgPCBsICYmIChjID0gbS53aWR0aCAtIHcgKiBsIC0gciwgaXNOYU4oZS5wLmhlaWdodCkgfHwgKGMgLT0gZywgcSA9ICEwKSwgZCA9IDAsIGEuZWFjaChlLnAuY29sTW9kZWwsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSAhPT0gdGhpcy5oaWRkZW4gfHwgdGhpcy5maXhlZCB8fCAoZiA9IE1hdGgucm91bmQoYyAqIHRoaXMud2lkdGggLyAoZS5wLnRibHdpZHRoIC0gdyAqIGwgLSByKSksIHRoaXMud2lkdGggPSBmLCBkICs9IGYsIGIgPSBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGggPSAwLCBxID8gbS53aWR0aCAtIHIgLSAoZCArIHcgKiBsKSAhPT0gZyAmJiAoaCA9IG0ud2lkdGggLSByIC0gKGQgKyB3ICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsKSAtIGcpIDogcSB8fCAxID09PSBNYXRoLmFicyhtLndpZHRoIC0gciAtIChkICsgdyAqIGwpKSB8fCAoaCA9IG0ud2lkdGggLSByIC0gKGQgKyB3ICogbCkpLCBlLnAuY29sTW9kZWxbYl0ud2lkdGggKz0gaCwgZS5wLnRibHdpZHRoID0gZCArIGggKyB3ICogbCArIHIsIGUucC50Ymx3aWR0aCA+IGUucC53aWR0aCAmJiAoZS5wLmNvbE1vZGVsW2JdLndpZHRoIC09IGUucC50Ymx3aWR0aCAtIHBhcnNlSW50KGUucC53aWR0aCwgMTApLCBlLnAudGJsd2lkdGggPSBlLnAud2lkdGgpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAgICAgICAgICAgICBhKEwpLmNzcygid2lkdGgiLCBtLndpZHRoICsgInB4IikuYXBwZW5kKCI8ZGl2IGNsYXNzPSd1aS1qcWdyaWQtcmVzaXplLW1hcmsnIGlkPSdyc19tIiArIGUucC5pZCArICInPiYjMTYwOzwvZGl2PiIpOwogICAgICAgICAgICAgICAgICAgICAgICBlLnAuc2Nyb2xsUG9wVXAgJiYgYShMKS5hcHBlbmQoIjxkaXYgIiArIHkoSywgInNjcm9sbEJveCIsICExLCAibG9hZGluZyB1aS1zY3JvbGwtcG9wdXAiKSArICIgaWQ9J3Njcm9sbF9nIiArIGUucC5pZCArICInPjwvZGl2PiIpOwogICAgICAgICAgICAgICAgICAgICAgICBhKGspLmNzcygid2lkdGgiLCBtLndpZHRoICsgInB4Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIEogPSBhKCJ0aGVhZDpmaXJzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKS5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6YSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBlLnAuZm9vdGVycm93ICYmICh6YSArPSAiPHRhYmxlIHJvbGU9J3ByZXNlbnRhdGlvbicgc3R5bGU9J3dpZHRoOiIgKyBlLnAudGJsd2lkdGggKyAicHgnICIgKyB5KEssICJmb290ZXJUYWJsZSIsICExLCAidWktanFncmlkLWZ0YWJsZSB1aS1jb21tb24tdGFibGUiKSArICI+PHRib2R5Pjx0ciByb2xlPSdyb3cnICIgKyB5KEssICJmb290ZXJCb3giLCAhMSwgImZvb3Ryb3cgZm9vdHJvdy0iICsgcSkgKyAiPiIpOwogICAgICAgICAgICAgICAgICAgICAgICBYID0gYSgidHI6Zmlyc3QiLCBKKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFhID0gIjx0ciBjbGFzcz0nanFnZmlyc3Ryb3cnIHJvbGU9J3Jvdyc+IjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucC5kaXNhYmxlQ2xpY2sgPSAhMSwgYSgidGgiLCBYKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKYSA9IGUucC5jb2xNb2RlbFtiXS53aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGUucC5jb2xNb2RlbFtiXS5yZXNpemFibGUgJiYgKGUucC5jb2xNb2RlbFtiXS5yZXNpemFibGUgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLmNvbE1vZGVsW2JdLnJlc2l6YWJsZSA/IChoYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSwgYShoYSkuaHRtbCgiJiMxNjA7IikuYWRkQ2xhc3MoInVpLWpxZ3JpZC1yZXNpemUgdWktanFncmlkLXJlc2l6ZS0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSkuY3NzKCJjdXJzb3IiLCAiY29sLXJlc2l6ZSIpLCBhKHRoaXMpLmFkZENsYXNzKGUucC5yZXNpemVjbGFzcykpIDogaGEgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmNzcygid2lkdGgiLCBKYSArICJweCIpLnByZXBlbmQoaGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5jb2xNb2RlbFtiXS5oaWRkZW4gJiYgKGEodGhpcykuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKSwgZiA9ICJkaXNwbGF5Om5vbmU7Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWEgKz0gIjx0ZCByb2xlPSdncmlkY2VsbCcgc3R5bGU9J2hlaWdodDowcHg7d2lkdGg6IiArIEphICsgInB4OyIgKyBmICsgIic+PC90ZD4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uaGVhZGVyc1tiXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IEphLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2EgPSBlLnAuY29sTW9kZWxbYl0uc29ydGFibGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImJvb2xlYW4iICE9IHR5cGVvZiB3YSAmJiAoZS5wLmNvbE1vZGVsW2JdLnNvcnRhYmxlID0gITAsIHdhID0gITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBlLnAuY29sTW9kZWxbYl0ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2IiICE9PSBmICYmICJzdWJncmlkIiAhPT0gZiAmJiAicm4iICE9PSBmICYmIGUucC52aWV3c29ydGNvbHNbMl0gJiYgYSgiPmRpdiIsIHRoaXMpLmFkZENsYXNzKCJ1aS1qcWdyaWQtc29ydGFibGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YSAmJiAoZS5wLm11bHRpU29ydCA/IGUucC52aWV3c29ydGNvbHNbMF0gPyAoYSgiZGl2IHNwYW4ucy1pY28iLCB0aGlzKS5zaG93KCksIGUucC5jb2xNb2RlbFtiXS5sc28gJiYgYSgiZGl2IHNwYW4udWktaWNvbi0iICsgZS5wLmNvbE1vZGVsW2JdLmxzbywgdGhpcykucmVtb3ZlQ2xhc3MoQykuY3NzKCJkaXNwbGF5IiwgIiIpKSA6IGUucC5jb2xNb2RlbFtiXS5sc28gJiYgKGEoImRpdiBzcGFuLnMtaWNvIiwgdGhpcykuc2hvdygpLCBhKCJkaXYgc3Bhbi51aS1pY29uLSIgKyBlLnAuY29sTW9kZWxbYl0ubHNvLCB0aGlzKS5yZW1vdmVDbGFzcyhDKS5jc3MoImRpc3BsYXkiLCAiIikpIDogZS5wLnZpZXdzb3J0Y29sc1swXSA/IChhKCJkaXYgc3Bhbi5zLWljbyIsIHRoaXMpLnNob3coKSwgYiA9PT0gZS5wLmxhc3Rzb3J0ICYmIGEoImRpdiBzcGFuLnVpLWljb24tIiArIGUucC5zb3J0b3JkZXIsIHRoaXMpLnJlbW92ZUNsYXNzKEMpLmNzcygiZGlzcGxheSIsICIiKSkgOiBiID09PSBlLnAubGFzdHNvcnQgJiYgIiIgIT09IGUucC5zb3J0bmFtZSAmJiAoYSgiZGl2IHNwYW4ucy1pY28iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzKS5zaG93KCksIGEoImRpdiBzcGFuLnVpLWljb24tIiArIGUucC5zb3J0b3JkZXIsIHRoaXMpLnJlbW92ZUNsYXNzKEMpLmNzcygiZGlzcGxheSIsICIiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5mb290ZXJyb3cgJiYgKHphICs9ICI8dGQgcm9sZT0nZ3JpZGNlbGwnICIgKyBRKGIsIDAsICIiLCBudWxsLCAiIiwgITEpICsgIj4mIzE2MDs8L3RkPiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5tb3VzZWRvd24oZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBhKGIudGFyZ2V0KS5jbG9zZXN0KCJ0aD5zcGFuLnVpLWpxZ3JpZC1yZXNpemUiKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0YSh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBlLnAuZm9yY2VGaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gZS5wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgsIGQgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gZiArIDE7IGggPCBlLnAuY29sTW9kZWwubGVuZ3RoOyBoKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwICE9PSBlLnAuY29sTW9kZWxbaF0uaGlkZGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMubnYgPSBkIC0gZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmRyYWdTdGFydChmLCBiLCBLYShmKSksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xpY2soZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnAuZGlzYWJsZUNsaWNrKSByZXR1cm4gZS5wLmRpc2FibGVDbGljayA9ICExLCAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgYywgaCA9ICJ0aD5kaXYudWktanFncmlkLXNvcnRhYmxlIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAudmlld3NvcnRjb2xzWzJdIHx8IChoID0gInRoPmRpdj5zcGFuPnNwYW4udWktZ3JpZC1pY28tc29ydCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhKGIudGFyZ2V0KS5jbG9zZXN0KGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBiLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucC5mcm96ZW5Db2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcylbMF0uaWQuc3Vic3RyaW5nKGUucC5pZC5sZW5ndGggKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZS5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSBkID8gKG0gPSBhLCAhMSkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBtID0gdGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLnAudmlld3NvcnRjb2xzWzJdIHx8IChmID0gITAsIGMgPSBiLmF0dHIoInNvcnQiKSksIG51bGwgIT0gbSAmJiBVKGEoImRpdiIsIHRoaXMpWzBdLmlkLCBtLCBmLCBjLCB0aGlzKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZS5wLnNvcnRhYmxlICYmIGEuZm4uc29ydGFibGUpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLmpxR3JpZCgic29ydGFibGVDb2x1bW5zIiwgWCkKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoY2EpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGUucC5mb290ZXJyb3cgJiYgKHphICs9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC90cj48L3Rib2R5PjwvdGFibGU+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGFhICs9ICI8L3RyPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZENoaWxkKFgpOwogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKHkoSywgInJvd1RhYmxlIiwgITAsICJ1aS1qcWdyaWQtYnRhYmxlIHVpLWNvbW1vbi10YWJsZSIpKS5hcHBlbmQoYWEpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWEgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEoIjx0YWJsZSAiICsgeShLLCAiaGVhZGVyVGFibGUiLCAhMSwgInVpLWpxZ3JpZC1odGFibGUgdWktY29tbW9uLXRhYmxlIikgKyAiIHN0eWxlPSd3aWR0aDoiICsgZS5wLnRibHdpZHRoICsgInB4JyByb2xlPSdwcmVzZW50YXRpb24nIGFyaWEtbGFiZWxsZWRieT0nZ2JveF8iICsgdGhpcy5pZCArICInPjwvdGFibGU+IikuYXBwZW5kKEopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGEgPSBlLnAuY2FwdGlvbiAmJiAhMCA9PT0gZS5wLmhpZGRlbmdyaWQgPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICBYID0gYSgiPGRpdiBjbGFzcz0ndWktanFncmlkLWhib3giICsgKCJydGwiID09PSBxID8gIi1ydGwiIDogIiIpICsgIic+PC9kaXY+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIEogPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBtLmhEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbS5oRGl2LnN0eWxlLndpZHRoID0gbS53aWR0aCArICJweCI7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uaERpdi5jbGFzc05hbWUgPSB5KEssICJoZWFkZXJEaXYiLCAhMCwgInVpLWpxZ3JpZC1oZGl2Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGEobS5oRGl2KS5hcHBlbmQoWCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoWCkuYXBwZW5kKHUpOwogICAgICAgICAgICAgICAgICAgICAgICB1ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgcGEgJiYgYShtLmhEaXYpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnBhZ2VyICYmICgic3RyaW5nIiA9PSB0eXBlb2YgZS5wLnBhZ2VyID8gIiMiICE9PSBlLnAucGFnZXIuc3Vic3RyKDAsIDEpICYmIChlLnAucGFnZXIgPSAiIyIgKyBlLnAucGFnZXIpIDogZS5wLnBhZ2VyID0gIiMiICsgYShlLnAucGFnZXIpLmF0dHIoImlkIiksIGEoZS5wLnBhZ2VyKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG0ud2lkdGggKyAicHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKHkoSywgInBhZ2VyQm94IiwgITAsICJ1aS1qcWdyaWQtcGFnZXIiKSkuYXBwZW5kVG8oTCksIHBhICYmIGEoZS5wLnBhZ2VyKS5oaWRlKCksIGQoZS5wLnBhZ2VyLCAiIikpOwogICAgICAgICAgICAgICAgICAgICAgICAhMSA9PT0gZS5wLmNlbGxFZGl0ICYmICEwID09PSBlLnAuaG92ZXJyb3dzICYmIGEoZSkuYmluZCgibW91c2VvdmVyIiwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmEgPSBhKGIudGFyZ2V0KS5jbG9zZXN0KCJ0ci5qcWdyb3ciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1aS1zdWJncmlkIiAhPT0gYShiYSkuYXR0cigiY2xhc3MiKSAmJiBhKGJhKS5hZGRDbGFzcyhBKQogICAgICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKCJtb3VzZW91dCIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhID0gYShiLnRhcmdldCkuY2xvc2VzdCgidHIuanFncm93Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGJhKS5yZW1vdmVDbGFzcyhBKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9hLCBzYSwgbWE7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkuYmVmb3JlKG0uaERpdikuY2xpY2soZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGphID0gYi50YXJnZXQsIGJhID0gYShqYSwgZS5yb3dzKS5jbG9zZXN0KCJ0ci5qcWdyb3ciKSwgMCA9PT0gYShiYSkubGVuZ3RoIHx8IC0xIDwgYmFbMF0uY2xhc3NOYW1lLmluZGV4T2YoQykgfHwgKGEoamEsIGUpLmNsb3Nlc3QoInRhYmxlLnVpLWpxZ3JpZC1idGFibGUiKS5hdHRyKCJpZCIpIHx8ICIiKS5yZXBsYWNlKCJfZnJvemVuIiwgIiIpICE9PSBlLmlkKSByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYShqYSkuaGFzQ2xhc3MoImNib3giKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkQmVmb3JlU2VsZWN0Um93IiwgW2JhWzBdLmlkLCBiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9ICExID09PSBjIHx8ICJzdG9wIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID8gITEgOiAhMCwgYS5pc0Z1bmN0aW9uKGUucC5iZWZvcmVTZWxlY3RSb3cpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBlLnAuYmVmb3JlU2VsZWN0Um93LmNhbGwoZSwgYmFbMF0uaWQsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICExICE9PSBoICYmICJzdG9wIiAhPT0gaCB8fCAoYyA9ICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJBIiAhPT0gamEudGFnTmFtZSAmJiAoIklOUFVUIiAhPT0gamEudGFnTmFtZSAmJiAiVEVYVEFSRUEiICE9PSBqYS50YWdOYW1lICYmICJPUFRJT04iICE9PSBqYS50YWdOYW1lICYmICJTRUxFQ1QiICE9PSBqYS50YWdOYW1lIHx8IGYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYSA9IGJhWzBdLmlkLCBqYSA9IGEoamEpLmNsb3Nlc3QoInRyLmpxZ3Jvdz50ZCIpLCAwIDwgamEubGVuZ3RoICYmIChzYSA9IGEuamdyaWQuZ2V0Q2VsbEluZGV4KGphKSwgbWEgPSBhKGphKS5jbG9zZXN0KCJ0ZCx0aCIpLmh0bWwoKSwgYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkQ2VsbFNlbGVjdCIsIFtvYSwgc2EsIG1hLCBiXSksIGEuaXNGdW5jdGlvbihlLnAub25DZWxsU2VsZWN0KSAmJiBlLnAub25DZWxsU2VsZWN0LmNhbGwoZSwgb2EsIHNhLCBtYSwgYikpLCAhMCAhPT0gZS5wLmNlbGxFZGl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucC5tdWx0aWtleSkgYltlLnAubXVsdGlrZXldID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgb2EsICEwLCBiKSA6IGUucC5tdWx0aXNlbGVjdCAmJiBmICYmIChmID0gYSgiI2pxZ18iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCkgKyAiXyIgKyBvYSkuaXMoIjpjaGVja2VkIiksIGEoIiNqcWdfIiArIGEuamdyaWQuanFJRChlLnAuaWQpICsgIl8iICsgb2EpW2UucC51c2VQcm9wID8gInByb3AiIDogImF0dHIiXSgiY2hlY2tlZCIsICFmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLm11bHRpc2VsZWN0ICYmIGUucC5tdWx0aWJveG9ubHkgJiYgIWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBlLnAuZnJvemVuQ29sdW1ucyA/IGUucC5pZCArICJfZnJvemVuIiA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUucC5zZWxhcnJyb3cpLmVhY2goZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKGUpLmpxR3JpZCgiZ2V0R3JpZFJvd0J5SWQiLCBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYgYShjKS5yZW1vdmVDbGFzcyhwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNqcWdfIiArIGEuamdyaWQuanFJRChlLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKGYpKVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtICYmIChhKCIjIiArIGEuamdyaWQuanFJRChmKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIyIgKyBhLmpncmlkLmpxSUQobSkpLnJlbW92ZUNsYXNzKHApLCBhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRChmKSwgIiMiICsgYS5qZ3JpZC5qcUlEKG0pKVtlLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnAuc2VsYXJycm93ID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShlKS5qcUdyaWQoInNldFNlbGVjdGlvbiIsIG9hLCAhMCwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUucC5tdWx0aXNlbGVjdCAmJiBmICYmIGMpIGEoZSkuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBvYSwgITAsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoMCA8IGphLmxlbmd0aCkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLmpxR3JpZCgiZWRpdENlbGwiLCBiYVswXS5yb3dJbmRleCwgc2EsICEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZCkge30KICAgICAgICAgICAgICAgICAgICAgICAgfSkuYmluZCgicmVsb2FkR3JpZCIsIGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gZS5wLnRyZWVHcmlkICYmIChlLnAuZGF0YXR5cGUgPSBlLnAudHJlZWRhdGF0eXBlKSwgZiA9IGYgfHwge30sIGYuY3VycmVudCAmJiBlLmdyaWQuc2VsZWN0aW9uUHJlc2VydmVyKGUpLCAibG9jYWwiID09PSBlLnAuZGF0YXR5cGUgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhKGUpLmpxR3JpZCgicmVzZXRTZWxlY3Rpb24iKSwgZS5wLmRhdGEubGVuZ3RoICYmICh0KCksIGVhKCkpKSA6IGUucC50cmVlR3JpZCB8fCAoZS5wLnNlbHJvdyA9IG51bGwsIGUucC5tdWx0aXNlbGVjdCAmJiAoZS5wLnNlbGFycnJvdyA9IFtdLCBEYSghMSkpLCBlLnAuc2F2ZWRSb3cgPSBbXSksIGUucC5zY3JvbGwgJiYgWS5jYWxsKGUsICEwLCAhMSksIGYucGFnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gZi5wYWdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPiBlLnAubGFzdHBhZ2UgJiYgKGMgPSBlLnAubGFzdHBhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPiBjICYmIChjID0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnBhZ2UgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZ3JpZC5iRGl2LnNjcm9sbFRvcCA9IGUuZ3JpZC5wcmV2Um93SGVpZ2h0ID8gKGMgLSAxKSAqIGUuZ3JpZC5wcmV2Um93SGVpZ2h0ICogZS5wLnJvd051bSA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLmdyaWQucHJldlJvd0hlaWdodCAmJiBlLnAuc2Nyb2xsICYmIHZvaWQgMCA9PT0gZi5wYWdlID8gKGRlbGV0ZSBlLnAubGFzdHBhZ2UsIGUuZ3JpZC5wb3B1bGF0ZVZpc2libGUoKSkgOiBlLmdyaWQucG9wdWxhdGUoKSwgITAgPT09IGUucC5pbmxpbmVOYXYgJiYgYShlKS5qcUdyaWQoInNob3dBZGRFZGl0QnV0dG9ucyIpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICB9KS5kYmxjbGljayhmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamEgPSBiLnRhcmdldCwgYmEgPSBhKGphLCBlLnJvd3MpLmNsb3Nlc3QoInRyLmpxZ3JvdyIpLCAwICE9PSBhKGJhKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYSA9IGJhWzBdLnJvd0luZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhID0gYS5qZ3JpZC5nZXRDZWxsSW5kZXgoamEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkRGJsQ2xpY2tSb3ciLCBbYShiYSkuYXR0cigiaWQiKSwgb2EsIHNhLCBiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT0gZiA/IGYgOiBhLmlzRnVuY3Rpb24oZS5wLm9uZGJsQ2xpY2tSb3cpICYmIChmID0gZS5wLm9uZGJsQ2xpY2tSb3cuY2FsbChlLCBhKGJhKS5hdHRyKCJpZCIpLCBvYSwgc2EsIGIpLCBudWxsICE9IGYpID8gZiA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKCJjb250ZXh0bWVudSIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqYSA9IGIudGFyZ2V0LCBiYSA9IGEoamEsIGUucm93cykuY2xvc2VzdCgidHIuanFncm93IiksIDAgIT09IGEoYmEpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucC5tdWx0aXNlbGVjdCB8fCBhKGUpLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgYmFbMF0uaWQsICEwLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYSA9IGJhWzBdLnJvd0luZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhID0gYS5qZ3JpZC5nZXRDZWxsSW5kZXgoamEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkUmlnaHRDbGlja1JvdyIsIFthKGJhKS5hdHRyKCJpZCIpLCBvYSwgc2EsIGJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBmID8gZiA6IGEuaXNGdW5jdGlvbihlLnAub25SaWdodENsaWNrUm93KSAmJiAoZiA9IGUucC5vblJpZ2h0Q2xpY2tSb3cuY2FsbChlLCBhKGJhKS5hdHRyKCJpZCIpLCBvYSwgc2EsIGIpLCBudWxsICE9IGYpID8gZiA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbS5iRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYgImF1dG8iID09PSBTdHJpbmcoZS5wLmhlaWdodCkudG9Mb3dlckNhc2UoKSAmJiAoZS5wLmhlaWdodCA9ICIxMDAlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGEobS5iRGl2KS5hcHBlbmQoYSgnPGRpdiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7Ij48L2Rpdj4nKS5hcHBlbmQoIjxkaXY+PC9kaXY+IikuYXBwZW5kKHRoaXMpKS5hZGRDbGFzcygidWktanFncmlkLWJkaXYiKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlLnAuaGVpZ2h0ICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXNOYU4oZS5wLmhlaWdodCkgPyAiIiA6ICJweCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG0ud2lkdGggKyAicHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNjcm9sbChtLnNjcm9sbEdyaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBhKCJ0YWJsZTpmaXJzdCIsIG0uYkRpdikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlLnAudGJsd2lkdGggKyAicHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhLnN1cHBvcnQudGJvZHkgfHwgMiA9PT0gYSgidGJvZHkiLCB0aGlzKS5sZW5ndGggJiYgYSgidGJvZHk6Z3QoMCkiLCB0aGlzKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wLm11bHRpa2V5ICYmIChhLmpncmlkLm1zaWUgPyBhKG0uYkRpdikuYmluZCgic2VsZWN0c3RhcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGEobS5iRGl2KS5iaW5kKCJtb3VzZWRvd24iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhICYmIGEobS5iRGl2KS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBQYSA9IHggKyAiICIgKyB5KEssICJpY29uX2NhcHRpb25fb3BlbiIsICEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFhID0geCArICIgIiArIHkoSywgImljb25fY2FwdGlvbl9jbG9zZSIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgbS5jRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBNYSA9ICEwID09PSBlLnAuaGlkZWdyaWQgPyBhKCI8YSByb2xlPSdsaW5rJyBjbGFzcz0ndWktanFncmlkLXRpdGxlYmFyLWNsb3NlIEhlYWRlckJ1dHRvbiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgKyAiJyB0aXRsZT0nIiArIChhLmpncmlkLmdldFJlZ2lvbmFsKGUsICJkZWZhdWx0cy5zaG93aGlkZSIsIGUucC5zaG93aGlkZSkgfHwgIiIpICsgIicgLz4iKS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hLmFkZENsYXNzKEEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWEucmVtb3ZlQ2xhc3MoQSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kKCI8c3BhbiBjbGFzcz0ndWktanFncmlkLWhlYWRsaW5rICIgKyBQYSArICInPjwvc3Bhbj4iKS5jc3MoInJ0bCIgPT09IHEgPyAibGVmdCIgOiAicmlnaHQiLCAiMHB4IikgOiAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEobS5jRGl2KS5hcHBlbmQoTWEpLmFwcGVuZCgiPHNwYW4gY2xhc3M9J3VpLWpxZ3JpZC10aXRsZSc+IiArIGUucC5jYXB0aW9uICsgIjwvc3Bhbj4iKS5hZGRDbGFzcygidWktanFncmlkLXRpdGxlYmFyIHVpLWpxZ3JpZC1jYXB0aW9uIiArICgicnRsIiA9PT0gcSA/ICItcnRsIiA6ICIiKSArICIgIiArIHkoSywgImdyaWR0aXRsZUJveCIsICEwKSksIGEobS5jRGl2KS5pbnNlcnRCZWZvcmUobS5oRGl2KSwgZS5wLnRvb2xiYXJbMF0pIGcgPSB5KEssICJjdXN0b210b29sYmFyQm94IiwgITAsICJ1aS11c2VyZGF0YSIpLCBtLnVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgInRvcCIgPT09IGUucC50b29sYmFyWzFdID8gYShtLnVEaXYpLmluc2VydEJlZm9yZShtLmhEaXYpIDogImJvdHRvbSIgPT09IGUucC50b29sYmFyWzFdICYmIGEobS51RGl2KS5pbnNlcnRBZnRlcihtLmhEaXYpLCAiYm90aCIgPT09IGUucC50b29sYmFyWzFdID8gKG0udWJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgYShtLnVEaXYpLmFkZENsYXNzKGcgKyAiIHVpLXVzZXJkYXRhLXRvcCIpLmF0dHIoImlkIiwgInRfIiArIHRoaXMuaWQpLmluc2VydEJlZm9yZShtLmhEaXYpLndpZHRoKG0ud2lkdGgpLCBhKG0udWJEaXYpLmFkZENsYXNzKGcgKyAiIHVpLXVzZXJkYXRhLWJvdHRvbSIpLmF0dHIoImlkIiwgInRiXyIgKyB0aGlzLmlkKS5pbnNlcnRBZnRlcihtLmhEaXYpLndpZHRoKG0ud2lkdGgpLCBwYSAmJiBhKG0udWJEaXYpLmhpZGUoKSkgOiBhKG0udURpdikud2lkdGgobS53aWR0aCkuYWRkQ2xhc3MoZyArICIgdWktdXNlcmRhdGEtdG9wIikuYXR0cigiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInRfIiArIHRoaXMuaWQpLCBwYSAmJiBhKG0udURpdikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wLnRvcHBhZ2VyICYmIChlLnAudG9wcGFnZXIgPSBhLmpncmlkLmpxSUQoZS5wLmlkKSArICJfdG9wcGFnZXIiLCBtLnRvcERpdiA9IGEoIjxkaXYgaWQ9JyIgKyBlLnAudG9wcGFnZXIgKyAiJz48L2Rpdj4iKVswXSwgZS5wLnRvcHBhZ2VyID0gIiMiICsgZS5wLnRvcHBhZ2VyLCBhKG0udG9wRGl2KS5hZGRDbGFzcyh5KEssICJ0b3BwYWdlckJveCIsICEwLCAidWktanFncmlkLXRvcHBhZ2VyIikpLndpZHRoKG0ud2lkdGgpLmluc2VydEJlZm9yZShtLmhEaXYpLCBkKGUucC50b3BwYWdlciwgIl90IikpLCBlLnAuZm9vdGVycm93ICYmIChtLnNEaXYgPSBhKCI8ZGl2IGNsYXNzPSd1aS1qcWdyaWQtc2Rpdic+PC9kaXY+IilbMF0sIFggPSBhKCI8ZGl2IGNsYXNzPSd1aS1qcWdyaWQtaGJveCIgKyAoInJ0bCIgPT09IHEgPyAiLXJ0bCIgOiAiIikgKyAiJz48L2Rpdj4iKSwgYShtLnNEaXYpLmFwcGVuZChYKS53aWR0aChtLndpZHRoKS5pbnNlcnRBZnRlcihtLmhEaXYpLCBhKFgpLmFwcGVuZCh6YSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5mb290ZXJzID0gYSgiLnVpLWpxZ3JpZC1mdGFibGUiLCBtLnNEaXYpWzBdLnJvd3NbMF0uY2VsbHMsIGUucC5yb3dudW1iZXJzICYmIChtLmZvb3RlcnNbMF0uY2xhc3NOYW1lID0geShLLCAicm93bnVtQm94IiwgITAsICJqcWdyaWQtcm93bnVtIikpLCBwYSAmJiBhKG0uc0RpdikuaGlkZSgpKSwgWCA9IG51bGwsIGUucC5jYXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWIgPSBlLnAuZGF0YXR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gZS5wLmhpZGVncmlkICYmIChhKCIudWktanFncmlkLXRpdGxlYmFyLWNsb3NlIiwgbS5jRGl2KS5jbGljayhmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGMgPSBhLmlzRnVuY3Rpb24oZS5wLm9uSGVhZGVyQ2xpY2spLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gIi51aS1qcWdyaWQtYmRpdiwgLnVpLWpxZ3JpZC1oZGl2LCAudWktanFncmlkLXRvcHBhZ2VyLCAudWktanFncmlkLXBhZ2VyLCAudWktanFncmlkLXNkaXYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAgPT09IGUucC50b29sYmFyWzBdICYmICgiYm90aCIgPT09IGUucC50b29sYmFyWzFdICYmIChoICs9ICIsICMiICsgYShtLnViRGl2KS5hdHRyKCJpZCIpKSwgaCArPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCAjIiArIGEobS51RGl2KS5hdHRyKCJpZCIpKSwgZiA9IGEoaCwgIiNndmlld18iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCkpLmxlbmd0aCwgInZpc2libGUiID09PSBlLnAuZ3JpZHN0YXRlID8gYShoLCAiI2dib3hfIiArIGEuamdyaWQuanFJRChlLnAuaWQpKS5zbGlkZVVwKCJmYXN0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYtLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gZiAmJiAoYSgic3BhbiIsIGQpLnJlbW92ZUNsYXNzKFBhKS5hZGRDbGFzcyhRYSksIGUucC5ncmlkc3RhdGUgPSAiaGlkZGVuIiwgYSgiI2dib3hfIiArIGEuamdyaWQuanFJRChlLnAuaWQpKS5oYXNDbGFzcygidWktcmVzaXphYmxlIikgJiYgYSgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiLCAiI2dib3hfIiArIGEuamdyaWQuanFJRChlLnAuaWQpKS5oaWRlKCksIGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEhlYWRlckNsaWNrIiwgW2UucC5ncmlkc3RhdGUsIGJdKSwgYyAmJiAocGEgfHwgZS5wLm9uSGVhZGVyQ2xpY2suY2FsbChlLCBlLnAuZ3JpZHN0YXRlLCBiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAiaGlkZGVuIiA9PT0gZS5wLmdyaWRzdGF0ZSAmJiBhKGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCkpLnNsaWRlRG93bigiZmFzdCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLS07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGYgJiYgKGEoInNwYW4iLCBkKS5yZW1vdmVDbGFzcyhRYSkuYWRkQ2xhc3MoUGEpLCBwYSAmJiAoZS5wLmRhdGF0eXBlID0gZWIsIG5hKCksIHBhID0gITEpLCBlLnAuZ3JpZHN0YXRlID0gInZpc2libGUiLCBhKCIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCkpLmhhc0NsYXNzKCJ1aS1yZXNpemFibGUiKSAmJiBhKCIudWktcmVzaXphYmxlLWhhbmRsZSIsICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKGUucC5pZCkpLnNob3coKSwgYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkSGVhZGVyQ2xpY2siLCBbZS5wLmdyaWRzdGF0ZSwgYl0pLCBjICYmIChwYSB8fCBlLnAub25IZWFkZXJDbGljay5jYWxsKGUsIGUucC5ncmlkc3RhdGUsIGIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBwYSAmJiAoZS5wLmRhdGF0eXBlID0gImxvY2FsIiwgYSgiLnVpLWpxZ3JpZC10aXRsZWJhci1jbG9zZSIsIG0uY0RpdikudHJpZ2dlcigiY2xpY2siKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBhKG0uY0RpdikuaGlkZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnRvcHBhZ2VyIHx8IGEobS5oRGl2KS5hZGRDbGFzcyh5KGUucC5zdHlsZVVJICsgIi5jb21tb24iLCAiY29ybmVydG9wIiwgITApKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEobS5oRGl2KS5hZnRlcihtLmJEaXYpLm1vdXNlbW92ZShmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0ucmVzaXppbmcgPyAobS5kcmFnTW92ZShhKSwgITEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiLnVpLWpxZ3JpZC1sYWJlbHMiLCBtLmhEaXYpLmJpbmQoInNlbGVjdHN0YXJ0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYShkb2N1bWVudCkuYmluZCgibW91c2V1cC5qcUdyaWQiICsgZS5wLmlkLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5yZXNpemluZyA/IChtLmRyYWdFbmQoITApLCAhMSkgOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGUuZm9ybWF0Q29sID0gUSwgZS5zb3J0RGF0YSA9IFUsIGUudXBkYXRlcGFnZXIgPSBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGgsIG0sIGQsIHcsIGwsIGcsIG4gPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IChsID0gZS5wLnBhZ2VyID8gYS5qZ3JpZC5qcUlEKGUucC5wYWdlci5zdWJzdHIoMSkpIDogIiIpID8gIl8iICsgbCA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gZS5wLnRvcHBhZ2VyID8gIl8iICsgZS5wLnRvcHBhZ2VyLnN1YnN0cigxKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtID0gcGFyc2VJbnQoZS5wLnBhZ2UsIDEwKSAtIDEsIDAgPiBtICYmIChtID0gMCksIG0gKj0gcGFyc2VJbnQoZS5wLnJvd051bSwgMTApLCB3ID0gbSArIGUucC5yZWNjb3VudCwgZS5wLnNjcm9sbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgidGJvZHk6Zmlyc3QgPiB0cjpndCgwKSIsIGUuZ3JpZC5iRGl2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IHcgLSBjLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnJlY2NvdW50ID0gYy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYy5vdXRlckhlaWdodCgpIHx8IGUuZ3JpZC5wcmV2Um93SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gbSAqIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IHBhcnNlSW50KGUucC5yZWNvcmRzLCAxMCkgKiBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiPmRpdjpmaXJzdCIsIGUuZ3JpZC5iRGl2KS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2hpbGRyZW4oImRpdjpmaXJzdCIpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGggPyAiIiA6ICJub25lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID09PSBlLmdyaWQuYkRpdi5zY3JvbGxUb3AgJiYgMSA8IGUucC5wYWdlICYmIChlLmdyaWQuYkRpdi5zY3JvbGxUb3AgPSBlLnAucm93TnVtICogKGUucC5wYWdlIC0gMSkgKiBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZ3JpZC5iRGl2LnNjcm9sbExlZnQgPSBlLmdyaWQuaERpdi5zY3JvbGxMZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wLnBhZ2VyIHx8ICIiLCBuICs9IGUucC50b3BwYWdlciA/IG4gPyAiLCIgKyBlLnAudG9wcGFnZXIgOiBlLnAudG9wcGFnZXIgOiAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IGEuamdyaWQuZ2V0UmVnaW9uYWwoZSwgImZvcm1hdHRlci5pbnRlZ2VyIiksIGMgPSBHKGUucC5wYWdlKSwgaCA9IEcoZS5wLmxhc3RwYWdlKSwgYSgiLnNlbGJveCIsIG4pW3RoaXMucC51c2VQcm9wID8gInByb3AiIDogImF0dHIiXSgiZGlzYWJsZWQiLCAhMSksICEwID09PSBlLnAucGdpbnB1dCAmJiAoYSgiI2lucHV0IiArIHEpLmh0bWwoYS5qZ3JpZC50ZW1wbGF0ZShhLmpncmlkLmdldFJlZ2lvbmFsKGUsICJkZWZhdWx0cy5wZ3RleHQiLCBlLnAucGd0ZXh0KSB8fCAiIiwgIjxpbnB1dCAiICsgeShLLCAicGdJbnB1dCIsICExLCAidWktcGctaW5wdXQiKSArICIgdHlwZT0ndGV4dCcgc2l6ZT0nMicgbWF4bGVuZ3RoPSc3JyB2YWx1ZT0nMCcgcm9sZT0ndGV4dGJveCcvPiIsICI8c3BhbiBpZD0nc3BfMV8iICsgYS5qZ3JpZC5qcUlEKGwpICsgIic+PC9zcGFuPiIpKSwgZS5wLnRvcHBhZ2VyICYmIGEoIiNpbnB1dF90IiArIHIpLmh0bWwoYS5qZ3JpZC50ZW1wbGF0ZShhLmpncmlkLmdldFJlZ2lvbmFsKGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlZmF1bHRzLnBndGV4dCIsIGUucC5wZ3RleHQpIHx8ICIiLCAiPGlucHV0ICIgKyB5KEssICJwZ0lucHV0IiwgITEsICJ1aS1wZy1pbnB1dCIpICsgIiB0eXBlPSd0ZXh0JyBzaXplPScyJyBtYXhsZW5ndGg9JzcnIHZhbHVlPScwJyByb2xlPSd0ZXh0Ym94Jy8+IiwgIjxzcGFuIGlkPSdzcF8xXyIgKyBhLmpncmlkLmpxSUQobCkgKyAiX3RvcHBhZ2VyJz48L3NwYW4+IikpLCBhKCIudWktcGctaW5wdXQiLCBuKS52YWwoZS5wLnBhZ2UpLCBkID0gZS5wLnRvcHBhZ2VyID8gIiNzcF8xIiArIHEgKyAiLCNzcF8xIiArIHEgKyAiX3RvcHBhZ2VyIiA6ICIjc3BfMSIgKyBxLCBhKGQpLmh0bWwoYS5mbWF0dGVyID8gYS5mbWF0dGVyLnV0aWwuTnVtYmVyRm9ybWF0KGUucC5sYXN0cGFnZSwgZykgOiBlLnAubGFzdHBhZ2UpKSwgZS5wLnZpZXdyZWNvcmRzKSAwID09PSBlLnAucmVjY291bnQgPyBhKCIudWktcGFnaW5nLWluZm8iLCBuKS5odG1sKGEuamdyaWQuZ2V0UmVnaW9uYWwoZSwgImRlZmF1bHRzLmVtcHR5cmVjb3JkcyIsIGUucC5lbXB0eXJlY29yZHMpKSA6IChkID0gbSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gZS5wLnJlY29yZHMsIGEuZm1hdHRlciAmJiAoZCA9IGEuZm1hdHRlci51dGlsLk51bWJlckZvcm1hdChkLCBnKSwgdyA9IGEuZm1hdHRlci51dGlsLk51bWJlckZvcm1hdCh3LCBnKSwgbCA9IGEuZm1hdHRlci51dGlsLk51bWJlckZvcm1hdChsLCBnKSksIGcgPSBhLmpncmlkLmdldFJlZ2lvbmFsKGUsICJkZWZhdWx0cy5yZWNvcmR0ZXh0IiwgZS5wLnJlY29yZHRleHQpLCBhKCIudWktcGFnaW5nLWluZm8iLCBuKS5odG1sKGEuamdyaWQudGVtcGxhdGUoZywgZCwgdywgbCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGUucC5wZ2J1dHRvbnMgJiYgKDAgPj0gYyAmJiAoYyA9IGggPSAwKSwgMSA9PT0gYyB8fCAwID09PSBjID8gKGEoIiNmaXJzdCIgKyBxICsgIiwgI3ByZXYiICsgcSkuYWRkQ2xhc3MoQykucmVtb3ZlQ2xhc3MoQSksIGUucC50b3BwYWdlciAmJiBhKCIjZmlyc3RfdCIgKyByICsgIiwgI3ByZXZfdCIgKyByKS5hZGRDbGFzcyhDKS5yZW1vdmVDbGFzcyhBKSkgOiAoYSgiI2ZpcnN0IiArIHEgKyAiLCAjcHJldiIgKyBxKS5yZW1vdmVDbGFzcyhDKSwgZS5wLnRvcHBhZ2VyICYmIGEoIiNmaXJzdF90IiArIHIgKyAiLCAjcHJldl90IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByKS5yZW1vdmVDbGFzcyhDKSksIGMgPT09IGggfHwgMCA9PT0gYyA/IChhKCIjbmV4dCIgKyBxICsgIiwgI2xhc3QiICsgcSkuYWRkQ2xhc3MoQykucmVtb3ZlQ2xhc3MoQSksIGUucC50b3BwYWdlciAmJiBhKCIjbmV4dF90IiArIHIgKyAiLCAjbGFzdF90IiArIHIpLmFkZENsYXNzKEMpLnJlbW92ZUNsYXNzKEEpKSA6IChhKCIjbmV4dCIgKyBxICsgIiwgI2xhc3QiICsgcSkucmVtb3ZlQ2xhc3MoQyksIGUucC50b3BwYWdlciAmJiBhKCIjbmV4dF90IiArIHIgKyAiLCAjbGFzdF90IiArIHIpLnJlbW92ZUNsYXNzKEMpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ITAgPT09IGIgJiYgITAgPT09IGUucC5yb3dudW1iZXJzICYmIGEoIj50ZC5qcWdyaWQtcm93bnVtIiwgZS5yb3dzKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5odG1sKG0gKyAxICsgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmICYmIGUucC5qcWdkbmQgJiYgYShlKS5qcUdyaWQoImdyaWREbkQiLCAidXBkYXRlRG5EIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShlKS50cmlnZ2VySGFuZGxlcigianFHcmlkR3JpZENvbXBsZXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGUucC5ncmlkQ29tcGxldGUpICYmIGUucC5ncmlkQ29tcGxldGUuY2FsbChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlckdyaWRDb21wbGV0ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBlLnJlZnJlc2hJbmRleCA9IGVhLCBlLnNldEhlYWRDaGVja0JveCA9IERhLCBlLmNvbnN0cnVjdFRyID0gaWEsIGUuZm9ybWF0dGVyID0gZnVuY3Rpb24oYSwgYiwgZiwgZSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSKGEsIGIsIGYsIGUsIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmV4dGVuZChtLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGU6IG5hLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtcHR5Um93czogWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpblJlcTogR2EsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kUmVxOiBWCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncmlkID0gbSwgZS5hZGRYbWxEYXRhID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGUuYWRkSlNPTkRhdGEgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUChhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5ncmlkLmNvbHMgPSB0aGlzLnJvd3NbMF0uY2VsbHMsIGEoZSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEluaXRHcmlkIiksIGEuaXNGdW5jdGlvbihlLnAub25Jbml0R3JpZCkgJiYgZS5wLm9uSW5pdEdyaWQuY2FsbChlKSwgbmEoKSwgZS5wLmhpZGRlbmdyaWQgPSAhMSwgZS5wLnJlc3BvbnNpdmUpIGQgPSAib25vcmllbnRhdGlvbmNoYW5nZSIgaW4gd2luZG93ID8gIm9yaWVudGF0aW9uY2hhbmdlIiA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVzaXplIiwgYSh3aW5kb3cpLm9uKGQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkuanFHcmlkKCJyZXNpemVHcmlkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5qZ3JpZC5leHRlbmQoewogICAgICAgICAgICAgICAgZ2V0R3JpZFBhcmFtOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGQgPSB0aGlzWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChkICYmIGQuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBjICYmICJzdHJpbmciICE9IHR5cGVvZiBjICYmIChjID0gImpxR3JpZCIpLCBoID0gZC5wLCAianFHcmlkIiAhPT0gYykgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhKGQpLmRhdGEoYykKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGQucAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiID8gdm9pZCAwICE9PSBoW2JdID8gaFtiXSA6IG51bGwgOiBoCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldEdyaWRQYXJhbTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGMgJiYgKGMgPSAhMSksIHRoaXMuZ3JpZCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgYikgITAgPT09IGMgPyB0aGlzLnAgPSBhLmV4dGVuZCh7fSwgdGhpcy5wLCBiKSA6IGEuZXh0ZW5kKCEwLCB0aGlzLnAsIGIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRHcmlkUm93QnlJZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBoID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dzLmxlbmd0aDsgaC0tOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi50b1N0cmluZygpID09PSB0aGlzLnJvd3NbaF0uaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMucm93c1toXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhKHRoaXMuZ3JpZC5iRGl2KS5maW5kKCIjIiArIGEuamdyaWQuanFJRChiKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLCBjCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0RGF0YUlEczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gdGhpcy5yb3dzLmxlbmd0aCwgYiAmJiAwIDwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBiID4gaDspIGEodGhpcy5yb3dzW2hdKS5oYXNDbGFzcygianFncm93IikgJiYgKGNbZF0gPSB0aGlzLnJvd3NbaF0uaWQsIGQrKyksIGgrKwogICAgICAgICAgICAgICAgICAgIH0pLCBjCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2V0U2VsZWN0aW9uOiBmdW5jdGlvbihiLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGwsIGUsIGcsIEIsIHIsIHE7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLmpncmlkLmdldE1ldGhvZCgiZ2V0U3R5bGVVSSIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGwodGhpcy5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJoaWdobGlnaHQiLCAhMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gbCh0aGlzLnAuc3R5bGVVSSArICIuY29tbW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZWQiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIgJiYgKGMgPSAhMSA9PT0gYyA/ICExIDogITAsIChsID0gYSh0aGlzKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgYikpICYmIGwuY2xhc3NOYW1lICYmICEoLTEgPCBsLmNsYXNzTmFtZS5pbmRleE9mKGspKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gdGhpcy5wLnNjcm9sbHJvd3MgJiYgKGUgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0R3JpZFJvd0J5SWQiLCBiKS5yb3dJbmRleCwgMCA8PSBlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gYSh0aGlzLmdyaWQuYkRpdilbMF0uY2xpZW50SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gYSh0aGlzLmdyaWQuYkRpdilbMF0uc2Nyb2xsVG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gYSh0aGlzLnJvd3NbZV0pLnBvc2l0aW9uKCkudG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnJvd3NbZV0uY2xpZW50SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgKyBlID49IGsgKyB5ID8gYSh0aGlzLmdyaWQuYkRpdilbMF0uc2Nyb2xsVG9wID0gSyAtIChrICsgeSkgKyBlICsgeSA6IGsgKyB5ID4gSyAmJiB5ID4gSyAmJiAoYSh0aGlzLmdyaWQuYkRpdilbMF0uc2Nyb2xsVG9wID0gSykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0hMCA9PT0gdGhpcy5wLmZyb3plbkNvbHVtbnMgJiYgKHIgPSB0aGlzLnAuaWQgKyAiX2Zyb3plbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLm11bHRpc2VsZWN0ID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5zZXRIZWFkQ2hlY2tCb3goITEpLCB0aGlzLnAuc2Vscm93ID0gbC5pZCwgZyA9IGEuaW5BcnJheSh0aGlzLnAuc2Vscm93LCB0aGlzLnAuc2VsYXJycm93KSwgLTEgPT09IGcgPyAoInVpLXN1YmdyaWQiICE9PSBsLmNsYXNzTmFtZSAmJiBhKGwpLmFkZENsYXNzKHUpLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAidHJ1ZSIpLCBkID0gITAsIHRoaXMucC5zZWxhcnJyb3cucHVzaCh0aGlzLnAuc2Vscm93KSkgOiAoInVpLXN1YmdyaWQiICE9PSBsLmNsYXNzTmFtZSAmJiBhKGwpLnJlbW92ZUNsYXNzKHUpLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAiZmFsc2UiKSwgZCA9ICExLCB0aGlzLnAuc2VsYXJycm93LnNwbGljZShnLCAxKSwgQiA9IHRoaXMucC5zZWxhcnJyb3dbMF0sIHRoaXMucC5zZWxyb3cgPSB2b2lkIDAgPT09IEIgPyBudWxsIDogQiksIGEoIiNqcWdfIiArIGEuamdyaWQuanFJRCh0aGlzLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKGwuaWQpKVt0aGlzLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCBkKSwgciAmJiAoLTEgPT09IGcgPyBhKCIjIiArIGEuamdyaWQuanFJRChiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiMiICsgYS5qZ3JpZC5qcUlEKHIpKS5hZGRDbGFzcyh1KSA6IGEoIiMiICsgYS5qZ3JpZC5qcUlEKGIpLCAiIyIgKyBhLmpncmlkLmpxSUQocikpLnJlbW92ZUNsYXNzKHUpLCBhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQodGhpcy5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRChiKSwgIiMiICsgYS5qZ3JpZC5qcUlEKHIpKVt0aGlzLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCBkKSksIGMgJiYgKGEodGhpcykudHJpZ2dlckhhbmRsZXIoImpxR3JpZFNlbGVjdFJvdyIsIFtsLmlkLCBkLCBoXSksIHRoaXMucC5vblNlbGVjdFJvdyAmJiB0aGlzLnAub25TZWxlY3RSb3cuY2FsbCh0aGlzLCBsLmlkLCBkLCBoKSkpIDogInVpLXN1YmdyaWQiICE9PSBsLmNsYXNzTmFtZSAmJiAodGhpcy5wLnNlbHJvdyAhPT0gbC5pZCA/IChxID0gYSh0aGlzKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgdGhpcy5wLnNlbHJvdyksIHEgJiYgYShxKS5yZW1vdmVDbGFzcyh1KS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtc2VsZWN0ZWQiOiAiZmFsc2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJpbmRleDogIi0xIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKGwpLmFkZENsYXNzKHUpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1zZWxlY3RlZCI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXg6ICIwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCByICYmIChhKCIjIiArIGEuamdyaWQuanFJRCh0aGlzLnAuc2Vscm93KSwgIiMiICsgYS5qZ3JpZC5qcUlEKHIpKS5yZW1vdmVDbGFzcyh1KSwgYSgiIyIgKyBhLmpncmlkLmpxSUQoYiksICIjIiArIGEuamdyaWQuanFJRChyKSkuYWRkQ2xhc3ModSkpLCBkID0gITApIDogZCA9ICExLCB0aGlzLnAuc2Vscm93ID0gbC5pZCwgYyAmJiAoYSh0aGlzKS50cmlnZ2VySGFuZGxlcigianFHcmlkU2VsZWN0Um93IiwgW2wuaWQsIGQsIGhdKSwgdGhpcy5wLm9uU2VsZWN0Um93ICYmIHRoaXMucC5vblNlbGVjdFJvdy5jYWxsKHRoaXMsIGwuaWQsIGQsIGgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzZXRTZWxlY3Rpb246IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCwgZCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5nZXRNZXRob2QoImdldFN0eWxlVUkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBsKGQucC5zdHlsZVVJICsgIi5jb21tb24iLCAiaGlnaGxpZ2h0IiwgITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGwoZC5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJob3ZlciIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBkLnAuZnJvemVuQ29sdW1ucyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGggPSBkLnAuaWQgKyAiX2Zyb3plbiIpLCB2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYiA9PT0gZC5wLnNlbHJvdyA/IGQucC5zZWxyb3cgOiBiLCBhKCIjIiArIGEuamdyaWQuanFJRChkLnAuaWQpICsgIiB0Ym9keTpmaXJzdCB0ciMiICsgYS5qZ3JpZC5qcUlEKGMpKS5yZW1vdmVDbGFzcyhlKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIiksIGggJiYgYSgiIyIgKyBhLmpncmlkLmpxSUQoYyksICIjIiArIGEuamdyaWQuanFJRChoKSkucmVtb3ZlQ2xhc3MoZSksIGQucC5tdWx0aXNlbGVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNqcWdfIiArIGEuamdyaWQuanFJRChkLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKGMpLCAiIyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSlbZC5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggJiYgYSgiI2pxZ18iICsgYS5qZ3JpZC5qcUlEKGQucC5pZCkgKyAiXyIgKyBhLmpncmlkLmpxSUQoYyksICIjIiArIGEuamdyaWQuanFJRChoKSlbZC5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuc2V0SGVhZENoZWNrQm94KCExKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuaW5BcnJheShhLmpncmlkLmpxSUQoYyksIGQucC5zZWxhcnJyb3cpOyAtIDEgIT09IGcgJiYgZC5wLnNlbGFycnJvdy5zcGxpY2UoZywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5vblVuU2VsZWN0Um93ICYmIGQucC5vblVuU2VsZWN0Um93LmNhbGwoZCwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZC5wLm11bHRpc2VsZWN0ID8gKGEoZC5wLnNlbGFycnJvdykuZWFjaChmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGEoZCkuanFHcmlkKCJnZXRHcmlkUm93QnlJZCIsIGYpKS5yZW1vdmVDbGFzcyhlKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjanFnXyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSArICJfIiArIGEuamdyaWQuanFJRChmKSlbZC5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCAmJiAoYSgiIyIgKyBhLmpncmlkLmpxSUQoZiksICIjIiArIGEuamdyaWQuanFJRChoKSkucmVtb3ZlQ2xhc3MoZSksIGEoIiNqcWdfIiArIGEuamdyaWQuanFJRChkLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKGYpLCAiIyIgKyBhLmpncmlkLmpxSUQoaCkpW2QucC51c2VQcm9wID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5vblVuU2VsZWN0Um93ICYmIGQucC5vblVuU2VsZWN0Um93LmNhbGwoZCwgZikKICAgICAgICAgICAgICAgICAgICAgICAgfSksIGQuc2V0SGVhZENoZWNrQm94KCExKSwgZC5wLnNlbGFycnJvdyA9IFtdLCBkLnAuc2Vscm93ID0gbnVsbCkgOiBkLnAuc2Vscm93ICYmIChhKCIjIiArIGEuamdyaWQuanFJRChkLnAuaWQpICsgIiB0Ym9keTpmaXJzdCB0ciMiICsgYS5qZ3JpZC5qcUlEKGQucC5zZWxyb3cpKS5yZW1vdmVDbGFzcyhlKS5hdHRyKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIiksIGggJiYgYSgiIyIgKyBhLmpncmlkLmpxSUQoZC5wLnNlbHJvdyksICIjIiArIGEuamdyaWQuanFJRChoKSkucmVtb3ZlQ2xhc3MoZSksIGQucC5vblVuU2VsZWN0Um93ICYmIGQucC5vblVuU2VsZWN0Um93LmNhbGwoZCwgZC5wLnNlbHJvdyksIGQucC5zZWxyb3cgPSBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGQucC5jZWxsRWRpdCAmJiAwIDw9IHBhcnNlSW50KGQucC5pQ29sLCAxMCkgJiYgMCA8PSBwYXJzZUludChkLnAuaVJvdywgMTApICYmIChhKCJ0ZDplcSgiICsgZC5wLmlDb2wgKyAiKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnJvd3NbZC5wLmlSb3ddKS5yZW1vdmVDbGFzcygiZWRpdC1jZWxsICIgKyBlKSwgYShkLnJvd3NbZC5wLmlSb3ddKS5yZW1vdmVDbGFzcygic2VsZWN0ZWQtcm93ICIgKyBsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGQucC5zYXZlZFJvdyA9IFtdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRSb3dEYXRhOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGQsIGwgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgQiwgciwgcSA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGIpIGUgPSAhMCwgaCA9IFtdLCBkID0gcS5yb3dzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAociA9IGEocSkuanFHcmlkKCJnZXRHcmlkUm93QnlJZCIsIGIpLCAhcikgcmV0dXJuIGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gMgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyAmJiAhMCA9PT0gYyAmJiAwIDwgcS5wLmRhdGEubGVuZ3RoIHx8IChjID0gITEpOyBkID4gZzspIGUgJiYgKHIgPSBxLnJvd3NbZ10pLCBhKHIpLmhhc0NsYXNzKCJqcWdyb3ciKSAmJiAoYyA/IGwgPSBxLnAuZGF0YVtxLnAuX2luZGV4W3IuaWRdXSA6IGEoJ3RkW3JvbGU9ImdyaWRjZWxsIl0nLCByKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChCID0gcS5wLmNvbE1vZGVsW2JdLm5hbWUsICJjYiIgIT09IEIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3ViZ3JpZCIgIT09IEIgJiYgInJuIiAhPT0gQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IHEucC50cmVlR3JpZCAmJiBCID09PSBxLnAuRXhwYW5kQ29sdW1uKSBsW0JdID0gYS5qZ3JpZC5odG1sRGVjb2RlKGEoInNwYW46Zmlyc3QiLCB0aGlzKS5odG1sKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbFtCXSA9IGEudW5mb3JtYXQuY2FsbChxLCB0aGlzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiBxLnAuY29sTW9kZWxbYl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxbQl0gPSBhLmpncmlkLmh0bWxEZWNvZGUoYSh0aGlzKS5odG1sKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgZSAmJiAoaC5wdXNoKGwpLCBsID0ge30pKSwgZysrCiAgICAgICAgICAgICAgICAgICAgfSksIGggfHwgbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbFJvd0RhdGE6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCwgZCwgbCA9ICExOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYSh0aGlzKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgYiksICFjKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnAuc3ViR3JpZCAmJiAoZCA9IGEoYykubmV4dCgpLCBkLmhhc0NsYXNzKCJ1aS1zdWJncmlkIikgJiYgZC5yZW1vdmUoKSksIGEoYykucmVtb3ZlKCksIHRoaXMucC5yZWNvcmRzLS0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAucmVjY291bnQtLSwgdGhpcy51cGRhdGVwYWdlcighMCwgITEpLCBsID0gITAsIHRoaXMucC5tdWx0aXNlbGVjdCAmJiAoaCA9IGEuaW5BcnJheShiLCB0aGlzLnAuc2VsYXJycm93KSwgLTEgIT09IGggJiYgdGhpcy5wLnNlbGFycnJvdy5zcGxpY2UoaCwgMSkpLCB0aGlzLnAubXVsdGlzZWxlY3QgJiYgMCA8IHRoaXMucC5zZWxhcnJyb3cubGVuZ3RoID8gdGhpcy5wLnNlbHJvdyA9IHRoaXMucC5zZWxhcnJyb3dbdGhpcy5wLnNlbGFycnJvdy5sZW5ndGggLSAxXSA6IHRoaXMucC5zZWxyb3cgPT09IGIgJiYgKHRoaXMucC5zZWxyb3cgPSBudWxsKSwgImxvY2FsIiA9PT0gdGhpcy5wLmRhdGF0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGEuamdyaWQuc3RyaXBQcmVmKHRoaXMucC5pZFByZWZpeCwgYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMucC5faW5kZXhbZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYgKHRoaXMucC5kYXRhLnNwbGljZShlLCAxKSwgdGhpcy5yZWZyZXNoSW5kZXgoKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IHRoaXMucC5hbHRSb3dzICYmIGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcy5wLmFsdGNsYXNzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzLnJvd3MpLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJSAyID8gYSh0aGlzKS5hZGRDbGFzcyhnKSA6IGEodGhpcykucmVtb3ZlQ2xhc3MoZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldFJvd0RhdGE6IGZ1bmN0aW9uKGIsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgbCwgZSA9ICEwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZ3JpZCkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcsIEIsIHIgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB0eXBlb2YgaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQiA9IGEodGhpcykuanFHcmlkKCJnZXRHcmlkUm93QnlJZCIsIGIpLCAhQikgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEodGhpcy5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGEuamdyaWQuZ2V0QWNjZXNzb3IoYywgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGggJiYgKHVbZF0gPSB0aGlzLmZvcm1hdHRlciAmJiAic3RyaW5nIiA9PSB0eXBlb2YgdGhpcy5mb3JtYXR0ZXIgJiYgImRhdGUiID09PSB0aGlzLmZvcm1hdHRlciA/IGEudW5mb3JtYXQuZGF0ZS5jYWxsKHIsIGgsIHRoaXMpIDogaCwgZyA9IHIuZm9ybWF0dGVyKGIsIHVbZF0sIGUsIGMsICJlZGl0IiksIGwgPSB0aGlzLnRpdGxlID8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBhLmpncmlkLnN0cmlwSHRtbChnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCAhMCA9PT0gci5wLnRyZWVHcmlkICYmIGQgPT09IHIucC5FeHBhbmRDb2x1bW4gPyBhKCJ0ZFtyb2xlPSdncmlkY2VsbCddOmVxKCIgKyBlICsgIikgPiBzcGFuOmZpcnN0IiwgQikuaHRtbChnKS5hdHRyKGwpIDogYSgidGRbcm9sZT0nZ3JpZGNlbGwnXTplcSgiICsgZSArICIpIiwgQikuaHRtbChnKS5hdHRyKGwpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgImxvY2FsIiA9PT0gci5wLmRhdGF0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrLCB5ID0gYS5qZ3JpZC5zdHJpcFByZWYoci5wLmlkUHJlZml4LCBiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSByLnAuX2luZGV4W3ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoci5wLnRyZWVHcmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChrIGluIHIucC50cmVlUmVhZGVyKSByLnAudHJlZVJlYWRlci5oYXNPd25Qcm9wZXJ0eShrKSAmJiBkZWxldGUgdVtyLnAudHJlZVJlYWRlcltrXV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gSyAmJiAoci5wLmRhdGFbS10gPSBhLmV4dGVuZCghMCwgci5wLmRhdGFbS10sIHUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChDKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlICYmICgic3RyaW5nIiA9PT0gcSA/IGEoQikuYWRkQ2xhc3MoaCkgOiBudWxsICE9PSBoICYmICJvYmplY3QiID09PSBxICYmIGEoQikuY3NzKGgpLCBhKHIpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlckdyaWRDb21wbGV0ZSIpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFkZFJvd0RhdGE6IGZ1bmN0aW9uKGIsIGMsIGgsIGQpIHsKICAgICAgICAgICAgICAgICAgICAtMSA9PT0gYS5pbkFycmF5KGgsIFsiZmlyc3QiLCAibGFzdCIsICJiZWZvcmUiLCAiYWZ0ZXIiXSkgJiYgKGggPSAibGFzdCIpOwogICAgICAgICAgICAgICAgICAgIHZhciBnLCBlLCBuLCBCLCByLCBxLCB1LCBrLCB5LCBLLCBDLCBwLCBBLCB4LCBIID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdiA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBMID0gIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgJiYgKGEuaXNBcnJheShjKSA/ICh5ID0gITAsIEsgPSBiKSA6IChjID0gW2NdLCB5ID0gITEpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBKID0gYy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSAhMCA9PT0gdGhpcy5wLnJvd251bWJlcnMgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgbiA9ICEwID09PSB0aGlzLnAubXVsdGlzZWxlY3QgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgQiA9ICEwID09PSB0aGlzLnAuc3ViR3JpZCA/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICB5IHx8ICh2b2lkIDAgIT09IGIgPyBiID0gU3RyaW5nKGIpIDogKGIgPSBhLmpncmlkLnJhbmRJZCgpLCAhMSAhPT0gdGhpcy5wLmtleU5hbWUgJiYgKEsgPSB0aGlzLnAua2V5TmFtZSwgdm9pZCAwICE9PSBjWzBdW0tdICYmIChiID0gY1swXVtLXSkpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEMgPSB0aGlzLnAuYWx0Y2xhc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBHLCBRID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGthID0gYSh0aGlzKS5qcUdyaWQoImdldFN0eWxlVUkiLCB0aGlzLnAuc3R5bGVVSSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIi5iYXNlIiwgInJvd0JveCIsICEwLCAianFncm93IHVpLXJvdy0iICsgdGhpcy5wLmRpcmVjdGlvbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEID0gYS5pc0Z1bmN0aW9uKHRoaXMucC5hZnRlckluc2VydFJvdykgPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICByICYmIChFID0gYSh0aGlzKS5qcUdyaWQoImdldFN0eWxlVUkiLCB0aGlzLnAuc3R5bGVVSSArICIuYmFzZSIsICJyb3dudW1Cb3giLCAhMSwgImpxZ3JpZC1yb3dudW0iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiAmJiAodiA9IGEodGhpcykuanFHcmlkKCJnZXRTdHlsZVVJIiwgdGhpcy5wLnN0eWxlVUkgKyAiLmJhc2UiLCAibXVsdGlCb3giLCAhMSwgImNib3giKSk7IEogPiBROykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAgPSBjW1FdLCBlID0gW10sIEcgPSBrYSwgeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBwW0tdLCB2b2lkIDAgPT09IGIgJiYgKGIgPSBhLmpncmlkLnJhbmRJZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEuamdyaWQucmFuZElkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRyArPSAhMCA9PT0gdGhpcy5wLmFsdFJvd3MgJiYgMCA9PT0gKHRoaXMucm93cy5sZW5ndGggLSAxKSAlIDIgPyAiICIgKyBDIDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMucC5pZFByZWZpeCArIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByICYmIChMID0gdGhpcy5mb3JtYXRDb2woMCwgMSwgIiIsIG51bGwsIGIsICEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2UubGVuZ3RoXSA9ICc8dGQgcm9sZT0iZ3JpZGNlbGwiICcgKyBFICsgIiAiICsgTCArICI+MDwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICYmIChrID0gJzxpbnB1dCByb2xlPSJjaGVja2JveCIgdHlwZT0iY2hlY2tib3giIGlkPSJqcWdfJyArIHRoaXMucC5pZCArICJfIiArIGIgKyAnIiAnICsgdiArICIvPiIsIEwgPSB0aGlzLmZvcm1hdENvbChyLCAxLCAiIiwgbnVsbCwgYiwgITApLCBlW2UubGVuZ3RoXSA9ICc8dGQgcm9sZT0iZ3JpZGNlbGwiICcgKyBMICsgIj4iICsgayArICI8L3RkPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQiAmJiAoZVtlLmxlbmd0aF0gPSBhKHRoaXMpLmpxR3JpZCgiYWRkU3ViR3JpZENlbGwiLCBuICsgciwgMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1ID0gbiArIEIgKyByOyB1IDwgdGhpcy5wLmNvbE1vZGVsLmxlbmd0aDsgdSsrKSBBID0gdGhpcy5wLmNvbE1vZGVsW3VdLCBnID0gQS5uYW1lLCBSW2ddID0gcFtnXSwgayA9IHRoaXMuZm9ybWF0dGVyKGIsIGEuamdyaWQuZ2V0QWNjZXNzb3IocCwgZyksIHUsIHApLCBMID0gdGhpcy5mb3JtYXRDb2wodSwgMSwgaywgcCwgYiwgUiksIGVbZS5sZW5ndGhdID0gJzx0ZCByb2xlPSJncmlkY2VsbCIgJyArIEwgKyAiPiIgKyBrICsgIjwvdGQ+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnVuc2hpZnQodGhpcy5jb25zdHJ1Y3RUcihiLCAhMSwgRywgUiwgcCkpLCBlW2UubGVuZ3RoXSA9ICI8L3RyPiIsIDAgPT09IHRoaXMucm93cy5sZW5ndGgpIGEoInRhYmxlOmZpcnN0IiwgdGhpcy5ncmlkLmJEaXYpLmFwcGVuZChlLmpvaW4oIiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugc3dpdGNoIChoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibGFzdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcy5yb3dzW3RoaXMucm93cy5sZW5ndGggLSAxXSkuYWZ0ZXIoZS5qb2luKCIiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB0aGlzLnJvd3MubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmlyc3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMucm93c1swXSkuYWZ0ZXIoZS5qb2luKCIiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhZnRlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChxID0gYSh0aGlzKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgZCkpICYmIChhKHRoaXMucm93c1txLnJvd0luZGV4ICsgMV0pLmhhc0NsYXNzKCJ1aS1zdWJncmlkIikgPyBhKHRoaXMucm93c1txLnJvd0luZGV4ICsgMV0pLmFmdGVyKGUpIDogYShxKS5hZnRlcihlLmpvaW4oIiIpKSwgcSA9IHEucm93SW5kZXggKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmVmb3JlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHEgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0R3JpZFJvd0J5SWQiLCBkKSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEocSkuYmVmb3JlKGUuam9pbigiIikpLCBxID0gcS5yb3dJbmRleCAtIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ITAgPT09IHRoaXMucC5zdWJHcmlkICYmIGEodGhpcykuanFHcmlkKCJhZGRTdWJHcmlkIiwgbiArIHIsIHEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLnJlY29yZHMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5yZWNjb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJJbnNlcnRSb3ciLCBbYiwgcCwgcF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRCAmJiB0aGlzLnAuYWZ0ZXJJbnNlcnRSb3cuY2FsbCh0aGlzLCBiLCBwLCBwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFErKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhbCIgPT09IHRoaXMucC5kYXRhdHlwZSAmJiAoUlt0aGlzLnAubG9jYWxSZWFkZXIuaWRdID0geCwgdGhpcy5wLl9pbmRleFt4XSA9IHRoaXMucC5kYXRhLmxlbmd0aCwgdGhpcy5wLmRhdGEucHVzaChSKSwgUiA9IHt9KQogICAgICAgICAgICAgICAgICAgICAgICB9ITAgIT09IHRoaXMucC5hbHRSb3dzIHx8IHkgfHwgKCJsYXN0IiA9PT0gaCA/IDAgPT09ICh0aGlzLnJvd3MubGVuZ3RoIC0gMSkgJSAyICYmIGEodGhpcy5yb3dzW3RoaXMucm93cy5sZW5ndGggLSAxXSkuYWRkQ2xhc3MoQykgOiBhKHRoaXMucm93cykuZWFjaChmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID09PSBiICUgMiA/IGEodGhpcykuYWRkQ2xhc3MoQykgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoQykKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZXBhZ2VyKCEwLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEggPSAhMAogICAgICAgICAgICAgICAgICAgIH0pKSwgSAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZvb3RlckRhdGE6IGZ1bmN0aW9uKGIsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBkKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiBpbiBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoYikpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBnLCBlLCBuID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEIgPSB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBiICYmIChiID0gImdldCIpLCAiYm9vbGVhbiIgIT0gdHlwZW9mIGggJiYgKGggPSAhMCksIGIgPSBiLnRvTG93ZXJDYXNlKCksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIsIHEgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcS5ncmlkICYmIHEucC5mb290ZXJyb3cgPyAic2V0IiA9PT0gYiAmJiBkKGMpID8gITEgOiAobiA9ICEwLCB2b2lkIGEodGhpcy5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2V0IiA9PT0gYiA/IHZvaWQgMCAhPT0gY1tnXSAmJiAociA9IGggPyBxLmZvcm1hdHRlcigiIiwgY1tnXSwgZCwgYywgImVkaXQiKSA6IGNbZ10sIGUgPSB0aGlzLnRpdGxlID8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBhLmpncmlkLnN0cmlwSHRtbChyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCBhKCJ0ci5mb290cm93IHRkOmVxKCIgKyBkICsgIikiLCBxLmdyaWQuc0RpdikuaHRtbChyKS5hdHRyKGUpLCBuID0gITApIDogImdldCIgPT09IGIgJiYgKEJbZ10gPSBhKCJ0ci5mb290cm93IHRkOmVxKCIgKyBkICsgIikiLCBxLmdyaWQuc0RpdikuaHRtbCgpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSkgOiAhMQogICAgICAgICAgICAgICAgICAgIH0pLCAiZ2V0IiA9PT0gYiA/IEIgOiBuCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2hvd0hpZGVDb2w6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCwgZCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5jZWxsX3dpZHRoID8gMCA6IGQucC5jZWxsTGF5b3V0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiAoYiA9IFtiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gIm5vbmUiICE9PSBjID8gIiIgOiAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9ICIiID09PSBjID8gITAgOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gZC5wLmdyb3VwSGVhZGVyICYmIChhLmlzQXJyYXkoZC5wLmdyb3VwSGVhZGVyKSB8fCBhLmlzRnVuY3Rpb24oZC5wLmdyb3VwSGVhZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQiAmJiBhKGQpLmpxR3JpZCgiZGVzdHJveUdyb3VwSGVhZGVyIiwgITEpLCBhKHRoaXMucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbihxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtMSAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaW5BcnJheSh0aGlzLm5hbWUsIGIpICYmIHRoaXMuaGlkZGVuID09PSBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGQucC5mcm96ZW5Db2x1bW5zICYmICEwID09PSB0aGlzLmZyb3plbikgcmV0dXJuICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidHJbcm9sZT1yb3ddIiwgZC5ncmlkLmhEaXYpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzLmNlbGxzW3FdKS5jc3MoImRpc3BsYXkiLCBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQucm93cykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmhhc0NsYXNzKCJqcWdyb3VwIikgfHwgYSh0aGlzLmNlbGxzW3FdKS5jc3MoImRpc3BsYXkiLCBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuZm9vdGVycm93ICYmIGEoInRyLmZvb3Ryb3cgdGQ6ZXEoIiArIHEgKyAiKSIsIGQuZ3JpZC5zRGl2KS5jc3MoImRpc3BsYXkiLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBwYXJzZUludCh0aGlzLndpZHRoLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9uZSIgPT09IGMgPyBkLnAudGJsd2lkdGggLT0gaCArIGUgOiBkLnAudGJsd2lkdGggKz0gaCArIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGRlbiA9ICFuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkU2hvd0hpZGVDb2wiLCBbbiwgdGhpcy5uYW1lLCBxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMCA9PT0gZyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghMCAhPT0gZC5wLnNocmlua1RvRml0IHx8IGlzTmFOKGQucC5oZWlnaHQpIHx8IChkLnAudGJsd2lkdGggKz0gcGFyc2VJbnQoZC5wLnNjcm9sbE9mZnNldCwgMTApKSwgYShkKS5qcUdyaWQoInNldEdyaWRXaWR0aCIsICEwID09PSBkLnAuc2hyaW5rVG9GaXQgPyBkLnAudGJsd2lkdGggOiBkLnAud2lkdGgpKSwgQikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBhLmV4dGVuZChbXSwgZC5wLmdyb3VwSGVhZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuZ3JvdXBIZWFkZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgQi5sZW5ndGg7IHIrKykgYShkKS5qcUdyaWQoInNldEdyb3VwSGVhZGVycyIsIEJbcl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhpZGVDb2w6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmpxR3JpZCgic2hvd0hpZGVDb2wiLCBiLCAibm9uZSIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzaG93Q29sOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5qcUdyaWQoInNob3dIaWRlQ29sIiwgYiwgIiIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZW1hcENvbHVtbnM6IGZ1bmN0aW9uKGIsIGMsIGgpIHsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBkKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBjLmxlbmd0aCA/IGEubWFrZUFycmF5KGMpIDogYS5leHRlbmQoe30sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goYiwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY1thXSA9IGVbdGhpc10KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGcoYywgZSkgewogICAgICAgICAgICAgICAgICAgICAgICBhKCI+dHIiICsgKGUgfHwgIiIpLCBjKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBhLm1ha2VBcnJheShjLmNlbGxzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGVbdGhpc107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiBjLmFwcGVuZENoaWxkKGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuZ2V0KDApOwogICAgICAgICAgICAgICAgICAgIGQoZS5wLmNvbE1vZGVsKTsKICAgICAgICAgICAgICAgICAgICBkKGUucC5jb2xOYW1lcyk7CiAgICAgICAgICAgICAgICAgICAgZChlLmdyaWQuaGVhZGVycyk7CiAgICAgICAgICAgICAgICAgICAgZyhhKCJ0aGVhZDpmaXJzdCIsIGUuZ3JpZC5oRGl2KSwgaCAmJiAiOm5vdCgudWktanFncmlkLWxhYmVscykiKTsKICAgICAgICAgICAgICAgICAgICBjICYmIGcoYSgiIyIgKyBhLmpncmlkLmpxSUQoZS5wLmlkKSArICIgdGJvZHk6Zmlyc3QiKSwgIi5qcWdmaXJzdHJvdywgdHIuanFncm93LCB0ci5qcWZvb3QiKTsKICAgICAgICAgICAgICAgICAgICBlLnAuZm9vdGVycm93ICYmIGcoYSgidGJvZHk6Zmlyc3QiLCBlLmdyaWQuc0RpdikpOwogICAgICAgICAgICAgICAgICAgIGUucC5yZW1hcENvbHVtbnMgJiYgKGUucC5yZW1hcENvbHVtbnMubGVuZ3RoID8KICAgICAgICAgICAgICAgICAgICAgICAgZChlLnAucmVtYXBDb2x1bW5zKSA6IGUucC5yZW1hcENvbHVtbnMgPSBhLm1ha2VBcnJheShiKSk7CiAgICAgICAgICAgICAgICAgICAgZS5wLmxhc3Rzb3J0ID0gYS5pbkFycmF5KGUucC5sYXN0c29ydCwgYik7CiAgICAgICAgICAgICAgICAgICAgZS5wLnRyZWVHcmlkICYmIChlLnAuZXhwQ29sSW5kID0gYS5pbkFycmF5KGUucC5leHBDb2xJbmQsIGIpKTsKICAgICAgICAgICAgICAgICAgICBhKGUpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRSZW1hcENvbHVtbnMiLCBbYiwgYywgaF0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2V0R3JpZFdpZHRoOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGQsIGcsIGUsIG4gPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBhLmpncmlkLmNlbGxfd2lkdGggPyAwIDogbi5wLmNlbGxMYXlvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBuLnAuc2Nyb2xsT2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJib29sZWFuIiAhPSB0eXBlb2YgYyAmJiAoYyA9IG4ucC5zaHJpbmtUb0ZpdCksICFpc05hTihiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gcGFyc2VJbnQoYiwgMTApLCBuLmdyaWQud2lkdGggPSBuLnAud2lkdGggPSBiLCBhKCIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKG4ucC5pZCkpLmNzcygid2lkdGgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiArICJweCIpLCBhKCIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChuLnAuaWQpKS5jc3MoIndpZHRoIiwgYiArICJweCIpLCBhKG4uZ3JpZC5iRGl2KS5jc3MoIndpZHRoIiwgYiArICJweCIpLCBhKG4uZ3JpZC5oRGl2KS5jc3MoIndpZHRoIiwgYiArICJweCIpLCBuLnAucGFnZXIgJiYgYShuLnAucGFnZXIpLmNzcygid2lkdGgiLCBiICsgInB4IiksIG4ucC50b3BwYWdlciAmJiBhKG4ucC50b3BwYWdlcikuY3NzKCJ3aWR0aCIsIGIgKyAicHgiKSwgITAgPT09IG4ucC50b29sYmFyWzBdICYmIChhKG4uZ3JpZC51RGl2KS5jc3MoIndpZHRoIiwgYiArICJweCIpLCAiYm90aCIgPT09IG4ucC50b29sYmFyWzFdICYmIGEobi5ncmlkLnViRGl2KS5jc3MoIndpZHRoIiwgYiArICJweCIpKSwgbi5wLmZvb3RlcnJvdyAmJiBhKG4uZ3JpZC5zRGl2KS5jc3MoIndpZHRoIiwgYiArICJweCIpLCAhMSA9PT0gYyAmJiAhMCA9PT0gbi5wLmZvcmNlRml0ICYmIChuLnAuZm9yY2VGaXQgPSAhMSksICEwID09PSBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmVhY2gobi5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSA9PT0gdGhpcy5oaWRkZW4gJiYgKGggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoT3JnLCBCICs9IGggKyByLCB0aGlzLmZpeGVkID8geSArPSBoICsgciA6IHErKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAwID09PSBxKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ucC50Ymx3aWR0aCA9IEI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBiIC0gciAqIHEgLSB5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc05hTihuLnAuaGVpZ2h0KSB8fCAoYShuLmdyaWQuYkRpdilbMF0uY2xpZW50SGVpZ2h0IDwgYShuLmdyaWQuYkRpdilbMF0uc2Nyb2xsSGVpZ2h0IHx8IDEgPT09IG4ucm93cy5sZW5ndGgpICYmICh1ID0gITAsIGcgLT0gayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBCID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAwIDwgbi5ncmlkLmNvbHMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5lYWNoKG4ucC5jb2xNb2RlbCwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICExICE9PSB0aGlzLmhpZGRlbiB8fCB0aGlzLmZpeGVkIHx8IChoID0gdGhpcy53aWR0aE9yZywgaCA9IE1hdGgucm91bmQoZyAqIGggLyAobi5wLnRibHdpZHRoIC0gciAqIHEgLSB5KSksIDAgPiBoKSB8fCAodGhpcy53aWR0aCA9IGgsIEIgKz0gaCwgbi5ncmlkLmhlYWRlcnNbYV0ud2lkdGggPSBoLCBuLmdyaWQuaGVhZGVyc1thXS5lbC5zdHlsZS53aWR0aCA9IGggKyAicHgiLCBuLnAuZm9vdGVycm93ICYmIChuLmdyaWQuZm9vdGVyc1thXS5zdHlsZS53aWR0aCA9IGggKyAicHgiKSwgSyAmJiAobi5ncmlkLmNvbHNbYV0uc3R5bGUud2lkdGggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoICsgInB4IiksIGQgPSBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksICFkKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlID0gMCwgdSA/IGIgLSB5IC0gKEIgKyByICogcSkgIT09IGsgJiYgKGUgPSBiIC0geSAtIChCICsgciAqIHEpIC0gaykgOiAxICE9PSBNYXRoLmFicyhiIC0geSAtIChCICsgciAqIHEpKSAmJiAoZSA9IGIgLSB5IC0gKEIgKyByICogcSkpLCBuLnAuY29sTW9kZWxbZF0ud2lkdGggKz0gZSwgbi5wLnRibHdpZHRoID0gQiArIGUgKyByICogcSArIHksIG4ucC50Ymx3aWR0aCA+IGIpID8gKGUgPSBuLnAudGJsd2lkdGggLSBwYXJzZUludChiLCAxMCksIG4ucC50Ymx3aWR0aCA9IGIsIGggPSBuLnAuY29sTW9kZWxbZF0ud2lkdGggLT0gZSkgOiBoID0gbi5wLmNvbE1vZGVsW2RdLndpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmdyaWQuaGVhZGVyc1tkXS53aWR0aCA9IGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uZ3JpZC5oZWFkZXJzW2RdLmVsLnN0eWxlLndpZHRoID0gaCArICJweCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgJiYgKG4uZ3JpZC5jb2xzW2RdLnN0eWxlLndpZHRoID0gaCArICJweCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnAuZm9vdGVycm93ICYmIChuLmdyaWQuZm9vdGVyc1tkXS5zdHlsZS53aWR0aCA9IGggKyAicHgiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnAudGJsd2lkdGggJiYgKGEoInRhYmxlOmZpcnN0Iiwgbi5ncmlkLmJEaXYpLmNzcygid2lkdGgiLCBuLnAudGJsd2lkdGggKyAicHgiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGFibGU6Zmlyc3QiLCBuLmdyaWQuaERpdikuY3NzKCJ3aWR0aCIsIG4ucC50Ymx3aWR0aCArICJweCIpLCBuLmdyaWQuaERpdi5zY3JvbGxMZWZ0ID0gbi5ncmlkLmJEaXYuc2Nyb2xsTGVmdCwgbi5wLmZvb3RlcnJvdyAmJiBhKCJ0YWJsZTpmaXJzdCIsIG4uZ3JpZC5zRGl2KS5jc3MoIndpZHRoIiwgbi5wLnRibHdpZHRoICsgInB4IikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldEdyaWRIZWlnaHQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcy5ncmlkLmJEaXYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYiArIChpc05hTihiKSA/ICIiIDogInB4IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IHRoaXMucC5mcm96ZW5Db2x1bW5zICYmIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkgKyAiX2Zyb3plbiIpLnBhcmVudCgpLmhlaWdodChjLmhlaWdodCgpIC0gMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmhlaWdodCA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuc2Nyb2xsICYmIHRoaXMuZ3JpZC5wb3B1bGF0ZVZpc2libGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXRDYXB0aW9uOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5qcUdyaWQoImdldFN0eWxlVUkiLCB0aGlzLnAuc3R5bGVVSSArICIuY29tbW9uIiwgImNvcm5lcnRvcCIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmNhcHRpb24gPSBiOwogICAgICAgICAgICAgICAgICAgICAgICBhKCIudWktanFncmlkLXRpdGxlLCAudWktanFncmlkLXRpdGxlLXJ0bCIsIHRoaXMuZ3JpZC5jRGl2KS5odG1sKGIpOwogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMuZ3JpZC5jRGl2KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcy5ncmlkLmhEaXYpLnJlbW92ZUNsYXNzKGMpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXRMYWJlbDogZnVuY3Rpb24oYiwgYywgaCwgZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgdm9pZCAwICE9PSBiICYmIChhKHRoaXMucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gYiA/IChnID0gYSwgITEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgMCA8PSBnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhKCJ0ci51aS1qcWdyaWQtbGFiZWxzIHRoOmVxKCIgKyBnICsgIikiLCB0aGlzLmdyaWQuaERpdik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gYSgiLnMtaWNvIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiW2lkXj1qcWdoX10iLCBlKS5lbXB0eSgpLmh0bWwoYykuYXBwZW5kKG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5jb2xOYW1lc1tnXSA9IGMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggJiYgKCJzdHJpbmciID09IHR5cGVvZiBoID8gYShlKS5hZGRDbGFzcyhoKSA6IGEoZSkuY3NzKGgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBkICYmIGEoZSkuYXR0cihkKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXRDZWxsOiBmdW5jdGlvbihiLCBjLCBoLCBkLCBnLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4sIEIsIHIgPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiAoaXNOYU4oYykgPyBhKHRoaXMucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gYyA/IChyID0gYSwgITEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IHIgPSBwYXJzZUludChjLCAxMCksIDAgPD0gcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gYSh0aGlzKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gYSgidGQ6ZXEoIiArIHIgKyAiKSIsIHEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiIiAhPT0gaCB8fCAhMCA9PT0gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBxLmNlbGxzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGsgPCBxLmNlbGxzLmxlbmd0aDspIHkucHVzaChxLmNlbGxzW2tdLmlubmVySFRNTCksIGsrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4gPSB0aGlzLmZvcm1hdHRlcihiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgsIHIsIHksICJlZGl0IiksIEIgPSB0aGlzLnAuY29sTW9kZWxbcl0udGl0bGUgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGEuamdyaWQuc3RyaXBIdG1sKG4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IDoge30sIHRoaXMucC50cmVlR3JpZCAmJiAwIDwgYSgiLnRyZWUtd3JhcCIsIGEodSkpLmxlbmd0aCA/IGEoInNwYW4iLCBhKHUpKS5odG1sKG4pLmF0dHIoQikgOiBhKHUpLmh0bWwobikuYXR0cihCKSwgImxvY2FsIiA9PT0gdGhpcy5wLmRhdGF0eXBlKSBCID0gdGhpcy5wLmNvbE1vZGVsW3JdLCBoID0gQi5mb3JtYXR0ZXIgJiYgInN0cmluZyIgPT0gdHlwZW9mIEIuZm9ybWF0dGVyICYmICJkYXRlIiA9PT0gQi5mb3JtYXR0ZXIgPyBhLnVuZm9ybWF0LmRhdGUuY2FsbCh0aGlzLCBoLCBCKSA6IGgsIG4gPSB0aGlzLnAuX2luZGV4W2EuamdyaWQuc3RyaXBQcmVmKHRoaXMucC5pZFByZWZpeCwgYildLCB2b2lkIDAgIT09IG4gJiYgKHRoaXMucC5kYXRhW25dW0IubmFtZV0gPSBoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgZCA/IGEodSkuYWRkQ2xhc3MoZCkgOiBkICYmIGEodSkuY3NzKGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBnICYmIGEodSkuYXR0cihnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRDZWxsOiBmdW5jdGlvbihiLAogICAgICAgICAgICAgICAgICAgIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaCA9ICExOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgKGlzTmFOKGMpID8gYSh0aGlzLnAuY29sTW9kZWwpLmVhY2goZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUgPT09IGMgPyAoZCA9IGEsICExKSA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBkID0gcGFyc2VJbnQoYywgMTApLCAwIDw9IGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEodGhpcykuanFHcmlkKCJnZXRHcmlkUm93QnlJZCIsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEudW5mb3JtYXQuY2FsbCh0aGlzLCBhKCJ0ZDplcSgiICsgZCArICIpIiwgZyksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGcuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiB0aGlzLnAuY29sTW9kZWxbZF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhLmpncmlkLmh0bWxEZWNvZGUoYSgidGQ6ZXEoIiArIGQgKyAiKSIsIGcpLmh0bWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLCBoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0Q29sOiBmdW5jdGlvbihiLCBjLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcsIGUsIG4sIEIgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPSAiYm9vbGVhbiIgIT0gdHlwZW9mIGMgPyAhMSA6IGMsIHZvaWQgMCA9PT0gaCAmJiAoaCA9ICExKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIChpc05hTihiKSA/IGEodGhpcy5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSBiID8gKHEgPSBhLCAhMSkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogcSA9IHBhcnNlSW50KGIsIDEwKSwgMCA8PSBxKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSB0aGlzLnJvd3MubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUgJiYgMCA8IHUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgdSA+IGs7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKHRoaXMucm93c1trXSkuaGFzQ2xhc3MoImpxZ3JvdyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhLnVuZm9ybWF0LmNhbGwodGhpcywgYSh0aGlzLnJvd3Nba10uY2VsbHNbcV0pLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiB0aGlzLnJvd3Nba10uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiB0aGlzLnAuY29sTW9kZWxbcV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhLmpncmlkLmh0bWxEZWNvZGUodGhpcy5yb3dzW2tdLmNlbGxzW3FdLmlubmVySFRNTCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPyAobiA9IHBhcnNlRmxvYXQoZCksIGlzTmFOKG4pIHx8IChyICs9IG4sIHZvaWQgMCA9PT0gZSAmJiAoZSA9IGcgPSBuKSwgZyA9IE1hdGgubWluKGcsIG4pLCBlID0gTWF0aC5tYXgoZSwgbiksIHkrKykpIDogQi5wdXNoKGMgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMucm93c1trXS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaysrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoKSBzd2l0Y2ggKGgudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdW0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IHI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYXZnIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSByIC8geTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb3VudCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gdSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibWluIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1heCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLCBCCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xlYXJHcmlkRGF0YTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiYm9vbGVhbiIgIT0gdHlwZW9mIGIgJiYgKGIgPSAhMSksIHRoaXMucC5kZWVwZW1wdHkpIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkgKyAiIHRib2R5OmZpcnN0IHRyOmd0KDApIikucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkgKyAiIHRib2R5OmZpcnN0IHRyOmZpcnN0IilbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQodGhpcy5wLmlkKSArICIgdGJvZHk6Zmlyc3QiKS5lbXB0eSgpLmFwcGVuZChjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmZvb3RlcnJvdyAmJiBiICYmIGEoIi51aS1qcWdyaWQtZnRhYmxlIHRkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuc0RpdikuaHRtbCgiJiMxNjA7Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuc2Vscm93ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5zZWxhcnJyb3cgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5zYXZlZFJvdyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLnJlY29yZHMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLnBhZ2UgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmxhc3RwYWdlID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5yZWNjb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLl9pbmRleCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVwYWdlcighMCwgITEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldEluZDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBoLCBkID0gITE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgKGggPSBhKHRoaXMpLmpxR3JpZCgiZ2V0R3JpZFJvd0J5SWQiLCBiKSkgJiYgKGQgPSAhMCA9PT0gYyA/IGggOiBoLnJvd0luZGV4KQogICAgICAgICAgICAgICAgICAgIH0pLCBkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmluZEtleXM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgb25FbnRlcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgb25TcGFjZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgb25MZWZ0S2V5OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBvblJpZ2h0S2V5OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxpbmdSb3dzOiAhMAogICAgICAgICAgICAgICAgICAgIH0sIGIgfHwge30pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgYSgiYm9keSIpLmlzKCJbcm9sZV0iKSB8fCBhKCJib2R5IikuYXR0cigicm9sZSIsICJhcHBsaWNhdGlvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBiLnAuc2Nyb2xscm93cyA9IGMuc2Nyb2xsaW5nUm93czsKICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5rZXlkb3duKGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBlLCBnLCBCID0gYShiKS5maW5kKCJ0clt0YWJpbmRleD0wXSIpWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBiLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChCKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0gYi5wLl9pbmRleFthLmpncmlkLnN0cmlwUHJlZihiLnAuaWRQcmVmaXgsIEIuaWQpXSwgMzcgPT09IGYua2V5Q29kZSB8fCAzOCA9PT0gZi5rZXlDb2RlIHx8IDM5ID09PSBmLmtleUNvZGUgfHwgNDAgPT09IGYua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMzggPT09IGYua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBCLnByZXZpb3VzU2libGluZywgZCA9ICIiLCBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKGUpLmlzKCI6aGlkZGVuIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBlOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBlLnByZXZpb3VzU2libGluZywgIWEoZSkuaXMoIjpoaWRkZW4iKSAmJiBhKGUpLmhhc0NsYXNzKCJqcWdyb3ciKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBlLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBkID0gZS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYikuanFHcmlkKCJzZXRTZWxlY3Rpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQsICEwLCBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICg0MCA9PT0gZi5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IEIubmV4dFNpYmxpbmcsIGQgPSAiIiwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShlKS5pcygiOmhpZGRlbiIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgZTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0gZS5uZXh0U2libGluZywgIWEoZSkuaXMoIjpoaWRkZW4iKSAmJiBhKGUpLmhhc0NsYXNzKCJqcWdyb3ciKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBlLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBkID0gZS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYikuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBkLCAhMCwgZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzNyA9PT0gZi5rZXlDb2RlICYmIChiLnAudHJlZUdyaWQgJiYgYi5wLmRhdGFbZ11bcl0gJiYgYShCKS5maW5kKCJkaXYudHJlZWNsaWNrIikudHJpZ2dlcigiY2xpY2siKSwgYShiKS50cmlnZ2VySGFuZGxlcigianFHcmlkS2V5TGVmdCIsIFtiLnAuc2Vscm93XSksIGEuaXNGdW5jdGlvbihjLm9uTGVmdEtleSkgJiYgYy5vbkxlZnRLZXkuY2FsbChiLCBiLnAuc2Vscm93KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDM5ID09PSBmLmtleUNvZGUgJiYgKGIucC50cmVlR3JpZCAmJiAhYi5wLmRhdGFbZ11bcl0gJiYgYShCKS5maW5kKCJkaXYudHJlZWNsaWNrIikudHJpZ2dlcigiY2xpY2siKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYikudHJpZ2dlckhhbmRsZXIoImpxR3JpZEtleVJpZ2h0IiwgW2IucC5zZWxyb3ddKSwgYS5pc0Z1bmN0aW9uKGMub25SaWdodEtleSkgJiYgYy5vblJpZ2h0S2V5LmNhbGwoYiwgYi5wLnNlbHJvdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIDEzID09PSBmLmtleUNvZGUgPyAoYShiKS50cmlnZ2VySGFuZGxlcigianFHcmlkS2V5RW50ZXIiLCBbYi5wLnNlbHJvd10pLCBhLmlzRnVuY3Rpb24oYy5vbkVudGVyKSAmJiBjLm9uRW50ZXIuY2FsbChiLCBiLnAuc2Vscm93KSkgOiAzMiA9PT0gZi5rZXlDb2RlICYmIChhKGIpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRLZXlTcGFjZSIsIFtiLnAuc2Vscm93XSksIGEuaXNGdW5jdGlvbihjLm9uU3BhY2UpICYmIGMub25TcGFjZS5jYWxsKGIsIGIucC5zZWxyb3cpKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdW5iaW5kS2V5czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS51bmJpbmQoImtleWRvd24iKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0TG9jYWxSb3c6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgaCA9ICExOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgKGMgPSB0aGlzLnAuX2luZGV4W2EuamdyaWQuc3RyaXBQcmVmKHRoaXMucC5pZFByZWZpeCwgYildLCAwIDw9IGMgJiYgKGggPSB0aGlzLnAuZGF0YVtjXSkpCiAgICAgICAgICAgICAgICAgICAgfSksIGgKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICBodG1sY29udGVudDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogImhpZGUiLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkdHlwZTogImRpc2FibGUiCiAgICAgICAgICAgICAgICAgICAgfSwgYiB8fCB7fSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGgsIGQgPSAic2hvdyIgPT09IGIubWV0aG9kID8gITAgOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhKCIjbG9hZF8iICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEod2luZG93KS5zY3JvbGxUb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgiIiAhPT0gYi5odG1sY29udGVudCAmJiBnLmh0bWwoYi5odG1sY29udGVudCksIGIubG9hZHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy50b2dnbGUoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJibG9jayI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2x1aV8iICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkpLnRvZ2dsZShkKSwgZy50b2dnbGUoZCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBnLmlzKCI6dmlzaWJsZSIpICYmIChjID0gZy5vZmZzZXRQYXJlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuY3NzKCJ0b3AiLCAiIiksIGcub2Zmc2V0KCkudG9wIDwgZSAmJiAoaCA9IE1hdGgubWluKDEwICsgZSAtIGMub2Zmc2V0KCkudG9wLCBjLmhlaWdodCgpIC0gZy5oZWlnaHQoKSksIGcuY3NzKCJ0b3AiLCBoICsgInB4IikpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0Q29sUHJvcDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzWzBdOwogICAgICAgICAgICAgICAgICAgIGlmICghYy5ncmlkKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IGMucC5jb2xNb2RlbCwgYyA9IDA7IGMgPCBkLmxlbmd0aDsgYysrKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZFtjXS5uYW1lID09PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gZFtjXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldENvbFByb3A6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoLCBkID0gdGhpcy5wLmNvbE1vZGVsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gMDsgaCA8IGQubGVuZ3RoOyBoKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRbaF0ubmFtZSA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4dGVuZCghMCwgdGhpcy5wLmNvbE1vZGVsW2hdLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNvcnRHcmlkOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSB8fCAoYSA9IHRoaXMucC5zb3J0bmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSAwOyBkIDwgdGhpcy5wLmNvbE1vZGVsLmxlbmd0aDsgZCsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnAuY29sTW9kZWxbZF0uaW5kZXggPT09IGEgfHwgdGhpcy5wLmNvbE1vZGVsW2RdLm5hbWUgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSB0aGlzLnAuZnJvemVuQ29sdW1ucyAmJiAhMCA9PT0gdGhpcy5wLmNvbE1vZGVsW2RdLmZyb3plbiAmJiAoZSA9IHRoaXMuZ3JpZC5maERpdi5maW5kKCIjIiArIHRoaXMucC5pZCArICJfIiArIGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IC0gMSAhPT0gZyAmJiAoZCA9IHRoaXMucC5jb2xNb2RlbFtnXS5zb3J0YWJsZSwgZSB8fCAoZSA9IHRoaXMuZ3JpZC5oZWFkZXJzW2ddLmVsKSwgImJvb2xlYW4iICE9IHR5cGVvZiBkICYmIChkID0gITApLCAiYm9vbGVhbiIgIT0gdHlwZW9mIGIgJiYgKGIgPSAhMSksIGQgJiYgdGhpcy5zb3J0RGF0YSgianFnaF8iICsgdGhpcy5wLmlkICsgIl8iICsgYSwgZywgYiwgYywgZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldEdyaWRTdGF0ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmpxR3JpZCgiZ2V0U3R5bGVVSSIsIHRoaXMucC5zdHlsZVVJICsgIi5iYXNlIiwgImljb25fY2FwdGlvbl9vcGVuIiwgITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhKHRoaXMpLmpxR3JpZCgiZ2V0U3R5bGVVSSIsIHRoaXMucC5zdHlsZVVJICsgIi5iYXNlIiwgImljb25fY2FwdGlvbl9jbG9zZSIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJoaWRkZW4iID09PSBiID8gKGEoIi51aS1qcWdyaWQtYmRpdiwgLnVpLWpxZ3JpZC1oZGl2IiwgIiNndmlld18iICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkpLnNsaWRlVXAoImZhc3QiKSwgdGhpcy5wLnBhZ2VyICYmIGEodGhpcy5wLnBhZ2VyKS5zbGlkZVVwKCJmYXN0IiksIHRoaXMucC50b3BwYWdlciAmJiBhKHRoaXMucC50b3BwYWdlcikuc2xpZGVVcCgiZmFzdCIpLCAhMCA9PT0gdGhpcy5wLnRvb2xiYXJbMF0gJiYgKCJib3RoIiA9PT0gdGhpcy5wLnRvb2xiYXJbMV0gJiYgYSh0aGlzLmdyaWQudWJEaXYpLnNsaWRlVXAoImZhc3QiKSwgYSh0aGlzLmdyaWQudURpdikuc2xpZGVVcCgiZmFzdCIpKSwgdGhpcy5wLmZvb3RlcnJvdyAmJiBhKCIudWktanFncmlkLXNkaXYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkpLnNsaWRlVXAoImZhc3QiKSwgYSgiLnVpLWpxZ3JpZC1oZWFkbGluayIsIHRoaXMuZ3JpZC5jRGl2KS5yZW1vdmVDbGFzcyhjKS5hZGRDbGFzcyhoKSwgdGhpcy5wLmdyaWRzdGF0ZSA9ICJoaWRkZW4iKSA6ICJ2aXNpYmxlIiA9PT0gYiAmJiAoYSgiLnVpLWpxZ3JpZC1oZGl2LCAudWktanFncmlkLWJkaXYiLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQodGhpcy5wLmlkKSkuc2xpZGVEb3duKCJmYXN0IiksIHRoaXMucC5wYWdlciAmJiBhKHRoaXMucC5wYWdlcikuc2xpZGVEb3duKCJmYXN0IiksIHRoaXMucC50b3BwYWdlciAmJiBhKHRoaXMucC50b3BwYWdlcikuc2xpZGVEb3duKCJmYXN0IiksICEwID09PSB0aGlzLnAudG9vbGJhclswXSAmJiAoImJvdGgiID09PSB0aGlzLnAudG9vbGJhclsxXSAmJiBhKHRoaXMuZ3JpZC51YkRpdikuc2xpZGVEb3duKCJmYXN0IiksIGEodGhpcy5ncmlkLnVEaXYpLnNsaWRlRG93bigiZmFzdCIpKSwgdGhpcy5wLmZvb3RlcnJvdyAmJiBhKCIudWktanFncmlkLXNkaXYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkpLnNsaWRlRG93bigiZmFzdCIpLCBhKCIudWktanFncmlkLWhlYWRsaW5rIiwgdGhpcy5ncmlkLmNEaXYpLnJlbW92ZUNsYXNzKGgpLmFkZENsYXNzKGMpLCB0aGlzLnAuZ3JpZHN0YXRlID0gInZpc2libGUiKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXRGcm96ZW5Db2x1bW5zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIucC5jb2xNb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gYShiKS5qcUdyaWQoImdldFN0eWxlVUkiLCBiLnAuc3R5bGVVSSArICIuYmFzZSIsICJoZWFkZXJEaXYiLCAhMCwgInVpLWpxZ3JpZC1oZGl2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IGEoYikuanFHcmlkKCJnZXRTdHlsZVVJIiwgYi5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJob3ZlciIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCAhPT0gYi5wLnN1YkdyaWQgJiYgITAgIT09IGIucC50cmVlR3JpZCAmJiAhMCAhPT0gYi5wLmNlbGxFZGl0ICYmICFiLnAuc29ydGFibGUgJiYgIWIucC5zY3JvbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnAucm93bnVtYmVycyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiLnAubXVsdGlzZWxlY3QgJiYgaCsrOyBkID4gaCAmJiAhMCA9PT0gY1toXS5mcm96ZW47KSBlID0gITAsIGcgPSBoLCBoKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPD0gZyAmJiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLnAuY2FwdGlvbiA/IGEoYi5ncmlkLmNEaXYpLm91dGVySGVpZ2h0KCkgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYSgiLnVpLWpxZ3JpZC1odGFibGUiLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIucC50b3BwYWdlciAmJiAoYyArPSBhKGIuZ3JpZC50b3BEaXYpLm91dGVySGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYi5wLnRvb2xiYXJbMF0gJiYgImJvdHRvbSIgIT09IGIucC50b29sYmFyWzFdICYmIChjICs9IGEoYi5ncmlkLnVEaXYpLm91dGVySGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmdyaWQuZmhEaXYgPSBhKCc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsnICsgKCJydGwiID09PSBiLnAuZGlyZWN0aW9uID8gInJpZ2h0OjA7IiA6ICJsZWZ0OjA7IikgKyAidG9wOiIgKyBjICsgInB4O2hlaWdodDoiICsgaCArICdweDsiIGNsYXNzPSJmcm96ZW4tZGl2ICcgKyBuICsgJyI+PC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZ3JpZC5mYkRpdiA9IGEoJzxkaXYgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOycgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJydGwiID09PSBiLnAuZGlyZWN0aW9uID8gInJpZ2h0OjA7IiA6ICJsZWZ0OjA7IikgKyAidG9wOiIgKyAocGFyc2VJbnQoYywgMTApICsgcGFyc2VJbnQoaCwgMTApICsgMSkgKyAncHg7b3ZlcmZsb3cteTpoaWRkZW4iIGNsYXNzPSJmcm96ZW4tYmRpdiB1aS1qcWdyaWQtYmRpdiI+PC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNndmlld18iICsgYS5qZ3JpZC5qcUlEKGIucC5pZCkpLmFwcGVuZChiLmdyaWQuZmhEaXYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gYSgiLnVpLWpxZ3JpZC1odGFibGUiLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkuY2xvbmUoITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5wLmdyb3VwSGVhZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ci5qcWctZmlyc3Qtcm93LWhlYWRlciwgdHIuanFnLXRoaXJkLXJvdy1oZWFkZXIiLCBuKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRoOmd0KCIgKyBnICsgIikiLCB0aGlzKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciwgcSwgdSA9IC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRyLmpxZy1zZWNvbmQtcm93LWhlYWRlciB0aCIsIG4pLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgPSBwYXJzZUludChhKHRoaXMpLmF0dHIoImNvbHNwYW4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTApLCBxID0gcGFyc2VJbnQoYSh0aGlzKS5hdHRyKCJyb3dzcGFuIiksIDEwKSwgcSAmJiAodSsrLCBrKyspLCByICYmICh1ICs9IHIsIGsrKyksIHUgPT09IGcgPyAoayA9IGcsICExKSA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ICE9PSBnICYmIChrID0gZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ci5qcWctc2Vjb25kLXJvdy1oZWFkZXIiLCBuKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRoOmd0KCIgKyBrICsgIikiLCB0aGlzKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEoInRyIiwgbikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRoOmd0KCIgKyBnICsgIikiLCB0aGlzKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEobikud2lkdGgoMSksIGEoYi5ncmlkLmZoRGl2KS5hcHBlbmQobikubW91c2Vtb3ZlKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi5ncmlkLnJlc2l6aW5nID8gKGIuZ3JpZC5kcmFnTW92ZShhKSwgITEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYi5wLmZvb3RlcnJvdykgbiA9IGEoIi51aS1qcWdyaWQtYmRpdiIsICIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChiLnAuaWQpKS5oZWlnaHQoKSwgYi5ncmlkLmZzRGl2ID0gYSgnPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7bGVmdDowcHg7dG9wOicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBhcnNlSW50KGMsIDEwKSArIHBhcnNlSW50KGgsIDEwKSArIHBhcnNlSW50KG4sIDEwKSArIDEpICsgJ3B4OyIgY2xhc3M9ImZyb3plbi1zZGl2IHVpLWpxZ3JpZC1zZGl2Ij48L2Rpdj4nKSwgYSgiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkuYXBwZW5kKGIuZ3JpZC5mc0RpdiksIG4gPSBhKCIudWktanFncmlkLWZ0YWJsZSIsICIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChiLnAuaWQpKS5jbG9uZSghMCksIGEoInRyIiwgbikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRkOmd0KCIgKyBnICsgIikiLCB0aGlzKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYShuKS53aWR0aCgxKSwgYShiLmdyaWQuZnNEaXYpLmFwcGVuZChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5iaW5kKCJqcUdyaWRSZXNpemVTdG9wLnNldEZyb3plbkNvbHVtbnMiLCBmdW5jdGlvbihjLCBlLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgiLnVpLWpxZ3JpZC1odGFibGUiLCBiLmdyaWQuZmhEaXYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGg6ZXEoIiArIGggKyAiKSIsIGMpLndpZHRoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEoIi51aS1qcWdyaWQtYnRhYmxlIiwgYi5ncmlkLmZiRGl2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKCJ0cjpmaXJzdCB0ZDplcSgiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCArICIpIiwgYykud2lkdGgoZSksIGIucC5mb290ZXJyb3cpIGMgPSBhKCIudWktanFncmlkLWZ0YWJsZSIsIGIuZ3JpZC5mc0RpdiksIGEoInRyOmZpcnN0IHRkOmVxKCIgKyBoICsgIikiLCBjKS53aWR0aChlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkuYXBwZW5kKGIuZ3JpZC5mYkRpdik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5ncmlkLmZiRGl2KS5iaW5kKCJtb3VzZXdoZWVsIERPTU1vdXNlU2Nyb2xsIiwgZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhKGIuZ3JpZC5iRGl2KS5zY3JvbGxUb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5ncmlkLmJEaXYpLnNjcm9sbFRvcCgwIDwgYy5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgfHwgMCA+IGMub3JpZ2luYWxFdmVudC5kZXRhaWwgPyBlIC0gMjUgOiBlICsgMjUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYi5wLmhvdmVycm93cyAmJiBhKCIjIiArIGEuamdyaWQuanFJRChiLnAuaWQpKS51bmJpbmQoIm1vdXNlb3ZlciIpLnVuYmluZCgibW91c2VvdXQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5iaW5kKCJqcUdyaWRBZnRlckdyaWRDb21wbGV0ZS5zZXRGcm96ZW5Db2x1bW5zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGIucC5pZCkgKyAiX2Zyb3plbiIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5ncmlkLmZiRGl2KS5oZWlnaHQoYShiLmdyaWQuYkRpdikuaGVpZ2h0KCkgLSAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKCIjIiArIGEuamdyaWQuanFJRChiLnAuaWQpKS5jbG9uZSghMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidHJbcm9sZT1yb3ddIiwgYykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGRbcm9sZT1ncmlkY2VsbF06Z3QoIiArIGcgKyAiKSIsIHRoaXMpLnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS53aWR0aCgxKS5hdHRyKCJpZCIsIGIucC5pZCArICJfZnJvemVuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiLmdyaWQuZmJEaXYpLmFwcGVuZChjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYi5wLmhvdmVycm93cyAmJiAoYSgidHIuanFncm93IiwgYykuaG92ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYWRkQ2xhc3MoQik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpLCAiIyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkuYWRkQ2xhc3MoQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcyhCKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQodGhpcy5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSkucmVtb3ZlQ2xhc3MoQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgidHIuanFncm93IiwgIiMiICsgYS5qZ3JpZC5qcUlEKGIucC5pZCkpLmhvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKEIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGEuamdyaWQuanFJRCh0aGlzLmlkKSwgIiMiICsgYS5qZ3JpZC5qcUlEKGIucC5pZCkgKyAiX2Zyb3plbiIpLmFkZENsYXNzKEIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoQik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpLCAiIyIgKyBhLmpncmlkLmpxSUQoYi5wLmlkKSArICJfZnJvemVuIikucmVtb3ZlQ2xhc3MoQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmdyaWQuaERpdi5sb2FkaW5nIHx8IGEoYikudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFmdGVyR3JpZENvbXBsZXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIucC5mcm96ZW5Db2x1bW5zID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlc3Ryb3lGcm96ZW5Db2x1bW5zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmICEwID09PSB0aGlzLnAuZnJvemVuQ29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuanFHcmlkKCJnZXRTdHlsZVVJIiwgdGhpcy5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJob3ZlciIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKHRoaXMuZ3JpZC5maERpdikucmVtb3ZlKCksIGEodGhpcy5ncmlkLmZiRGl2KS5yZW1vdmUoKSwgdGhpcy5ncmlkLmZoRGl2ID0gbnVsbCwgdGhpcy5ncmlkLmZiRGl2ID0gbnVsbCwgdGhpcy5wLmZvb3RlcnJvdyAmJiAoYSh0aGlzLmdyaWQuZnNEaXYpLnJlbW92ZSgpLCB0aGlzLmdyaWQuZnNEaXYgPSBudWxsKSwgYSh0aGlzKS51bmJpbmQoIi5zZXRGcm96ZW5Db2x1bW5zIiksICEwID09PSB0aGlzLnAuaG92ZXJyb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQodGhpcy5wLmlkKSkuYmluZCgibW91c2VvdmVyIiwgZnVuY3Rpb24oaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYShoLnRhcmdldCkuY2xvc2VzdCgidHIuanFncm93Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1aS1zdWJncmlkIiAhPT0gYShjKS5hdHRyKCJjbGFzcyIpICYmIGEoYykuYWRkQ2xhc3MoYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKCJtb3VzZW91dCIsIGZ1bmN0aW9uKGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEoaC50YXJnZXQpLmNsb3Nlc3QoInRyLmpxZ3JvdyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGMpLnJlbW92ZUNsYXNzKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5mcm96ZW5Db2x1bW5zID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzaXplQ29sdW1uOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGcgPSB0aGlzLmdyaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGUuY29sTW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gbi5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IEIgPiBjOyBjKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobltjXS5uYW1lID09PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBhID0gcGFyc2VJbnQoYSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IHBhcnNlSW50KGIsIDEwKSwgISgibnVtYmVyIiAhPSB0eXBlb2YgYSB8fCAwID4gYSB8fCBhID4gbi5sZW5ndGggLSAxIHx8ICJudW1iZXIiICE9IHR5cGVvZiBiIHx8IGIgPCBlLm1pbkNvbFdpZHRoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuZm9yY2VGaXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlLm52ID0gMCwgYyA9IGEgKyAxOyBCID4gYzsgYysrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgIT09IG5bY10uaGlkZGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm52ID0gYyAtIGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZy5yZXNpemluZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4OiBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYyA9IGIgLSBnLmhlYWRlcnNbYV0ud2lkdGgsIGUuZm9yY2VGaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IGcuaGVhZGVyc1thICsgZS5udl0ud2lkdGggLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLCBkIDwgZS5taW5Db2xXaWR0aCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuaGVhZGVyc1thICsgZS5udl0ubmV3V2lkdGggPSBnLmhlYWRlcnNbYSArIGUubnZdLndpZHRoIC0gYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5uZXdXaWR0aCA9IGUudGJsd2lkdGggKyBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5oZWFkZXJzW2FdLm5ld1dpZHRoID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuZHJhZ0VuZCghMSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0U3R5bGVVSTogZnVuY3Rpb24oYiwgYywgaCwgZCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYi5zcGxpdCgiLiIpOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaCB8fCAoZyA9ICJjbGFzcz0iLCBiID0gJyInKSwgbnVsbCA9PSBkICYmIChkID0gIiIpLCBlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgKz0gYiArIGQgKyAiICIgKyBhLmpncmlkLnN0eWxlVUlbZVswXV1bY10gKyBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgKz0gYiArIGQgKyAiICIgKyBhLmpncmlkLnN0eWxlVUlbZVswXV1bZVsxXV1bY10gKyBiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAiIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS50cmltKGcpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzaXplR3JpZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gNTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHdpbmRvdykud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYSgiI2dib3hfIiArIGEuamdyaWQuanFJRChjLnAuaWQpKS5wYXJlbnQoKS53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjLnAud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IDMgPCBiIC0gZiA/IGYgOiBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQoYy5wLmlkKSkuanFHcmlkKCJzZXRHcmlkV2lkdGgiLCBkKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBiKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLmpncmlkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICBlZGl0Q2VsbDogZnVuY3Rpb24oYiwgYywgaCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnLCBlLCBuLCBCID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0U3R5bGVVSSIsIEIucC5zdHlsZVVJICsgIi5jb21tb24iLCAiaGlnaGxpZ2h0IiwgITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGEodGhpcykuanFHcmlkKCJnZXRTdHlsZVVJIiwgQi5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJob3ZlciIsICEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0U3R5bGVVSSIsIEIucC5zdHlsZVVJICsgIi5jZWxsZWRpdCIsICJpbnB1dENsYXNzIiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQi5ncmlkICYmICEwID09PSBCLnAuY2VsbEVkaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gcGFyc2VJbnQoYywgMTApLCBCLnAuc2Vscm93ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCLnJvd3NbYl0uaWQsIEIucC5rbnYgfHwgYShCKS5qcUdyaWQoIkdyaWROYXYiKSwgMCA8IEIucC5zYXZlZFJvdy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGggJiYgYiA9PSBCLnAuaVJvdyAmJiBjID09IEIucC5pQ29sKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShCKS5qcUdyaWQoInNhdmVDZWxsIiwgQi5wLnNhdmVkUm93WzBdLmlkLCBCLnAuc2F2ZWRSb3dbMF0uaWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQoQi5wLmtudikpLmF0dHIoInRhYmluZGV4IiwgIi0xIikuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobiA9IEIucC5jb2xNb2RlbFtjXSwgZCA9IG4ubmFtZSwgInN1YmdyaWQiICE9PSBkICYmICJjYiIgIT09IGQgJiYgInJuIiAhPT0gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0gYSgidGQ6ZXEoIiArIGMgKyAiKSIsIEIucm93c1tiXSksICEwICE9PSBuLmVkaXRhYmxlIHx8ICEwICE9PSBoIHx8IGUuaGFzQ2xhc3MoIm5vdC1lZGl0YWJsZS1jZWxsIikgfHwgYS5pc0Z1bmN0aW9uKEIucC5pc0NlbGxFZGl0YWJsZSkgJiYgIUIucC5pc0NlbGxFZGl0YWJsZS5jYWxsKEIsIGQsIGIsIGMpKSAwIDw9IHBhcnNlSW50KEIucC5pQ29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCkgJiYgMCA8PSBwYXJzZUludChCLnAuaVJvdywgMTApICYmIGEoQi5yb3dzW0IucC5pUm93XSkucmVtb3ZlQ2xhc3MoInNlbGVjdGVkLXJvdyAiICsgcSkuZmluZCgidGQ6ZXEoIiArIEIucC5pQ29sICsgIikiKS5yZW1vdmVDbGFzcygiZWRpdC1jZWxsICIgKyByKSwgZS5hZGRDbGFzcygiZWRpdC1jZWxsICIgKyByKSwgYShCLnJvd3NbYl0pLmFkZENsYXNzKCJzZWxlY3RlZC1yb3cgIiArIHEpLCBnID0gZS5odG1sKCkucmVwbGFjZSgvXCYjMTYwXDsvZ2ksICIiKSwgYShCKS50cmlnZ2VySGFuZGxlcigianFHcmlkU2VsZWN0Q2VsbCIsIFtCLnJvd3NbYl0uaWQsIGQsIGcsIGIsIGNdKSwgYS5pc0Z1bmN0aW9uKEIucC5vblNlbGVjdENlbGwpICYmIEIucC5vblNlbGVjdENlbGwuY2FsbChCLCBCLnJvd3NbYl0uaWQsIGQsIGcsIGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDw9IHBhcnNlSW50KEIucC5pQ29sLCAxMCkgJiYgMCA8PSBwYXJzZUludChCLnAuaVJvdywgMTApICYmIGEoQi5yb3dzW0IucC5pUm93XSkucmVtb3ZlQ2xhc3MoInNlbGVjdGVkLXJvdyAiICsgcSkuZmluZCgidGQ6ZXEoIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCLnAuaUNvbCArICIpIikucmVtb3ZlQ2xhc3MoImVkaXQtY2VsbCAiICsgcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkuYWRkQ2xhc3MoImVkaXQtY2VsbCAiICsgcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoQi5yb3dzW2JdKS5hZGRDbGFzcygic2VsZWN0ZWQtcm93ICIgKyBxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhLnVuZm9ybWF0LmNhbGwoQiwgZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiBCLnJvd3NbYl0uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTW9kZWw6IG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBuLmVkaXR0eXBlICYmICJ0ZXh0YXJlYSIgPT09IG4uZWRpdHR5cGUgPyBhKGUpLnRleHQoKSA6IGEoZSkuaHRtbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEIucC5hdXRvZW5jb2RlICYmIChnID0gYS5qZ3JpZC5odG1sRGVjb2RlKGcpKSwgbi5lZGl0dHlwZSB8fCAobi5lZGl0dHlwZSA9ICJ0ZXh0IiksIEIucC5zYXZlZFJvdy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpYzogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6IGcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAoIiZuYnNwOyIgPT09IGcgfHwgIiYjMTYwOyIgPT09IGcgfHwgMSA9PT0gZy5sZW5ndGggJiYgMTYwID09PSBnLmNoYXJDb2RlQXQoMCkpICYmIChnID0gIiIpLCBhLmlzRnVuY3Rpb24oQi5wLmZvcm1hdENlbGwpKSByID0gQi5wLmZvcm1hdENlbGwuY2FsbChCLCBCLnJvd3NbYl0uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLCBnLCBiLCBjKSwgdm9pZCAwICE9PSByICYmIChnID0gcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoQikudHJpZ2dlckhhbmRsZXIoImpxR3JpZEJlZm9yZUVkaXRDZWxsIiwgW0Iucm93c1tiXS5pZCwgZCwgZywgYiwgY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oQi5wLmJlZm9yZUVkaXRDZWxsKSAmJiBCLnAuYmVmb3JlRWRpdENlbGwuY2FsbChCLCBCLnJvd3NbYl0uaWQsIGQsIGcsIGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IGEuZXh0ZW5kKHt9LCBuLmVkaXRvcHRpb25zIHx8IHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGIgKyAiXyIgKyBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IEIucm93c1tiXS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAiZWRpdCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IGEuamdyaWQuY3JlYXRlRWwuY2FsbChCLCBuLmVkaXR0eXBlLCByLCBnLCAhMCwgYS5leHRlbmQoe30sIGEuamdyaWQuYWpheE9wdGlvbnMsIEIucC5hamF4U2VsZWN0T3B0aW9ucyB8fCB7fSkpOyAtIDEgPCBhLmluQXJyYXkobi5lZGl0dHlwZSwgWyJ0ZXh0IiwgInRleHRhcmVhIiwgInBhc3N3b3JkIiwgInNlbGVjdCJdKSAmJiBhKHopLmFkZENsYXNzKHUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLmh0bWwoIiIpLmFwcGVuZCh6KS5hdHRyKCJ0YWJpbmRleCIsICIwIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuYmluZEV2LmNhbGwoQiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHosIHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeikuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEiLCBlKS5iaW5kKCJrZXlkb3duIiwgZnVuY3Rpb24oaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDI3ID09PSBoLmtleUNvZGUgJiYgKDAgPCBhKCJpbnB1dC5oYXNEYXRlcGlja2VyIiwgZSkubGVuZ3RoID8gYSgiLnVpLWRhdGVwaWNrZXIiKS5pcygiOmhpZGRlbiIpID8gYShCKS5qcUdyaWQoInJlc3RvcmVDZWxsIiwgYiwgYykgOiBhKCJpbnB1dC5oYXNEYXRlcGlja2VyIiwgZSkuZGF0ZXBpY2tlcigiaGlkZSIpIDogYShCKS5qcUdyaWQoInJlc3RvcmVDZWxsIiwgYiwgYykpLCAxMyA9PT0gaC5rZXlDb2RlICYmICFoLnNoaWZ0S2V5KSByZXR1cm4gYShCKS5qcUdyaWQoInNhdmVDZWxsIiwgYiwgYyksICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDkgPT09IGgua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChCLmdyaWQuaERpdi5sb2FkaW5nKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5zaGlmdEtleSA/IGEoQikuanFHcmlkKCJwcmV2Q2VsbCIsIGIsIGMpIDogYShCKS5qcUdyaWQoIm5leHRDZWxsIiwgYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoQikudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFmdGVyRWRpdENlbGwiLCBbQi5yb3dzW2JdLmlkLCBkLCBnLCBiLCBjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihCLnAuYWZ0ZXJFZGl0Q2VsbCkgJiYgQi5wLmFmdGVyRWRpdENlbGwuY2FsbChCLCBCLnJvd3NbYl0uaWQsIGQsIGcsIGIsIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIucC5pQ29sID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCLnAuaVJvdyA9IGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2F2ZUNlbGw6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCwgZCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzLCAiZXJyb3JzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzLCAiZWRpdCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5ncmlkICYmICEwID09PSBkLnAuY2VsbEVkaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoID0gMSA8PSBkLnAuc2F2ZWRSb3cubGVuZ3RoID8gMCA6IG51bGwsIG51bGwgIT09IGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiwgQiwgciA9IGEoInRkOmVxKCIgKyBjICsgIikiLCBkLnJvd3NbYl0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gZC5wLmNvbE1vZGVsW2NdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gcS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gYS5qZ3JpZC5qcUlEKHUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gYShyKS5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHEuZWRpdHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2VsZWN0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxLmVkaXRvcHRpb25zLm11bHRpcGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGIgKyAiXyIgKyBrLCBkLnJvd3NbYl0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG4gPSBhKGspLnZhbCgpKSA/IG4uam9pbigiLCIpOiBuID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgib3B0aW9uOnNlbGVjdGVkIiwgaykuZWFjaChmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtbYl0gPSBhKGYpLnRleHQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSBLLmpvaW4oIiwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIG4gPSBhKCIjIiArIGIgKyAiXyIgKyBrICsgIiBvcHRpb246c2VsZWN0ZWQiLCBkLnJvd3NbYl0pLnZhbCgpLCBCID0gYSgiIyIgKyBiICsgIl8iICsgayArICIgb3B0aW9uOnNlbGVjdGVkIiwgZC5yb3dzW2JdKS50ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLmZvcm1hdHRlciAmJiAoQiA9IG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBDID0gWyJZZXMiLCAiTm8iXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEuZWRpdG9wdGlvbnMgJiYgKEMgPSBxLmVkaXRvcHRpb25zLnZhbHVlLnNwbGl0KCI6IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IG4gPSBhKCIjIiArIGIgKyAiXyIgKyBrLCBkLnJvd3NbYl0pLmlzKCI6Y2hlY2tlZCIpID8gQ1swXSA6IENbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFzc3dvcmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGV4dGFyZWEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJidXR0b24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IG4gPSBhKCIjIiArIGIgKyAiXyIgKyBrLCBkLnJvd3NbYl0pLnZhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImN1c3RvbSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcS5lZGl0b3B0aW9ucyB8fCAhYS5pc0Z1bmN0aW9uKHEuZWRpdG9wdGlvbnMuY3VzdG9tX3ZhbHVlKSkgdGhyb3cgImUxIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobiA9IHEuZWRpdG9wdGlvbnMuY3VzdG9tX3ZhbHVlLmNhbGwoZCwgYSgiLmN1c3RvbWVsZW1lbnQiLCByKSwgImdldCIpLCB2b2lkIDAgPT09IG4pIHRocm93ICJlMiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiA9IG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZTEiID09PSB4ID8gYS5qZ3JpZC5pbmZvX2RpYWxvZyhnLmVycmNhcCwgImZ1bmN0aW9uICdjdXN0b21fdmFsdWUnICIgKyBlLm1zZy5ub2RlZmluZWQsIGUuYkNsb3NlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IGQucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAiZTIiID09PSB4ID8gYS5qZ3JpZC5pbmZvX2RpYWxvZyhnLmVycmNhcCwgImZ1bmN0aW9uICdjdXN0b21fdmFsdWUnICIgKyBlLm1zZy5ub3ZhbHVlLCBlLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBkLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYS5qZ3JpZC5pbmZvX2RpYWxvZyhnLmVycmNhcCwgeC5tZXNzYWdlLCBlLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBkLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChCICE9PSBkLnAuc2F2ZWRSb3dbaF0udikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEJlZm9yZVNhdmVDZWxsIiwgW2Qucm93c1tiXS5pZCwgdSwgbiwgYiwgY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaCAmJiAobiA9IGgsIEIgPSBoKSwgYS5pc0Z1bmN0aW9uKGQucC5iZWZvcmVTYXZlQ2VsbCkpICYmIChoID0gZC5wLmJlZm9yZVNhdmVDZWxsLmNhbGwoZCwgZC5yb3dzW2JdLmlkLCB1LCBuLCBiLCBjKSkgJiYgKG4gPSBoLCBCID0gaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gYS5qZ3JpZC5jaGVja1ZhbHVlcy5jYWxsKGQsIG4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IHBbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRCZWZvcmVTdWJtaXRDZWxsIiwgW2Qucm93c1tiXS5pZCwgdSwgbiwgYiwgY10pIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaXNGdW5jdGlvbihkLnAuYmVmb3JlU3VibWl0Q2VsbCkgJiYgKGggPSBkLnAuYmVmb3JlU3VibWl0Q2VsbC5jYWxsKGQsIGQucm93c1tiXS5pZCwgdSwgbiwgYiwgYyksIGggfHwgKGggPSB7fSkpLCAwIDwgYSgiaW5wdXQuaGFzRGF0ZXBpY2tlciIsIHIpLmxlbmd0aCAmJiBhKCJpbnB1dC5oYXNEYXRlcGlja2VyIiwgcikuZGF0ZXBpY2tlcigiaGlkZSIpLCAicmVtb3RlIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuY2VsbHN1Ym1pdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5wLmNlbGx1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEEgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLmF1dG9lbmNvZGUgJiYgKG4gPSBhLmpncmlkLmh0bWxFbmNvZGUobikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBW3VdID0gbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IGQucC5wcm1OYW1lczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IEMuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBDLm9wZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFbcV0gPSBhLmpncmlkLnN0cmlwUHJlZihkLnAuaWRQcmVmaXgsIGQucm93c1tiXS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFba10gPSBDLmVkaXRvcGVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gYS5leHRlbmQoaCwgQSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkuanFHcmlkKCJwcm9ncmVzc0JhciIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogInNob3ciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZHR5cGU6IGQucC5sb2FkdWksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sY29udGVudDogYS5qZ3JpZC5nZXRSZWdpb25hbChkLCAiZGVmYXVsdHMuc2F2ZXRleHQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5ncmlkLmhEaXYubG9hZGluZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmFqYXgoYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBkLnAuY2VsbHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGEuaXNGdW5jdGlvbihkLnAuc2VyaWFsaXplQ2VsbERhdGEpID8gZC5wLnNlcmlhbGl6ZUNlbGxEYXRhLmNhbGwoZCwgQSkgOiBBLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGgsIHEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShkKS5qcUdyaWQoInByb2dyZXNzQmFyIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiaGlkZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkdHlwZTogZC5wLmxvYWR1aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZC5ncmlkLmhEaXYubG9hZGluZyA9ICExLCAic3VjY2VzcyIgPT09IHEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlclN1Ym1pdENlbGwiLCBbZCwgaCwgQS5pZCwgdSwgbiwgYiwgY10pIHx8IFshMCwgIiJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0ga1swXSAmJiBhLmlzRnVuY3Rpb24oZC5wLmFmdGVyU3VibWl0Q2VsbCkgJiYgKGsgPSBkLnAuYWZ0ZXJTdWJtaXRDZWxsLmNhbGwoZCwgaCwgQS5pZCwgdSwgbiwgYiwgYykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0ga1swXSA/IChhKHIpLmVtcHR5KCksIGEoZCkuanFHcmlkKCJzZXRDZWxsIiwgZC5yb3dzW2JdLmlkLCBjLCBCLCAhMSwgITEsICEwKSwgYShyKS5hZGRDbGFzcygiZGlydHktY2VsbCIpLCBhKGQucm93c1tiXSkuYWRkQ2xhc3MoImVkaXRlZCIpLCBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlclNhdmVDZWxsIiwgW2Qucm93c1tiXS5pZCwgdSwgbiwgYiwgY10pLCBhLmlzRnVuY3Rpb24oZC5wLmFmdGVyU2F2ZUNlbGwpICYmIGQucC5hZnRlclNhdmVDZWxsLmNhbGwoZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucm93c1tiXS5pZCwgdSwgbiwgYiwgYyksIGQucC5zYXZlZFJvdy5zcGxpY2UoMCwgMSkpIDogKGEuamdyaWQuaW5mb19kaWFsb2coZy5lcnJjYXAsIGtbMV0sIGUuYkNsb3NlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBkLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZC5wLnJlc3RvcmVDZWxsb25GYWlsICYmIGEoZCkuanFHcmlkKCJyZXN0b3JlQ2VsbCIsIGIsIGMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oaCwgbiwgcSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNsdWlfIiArIGEuamdyaWQuanFJRChkLnAuaWQpKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5ncmlkLmhEaXYubG9hZGluZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEVycm9yQ2VsbCIsIFtoLCBuLCBxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGQucC5lcnJvckNlbGwpID8gZC5wLmVycm9yQ2VsbC5jYWxsKGQsIGgsIG4sIHEpIDogYS5qZ3JpZC5pbmZvX2RpYWxvZyhnLmVycmNhcCwgaC5zdGF0dXMgKyAiIDogIiArIGguc3RhdHVzVGV4dCArICI8YnIvPiIgKyBuLCBlLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBkLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5yZXN0b3JlQ2VsbG9uRmFpbCAmJiBhKGQpLmpxR3JpZCgicmVzdG9yZUNlbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLCBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmpncmlkLmFqYXhPcHRpb25zLCBkLnAuYWpheENlbGxPcHRpb25zIHx8IHt9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5pbmZvX2RpYWxvZyhnLmVycmNhcCwgZy5ub3VybCwgZS5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IGQucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkLnAucmVzdG9yZUNlbGxvbkZhaWwgJiYgYShkKS5qcUdyaWQoInJlc3RvcmVDZWxsIiwgYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICh4KSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjbGllbnRBcnJheSIgPT09IGQucC5jZWxsc3VibWl0ICYmIChhKHIpLmVtcHR5KCksIGEoZCkuanFHcmlkKCJzZXRDZWxsIiwgZC5yb3dzW2JdLmlkLCBjLCBCLCAhMSwgITEsICEwKSwgYShyKS5hZGRDbGFzcygiZGlydHktY2VsbCIpLCBhKGQucm93c1tiXSkuYWRkQ2xhc3MoImVkaXRlZCIpLCBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZnRlclNhdmVDZWxsIiwgW2Qucm93c1tiXS5pZCwgdSwgbiwgYiwgY10pLCBhLmlzRnVuY3Rpb24oZC5wLmFmdGVyU2F2ZUNlbGwpICYmIGQucC5hZnRlclNhdmVDZWxsLmNhbGwoZCwgZC5yb3dzW2JdLmlkLCB1LCBuLCBiLCBjKSwgZC5wLnNhdmVkUm93LnNwbGljZSgwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuaW5mb19kaWFsb2coZy5lcnJjYXAsIG4gKyAiICIgKyBwWzFdLCBlLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBkLnAuc3R5bGVVSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB5LnRvcCArIDQwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB5LmxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKSwgYShkKS5qcUdyaWQoInJlc3RvcmVDZWxsIiwgYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoeCkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYShkKS5qcUdyaWQoInJlc3RvcmVDZWxsIiwgYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGQucC5rbnYpKS5hdHRyKCJ0YWJpbmRleCIsICItMSIpLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlc3RvcmVDZWxsOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZy5ncmlkICYmICEwID09PSBnLnAuY2VsbEVkaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gMSA8PSBnLnAuc2F2ZWRSb3cubGVuZ3RoID8gMCA6IG51bGwsIG51bGwgIT09IGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGEoInRkOmVxKCIgKyBjICsgIikiLCBnLnJvd3NbYl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmlzRnVuY3Rpb24oYS5mbi5kYXRlcGlja2VyKSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiaW5wdXQuaGFzRGF0ZXBpY2tlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsKS5kYXRlcGlja2VyKCJoaWRlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEobCkuZW1wdHkoKS5hdHRyKCJ0YWJpbmRleCIsICItMSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZykuanFHcmlkKCJzZXRDZWxsIiwgZy5yb3dzW2JdLmlkLCBjLCBnLnAuc2F2ZWRSb3dbZF0udiwgITEsICExLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShnKS50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJSZXN0b3JlQ2VsbCIsIFtnLnJvd3NbYl0uaWQsIGcucC5zYXZlZFJvd1tkXS52LCBiLCBjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGcucC5hZnRlclJlc3RvcmVDZWxsKSAmJiBnLnAuYWZ0ZXJSZXN0b3JlQ2VsbC5jYWxsKGcsIGcucm93c1tiXS5pZCwgZy5wLnNhdmVkUm93W2RdLnYsIGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucC5zYXZlZFJvdy5zcGxpY2UoMCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgZy5wLmtudikuYXR0cigidGFiaW5kZXgiLCAiLTEiKS5mb2N1cygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuZXh0Q2VsbDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgITAgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuY2VsbEVkaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IGMgKyAxOyBkIDwgdGhpcy5wLmNvbE1vZGVsLmxlbmd0aDsgZCsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gdGhpcy5wLmNvbE1vZGVsW2RdLmVkaXRhYmxlICYmICghYS5pc0Z1bmN0aW9uKHRoaXMucC5pc0NlbGxFZGl0YWJsZSkgfHwgdGhpcy5wLmlzQ2VsbEVkaXRhYmxlLmNhbGwodGhpcywgdGhpcy5wLmNvbE1vZGVsW2RdLm5hbWUsIGIsIGQpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ITEgIT09IGcgPyBhKHRoaXMpLmpxR3JpZCgiZWRpdENlbGwiLCBiLCBnLCAhMCkgOiAwIDwgdGhpcy5wLnNhdmVkUm93Lmxlbmd0aCAmJiBhKHRoaXMpLmpxR3JpZCgic2F2ZUNlbGwiLCBiLCBjKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcmV2Q2VsbDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgITAgPT09IHRoaXMucC5jZWxsRWRpdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gYyAtIDE7IDAgPD0gZDsgZC0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gdGhpcy5wLmNvbE1vZGVsW2RdLmVkaXRhYmxlICYmICghYS5pc0Z1bmN0aW9uKHRoaXMucC5pc0NlbGxFZGl0YWJsZSkgfHwgdGhpcy5wLmlzQ2VsbEVkaXRhYmxlLmNhbGwodGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5jb2xNb2RlbFtkXS5uYW1lLCBiLCBkKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSExICE9PSBnID8gYSh0aGlzKS5qcUdyaWQoImVkaXRDZWxsIiwgYiwgZywgITApIDogMCA8IHRoaXMucC5zYXZlZFJvdy5sZW5ndGggJiYgYSh0aGlzKS5qcUdyaWQoInNhdmVDZWxsIiwgYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgR3JpZE5hdjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihmLCBjLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoInYiID09PSBlLnN1YnN0cigwLCAxKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gYShkLmdyaWQuYkRpdilbMF0uY2xpZW50SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYShkLmdyaWQuYkRpdilbMF0uc2Nyb2xsVG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gZC5yb3dzW2ZdLm9mZnNldFRvcCArIGQucm93c1tmXS5jbGllbnRIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBkLnJvd3NbZl0ub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2ZCIgPT09IGUgJiYgdyA+PSBtICYmIChhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxUb3AgPSBhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxUb3AgKyBkLnJvd3NbZl0uY2xpZW50SGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidnUiID09PSBlICYmIGcgPiBsICYmIChhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxUb3AgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxUb3AgLSBkLnJvd3NbZl0uY2xpZW50SGVpZ2h0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImgiID09PSBlICYmIChlID0gYShkLmdyaWQuYkRpdilbMF0uY2xpZW50V2lkdGgsIG0gPSBhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxMZWZ0LCBnID0gZC5yb3dzW2ZdLmNlbGxzW2NdLm9mZnNldExlZnQsIGQucm93c1tmXS5jZWxsc1tjXS5vZmZzZXRMZWZ0ICsgZC5yb3dzW2ZdLmNlbGxzW2NdLmNsaWVudFdpZHRoID49IGUgKyBwYXJzZUludChtLCAxMCkgPyBhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxMZWZ0ID0gYShkLmdyaWQuYkRpdilbMF0uc2Nyb2xsTGVmdCArIGQucm93c1tmXS5jZWxsc1tjXS5jbGllbnRXaWR0aCA6IG0gPiBnICYmIChhKGQuZ3JpZC5iRGl2KVswXS5zY3JvbGxMZWZ0ID0gYShkLmdyaWQuYkRpdilbMF0uc2Nyb2xsTGVmdCAtIGQucm93c1tmXS5jZWxsc1tjXS5jbGllbnRXaWR0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGMoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImxmdCIgPT09IGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gYSArIDEsIGUgPSBhOyAwIDw9IGU7IGUtLSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwICE9PSBkLnAuY29sTW9kZWxbZV0uaGlkZGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJyZ3QiID09PSBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IGEgLSAxLCBlID0gYTsgZSA8IGQucC5jb2xNb2RlbC5sZW5ndGg7IGUrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwICE9PSBkLnAuY29sTW9kZWxbZV0uaGlkZGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5ncmlkICYmICEwID09PSBkLnAuY2VsbEVkaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5rbnYgPSBkLnAuaWQgKyAiX2tuIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBsLCBlID0gYSgiPGRpdiBzdHlsZT0ncG9zaXRpb246Zml4ZWQ7dG9wOjBweDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIHRhYmluZGV4PScwJz48ZGl2IHRhYmluZGV4PSctMScgc3R5bGU9J3dpZHRoOjFweDtoZWlnaHQ6MXB4OycgaWQ9JyIgKyBkLnAua252ICsgIic+PC9kaXY+PC9kaXY+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGUpLmluc2VydEJlZm9yZShkLmdyaWQuY0Rpdik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGQucC5rbnYpLmZvY3VzKCkua2V5ZG93bihmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChsID0gZS5rZXlDb2RlLCAicnRsIiA9PT0gZC5wLmRpcmVjdGlvbiAmJiAoMzcgPT09IGwgPyBsID0gMzkgOiAzOSA9PT0gbCAmJiAobCA9IDM3KSksIGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPCBkLnAuaVJvdyAtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSAmJiAoYihkLnAuaVJvdyAtIDEsIGQucC5pQ29sLCAidnUiKSwgYShkKS5qcUdyaWQoImVkaXRDZWxsIiwgZC5wLmlSb3cgLSAxLCBkLnAuaUNvbCwgITEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLmlSb3cgKyAxIDw9IGQucm93cy5sZW5ndGggLSAxICYmIChiKGQucC5pUm93ICsgMSwgZC5wLmlDb2wsICJ2ZCIpLCBhKGQpLmpxR3JpZCgiZWRpdENlbGwiLCBkLnAuaVJvdyArIDEsIGQucC5pQ29sLCAhMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDw9IGQucC5pQ29sIC0gMSAmJiAoZyA9IGMoZC5wLmlDb2wgLSAxLCAibGZ0IiksIGIoZC5wLmlSb3csIGcsICJoIiksIGEoZCkuanFHcmlkKCJlZGl0Q2VsbCIsIGQucC5pUm93LCBnLCAhMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuaUNvbCArIDEgPD0gZC5wLmNvbE1vZGVsLmxlbmd0aCAtIDEgJiYgKGcgPSBjKGQucC5pQ29sICsgMSwgInJndCIpLCBiKGQucC5pUm93LCBnLCAiaCIpLCBhKGQpLmpxR3JpZCgiZWRpdENlbGwiLCBkLnAuaVJvdywgZywgITEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8PSBwYXJzZUludChkLnAuaUNvbCwgMTApICYmIDAgPD0gcGFyc2VJbnQoZC5wLmlSb3csIDEwKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkuanFHcmlkKCJlZGl0Q2VsbCIsIGQucC5pUm93LCBkLnAuaUNvbCwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRDaGFuZ2VkQ2VsbHM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiIHx8IChiID0gImFsbCIpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgZy5ncmlkICYmICEwID09PSBnLnAuY2VsbEVkaXQgJiYgYShnLnJvd3MpLmVhY2goZnVuY3Rpb24obCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuaGFzQ2xhc3MoImVkaXRlZCIpICYmIChhKCJ0ZCIsIHRoaXMpLmVhY2goZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gZy5wLmNvbE1vZGVsW2NdLm5hbWUsICJjYiIgIT09IGQgJiYgInN1YmdyaWQiICE9PSBkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImRpcnR5IiA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEodGhpcykuaGFzQ2xhc3MoImRpcnR5LWNlbGwiKSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2RdID0gYS51bmZvcm1hdC5jYWxsKGcsIHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGcucm93c1tsXS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTW9kZWw6IGcucC5jb2xNb2RlbFtjXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVtkXSA9IGEuamdyaWQuaHRtbERlY29kZShhKHRoaXMpLmh0bWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2RdID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnVuZm9ybWF0LmNhbGwoZywgdGhpcywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogZy5yb3dzW2xdLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xNb2RlbDogZy5wLmNvbE1vZGVsW2NdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVtkXSA9IGEuamdyaWQuaHRtbERlY29kZShhKHRoaXMpLmh0bWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGUuaWQgPSB0aGlzLmlkLCBjLnB1c2goZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSksIGMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuZXh0ZW5kKGEuamdyaWQsIHsKICAgICAgICAgICAgICAgIHNob3dNb2RhbDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEudy5zaG93KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbG9zZU1vZGFsOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYS53LmhpZGUoKS5hdHRyKCJhcmlhLWhpZGRlbiIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgYS5vICYmIGEuby5yZW1vdmUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhpZGVNb2RhbDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIGMgPSBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlbW9kYWw6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtcHJvcDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06ICIiCiAgICAgICAgICAgICAgICAgICAgfSwgYyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBjLmdiICYmICJzdHJpbmciID09IHR5cGVvZiBjLmdiICYmICIjZ2JveF8iID09PSBjLmdiLnN1YnN0cigwLCA2KSA/IGEoIiMiICsgYy5nYi5zdWJzdHIoNikpWzBdIDogITE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMub25DbG9zZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGQgPyBjLm9uQ2xvc2UuY2FsbChkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYikgOiBjLm9uQ2xvc2UoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiYm9vbGVhbiIgPT0gdHlwZW9mIGcgJiYgIWcpIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoYy5mb3JtcHJvcCAmJiBkICYmIGMuZm9ybSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEoYilbMF0uc3R5bGUuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoYilbMF0uc3R5bGUud2lkdGg7IC0gMSA8IGcuaW5kZXhPZigicHgiKSAmJiAoZyA9IHBhcnNlRmxvYXQoZykpOyAtIDEgPCBsLmluZGV4T2YoInB4IikgJiYgKGwgPSBwYXJzZUZsb2F0KGwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIG47CiAgICAgICAgICAgICAgICAgICAgICAgICJlZGl0IiA9PT0gYy5mb3JtID8gKGUgPSAiIyIgKyBhLmpncmlkLmpxSUQoIkZybUdyaWRfIiArIGMuZ2Iuc3Vic3RyKDYpKSwgbiA9ICJmb3JtUHJvcCIpIDogInZpZXciID09PSBjLmZvcm0gJiYgKGUgPSAiIyIgKyBhLmpncmlkLmpxSUQoIlZpZXdHcmlkXyIgKyBjLmdiLnN1YnN0cig2KSksIG4gPSAidmlld1Byb3AiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5kYXRhKG4sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogcGFyc2VGbG9hdChhKGIpLmNzcygidG9wIikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcGFyc2VGbG9hdChhKGIpLmNzcygibGVmdCIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWhlaWdodDogYShlKS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF3aWR0aDogYShlKS53aWR0aCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhLmZuLmpxbSAmJgogICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5qcW0pIGEoYikuYXR0cigiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpLmpxbUhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCIiICE9PSBjLmdiKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLmpxZ3JpZC1vdmVybGF5OmZpcnN0IiwgYy5nYikuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGspIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGEoYikuaGlkZSgpLmF0dHIoImFyaWEtaGlkZGVuIiwgInRydWUiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjLnJlbW92ZW1vZGFsICYmIGEoYikucmVtb3ZlKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmaW5kUG9zOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5vZmZzZXRQYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG8gYiArPSBhLm9mZnNldExlZnQsIGMgKz0gYS5vZmZzZXRUb3A7IHdoaWxlIChhID0gYS5vZmZzZXRQYXJlbnQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbYiwgY10KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjcmVhdGVNb2RhbDogZnVuY3Rpb24oYiwgYywgZCwgZywgbCwgZSwgbikgewogICAgICAgICAgICAgICAgICAgIGQgPSBhLmV4dGVuZCghMCwge30sIGEuamdyaWQuanFNb2RhbCB8fCB7fSwgZCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICByID0gInJ0bCIgPT09IGEoZC5nYm94KS5hdHRyKCJkaXIiKSA/ICEwIDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBhLmpncmlkLnN0eWxlVUlbZC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLm1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICB1ID0gYS5qZ3JpZC5zdHlsZVVJW2Quc3R5bGVVSSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpRdWVyeVVJIl0uY29tbW9uLAogICAgICAgICAgICAgICAgICAgICAgICB6ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICAgICAgbiA9IGEuZXh0ZW5kKHt9LCBuIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICB6LmNsYXNzTmFtZSA9ICJ1aS1qcWRpYWxvZyAiICsgcS5tb2RhbDsKICAgICAgICAgICAgICAgICAgICB6LmlkID0gYi50aGVtb2RhbDsKICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIHkuY2xhc3NOYW1lID0gInVpLWpxZGlhbG9nLXRpdGxlYmFyICIgKyBxLmhlYWRlcjsKICAgICAgICAgICAgICAgICAgICB5LmlkID0gYi5tb2RhbGhlYWQ7CiAgICAgICAgICAgICAgICAgICAgYSh5KS5hcHBlbmQoIjxzcGFuIGNsYXNzPSd1aS1qcWRpYWxvZy10aXRsZSc+IiArIGQuY2FwdGlvbiArICI8L3NwYW4+Iik7CiAgICAgICAgICAgICAgICAgICAgdmFyIEsgPSBhKCI8YSBjbGFzcz0ndWktanFkaWFsb2ctdGl0bGViYXItY2xvc2UgIiArIHUuY29ybmVyYWxsICsgIic+PC9hPiIpLmhvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBLLmFkZENsYXNzKHUuaG92ZXIpCiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEsucmVtb3ZlQ2xhc3ModS5ob3ZlcikKICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQoIjxzcGFuIGNsYXNzPSciICsgdS5pY29uX2Jhc2UgKyAiICIgKyBxLmljb25fY2xvc2UgKyAiJz48L3NwYW4+Iik7CiAgICAgICAgICAgICAgICAgICAgYSh5KS5hcHBlbmQoSyk7CiAgICAgICAgICAgICAgICAgICAgciA/ICh6LmRpciA9ICJydGwiLCBhKCIudWktanFkaWFsb2ctdGl0bGUiLCB5KS5jc3MoImZsb2F0IiwgInJpZ2h0IiksIGEoIi51aS1qcWRpYWxvZy10aXRsZWJhci1jbG9zZSIsIHkpLmNzcygibGVmdCIsICIwLjNlbSIpKSA6ICh6LmRpciA9ICJsdHIiLCBhKCIudWktanFkaWFsb2ctdGl0bGUiLCB5KS5jc3MoImZsb2F0IiwgImxlZnQiKSwgYSgiLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlIiwgeSkuY3NzKCJyaWdodCIsICIwLjNlbSIpKTsKICAgICAgICAgICAgICAgICAgICB2YXIgQyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIGEoQykuYWRkQ2xhc3MoInVpLWpxZGlhbG9nLWNvbnRlbnQgIiArIHEuY29udGVudCkuYXR0cigiaWQiLCBiLm1vZGFsY29udGVudCk7CiAgICAgICAgICAgICAgICAgICAgYShDKS5hcHBlbmQoYyk7CiAgICAgICAgICAgICAgICAgICAgei5hcHBlbmRDaGlsZChDKTsKICAgICAgICAgICAgICAgICAgICBhKHopLnByZXBlbmQoeSk7CiAgICAgICAgICAgICAgICAgICAgITAgPT09IGUgPyBhKCJib2R5IikuYXBwZW5kKHopIDogInN0cmluZyIgPT0gdHlwZW9mIGUgPyBhKGUpLmFwcGVuZCh6KSA6IGEoeikuaW5zZXJ0QmVmb3JlKGcpOwogICAgICAgICAgICAgICAgICAgIGEoeikuY3NzKG4pOwogICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZC5qcU1vZGFsICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChkLmpxTW9kYWwgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IHt9OwogICAgICAgICAgICAgICAgICAgIGEuZm4uanFtICYmICEwID09PSBkLmpxTW9kYWwgPyAoMCA9PT0gZC5sZWZ0ICYmIDAgPT09IGQudG9wICYmIGQub3ZlcmxheSAmJiAobiA9IFtdLCBuID0gYS5qZ3JpZC5maW5kUG9zKGwpLCBkLmxlZnQgPSBuWzBdICsgNCwgZC50b3AgPSBuWzFdICsgNCksIGMudG9wID0gZC50b3AgKyAicHgiLCBjLmxlZnQgPSBkLmxlZnQpIDogKDAgIT09IGQubGVmdCB8fCAwICE9PSBkLnRvcCkgJiYgKGMubGVmdCA9IGQubGVmdCwgYy50b3AgPSBkLnRvcCArICJweCIpOwogICAgICAgICAgICAgICAgICAgIChhKCJhLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlIiwgeSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoYi50aGVtb2RhbCkpLmRhdGEoIm9uQ2xvc2UiKSB8fCBkLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoYi50aGVtb2RhbCkpLmRhdGEoImdib3giKSB8fCBkLmdib3g7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBrLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoYi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBkLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlbW9kYWw6IGQucmVtb3ZlbW9kYWwgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1wcm9wOiAhZC5yZWNyZWF0ZUZvcm0gfHwgITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtOiBkLmZvcm0gfHwgIiIKICAgICAgICAgICAgICAgICAgICAgICAgfSksICExCiAgICAgICAgICAgICAgICAgICAgfSksIDAgIT09IGQud2lkdGggJiYgZC53aWR0aCB8fCAoZC53aWR0aCA9IDMwMCksIDAgIT09IGQuaGVpZ2h0ICYmIGQuaGVpZ2h0IHx8IChkLmhlaWdodCA9IDIwMCksIGQuekluZGV4KSB8fCAoZyA9IGEoZykucGFyZW50cygiKltyb2xlPWRpYWxvZ10iKS5maWx0ZXIoIjpmaXJzdCIpLmNzcygiei1pbmRleCIpLCBkLnpJbmRleCA9IGcgPyBwYXJzZUludChnLCAxMCkgKyAyIDogOTUwKTsKICAgICAgICAgICAgICAgICAgICBnID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAociAmJiBjLmxlZnQgJiYgIWUgJiYgKGcgPSBhKGQuZ2JveCkud2lkdGgoKSAtIChpc05hTihkLndpZHRoKSA/IDAgOiBwYXJzZUludChkLndpZHRoLCAxMCkpIC0gOCwgYy5sZWZ0ID0gcGFyc2VJbnQoYy5sZWZ0LCAxMCkgKyBwYXJzZUludChnLCAxMCkpLCBjLmxlZnQgJiYgKGMubGVmdCArPSAicHgiKSwgYSh6KS5jc3MoYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGlzTmFOKGQud2lkdGgpID8gImF1dG8iIDogZC53aWR0aCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGlzTmFOKGQuaGVpZ2h0KSA/ICJhdXRvIiA6IGQuaGVpZ2h0ICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogZC56SW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgYykpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6ICItMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiZGlhbG9nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWxhYmVsbGVkYnkiOiBiLm1vZGFsaGVhZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICJ0cnVlIgogICAgICAgICAgICAgICAgICAgICAgICB9KSwgdm9pZCAwID09PSBkLmRyYWcgJiYgKGQuZHJhZyA9ICEwKSwgdm9pZCAwID09PSBkLnJlc2l6ZSAmJiAoZC5yZXNpemUgPSAhMCksIGQuZHJhZykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoeSkuY3NzKCJjdXJzb3IiLCAibW92ZSIpLCBhLmZuLnRpbnlEcmFnZ2FibGUpIGEoeikudGlueURyYWdnYWJsZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICIjIiArIGEuamdyaWQuanFJRCh5LmlkKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh6KS5kcmFnZ2FibGUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZTogYSgiIyIgKyBhLmpncmlkLmpxSUQoeS5pZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChwKSB7fQogICAgICAgICAgICAgICAgICAgIGlmIChkLnJlc2l6ZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZm4uanFSZXNpemUpIGEoeikuYXBwZW5kKCI8ZGl2IGNsYXNzPSdqcVJlc2l6ZSAiICsgcS5yZXNpemFibGUgKyAiICIgKyB1Lmljb25fYmFzZSArICIgIiArIHEuaWNvbl9yZXNpemFibGUgKyAiJz48L2Rpdj4iKSwgYSgiIyIgKyBhLmpncmlkLmpxSUQoYi50aGVtb2RhbCkpLmpxUmVzaXplKCIuanFSZXNpemUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5zY3JvbGxlbG0gPyAiIyIgKyBhLmpncmlkLmpxSUQoYi5zY3JvbGxlbG0pIDogITEpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHopLnJlc2l6YWJsZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlczogInNlLCBzdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxzb1Jlc2l6ZTogYi5zY3JvbGxlbG0gPyAiIyIgKyBhLmpncmlkLmpxSUQoYi5zY3JvbGxlbG0pIDogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHApIHt9ITAgPT09IGQuY2xvc2VPbkVzY2FwZSAmJiBhKHopLmtleWRvd24oZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjcgPT09IGMud2hpY2ggJiYgKGMgPSBhKCIjIiArIGEuamdyaWQuanFJRChiLnRoZW1vZGFsKSkuZGF0YSgib25DbG9zZSIpIHx8IGQub25DbG9zZSwgay5oaWRlTW9kYWwoIiMiICsgYS5qZ3JpZC5qcUlEKGIudGhlbW9kYWwpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6IGQuZ2JveCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGQuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiBkLnJlbW92ZW1vZGFsIHx8ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1wcm9wOiAhZC5yZWNyZWF0ZUZvcm0gfHwgITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybTogZC5mb3JtIHx8ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2aWV3TW9kYWw6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVG9wOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXk6IDEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheUNsYXNzOiAidWktd2lkZ2V0LW92ZXJsYXkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TaG93OiBhLmpncmlkLnNob3dNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uSGlkZTogYS5qZ3JpZC5jbG9zZU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAganFNOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LCBjIHx8IHt9KSwgdm9pZCAwID09PSBjLmZvY3VzRmllbGQgJiYgKGMuZm9jdXNGaWVsZCA9IDApLCBjLmZvY3VzRmllbGQgPSAibnVtYmVyIiA9PSB0eXBlb2YgYy5mb2N1c0ZpZWxkICYmIDAgPD0gYy5mb2N1c0ZpZWxkID8gcGFyc2VJbnQoYy5mb2N1c0ZpZWxkLCAxMCkgOiAiYm9vbGVhbiIgIT0gdHlwZW9mIGMuZm9jdXNGaWVsZCB8fCBjLmZvY3VzRmllbGQgPyAwIDogITEsIGEuZm4uanFtICYmICEwID09PSBjLmpxbSkgYy5qcU0gPyBhKGIpLmF0dHIoImFyaWEtaGlkZGVuIiwgImZhbHNlIikuanFtKGMpLmpxbVNob3coKSA6IGEoYikuYXR0cigiYXJpYS1oaWRkZW4iLCAiZmFsc2UiKS5qcW1TaG93KCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIiIgIT09IGMuZ2JveCAmJiAoYSgiLmpxZ3JpZC1vdmVybGF5OmZpcnN0IiwgYy5nYm94KS5zaG93KCksIGEoYikuZGF0YSgiZ2JveCIsIGMuZ2JveCkpLCBhKGIpLnNob3coKS5hdHRyKCJhcmlhLWhpZGRlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFsc2UiKSwgMCA8PSBjLmZvY3VzRmllbGQpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoIjppbnB1dDp2aXNpYmxlIiwgYilbcGFyc2VJbnQoYy5mb2N1c0ZpZWxkLCAxMCldLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChkKSB7fQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGluZm9fZGlhbG9nOiBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyOTAsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWc6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICByZXNpemU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAyNTAsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMTcwLAogICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDFFMywKICAgICAgICAgICAgICAgICAgICAgICAganFNb2RhbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkVzY2FwZTogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uYWxpZ246ICJjZW50ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBidXR0b25zOiBbXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYS5leHRlbmQoITAsIGwsIGEuamdyaWQuanFNb2RhbCB8fCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiAiPGI+IiArIGIgKyAiPC9iPiIKICAgICAgICAgICAgICAgICAgICB9LCBnIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGwuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEuamdyaWQuc3R5bGVVSVtsLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0ubW9kYWw7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhLmpncmlkLnN0eWxlVUlbbC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmNvbW1vbjsKICAgICAgICAgICAgICAgICAgICBhLmZuLmpxbSAmJgogICAgICAgICAgICAgICAgICAgICAgICAhZSAmJiAoZSA9ICExKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcjsKICAgICAgICAgICAgICAgICAgICBnID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCBsLmJ1dHRvbnMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHIgPSAwOyByIDwgbC5idXR0b25zLmxlbmd0aDsgcisrKSB2b2lkIDAgPT09IGwuYnV0dG9uc1tyXS5pZCAmJiAobC5idXR0b25zW3JdLmlkID0gImluZm9fYnV0dG9uXyIgKyByKSwgZyArPSAiPGEgaWQ9JyIgKyBsLmJ1dHRvbnNbcl0uaWQgKyAiJyBjbGFzcz0nZm0tYnV0dG9uICIgKyBrLmJ1dHRvbiArICInPiIgKyBsLmJ1dHRvbnNbcl0udGV4dCArICI8L2E+IjsKICAgICAgICAgICAgICAgICAgICByID0gaXNOYU4obC5kYXRhaGVpZ2h0KSA/IGwuZGF0YWhlaWdodCA6IGwuZGF0YWhlaWdodCArICJweCI7CiAgICAgICAgICAgICAgICAgICAgYyA9ICI8ZGl2IGlkPSdpbmZvX2lkJz4iICsgKCI8ZGl2IGlkPSdpbmZvY250JyBzdHlsZT0nbWFyZ2luOjBweDtwYWRkaW5nLWJvdHRvbToxZW07d2lkdGg6MTAwJTtvdmVyZmxvdzphdXRvO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoiICsgciArICI7IiArICgidGV4dC1hbGlnbjoiICsgbC5hbGlnbiArICI7IikgKyAiJz4iICsgYyArICI8L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICBjICs9IGQgPyAiPGRpdiBjbGFzcz0nIiArIGIuaGVhZGVyICsgIicgc3R5bGU9J3RleHQtYWxpZ246IiArCiAgICAgICAgICAgICAgICAgICAgICAgIGwuYnV0dG9uYWxpZ24gKyAiO3BhZGRpbmctYm90dG9tOjAuOGVtO3BhZGRpbmctdG9wOjAuNWVtO2JhY2tncm91bmQtaW1hZ2U6IG5vbmU7Ym9yZGVyLXdpZHRoOiAxcHggMCAwIDA7Jz48YSBpZD0nY2xvc2VkaWFsb2cnIGNsYXNzPSdmbS1idXR0b24gIiArIGsuYnV0dG9uICsgIic+IiArIGQgKyAiPC9hPiIgKyBnICsgIjwvZGl2PiIgOiAiIiAhPT0gZyA/ICI8ZGl2IGNsYXNzPSciICsgYi5oZWFkZXIgKyAiJyBzdHlsZT0ndGV4dC1hbGlnbjoiICsgbC5idXR0b25hbGlnbiArICI7cGFkZGluZy1ib3R0b206MC44ZW07cGFkZGluZy10b3A6MC41ZW07YmFja2dyb3VuZC1pbWFnZTogbm9uZTtib3JkZXItd2lkdGg6IDFweCAwIDAgMDsnPiIgKyBnICsgIjwvZGl2PiIgOiAiIjsKICAgICAgICAgICAgICAgICAgICBjICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJmYWxzZSIgPT09IGEoIiNpbmZvX2RpYWxvZyIpLmF0dHIoImFyaWEtaGlkZGVuIikgJiYgYS5qZ3JpZC5oaWRlTW9kYWwoIiNpbmZvX2RpYWxvZyIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogZQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiI2luZm9fZGlhbG9nIikucmVtb3ZlKCkKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7fQogICAgICAgICAgICAgICAgICAgIGEuamdyaWQuY3JlYXRlTW9kYWwoewogICAgICAgICAgICAgICAgICAgICAgICB0aGVtb2RhbDogImluZm9fZGlhbG9nIiwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxoZWFkOiAiaW5mb19oZWFkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxjb250ZW50OiAiaW5mb19jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWxtOiAiaW5mb2NudCIKICAgICAgICAgICAgICAgICAgICB9LCBjLCBsLCAiIiwgIiIsICEwKTsKICAgICAgICAgICAgICAgICAgICBnICYmIGEuZWFjaChsLmJ1dHRvbnMsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQodGhpcy5pZCksICIjaW5mb19pZCIpLmJpbmQoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbC5idXR0b25zW2JdLm9uQ2xpY2suY2FsbChhKCIjaW5mb19kaWFsb2ciKSksICExCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYSgiI2Nsb3NlZGlhbG9nIiwgIiNpbmZvX2lkIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmhpZGVNb2RhbCgiI2luZm9fZGlhbG9nIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogYSgiI2luZm9fZGlhbG9nIikuZGF0YSgib25DbG9zZSIpIHx8IGwub25DbG9zZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiBhKCIjaW5mb19kaWFsb2ciKS5kYXRhKCJnYm94IikgfHwgbC5nYm94CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGEoIi5mbS1idXR0b24iLCAiI2luZm9fZGlhbG9nIikuaG92ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKGsuaG92ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcyhrLmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24obC5iZWZvcmVPcGVuKSAmJiBsLmJlZm9yZU9wZW4oKTsKICAgICAgICAgICAgICAgICAgICBhLmpncmlkLnZpZXdNb2RhbCgiI2luZm9fZGlhbG9nIiwgewogICAgICAgICAgICAgICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudy5oaWRlKCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLm8gJiYgYS5vLnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsOiBsLm1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICBqcW06IGUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24obC5hZnRlck9wZW4pICYmIGwuYWZ0ZXJPcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2luZm9fZGlhbG9nIikuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHEpIHt9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmluZEV2OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGMuZGF0YUluaXQpICYmIGMuZGF0YUluaXQuY2FsbCh0aGlzLCBiLCBjKTsKICAgICAgICAgICAgICAgICAgICBjLmRhdGFFdmVudHMgJiYgYS5lYWNoKGMuZGF0YUV2ZW50cywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gdGhpcy5kYXRhID8gYShiKS5iaW5kKHRoaXMudHlwZSwgdGhpcy5kYXRhLCB0aGlzLmZuKSA6IGEoYikuYmluZCh0aGlzLnR5cGUsIHRoaXMuZm4pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjcmVhdGVFbDogZnVuY3Rpb24oYiwKICAgICAgICAgICAgICAgICAgICBjLCBkLCBnLCBsKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZShiLCBmLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gImRhdGFJbml0IGRhdGFFdmVudHMgZGF0YVVybCBidWlsZFNlbGVjdCBzb3B0IHNlYXJjaGhpZGRlbiBkZWZhdWx0VmFsdWUgYXR0ciBjdXN0b21fZWxlbWVudCBjdXN0b21fdmFsdWUgb3BlciIuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSBjICYmIGEuaXNBcnJheShjKSAmJiBhLm1lcmdlKGUsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goZiwgZnVuY3Rpb24oZiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLTEgPT09IGEuaW5BcnJheShmLCBlKSAmJiBhKGIpLmF0dHIoZiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYuaGFzT3duUHJvcGVydHkoImlkIikgfHwgYShiKS5hdHRyKCJpZCIsIGEuamdyaWQucmFuZElkKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBuID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPyBjLmNvbHMgfHwgYShuKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiOTglIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBjLmNvbHMgfHwgKGMuY29scyA9IDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucm93cyB8fCAoYy5yb3dzID0gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIiZuYnNwOyIgPT09IGQgfHwgIiYjMTYwOyIgPT09IGQgfHwgMSA9PT0gZC5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxNjAgPT09IGQuY2hhckNvZGVBdCgwKSkgJiYgKGQgPSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnZhbHVlID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUobiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKG4pLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU6ICJ0ZXh0Ym94IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU6ICJ0cnVlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLCBuLnR5cGUgPSAiY2hlY2tib3giLCBjLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBjLnZhbHVlLnNwbGl0KCI6Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9PT0gclswXSAmJiAobi5jaGVja2VkID0gITAsIG4uZGVmYXVsdENoZWNrZWQgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi52YWx1ZSA9IHJbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShuKS5hdHRyKCJvZmZ2YWwiLCByWzFdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHIgPSAoZCArICIiKS50b0xvd2VyQ2FzZSgpLCAwID4gci5zZWFyY2goLyhmYWxzZXxmfDB8bm98bnxvZmZ8dW5kZWZpbmVkKS9pKSAmJiAiIiAhPT0gciA/IChuLmNoZWNrZWQgPSAhMCwgbi5kZWZhdWx0Q2hlY2tlZCA9ICEwLCBuLnZhbHVlID0gZCkgOiBuLnZhbHVlID0gIm9uIiwgYShuKS5hdHRyKCJvZmZ2YWwiLCAib2ZmIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKG4sIGMsIFsidmFsdWUiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKG4pLmF0dHIoInJvbGUiLCAiY2hlY2tib3giKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zZXRBdHRyaWJ1dGUoInJvbGUiLCAic2VsZWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGMubXVsdGlwbGUgPyAociA9ICEwLCBuLm11bHRpcGxlID0gIm11bHRpcGxlIiwgYShuKS5hdHRyKCJhcmlhLW11bHRpc2VsZWN0YWJsZSIsICJ0cnVlIikpIDogciA9ICExLCBudWxsICE9IGMuZGF0YVVybCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGMucG9zdERhdGEgfHwgbC5wb3N0RGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gYy5yb3dJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEMpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgay5wICYmIGsucC5pZFByZWZpeCAmJiAociA9IGEuamdyaWQuc3RyaXBQcmVmKGsucC5pZFByZWZpeCwgcikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYWpheChhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYS5pc0Z1bmN0aW9uKGMuZGF0YVVybCkgPyBjLmRhdGFVcmwuY2FsbChrLCByLCBkLCBTdHJpbmcoYy5uYW1lKSkgOiBjLmRhdGFVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImh0bWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBhLmlzRnVuY3Rpb24ocSkgPyBxLmNhbGwoaywgciwgZCwgU3RyaW5nKGMubmFtZSkpIDogcSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbTogbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bDogZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgYyA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmVsZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMudmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAhMCA9PT0gbS5tdWx0aXBsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gITAgPT09IG0uY2FjaGVVcmxEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhLmlzRnVuY3Rpb24obS5idWlsZFNlbGVjdCkgPyBtLmJ1aWxkU2VsZWN0LmNhbGwoaywgYikgOiBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgKGIgPSBhKGEudHJpbShiKSkuaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgKGEoZCkuYXBwZW5kKGIpLCBlKGQsIG0sIHEgPyBbInBvc3REYXRhIl0gOiB2b2lkIDApLCB2b2lkIDAgPT09IG0uc2l6ZSAmJiAobS5zaXplID0gZyA/IDMgOiAxKSwgZyA/IChjID0gaC5zcGxpdCgiLCIpLCBjID0gYS5tYXAoYywgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnRyaW0oYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSA6IGNbMF0gPSBhLnRyaW0oaCksIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoIm9wdGlvbiIsIGQpLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGEodGhpcykudGV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEodGhpcykudmFsKCkgfHwgZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgJiYgKGwgKz0gKDAgIT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA/ICI7IiA6ICIiKSArIGggKyAiOiIgKyBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGIgJiYgZC5tdWx0aXBsZSAmJiAodGhpcy5zZWxlY3RlZCA9ICExKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYXR0cigicm9sZSIsICJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtMSA8IGEuaW5BcnJheShhLnRyaW0oZiksIGMpIHx8IC0xIDwgYS5pbkFycmF5KGEudHJpbShoKSwgYykpICYmICh0aGlzLnNlbGVjdGVkID0gInNlbGVjdGVkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIHcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiZWRpdCIgPT09IG0ub3BlcikgYShrKS5qcUdyaWQoInNldENvbFByb3AiLCBtLm5hbWUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRTZWxlY3Q6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoInNlYXJjaCIgPT09IG0ub3BlcikgYShrKS5qcUdyaWQoInNldENvbFByb3AiLCBtLm5hbWUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNob3B0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgiZmlsdGVyIiA9PT0gbS5vcGVyICYmIGEoIiNmYm94XyIgKyBrLnAuaWQpWzBdLnApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGUgPSBhKCIjZmJveF8iICsgay5wLmlkKVswXS5wLmNvbHVtbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiID0gdGhpcy5pbmRleCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSwgbS5uYW1lID09PSBiID8gKHRoaXMuc2VhcmNob3B0aW9ucy5kYXRhVXJsID0gbnVsbCwgdGhpcy5zZWFyY2hvcHRpb25zLnZhbHVlID0gbCwgITEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoaykudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFkZEVkaXRBZnRlclNlbGVjdFVybENvbXBsZXRlIiwgW2RdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBsIHx8IHt9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYy52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gYy5zaXplICYmIChjLnNpemUgPSByID8gMyA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgJiYgKGIgPSBkLnNwbGl0KCIsIiksIGIgPSBhLm1hcChiLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnRyaW0oYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgYy52YWx1ZSAmJiAoYy52YWx1ZSA9IGMudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUsIHosIHk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHZvaWQgMCA9PT0gYy5zZXBhcmF0b3IgPyAiOiIgOiBjLnNlcGFyYXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gdm9pZCAwID09PSBjLmRlbGltaXRlciA/ICI7IiA6IGMuZGVsaW1pdGVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYy52YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1ID0gYy52YWx1ZS5zcGxpdChsKSwgbCA9IDA7IGwgPCB1Lmxlbmd0aDsgbCsrKSB6ID0gdVtsXS5zcGxpdChnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgPCB6Lmxlbmd0aCAmJiAoelsxXSA9IGEubWFwKHosIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA8IGIgPyBhIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKGcpKSwgeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpLCB5LnNldEF0dHJpYnV0ZSgicm9sZSIsICJvcHRpb24iKSwgeS52YWx1ZSA9IHpbMF0sIHkuaW5uZXJIVE1MID0gelsxXSwgbi5hcHBlbmRDaGlsZCh5KSwgciB8fCBhLnRyaW0oelswXSkgIT09IGEudHJpbShkKSAmJiBhLnRyaW0oelsxXSkgIT09IGEudHJpbShkKSB8fCAoeS5zZWxlY3RlZCA9ICJzZWxlY3RlZCIpLCByICYmICgtMSA8IGEuaW5BcnJheShhLnRyaW0oelsxXSksIGIpIHx8IC0xIDwgYS5pbkFycmF5KGEudHJpbSh6WzBdKSwgYikpICYmICh5LnNlbGVjdGVkID0gInNlbGVjdGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIltvYmplY3QgQXJyYXldIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGMudmFsdWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSBjLnZhbHVlLCBsID0gMDsgbCA8IGcubGVuZ3RoOyBsKyspIDIgPT09IGdbbF0ubGVuZ3RoICYmICh1ID0gZ1tsXVswXSwgeiA9IGdbbF1bMV0sIHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuc2V0QXR0cmlidXRlKCJyb2xlIiwgIm9wdGlvbiIpLCB5LnZhbHVlID0gdSwgeS5pbm5lckhUTUwgPSB6LCBuLmFwcGVuZENoaWxkKHkpLCByIHx8IGEudHJpbSh1KSAhPT0gYS50cmltKGQpICYmIGEudHJpbSh6KSAhPT0gYS50cmltKGQpIHx8ICh5LnNlbGVjdGVkID0gInNlbGVjdGVkIiksIHIgJiYgKC0xIDwgYS5pbkFycmF5KGEudHJpbSh6KSwgYikgfHwgLTEgPCBhLmluQXJyYXkoYS50cmltKHUpLCBiKSkgJiYgKHkuc2VsZWN0ZWQgPSAic2VsZWN0ZWQiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGMudmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodSBpbiBnID0gYy52YWx1ZSwgZykgZy5oYXNPd25Qcm9wZXJ0eSh1KSAmJiAoeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpLCB5LnNldEF0dHJpYnV0ZSgicm9sZSIsICJvcHRpb24iKSwgeS52YWx1ZSA9IHUsIHkuaW5uZXJIVE1MID0gZ1t1XSwgbi5hcHBlbmRDaGlsZCh5KSwgciB8fCBhLnRyaW0odSkgIT09IGEudHJpbShkKSAmJiBhLnRyaW0oZ1t1XSkgIT09IGEudHJpbShkKSB8fCAoeS5zZWxlY3RlZCA9ICJzZWxlY3RlZCIpLCByICYmICgtMSA8IGEuaW5BcnJheShhLnRyaW0oZ1t1XSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKSB8fCAtMSA8IGEuaW5BcnJheShhLnRyaW0odSksIGIpKSAmJiAoeS5zZWxlY3RlZCA9ICJzZWxlY3RlZCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKG4sIGMsIFsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpbWFnZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZpbGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnR5cGUgPSBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZShuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjdXN0b20iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmlzRnVuY3Rpb24oYy5jdXN0b21fZWxlbWVudCkpIHRocm93ICJlMSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEsgPSBjLmN1c3RvbV9lbGVtZW50LmNhbGwoaywgZCwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFLKSB0aHJvdyAiZTIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSBhKEspLmFkZENsYXNzKCJjdXN0b21lbGVtZW50IikuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKG4pLmVtcHR5KCkuYXBwZW5kKEspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChDKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEuamdyaWQuZ2V0UmVnaW9uYWwoaywgImVycm9ycyIpLCBkID0gYS5qZ3JpZC5nZXRSZWdpb25hbChrLCAiZWRpdCIpLCAiZTEiID09PSBDID8gYS5qZ3JpZC5pbmZvX2RpYWxvZyhjLmVycmNhcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uICdjdXN0b21fZWxlbWVudCcgIiArIGQubXNnLm5vZGVmaW5lZCwgZC5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IGsucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogImUyIiA9PT0gQyA/IGEuamdyaWQuaW5mb19kaWFsb2coYy5lcnJjYXAsICJmdW5jdGlvbiAnY3VzdG9tX2VsZW1lbnQnICIgKyBkLm1zZy5ub3ZhbHVlLCBkLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBrLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYS5qZ3JpZC5pbmZvX2RpYWxvZyhjLmVycmNhcCwgInN0cmluZyIgPT0gdHlwZW9mIEMgPyBDIDogQy5tZXNzYWdlLCBkLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBrLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSAiYnV0dG9uIiA9PT0gYiA/ICJidXR0b24iIDogInRleHRib3giLCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSwgbi50eXBlID0gYiwgbi52YWx1ZSA9IGQsIGUobiwgYyksICJidXR0b24iICE9PSBiICYmIChnID8gYy5zaXplIHx8IGEobikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogIjk2JSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYy5zaXplIHx8IChjLnNpemUgPSAyMCkpLCBhKG4pLmF0dHIoInJvbGUiLCByKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNoZWNrRGF0ZTogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAoYSA9IGEudG9Mb3dlckNhc2UoKSwgYyA9IC0xICE9PSBhLmluZGV4T2YoIi8iKSA/ICIvIiA6IC0xICE9PSBhLmluZGV4T2YoIi0iKSA/ICItIiA6IC0xICE9PSBhLmluZGV4T2YoIi4iKSA/ICIuIiA6ICIvIiwgYSA9IGEuc3BsaXQoYyksIGIgPSBiLnNwbGl0KGMpLCAzICE9PSBiLmxlbmd0aCkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIHZhciBnLCBlLCBuID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBjID0gLTE7CiAgICAgICAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGEubGVuZ3RoOyBlKyspIGcgPSBpc05hTihiW2VdKSA/IDAgOiBwYXJzZUludChiW2VdLCAxMCksIGRbYVtlXV0gPSBnLCBnID0gYVtlXSwgLTEgIT09IGcuaW5kZXhPZigieSIpICYmIChuID0gZSksIC0xICE9PSBnLmluZGV4T2YoIm0iKSAmJiAoayA9IGUpLCAtMSAhPT0gZy5pbmRleE9mKCJkIikgJiYgKGMgPSBlKTsKICAgICAgICAgICAgICAgICAgICBnID0gInkiID09PSBhW25dIHx8ICJ5eXl5IiA9PT0gYVtuXSA/IDQgOiAieXkiID09PSBhW25dID8gMiA6IC0xOwogICAgICAgICAgICAgICAgICAgIHZhciByOwogICAgICAgICAgICAgICAgICAgIGUgPSBbMCwgMzEsIDI5LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV07IC0gMSA9PT0gbiA/IGQgPSAhMSA6IChyID0gZFthW25dXS50b1N0cmluZygpLCAyID09PSBnICYmIDEgPT09IHIubGVuZ3RoICYmIChnID0gMSksIHIubGVuZ3RoICE9PQogICAgICAgICAgICAgICAgICAgICAgICBnIHx8IDAgPT09IGRbYVtuXV0gJiYgIjAwIiAhPT0gYltuXSA/IGQgPSAhMSA6IC0xID09PSBrID8gZCA9ICExIDogKHIgPSBkW2Fba11dLnRvU3RyaW5nKCksIDEgPiByLmxlbmd0aCB8fCAxID4gZFthW2tdXSB8fCAxMiA8IGRbYVtrXV0gPyBkID0gITEgOiAtMSA9PT0gYyA/IGQgPSAhMSA6IChyID0gZFthW2NdXS50b1N0cmluZygpLCAhKGcgPSAxID4gci5sZW5ndGggfHwgMSA+IGRbYVtjXV0gfHwgMzEgPCBkW2FbY11dKSAmJiAoZyA9IDIgPT09IGRbYVtrXV0pICYmIChuID0gZFthW25dXSwgZyA9IGRbYVtjXV0gPiAoMCAhPT0gbiAlIDQgfHwgMCA9PT0gbiAlIDEwMCAmJiAwICE9PSBuICUgNDAwID8gMjggOiAyOSkpLCBkID0gZyB8fCBkW2FbY11dID4gZVtkW2Fba11dXSA/ICExIDogITApKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubWF0Y2goL15ccyskLykgfHwgIiIgPT09IGEgPyAhMCA6ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2hlY2tUaW1lOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSAvXihcZHsxLDJ9KTooXGR7Mn0pKFthcEFQXVtNbV0pPyQvOwogICAgICAgICAgICAgICAgICAgIGlmICghYS5qZ3JpZC5pc0VtcHR5KGIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYi5tYXRjaChkKSwgIWMpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNbM10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID4gY1sxXSB8fCAxMiA8IGNbMV0pIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKDIzIDwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbMV0pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDU5IDwgY1syXSkgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNoZWNrVmFsdWVzOiBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGwsIGUsIG4sIGssIHIgPSB0aGlzLnAuY29sTW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBhLmpncmlkLmdldFJlZ2lvbmFsKHRoaXMsICJlZGl0Lm1zZyIpOwogICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IDAsIGcgPSByLmxlbmd0aDsgZyA+IGQ7IGQrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyW2RdLm5hbWUgPT09IGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHJbZF0uZWRpdHJ1bGVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSByW2RdLmZvcm1vcHRpb25zICYmIChlID0gcltkXS5mb3Jtb3B0aW9ucy5sYWJlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIDAgPD0gYyAmJiAobCA9IHJbY10uZWRpdHJ1bGVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBsID0gZCwgZSA9IHZvaWQgMCA9PT0gZyA/ICJfIiA6IGc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgfHwgKGUgPSBudWxsICE9IHRoaXMucC5jb2xOYW1lcyA/IHRoaXMucC5jb2xOYW1lc1tjXSA6IHJbY10ubGFiZWwpLCAhMCA9PT0gbC5yZXF1aXJlZCAmJiBhLmpncmlkLmlzRW1wdHkoYikpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5yZXF1aXJlZCwgIiJdOwogICAgICAgICAgICAgICAgICAgICAgICBkID0gITEgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLnJlcXVpcmVkID8gITEgOiAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBsLm51bWJlciAmJiAoITEgIT09IGQgfHwgIWEuamdyaWQuaXNFbXB0eShiKSkgJiYgaXNOYU4oYikpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5udW1iZXIsICIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gbC5taW5WYWx1ZSAmJiAhaXNOYU4obC5taW5WYWx1ZSkgJiYgcGFyc2VGbG9hdChiKSA8IHBhcnNlRmxvYXQobC5taW5WYWx1ZSkpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5taW5WYWx1ZSArICIgIiArIGwubWluVmFsdWUsICIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gbC5tYXhWYWx1ZSAmJiAhaXNOYU4obC5tYXhWYWx1ZSkgJiYgcGFyc2VGbG9hdChiKSA+IHBhcnNlRmxvYXQobC5tYXhWYWx1ZSkpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5tYXhWYWx1ZSArICIgIiArIGwubWF4VmFsdWUsICIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gbC5lbWFpbCAmJiAhKCExID09PSBkICYmIGEuamdyaWQuaXNFbXB0eShiKSB8fCAodSA9IC9eKCgoW2Etel18XGR8WyEjXCQlJidcKlwrXC1cLz1cP1xeX2B7XHx9fl18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKyhcLihbYS16XXxcZHxbISNcJCUmJ1wqXCtcLVwvPVw/XF5fYHtcfH1+XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkrKSopfCgoXHgyMikoKCgoXHgyMHxceDA5KSooXHgwZFx4MGEpKT8oXHgyMHxceDA5KSspPygoW1x4MDEtXHgwOFx4MGJceDBjXHgwZS1ceDFmXHg3Zl18XHgyMXxbXHgyMy1ceDViXXxbXHg1ZC1ceDdlXXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KFxcKFtceDAxLVx4MDlceDBiXHgwY1x4MGQtXHg3Zl18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSkpKigoKFx4MjB8XHgwOSkqKFx4MGRceDBhKSk/KFx4MjB8XHgwOSkrKT8oXHgyMikpKUAoKChbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KChbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKihbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKVwuKSsoKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4/JC9pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUudGVzdChiKSkpKSByZXR1cm4gWyExLCBlICsgIjogIiArIHEuZW1haWwsICIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoITAgIT09IGwuaW50ZWdlciB8fCAhMSA9PT0gZCAmJiBhLmpncmlkLmlzRW1wdHkoYikgfHwgIWlzTmFOKGIpICYmIDAgPT09IGIgJSAxICYmIC0xID09PSBiLmluZGV4T2YoIi4iKSkpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5pbnRlZ2VyLCAiIl07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gbC5kYXRlICYmICEoITEgPT09IGQgJiYgYS5qZ3JpZC5pc0VtcHR5KGIpIHx8IChyW2NdLmZvcm1hdG9wdGlvbnMgJiYgcltjXS5mb3JtYXRvcHRpb25zLm5ld2Zvcm1hdCA/IChuID0gcltjXS5mb3JtYXRvcHRpb25zLm5ld2Zvcm1hdCwgayA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImZvcm1hdHRlci5kYXRlLm1hc2tzIiksIGsgJiYgay5oYXNPd25Qcm9wZXJ0eShuKSAmJiAobiA9IGtbbl0pKSA6IG4gPSByW2NdLmRhdGVmbXQgfHwgIlktbS1kIiwgYS5qZ3JpZC5jaGVja0RhdGUobiwgYikpKSkgcmV0dXJuIFshMSwgZSArICI6ICIgKyBxLmRhdGUgKyAiIC0gIiArIG4sICIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBsLnRpbWUgJiYgISghMSA9PT0gZCAmJiBhLmpncmlkLmlzRW1wdHkoYikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLmNoZWNrVGltZShiKSkpIHJldHVybiBbITEsIGUgKyAiOiAiICsgcS5kYXRlICsgIiAtIGhoOm1tIChhbS9wbSkiLCAiIl07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gbC51cmwgJiYgISghMSA9PT0gZCAmJiBhLmpncmlkLmlzRW1wdHkoYikgfHwgKHUgPSAvXigoKGh0dHBzPyl8KGZ0cCkpOlwvXC8oW1wtXHddK1wuKStcd3syLDN9KFwvWyVcLVx3XSsoXC5cd3syLH0pPykqKChbXHdcLVwuXD9cXFwvK0AmIztgfj0lIV0qKShcLlx3ezIsfSk/KSpcLz8pL2ksIHUudGVzdChiKSkpKSByZXR1cm4gWyExLCBlICsgIjogIiArIHEudXJsLCAiIl07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gbC5jdXN0b20gJiYgKCExICE9PSBkIHx8ICFhLmpncmlkLmlzRW1wdHkoYikpKSByZXR1cm4gYS5pc0Z1bmN0aW9uKGwuY3VzdG9tX2Z1bmMpID8gKGIgPSBsLmN1c3RvbV9mdW5jLmNhbGwodGhpcywgYiwgZSwgYyksIGEuaXNBcnJheShiKSA/IGIgOiBbITEsIHEuY3VzdG9tYXJyYXksICIiXSkgOiBbITEsIHEuY3VzdG9tZmNoZWNrLCAiIl0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFshMCwgIiIsICIiXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5mbi5qcUZpbHRlciA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmZuLmpxRmlsdGVyW2JdOwogICAgICAgICAgICAgICAgICAgIGlmICghYykgdGhyb3cgImpxRmlsdGVyIC0gTm8gc3VjaCBtZXRob2Q6ICIgKyBiOwogICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5hcHBseSh0aGlzLCBkKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGcgPSBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBbXSwKICAgICAgICAgICAgICAgICAgICBzb3J0U3RyYXRlZ3k6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJSZWRyYXc6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgY2hlY2tWYWx1ZXM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICExLAogICAgICAgICAgICAgICAgICAgIGVycm1zZzogIiIsCiAgICAgICAgICAgICAgICAgICAgZXJyb3JjaGVjazogITAsCiAgICAgICAgICAgICAgICAgICAgc2hvd1F1ZXJ5OiAhMCwKICAgICAgICAgICAgICAgICAgICBzb3B0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9wczogW10sCiAgICAgICAgICAgICAgICAgICAgb3BlcmFuZHM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbnVtb3B0czogImVxIG5lIGx0IGxlIGd0IGdlIG51IG5uIGluIG5pIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgIHN0cm9wdHM6ICJlcSBuZSBidyBibiBldyBlbiBjbiBuYyBudSBubiBpbiBuaSIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgICAgICBzdHJhcnI6IFsidGV4dCIsICJzdHJpbmciLCAiYmxvYiJdLAogICAgICAgICAgICAgICAgICAgIGdyb3VwT3BzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBvcDogIkFORCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJBTkQiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBvcDogIk9SIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIk9SIgogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgIGdyb3VwQnV0dG9uOiAhMCwKICAgICAgICAgICAgICAgICAgICBydWxlQnV0dG9uczogITAsCiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAibHRyIgogICAgICAgICAgICAgICAgfSwgYS5qZ3JpZC5maWx0ZXIsIGIgfHwge30pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucCA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT09IHRoaXMucC5maWx0ZXIgJiYgdm9pZCAwICE9PSB0aGlzLnAuZmlsdGVyIHx8ICh0aGlzLnAuZmlsdGVyID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBPcDogdGhpcy5wLmdyb3VwT3BzWzBdLm9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbXQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLnAuc29ydFN0cmF0ZWd5ICYmIGEuaXNGdW5jdGlvbih0aGlzLnAuc29ydFN0cmF0ZWd5KSAmJiB0aGlzLnAuY29sdW1ucy5zb3J0KHRoaXMucC5zb3J0U3RyYXRlZ3kpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYywgZiA9IHRoaXMucC5jb2x1bW5zLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAvbXNpZS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgIXdpbmRvdy5vcGVyYTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5pbml0RmlsdGVyID0gYS5leHRlbmQoITAsIHt9LCB0aGlzLnAuZmlsdGVyKSwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgZiA+IGI7IGIrKykgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmNvbHVtbnNbYl0sIGMuc3R5cGUgPyBjLmlucHV0dHlwZSA9IGMuc3R5cGUgOiBjLmlucHV0dHlwZSB8fCAoYy5pbnB1dHR5cGUgPSAidGV4dCIpLCBjLnNvcnR0eXBlID8gYy5zZWFyY2h0eXBlID0gYy5zb3J0dHlwZSA6IGMuc2VhcmNodHlwZSB8fCAoYy5zZWFyY2h0eXBlID0gInN0cmluZyIpLCB2b2lkIDAgPT09IGMuaGlkZGVuICYmIChjLmhpZGRlbiA9ICExKSwgYy5sYWJlbCB8fCAoYy5sYWJlbCA9IGMubmFtZSksIGMuaW5kZXggJiYgKGMubmFtZSA9IGMuaW5kZXgpLCBjLmhhc093blByb3BlcnR5KCJzZWFyY2hvcHRpb25zIikgfHwgKGMuc2VhcmNob3B0aW9ucyA9IHt9KSwgYy5oYXNPd25Qcm9wZXJ0eSgic2VhcmNocnVsZXMiKSB8fCAoYy5zZWFyY2hydWxlcyA9IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGcuaWQpKVswXSB8fCBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gYS5qZ3JpZC5zdHlsZVVJW2IucC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmZpbHRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gYS5qZ3JpZC5zdHlsZVVJW2IucC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmNvbW1vbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5zaG93UXVlcnkgJiYgYSh0aGlzKS5hcHBlbmQoIjx0YWJsZSBjbGFzcz0ncXVlcnlyZXN1bHQgIiArIG0udGFibGVfd2lkZ2V0ICsgIicgc3R5bGU9J2Rpc3BsYXk6YmxvY2s7bWF4LXdpZHRoOjQ0MHB4O2JvcmRlcjowcHggbm9uZTsnIGRpcj0nIiArIHRoaXMucC5kaXJlY3Rpb24gKyAiJz48dGJvZHk+PHRyPjx0ZCBjbGFzcz0ncXVlcnknPjwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgayA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IFshMCwgIiJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmlzRnVuY3Rpb24oYy5zZWFyY2hydWxlcykpIGYgPSBjLnNlYXJjaHJ1bGVzLmNhbGwoZSwgYiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYS5qZ3JpZCAmJiBhLmpncmlkLmNoZWNrVmFsdWVzKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYS5qZ3JpZC5jaGVja1ZhbHVlcy5jYWxsKGUsIGIsIC0xLCBjLnNlYXJjaHJ1bGVzLCBjLmxhYmVsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiAmJiBmLmxlbmd0aCAmJiAhMSA9PT0gZlswXSAmJiAoZy5lcnJvciA9ICFmWzBdLCBnLmVycm1zZyA9IGZbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnAuZXJyb3IgPSAhMSwgdGhpcy5wLmVycm1zZyA9ICIiLCBhLmlzRnVuY3Rpb24odGhpcy5wLm9uQ2hhbmdlKSA/IHRoaXMucC5vbkNoYW5nZS5jYWxsKHRoaXMsIHRoaXMucCkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVEcmF3ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGFibGUuZ3JvdXA6Zmlyc3QiLCB0aGlzKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuY3JlYXRlVGFibGVGb3JHcm91cChnLmZpbHRlciwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hcHBlbmQoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKHRoaXMucC5hZnRlclJlZHJhdykgJiYgdGhpcy5wLmFmdGVyUmVkcmF3LmNhbGwodGhpcywgdGhpcy5wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFibGVGb3JHcm91cCA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhKCI8dGFibGUgY2xhc3M9J2dyb3VwICIgKyBtLnRhYmxlX3dpZGdldCArICIgdWktc2VhcmNoLXRhYmxlJyBzdHlsZT0nYm9yZGVyOjBweCBub25lOyc+PHRib2R5PjwvdGJvZHk+PC90YWJsZT4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9ICJsZWZ0IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicnRsIiA9PT0gdGhpcy5wLmRpcmVjdGlvbiAmJiAoaCA9ICJyaWdodCIsIGQuYXR0cigiZGlyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJ0bCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSBjICYmIGQuYXBwZW5kKCI8dHIgY2xhc3M9J2Vycm9yJyBzdHlsZT0nZGlzcGxheTpub25lOyc+PHRoIGNvbHNwYW49JzUnIGNsYXNzPSciICsgdS5lcnJvciArICInIGFsaWduPSciICsgaCArICInPjwvdGg+PC90cj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGEoIjx0cj48L3RyPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuYXBwZW5kKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhKCI8dGggY29sc3Bhbj0nNScgYWxpZ249JyIgKyBoICsgIic+PC90aD4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobC5hcHBlbmQoaCksICEwID09PSB0aGlzLnAucnVsZUJ1dHRvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBhKCI8c2VsZWN0IGNsYXNzPSdvcHNlbCAiICsgbS5zclNlbGVjdCArICInPjwvc2VsZWN0PiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmFwcGVuZChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGcuZ3JvdXBPcHMubGVuZ3RoOyBmKyspIGwgPSBiLmdyb3VwT3AgPT09IGUucC5ncm91cE9wc1tmXS5vcCA/ICIgc2VsZWN0ZWQ9J3NlbGVjdGVkJyIgOiAiIiwgciArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIGUucC5ncm91cE9wc1tmXS5vcCArICInIiArIGwgKyAiPiIgKyBlLnAuZ3JvdXBPcHNbZl0udGV4dCArICI8L29wdGlvbj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmFwcGVuZChyKS5iaW5kKCJjaGFuZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5ncm91cE9wID0gYShuKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm9uY2hhbmdlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAiPHNwYW4+PC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5ncm91cEJ1dHRvbiAmJiAobCA9IGEoIjxpbnB1dCB0eXBlPSdidXR0b24nIHZhbHVlPScrIHt9JyB0aXRsZT0nQWRkIHN1Ymdyb3VwJyBjbGFzcz0nYWRkLWdyb3VwICIgKyB1LmJ1dHRvbiArICInLz4iKSwgbC5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYi5ncm91cHMgJiYgKGIuZ3JvdXBzID0gW10pLCBiLmdyb3Vwcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cE9wOiBnLmdyb3VwT3BzWzBdLm9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cHM6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZS5yZURyYXcoKSwgZS5vbmNoYW5nZSgpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksIGguYXBwZW5kKGwpLCAhMCA9PT0gdGhpcy5wLnJ1bGVCdXR0b25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrLCBsID0gYSgiPGlucHV0IHR5cGU9J2J1dHRvbicgdmFsdWU9JysnIHRpdGxlPSdBZGQgcnVsZScgY2xhc3M9J2FkZC1ydWxlIHVpLWFkZCAiICsgdS5idXR0b24gKyAiJy8+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuYmluZCgiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnJ1bGVzICYmIChiLnJ1bGVzID0gW10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGUucC5jb2x1bW5zLmxlbmd0aDsgZisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDAgPT09IGUucC5jb2x1bW5zW2ZdLnNlYXJjaCA/ICEwIDogZS5wLmNvbHVtbnNbZl0uc2VhcmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gITAgPT09IGUucC5jb2x1bW5zW2ZdLmhpZGRlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGUucC5jb2x1bW5zW2ZdLnNlYXJjaG9wdGlvbnMuc2VhcmNoaGlkZGVuICYmIGMgfHwgYyAmJiAhZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gZS5wLmNvbHVtbnNbZl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaCA9IGsuc2VhcmNob3B0aW9ucy5zb3B0ID8gay5zZWFyY2hvcHRpb25zLnNvcHQgOiBlLnAuc29wdCA/IGUucC5zb3B0IDogLTEgIT09IGEuaW5BcnJheShrLnNlYXJjaHR5cGUsIGUucC5zdHJhcnIpID8gZS5wLnN0cm9wdHMgOiBlLnAubnVtb3B0cywgYi5ydWxlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogay5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wOiBoWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZS5yZURyYXcoKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguYXBwZW5kKGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT09IGMgJiYgKGwgPSBhKCI8aW5wdXQgdHlwZT0nYnV0dG9uJyB2YWx1ZT0nLScgdGl0bGU9J0RlbGV0ZSBncm91cCcgY2xhc3M9J2RlbGV0ZS1ncm91cCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5idXR0b24gKyAiJy8+IiksIGguYXBwZW5kKGwpLCBsLmJpbmQoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBjLmdyb3Vwcy5sZW5ndGg7IGYrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmdyb3Vwc1tmXSA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuZ3JvdXBzLnNwbGljZShmLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5yZURyYXcoKSwgZS5vbmNoYW5nZSgpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBiLmdyb3VwcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGIuZ3JvdXBzLmxlbmd0aDsgZisrKSBoID0gYSgiPHRyPjwvdHI+IiksIGQuYXBwZW5kKGgpLCBsID0gYSgiPHRkIGNsYXNzPSdmaXJzdCc+PC90ZD4iKSwgaC5hcHBlbmQobCksIGwgPSBhKCI8dGQgY29sc3Bhbj0nNCc+PC90ZD4iKSwgbC5hcHBlbmQodGhpcy5jcmVhdGVUYWJsZUZvckdyb3VwKGIuZ3JvdXBzW2ZdLCBiKSksIGguYXBwZW5kKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIuZ3JvdXBPcCAmJiAoYi5ncm91cE9wID0gZS5wLmdyb3VwT3BzWzBdLm9wKSwgdm9pZCAwICE9PSBiLnJ1bGVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgYi5ydWxlcy5sZW5ndGg7IGYrKykgZC5hcHBlbmQodGhpcy5jcmVhdGVUYWJsZVJvd0ZvclJ1bGUoYi5ydWxlc1tmXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFibGVSb3dGb3JSdWxlID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBlLCBsLCBuLCBrLCB6ID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGEoIjx0cj48L3RyPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5hcHBlbmQoIjx0ZCBjbGFzcz0nZmlyc3QnPjwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEcgPSBhKCI8dGQgY2xhc3M9J2NvbHVtbnMnPjwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5hcHBlbmQoRyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFEsIGthID0gYSgiPHNlbGVjdCBjbGFzcz0nIiArIG0uc3JTZWxlY3QgKyAiJz48L3NlbGVjdD4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcuYXBwZW5kKGthKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrYS5iaW5kKCJjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5maWVsZCA9IGEoa2EpLnZhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYSh0aGlzKS5wYXJlbnRzKCJ0cjpmaXJzdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIuZGF0YSIsIGwpLmVtcHR5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCB6LnAuY29sdW1ucy5sZW5ndGg7IGYrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh6LnAuY29sdW1uc1tmXS5uYW1lID09PSBiLmZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHoucC5jb2x1bW5zW2ZdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnNlYXJjaG9wdGlvbnMuaWQgPSBhLmpncmlkLnJhbmRJZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zZWFyY2hvcHRpb25zLm5hbWUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnNlYXJjaG9wdGlvbnMub3BlciA9ICJmaWx0ZXIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiAidGV4dCIgPT09IG4uaW5wdXR0eXBlICYmIChuLnNlYXJjaG9wdGlvbnMuc2l6ZSB8fCAobi5zZWFyY2hvcHRpb25zLnNpemUgPSAxMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmpncmlkLmNyZWF0ZUVsLmNhbGwocCwgbi5pbnB1dHR5cGUsIG4uc2VhcmNob3B0aW9ucywgIiIsICEwLCB6LnAuYWpheFNlbGVjdE9wdGlvbnMgfHwge30sICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYykuYWRkQ2xhc3MoImlucHV0LWVsbSAiICsgbS5zcklucHV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBuLnNlYXJjaG9wdGlvbnMuc29wdCA/IG4uc2VhcmNob3B0aW9ucy5zb3B0IDogei5wLnNvcHQgPyB6LnAuc29wdCA6IC0xICE9PSBhLmluQXJyYXkobi5zZWFyY2h0eXBlLCB6LnAuc3RyYXJyKSA/IHoucC5zdHJvcHRzIDogei5wLm51bW9wdHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKHoucC5vcHMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIucHVzaCh0aGlzLm9wZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBlLmxlbmd0aDsgZisrKSBRID0gYS5pbkFycmF5KGVbZl0sIFIpLCAtMSAhPT0gUSAmJiAoMCA9PT0gZyAmJiAoYi5vcCA9IHoucC5vcHNbUV0ub3BlciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHoucC5vcHNbUV0ub3BlciArICInPiIgKyB6LnAub3BzW1FdLnRleHQgKyAiPC9vcHRpb24+IiwgZysrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKCIuc2VsZWN0b3B0cyIsIGwpLmVtcHR5KCkuYXBwZW5kKGgpLCBhKCIuc2VsZWN0b3B0cyIsIGwpWzBdLnNlbGVjdGVkSW5kZXggPSAwLCBhLmpncmlkLm1zaWUgJiYgOSA+IGEuamdyaWQubXNpZXZlcigpKSBoID0gcGFyc2VJbnQoYSgic2VsZWN0LnNlbGVjdG9wdHMiLCBsKVswXS5vZmZzZXRXaWR0aCwgMTApICsgMSwgYSgiLnNlbGVjdG9wdHMiLCBsKS53aWR0aChoKSwgYSgiLnNlbGVjdG9wdHMiLCBsKS5jc3MoIndpZHRoIiwgImF1dG8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIi5kYXRhIiwgbCkuYXBwZW5kKGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5iaW5kRXYuY2FsbChwLCBjLCBuLnNlYXJjaG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLmlucHV0LWVsbSIsIGwpLmJpbmQoImNoYW5nZSIsIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYy50YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5kYXRhID0gIlNQQU4iID09PSBjLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgJiYgbi5zZWFyY2hvcHRpb25zICYmIGEuaXNGdW5jdGlvbihuLnNlYXJjaG9wdGlvbnMuY3VzdG9tX3ZhbHVlKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2VhcmNob3B0aW9ucy5jdXN0b21fdmFsdWUuY2FsbChwLCBhKGMpLmNoaWxkcmVuKCIuY3VzdG9tZWxlbWVudDpmaXJzdCIpLCAiZ2V0IikgOiBjLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHoub25jaGFuZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZGF0YSA9IGEoYykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgei5vbmNoYW5nZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gRyA9IDA7IGYgPCB6LnAuY29sdW1ucy5sZW5ndGg7IGYrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IHZvaWQgMCA9PT0gei5wLmNvbHVtbnNbZl0uc2VhcmNoID8gITAgOiB6LnAuY29sdW1uc1tmXS5zZWFyY2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gITAgPT09IHoucC5jb2x1bW5zW2ZdLmhpZGRlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCEwID09PSB6LnAuY29sdW1uc1tmXS5zZWFyY2hvcHRpb25zLnNlYXJjaGhpZGRlbiAmJiBEIHx8IEQgJiYgIUkpICYmIChrID0gIiIsIGIuZmllbGQgPT09IHoucC5jb2x1bW5zW2ZdLm5hbWUgJiYgKGsgPSAiIHNlbGVjdGVkPSdzZWxlY3RlZCciLCBHID0gZiksIEogKz0gIjxvcHRpb24gdmFsdWU9JyIgKyB6LnAuY29sdW1uc1tmXS5uYW1lICsgIiciICsgayArICI+IiArIHoucC5jb2x1bW5zW2ZdLmxhYmVsICsgIjwvb3B0aW9uPiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGthLmFwcGVuZChKKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKID0gYSgiPHRkIGNsYXNzPSdvcGVyYXRvcnMnPjwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5hcHBlbmQoSik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGcuY29sdW1uc1tHXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnNlYXJjaG9wdGlvbnMuaWQgPSBhLmpncmlkLnJhbmRJZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgJiYgInRleHQiID09PSBuLmlucHV0dHlwZSAmJiAobi5zZWFyY2hvcHRpb25zLnNpemUgfHwgKG4uc2VhcmNob3B0aW9ucy5zaXplID0gMTApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnNlYXJjaG9wdGlvbnMubmFtZSA9IGIuZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zZWFyY2hvcHRpb25zLm9wZXIgPSAiZmlsdGVyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gYS5qZ3JpZC5jcmVhdGVFbC5jYWxsKHAsIG4uaW5wdXR0eXBlLCBuLnNlYXJjaG9wdGlvbnMsIGIuZGF0YSwgITAsIHoucC5hamF4U2VsZWN0T3B0aW9ucyB8fCB7fSwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudSIgIT09IGIub3AgJiYgIm5uIiAhPT0gYi5vcCB8fCAoYShHKS5hdHRyKCJyZWFkb25seSIsICJ0cnVlIiksIGEoRykuYXR0cigiZGlzYWJsZWQiLCAidHJ1ZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRiA9IGEoIjxzZWxlY3QgY2xhc3M9J3NlbGVjdG9wdHMgIiArIG0uc3JTZWxlY3QgKyAiJz48L3NlbGVjdD4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKLmFwcGVuZChGKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGLmJpbmQoImNoYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vcCA9IGEoRikudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYSh0aGlzKS5wYXJlbnRzKCJ0cjpmaXJzdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKCIuaW5wdXQtZWxtIiwgbClbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibnUiID09PSBiLm9wIHx8ICJubiIgPT09IGIub3AgPyAoYi5kYXRhID0gIiIsICJTRUxFQ1QiICE9PSBjLnRhZ05hbWUudG9VcHBlckNhc2UoKSAmJiAoYy52YWx1ZSA9ICIiKSwgYy5zZXRBdHRyaWJ1dGUoInJlYWRvbmx5IiwgInRydWUiKSwgYy5zZXRBdHRyaWJ1dGUoImRpc2FibGVkIiwgInRydWUiKSkgOiAoIlNFTEVDVCIgPT09IGMudGFnTmFtZS50b1VwcGVyQ2FzZSgpICYmIChiLmRhdGEgPSBjLnZhbHVlKSwgYy5yZW1vdmVBdHRyaWJ1dGUoInJlYWRvbmx5IiksIGMucmVtb3ZlQXR0cmlidXRlKCJkaXNhYmxlZCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHoub25jaGFuZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gbi5zZWFyY2hvcHRpb25zLnNvcHQgPyBuLnNlYXJjaG9wdGlvbnMuc29wdCA6IHoucC5zb3B0ID8gei5wLnNvcHQgOiAtMSAhPT0gYS5pbkFycmF5KG4uc2VhcmNodHlwZSwgei5wLnN0cmFycikgPyB6LnAuc3Ryb3B0cyA6IHoucC5udW1vcHRzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEogPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goei5wLm9wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSLnB1c2godGhpcy5vcGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgZS5sZW5ndGg7IGYrKykgUSA9IGEuaW5BcnJheShlW2ZdLCBSKSwgLTEgIT09IFEgJiYgKGsgPSBiLm9wID09PSB6LnAub3BzW1FdLm9wZXIgPyAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIsIEogKz0gIjxvcHRpb24gdmFsdWU9JyIgKyB6LnAub3BzW1FdLm9wZXIgKyAiJyIgKyBrICsgIj4iICsgei5wLm9wc1tRXS50ZXh0ICsgIjwvb3B0aW9uPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEYuYXBwZW5kKEopOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhKCI8dGQgY2xhc3M9J2RhdGEnPjwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5hcHBlbmQoayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgay5hcHBlbmQoRyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5iaW5kRXYuY2FsbChwLCBHLCBuLnNlYXJjaG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoRykuYWRkQ2xhc3MoImlucHV0LWVsbSAiICsgbS5zcklucHV0KS5iaW5kKCJjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5kYXRhID0gImN1c3RvbSIgPT09IG4uaW5wdXR0eXBlID8gbi5zZWFyY2hvcHRpb25zLmN1c3RvbV92YWx1ZS5jYWxsKHAsIGEodGhpcykuY2hpbGRyZW4oIi5jdXN0b21lbGVtZW50OmZpcnN0IiksICJnZXQiKSA6IGEodGhpcykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHoub25jaGFuZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhKCI8dGQ+PC90ZD4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5hcHBlbmQoayksICEwID09PSB0aGlzLnAucnVsZUJ1dHRvbnMpIEogPSBhKCI8aW5wdXQgdHlwZT0nYnV0dG9uJyB2YWx1ZT0nLScgdGl0bGU9J0RlbGV0ZSBydWxlJyBjbGFzcz0nZGVsZXRlLXJ1bGUgdWktZGVsICIgKyB1LmJ1dHRvbiArICInLz4iKSwgay5hcHBlbmQoSiksIEouYmluZCgiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGMucnVsZXMubGVuZ3RoOyBmKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5ydWxlc1tmXSA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucnVsZXMuc3BsaWNlKGYsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB6LnJlRHJhdygpLCB6Lm9uY2hhbmdlKCksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFN0cmluZ0Zvckdyb3VwID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBjID0gIigiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGEuZ3JvdXBzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5ncm91cHMubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPCBjLmxlbmd0aCAmJiAoYyArPSAiICIgKyBhLmdyb3VwT3AgKyAiICIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjICs9IHRoaXMuZ2V0U3RyaW5nRm9yR3JvdXAoYS5ncm91cHNbYl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucnVsZXMpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLnJ1bGVzLmxlbmd0aDsgYisrKSAxIDwgYy5sZW5ndGggJiYgKGMgKz0gIiAiICsgYS5ncm91cE9wICsgIiAiKSwgYyArPSB0aGlzLmdldFN0cmluZ0ZvclJ1bGUoYS5ydWxlc1tiXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjICs9ICIpIiwgIigpIiA9PT0gYyA/ICIiIDogYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0U3RyaW5nRm9yUnVsZSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZiwgZSwgZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBbImludCIsICJpbnRlZ2VyIiwgImZsb2F0IiwgIm51bWJlciIsICJjdXJyZW5jeSJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCB0aGlzLnAub3BzLmxlbmd0aDsgYysrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wLm9wc1tjXS5vcGVyID09PSBiLm9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5wLm9wZXJhbmRzLmhhc093blByb3BlcnR5KGIub3ApID8gdGhpcy5wLm9wZXJhbmRzW2Iub3BdIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5wLm9wc1tjXS5vcGVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCB0aGlzLnAuY29sdW1ucy5sZW5ndGg7IGMrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5jb2x1bW5zW2NdLm5hbWUgPT09IGIuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLnAuY29sdW1uc1tjXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBmID8gIiIgOiAoZSA9IGIuZGF0YSwgKCJidyIgPT09IGggfHwgImJuIiA9PT0gaCkgJiYgKGUgKz0gIiUiKSwgKCJldyIgPT09IGggfHwgImVuIiA9PT0gaCkgJiYgKGUgPSAiJSIgKyBlKSwgKCJjbiIgPT09IGggfHwgIm5jIiA9PT0gaCkgJiYgKGUgPSAiJSIgKyBlICsgIiUiKSwgKCJpbiIgPT09IGggfHwgIm5pIiA9PT0gaCkgJiYgKGUgPSAiICgiICsgZSArICIpIiksIGcuZXJyb3JjaGVjayAmJiBrKGIuZGF0YSwgZiksIC0xICE9PSBhLmluQXJyYXkoZi5zZWFyY2h0eXBlLCBtKSB8fCAibm4iID09PSBoIHx8ICJudSIgPT09IGggPyBiLmZpZWxkICsgIiAiICsgZCArICIgIiArIGUgOiBiLmZpZWxkICsgIiAiICsgZCArICcgIicgKyBlICsgJyInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRGaWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZmlsdGVyID0gYS5leHRlbmQoITAsIHt9LCB0aGlzLnAuaW5pdEZpbHRlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZURyYXcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uY2hhbmdlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRoLiIgKyB1LmVycm9yLCB0aGlzKS5odG1sKCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ci5lcnJvciIsIHRoaXMpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGguIiArIHUuZXJyb3IsIHRoaXMpLmh0bWwodGhpcy5wLmVycm1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRyLmVycm9yIiwgdGhpcykuc2hvdygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9Vc2VyRnJpZW5kbHlTdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJpbmdGb3JHcm91cChnLmZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYShjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBlID0gIigiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBjLmdyb3VwcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBjLmdyb3Vwcy5sZW5ndGg7IGYrKykgMSA8IGUubGVuZ3RoICYmIChlICs9ICJPUiIgPT09IGMuZ3JvdXBPcCA/ICIgfHwgIiA6ICIgJiYgIiksIGUgKz0gYShjLmdyb3Vwc1tmXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMucnVsZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgYy5ydWxlcy5sZW5ndGg7IGYrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPCBlLmxlbmd0aCAmJiAoZSArPSAiT1IiID09PSBjLmdyb3VwT3AgPyAiIHx8ICIgOiAiICYmICIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYy5ydWxlc1tmXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5wLmVycm9yY2hlY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaCA9IHZvaWQgMCwgbSA9IHZvaWQgMCwgaCA9IDA7IGggPCBiLnAuY29sdW1ucy5sZW5ndGg7IGgrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLnAuY29sdW1uc1toXS5uYW1lID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gYi5wLmNvbHVtbnNbaF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSAmJiBrKGQuZGF0YSwgbSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSArPSBkLm9wICsgIihpdGVtLiIgKyBkLmZpZWxkICsgIiwnIiArIGQuZGF0YSArICInKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgKz0gIikiLCAiKCkiID09PSBlID8gIiIgOiBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSh0aGlzLnAuZmlsdGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVEcmF3KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuc2hvd1F1ZXJ5ICYmIHRoaXMub25jaGFuZ2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZXh0ZW5kKGEuZm4uanFGaWx0ZXIsIHsKICAgICAgICAgICAgICAgIHRvU1FMU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9ICIiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLnRvVXNlckZyaWVuZGx5U3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB9KSwgYQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpbHRlckRhdGE6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLnAuZmlsdGVyCiAgICAgICAgICAgICAgICAgICAgfSksIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRQYXJhbWV0ZXI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBhICYmIHRoaXMucC5oYXNPd25Qcm9wZXJ0eShhKSA/IHRoaXMucFthXSA6IHRoaXMucAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlc2V0RmlsdGVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0RmlsdGVyKCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFkZEZpbHRlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBiICYmIChiID0gYS5qZ3JpZC5wYXJzZShiKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZmlsdGVyID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZURyYXcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmNoYW5nZSgpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuamdyaWQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGZpbHRlclRvb2xiYXI6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpc1swXSwgInNlYXJjaCIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICBhdXRvc2VhcmNoOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3NlYXJjaERlbGF5OiA1MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaE9uRW50ZXI6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZWFyY2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU2VhcmNoOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVDbGVhcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJDbGVhcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNodXJsOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nUmVzdWx0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBPcDogIkFORCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRTZWFyY2g6ICJidyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaE9wZXJhdG9yczogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0SWNvbjogIngiLAogICAgICAgICAgICAgICAgICAgICAgICBvcGVyYW5kczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXE6ICI9PSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZTogIiEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHQ6ICI8IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlOiAiPD0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Q6ICI+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlOiAiPj0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnc6ICJeIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJuOiAiIV4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImluIjogIj0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmk6ICIhPSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldzogInwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW46ICIhQCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbjogIn4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmM6ICIhfiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudTogIiMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm46ICIhIyIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIGMsIGIgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkLnAuZmlsdGVyVG9vbGJhcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5kYXRhKCJmaWx0ZXJUb29sYmFyIikgfHwgYShkKS5kYXRhKCJmaWx0ZXJUb29sYmFyIiwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuZm9yY2VfcmVnaW9uYWwgJiYgKGIgPSBhLmV4dGVuZChiLCBjKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZywgbCwgZSwgbiA9IGEuamdyaWQuc3R5bGVVSVtkLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5maWx0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEuamdyaWQuc3R5bGVVSVtkLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5jb21tb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGEuamdyaWQuc3R5bGVVSVtkLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5iYXNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGUsIG0sIGcgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goZC5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gYSgiI2dzXyIgKyBkLnAuaWRQcmVmaXggKyBhLmpncmlkLmpxSUQodGhpcy5uYW1lKSwgITAgPT09IHRoaXMuZnJvemVuICYmICEwID09PSBkLnAuZnJvemVuQ29sdW1ucyA/IGQuZ3JpZC5maERpdiA6IGQuZ3JpZC5oRGl2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0gdGhpcy5pbmRleCB8fCB0aGlzLm5hbWUsIG0gPSBiLnNlYXJjaE9wZXJhdG9ycyA/IG4ucGFyZW50KCkucHJldigpLmNoaWxkcmVuKCJhIikuYXR0cigic29wZXIiKSB8fCBiLmRlZmF1bHRTZWFyY2ggOiB0aGlzLnNlYXJjaG9wdGlvbnMgJiYgdGhpcy5zZWFyY2hvcHRpb25zLnNvcHQgPyB0aGlzLnNlYXJjaG9wdGlvbnMuc29wdFswXSA6ICJzZWxlY3QiID09PSB0aGlzLnN0eXBlID8gImVxIiA6IGIuZGVmYXVsdFNlYXJjaCwgYyA9ICJjdXN0b20iID09PSB0aGlzLnN0eXBlICYmIGEuaXNGdW5jdGlvbih0aGlzLnNlYXJjaG9wdGlvbnMuY3VzdG9tX3ZhbHVlKSAmJiAwIDwgbi5sZW5ndGggJiYgIlNQQU4iID09PSBuWzBdLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPyB0aGlzLnNlYXJjaG9wdGlvbnMuY3VzdG9tX3ZhbHVlLmNhbGwoZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5jaGlsZHJlbigiLmN1c3RvbWVsZW1lbnQ6Zmlyc3QiKSwgImdldCIpIDogbi52YWwoKSwgYyB8fCAibnUiID09PSBtIHx8ICJubiIgPT09IG0pIGdbZV0gPSBjLCBsW2VdID0gbSwgdysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkLnAucG9zdERhdGFbZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHEpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IDAgPCB3ID8gITAgOiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBiLnN0cmluZ1Jlc3VsdCB8fCAibG9jYWwiID09PSBkLnAuZGF0YXR5cGUgfHwgITAgPT09IGIuc2VhcmNoT3BlcmF0b3JzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSA9ICd7Imdyb3VwT3AiOiInICsgYi5ncm91cE9wICsgJyIsInJ1bGVzIjpbJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChnLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IHIgJiYgKHEgKz0gIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxICs9ICd7ImZpZWxkIjoiJyArIGEgKyAnIiwnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgKz0gJyJvcCI6IicgKyBsW2FdICsgJyIsJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxICs9ICciZGF0YSI6IicgKyAoYiArICIiKS5yZXBsYWNlKC9cXC9nLCAiXFxcXCIpLnJlcGxhY2UoL1wiL2csICdcXCInKSArICcifSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcisrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgKz0gIl19IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKGQucC5wb3N0RGF0YSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKFsic2VhcmNoRmllbGQiLCAic2VhcmNoU3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VhcmNoT3BlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAucG9zdERhdGEuaGFzT3duUHJvcGVydHkoYikgJiYgZGVsZXRlIGQucC5wb3N0RGF0YVtiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEuZXh0ZW5kKGQucC5wb3N0RGF0YSwgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuc2VhcmNodXJsICYmICh1ID0gZC5wLnVybCwgYShkKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZC5wLnNlYXJjaHVybAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gInN0b3AiID09PSBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRUb29sYmFyQmVmb3JlU2VhcmNoIikgPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhayAmJiBhLmlzRnVuY3Rpb24oYi5iZWZvcmVTZWFyY2gpICYmIChrID0gYi5iZWZvcmVTZWFyY2guY2FsbChkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgfHwgYShkKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaDogbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50cmlnZ2VyKCJyZWxvYWRHcmlkIiwgW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ICYmIGEoZCkuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZFRvb2xiYXJBZnRlclNlYXJjaCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oYi5hZnRlclNlYXJjaCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuYWZ0ZXJTZWFyY2guY2FsbChkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGZ1bmN0aW9uKGMsIGUsIG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI3NvcHRfbWVudSIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gcGFyc2VJbnQoZSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gcGFyc2VJbnQobSwgMTApICsgMTg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCB3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gJzx1bCBpZD0ic29wdF9tZW51IiBjbGFzcz0idWktc2VhcmNoLW1lbnUgbW9kYWwtY29udGVudCIgcm9sZT0ibWVudSIgdGFiaW5kZXg9IjAiIHN0eWxlPSJmb250LXNpemU6JyArIChhKCIudWktanFncmlkLXZpZXciKS5jc3MoImZvbnQtc2l6ZSIpIHx8ICIxMXB4IikgKyAiO2xlZnQ6IiArIGUgKyAicHg7dG9wOiIgKyBtICsgJ3B4OyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEoYykuYXR0cigic29wZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEoYykuYXR0cigiY29sbmFtZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHcgPSBkLnAuY29sTW9kZWwubGVuZ3RoOyB3ID4gciAmJiBkLnAuY29sTW9kZWxbcl0ubmFtZSAhPT0gdTspIHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGQucC5jb2xNb2RlbFtyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEuZXh0ZW5kKHt9LCByLnNlYXJjaG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnNvcHQgfHwgKHUuc29wdCA9IFtdLCB1LnNvcHRbMF0gPSAic2VsZWN0IiA9PT0gci5zdHlwZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXEiIDogYi5kZWZhdWx0U2VhcmNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGIub2RhdGEsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbC5wdXNoKHRoaXMub3BlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAociA9IDA7IHIgPCB1LnNvcHQubGVuZ3RoOyByKyspIHcgPSBhLmluQXJyYXkodS5zb3B0W3JdLCBsKSwgLTEgIT09IHcgJiYgKGcgPSBtID09PSBiLm9kYXRhW3ddLm9wZXIgPyBrLmhpZ2hsaWdodCA6ICIiLCBlICs9ICc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSAnICsgZyArICciIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9IicgKyBrLmNvcm5lcmFsbCArICcgZy1tZW51LWl0ZW0iIHRhYmluZGV4PSIwIiByb2xlPSJtZW51aXRlbSIgdmFsdWU9IicgKyBiLm9kYXRhW3ddLm9wZXIgKyAnIiBvcGVyPSInICsgYi5vcGVyYW5kc1tiLm9kYXRhW3ddLm9wZXJdICsgJyI+PHRhYmxlIGNsYXNzPSJ1aS1jb21tb24tdGFibGUiPjx0cj48dGQgd2lkdGg9IjI1cHgiPicgKyBiLm9wZXJhbmRzW2Iub2RhdGFbd10ub3Blcl0gKyAiPC90ZD48dGQ+IiArIGIub2RhdGFbd10udGV4dCArICI8L3RkPjwvdHI+PC90YWJsZT48L2E+PC9saT4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSArPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjwvdWw+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiYm9keSIpLmFwcGVuZChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI3NvcHRfbWVudSIpLmFkZENsYXNzKCJ1aS1tZW51ICIgKyBuLm1lbnVfd2lkZ2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI3NvcHRfbWVudSA+IGxpID4gYSIpLmhvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hZGRDbGFzcyhrLmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3Moay5ob3ZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGEodGhpcykuYXR0cigidmFsdWUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gYSh0aGlzKS5hdHRyKCJvcGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkVG9vbGJhclNlbGVjdE9wZXIiLCBbZSwgbSwgY10pLCBhKCIjc29wdF9tZW51IikuaGlkZSgpLCBhKGMpLnRleHQobSkuYXR0cigic29wZXIiLCBlKSwgITAgPT09IGIuYXV0b3NlYXJjaCkgbSA9IGEoYykucGFyZW50KCkubmV4dCgpLmNoaWxkcmVuKClbMF0sIChhKG0pLnZhbCgpIHx8ICJudSIgPT09IGUgfHwgIm5uIiA9PT0gZSkgJiYgcSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gYSgiPHRyIGNsYXNzPSd1aS1zZWFyY2gtdG9vbGJhcicgcm9sZT0ncm93Jz48L3RyPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5yZXN0b3JlRnJvbUZpbHRlcnMgJiYgKGUgPSBkLnAucG9zdERhdGEuZmlsdGVycywgZSAmJiAoInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgKGUgPSBhLmpncmlkLnBhcnNlKGUpKSwgbCA9IGUucnVsZXMubGVuZ3RoID8gZS5ydWxlcyA6ICExKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goZC5wLmNvbE1vZGVsLCBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIG0sIHUsIGssIEIsIHAsIHY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBOID0gIj0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMID0gYSgiPHRoIHJvbGU9J2NvbHVtbmhlYWRlcicgY2xhc3M9JyIgKyByLmhlYWRlckJveCArICIgdWktdGgtIiArIGQucC5kaXJlY3Rpb24gKyAiJyBpZD0nZ3NoXyIgKyBkLnAuaWQgKyAiXyIgKyB0aGlzLm5hbWUgKyAiJyA+PC90aD4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IGEoIjxkaXY+PC9kaXY+IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBhKCI8dGFibGUgY2xhc3M9J3VpLXNlYXJjaC10YWJsZScgY2VsbHNwYWNpbmc9JzAnPjx0cj48dGQgY2xhc3M9J3VpLXNlYXJjaC1vcGVyJyBoZWFkZXJzPScnPjwvdGQ+PHRkIGNsYXNzPSd1aS1zZWFyY2gtaW5wdXQnIGhlYWRlcnM9Jyc+PC90ZD48dGQgY2xhc3M9J3VpLXNlYXJjaC1jbGVhcicgaGVhZGVycz0nJz48L3RkPjwvdHI+PC90YWJsZT4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IHRoaXMuaGlkZGVuICYmIGEoTCkuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKSwgdGhpcy5zZWFyY2ggPSAhMSA9PT0gdGhpcy5zZWFyY2ggPyAhMSA6ICEwLCB2b2lkIDAgPT09IHRoaXMuc3R5cGUgJiYgKHRoaXMuc3R5cGUgPSAidGV4dCIpLCBlID0gYS5leHRlbmQoe30sIHRoaXMuc2VhcmNob3B0aW9ucyB8fCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5pbmRleCB8fCB0aGlzLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogImdzXyIgKyBkLnAuaWRQcmVmaXggKyB0aGlzLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAic2VhcmNoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5zZWFyY2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIucmVzdG9yZUZyb21GaWx0ZXJzICYmIGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHYgPSAhMSwgdSA9IDA7IHUgPCBsLmxlbmd0aDsgdSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsW3VdLmZpZWxkICYmICh0aGlzLmluZGV4IHx8IHRoaXMubmFtZSkgPT09IGxbdV0uZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGxbdV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5zZWFyY2hPcGVyYXRvcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBlLnNvcHQgPyBlLnNvcHRbMF0gOiAic2VsZWN0IiA9PT0gdGhpcy5zdHlwZSA/ICJlcSIgOiBiLmRlZmF1bHRTZWFyY2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnJlc3RvcmVGcm9tRmlsdGVycyAmJiB2ICYmIChtID0gdi5vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSAwOyB1IDwgYi5vZGF0YS5sZW5ndGg7IHUrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5vZGF0YVt1XS5vcGVyID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE4gPSBiLm9wZXJhbmRzW21dIHx8ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBudWxsICE9IGUuc2VhcmNodGl0bGUgPyBlLnNlYXJjaHRpdGxlIDogYi5vcGVyYW5kVGl0bGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gIjxhIHRpdGxlPSciICsgdSArICInIHN0eWxlPSdwYWRkaW5nLXJpZ2h0OiAwLjVlbTsnIHNvcGVyPSciICsgbSArICInIGNsYXNzPSdzb3B0Y2xhc3MnIGNvbG5hbWU9JyIgKyB0aGlzLm5hbWUgKyAiJz4iICsgTiArICI8L2E+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYSgidGQ6ZXEoMCkiLCBHKS5hdHRyKCJjb2xpbmRleCIsIGMpLmFwcGVuZChtKSwgdm9pZCAwID09PSBlLmNsZWFyU2VhcmNoICYmIChlLmNsZWFyU2VhcmNoID0gITApLCBlLmNsZWFyU2VhcmNoID8gKGsgPSBiLnJlc2V0VGl0bGUgfHwgIkNsZWFyIFNlYXJjaCBWYWx1ZSIsIGEoInRkOmVxKDIpIiwgRykuYXBwZW5kKCI8YSB0aXRsZT0nIiArIGsgKyAiJyBzdHlsZT0ncGFkZGluZy1yaWdodDogMC4zZW07cGFkZGluZy1sZWZ0OiAwLjNlbTsnIGNsYXNzPSdjbGVhcnNlYXJjaGNsYXNzJz4iICsgYi5yZXNldEljb24gKyAiPC9hPiIpKSA6IGEoInRkOmVxKDIpIiwgRykuaGlkZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXJsICYmIChlLmRhdGFVcmwgPSB0aGlzLnN1cmwpLCBCID0gIiIsIGUuZGVmYXVsdFZhbHVlICYmIChCID0gYS5pc0Z1bmN0aW9uKGUuZGVmYXVsdFZhbHVlKSA/IGUuZGVmYXVsdFZhbHVlLmNhbGwoZCkgOiBlLmRlZmF1bHRWYWx1ZSksIGIucmVzdG9yZUZyb21GaWx0ZXJzICYmIHYgJiYgKEIgPSB2LmRhdGEpLCBwID0gYS5qZ3JpZC5jcmVhdGVFbC5jYWxsKGQsIHRoaXMuc3R5cGUsIGUsIEIsICExLCBhLmV4dGVuZCh7fSwgYS5qZ3JpZC5hamF4T3B0aW9ucywgZC5wLmFqYXhTZWxlY3RPcHRpb25zIHx8IHt9KSksIGEocCkuYWRkQ2xhc3Mobi5zcklucHV0KSwgYSgidGQ6ZXEoMSkiLCBHKS5hcHBlbmQocCksIGEoSikuYXBwZW5kKEcpLCB0aGlzLnN0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBiLmF1dG9zZWFyY2ggJiYgKGUuZGF0YUV2ZW50cyA9IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJjaGFuZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcSgpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGIuYXV0b3NlYXJjaCAmJiAoZS5kYXRhRXZlbnRzID0gYi5zZWFyY2hPbkVudGVyID8gW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImtleXByZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxMyA9PT0gKGEuY2hhckNvZGUgfHwgYS5rZXlDb2RlIHx8IDApID8gKHEoKSwgITEpIDogdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0gOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAia2V5ZG93biIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEud2hpY2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIGNsZWFyVGltZW91dChnKSwgZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYi5hdXRvc2VhcmNoRGVsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLmJpbmRFdi5jYWxsKGQsIHAsIGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoTCkuYXBwZW5kKEopOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeikuYXBwZW5kKEwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc2VhcmNoT3BlcmF0b3JzIHx8IGEoInRkOmVxKDApIiwgRykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRhYmxlIHRoZWFkIiwgZC5ncmlkLmhEaXYpLmFwcGVuZCh6KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc2VhcmNoT3BlcmF0b3JzICYmIChhKCIuc29wdGNsYXNzIiwgeikuY2xpY2soZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKS5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1KHRoaXMsIGMubGVmdCwgYy50b3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCJib2R5Iikub24oImNsaWNrIiwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzb3B0Y2xhc3MiICE9PSBiLnRhcmdldC5jbGFzc05hbWUgJiYgYSgiI3NvcHRfbWVudSIpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLmNsZWFyc2VhcmNoY2xhc3MiLCB6KS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcykucGFyZW50cygidHI6Zmlyc3QiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBhcnNlSW50KGEoInRkLnVpLXNlYXJjaC1vcGVyIiwgYykuYXR0cigiY29saW5kZXgiKSwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gYS5leHRlbmQoe30sIGQucC5jb2xNb2RlbFtlXS5zZWFyY2hvcHRpb25zIHx8IHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IG0uZGVmYXVsdFZhbHVlID8gbS5kZWZhdWx0VmFsdWUgOiAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0IiA9PT0gZC5wLmNvbE1vZGVsW2VdLnN0eXBlID8gbSA/IGEoInRkLnVpLXNlYXJjaC1pbnB1dCBzZWxlY3QiLCBjKS52YWwobSkgOiBhKCJ0ZC51aS1zZWFyY2gtaW5wdXQgc2VsZWN0IiwgYylbMF0uc2VsZWN0ZWRJbmRleCA9IDAgOiBhKCJ0ZC51aS1zZWFyY2gtaW5wdXQgaW5wdXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKS52YWwobSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGIuYXV0b3NlYXJjaCAmJiBxKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmZpbHRlclRvb2xiYXIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlclRvb2xiYXIgPSBxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhclRvb2xiYXIgPSBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIG0gPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICJib29sZWFuIiAhPSB0eXBlb2YgYyA/ICEwIDogYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goZC5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMgPSBhKCIjZ3NfIiArIGQucC5pZFByZWZpeCArIGEuamdyaWQuanFJRCh0aGlzLm5hbWUpLCAhMCA9PT0gdGhpcy5mcm96ZW4gJiYgITAgPT09IGQucC5mcm96ZW5Db2x1bW5zID8gZC5ncmlkLmZoRGl2IDogZC5ncmlkLmhEaXYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2VhcmNob3B0aW9ucyAmJiB2b2lkIDAgIT09IHRoaXMuc2VhcmNob3B0aW9ucy5kZWZhdWx0VmFsdWUgJiYgKGIgPSB0aGlzLnNlYXJjaG9wdGlvbnMuZGVmYXVsdFZhbHVlKSwgZSA9IHRoaXMuaW5kZXggfHwgdGhpcy5uYW1lLCB0aGlzLnN0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiAodGhpcy5zZWxlY3RlZCA9ICEwKSwgYSh0aGlzKS52YWwoKSA9PT0gYiA/ICh0aGlzLnNlbGVjdGVkID0gITAsICExKSA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgdm9pZCAwICE9PSBiKSBtW2VdID0gYiwgZysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGQucC5wb3N0RGF0YVtlXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZXh0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy52YWwoYiB8fCAiIiksIHZvaWQgMCAhPT0gYikgbVtlXSA9IGIsIGcrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkLnAucG9zdERhdGFbZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY3VzdG9tIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24odGhpcy5zZWFyY2hvcHRpb25zLmN1c3RvbV92YWx1ZSkgJiYgMCA8IGMubGVuZ3RoICYmICJTUEFOIiA9PT0gY1swXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpICYmIHRoaXMuc2VhcmNob3B0aW9ucy5jdXN0b21fdmFsdWUuY2FsbChkLCBjLmNoaWxkcmVuKCIuY3VzdG9tZWxlbWVudDpmaXJzdCIpLCAic2V0IiwgYiB8fCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ID0gMCA8IGcgPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnAucmVzZXRzZWFyY2ggPSAhMCwgITAgPT09IGIuc3RyaW5nUmVzdWx0IHx8ICJsb2NhbCIgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5kYXRhdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9ICd7Imdyb3VwT3AiOiInICsgYi5ncm91cE9wICsgJyIsInJ1bGVzIjpbJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2gobSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IG4gJiYgKGwgKz0gIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgKz0gJ3siZmllbGQiOiInICsgYSArICciLCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsICs9ICcib3AiOiJlcSIsJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgKz0gJyJkYXRhIjoiJyArIChiICsgIiIpLnJlcGxhY2UoL1xcL2csICJcXFxcIikucmVwbGFjZSgvXCIvZywgJ1xcIicpICsgJyJ9JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4rKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCArPSAiXX0iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4dGVuZChkLnAucG9zdERhdGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChbInNlYXJjaEZpZWxkIiwgInNlYXJjaFN0cmluZyIsICJzZWFyY2hPcGVyIl0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5wb3N0RGF0YS5oYXNPd25Qcm9wZXJ0eShiKSAmJiBkZWxldGUgZC5wLnBvc3REYXRhW2JdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEuZXh0ZW5kKGQucC5wb3N0RGF0YSwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLnNlYXJjaHVybCAmJiAocSA9IGQucC51cmwsIGEoZCkuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZC5wLnNlYXJjaHVybAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9ICJzdG9wIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkVG9vbGJhckJlZm9yZUNsZWFyIikgPyAhMCA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFyICYmIGEuaXNGdW5jdGlvbihiLmJlZm9yZUNsZWFyKSAmJiAociA9IGIuYmVmb3JlQ2xlYXIuY2FsbChkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciB8fCBjICYmIGEoZCkuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaDogdwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRyaWdnZXIoInJlbG9hZEdyaWQiLCBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgJiYgYShkKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkVG9vbGJhckFmdGVyQ2xlYXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oYi5hZnRlckNsZWFyKSAmJiBiLmFmdGVyQ2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVG9vbGJhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSgidHIudWktc2VhcmNoLXRvb2xiYXIiLCBkLmdyaWQuaERpdiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAhMCA9PT0gZC5wLmZyb3plbkNvbHVtbnMgPyBhKCJ0ci51aS1zZWFyY2gtdG9vbGJhciIsIGQuZ3JpZC5maERpdikgOiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9uZSIgPT09IGIuY3NzKCJkaXNwbGF5IikgPyAoYi5zaG93KCksIGMgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5zaG93KCkpIDogKGIuaGlkZSgpLCBjICYmIGMuaGlkZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkZXN0cm95RmlsdGVyVG9vbGJhcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmZpbHRlclRvb2xiYXIgJiYgKHRoaXMudHJpZ2dlclRvb2xiYXIgPSBudWxsLCB0aGlzLmNsZWFyVG9vbGJhciA9IG51bGwsIHRoaXMudG9nZ2xlVG9vbGJhciA9IG51bGwsIHRoaXMucC5maWx0ZXJUb29sYmFyID0gITEsIGEodGhpcy5ncmlkLmhEaXYpLmZpbmQoInRhYmxlIHRoZWFkIHRyLnVpLXNlYXJjaC10b29sYmFyIikucmVtb3ZlKCkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZWFyY2hHcmlkOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmpncmlkLmdldFJlZ2lvbmFsKHRoaXNbMF0sICJzZWFyY2giKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA9IGEuZXh0ZW5kKCEwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY3JlYXRlRmlsdGVyOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZHJhZzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIHNGaWVsZDogInNlYXJjaEZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgc1ZhbHVlOiAic2VhcmNoU3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgc09wZXI6ICJzZWFyY2hPcGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgc0ZpbHRlcjogImZpbHRlcnMiLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkRGVmYXVsdHM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTaG93U2VhcmNoOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBhZnRlclNob3dTZWFyY2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uSW5pdGlhbGl6ZVNlYXJjaDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJSZWRyYXc6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQ2hhbmdlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBzb3J0U3RyYXRlZ3k6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlQWZ0ZXJTZWFyY2g6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUFmdGVyUmVzZXQ6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uRXNjYXBlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoT25FbnRlcjogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlU2VhcmNoOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGVHcm91cDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAganFNb2RhbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQ1MCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFoZWlnaHQ6ICJhdXRvIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1F1ZXJ5OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JjaGVjazogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIHNvcHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ1Jlc3VsdDogdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBvblNlYXJjaDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgb25SZXNldDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9Ub3A6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uczogW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcGxOYW1lczogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG1wbEZpbHRlcnM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcGxMYWJlbDogIiBUZW1wbGF0ZTogIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd09uTG9hZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBvcGVyYW5kczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXE6ICI9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lOiAiPD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHQ6ICI8IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlOiAiPD0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Q6ICI+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlOiAiPj0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnc6ICJMSUtFIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJuOiAiTk9UIExJS0UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImluIjogIklOIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5pOiAiTk9UIElOIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV3OiAiTElLRSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbjogIk5PVCBMSUtFIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNuOiAiTElLRSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYzogIk5PVCBMSUtFIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51OiAiSVMgTlVMTCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBubjogIklTTk9UIE5VTEwiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBjLCBiIHx8IHt9KSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRGaWx0ZXJCZWZvcmVTaG93IiwgW2hdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZyAmJiAoZyA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgJiYgYS5pc0Z1bmN0aW9uKGIuYmVmb3JlU2hvd1NlYXJjaCkgJiYgKGcgPSBiLmJlZm9yZVNob3dTZWFyY2guY2FsbChkLCBoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIChhLmpncmlkLnZpZXdNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoci50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGIuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogYi5tb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiBiLm92ZXJsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9Ub3A6IGIudG9Ub3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRGaWx0ZXJBZnRlclNob3ciLCBbaF0pLCBhLmlzRnVuY3Rpb24oYi5hZnRlclNob3dTZWFyY2gpICYmIGIuYWZ0ZXJTaG93U2VhcmNoLmNhbGwoZCwgaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSwgZSA9ICJmYm94XyIgKyBkLnAuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVtb2RhbDogInNlYXJjaG1vZCIgKyBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbGhlYWQ6ICJzZWFyY2hoZCIgKyBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbGNvbnRlbnQ6ICJzZWFyY2hjbnQiICsgZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWxtOiBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gZC5wLnBvc3REYXRhW2Iuc0ZpbHRlcl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEuamdyaWQuc3R5bGVVSVtkLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5maWx0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IGEuamdyaWQuc3R5bGVVSVtkLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5jb21tb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5zdHlsZVVJID0gZC5wLnN0eWxlVUksICJzdHJpbmciID09IHR5cGVvZiBxICYmIChxID0gYS5qZ3JpZC5wYXJzZShxKSksICEwID09PSBiLnJlY3JlYXRlRmlsdGVyICYmIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHIudGhlbW9kYWwpKS5yZW1vdmUoKSwgdm9pZCAwICE9PSBhKCIjIiArIGEuamdyaWQuanFJRChyLnRoZW1vZGFsKSlbMF0pIGMoYSgiI2Zib3hfIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5qcUlEKGQucC5pZCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gYSgiPGRpdj48ZGl2IGlkPSciICsgZSArICInIGNsYXNzPSdzZWFyY2hGaWx0ZXInIHN0eWxlPSdvdmVyZmxvdzphdXRvJz48L2Rpdj48L2Rpdj4iKS5pbnNlcnRCZWZvcmUoIiNndmlld18iICsgYS5qZ3JpZC5qcUlEKGQucC5pZCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gImxlZnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJ0bCIgPT09IGQucC5kaXJlY3Rpb24gJiYgKHAgPSAicmlnaHQiLCBDID0gIiBzdHlsZT0ndGV4dC1hbGlnbjpsZWZ0JyIsIHkuYXR0cigiZGlyIiwgInJ0bCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiwgQSA9IGEuZXh0ZW5kKFtdLCBkLnAuY29sTW9kZWwpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gIjxhIGlkPSciICsgZSArICJfc2VhcmNoJyBjbGFzcz0nZm0tYnV0dG9uICIgKyB6LmJ1dHRvbiArICIgZm0tYnV0dG9uLWljb24tcmlnaHQgdWktc2VhcmNoJz48c3BhbiBjbGFzcz0nIiArIHouaWNvbl9iYXNlICsgIiAiICsgdS5pY29uX3NlYXJjaCArICInPjwvc3Bhbj4iICsgYi5GaW5kICsgIjwvYT4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIID0gIjxhIGlkPSciICsgZSArICJfcmVzZXQnIGNsYXNzPSdmbS1idXR0b24gIiArIHouYnV0dG9uICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBmbS1idXR0b24taWNvbi1sZWZ0IHVpLXJlc2V0Jz48c3BhbiBjbGFzcz0nIiArIHouaWNvbl9iYXNlICsgIiAiICsgdS5pY29uX3Jlc2V0ICsgIic+PC9zcGFuPiIgKyBiLlJlc2V0ICsgIjwvYT4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE4gPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTCA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIuc2hvd1F1ZXJ5ICYmIChFID0gIjxhIGlkPSciICsgZSArICJfcXVlcnknIGNsYXNzPSdmbS1idXR0b24gIiArIHouYnV0dG9uICsgIiBmbS1idXR0b24taWNvbi1sZWZ0Jz48c3BhbiBjbGFzcz0nIiArIHouaWNvbl9iYXNlICsgIiAiICsgdS5pY29uX3F1ZXJ5ICsgIic+PC9zcGFuPlF1ZXJ5PC9hPiIpLCBiLmNvbHVtbnMubGVuZ3RoID8gKEEgPSBiLmNvbHVtbnMsIEogPSAwLCB2ID0gQVswXS5pbmRleCB8fCBBWzBdLm5hbWUpIDogYS5lYWNoKEEsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLmxhYmVsIHx8IChiLmxhYmVsID0gZC5wLmNvbE5hbWVzW2FdKSwgIUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHZvaWQgMCA9PT0gYi5zZWFyY2ggPyAhMCA6IGIuc2VhcmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gITAgPT09IGIuaGlkZGVuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChiLnNlYXJjaG9wdGlvbnMgJiYgITAgPT09IGIuc2VhcmNob3B0aW9ucy5zZWFyY2hoaWRkZW4gJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyB8fCBjICYmICFmKSAmJiAoTCA9ICEwLCB2ID0gYi5pbmRleCB8fCBiLm5hbWUsIEogPSBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgIXEgJiYgdiB8fCAhMSA9PT0gYi5tdWx0aXBsZVNlYXJjaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRyA9ICJlcSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPD0gSiAmJiBBW0pdLnNlYXJjaG9wdGlvbnMgJiYgQVtKXS5zZWFyY2hvcHRpb25zLnNvcHQgPyBHID0gQVtKXS5zZWFyY2hvcHRpb25zLnNvcHRbMF0gOiBiLnNvcHQgJiYgYi5zb3B0Lmxlbmd0aCAmJiAoRyA9IGIuc29wdFswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cE9wOiAiQU5EIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiB2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wOiBHLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnRtcGxOYW1lcyAmJiBiLnRtcGxOYW1lcy5sZW5ndGggJiYgKEwgPSAhMCwgTiA9ICI8dHI+PHRkIGNsYXNzPSd1aS1zZWFyY2gtbGFiZWwnPiIgKyBiLnRtcGxMYWJlbCArICI8L3RkPiIsIE4gKz0gIjx0ZD48c2VsZWN0IGNsYXNzPSd1aS10ZW1wbGF0ZSAiICsgdS5zclNlbGVjdCArICInPiIsIE4gKz0gIjxvcHRpb24gdmFsdWU9J2RlZmF1bHQnPkRlZmF1bHQ8L29wdGlvbj4iLCBhLmVhY2goYi50bXBsTmFtZXMsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiArPSAiPG9wdGlvbiB2YWx1ZT0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICsgIic+IiArIGIgKyAiPC9vcHRpb24+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBOICs9ICI8L3NlbGVjdD48L3RkPjwvdHI+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICI8dGFibGUgY2xhc3M9J0VkaXRUYWJsZScgc3R5bGU9J2JvcmRlcjowcHggbm9uZTttYXJnaW4tdG9wOjVweCcgaWQ9JyIgKyBlICsgIl8yJz48dGJvZHk+PHRyPjx0ZCBjb2xzcGFuPScyJz48aHIgY2xhc3M9JyIgKyB6LmNvbnRlbnQgKyAiJyBzdHlsZT0nbWFyZ2luOjFweCcvPjwvdGQ+PC90cj4iICsgTiArICI8dHI+PHRkIGNsYXNzPSdFZGl0QnV0dG9uJyBzdHlsZT0ndGV4dC1hbGlnbjoiICsgcCArICInPiIgKyBIICsgIjwvdGQ+PHRkIGNsYXNzPSdFZGl0QnV0dG9uJyAiICsgQyArICI+IiArIEUgKyB4ICsgIjwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5qcUlEKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgZSkuanFGaWx0ZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBBLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0U3RyYXRlZ3k6IGIuc29ydFN0cmF0ZWd5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IGIubG9hZERlZmF1bHRzID8gcSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dRdWVyeTogYi5zaG93UXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yY2hlY2s6IGIuZXJyb3JjaGVjaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29wdDogYi5zb3B0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cEJ1dHRvbjogYi5tdWx0aXBsZUdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlQnV0dG9uczogYi5tdWx0aXBsZVNlYXJjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJSZWRyYXc6IGIuYWZ0ZXJSZWRyYXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wczogYi5vZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmFuZHM6IGIub3BlcmFuZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXhTZWxlY3RPcHRpb25zOiBkLnAuYWpheFNlbGVjdE9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwT3BzOiBiLmdyb3VwT3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuc2hvd1F1ZXJ5ICYmIGEoIi5xdWVyeSIsIHRoaXMpLmh0bWwodGhpcy50b1VzZXJGcmllbmRseVN0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihiLmFmdGVyQ2hhbmdlKSAmJiBiLmFmdGVyQ2hhbmdlLmNhbGwoZCwgYSgiIyIgKyBlKSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBkLnAuZGlyZWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZC5wLmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5hcHBlbmQodSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTCAmJiBiLnRtcGxGaWx0ZXJzICYmIGIudG1wbEZpbHRlcnMubGVuZ3RoICYmIGEoIi51aS10ZW1wbGF0ZSIsIHkpLmJpbmQoImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiZGVmYXVsdCIgPT09IGMgPyBhKCIjIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKS5qcUZpbHRlcigiYWRkRmlsdGVyIiwgcSkgOiBhKCIjIiArIGUpLmpxRmlsdGVyKCJhZGRGaWx0ZXIiLCBiLnRtcGxGaWx0ZXJzW3BhcnNlSW50KGMsIDEwKV0pLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBiLm11bHRpcGxlR3JvdXAgJiYgKGIubXVsdGlwbGVTZWFyY2ggPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkRmlsdGVySW5pdGlhbGl6ZSIsIFthKCIjIiArIGUpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGIub25Jbml0aWFsaXplU2VhcmNoKSAmJiBiLm9uSW5pdGlhbGl6ZVNlYXJjaC5jYWxsKGQsIGEoIiMiICsgZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZ2JveCA9ICIjZ2JveF8iICsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmxheWVyID8gYS5qZ3JpZC5jcmVhdGVNb2RhbChyLCB5LCBiLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSwgYSgiI2dib3hfIiArIGEuamdyaWQuanFJRChkLnAuaWQpKVswXSwgIiMiICsgYS5qZ3JpZC5qcUlEKGIubGF5ZXIpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBhLmpncmlkLmNyZWF0ZU1vZGFsKHIsIHksIGIsICIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChkLnAuaWQpLCBhKCIjZ2JveF8iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5qcUlEKGQucC5pZCkpWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYi5zZWFyY2hPbkVudGVyIHx8IGIuY2xvc2VPbkVzY2FwZSkgJiYgYSgiIyIgKyBhLmpncmlkLmpxSUQoci50aGVtb2RhbCkpLmtleWRvd24oZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEoYy50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWIuc2VhcmNoT25FbnRlciB8fCAxMyAhPT0gYy53aGljaCB8fCBkLmhhc0NsYXNzKCJhZGQtZ3JvdXAiKSB8fCBkLmhhc0NsYXNzKCJhZGQtcnVsZSIpIHx8IGQuaGFzQ2xhc3MoImRlbGV0ZS1ncm91cCIpIHx8IGQuaGFzQ2xhc3MoImRlbGV0ZS1ydWxlIikgfHwgZC5oYXNDbGFzcygiZm0tYnV0dG9uIikgJiYgZC5pcygiW2lkJD1fcXVlcnldIikgPyBiLmNsb3NlT25Fc2NhcGUgJiYgMjcgPT09IGMud2hpY2ggPyAoYSgiIyIgKyBhLmpncmlkLmpxSUQoci5tb2RhbGhlYWQpKS5maW5kKCIudWktanFkaWFsb2ctdGl0bGViYXItY2xvc2UiKS5jbGljaygpLCAhMSkgOiB2b2lkIDAgOiAoYSgiIyIgKyBlICsgIl9zZWFyY2giKS5jbGljaygpLCAhMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFICYmIGEoIiMiICsgZSArICJfcXVlcnkiKS5iaW5kKCJjbGljayIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIi5xdWVyeXJlc3VsdCIsIHkpLnRvZ2dsZSgpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGIuc3RyaW5nUmVzdWx0ICYmIChiLnN0cmluZ1Jlc3VsdCA9IGIubXVsdGlwbGVTZWFyY2gpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgZSArICJfc2VhcmNoIikuYmluZCgiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGgsIGcgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0gPSBhKCIjIiArIGUpLCBtLmZpbmQoIi5pbnB1dC1lbG06Zm9jdXMiKS5jaGFuZ2UoKSwgaCA9IG0uanFGaWx0ZXIoImZpbHRlckRhdGEiKSwgYi5lcnJvcmNoZWNrICYmIChtWzBdLmhpZGVFcnJvcigpLCBiLnNob3dRdWVyeSB8fCBtLmpxRmlsdGVyKCJ0b1NRTFN0cmluZyIpLCBtWzBdLnAuZXJyb3IpKSByZXR1cm4gbVswXS5zaG93RXJyb3IoKSwgITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLnN0cmluZ1Jlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gSlNPTi5zdHJpbmdpZnkoaCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKG4pIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgYyAmJiAoZ1tiLnNGaWx0ZXJdID0gYywgYS5lYWNoKFtiLnNGaWVsZCwgYi5zVmFsdWUsIGIuc09wZXJdLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnW3RoaXNdID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYi5tdWx0aXBsZVNlYXJjaCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ1tiLnNGaWx0ZXJdID0gaCwgYS5lYWNoKFtiLnNGaWVsZCwgYi5zVmFsdWUsIGIuc09wZXJdLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnW3RoaXNdID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSA6IChnW2Iuc0ZpZWxkXSA9IGgucnVsZXNbMF0uZmllbGQsIGdbYi5zVmFsdWVdID0gaC5ydWxlc1swXS5kYXRhLCBnW2Iuc09wZXJdID0gaC5ydWxlc1swXS5vcCwgZ1tiLnNGaWx0ZXJdID0gIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wLnNlYXJjaCA9ICEwLCBhLmV4dGVuZChkLnAucG9zdERhdGEsIGcpLCBrID0gYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkRmlsdGVyU2VhcmNoIiksIHZvaWQgMCA9PT0gayAmJiAoayA9ICEwKSwgayAmJiBhLmlzRnVuY3Rpb24oYi5vblNlYXJjaCkgJiYgKGsgPSBiLm9uU2VhcmNoLmNhbGwoZCwgZC5wLmZpbHRlcnMpKSwgITEgIT09IGsgJiYgYShkKS50cmlnZ2VyKCJyZWxvYWRHcmlkIiwgW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0pLCBiLmNsb3NlQWZ0ZXJTZWFyY2ggJiYgYS5qZ3JpZC5oaWRlTW9kYWwoIiMiICsgYS5qZ3JpZC5qcUlEKHIudGhlbW9kYWwpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYjogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYi5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogYi5vbkNsb3NlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgZSArICJfcmVzZXQiKS5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEoIiMiICsgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnAuc2VhcmNoID0gITEsIGQucC5yZXNldHNlYXJjaCA9ICEwLCAhMSA9PT0gYi5tdWx0aXBsZVNlYXJjaCA/IGNbYi5zRmllbGRdID0gY1tiLnNWYWx1ZV0gPSBjW2Iuc09wZXJdID0gIiIgOiBjW2Iuc0ZpbHRlcl0gPSAiIiwgaFswXS5yZXNldEZpbHRlcigpLCBMICYmIGEoIi51aS10ZW1wbGF0ZSIsIHkpLnZhbCgiZGVmYXVsdCIpLCBhLmV4dGVuZChkLnAucG9zdERhdGEsIGMpLCBrID0gYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkRmlsdGVyUmVzZXQiKSwgdm9pZCAwID09PSBrICYmIChrID0gITApLCBrICYmIGEuaXNGdW5jdGlvbihiLm9uUmVzZXQpICYmIChrID0gYi5vblJlc2V0LmNhbGwoZCkpLCAhMSAhPT0gayAmJiBhKGQpLnRyaWdnZXIoInJlbG9hZEdyaWQiLCBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSksIGIuY2xvc2VBZnRlclJlc2V0ICYmIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChyLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKGQucC5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGIuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGIub25DbG9zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKGEoIiMiICsgZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIi5mbS1idXR0b246bm90KC4iICsgei5kaXNhYmxlZCArICIpIiwgeSkuaG92ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYWRkQ2xhc3Moei5ob3ZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcyh6LmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGsgPSB7fTsKICAgICAgICAgICAgaWYgKGEuamdyaWQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICBlZGl0R3JpZFJvdzogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpc1swXSwgImVkaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzWzBdLnAuc3R5bGVVSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLmpncmlkLnN0eWxlVUlbZ10uZm9ybWVkaXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5zdHlsZVVJW2ddLmNvbW1vbjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPSBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiNTAwIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF3aWR0aDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWc6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG10eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckFmdGVyQWRkOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlQWZ0ZXJFZGl0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbG9hZEFmdGVyU3VibWl0OiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uSW5pdGlhbGl6ZUZvcm06IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVJbml0RGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNob3dGb3JtOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJTaG93Rm9ybTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVN1Ym1pdDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU3VibWl0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGlja1N1Ym1pdDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQ29tcGxldGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrUGdCdXR0b25zOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJjbGlja1BnQnV0dG9uczogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXREYXRhOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3JlYXRlRm9ybTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcU1vZGFsOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Fc2NhcGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWRyb3c6ICJmaXJzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BpbmZvOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbWluZm86ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWljb246IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VpY29uOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVrZXk6IFshMSwgMTNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2a2V5czogWyExLCAzOCwgNDBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tPblN1Ym1pdDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja09uVXBkYXRlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zYXZlZERhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZzogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWpheEVkaXRPcHRpb25zOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUVkaXREYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld1BhZ2VyQnV0dG9uczogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5Q2xhc3M6IGUub3ZlcmxheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06ICJlZGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNGaWVsZDogITAKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwgYyB8fCB7fSksIGtbYSh0aGlzKVswXS5wLmlkXSA9IGMsIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoRCkuZmluZCgiLkZvcm1FbGVtZW50IikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKCIuY3VzdG9tZWxlbWVudCIsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYShiWzBdKS5hdHRyKCJuYW1lIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goeC5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lID09PSBjICYmIHRoaXMuZWRpdG9wdGlvbnMgJiYgYS5pc0Z1bmN0aW9uKHRoaXMuZWRpdG9wdGlvbnMuY3VzdG9tX3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEVbY10gPSB0aGlzLmVkaXRvcHRpb25zLmN1c3RvbV92YWx1ZS5jYWxsKHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGMpLCBEKSwgImdldCIpLCB2b2lkIDAgPT09IEVbY10pIHRocm93ICJlMSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJlMSIgPT09IGIgPyBhLmpncmlkLmluZm9fZGlhbG9nKFMuZXJyY2FwLCAiZnVuY3Rpb24gJ2N1c3RvbV92YWx1ZScgIiArIGtbYSh0aGlzKVswXV0ucC5tc2cubm92YWx1ZSwga1thKHRoaXMpWzBdXS5wLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IGtbYSh0aGlzKVswXV0ucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGEuamdyaWQuaW5mb19kaWFsb2coUy5lcnJjYXAsIGIubWVzc2FnZSwga1thKHRoaXMpWzBdXS5wLmJDbG9zZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IGtbYSh0aGlzKVswXV0ucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEodGhpcykuZ2V0KDApLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjaGVja2JveCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuaXMoIjpjaGVja2VkIikgPyBFW3RoaXMubmFtZV0gPSBhKHRoaXMpLnZhbCgpIDogKGIgPSBhKHRoaXMpLmF0dHIoIm9mZnZhbCIpLCBFW3RoaXMubmFtZV0gPSBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2VsZWN0LW9uZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVbdGhpcy5uYW1lXSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJvcHRpb246c2VsZWN0ZWQiLCB0aGlzKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2VsZWN0LW11bHRpcGxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVt0aGlzLm5hbWVdID0gYSh0aGlzKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVt0aGlzLm5hbWVdID0gRVt0aGlzLm5hbWVdID8gRVt0aGlzLm5hbWVdLmpvaW4oIiwiKSA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJvcHRpb246c2VsZWN0ZWQiLCB0aGlzKS5lYWNoKGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYykudGV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXNzd29yZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGV4dGFyZWEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJ1dHRvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVbdGhpcy5uYW1lXSA9IGEodGhpcykudmFsKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgucC5hdXRvZW5jb2RlICYmIChFW3RoaXMubmFtZV0gPSBhLmpncmlkLmh0bWxFbmNvZGUoRVt0aGlzLm5hbWVdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGgoYiwgYywgZiwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBtLCBnLCB3LCBuLCBxLCByLCB1ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHIgPSAxOyBlID49IHI7IHIrKykgeiArPSAiPHRkIGNsYXNzPSdDYXB0aW9uVEQnPiYjMTYwOzwvdGQ+PHRkIGNsYXNzPSdEYXRhVEQnPiYjMTYwOzwvdGQ+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIl9lbXB0eSIgIT09IGIgJiYgKEIgPSBhKGMpLmpxR3JpZCgiZ2V0SW5kIiwgYikpLCBhKGMucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbihoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IHRoaXMubmFtZSwgbSA9IHRoaXMuZWRpdHJ1bGVzICYmICEwID09PSB0aGlzLmVkaXRydWxlcy5lZGl0aGlkZGVuID8gITEgOiAhMCA9PT0gdGhpcy5oaWRkZW4gPyAhMCA6ICExLCBuID0gbSA/ICJzdHlsZT0nZGlzcGxheTpub25lJyIgOiAiIiwgImNiIiAhPT0gZCAmJiAic3ViZ3JpZCIgIT09IGQgJiYgITAgPT09IHRoaXMuZWRpdGFibGUgJiYgInJuIiAhPT0gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMSA9PT0gQikgdyA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGQgPT09IGMucC5FeHBhbmRDb2x1bW4gJiYgITAgPT09IGMucC50cmVlR3JpZCkgdyA9IGEoInRkW3JvbGU9J2dyaWRjZWxsJ106ZXEoIiArIGggKyAiKSIsIGMucm93c1tCXSkudGV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IGEudW5mb3JtYXQuY2FsbChjLCBhKCJ0ZFtyb2xlPSdncmlkY2VsbCddOmVxKCIgKyBoICsgIikiLCBjLnJvd3NbQl0pLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTW9kZWw6IHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB0aGlzLmVkaXR0eXBlICYmICJ0ZXh0YXJlYSIgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0dHlwZSA/IGEoInRkW3JvbGU9J2dyaWRjZWxsJ106ZXEoIiArIGggKyAiKSIsIGMucm93c1tCXSkudGV4dCgpIDogYSgidGRbcm9sZT0nZ3JpZGNlbGwnXTplcSgiICsgaCArICIpIiwgYy5yb3dzW0JdKS5odG1sKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSghdyB8fCAiJm5ic3A7IiA9PT0gdyB8fCAiJiMxNjA7IiA9PT0gdyB8fCAxID09PSB3Lmxlbmd0aCAmJiAxNjAgPT09IHcuY2hhckNvZGVBdCgwKSkgJiYgKHcgPSAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBhLmV4dGVuZCh7fSwgdGhpcy5lZGl0b3B0aW9ucyB8fCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAiZWRpdCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBhLmV4dGVuZCh7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtcHJlZml4OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbXN1ZmZpeDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dhYm92ZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3djb250ZW50OiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmZvcm1vcHRpb25zIHx8IHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IHBhcnNlSW50KHAucm93cG9zLCAxMCkgfHwgdSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBwYXJzZUludCgyICogKHBhcnNlSW50KHAuY29scG9zLCAxMCkgfHwgMSksIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIl9lbXB0eSIgPT09IGIgJiYgeS5kZWZhdWx0VmFsdWUgJiYgKHcgPSBhLmlzRnVuY3Rpb24oeS5kZWZhdWx0VmFsdWUpID8geS5kZWZhdWx0VmFsdWUuY2FsbCh4KSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LmRlZmF1bHRWYWx1ZSksIHRoaXMuZWRpdHR5cGUgfHwgKHRoaXMuZWRpdHR5cGUgPSAidGV4dCIpLCB4LnAuYXV0b2VuY29kZSAmJiAodyA9IGEuamdyaWQuaHRtbERlY29kZSh3KSksIHEgPSBhLmpncmlkLmNyZWF0ZUVsLmNhbGwoeCwgdGhpcy5lZGl0dHlwZSwgeSwgdywgITEsIGEuZXh0ZW5kKHt9LCBhLmpncmlkLmFqYXhPcHRpb25zLCBjLnAuYWpheFNlbGVjdE9wdGlvbnMgfHwge30pKSwgInNlbGVjdCIgPT09IHRoaXMuZWRpdHR5cGUgJiYgKHcgPSBhKHEpLnZhbCgpLCAic2VsZWN0LW11bHRpcGxlIiA9PT0gYShxKS5nZXQoMCkudHlwZSAmJiB3ICYmICh3ID0gdy5qb2luKCIsIikpKSwgImNoZWNrYm94IiA9PT0gdGhpcy5lZGl0dHlwZSAmJiAodyA9IGEocSkuaXMoIjpjaGVja2VkIikgPyBhKHEpLnZhbCgpIDogYShxKS5hdHRyKCJvZmZ2YWwiKSksIChrW3gucC5pZF0uY2hlY2tPblN1Ym1pdCB8fCBrW3gucC5pZF0uY2hlY2tPblVwZGF0ZSkgJiYgKGtbeC5wLmlkXS5fc2F2ZWREYXRhW2RdID0gdyksIGEocSkuYWRkQ2xhc3MoIkZvcm1FbGVtZW50IiksIC0xIDwgYS5pbkFycmF5KHRoaXMuZWRpdHR5cGUsIFsidGV4dCIsICJ0ZXh0YXJlYSIsICJwYXNzd29yZCIsICJzZWxlY3QiXSkgJiYgYShxKS5hZGRDbGFzcyhsLmlucHV0Q2xhc3MpLCBPKSBhKFApLmZpbmQoIiMiICsgZCkucmVwbGFjZVdpdGgocSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0gYShmKS5maW5kKCJ0cltyb3dwb3M9IiArIEEgKyAiXSIpLCBwLnJvd2Fib3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgSyA9IGEoIjx0cj48dGQgY2xhc3M9J2NvbnRlbnRpbmZvJyBjb2xzcGFuPSciICsgMiAqIGUgKyAiJz4iICsgcC5yb3djb250ZW50ICsgIjwvdGQ+PC90cj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZikuYXBwZW5kKEspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS1swXS5ycCA9IEEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID09PSBnLmxlbmd0aCAmJiAoZyA9IGEoIjx0ciAiICsgbiArICIgcm93cG9zPSciICsgQSArICInPjwvdHI+IikuYWRkQ2xhc3MoIkZvcm1EYXRhIikuYXR0cigiaWQiLCAidHJfIiArIGQpLCBhKGcpLmFwcGVuZCh6KSwgYShmKS5hcHBlbmQoZyksIGdbMF0ucnAgPSBBKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGQ6ZXEoIiArIChDIC0gMikgKyAiKSIsIGdbMF0pLmh0bWwoIjxsYWJlbCBmb3I9JyIgKyBkICsgIic+IiArICh2b2lkIDAgPT09IHAubGFiZWwgPyBjLnAuY29sTmFtZXNbaF0gOiBwLmxhYmVsKSArICI8L2xhYmVsPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ZDplcSgiICsgKEMgLSAxKSArICIpIiwgZ1swXSkuYXBwZW5kKHAuZWxtcHJlZml4KS5hcHBlbmQocSkuYXBwZW5kKHAuZWxtc3VmZml4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3VzdG9tIiA9PT0gdGhpcy5lZGl0dHlwZSAmJiBhLmlzRnVuY3Rpb24oeS5jdXN0b21fdmFsdWUpICYmIHkuY3VzdG9tX3ZhbHVlLmNhbGwoeCwgYSgiIyIgKyBkLCBHKSwgInNldCIsIHcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuYmluZEV2LmNhbGwoeCwgcSwgeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdFt1XSA9IGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSsrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAwIDwgdSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTyA/ICh5ID0gIjxkaXYgY2xhc3M9J0Zvcm1EYXRhJyBzdHlsZT0nZGlzcGxheTpub25lJz48aW5wdXQgY2xhc3M9J0Zvcm1FbGVtZW50JyBpZD0naWRfZycgdHlwZT0ndGV4dCcgbmFtZT0nIiArIGMucC5pZCArICJfaWQnIHZhbHVlPSciICsgYiArICInLz4iLCBhKFApLmFwcGVuZCh5KSkgOiAoeSA9IGEoIjx0ciBjbGFzcz0nRm9ybURhdGEnIHN0eWxlPSdkaXNwbGF5Om5vbmUnPjx0ZCBjbGFzcz0nQ2FwdGlvblREJz48L3RkPjx0ZCBjb2xzcGFuPSciICsgKDIgKiBlIC0gMSkgKyAiJyBjbGFzcz0nRGF0YVREJz48aW5wdXQgY2xhc3M9J0Zvcm1FbGVtZW50JyBpZD0naWRfZycgdHlwZT0ndGV4dCcgbmFtZT0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnAuaWQgKyAiX2lkJyB2YWx1ZT0nIiArIGIgKyAiJy8+PC90ZD48L3RyPiIpLCB5WzBdLnJwID0gdSArIDk5OSwgYShmKS5hcHBlbmQoeSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoa1t4LnAuaWRdLmNoZWNrT25TdWJtaXQgfHwga1t4LnAuaWRdLmNoZWNrT25VcGRhdGUpICYmIChrW3gucC5pZF0uX3NhdmVkRGF0YVtjLnAuaWQgKyAiX2lkIl0gPSBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGcoYiwgYywgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBkLCBoLCBtLCB3LCBsLCBuID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoa1t4LnAuaWRdLmNoZWNrT25TdWJtaXQgfHwga1t4LnAuaWRdLmNoZWNrT25VcGRhdGUpICYmIChrW3gucC5pZF0uX3NhdmVkRGF0YSA9IHt9LCBrW3gucC5pZF0uX3NhdmVkRGF0YVtjLnAuaWQgKyAiX2lkIl0gPSBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSA9IGMucC5jb2xNb2RlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIl9lbXB0eSIgPT09IGIpIHJldHVybiBhKHEpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBhLmV4dGVuZCh7fSwgdGhpcy5lZGl0b3B0aW9ucyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChoID0gYSgiIyIgKyBhLmpncmlkLmpxSUQoZSksIGYpKSAmJiBoLmxlbmd0aCAmJiBudWxsICE9PSBoWzBdICYmICh3ID0gIiIsICJjdXN0b20iID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0dHlwZSAmJiBhLmlzRnVuY3Rpb24obS5jdXN0b21fdmFsdWUpID8gbS5jdXN0b21fdmFsdWUuY2FsbCh4LCBhKCIjIiArIGUsIGYpLCAic2V0IiwgdykgOiBtLmRlZmF1bHRWYWx1ZSA/ICh3ID0gYS5pc0Z1bmN0aW9uKG0uZGVmYXVsdFZhbHVlKSA/IG0uZGVmYXVsdFZhbHVlLmNhbGwoeCkgOiBtLmRlZmF1bHRWYWx1ZSwgImNoZWNrYm94IiA9PT0gaFswXS50eXBlID8gKGwgPSB3LnRvTG93ZXJDYXNlKCksIDAgPiBsLnNlYXJjaCgvKGZhbHNlfGZ8MHxub3xufG9mZnx1bmRlZmluZWQpL2kpICYmICIiICE9PSBsID8gKGhbMF0uY2hlY2tlZCA9ICEwLCBoWzBdLmRlZmF1bHRDaGVja2VkID0gITAsIGhbMF0udmFsdWUgPSB3KSA6IChoWzBdLmNoZWNrZWQgPSAhMSwgaFswXS5kZWZhdWx0Q2hlY2tlZCA9ICExKSkgOiBoLnZhbCh3KSkgOiAiY2hlY2tib3giID09PSBoWzBdLnR5cGUgPyAoaFswXS5jaGVja2VkID0gITEsIGhbMF0uZGVmYXVsdENoZWNrZWQgPSAhMSwgdyA9IGEoaCkuYXR0cigib2ZmdmFsIikpIDogaFswXS50eXBlICYmICJzZWxlY3QiID09PSBoWzBdLnR5cGUuc3Vic3RyKDAsIDYpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhbMF0uc2VsZWN0ZWRJbmRleCA9IDAgOiBoLnZhbCh3KSwgKCEwID09PSBrW3gucC5pZF0uY2hlY2tPblN1Ym1pdCB8fCBrW3gucC5pZF0uY2hlY2tPblVwZGF0ZSkgJiYgKGtbeC5wLmlkXS5fc2F2ZWREYXRhW2VdID0gdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIHZvaWQgYSgiI2lkX2ciLCBmKS52YWwoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBhKGMpLmpxR3JpZCgiZ2V0SW5kIiwgYiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgJiYgKGEoJ3RkW3JvbGU9ImdyaWRjZWxsIl0nLCByKS5lYWNoKGZ1bmN0aW9uKGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBxW2hdLm5hbWUsICJjYiIgIT09IGUgJiYgInN1YmdyaWQiICE9PSBlICYmICJybiIgIT09IGUgJiYgITAgPT09IHFbaF0uZWRpdGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID09PSBjLnAuRXhwYW5kQ29sdW1uICYmICEwID09PSBjLnAudHJlZUdyaWQpIGQgPSBhKHRoaXMpLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS51bmZvcm1hdC5jYWxsKGMsIGEodGhpcyksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiBxW2hdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgaCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gInRleHRhcmVhIiA9PT0gcVtoXS5lZGl0dHlwZSA/IGEodGhpcykudGV4dCgpIDogYSh0aGlzKS5odG1sKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoeC5wLmF1dG9lbmNvZGUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZCA9IGEuamdyaWQuaHRtbERlY29kZShkKSksICghMCA9PT0ga1t4LnAuaWRdLmNoZWNrT25TdWJtaXQgfHwga1t4LnAuaWRdLmNoZWNrT25VcGRhdGUpICYmIChrW3gucC5pZF0uX3NhdmVkRGF0YVtlXSA9IGQpLCBlID0gYS5qZ3JpZC5qcUlEKGUpLCBxW2hdLmVkaXR0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFzc3dvcmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJ1dHRvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW1hZ2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCImbmJzcDsiID09PSBkIHx8ICImIzE2MDsiID09PSBkIHx8IDEgPT09IGQubGVuZ3RoICYmIDE2MCA9PT0gZC5jaGFyQ29kZUF0KDApKSAmJiAoZCA9ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBlLCBmKS52YWwoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNlbGVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gZC5zcGxpdCgiLCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEubWFwKGcsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS50cmltKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBlICsgIiBvcHRpb24iLCBmKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHFbaF0uZWRpdG9wdGlvbnMubXVsdGlwbGUgfHwgYS50cmltKGQpICE9PSBhLnRyaW0oYSh0aGlzKS50ZXh0KCkpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1swXSAhPT0gYS50cmltKGEodGhpcykudGV4dCgpKSAmJiBnWzBdICE9PSBhLnRyaW0oYSh0aGlzKS52YWwoKSkgPyBxW2hdLmVkaXRvcHRpb25zLm11bHRpcGxlICYmICgtMSA8IGEuaW5BcnJheShhLnRyaW0oYSh0aGlzKS50ZXh0KCkpLCBnKSB8fCAtMSA8IGEuaW5BcnJheShhLnRyaW0oYSh0aGlzKS52YWwoKSksIGcpKSA/ICEwIDogITEgOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCEwID09PSBrW3gucC5pZF0uY2hlY2tPblN1Ym1pdCB8fCBrW3gucC5pZF0uY2hlY2tPblVwZGF0ZSkgJiYgKGQgPSBhKCIjIiArIGUsIGYpLnZhbCgpLCBxW2hdLmVkaXRvcHRpb25zLm11bHRpcGxlICYmIChkID0gZC5qb2luKCIsIikpLCBrW3gucC5pZF0uX3NhdmVkRGF0YVtlXSA9IGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjaGVja2JveCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gU3RyaW5nKGQpLCBxW2hdLmVkaXRvcHRpb25zICYmIHFbaF0uZWRpdG9wdGlvbnMudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ID0gcVtoXS5lZGl0b3B0aW9ucy52YWx1ZS5zcGxpdCgiOiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBlLCBmKVt4LnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0od1swXSA9PT0gZCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q2hlY2tlZDogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENoZWNrZWQ6ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZCA9IGQudG9Mb3dlckNhc2UoKSwgMCA+IGQuc2VhcmNoKC8oZmFsc2V8ZnwwfG5vfG58b2ZmfHVuZGVmaW5lZCkvaSkgJiYgIiIgIT09IGQgPyAoYSgiIyIgKyBlLCBmKVt4LnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMCksIGEoIiMiICsgZSwgZilbeC5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJkZWZhdWx0Q2hlY2tlZCIsICEwKSkgOiAoYSgiIyIgKyBlLCBmKVt4LnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSksIGEoIiMiICsgZSwgZilbeC5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJkZWZhdWx0Q2hlY2tlZCIsICExKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghMCA9PT0ga1t4LnAuaWRdLmNoZWNrT25TdWJtaXQgfHwga1t4LnAuaWRdLmNoZWNrT25VcGRhdGUpICYmIChkID0gYSgiIyIgKyBlLCBmKS5pcygiOmNoZWNrZWQiKSA/IGEoIiMiICsgZSwgZikudmFsKCkgOiBhKCIjIiArIGUsIGYpLmF0dHIoIm9mZnZhbCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY3VzdG9tIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcVtoXS5lZGl0b3B0aW9ucyB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFhLmlzRnVuY3Rpb24ocVtoXS5lZGl0b3B0aW9ucy5jdXN0b21fdmFsdWUpKSB0aHJvdyAiZTEiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcVtoXS5lZGl0b3B0aW9ucy5jdXN0b21fdmFsdWUuY2FsbCh4LCBhKCIjIiArIGUsIGYpLCAic2V0IiwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImUxIiA9PT0gbSA/IGEuamdyaWQuaW5mb19kaWFsb2coUy5lcnJjYXAsICJmdW5jdGlvbiAnY3VzdG9tX3ZhbHVlJyAiICsga1thKHRoaXMpWzBdXS5wLm1zZy5ub2RlZmluZWQsIGEucnBfZ2VbYSh0aGlzKVswXV0ucC5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBrW2EodGhpcylbMF1dLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBhLmpncmlkLmluZm9fZGlhbG9nKFMuZXJyY2FwLCBtLm1lc3NhZ2UsIGEucnBfZ2VbYSh0aGlzKVswXV0ucC5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVVJOiBrW2EodGhpcylbMF1dLnAuc3R5bGVVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbisrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgMCA8IG4gJiYgYSgiI2lkX2ciLCBEKS52YWwoYikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goeC5wLmNvbE1vZGVsLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZWRpdG9wdGlvbnMgJiYgITAgPT09IGIuZWRpdG9wdGlvbnMuTnVsbElmRW1wdHkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUuaGFzT3duUHJvcGVydHkoYi5uYW1lKSAmJiAiIiA9PT0gRVtiLm5hbWVdICYmIChFW2IubmFtZV0gPSAibnVsbCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB1KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBmLCBkLCBoLCBsLCBuLCB1LCB0ID0gWyEwLCAiIiwgIiJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSB4LnAucHJtTmFtZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0QmVmb3JlQ2hlY2tWYWx1ZXMiLCBbYShHKSwgTF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHkgJiYgKEUgPSB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLmJlZm9yZUNoZWNrVmFsdWVzKSAmJiAoeSA9IGtbeC5wLmlkXS5iZWZvcmVDaGVja1ZhbHVlcy5jYWxsKHgsIEUsIGEoRyksIEwpLCB5ICYmICJvYmplY3QiID09IHR5cGVvZiB5ICYmIChFID0geSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaCBpbiBFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRS5oYXNPd25Qcm9wZXJ0eShoKSAmJiAodCA9IGEuamdyaWQuY2hlY2tWYWx1ZXMuY2FsbCh4LCBFW2hdLCBoKSwgITEgPT09IHRbMF0pKSBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodygpLCB0WzBdICYmIChCID0gYSh4KS50cmlnZ2VySGFuZGxlcigianFHcmlkQWRkRWRpdENsaWNrU3VibWl0IiwgW2tbeC5wLmlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUsIEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHZvaWQgMCA9PT0gQiAmJiBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLm9uY2xpY2tTdWJtaXQpICYmIChCID0ga1t4LnAuaWRdLm9uY2xpY2tTdWJtaXQuY2FsbCh4LCBrW3gucC5pZF0sIEUsIEwpIHx8IHt9KSwgdCA9IGEoeCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFkZEVkaXRCZWZvcmVTdWJtaXQiLCBbRSwgYShHKSwgTF0pLCB2b2lkIDAgPT09IHQgJiYgKHQgPSBbITAsICIiLCAiIl0pLCB0WzBdICYmIGEuaXNGdW5jdGlvbihrW3gucC5pZF0uYmVmb3JlU3VibWl0KSAmJiAodCA9IGtbeC5wLmlkXS5iZWZvcmVTdWJtaXQuY2FsbCh4LCBFLCBhKEcpLCBMKSkpLCB0WzBdICYmICFrW3gucC5pZF0ucHJvY2Vzc2luZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa1t4LnAuaWRdLnByb2Nlc3NpbmcgPSAhMCwgYSgiI3NEYXRhIiwgRCArICJfMiIpLmFkZENsYXNzKGUuYWN0aXZlKSwgdSA9IGtbeC5wLmlkXS51cmwgfHwgYSh4KS5qcUdyaWQoImdldEdyaWRQYXJhbSIsICJlZGl0dXJsIiksIGQgPSB6Lm9wZXIsIGYgPSAiY2xpZW50QXJyYXkiID09PSB1ID8geC5wLmtleU5hbWUgOiB6LmlkLCBFW2RdID0gIl9lbXB0eSIgPT09IGEudHJpbShFW3gucC5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIl9pZCJdKSA/IHouYWRkb3BlciA6IHouZWRpdG9wZXIsIEVbZF0gIT09IHouYWRkb3BlciA/IEVbZl0gPSBFW3gucC5pZCArICJfaWQiXSA6IHZvaWQgMCA9PT0gRVtmXSAmJiAoRVtmXSA9IEVbeC5wLmlkICsgIl9pZCJdKSwgZGVsZXRlIEVbeC5wLmlkICsgIl9pZCJdLCBFID0gYS5leHRlbmQoRSwga1t4LnAuaWRdLmVkaXREYXRhLCBCKSwgITAgPT09IHgucC50cmVlR3JpZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiBpbiBFW2RdID09PSB6LmFkZG9wZXIgJiYgKGwgPSBhKHgpLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiwgInNlbHJvdyIpLCBFWyJhZGphY2VuY3kiID09PSB4LnAudHJlZUdyaWRNb2RlbCA/IHgucC50cmVlUmVhZGVyLnBhcmVudF9pZF9maWVsZCA6ICJwYXJlbnRfaWQiXSA9IGwpLCB4LnAudHJlZVJlYWRlcikgeC5wLnRyZWVSZWFkZXIuaGFzT3duUHJvcGVydHkobikgJiYgKGggPSB4LnAudHJlZVJlYWRlcltuXSwgIUUuaGFzT3duUHJvcGVydHkoaCkgfHwgRVtkXSA9PT0gei5hZGRvcGVyICYmICJwYXJlbnRfaWRfZmllbGQiID09PSBuIHx8IGRlbGV0ZSBFW2hdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVtmXSA9IGEuamdyaWQuc3RyaXBQcmVmKHgucC5pZFByZWZpeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVbZl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZToga1t4LnAuaWRdLm10eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYS5pc0Z1bmN0aW9uKGtbeC5wLmlkXS5zZXJpYWxpemVFZGl0RGF0YSkgPyBrW3gucC5pZF0uc2VyaWFsaXplRWRpdERhdGEuY2FsbCh4LCBFKSA6IEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oaCwgdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKCIjc0RhdGEiLCBEICsgIl8yIikucmVtb3ZlQ2xhc3MoZS5hY3RpdmUpLCBFW2ZdID0geC5wLmlkUHJlZml4ICsgRVtmXSwgMzAwIDw9IGguc3RhdHVzICYmIDMwNCAhPT0gaC5zdGF0dXMgPyAodFswXSA9ICExLCB0WzFdID0gYSh4KS50cmlnZ2VySGFuZGxlcigianFHcmlkQWRkRWRpdEVycm9yVGV4dEZvcm1hdCIsIFtoLCBMXSksIHRbMV0gPSBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLmVycm9yVGV4dEZvcm1hdCkgPyBrW3gucC5pZF0uZXJyb3JUZXh0Rm9ybWF0LmNhbGwoeCwgaCwgTCkgOiB3ICsgIiBTdGF0dXM6ICciICsgaC5zdGF0dXNUZXh0ICsgIicuIEVycm9yIGNvZGU6ICIgKyBoLnN0YXR1cykgOiAodCA9IGEoeCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFkZEVkaXRBZnRlclN1Ym1pdCIsIFtoLCBFLCBMXSksIHZvaWQgMCA9PT0gdCAmJiAodCA9IFshMCwgIiIsICIiXSksIHRbMF0gJiYgYS5pc0Z1bmN0aW9uKGtbeC5wLmlkXS5hZnRlclN1Ym1pdCkgJiYgKHQgPSBrW3gucC5pZF0uYWZ0ZXJTdWJtaXQuY2FsbCh4LCBoLCBFLCBMKSkpLCAhMSA9PT0gdFswXSkgYSgiLkZvcm1FcnJvciIsIEcpLmh0bWwodFsxXSksIGEoIi5Gb3JtRXJyb3IiLCBHKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeC5wLmF1dG9lbmNvZGUgJiYgYS5lYWNoKEUsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVbYl0gPSBhLmpncmlkLmh0bWxEZWNvZGUoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIEVbZF0gPT09IHouYWRkb3BlciA/ICh0WzJdIHx8ICh0WzJdID0gYS5qZ3JpZC5yYW5kSWQoKSksIG51bGwgPT0gRVtmXSB8fCAiX2VtcHR5IiA9PT0gRVtmXSA/IEVbZl0gPSB0WzJdIDogdFsyXSA9IEVbZl0sIGtbeC5wLmlkXS5yZWxvYWRBZnRlclN1Ym1pdCA/IGEoeCkudHJpZ2dlcigicmVsb2FkR3JpZCIpIDogITAgPT09IHgucC50cmVlR3JpZCA/IGEoeCkuanFHcmlkKCJhZGRDaGlsZE5vZGUiLCB0WzJdLCBsLCBFKSA6IGEoeCkuanFHcmlkKCJhZGRSb3dEYXRhIiwgdFsyXSwgRSwgYy5hZGRlZHJvdyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrW3gucC5pZF0uY2xvc2VBZnRlckFkZCA/ICghMCAhPT0geC5wLnRyZWVHcmlkICYmIGEoeCkuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCB0WzJdKSwgYS5qZ3JpZC5oaWRlTW9kYWwoIiMiICsgYS5qZ3JpZC5qcUlEKFIudGhlbW9kYWwpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKEopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGtbeC5wLmlkXS5vbkNsb3NlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiBrW3gucC5pZF0ucmVtb3ZlbW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06IGtbeC5wLmlkXS5mb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkgOiBrW3gucC5pZF0uY2xlYXJBZnRlckFkZCAmJiBnKCJfZW1wdHkiLCB4LCBHKSkgOiAoa1t4LnAuaWRdLnJlbG9hZEFmdGVyU3VibWl0ID8gKGEoeCkudHJpZ2dlcigicmVsb2FkR3JpZCIpLCBrW3gucC5pZF0uY2xvc2VBZnRlckVkaXQgfHwgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeCkuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBFW2ZdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxRTMpKSA6ICEwID09PSB4LnAudHJlZUdyaWQgPyBhKHgpLmpxR3JpZCgic2V0VHJlZVJvdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFW2ZdLCBFKSA6IGEoeCkuanFHcmlkKCJzZXRSb3dEYXRhIiwgRVtmXSwgRSksIGtbeC5wLmlkXS5jbG9zZUFmdGVyRWRpdCAmJiBhLmpncmlkLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChKKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZToga1t4LnAuaWRdLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDoga1t4LnAuaWRdLnJlbW92ZW1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybToga1t4LnAuaWRdLmZvcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLmFmdGVyQ29tcGxldGUpICYmIChiID0gaCwgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFkZEVkaXRBZnRlckNvbXBsZXRlIiwgW2IsIEUsIGEoRyksIExdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtbeC5wLmlkXS5hZnRlckNvbXBsZXRlLmNhbGwoeCwgYiwgRSwgYShHKSwgTCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApKSwgKGtbeC5wLmlkXS5jaGVja09uU3VibWl0IHx8IGtbeC5wLmlkXS5jaGVja09uVXBkYXRlKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYShHKS5kYXRhKCJkaXNhYmxlZCIsICExKSwgIl9lbXB0eSIgIT09IGtbeC5wLmlkXS5fc2F2ZWREYXRhW3gucC5pZCArICJfaWQiXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobiBpbiBrW3gucC5pZF0uX3NhdmVkRGF0YSkga1t4LnAuaWRdLl9zYXZlZERhdGEuaGFzT3duUHJvcGVydHkobikgJiYgRVtuXSAmJiAoa1t4LnAuaWRdLl9zYXZlZERhdGFbbl0gPSBFW25dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrW3gucC5pZF0ucHJvY2Vzc2luZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIjppbnB1dDp2aXNpYmxlIiwgRylbMF0uZm9jdXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHEpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGEuamdyaWQuYWpheE9wdGlvbnMsIGtbeC5wLmlkXS5hamF4RWRpdE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobi51cmwgfHwga1t4LnAuaWRdLnVzZURhdGFQcm94eSB8fCAoYS5pc0Z1bmN0aW9uKHgucC5kYXRhUHJveHkpID8ga1t4LnAuaWRdLnVzZURhdGFQcm94eSA9ICEwIDogKHRbMF0gPSAhMSwgdFsxXSArPSAiICIgKyBTLm5vdXJsKSksIHRbMF0pIGtbeC5wLmlkXS51c2VEYXRhUHJveHkgPyAodSA9IHgucC5kYXRhUHJveHkuY2FsbCh4LCBuLCAic2V0XyIgKyB4LnAuaWQpLCB2b2lkIDAgPT09IHUgJiYgKHUgPSBbITAsICIiXSksICExID09PSB1WzBdID8gKHRbMF0gPSAhMSwgdFsxXSA9IHVbMV0gfHwgIkVycm9yIGRlbGV0aW5nIHRoZSBzZWxlY3RlZCByb3chIikgOiAobi5kYXRhLm9wZXIgPT09IHouYWRkb3BlciAmJiBrW3gucC5pZF0uY2xvc2VBZnRlckFkZCAmJiBhLmpncmlkLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChKKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZToga1t4LnAuaWRdLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDoga1t4LnAuaWRdLnJlbW92ZW1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybToga1t4LnAuaWRdLmZvcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIG4uZGF0YS5vcGVyID09PSB6LmVkaXRvcGVyICYmIGtbeC5wLmlkXS5jbG9zZUFmdGVyRWRpdCAmJiBhLmpncmlkLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChKKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZToga1t4LnAuaWRdLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDoga1t4LnAuaWRdLnJlbW92ZW1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybToga1t4LnAuaWRdLmZvcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKSA6ICJjbGllbnRBcnJheSIgPT09IG4udXJsID8gKGtbeC5wLmlkXS5yZWxvYWRBZnRlclN1Ym1pdCA9ICExLCBFID0gbi5kYXRhLCBuLmNvbXBsZXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgIiIpKSA6IGEuYWpheChuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0hMSA9PT0gdFswXSAmJiAoYSgiLkZvcm1FcnJvciIsIEcpLmh0bWwodFsxXSksIGEoIi5Gb3JtRXJyb3IiLCBHKS5zaG93KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24geihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGYgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgaW4gYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoYykgJiYgYVtjXSAhPSBiW2NdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB5KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIi5Gb3JtRXJyb3IiLCBHKS5oaWRlKCksIGtbeC5wLmlkXS5jaGVja09uVXBkYXRlICYmIChFID0ge30sIGQoKSwgTiA9IHooRSwga1t4LnAuaWRdLl9zYXZlZERhdGEpLCBOICYmIChhKEcpLmRhdGEoImRpc2FibGVkIiwgITApLCBhKCIuY29uZmlybSIsICIjIiArIFIudGhlbW9kYWwpLnNob3coKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICExKSksIGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBwKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiX2VtcHR5IiAhPT0gYiAmJiB2b2lkIDAgIT09IHgucC5zYXZlZFJvdyAmJiAwIDwgeC5wLnNhdmVkUm93Lmxlbmd0aCAmJiBhLmlzRnVuY3Rpb24oYS5mbi5qcUdyaWQucmVzdG9yZVJvdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCB4LnAuc2F2ZWRSb3cubGVuZ3RoOyBjKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeC5wLnNhdmVkUm93W2NdLmlkID09PSBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh4KS5qcUdyaWQoInJlc3RvcmVSb3ciLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEMoYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gY1sxXS5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGIgPyBhKCIjcERhdGEiLCBIKS5hZGRDbGFzcyhlLmRpc2FibGVkKSA6IHZvaWQgMCAhPT0gY1sxXVtiIC0gMV0gJiYgYSgiIyIgKyBhLmpncmlkLmpxSUQoY1sxXVtiIC0gMV0pKS5oYXNDbGFzcyhlLmRpc2FibGVkKSA/IGEoIiNwRGF0YSIsIEgpLmFkZENsYXNzKGUuZGlzYWJsZWQpIDogYSgiI3BEYXRhIiwgSCkucmVtb3ZlQ2xhc3MoZS5kaXNhYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9PT0gZiA/IGEoIiNuRGF0YSIsIEgpLmFkZENsYXNzKGUuZGlzYWJsZWQpIDogdm9pZCAwICE9PSBjWzFdW2IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSAmJiBhKCIjIiArIGEuamdyaWQuanFJRChjWzFdW2IgKyAxXSkpLmhhc0NsYXNzKGUuZGlzYWJsZWQpID8gYSgiI25EYXRhIiwgSCkuYWRkQ2xhc3MoZS5kaXNhYmxlZCkgOiBhKCIjbkRhdGEiLCBIKS5yZW1vdmVDbGFzcyhlLmRpc2FibGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHYoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHgpLmpxR3JpZCgiZ2V0RGF0YUlEcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgiI2lkX2ciLCBEKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2EuaW5BcnJheShjLCBiKSwgYl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBBKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiAoYiA9IGEucmVwbGFjZSgvXHsoW1x3XC1dKykoPzpcOihbXHdcLl0qKSg/OlwoKC4qPyk/XCkpPyk/XH0vZywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGlkPSInICsgYiArICciID48L3NwYW4+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSwgYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHguZ3JpZCAmJiBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEgsIEUsIE4sIEwsIEogPSB4LnAuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSAiRnJtR3JpZF8iICsgSiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUSA9ICJUYmxHcmlkXyIgKyBKLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEID0gIiMiICsgYS5qZ3JpZC5qcUlEKFEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbW9kYWw6ICJlZGl0bW9kIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsaGVhZDogImVkaXRoZCIgKyBKLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxjb250ZW50OiAiZWRpdGNudCIgKyBKLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWxtOiBHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEYgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPID0gInN0cmluZyIgPT0gdHlwZW9mIGtbeC5wLmlkXS50ZW1wbGF0ZSAmJiAwIDwga1t4LnAuaWRdLnRlbXBsYXRlLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImVycm9ycyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtbeC5wLmlkXS5zdHlsZVVJID0geC5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLmlzTW9iaWxlKCkgJiYgKGtbeC5wLmlkXS5yZXNpemUgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5ldyIgPT09IGIgPyAoYiA9ICJfZW1wdHkiLCBMID0gImFkZCIsIGMuY2FwdGlvbiA9IGtbeC5wLmlkXS5hZGRDYXB0aW9uKSA6IChjLmNhcHRpb24gPSBrW3gucC5pZF0uZWRpdENhcHRpb24sIEwgPSAiZWRpdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucmVjcmVhdGVGb3JtIHx8IGEoeCkuZGF0YSgiZm9ybVByb3AiKSAmJiBhLmV4dGVuZChrW2EodGhpcylbMF0ucC5pZF0sIGEoeCkuZGF0YSgiZm9ybVByb3AiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFkgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmNoZWNrT25VcGRhdGUgJiYgYy5qcU1vZGFsICYmICFjLm1vZGFsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChZID0gITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0LCBlYSA9IGlzTmFOKGtbYSh0aGlzKVswXS5wLmlkXS5kYXRhaGVpZ2h0KSA/IGtbYSh0aGlzKVswXS5wLmlkXS5kYXRhaGVpZ2h0IDoga1thKHRoaXMpWzBdLnAuaWRdLmRhdGFoZWlnaHQgKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpYSA9IGlzTmFOKGtbYSh0aGlzKVswXS5wLmlkXS5kYXRhd2lkdGgpID8ga1thKHRoaXMpWzBdLnAuaWRdLmRhdGF3aWR0aCA6IGtbYSh0aGlzKVswXS5wLmlkXS5kYXRhd2lkdGggKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQID0gYSgiPGZvcm0gbmFtZT0nRm9ybVBvc3QnIGlkPSciICsgRyArICInIGNsYXNzPSdGb3JtR3JpZCcgb25TdWJtaXQ9J3JldHVybiBmYWxzZTsnIHN0eWxlPSd3aWR0aDoiICsgaWEgKyAiO2hlaWdodDoiICsgZWEgKyAiOyc+PC9mb3JtPiIpLmRhdGEoImRpc2FibGVkIiwgITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPID8gKHQgPSBBKGtbYSh0aGlzKVswXS5wLmlkXS50ZW1wbGF0ZSksIEggPSBEKSA6ICh0ID0gYSgiPHRhYmxlIGlkPSciICsgUSArICInIGNsYXNzPSdFZGl0VGFibGUgdWktY29tbW9uLXRhYmxlJz48dGJvZHk+PC90Ym9keT48L3RhYmxlPiIpLCBIID0gRCArICJfMiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gIiMiICsgYS5qZ3JpZC5qcUlEKEcpLCBhKFApLmFwcGVuZCgiPGRpdiBjbGFzcz0nRm9ybUVycm9yICIgKyBlLmVycm9yICsgIicgc3R5bGU9J2Rpc3BsYXk6bm9uZTsnPjwvZGl2PiIpLCBhKFApLmFwcGVuZCgiPGRpdiBjbGFzcz0ndGluZm8gdG9waW5mbyc+IiArIGtbeC5wLmlkXS50b3BpbmZvICsgIjwvZGl2PiIpLCBhKHgucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5mb3Jtb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBNYXRoLm1heChJLCBhID8gYS5jb2xwb3MgfHwgMCA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IE1hdGgubWF4KE0sIGEgPyBhLnJvd3BvcyB8fCAwIDogMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEoUCkuYXBwZW5kKHQpLCBGID0gYSh4KS50cmlnZ2VySGFuZGxlcigianFHcmlkQWRkRWRpdEJlZm9yZUluaXREYXRhIiwgW1AsIExdKSwgdm9pZCAwID09PSBGICYmIChGID0gITApLCBGICYmIGEuaXNGdW5jdGlvbihrW3gucC5pZF0uYmVmb3JlSW5pdERhdGEpICYmIChGID0ga1t4LnAuaWRdLmJlZm9yZUluaXREYXRhLmNhbGwoeCwgUCwgTCkpLCAhMSAhPT0gRikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgoYiwgeCwgdCwgSSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBGYSA9ICJydGwiID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeC5wLmRpcmVjdGlvbiA/ICEwIDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWID0gIjxhIGlkPSciICsgKEZhID8gIm5EYXRhIiA6ICJwRGF0YSIpICsgIicgY2xhc3M9J2ZtLWJ1dHRvbiAiICsgZS5idXR0b24gKyAiJz48c3BhbiBjbGFzcz0nIiArIGUuaWNvbl9iYXNlICsgIiAiICsgbC5pY29uX3ByZXYgKyAiJz48L3NwYW4+PC9hPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGID0gIjxhIGlkPSciICsgKEZhID8gInBEYXRhIiA6ICJuRGF0YSIpICsgIicgY2xhc3M9J2ZtLWJ1dHRvbiAiICsgZS5idXR0b24gKyAiJz48c3BhbiBjbGFzcz0nIiArIGUuaWNvbl9iYXNlICsgIiAiICsgbC5pY29uX25leHQgKyAiJz48L3NwYW4+PC9hPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYSA9ICI8YSBpZD0nc0RhdGEnIGNsYXNzPSdmbS1idXR0b24gIiArIGUuYnV0dG9uICsgIic+IiArIGMuYlN1Ym1pdCArICI8L2E+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlhID0gIjxhIGlkPSdjRGF0YScgY2xhc3M9J2ZtLWJ1dHRvbiAiICsgZS5idXR0b24gKyAiJz4iICsgYy5iQ2FuY2VsICsgIjwvYT4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVyA9ICI8dGFibGUgc3R5bGU9J2hlaWdodDphdXRvJyBjbGFzcz0nRWRpdFRhYmxlIHVpLWNvbW1vbi10YWJsZScgaWQ9JyIgKyBRICsgIl8yJz48dGJvZHk+PHRyPjx0ZCBjb2xzcGFuPScyJz48aHIgY2xhc3M9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jb250ZW50ICsgIicgc3R5bGU9J21hcmdpbjoxcHgnLz48L3RkPjwvdHI+PHRyIGlkPSdBY3RfQnV0dG9ucyc+PHRkIGNsYXNzPSduYXZCdXR0b24nPiIgKyAoRmEgPyBGICsgViA6IFYgKyBGKSArICI8L3RkPjx0ZCBjbGFzcz0nRWRpdEJ1dHRvbic+IiArIGVhICsgaWEgKyAiPC90ZD48L3RyPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChXICs9ICI8L3Rib2R5PjwvdGFibGU+IiwgMCA8IE0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhYSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGEodClbMF0ucm93cywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFhW2FdID0gYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5ycCA+IGIucnAgPyAxIDogYS5ycCA8IGIucnAgPyAtMSA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGFhLCBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGJvZHkiLCB0KS5hcHBlbmQoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYm94ID0gIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoSik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYSA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5jbG9zZU9uRXNjYXBlICYmIChjLmNsb3NlT25Fc2NhcGUgPSAhMSwgbmEgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE8gPyAoYShQKS5maW5kKCIjcERhdGEiKS5yZXBsYWNlV2l0aChWKSwgYShQKS5maW5kKCIjbkRhdGEiKS5yZXBsYWNlV2l0aChGKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKFApLmZpbmQoIiNzRGF0YSIpLnJlcGxhY2VXaXRoKGVhKSwgYShQKS5maW5kKCIjY0RhdGEiKS5yZXBsYWNlV2l0aChpYSksIGZhID0gYSgiPGRpdiBpZD0iICsgUSArICI+PC9kaXY+IikuYXBwZW5kKFApKSA6IGZhID0gYSgiPGRpdj48L2Rpdj4iKS5hcHBlbmQoUCkuYXBwZW5kKFcpLCBhKFApLmFwcGVuZCgiPGRpdiBjbGFzcz0nYmluZm8gdG9waW5mbyBib3R0b21pbmZvJz4iICsga1t4LnAuaWRdLmJvdHRvbWluZm8gKyAiPC9kaXY+IiksIGEuamdyaWQuY3JlYXRlTW9kYWwoUiwgZmEsIGtbYSh0aGlzKVswXS5wLmlkXSwgIiNndmlld18iICsgYS5qZ3JpZC5qcUlEKHgucC5pZCksIGEoIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoeC5wLmlkKSlbMF0pLCBGYSAmJiAoYSgiI3BEYXRhLCAjbkRhdGEiLCBEICsgIl8yIikuY3NzKCJmbG9hdCIsICJyaWdodCIpLCBhKCIuRWRpdEJ1dHRvbiIsIEQgKyAiXzIiKS5jc3MoInRleHQtYWxpZ24iLCAibGVmdCIpKSwga1t4LnAuaWRdLnRvcGluZm8gJiYgYSgiLnRpbmZvIiwgRykuc2hvdygpLCBrW3gucC5pZF0uYm90dG9taW5mbyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLmJpbmZvIiwgRykuc2hvdygpLCBmYSA9IG51bGwsIFcgPSBudWxsLCBhKCIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSkua2V5ZG93bihmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLnRhcmdldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGEoRykuZGF0YSgiZGlzYWJsZWQiKSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0ga1t4LnAuaWRdLnNhdmVrZXlbMF0gJiYgYi53aGljaCA9PT0ga1t4LnAuaWRdLnNhdmVrZXlbMV0gJiYgIlRFWFRBUkVBIiAhPT0gZi50YWdOYW1lKSByZXR1cm4gYSgiI3NEYXRhIiwgRCArICJfMiIpLnRyaWdnZXIoImNsaWNrIiksICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgyNyA9PT0gYi53aGljaCkgcmV0dXJuIHkoKSA/IChuYSAmJiBhLmpncmlkLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6IGMuZ2JveCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBjLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGtbeC5wLmlkXS5vbkNsb3NlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDoga1t4LnAuaWRdLnJlbW92ZW1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtcHJvcDogIWtbeC5wLmlkXS5yZWNyZWF0ZUZvcm0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06IGtbeC5wLmlkXS5mb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksICExKSA6ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga1t4LnAuaWRdLm5hdmtleXNbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJfZW1wdHkiID09PSBhKCIjaWRfZyIsIEQpLnZhbCgpKSByZXR1cm4gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLndoaWNoID09PSBrW3gucC5pZF0ubmF2a2V5c1sxXSkgcmV0dXJuIGEoIiNwRGF0YSIsIEgpLnRyaWdnZXIoImNsaWNrIiksICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi53aGljaCA9PT0ga1t4LnAuaWRdLm5hdmtleXNbMl0pIHJldHVybiBhKCIjbkRhdGEiLCBIKS50cmlnZ2VyKCJjbGljayIpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjLmNoZWNrT25VcGRhdGUgJiYgKGEoImEudWktanFkaWFsb2ctdGl0bGViYXItY2xvc2Ugc3BhbiIsICIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSkucmVtb3ZlQ2xhc3MoImpxbUNsb3NlIiksIGEoImEudWktanFkaWFsb2ctdGl0bGViYXItY2xvc2UiLCAiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCkpLnVuYmluZCgiY2xpY2siKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geSgpID8gKGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYjogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoSiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBrW3gucC5pZF0ub25DbG9zZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlbW9kYWw6IGtbeC5wLmlkXS5yZW1vdmVtb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtOiBrW3gucC5pZF0uZm9ybQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMSkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBjLnNhdmVpY29uID0gYS5leHRlbmQoWyEwLCAibGVmdCIsIGwuaWNvbl9zYXZlXSwgYy5zYXZlaWNvbiksIGMuY2xvc2VpY29uID0gYS5leHRlbmQoWyEwLCAibGVmdCIsIGwuaWNvbl9jbG9zZV0sIGMuY2xvc2VpY29uKSwgITAgPT09IGMuc2F2ZWljb25bMF0gJiYgYSgiI3NEYXRhIiwgSCkuYWRkQ2xhc3MoInJpZ2h0IiA9PT0gYy5zYXZlaWNvblsxXSA/ICJmbS1idXR0b24taWNvbi1yaWdodCIgOiAiZm0tYnV0dG9uLWljb24tbGVmdCIpLmFwcGVuZCgiPHNwYW4gY2xhc3M9JyIgKyBlLmljb25fYmFzZSArICIgIiArIGMuc2F2ZWljb25bMl0gKyAiJz48L3NwYW4+IiksICEwID09PSBjLmNsb3NlaWNvblswXSAmJiBhKCIjY0RhdGEiLCBIKS5hZGRDbGFzcygicmlnaHQiID09PSBjLmNsb3NlaWNvblsxXSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZtLWJ1dHRvbi1pY29uLXJpZ2h0IiA6ICJmbS1idXR0b24taWNvbi1sZWZ0IikuYXBwZW5kKCI8c3BhbiBjbGFzcz0nIiArIGUuaWNvbl9iYXNlICsgIiAiICsgYy5jbG9zZWljb25bMl0gKyAiJz48L3NwYW4+IiksIGtbeC5wLmlkXS5jaGVja09uU3VibWl0IHx8IGtbeC5wLmlkXS5jaGVja09uVXBkYXRlKSBlYSA9ICI8YSBpZD0nc05ldycgY2xhc3M9J2ZtLWJ1dHRvbiAiICsgZS5idXR0b24gKyAiJyBzdHlsZT0nei1pbmRleDoxMDAyJz4iICsgYy5iWWVzICsgIjwvYT4iLCBGID0gIjxhIGlkPSduTmV3JyBjbGFzcz0nZm0tYnV0dG9uICIgKyBlLmJ1dHRvbiArICInIHN0eWxlPSd6LWluZGV4OjEwMDI7bWFyZ2luLWxlZnQ6NXB4Jz4iICsgYy5iTm8gKyAiPC9hPiIsIGlhID0gIjxhIGlkPSdjTmV3JyBjbGFzcz0nZm0tYnV0dG9uICIgKyBlLmJ1dHRvbiArICInIHN0eWxlPSd6LWluZGV4OjEwMDI7bWFyZ2luLWxlZnQ6NXB4Oyc+IiArIGMuYkV4aXQgKyAiPC9hPiIsIFEgPSBjLnpJbmRleCB8fCA5OTksIFErKywgYSgiPGRpdiBjbGFzcz0nIiArIGMub3ZlcmxheUNsYXNzICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIganFncmlkLW92ZXJsYXkgY29uZmlybScgc3R5bGU9J3otaW5kZXg6IiArIFEgKyAiO2Rpc3BsYXk6bm9uZTsnPiYjMTYwOzwvZGl2PjxkaXYgY2xhc3M9J2NvbmZpcm0gdWktanFjb25maXJtICIgKyBlLmNvbnRlbnQgKyAiJyBzdHlsZT0nei1pbmRleDoiICsgKFEgKyAxKSArICInPiIgKyBjLnNhdmVEYXRhICsgIjxici8+PGJyLz4iICsgZWEgKyBGICsgaWEgKyAiPC9kaXY+IikuaW5zZXJ0QWZ0ZXIoRyksIGEoIiNzTmV3IiwgIiMiICsgYS5qZ3JpZC5qcUlEKFIudGhlbW9kYWwpKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1KCksIGEoRykuZGF0YSgiZGlzYWJsZWQiLCAhMSksIGEoIi5jb25maXJtIiwgIiMiICsgYS5qZ3JpZC5qcUlEKFIudGhlbW9kYWwpKS5oaWRlKCksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjbk5ldyIsICIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSgiLmNvbmZpcm0iLCAiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCkpLmhpZGUoKSwgYShHKS5kYXRhKCJkaXNhYmxlZCIsICExKSwgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCI6aW5wdXQ6dmlzaWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcpWzBdLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiI2NOZXciLCAiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCkpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIi5jb25maXJtIiwgIiMiICsgYS5qZ3JpZC5qcUlEKFIudGhlbW9kYWwpKS5oaWRlKCksIGEoRykuZGF0YSgiZGlzYWJsZWQiLCAhMSksIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChKKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGMuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBrW3gucC5pZF0ub25DbG9zZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDoga1t4LnAuaWRdLnJlbW92ZW1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1wcm9wOiAha1t4LnAuaWRdLnJlY3JlYXRlRm9ybSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtOiBrW3gucC5pZF0uZm9ybQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0SW5pdGlhbGl6ZUZvcm0iLCBbYShHKSwgTF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLm9uSW5pdGlhbGl6ZUZvcm0pICYmIGtbeC5wLmlkXS5vbkluaXRpYWxpemVGb3JtLmNhbGwoeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoRyksIEwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiX2VtcHR5IiAhPT0gYiAmJiBrW3gucC5pZF0udmlld1BhZ2VyQnV0dG9ucyA/IGEoIiNwRGF0YSwjbkRhdGEiLCBIKS5zaG93KCkgOiBhKCIjcERhdGEsI25EYXRhIiwgSCkuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0QmVmb3JlU2hvd0Zvcm0iLCBbYShHKSwgTF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oa1t4LnAuaWRdLmJlZm9yZVNob3dGb3JtKSAmJiBrW3gucC5pZF0uYmVmb3JlU2hvd0Zvcm0uY2FsbCh4LCBhKEcpLCBMKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCkpLmRhdGEoIm9uQ2xvc2UiLCBrW3gucC5pZF0ub25DbG9zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQudmlld01vZGFsKCIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoSiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGMuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXk6IGMub3ZlcmxheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsOiBjLm1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheUNsYXNzOiBjLm92ZXJsYXlDbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzRmllbGQ6IGMuZm9jdXNGaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uSGlkZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2VkaXRtb2QiICsgSilbMF0uc3R5bGUuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYSgiI2VkaXRtb2QiICsgSilbMF0uc3R5bGUud2lkdGg7IC0gMSA8IGMuaW5kZXhPZigicHgiKSAmJiAoYyA9IHBhcnNlRmxvYXQoYykpOyAtIDEgPCBmLmluZGV4T2YoInB4IikgJiYgKGYgPSBwYXJzZUZsb2F0KGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLmRhdGEoImZvcm1Qcm9wIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHBhcnNlRmxvYXQoYShiLncpLmNzcygidG9wIikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwYXJzZUZsb2F0KGEoYi53KS5jc3MoImxlZnQiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFoZWlnaHQ6IGEoRykuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF3aWR0aDogYShHKS53aWR0aCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi53LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubyAmJiBiLm8ucmVtb3ZlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFkgfHwgYSgiLiIgKyBhLmpncmlkLmpxSUQoYy5vdmVybGF5Q2xhc3MpKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5KCkgPyAoYS5qZ3JpZC5oaWRlTW9kYWwoIiMiICsgYS5qZ3JpZC5qcUlEKFIudGhlbW9kYWwpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKEopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogYy5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGtbeC5wLmlkXS5vbkNsb3NlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiBrW3gucC5pZF0ucmVtb3ZlbW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3gucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06IGtbeC5wLmlkXS5mb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEpIDogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIi5mbS1idXR0b24iLCAiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCkpLmhvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hZGRDbGFzcyhlLmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoZS5ob3ZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNzRGF0YSIsIEgpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEUgPSB7fSwgYSgiLkZvcm1FcnJvciIsIEcpLmhpZGUoKSwgZCgpLCAiX2VtcHR5IiA9PT0gRVt4LnAuaWQgKyAiX2lkIl0gPyB1KCkgOiAhMCA9PT0gYy5jaGVja09uU3VibWl0ID8gKE4gPSB6KEUsIGtbeC5wLmlkXS5fc2F2ZWREYXRhKSwgTiA/IChhKEcpLmRhdGEoImRpc2FibGVkIiwgITApLCBhKCIuY29uZmlybSIsICIjIiArIGEuamdyaWQuanFJRChSLnRoZW1vZGFsKSkuc2hvdygpKSA6IHUoKSkgOiB1KCksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjY0RhdGEiLCBIKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5KCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhLmpncmlkLmhpZGVNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoUi50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKEopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGMuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZToga1t4LnAuaWRdLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiBrW3gucC5pZF0ucmVtb3ZlbW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1wcm9wOiAha1t4LnAuaWRdLnJlY3JlYXRlRm9ybSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybToga1t4LnAuaWRdLmZvcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEpIDogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNuRGF0YSIsIEgpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF5KCkpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIi5Gb3JtRXJyb3IiLCBHKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiWzBdID0gcGFyc2VJbnQoYlswXSwgMTApLCAtMSAhPT0gYlswXSAmJiBiWzFdW2JbMF0gKyAxXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZEFkZEVkaXRDbGlja1BnQnV0dG9ucyIsIFsibmV4dCIsIGEoRyksIGJbMV1bYlswXV1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pc0Z1bmN0aW9uKGMub25jbGlja1BnQnV0dG9ucykgJiYgKGYgPSBjLm9uY2xpY2tQZ0J1dHRvbnMuY2FsbCh4LCAibmV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKEcpLCBiWzFdW2JbMF1dKSwgdm9pZCAwICE9PSBmICYmICExID09PSBmKSB8fCBhKCIjIiArIGEuamdyaWQuanFJRChiWzFdW2JbMF0gKyAxXSkpLmhhc0NsYXNzKGUuZGlzYWJsZWQpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyhiWzFdW2JbMF0gKyAxXSwgeCwgRyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh4KS5qcUdyaWQoInNldFNlbGVjdGlvbiIsIGJbMV1bYlswXSArIDFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0QWZ0ZXJDbGlja1BnQnV0dG9ucyIsIFsibmV4dCIsIGEoRyksIGJbMV1bYlswXV1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oYy5hZnRlcmNsaWNrUGdCdXR0b25zKSAmJiBjLmFmdGVyY2xpY2tQZ0J1dHRvbnMuY2FsbCh4LCAibmV4dCIsIGEoRyksIGJbMV1bYlswXSArIDFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDKGJbMF0gKyAxLCBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjcERhdGEiLCBIKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgheSgpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIuRm9ybUVycm9yIiwgRykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB2KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT09IGJbMF0gJiYgYlsxXVtiWzBdIC0gMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0Q2xpY2tQZ0J1dHRvbnMiLCBbInByZXYiLCBhKEcpLCBiWzFdW2JbMF1dXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaXNGdW5jdGlvbihjLm9uY2xpY2tQZ0J1dHRvbnMpICYmIChmID0gYy5vbmNsaWNrUGdCdXR0b25zLmNhbGwoeCwgInByZXYiLCBhKEcpLCBiWzFdW2JbMF1dKSwgdm9pZCAwICE9PSBmICYmICExID09PSBmKSB8fCBhKCIjIiArIGEuamdyaWQuanFJRChiWzFdW2JbMF0gLSAxXSkpLmhhc0NsYXNzKGUuZGlzYWJsZWQpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyhiWzFdW2JbMF0gLSAxXSwgeCwgRyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh4KS5qcUdyaWQoInNldFNlbGVjdGlvbiIsIGJbMV1bYlswXSAtIDFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0QWZ0ZXJDbGlja1BnQnV0dG9ucyIsIFsicHJldiIsIGEoRyksIGJbMV1bYlswXV1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oYy5hZnRlcmNsaWNrUGdCdXR0b25zKSAmJiBjLmFmdGVyY2xpY2tQZ0J1dHRvbnMuY2FsbCh4LCAicHJldiIsIGEoRyksIGJbMV1bYlswXSAtIDFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDKGJbMF0gLSAxLCBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHgpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRBZGRFZGl0QWZ0ZXJTaG93Rm9ybSIsIFthKEcpLCBMXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihrW3gucC5pZF0uYWZ0ZXJTaG93Rm9ybSkgJiYga1t4LnAuaWRdLmFmdGVyU2hvd0Zvcm0uY2FsbCh4LCBhKEcpLCBMKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWSA9IHYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyhZWzBdLCBZKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHZpZXdHcmlkUm93OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzWzBdLCAidmlldyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXNbMF0ucC5zdHlsZVVJLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEuamdyaWQuc3R5bGVVSVtnXS5mb3JtZWRpdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBhLmpncmlkLnN0eWxlVUlbZ10uY29tbW9uOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA9IGEuZXh0ZW5kKCEwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDUwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGF3aWR0aDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWc6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxTW9kYWw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkVzY2FwZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHN3aWR0aDogIjMwJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZWljb246IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2a2V5czogWyExLCAzOCwgNDBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNob3dGb3JtOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlSW5pdERhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3UGFnZXJCdXR0b25zOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3JlYXRlRm9ybTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVtb2RhbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtOiAidmlldyIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwgYyB8fCB7fSksIGtbYSh0aGlzKVswXS5wLmlkXSA9IGMsIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgIT09IGtbei5wLmlkXS5jbG9zZU9uRXNjYXBlICYmICEwICE9PSBrW3oucC5pZF0ubmF2a2V5c1swXSB8fCBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIudWktanFkaWFsb2ctdGl0bGViYXItY2xvc2UiLCAiIyIgKyBhLmpncmlkLmpxSUQoeC5tb2RhbGhlYWQpKS5hdHRyKCJ0YWJpbmRleCIsICItMSIpLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGgoYiwgZiwgZCwgZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3LCBsLCBuLCBxLCByLCB1LCBrLCBCLCB6LCB5ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAiPHRkIGNsYXNzPSdDYXB0aW9uVEQgZm9ybS12aWV3LWxhYmVsICIgKyBlLmNvbnRlbnQgKyAiJyB3aWR0aD0nIiArIGMubGFiZWxzd2lkdGggKyAiJz4mIzE2MDs8L3RkPjx0ZCBjbGFzcz0nRGF0YVREIGZvcm0tdmlldy1kYXRhIHVpLWhlbHBlci1yZXNldCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jb250ZW50ICsgIic+JiMxNjA7PC90ZD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAiPHRkIGNsYXNzPSdDYXB0aW9uVEQgZm9ybS12aWV3LWxhYmVsICIgKyBlLmNvbnRlbnQgKyAiJz4mIzE2MDs8L3RkPjx0ZCBjbGFzcz0nRGF0YVREIGZvcm0tdmlldy1kYXRhICIgKyBlLmNvbnRlbnQgKyAiJz4mIzE2MDs8L3RkPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBbImludGVnZXIiLCAibnVtYmVyIiwgImN1cnJlbmN5Il0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSAxOyBnID49IHU7IHUrKykgQyArPSAxID09PSB1ID8gQSA6IEs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoZi5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGwgPSB0aGlzLmVkaXRydWxlcyAmJiAhMCA9PT0gdGhpcy5lZGl0cnVsZXMuZWRpdGhpZGRlbiA/ICExIDogITAgPT09IHRoaXMuaGlkZGVuID8gITAgOiAhMSkgfHwgInJpZ2h0IiAhPT0gdGhpcy5hbGlnbiB8fCAodGhpcy5mb3JtYXR0ZXIgJiYgLTEgIT09IGEuaW5BcnJheSh0aGlzLmZvcm1hdHRlciwgdikgPyBFID0gTWF0aC5tYXgoRSwgcGFyc2VJbnQodGhpcy53aWR0aCwgMTApKSA6IEcgPSBNYXRoLm1heChHLCBwYXJzZUludCh0aGlzLndpZHRoLCAxMCkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgayA9IDAgIT09IEUgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFIDogMCAhPT0gRyA/IEcgOiAwLCBwID0gYShmKS5qcUdyaWQoImdldEluZCIsIGIpLCBhKGYucC5jb2xNb2RlbCkuZWFjaChmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodyA9IHRoaXMubmFtZSwgQiA9ICExLCBsID0gdGhpcy5lZGl0cnVsZXMgJiYgITAgPT09IHRoaXMuZWRpdHJ1bGVzLmVkaXRoaWRkZW4gPyAhMSA6ICEwID09PSB0aGlzLmhpZGRlbiA/ICEwIDogITEsIHIgPSBsID8gInN0eWxlPSdkaXNwbGF5Om5vbmUnIiA6ICIiLCB6ID0gImJvb2xlYW4iICE9IHR5cGVvZiB0aGlzLnZpZXdhYmxlID8gITAgOiB0aGlzLnZpZXdhYmxlLCAiY2IiICE9PSB3ICYmICJzdWJncmlkIiAhPT0gdyAmJiAicm4iICE9PSB3ICYmIHopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gITEgPT09IHAgPyAiIiA6IHcgPT09IGYucC5FeHBhbmRDb2x1bW4gJiYgITAgPT09IGYucC50cmVlR3JpZCA/IGEoInRkOmVxKCIgKyBiICsgIikiLCBmLnJvd3NbcF0pLnRleHQoKSA6IGEoInRkOmVxKCIgKyBiICsgIikiLCBmLnJvd3NbcF0pLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCID0gInJpZ2h0IiA9PT0gdGhpcy5hbGlnbiAmJiAwICE9PSBrID8gITAgOiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZXh0ZW5kKHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dhYm92ZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3djb250ZW50OiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmZvcm1vcHRpb25zIHx8IHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBhcnNlSW50KGMucm93cG9zLCAxMCkgfHwgeSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBwYXJzZUludCgyICogKHBhcnNlSW50KGMuY29scG9zLCAxMCkgfHwgMSksIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5yb3dhYm92ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGEoIjx0cj48dGQgY2xhc3M9J2NvbnRlbnRpbmZvJyBjb2xzcGFuPSciICsgMiAqIGcgKyAiJz4iICsgYy5yb3djb250ZW50ICsgIjwvdGQ+PC90cj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5hcHBlbmQobSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bMF0ucnAgPSBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBhKGQpLmZpbmQoInRyW3Jvd3Bvcz0iICsgZSArICJdIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gbi5sZW5ndGggJiYgKG4gPSBhKCI8dHIgIiArIHIgKyAiIHJvd3Bvcz0nIiArIGUgKyAiJz48L3RyPiIpLmFkZENsYXNzKCJGb3JtRGF0YSIpLmF0dHIoImlkIiwgInRydl8iICsgdyksIGEobikuYXBwZW5kKEMpLCBhKGQpLmFwcGVuZChuKSwgblswXS5ycCA9IGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRkOmVxKCIgKyAoaCAtIDIpICsgIikiLCBuWzBdKS5odG1sKCI8Yj4iICsgKHZvaWQgMCA9PT0gYy5sYWJlbCA/IGYucC5jb2xOYW1lc1tiXSA6IGMubGFiZWwpICsgIjwvYj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ZDplcSgiICsgKGggLSAxKSArICIpIiwgblswXSkuYXBwZW5kKCI8c3Bhbj4iICsgcSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L3NwYW4+IikuYXR0cigiaWQiLCAidl8iICsgdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQiAmJiBhKCJ0ZDplcSgiICsgKGggLSAxKSArICIpIHNwYW4iLCBuWzBdKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGV4dC1hbGlnbiI6ICJyaWdodCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBrICsgInB4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhbeV0gPSBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkrKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgMCA8IHkpIGIgPSBhKCI8dHIgY2xhc3M9J0Zvcm1EYXRhJyBzdHlsZT0nZGlzcGxheTpub25lJz48dGQgY2xhc3M9J0NhcHRpb25URCc+PC90ZD48dGQgY29sc3Bhbj0nIiArICgyICogZyAtIDEpICsgIicgY2xhc3M9J0RhdGFURCc+PGlucHV0IGNsYXNzPSdGb3JtRWxlbWVudCcgaWQ9J2lkX2cnIHR5cGU9J3RleHQnIG5hbWU9J2lkJyB2YWx1ZT0nIiArIGIgKyAiJy8+PC90ZD48L3RyPiIpLCBiWzBdLnJwID0geSArIDk5LCBhKGQpLmFwcGVuZChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGcoYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBlLCBkLCBoLCBtID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaCA9IGEoYykuanFHcmlkKCJnZXRJbmQiLCBiLCAhMCkpICYmIChhKCJ0ZCIsIGgpLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYy5wLmNvbE1vZGVsW2JdLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBjLnAuY29sTW9kZWxbYl0uZWRpdHJ1bGVzICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5wLmNvbE1vZGVsW2JdLmVkaXRydWxlcy5lZGl0aGlkZGVuID8gITEgOiAhMCA9PT0gYy5wLmNvbE1vZGVsW2JdLmhpZGRlbiA/ICEwIDogITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjYiIgIT09IGYgJiYgInN1YmdyaWQiICE9PSBmICYmICJybiIgIT09IGYgJiYgKGQgPSBmID09PSBjLnAuRXhwYW5kQ29sdW1uICYmICEwID09PSBjLnAudHJlZUdyaWQgPyBhKHRoaXMpLnRleHQoKSA6IGEodGhpcykuaHRtbCgpLCBmID0gYS5qZ3JpZC5qcUlEKCJ2XyIgKyBmKSwgYSgiIyIgKyBmICsgIiBzcGFuIiwgIiMiICsgQykuaHRtbChkKSwgZSAmJiBhKCIjIiArIGYsICIjIiArIEMpLnBhcmVudHMoInRyOmZpcnN0IikuaGlkZSgpLCBtKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIDAgPCBtICYmIGEoIiNpZF9nIiwgIiMiICsgQykudmFsKGIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHcoYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gY1sxXS5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGIgPyBhKCIjcERhdGEiLCAiIyIgKyBDICsgIl8yIikuYWRkQ2xhc3MoZS5kaXNhYmxlZCkgOiB2b2lkIDAgIT09IGNbMV1bYiAtIDFdICYmIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGNbMV1bYiAtIDFdKSkuaGFzQ2xhc3MoZS5kaXNhYmxlZCkgPyBhKCIjcERhdGEiLCBDICsgIl8yIikuYWRkQ2xhc3MoZS5kaXNhYmxlZCkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjcERhdGEiLCAiIyIgKyBDICsgIl8yIikucmVtb3ZlQ2xhc3MoZS5kaXNhYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9PT0gZiA/IGEoIiNuRGF0YSIsICIjIiArIEMgKyAiXzIiKS5hZGRDbGFzcyhlLmRpc2FibGVkKSA6IHZvaWQgMCAhPT0gY1sxXVtiICsgMV0gJiYgYSgiIyIgKyBhLmpncmlkLmpxSUQoY1sxXVtiICsgMV0pKS5oYXNDbGFzcyhlLmRpc2FibGVkKSA/IGEoIiNuRGF0YSIsIEMgKyAiXzIiKS5hZGRDbGFzcyhlLmRpc2FibGVkKSA6IGEoIiNuRGF0YSIsICIjIiArIEMgKyAiXzIiKS5yZW1vdmVDbGFzcyhlLmRpc2FibGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHopLmpxR3JpZCgiZ2V0RGF0YUlEcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgiI2lkX2ciLCAiIyIgKyBDKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2EuaW5BcnJheShjLCBiKSwgYl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh6LmdyaWQgJiYgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gei5wLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gIlZpZXdHcmlkXyIgKyBhLmpncmlkLmpxSUQoeSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSAiVmlld1RibF8iICsgYS5qZ3JpZC5qcUlEKHkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gIlZpZXdHcmlkXyIgKyB5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gIlZpZXdUYmxfIiArIHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVtb2RhbDogInZpZXdtb2QiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxoZWFkOiAidmlld2hkIiArIHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbGNvbnRlbnQ6ICJ2aWV3Y250IiArIHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlbG06IHAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCA9IGEuaXNGdW5jdGlvbihrW3oucC5pZF0uYmVmb3JlSW5pdERhdGEpID8ga1t6LnAuaWRdLmJlZm9yZUluaXREYXRhIDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtbei5wLmlkXS5zdHlsZVVJID0gei5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnJlY3JlYXRlRm9ybSB8fCBhKHopLmRhdGEoInZpZXdQcm9wIikgJiYgYS5leHRlbmQoa1thKHRoaXMpWzBdLnAuaWRdLCBhKHopLmRhdGEoInZpZXdQcm9wIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBKID0gaXNOYU4oa1thKHRoaXMpWzBdLnAuaWRdLmRhdGFoZWlnaHQpID8ga1thKHRoaXMpWzBdLnAuaWRdLmRhdGFoZWlnaHQgOiBrW2EodGhpcylbMF0ucC5pZF0uZGF0YWhlaWdodCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBpc05hTihrW2EodGhpcylbMF0ucC5pZF0uZGF0YXdpZHRoKSA/IGtbYSh0aGlzKVswXS5wLmlkXS5kYXRhd2lkdGggOiBrW2EodGhpcylbMF0ucC5pZF0uZGF0YXdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGEoIjxmb3JtIG5hbWU9J0Zvcm1Qb3N0JyBpZD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ICsgIicgY2xhc3M9J0Zvcm1HcmlkJyBzdHlsZT0nd2lkdGg6IiArIEcgKyAiO2hlaWdodDoiICsgSiArICI7Jz48L2Zvcm0+IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEgPSBhKCI8dGFibGUgaWQ9JyIgKyBBICsgIicgY2xhc3M9J0VkaXRUYWJsZSBWaWV3VGFibGUnPjx0Ym9keT48L3Rib2R5PjwvdGFibGU+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoei5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmZvcm1vcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiA9IE1hdGgubWF4KE4sIGEgPyBhLmNvbHBvcyB8fCAwIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMID0gTWF0aC5tYXgoTCwgYSA/IGEucm93cG9zIHx8IDAgOiAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSh2KS5hcHBlbmQoUSksIEggJiYgKEUgPSBILmNhbGwoeiwgdiksIHZvaWQgMCA9PT0gRSAmJiAoRSA9ICEwKSksICExICE9PSBFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgoYiwgeiwgUSwgTik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAicnRsIiA9PT0gei5wLmRpcmVjdGlvbiA/ICEwIDogITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSAiPGEgaWQ9JyIgKyAoQSA/ICJuRGF0YSIgOiAicERhdGEiKSArICInIGNsYXNzPSdmbS1idXR0b24gIiArIGUuYnV0dG9uICsgIic+PHNwYW4gY2xhc3M9JyIgKyBlLmljb25fYmFzZSArICIgIiArIGwuaWNvbl9wcmV2ICsgIic+PC9zcGFuPjwvYT4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFID0gIjxhIGlkPSciICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChBID8gInBEYXRhIiA6ICJuRGF0YSIpICsgIicgY2xhc3M9J2ZtLWJ1dHRvbiAiICsgZS5idXR0b24gKyAiJz48c3BhbiBjbGFzcz0nIiArIGUuaWNvbl9iYXNlICsgIiAiICsgbC5pY29uX25leHQgKyAiJz48L3NwYW4+PC9hPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEogPSAiPGEgaWQ9J2NEYXRhJyBjbGFzcz0nZm0tYnV0dG9uICIgKyBlLmJ1dHRvbiArICInPiIgKyBjLmJDbG9zZSArICI8L2E+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCBMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGEoUSlbMF0ucm93cywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERbYV0gPSBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEQuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEucnAgPiBiLnJwID8gMSA6IGEucnAgPCBiLnJwID8gLTEgOiAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChELCBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidGJvZHkiLCBRKS5hcHBlbmQoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYm94ID0gIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBhKCI8ZGl2PjwvZGl2PiIpLmFwcGVuZCh2KS5hcHBlbmQoIjx0YWJsZSBib3JkZXI9JzAnIGNsYXNzPSdFZGl0VGFibGUnIGlkPSciICsgQyArICJfMic+PHRib2R5Pjx0ciBpZD0nQWN0X0J1dHRvbnMnPjx0ZCBjbGFzcz0nbmF2QnV0dG9uJyB3aWR0aD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmxhYmVsc3dpZHRoICsgIic+IiArIChBID8gRSArIEggOiBIICsgRSkgKyAiPC90ZD48dGQgY2xhc3M9J0VkaXRCdXR0b24nPiIgKyBKICsgIjwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuY3JlYXRlTW9kYWwoeCwgdiwga1thKHRoaXMpWzBdLnAuaWRdLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoei5wLmlkKSwgYSgiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoei5wLmlkKSlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBICYmIChhKCIjcERhdGEsICNuRGF0YSIsICIjIiArIEMgKyAiXzIiKS5jc3MoImZsb2F0IiwgInJpZ2h0IiksIGEoIi5FZGl0QnV0dG9uIiwgIiMiICsgQyArICJfMiIpLmNzcygidGV4dC1hbGlnbiIsICJsZWZ0IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnZpZXdQYWdlckJ1dHRvbnMgfHwgYSgiI3BEYXRhLCAjbkRhdGEiLCAiIyIgKyBDICsgIl8yIikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyB4LnRoZW1vZGFsKS5rZXlkb3duKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgyNyA9PT0gYi53aGljaCkgcmV0dXJuIGtbei5wLmlkXS5jbG9zZU9uRXNjYXBlICYmIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRCh4LnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiBjLmdib3gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBjLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogYy5vbkNsb3NlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZW1vZGFsOiBrW3oucC5pZF0ucmVtb3ZlbW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXByb3A6ICFrW3oucC5pZF0ucmVjcmVhdGVGb3JtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm06IGtbei5wLmlkXS5mb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITAgPT09IGMubmF2a2V5c1swXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLndoaWNoID09PSBjLm5hdmtleXNbMV0pIHJldHVybiBhKCIjcERhdGEiLCAiIyIgKyBDICsgIl8yIikudHJpZ2dlcigiY2xpY2siKSwgITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIud2hpY2ggPT09IGMubmF2a2V5c1syXSkgcmV0dXJuIGEoIiNuRGF0YSIsICIjIiArIEMgKyAiXzIiKS50cmlnZ2VyKCJjbGljayIpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jbG9zZWljb24gPSBhLmV4dGVuZChbITAsICJsZWZ0IiwgbC5pY29uX2Nsb3NlXSwgYy5jbG9zZWljb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5jbG9zZWljb25bMF0gJiYgYSgiI2NEYXRhIiwgIiMiICsgQyArICJfMiIpLmFkZENsYXNzKCJyaWdodCIgPT09IGMuY2xvc2VpY29uWzFdID8gImZtLWJ1dHRvbi1pY29uLXJpZ2h0IiA6ICJmbS1idXR0b24taWNvbi1sZWZ0IikuYXBwZW5kKCI8c3BhbiBjbGFzcz0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmljb25fYmFzZSArICIgIiArIGMuY2xvc2VpY29uWzJdICsgIic+PC9zcGFuPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oYy5iZWZvcmVTaG93Rm9ybSkgJiYgYy5iZWZvcmVTaG93Rm9ybS5jYWxsKHosIGEoIiMiICsgcCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLnZpZXdNb2RhbCgiIyIgKyBhLmpncmlkLmpxSUQoeC50aGVtb2RhbCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdib3g6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKHkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBjLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiBjLm92ZXJsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogYy5tb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uSGlkZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoeikuZGF0YSgidmlld1Byb3AiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogcGFyc2VGbG9hdChhKGIudykuY3NzKCJ0b3AiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBhcnNlRmxvYXQoYShiLncpLmNzcygibGVmdCIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGEoYi53KS53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGEoYi53KS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWhlaWdodDogYSgiIyIgKyBwKS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXdpZHRoOiBhKCIjIiArIHApLndpZHRoKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLncucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vICYmIGIuby5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLmZtLWJ1dHRvbjpub3QoLiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5kaXNhYmxlZCArICIpIiwgIiMiICsgQyArICJfMiIpLmhvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hZGRDbGFzcyhlLmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoZS5ob3ZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2NEYXRhIiwgIiMiICsgQyArICJfMiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRCh4LnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRCh5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGMuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBjLm9uQ2xvc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlbW9kYWw6IGtbei5wLmlkXS5yZW1vdmVtb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtcHJvcDogIWtbei5wLmlkXS5yZWNyZWF0ZUZvcm0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybToga1t6LnAuaWRdLmZvcm0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI25EYXRhIiwgIiMiICsgQyArICJfMiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI0Zvcm1FcnJvciIsICIjIiArIEMpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJbMF0gPSBwYXJzZUludChiWzBdLCAxMCksIC0xICE9PSBiWzBdICYmIGJbMV1bYlswXSArIDFdICYmIChhLmlzRnVuY3Rpb24oYy5vbmNsaWNrUGdCdXR0b25zKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMub25jbGlja1BnQnV0dG9ucy5jYWxsKHosICJuZXh0IiwgYSgiIyIgKyBwKSwgYlsxXVtiWzBdXSksIGcoYlsxXVtiWzBdICsgMV0sIHopLCBhKHopLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgYlsxXVtiWzBdICsgMV0pLCBhLmlzRnVuY3Rpb24oYy5hZnRlcmNsaWNrUGdCdXR0b25zKSAmJiBjLmFmdGVyY2xpY2tQZ0J1dHRvbnMuY2FsbCh6LCAibmV4dCIsIGEoIiMiICsgcCksIGJbMV1bYlswXSArIDFdKSwgdyhiWzBdICsgMSwgYikpLCBkKCksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjcERhdGEiLCAiIyIgKyBDICsgIl8yIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjRm9ybUVycm9yIiwgIiMiICsgQykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB1KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTEgIT09IGJbMF0gJiYgYlsxXVtiWzBdIC0gMV0gJiYgKGEuaXNGdW5jdGlvbihjLm9uY2xpY2tQZ0J1dHRvbnMpICYmIGMub25jbGlja1BnQnV0dG9ucy5jYWxsKHosICJwcmV2IiwgYSgiIyIgKyBwKSwgYlsxXVtiWzBdXSksIGcoYlsxXVtiWzBdIC0gMV0sIHopLCBhKHopLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgYlsxXVtiWzBdIC0gMV0pLCBhLmlzRnVuY3Rpb24oYy5hZnRlcmNsaWNrUGdCdXR0b25zKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuYWZ0ZXJjbGlja1BnQnV0dG9ucy5jYWxsKHosICJwcmV2IiwgYSgiIyIgKyBwKSwgYlsxXVtiWzBdIC0gMV0pLCB3KGJbMF0gLSAxLCBiKSksIGQoKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB1KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcodlswXSwgdikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBkZWxHcmlkUm93OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzWzBdLCAiZGVsIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpc1swXS5wLnN0eWxlVUksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5zdHlsZVVJW2ddLmZvcm1lZGl0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEuamdyaWQuc3R5bGVVSVtnXS5jb21tb247CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjID0gYS5leHRlbmQoITAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjQwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5OiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWc6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsb2FkQWZ0ZXJTdWJtaXQ6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlU2hvd0Zvcm06IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVJbml0RGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU2hvd0Zvcm06IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTdWJtaXQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrU3VibWl0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJTdWJtaXQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcU1vZGFsOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Fc2NhcGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxpY29uOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbGljb246IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXhEZWxPcHRpb25zOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Npbmc6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplRGVsRGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZURhdGFQcm94eTogITEKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwgYyB8fCB7fSksIGtbYSh0aGlzKVswXS5wLmlkXSA9IGMsIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLmdyaWQgJiYgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoLCBnLCB3LCB1LCB6ID0gYS5pc0Z1bmN0aW9uKGtbZC5wLmlkXS5iZWZvcmVTaG93Rm9ybSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBhLmlzRnVuY3Rpb24oa1tkLnAuaWRdLmFmdGVyU2hvd0Zvcm0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gYS5pc0Z1bmN0aW9uKGtbZC5wLmlkXS5iZWZvcmVJbml0RGF0YSkgPyBrW2QucC5pZF0uYmVmb3JlSW5pdERhdGEgOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IGQucC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSAiRGVsVGJsXyIgKyBhLmpncmlkLmpxSUQoQyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSAiRGVsVGJsXyIgKyBDLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbW9kYWw6ICJkZWxtb2QiICsgQywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsaGVhZDogImRlbGhkIiArIEMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbGNvbnRlbnQ6ICJkZWxjbnQiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWxtOiB4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtbZC5wLmlkXS5zdHlsZVVJID0gZC5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIiwgYS5pc0FycmF5KGIpICYmIChiID0gYi5qb2luKCkpLCB2b2lkIDAgIT09IGEoIiMiICsgYS5qZ3JpZC5qcUlEKEUudGhlbW9kYWwpKVswXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocCAmJiAoQSA9IHAuY2FsbChkLCBhKCIjIiArIHgpKSwgdm9pZCAwID09PSBBICYmIChBID0gITApKSwgITEgPT09IEEpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI0RlbERhdGE+dGQiLCAiIyIgKyB4KS50ZXh0KGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjRGVsRXJyb3IiLCAiIyIgKyB4KS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBrW2QucC5pZF0ucHJvY2Vzc2luZyAmJiAoa1tkLnAuaWRdLnByb2Nlc3NpbmcgPSAhMSwgYSgiI2REYXRhIiwgIiMiICsgeCkucmVtb3ZlQ2xhc3MoZS5hY3RpdmUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiAmJiBrW2QucC5pZF0uYmVmb3JlU2hvd0Zvcm0uY2FsbChkLCBhKCIjIiArIHgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC52aWV3TW9kYWwoIiMiICsgYS5qZ3JpZC5qcUlEKEUudGhlbW9kYWwpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbToga1tkLnAuaWRdLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcU06ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheToga1tkLnAuaWRdLm92ZXJsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDoga1tkLnAuaWRdLm1vZGFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIE4gPSBpc05hTihrW2QucC5pZF0uZGF0YWhlaWdodCkgPyBrW2QucC5pZF0uZGF0YWhlaWdodCA6IGtbZC5wLmlkXS5kYXRhaGVpZ2h0ICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSBpc05hTihjLmRhdGF3aWR0aCkgPyBjLmRhdGF3aWR0aCA6IGMuZGF0YXdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSAiPGRpdiBpZD0nIiArIEggKyAiJyBjbGFzcz0nZm9ybWRhdGEnIHN0eWxlPSd3aWR0aDoiICsgTCArICI7b3ZlcmZsb3c6YXV0bztwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6IiArIE4gKyAiOyc+PHRhYmxlIGNsYXNzPSdEZWxUYWJsZSc+PHRib2R5PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIID0gSCArICgiPHRyIGlkPSdEZWxFcnJvcicgc3R5bGU9J2Rpc3BsYXk6bm9uZSc+PHRkIGNsYXNzPSciICsgZS5lcnJvciArICInPjwvdGQ+PC90cj4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSBIICsgKCI8dHIgaWQ9J0RlbERhdGEnIHN0eWxlPSdkaXNwbGF5Om5vbmUnPjx0ZCA+IiArIGIgKyAiPC90ZD48L3RyPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCA9IEggKyAoJzx0cj48dGQgY2xhc3M9ImRlbG1zZyIgc3R5bGU9IndoaXRlLXNwYWNlOnByZTsiPicgKyBrW2QucC5pZF0ubXNnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC90ZD48L3RyPjx0cj48dGQgPiYjMTYwOzwvdGQ+PC90cj4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSBIICsgIjwvdGJvZHk+PC90YWJsZT48L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSCArPSAiPHRhYmxlIGNsYXNzPSdFZGl0VGFibGUgdWktY29tbW9uLXRhYmxlJyBpZD0nIiArIHggKyAiXzInPjx0Ym9keT48dHI+PHRkPjxociBjbGFzcz0nIiArIGUuY29udGVudCArICInIHN0eWxlPSdtYXJnaW46MXB4Jy8+PC90ZD48L3RyPjx0cj48dGQgY2xhc3M9J0RlbEJ1dHRvbiBFZGl0QnV0dG9uJz4iICsgKCI8YSBpZD0nZERhdGEnIGNsYXNzPSdmbS1idXR0b24gIiArIGUuYnV0dG9uICsgIic+IiArIGMuYlN1Ym1pdCArICI8L2E+IikgKyAiJiMxNjA7IiArICgiPGEgaWQ9J2VEYXRhJyBjbGFzcz0nZm0tYnV0dG9uICIgKyBlLmJ1dHRvbiArICInPiIgKyBjLmJDYW5jZWwgKyAiPC9hPiIpICsgIjwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+IiwgYy5nYm94ID0gIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoQyksIGEuamdyaWQuY3JlYXRlTW9kYWwoRSwgSCwga1tkLnAuaWRdLCAiI2d2aWV3XyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChkLnAuaWQpKVswXSksIHAgJiYgKEEgPSBwLmNhbGwoZCwgYShIKSksIHZvaWQgMCA9PT0gQSAmJiAoQSA9ICEwKSksICExID09PSBBKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIi5mbS1idXR0b24iLCAiIyIgKyB4ICsgIl8yIikuaG92ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKGUuaG92ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcyhlLmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5kZWxpY29uID0gYS5leHRlbmQoWyEwLCAibGVmdCIsIGwuaWNvbl9kZWxdLCBrW2QucC5pZF0uZGVsaWNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuY2FuY2VsaWNvbiA9IGEuZXh0ZW5kKFshMCwgImxlZnQiLCBsLmljb25fY2FuY2VsXSwga1tkLnAuaWRdLmNhbmNlbGljb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5kZWxpY29uWzBdICYmIGEoIiNkRGF0YSIsICIjIiArIHggKyAiXzIiKS5hZGRDbGFzcygicmlnaHQiID09PSBjLmRlbGljb25bMV0gPyAiZm0tYnV0dG9uLWljb24tcmlnaHQiIDogImZtLWJ1dHRvbi1pY29uLWxlZnQiKS5hcHBlbmQoIjxzcGFuIGNsYXNzPSciICsgZS5pY29uX2Jhc2UgKyAiICIgKyBjLmRlbGljb25bMl0gKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIic+PC9zcGFuPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYy5jYW5jZWxpY29uWzBdICYmIGEoIiNlRGF0YSIsICIjIiArIHggKyAiXzIiKS5hZGRDbGFzcygicmlnaHQiID09PSBjLmNhbmNlbGljb25bMV0gPyAiZm0tYnV0dG9uLWljb24tcmlnaHQiIDogImZtLWJ1dHRvbi1pY29uLWxlZnQiKS5hcHBlbmQoIjxzcGFuIGNsYXNzPSciICsgZS5pY29uX2Jhc2UgKyAiICIgKyBjLmNhbmNlbGljb25bMl0gKyAiJz48L3NwYW4+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNkRGF0YSIsICIjIiArIHggKyAiXzIiKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBmID0gWyEwLCAiIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoIiNEZWxEYXRhPnRkIiwgIiMiICsgeCkudGV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYgPSB7fSwgYS5pc0Z1bmN0aW9uKGtbZC5wLmlkXS5vbmNsaWNrU3VibWl0KSAmJiAodiA9IGtbZC5wLmlkXS5vbmNsaWNrU3VibWl0LmNhbGwoZCwga1tkLnAuaWRdLCBsKSB8fCB7fSksIGEuaXNGdW5jdGlvbihrW2QucC5pZF0uYmVmb3JlU3VibWl0KSAmJiAoZiA9IGtbZC5wLmlkXS5iZWZvcmVTdWJtaXQuY2FsbChkLCBsKSksIGZbMF0gJiYgIWtbZC5wLmlkXS5wcm9jZXNzaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtbZC5wLmlkXS5wcm9jZXNzaW5nID0gITAsIHcgPSBkLnAucHJtTmFtZXMsIGggPSBhLmV4dGVuZCh7fSwga1tkLnAuaWRdLmRlbERhdGEsIHYpLCB1ID0gdy5vcGVyLCBoW3VdID0gdy5kZWxvcGVyLCBnID0gdy5pZCwgbCA9IFN0cmluZyhsKS5zcGxpdCgiLCIpLCAhbC5sZW5ndGgpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgaW4gbCkgbC5oYXNPd25Qcm9wZXJ0eShiKSAmJiAobFtiXSA9IGEuamdyaWQuc3RyaXBQcmVmKGQucC5pZFByZWZpeCwgbFtiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhbZ10gPSBsLmpvaW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKGUuYWN0aXZlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGtbZC5wLmlkXS51cmwgfHwgYShkKS5qcUdyaWQoImdldEdyaWRQYXJhbSIsICJlZGl0dXJsIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGtbZC5wLmlkXS5tdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYS5pc0Z1bmN0aW9uKGtbZC5wLmlkXS5zZXJpYWxpemVEZWxEYXRhKSA/IGtbZC5wLmlkXS5zZXJpYWxpemVEZWxEYXRhLmNhbGwoZCwgaCkgOiBoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oYiwgZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSgiI2REYXRhIiwgIiMiICsgeCArICJfMiIpLnJlbW92ZUNsYXNzKGUuYWN0aXZlKSwgMzAwIDw9IGIuc3RhdHVzICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzA0ICE9PSBiLnN0YXR1cyA/IChmWzBdID0gITEsIGZbMV0gPSBhLmlzRnVuY3Rpb24oa1tkLnAuaWRdLmVycm9yVGV4dEZvcm1hdCkgPyBrW2QucC5pZF0uZXJyb3JUZXh0Rm9ybWF0LmNhbGwoZCwgYikgOiBnICsgIiBTdGF0dXM6ICciICsgYi5zdGF0dXNUZXh0ICsgIicuIEVycm9yIGNvZGU6ICIgKyBiLnN0YXR1cykgOiBhLmlzRnVuY3Rpb24oa1tkLnAuaWRdLmFmdGVyU3VibWl0KSAmJiAoZiA9IGtbZC5wLmlkXS5hZnRlclN1Ym1pdC5jYWxsKGQsIGIsIGgpKSwgITEgPT09IGZbMF0pIGEoIiNEZWxFcnJvcj50ZCIsICIjIiArIHgpLmh0bWwoZlsxXSksIGEoIiNEZWxFcnJvciIsICIjIiArIHgpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrW2QucC5pZF0ucmVsb2FkQWZ0ZXJTdWJtaXQgJiYgImxvY2FsIiAhPT0gZC5wLmRhdGF0eXBlKSBhKGQpLnRyaWdnZXIoInJlbG9hZEdyaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBkLnAudHJlZUdyaWQpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQpLmpxR3JpZCgiZGVsVHJlZU5vZGUiLCBkLnAuaWRQcmVmaXggKyBsWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7fSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHcgPSAwOyB3IDwgbC5sZW5ndGg7IHcrKykgYShkKS5qcUdyaWQoImRlbFJvd0RhdGEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5pZFByZWZpeCArIGxbd10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuc2Vscm93ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLnNlbGFycnJvdyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihrW2QucC5pZF0uYWZ0ZXJDb21wbGV0ZSkgJiYgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga1tkLnAuaWRdLmFmdGVyQ29tcGxldGUuY2FsbChkLCBiLCBsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtbZC5wLmlkXS5wcm9jZXNzaW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmWzBdICYmIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChFLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGMuanFNb2RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBrW2QucC5pZF0ub25DbG9zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGEuamdyaWQuYWpheE9wdGlvbnMsIGtbZC5wLmlkXS5hamF4RGVsT3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIudXJsIHx8IGtbZC5wLmlkXS51c2VEYXRhUHJveHkgfHwgKGEuaXNGdW5jdGlvbihkLnAuZGF0YVByb3h5KSA/IGtbZC5wLmlkXS51c2VEYXRhUHJveHkgPSAhMCA6IChmWzBdID0gITEsIGZbMV0gKz0gIiAiICsgYS5qZ3JpZC5nZXRSZWdpb25hbChkLCAiZXJyb3JzLm5vdXJsIikpKSwgZlswXSkga1tkLnAuaWRdLnVzZURhdGFQcm94eSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChiID0gZC5wLmRhdGFQcm94eS5jYWxsKGQsIGIsICJkZWxfIiArIGQucC5pZCksIHZvaWQgMCA9PT0gYiAmJiAoYiA9IFshMCwgIiJdKSwgITEgPT09IGJbMF0gPyAoZlswXSA9ICExLCBmWzFdID0gYlsxXSB8fCAiRXJyb3IgZGVsZXRpbmcgdGhlIHNlbGVjdGVkIHJvdyEiKSA6IGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChFLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2I6ICIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKEMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiBjLmpxTW9kYWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBrW2QucC5pZF0ub25DbG9zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkgOiAiY2xpZW50QXJyYXkiID09PSBiLnVybCA/IChoID0gYi5kYXRhLCBiLmNvbXBsZXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgIiIpKSA6IGEuYWpheChiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExID09PSBmWzBdICYmIChhKCIjRGVsRXJyb3I+dGQiLCAiIyIgKyB4KS5odG1sKGZbMV0pLCBhKCIjRGVsRXJyb3IiLCAiIyIgKyB4KS5zaG93KCkpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI2VEYXRhIiwgIiMiICsgeCArICJfMiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuamdyaWQuaGlkZU1vZGFsKCIjIiArIGEuamdyaWQuanFJRChFLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdiOiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGtbZC5wLmlkXS5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGtbZC5wLmlkXS5vbkNsb3NlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogJiYga1tkLnAuaWRdLmJlZm9yZVNob3dGb3JtLmNhbGwoZCwgYSgiIyIgKyB4KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQudmlld01vZGFsKCIjIiArIGEuamdyaWQuanFJRChFLnRoZW1vZGFsKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoQyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06IGtbZC5wLmlkXS5qcU1vZGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheToga1tkLnAuaWRdLm92ZXJsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbDoga1tkLnAuaWRdLm1vZGFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgJiYga1tkLnAuaWRdLmFmdGVyU2hvd0Zvcm0uY2FsbChkLCBhKCIjIiArIHgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0ga1tkLnAuaWRdLmNsb3NlT25Fc2NhcGUgJiYgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlIiwgIiMiICsgYS5qZ3JpZC5qcUlEKEUubW9kYWxoZWFkKSkuYXR0cigidGFiaW5kZXgiLCAiLTEiKS5mb2N1cygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG5hdkdyaWQ6IGZ1bmN0aW9uKGIsIGMsIGQsIGcsCiAgICAgICAgICAgICAgICAgICAgICAgIGwsIGUsIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhLmpncmlkLmdldFJlZ2lvbmFsKHRoaXNbMF0sICJuYXYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSB0aGlzWzBdLnAuc3R5bGVVSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBhLmpncmlkLnN0eWxlVUlbcl0ubmF2aWdhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEuamdyaWQuc3R5bGVVSVtyXS5jb21tb247CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0aWNvbjogcS5pY29uX2VkaXRfbmF2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGljb246IHEuaWNvbl9hZGRfbmF2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGljb246IHEuaWNvbl9kZWxfbmF2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaGljb246IHEuaWNvbl9zZWFyY2hfbmF2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoaWNvbjogcS5pY29uX3JlZnJlc2hfbmF2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaHN0YXRlOiAiZmlyc3RwYWdlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld2ljb246IHEuaWNvbl92aWV3X25hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAibGVmdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uRXNjYXBlOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVJlZnJlc2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlclJlZnJlc2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9uZVRvVG9wOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0d2lkdGg6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0aGVpZ2h0OiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydHRvcDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0bGVmdDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0ekluZGV4OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG1lbnU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2QnV0dG9uVGV4dDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgaywgYyB8fCB7fSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5wLm5hdkdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSwgeSwgcCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1vZGFsOiAiYWxlcnRtb2RfIiArIHRoaXMucC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsaGVhZDogImFsZXJ0aGRfIiArIHRoaXMucC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsY29udGVudDogImFsZXJ0Y250XyIgKyB0aGlzLnAuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEMuZ3JpZCAmJiAic3RyaW5nIiA9PSB0eXBlb2YgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKEMpLmRhdGEoIm5hdkdyaWQiKSB8fCBhKEMpLmRhdGEoIm5hdkdyaWQiLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGEoQykuZGF0YSgibmF2R3JpZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLnAuZm9yY2VfcmVnaW9uYWwgJiYgKHkgPSBhLmV4dGVuZCh5LCBrKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gYSgiIyIgKyBwLnRoZW1vZGFsKVswXSAmJiAoeS5hbGVydHRvcCB8fCB5LmFsZXJ0bGVmdCB8fCAodm9pZCAwICE9PSB3aW5kb3cuaW5uZXJXaWR0aCA/ICh5LmFsZXJ0bGVmdCA9IHdpbmRvdy5pbm5lcldpZHRoLCB5LmFsZXJ0dG9wID0gd2luZG93LmlubmVySGVpZ2h0KSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiB2b2lkIDAgIT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAmJiAwICE9PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPyAoeS5hbGVydGxlZnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIHkuYWxlcnR0b3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSA6ICh5LmFsZXJ0bGVmdCA9IDEwMjQsIHkuYWxlcnR0b3AgPSA3NjgpLCB5LmFsZXJ0bGVmdCA9IHkuYWxlcnRsZWZ0IC8gMiAtIHBhcnNlSW50KHkuYWxlcnR3aWR0aCwgMTApIC8gMiwgeS5hbGVydHRvcCA9IHkuYWxlcnR0b3AgLyAyIC0gMjUpLCBhLmpncmlkLmNyZWF0ZU1vZGFsKHAsICI8ZGl2PiIgKyB5LmFsZXJ0dGV4dCArICI8L2Rpdj48c3BhbiB0YWJpbmRleD0nMCc+PHNwYW4gdGFiaW5kZXg9Jy0xJyBpZD0nanFnX2FscnQnPjwvc3Bhbj48L3NwYW4+IiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoQy5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxTW9kYWw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemU6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogeS5hbGVydGNhcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogeS5hbGVydHRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHkuYWxlcnRsZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHkuYWxlcnR3aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogeS5hbGVydGhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Fc2NhcGU6IHkuY2xvc2VPbkVzY2FwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogeS5hbGVydHpJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IEMucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sICIjZ3ZpZXdfIiArIGEuamdyaWQuanFJRChDLnAuaWQpLCBhKCIjZ2JveF8iICsgYS5qZ3JpZC5qcUlEKEMucC5pZCkpWzBdLCAhMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiwgQSA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5oYXNDbGFzcyh1LmRpc2FibGVkKSB8fCBhKHRoaXMpLmFkZENsYXNzKHUuaG92ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3ModS5ob3ZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuY2xvbmVUb1RvcCAmJiBDLnAudG9wcGFnZXIgJiYgKEEgPSAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2ID0gMDsgQSA+IHY7IHYrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEUsIE4sIEwsIEogPSBhKCI8dGFibGUgY2xhc3M9J3VpLXBnLXRhYmxlIG5hdnRhYmxlIHVpLWNvbW1vbi10YWJsZSc+PHRib2R5Pjx0cj48L3RyPjwvdGJvZHk+PC90YWJsZT4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSAiPHRkIGNsYXNzPSd1aS1wZy1idXR0b24gIiArIHUuZGlzYWJsZWQgKyAiJyBzdHlsZT0nd2lkdGg6NHB4Oyc+PHNwYW4gY2xhc3M9J3VpLXNlcGFyYXRvcic+PC9zcGFuPjwvdGQ+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IHYgPyAoTiA9IGIsIEwgPSBDLnAuaWQsIE4gPT09IEMucC50b3BwYWdlciAmJiAoTCArPSAiX3RvcCIsIEEgPSAxKSkgOiAoTiA9IEMucC50b3BwYWdlciwgTCA9IEMucC5pZCArICJfdG9wIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicnRsIiA9PT0gQy5wLmRpcmVjdGlvbiAmJiBhKEopLmF0dHIoImRpciIsICJydGwiKS5jc3MoImZsb2F0IiwgInJpZ2h0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuYWRkICYmIChFID0gYSgiPHRkIGNsYXNzPSd1aS1wZy1idXR0b24gIiArIHUuY29ybmVyYWxsICsgIic+PC90ZD4iKSwgYShFKS5hcHBlbmQoIjxkaXYgY2xhc3M9J3VpLXBnLWRpdic+PHNwYW4gY2xhc3M9JyIgKyB1Lmljb25fYmFzZSArICIgIiArIHkuYWRkaWNvbiArICInPjwvc3Bhbj4iICsgeS5hZGR0ZXh0ICsgIjwvZGl2PiIpLCBhKCJ0ciIsIEopLmFwcGVuZChFKSwgYShFLCBKKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogeS5hZGR0aXRsZSB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZy5pZCB8fCAiYWRkXyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSh0aGlzKS5oYXNDbGFzcyh1LmRpc2FibGVkKSB8fCAoYS5pc0Z1bmN0aW9uKHkuYWRkZnVuYykgPyB5LmFkZGZ1bmMuY2FsbChDKSA6IGEoQykuanFHcmlkKCJlZGl0R3JpZFJvdyIsICJuZXciLCBnKSksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5ob3Zlcih4LCBIKSwgRSA9IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGQgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LmVkaXQgJiYgKEUgPSBhKCI8dGQgY2xhc3M9J3VpLXBnLWJ1dHRvbiAiICsgdS5jb3JuZXJhbGwgKyAiJz48L3RkPiIpLCBhKEUpLmFwcGVuZCgiPGRpdiBjbGFzcz0ndWktcGctZGl2Jz48c3BhbiBjbGFzcz0nIiArIHUuaWNvbl9iYXNlICsgIiAiICsgeS5lZGl0aWNvbiArICInPjwvc3Bhbj4iICsgeS5lZGl0dGV4dCArICI8L2Rpdj4iKSwgYSgidHIiLCBKKS5hcHBlbmQoRSksIGEoRSwgSikuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHkuZWRpdHRpdGxlIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkLmlkIHx8ICJlZGl0XyIgKyBMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEodGhpcykuaGFzQ2xhc3ModS5kaXNhYmxlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBDLnAuc2Vscm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID8gYS5pc0Z1bmN0aW9uKHkuZWRpdGZ1bmMpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuZWRpdGZ1bmMuY2FsbChDLCBiKSA6IGEoQykuanFHcmlkKCJlZGl0R3JpZFJvdyIsIGIsIGQpIDogKGEuamdyaWQudmlld01vZGFsKCIjIiArIHAudGhlbW9kYWwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjanFnX2FscnQiKS5mb2N1cygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmhvdmVyKHgsIEgpLCBFID0gbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gbiB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkudmlldyAmJiAoRSA9IGEoIjx0ZCBjbGFzcz0ndWktcGctYnV0dG9uICIgKyB1LmNvcm5lcmFsbCArICInPjwvdGQ+IiksIGEoRSkuYXBwZW5kKCI8ZGl2IGNsYXNzPSd1aS1wZy1kaXYnPjxzcGFuIGNsYXNzPSciICsgdS5pY29uX2Jhc2UgKyAiICIgKyB5LnZpZXdpY29uICsgIic+PC9zcGFuPiIgKyB5LnZpZXd0ZXh0ICsgIjwvZGl2PiIpLCBhKCJ0ciIsIEopLmFwcGVuZChFKSwgYShFLCBKKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogeS52aWV3dGl0bGUgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG4uaWQgfHwgInZpZXdfIiArIEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYSh0aGlzKS5oYXNDbGFzcyh1LmRpc2FibGVkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IEMucC5zZWxyb3c7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyBhLmlzRnVuY3Rpb24oeS52aWV3ZnVuYykgPyB5LnZpZXdmdW5jLmNhbGwoQywgYikgOiBhKEMpLmpxR3JpZCgidmlld0dyaWRSb3ciLCBiLCBuKSA6IChhLmpncmlkLnZpZXdNb2RhbCgiIyIgKyBwLnRoZW1vZGFsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiI2pxZ19hbHJ0IikuZm9jdXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5ob3Zlcih4LCBIKSwgRSA9IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGwgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LmRlbCAmJiAoRSA9IGEoIjx0ZCBjbGFzcz0ndWktcGctYnV0dG9uICIgKyB1LmNvcm5lcmFsbCArICInPjwvdGQ+IiksIGEoRSkuYXBwZW5kKCI8ZGl2IGNsYXNzPSd1aS1wZy1kaXYnPjxzcGFuIGNsYXNzPSciICsgdS5pY29uX2Jhc2UgKyAiICIgKyB5LmRlbGljb24gKyAiJz48L3NwYW4+IiArIHkuZGVsdGV4dCArICI8L2Rpdj4iKSwgYSgidHIiLCBKKS5hcHBlbmQoRSksIGEoRSwgSikuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHkuZGVsdGl0bGUgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGwuaWQgfHwgImRlbF8iICsgTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhKHRoaXMpLmhhc0NsYXNzKHUuZGlzYWJsZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLnAubXVsdGlzZWxlY3QgPyAoYiA9IEMucC5zZWxhcnJyb3csIDAgPT09IGIubGVuZ3RoICYmIChiID0gbnVsbCkpIDogYiA9IEMucC5zZWxyb3c7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyBhLmlzRnVuY3Rpb24oeS5kZWxmdW5jKSA/IHkuZGVsZnVuYy5jYWxsKEMsIGIpIDogYShDKS5qcUdyaWQoImRlbEdyaWRSb3ciLCBiLCBsKSA6IChhLmpncmlkLnZpZXdNb2RhbCgiIyIgKyBwLnRoZW1vZGFsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChDLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiI2pxZ19hbHJ0IikuZm9jdXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5ob3Zlcih4LCBIKSwgRSA9IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHkuYWRkIHx8IHkuZWRpdCB8fCB5LmRlbCB8fCB5LnZpZXcpICYmIGEoInRyIiwgSikuYXBwZW5kKHEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LnNlYXJjaCAmJiAoRSA9IGEoIjx0ZCBjbGFzcz0ndWktcGctYnV0dG9uICIgKyB1LmNvcm5lcmFsbCArICInPjwvdGQ+IiksIGEoRSkuYXBwZW5kKCI8ZGl2IGNsYXNzPSd1aS1wZy1kaXYnPjxzcGFuIGNsYXNzPSciICsgdS5pY29uX2Jhc2UgKyAiICIgKyB5LnNlYXJjaGljb24gKyAiJz48L3NwYW4+IiArIHkuc2VhcmNodGV4dCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIpLCBhKCJ0ciIsIEopLmFwcGVuZChFKSwgYShFLCBKKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogeS5zZWFyY2h0aXRsZSB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZS5pZCB8fCAic2VhcmNoXyIgKyBMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSh0aGlzKS5oYXNDbGFzcyh1LmRpc2FibGVkKSB8fCAoYS5pc0Z1bmN0aW9uKHkuc2VhcmNoZnVuYykgPyB5LnNlYXJjaGZ1bmMuY2FsbChDLCBlKSA6IGEoQykuanFHcmlkKCJzZWFyY2hHcmlkIiwgZSkpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuaG92ZXIoeCwgSCksIGUuc2hvd09uTG9hZCAmJiAhMCA9PT0gZS5zaG93T25Mb2FkICYmIGEoRSwgSikuY2xpY2soKSwgRSA9IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5yZWZyZXNoICYmIChFID0gYSgiPHRkIGNsYXNzPSd1aS1wZy1idXR0b24gIiArIHUuY29ybmVyYWxsICsgIic+PC90ZD4iKSwgYShFKS5hcHBlbmQoIjxkaXYgY2xhc3M9J3VpLXBnLWRpdic+PHNwYW4gY2xhc3M9JyIgKyB1Lmljb25fYmFzZSArICIgIiArIHkucmVmcmVzaGljb24gKyAiJz48L3NwYW4+IiArIHkucmVmcmVzaHRleHQgKyAiPC9kaXY+IiksIGEoInRyIiwgSikuYXBwZW5kKEUpLCBhKEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSikuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHkucmVmcmVzaHRpdGxlIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAicmVmcmVzaF8iICsgTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhKHRoaXMpLmhhc0NsYXNzKHUuZGlzYWJsZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbih5LmJlZm9yZVJlZnJlc2gpICYmIHkuYmVmb3JlUmVmcmVzaC5jYWxsKEMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLnAuc2VhcmNoID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMucC5yZXNldHNlYXJjaCA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJjdXJyZW50ZmlsdGVyIiAhPT0geS5yZWZyZXNoc3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IEMucC5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLnAucG9zdERhdGEuZmlsdGVycyA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNmYm94XyIgKyBhLmpncmlkLmpxSUQoYikpLmpxRmlsdGVyKCJyZXNldEZpbHRlciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoYykge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oQy5jbGVhclRvb2xiYXIpICYmIEMuY2xlYXJUb29sYmFyLmNhbGwoQywgITEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoeS5yZWZyZXNoc3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZpcnN0cGFnZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShDKS50cmlnZ2VyKCJyZWxvYWRHcmlkIiwgW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImN1cnJlbnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY3VycmVudGZpbHRlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShDKS50cmlnZ2VyKCJyZWxvYWRHcmlkIiwgW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oeS5hZnRlclJlZnJlc2gpICYmIHkuYWZ0ZXJSZWZyZXNoLmNhbGwoQykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5ob3Zlcih4LCBIKSwgRSA9IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGEoIi51aS1qcWdyaWQiKS5jc3MoImZvbnQtc2l6ZSIpIHx8ICIxMXB4IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoImJvZHkiKS5hcHBlbmQoIjxkaXYgaWQ9J3Rlc3RwZzInIGNsYXNzPSd1aS1qcWdyaWQgIiArIGEuamdyaWQuc3R5bGVVSVtyXS5iYXNlLmVudHJpZUJveCArICInIHN0eWxlPSdmb250LXNpemU6IiArIHEgKyAiO3Zpc2liaWxpdHk6aGlkZGVuOycgPjwvZGl2PiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGEoSikuY2xvbmUoKS5hcHBlbmRUbygiI3Rlc3RwZzIiKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiI3Rlc3RwZzIiKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMucC5fbnZ0ZCAmJiAoeS5kcm9wbWVudSA/IChKID0gbnVsbCwgYShDKS5qcUdyaWQoIl9idWlsZE5hdk1lbnUiLCBOLCBMLCBjLCBkLCBnLCBsLCBlLCBuKSkgOiBxID4gQy5wLl9udnRkWzBdID8gKEMucC5yZXNwb25zaXZlID8gKEogPSBudWxsLCBhKEMpLmpxR3JpZCgiX2J1aWxkTmF2TWVudSIsIE4sIEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYywgZCwgZywgbCwgZSwgbikpIDogYShOICsgIl8iICsgeS5wb3NpdGlvbiwgTikuYXBwZW5kKEopLndpZHRoKHEpLCBDLnAuX252dGRbMF0gPSBxKSA6IGEoTiArICJfIiArIHkucG9zaXRpb24sIE4pLmFwcGVuZChKKSwgQy5wLl9udnRkWzFdID0gcSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDLnAubmF2R3JpZCA9ICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQy5wLnN0b3JlTmF2T3B0aW9ucyAmJiAoQy5wLm5hdk9wdGlvbnMgPSB5LCBDLnAuZWRpdE9wdGlvbnMgPSBkLCBDLnAuYWRkT3B0aW9ucyA9IGcsIEMucC5kZWxPcHRpb25zID0gbCwgQy5wLnNlYXJjaE9wdGlvbnMgPSBlLCBDLnAudmlld09wdGlvbnMgPSBuLCBDLnAubmF2QnV0dG9ucyA9IFtdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG5hdkJ1dHRvbkFkZDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXNbMF0ucC5zdHlsZVVJOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiAibmV3QnV0dG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uaWNvbjogYS5qZ3JpZC5zdHlsZVVJW2RdLm5hdmlnYXRvci5pY29uX25ld2J1dHRvbl9uYXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGlja0J1dHRvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImxhc3QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjogInBvaW50ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgMCAhPT0gYi5pbmRleE9mKCIjIikgJiYgKGIgPSAiIyIgKyBhLmpncmlkLmpxSUQoYikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gYSgiLm5hdnRhYmxlIiwgYilbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5zdHlsZVVJW2RdLmNvbW1vbi5kaXNhYmxlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGEuamdyaWQuc3R5bGVVSVtkXS5jb21tb24uaG92ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmpncmlkLnN0eWxlVUlbZF0uY29tbW9uLmNvcm5lcmFsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGEuamdyaWQuc3R5bGVVSVtkXS5jb21tb24uaWNvbl9iYXNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsLnAuc3RvcmVOYXZPcHRpb25zICYmICFjLmludGVybmFsICYmIGwucC5uYXZCdXR0b25zLnB1c2goW2IsIGNdKSwgZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWMuaWQgfHwgdm9pZCAwID09PSBhKCIjIiArIGEuamdyaWQuanFJRChjLmlkKSwgZylbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gYSgiPHRkPjwvdGQ+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHEpLmFkZENsYXNzKCJ1aS1wZy1idXR0b24gIiArIGspLmFwcGVuZCgiTk9ORSIgPT09IGMuYnV0dG9uaWNvbi50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSd1aS1wZy1kaXYnPiIgKyBjLmNhcHRpb24gKyAiPC9kaXY+IiA6ICI8ZGl2IGNsYXNzPSd1aS1wZy1kaXYnPjxzcGFuIGNsYXNzPSciICsgciArICIgIiArIGMuYnV0dG9uaWNvbiArICInPjwvc3Bhbj4iICsgYy5jYXB0aW9uICsgIjwvZGl2PiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5pZCAmJiBhKHEpLmF0dHIoImlkIiwgYy5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmlyc3QiID09PSBjLnBvc2l0aW9uID8gMCA9PT0gZy5yb3dzWzBdLmNlbGxzLmxlbmd0aCA/IGEoInRyIiwgZykuYXBwZW5kKHEpIDogYSgidHIgdGQ6ZXEoMCkiLCBnKS5iZWZvcmUocSkgOiBhKCJ0ciIsIGcpLmFwcGVuZChxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEocSwgZykuYXR0cigidGl0bGUiLCBjLnRpdGxlIHx8ICIiKS5jbGljayhmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuaGFzQ2xhc3MoZSkgfHwgYS5pc0Z1bmN0aW9uKGMub25DbGlja0J1dHRvbikgJiYgYy5vbkNsaWNrQnV0dG9uLmNhbGwobCwgYiksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmhhc0NsYXNzKGUpIHx8IGEodGhpcykuYWRkQ2xhc3MobikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MobikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIuZHJvcGRvd25tZW51IiwgYilbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSBhKGcpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGMuaWQgfHwgYS5qZ3JpZC5yYW5kSWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhKCc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSIgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iJyArIGsgKyAnIGctbWVudS1pdGVtIiB0YWJpbmRleD0iMCIgcm9sZT0ibWVudWl0ZW0iIGlkPSInICsgZyArICciPicgKyAoYy5jYXB0aW9uIHx8IGMudGl0bGUpICsgIjwvYT48L2xpPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ICYmICgiZmlyc3QiID09PSBjLnBvc2l0aW9uID8gYSgiIyIgKyB1KS5wcmVwZW5kKGspIDogYSgiIyIgKyB1KS5hcHBlbmQoayksIGEoaykub24oImNsaWNrIiwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuaGFzQ2xhc3MoZSkgfHwgKGEoIiMiICsgdSkuaGlkZSgpLCBhLmlzRnVuY3Rpb24oYy5vbkNsaWNrQnV0dG9uKSAmJiBjLm9uQ2xpY2tCdXR0b24uY2FsbChsLCBiKSksICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmQoImEiKS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuaGFzQ2xhc3MoZSkgfHwgYSh0aGlzKS5hZGRDbGFzcyhuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MobikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbmF2U2VwYXJhdG9yQWRkOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5qZ3JpZC5zdHlsZVVJW3RoaXNbMF0ucC5zdHlsZVVJXS5jb21tb247CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VwY2xhc3M6ICJ1aS1zZXBhcmF0b3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VwY29udGVudDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImxhc3QiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGMgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgMCAhPT0gYi5pbmRleE9mKCIjIikgJiYgKGIgPSAiIyIgKyBhLmpncmlkLmpxSUQoYikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBsLCBlID0gYSgiLm5hdnRhYmxlIiwgYilbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLnN0b3JlTmF2T3B0aW9ucyAmJiB0aGlzLnAubmF2QnV0dG9ucy5wdXNoKFtiLCBjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA/IChnID0gIjx0ZCBjbGFzcz0ndWktcGctYnV0dG9uICIgKyBkLmRpc2FibGVkICsgIicgc3R5bGU9J3dpZHRoOjRweDsnPjxzcGFuIGNsYXNzPSciICsgYy5zZXBjbGFzcyArICInPjwvc3Bhbj4iICsgYy5zZXBjb250ZW50ICsgIjwvdGQ+IiwgImZpcnN0IiA9PT0gYy5wb3NpdGlvbiA/IDAgPT09IGUucm93c1swXS5jZWxscy5sZW5ndGggPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ciIsIGUpLmFwcGVuZChnKSA6IGEoInRyIHRkOmVxKDApIiwgZSkuYmVmb3JlKGcpIDogYSgidHIiLCBlKS5hcHBlbmQoZykpIDogKGUgPSBhKCIuZHJvcGRvd25tZW51IiwgYilbMF0sIGcgPSAiPGxpIGNsYXNzPSd1aS1tZW51LWl0ZW0gIiArIGQuZGlzYWJsZWQgKyAiJyBzdHlsZT0nd2lkdGg6MTAwJScgcm9sZT0ncHJlc2VudGF0aW9uJz48aHIgY2xhc3M9J3VpLXNlcGFyYXRvci1saSc+PC9saT4iLCBlICYmIChsID0gYShlKS52YWwoKSwgbCAmJiAoImZpcnN0IiA9PT0gYy5wb3NpdGlvbiA/IGEoIiMiICsgbCkucHJlcGVuZChnKSA6IGEoIiMiICsgbCkuYXBwZW5kKGcpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYnVpbGROYXZNZW51OiBmdW5jdGlvbihiLCBjLCBkLCBnLCBsLCBlLCBuLCBrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGEuamdyaWQuZ2V0UmVnaW9uYWwociwgIm5hdiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSByLnAuc3R5bGVVSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gKGEuamdyaWQuc3R5bGVVSVt1XS5uYXZpZ2F0b3IsIGEuamdyaWQuc3R5bGVVSVt1XS5maWx0ZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBhLmpncmlkLnN0eWxlVUlbdV0uY29tbW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSAiZm9ybV9tZW51XyIgKyBhLmpncmlkLnJhbmRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSAiPGJ1dHRvbiBjbGFzcz0nZHJvcGRvd25tZW51ICIgKyB5LmJ1dHRvbiArICInIHZhbHVlPSciICsgcCArICInPiIgKyAoZC5uYXZCdXR0b25UZXh0ID8gZC5uYXZCdXR0b25UZXh0IDogcS5zZWxlY3RjYXB0aW9uIHx8ICJBY3Rpb25zIikgKyAiPC9idXR0b24+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYiArICJfIiArIGQucG9zaXRpb24sIGIpLmFwcGVuZChxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBDID0gImFsZXJ0bW9kXyIgKyB0aGlzLnAuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGYsIHEgPSBhKCIudWktanFncmlkLXZpZXciKS5jc3MoImZvbnQtc2l6ZSIpIHx8ICIxMXB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEoJzx1bCBpZD0iJyArIHAgKyAnIiBjbGFzcz0idWktbmF2LW1lbnUgbW9kYWwtY29udGVudCIgcm9sZT0ibWVudSIgdGFiaW5kZXg9IjAiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Zm9udC1zaXplOicgKyBxICsgJyI+PC91bD4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmFkZCAmJiAobCA9IGwgfHwge30sIGIgPSBsLmlkIHx8ICJhZGRfIiArIGMsIGYgPSBhKCc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSIgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuY29ybmVyYWxsICsgJyBnLW1lbnUtaXRlbSIgdGFiaW5kZXg9IjAiIHJvbGU9Im1lbnVpdGVtIiBpZD0iJyArIGIgKyAnIj4nICsgKGQuYWRkdGV4dCB8fCBkLmFkZHRpdGxlKSArICI8L2E+PC9saT4iKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuaGFzQ2xhc3MoeS5kaXNhYmxlZCkgfHwgKGEuaXNGdW5jdGlvbihkLmFkZGZ1bmMpID8gZC5hZGRmdW5jLmNhbGwocikgOiBhKHIpLmpxR3JpZCgiZWRpdEdyaWRSb3ciLCAibmV3IiwgbCksIGEodSkuaGlkZSgpKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSh1KS5hcHBlbmQoZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZWRpdCAmJiAoZyA9IGcgfHwge30sIGIgPSBnLmlkIHx8ICJlZGl0XyIgKyBjLCBmID0gYSgnPGxpIGNsYXNzPSJ1aS1tZW51LWl0ZW0iIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9IicgKyB5LmNvcm5lcmFsbCArICcgZy1tZW51LWl0ZW0iIHRhYmluZGV4PSIwIiByb2xlPSJtZW51aXRlbSIgaWQ9IicgKyBiICsgJyI+JyArIChkLmVkaXR0ZXh0IHx8IGQuZWRpdHRpdGxlKSArICI8L2E+PC9saT4iKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhKHRoaXMpLmhhc0NsYXNzKHkuZGlzYWJsZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5wLnNlbHJvdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyBhLmlzRnVuY3Rpb24oZC5lZGl0ZnVuYykgPyBkLmVkaXRmdW5jLmNhbGwociwgYikgOiBhKHIpLmpxR3JpZCgiZWRpdEdyaWRSb3ciLCBiLCBnKSA6IChhLmpncmlkLnZpZXdNb2RhbCgiIyIgKyBDLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoci5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqcW06ICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYSgiI2pxZ19hbHJ0IikuZm9jdXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHUpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKHUpLmFwcGVuZChmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52aWV3ICYmIChrID0gayB8fCB7fSwgYiA9IGsuaWQgfHwgInZpZXdfIiArIGMsIGYgPSBhKCc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSIgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iJyArIHkuY29ybmVyYWxsICsgJyBnLW1lbnUtaXRlbSIgdGFiaW5kZXg9IjAiIHJvbGU9Im1lbnVpdGVtIiBpZD0iJyArIGIgKyAnIj4nICsgKGQudmlld3RleHQgfHwgZC52aWV3dGl0bGUpICsgIjwvYT48L2xpPiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEodGhpcykuaGFzQ2xhc3MoeS5kaXNhYmxlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gci5wLnNlbHJvdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyBhLmlzRnVuY3Rpb24oZC5lZGl0ZnVuYykgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmlld2Z1bmMuY2FsbChyLCBiKSA6IGEocikuanFHcmlkKCJ2aWV3R3JpZFJvdyIsIGIsIGspIDogKGEuamdyaWQudmlld01vZGFsKCIjIiArIEMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBhLmpncmlkLmpxSUQoci5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjanFnX2FscnQiKS5mb2N1cygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodSkuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEodSkuYXBwZW5kKGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmRlbCAmJiAoZSA9IGUgfHwge30sIGIgPSBlLmlkIHx8ICJkZWxfIiArIGMsIGYgPSBhKCc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSIgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iJyArIHkuY29ybmVyYWxsICsgJyBnLW1lbnUtaXRlbSIgdGFiaW5kZXg9IjAiIHJvbGU9Im1lbnVpdGVtIiBpZD0iJyArIGIgKyAnIj4nICsgKGQuZGVsdGV4dCB8fCBkLmRlbHRpdGxlKSArICI8L2E+PC9saT4iKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhKHRoaXMpLmhhc0NsYXNzKHkuZGlzYWJsZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIucC5tdWx0aXNlbGVjdCA/IChiID0gci5wLnNlbGFycnJvdywgMCA9PT0gYi5sZW5ndGggJiYgKGIgPSBudWxsKSkgOiBiID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByLnAuc2Vscm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA/IGEuaXNGdW5jdGlvbihkLmRlbGZ1bmMpID8gZC5kZWxmdW5jLmNhbGwociwgYikgOiBhKHIpLmpxR3JpZCgiZGVsR3JpZFJvdyIsIGIsIGUpIDogKGEuamdyaWQudmlld01vZGFsKCIjIiArIEMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGEuamdyaWQuanFJRChyLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjanFnX2FscnQiKS5mb2N1cygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodSkuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEodSkuYXBwZW5kKGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZC5hZGQgfHwgZC5lZGl0IHx8IGQuZGVsIHx8IGQudmlldykgJiYgYSh1KS5hcHBlbmQoIjxsaSBjbGFzcz0ndWktbWVudS1pdGVtICIgKyB5LmRpc2FibGVkICsgIicgc3R5bGU9J3dpZHRoOjEwMCUnIHJvbGU9J3ByZXNlbnRhdGlvbic+PGhyIGNsYXNzPSd1aS1zZXBhcmF0b3ItbGknPjwvbGk+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zZWFyY2ggJiYgKG4gPSBuIHx8IHt9LCBiID0gbi5pZCB8fCAic2VhcmNoXyIgKyBjLCBmID0gYSgnPGxpIGNsYXNzPSJ1aS1tZW51LWl0ZW0iIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9IicgKyB5LmNvcm5lcmFsbCArICcgZy1tZW51LWl0ZW0iIHRhYmluZGV4PSIwIiByb2xlPSJtZW51aXRlbSIgaWQ9IicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICsgJyI+JyArIChkLnNlYXJjaHRleHQgfHwgZC5zZWFyY2h0aXRsZSkgKyAiPC9hPjwvbGk+IikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKHRoaXMpLmhhc0NsYXNzKHkuZGlzYWJsZWQpIHx8IChhLmlzRnVuY3Rpb24oZC5zZWFyY2hmdW5jKSA/IGQuc2VhcmNoZnVuYy5jYWxsKHIsIG4pIDogYShyKS5qcUdyaWQoInNlYXJjaEdyaWQiLCBuKSwgYSh1KS5oaWRlKCkpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKHUpLmFwcGVuZChmKSwgbi5zaG93T25Mb2FkICYmICEwID09PSBuLnNob3dPbkxvYWQgJiYgYShmKS5jbGljaygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnJlZnJlc2ggJiYgKGIgPSBuLmlkIHx8ICJzZWFyY2hfIiArIGMsIGYgPSBhKCc8bGkgY2xhc3M9InVpLW1lbnUtaXRlbSIgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iJyArIHkuY29ybmVyYWxsICsgJyBnLW1lbnUtaXRlbSIgdGFiaW5kZXg9IjAiIHJvbGU9Im1lbnVpdGVtIiBpZD0iJyArIGIgKyAnIj4nICsgKGQucmVmcmVzaHRleHQgfHwgZC5yZWZyZXNodGl0bGUpICsgIjwvYT48L2xpPiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhKHRoaXMpLmhhc0NsYXNzKHkuZGlzYWJsZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGQuYmVmb3JlUmVmcmVzaCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5iZWZvcmVSZWZyZXNoLmNhbGwocik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5wLnNlYXJjaCA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIucC5yZXNldHNlYXJjaCA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiY3VycmVudGZpbHRlciIgIT09IGQucmVmcmVzaHN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHIucC5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIucC5wb3N0RGF0YS5maWx0ZXJzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiNmYm94XyIgKyBhLmpncmlkLmpxSUQoYikpLmpxRmlsdGVyKCJyZXNldEZpbHRlciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKHIuY2xlYXJUb29sYmFyKSAmJiByLmNsZWFyVG9vbGJhci5jYWxsKHIsICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoYykge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGQucmVmcmVzaHN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZpcnN0cGFnZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHIpLnRyaWdnZXIoInJlbG9hZEdyaWQiLCBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjdXJyZW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY3VycmVudGZpbHRlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHIpLnRyaWdnZXIoInJlbG9hZEdyaWQiLCBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6ICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGQuYWZ0ZXJSZWZyZXNoKSAmJiBkLmFmdGVyUmVmcmVzaC5jYWxsKHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodSkuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodSkuYXBwZW5kKGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHUpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJib2R5IikuYXBwZW5kKHUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgcCkuYWRkQ2xhc3MoInVpLW1lbnUgIiArIHoubWVudV93aWRnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgcCArICIgPiBsaSA+IGEiKS5ob3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hZGRDbGFzcyh5LmhvdmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnJlbW92ZUNsYXNzKHkuaG92ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIuZHJvcGRvd25tZW51IiwgYiArICJfIiArIGQucG9zaXRpb24pLm9uKCJjbGljayIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcykub2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBjLmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBwYXJzZUludChjLnRvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhKHRoaXMpLnZhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgZCkuc2hvdygpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYyAtIChhKCIjIiArIGQpLmhlaWdodCgpICsgMTApICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZiArICJweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoImJvZHkiKS5vbigiY2xpY2siLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiLnRhcmdldCkuaGFzQ2xhc3MoImRyb3Bkb3dubWVudSIpIHx8IGEoIiMiICsgcCkuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgR3JpZFRvRm9ybTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gYShnKS5qcUdyaWQoImdldFJvd0RhdGEiLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkIGluIGwpIGwuaGFzT3duUHJvcGVydHkoZCkgJiYgKGEoIltuYW1lPSIgKyBhLmpncmlkLmpxSUQoZCkgKyAiXSIsIGMpLmlzKCJpbnB1dDpyYWRpbyIpIHx8IGEoIltuYW1lPSIgKyBhLmpncmlkLmpxSUQoZCkgKyAiXSIsIGMpLmlzKCJpbnB1dDpjaGVja2JveCIpID8gYSgiW25hbWU9IiArIGEuamdyaWQuanFJRChkKSArICJdIiwgYykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykudmFsKCkgPT0gbFtkXSA/IGEodGhpcylbZy5wLnVzZVByb3AgPyAicHJvcCIgOiAiYXR0ciJdKCJjaGVja2VkIiwgITApIDogYSh0aGlzKVtnLnAudXNlUHJvcCA/ICJwcm9wIiA6ICJhdHRyIl0oImNoZWNrZWQiLCAhMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBhKCJbbmFtZT0iICsgYS5qZ3JpZC5qcUlEKGQpICsgIl0iLCBjKS52YWwobFtkXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBGb3JtVG9HcmlkOiBmdW5jdGlvbihiLCBjLCBkLAogICAgICAgICAgICAgICAgICAgICAgICBnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCB8fCAoZCA9ICJzZXQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnIHx8IChnID0gImZpcnN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBhKGMpLnNlcmlhbGl6ZUFycmF5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2gobCwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2IubmFtZV0gPSBiLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFkZCIgPT09IGQgPyBhKHRoaXMpLmpxR3JpZCgiYWRkUm93RGF0YSIsIGIsIGUsIGcpIDogInNldCIgPT09IGQgJiYgYSh0aGlzKS5qcUdyaWQoInNldFJvd0RhdGEiLCBiLCBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLCBhLmpncmlkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgZ3JvdXBpbmdTZXR1cDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYywgZCA9IHRoaXMucC5jb2xNb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5wLmdyb3VwaW5nVmlldzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhLmpncmlkLnN0eWxlVUlbdGhpcy5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uZ3JvdXBpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gZyB8fCAib2JqZWN0IiAhPSB0eXBlb2YgZyAmJiAhYS5pc0Z1bmN0aW9uKGcpKSB0aGlzLnAuZ3JvdXBpbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGcucGx1c2ljb24gfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZy5wbHVzaWNvbiA9IGIuaWNvbl9wbHVzKSwgZy5taW51c2ljb24gfHwgKGcubWludXNpY29uID0gYi5pY29uX21pbnVzKSwgZy5ncm91cEZpZWxkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZy52aXNpYmlsdHlPbk5leHRHcm91cGluZyAmJiAoZy52aXNpYmlsdHlPbk5leHRHcm91cGluZyA9IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmxhc3R2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLl9sb2NnciB8fCAoZy5ncm91cHMgPSBbXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5jb3VudGVycyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBnLmdyb3VwRmllbGQubGVuZ3RoOyBiKyspIGcuZ3JvdXBPcmRlcltiXSB8fCAoZy5ncm91cE9yZGVyW2JdID0gImFzYyIpLCBnLmdyb3VwVGV4dFtiXSB8fCAoZy5ncm91cFRleHRbYl0gPSAiezB9IiksICJib29sZWFuIiAhPSB0eXBlb2YgZy5ncm91cENvbHVtblNob3dbYl0gJiYgKGcuZ3JvdXBDb2x1bW5TaG93W2JdID0gITApLCAiYm9vbGVhbiIgIT0gdHlwZW9mIGcuZ3JvdXBTdW1tYXJ5W2JdICYmIChnLmdyb3VwU3VtbWFyeVtiXSA9ICExKSwgZy5ncm91cFN1bW1hcnlQb3NbYl0gfHwgKGcuZ3JvdXBTdW1tYXJ5UG9zW2JdID0gImZvb3RlciIpLCAhMCA9PT0gZy5ncm91cENvbHVtblNob3dbYl0gPyAoZy52aXNpYmlsdHlPbk5leHRHcm91cGluZ1tiXSA9ICEwLCBhKHRoaXMpLmpxR3JpZCgic2hvd0NvbCIsIGcuZ3JvdXBGaWVsZFtiXSkpIDogKGcudmlzaWJpbHR5T25OZXh0R3JvdXBpbmdbYl0gPSBhKCIjIiArIGEuamdyaWQuanFJRCh0aGlzLnAuaWQgKyAiXyIgKyBnLmdyb3VwRmllbGRbYl0pKS5pcygiOnZpc2libGUiKSwgYSh0aGlzKS5qcUdyaWQoImhpZGVDb2wiLCBnLmdyb3VwRmllbGRbYl0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnN1bW1hcnkgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmhpZGVGaXJzdEdyb3VwQ29sICYmIChnLmZvcm1hdERpc3BsYXlGaWVsZFswXSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSBkLmxlbmd0aDsgYyA+IGI7IGIrKykgZy5oaWRlRmlyc3RHcm91cENvbCAmJiAoZFtiXS5oaWRkZW4gfHwgZy5ncm91cEZpZWxkWzBdICE9PSBkW2JdLm5hbWUgfHwgKGRbYl0uZm9ybWF0dGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSwgZFtiXS5zdW1tYXJ5VHlwZSAmJiBnLnN1bW1hcnkucHVzaChkW2JdLnN1bW1hcnlEaXZpZGVyID8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBubTogZFtiXS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdDogZFtiXS5zdW1tYXJ5VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNkOiBkW2JdLnN1bW1hcnlEaXZpZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyOiBkW2JdLnN1bW1hcnlSb3VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3J0OiBkW2JdLnN1bW1hcnlSb3VuZFR5cGUgfHwgInJvdW5kIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5tOiBkW2JdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0OiBkW2JdLnN1bW1hcnlUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3I6IGRbYl0uc3VtbWFyeVJvdW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcnQ6IGRbYl0uc3VtbWFyeVJvdW5kVHlwZSB8fCAicm91bmQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLnAuZ3JvdXBpbmcgPSAhMQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBpbmdQcmVwYXJlOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgbCwgZSwgbiA9IHRoaXMucC5ncm91cGluZ1ZpZXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24odGhpcy5zdCkgPyB0aGlzLnYgPSB0aGlzLnN0LmNhbGwoaywgdGhpcy52LCB0aGlzLm5tLCBiKSA6ICh0aGlzLnYgPSBhKGspLmpxR3JpZCgiZ3JvdXBpbmdDYWxjdWxhdGlvbnMuaGFuZGxlciIsIHRoaXMuc3QsIHRoaXMudiwgdGhpcy5ubSwgdGhpcy5zciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3J0LCBiKSwgImF2ZyIgPT09IHRoaXMuc3QudG9Mb3dlckNhc2UoKSAmJiB0aGlzLnNkICYmICh0aGlzLnZkID0gYShrKS5qcUdyaWQoImdyb3VwaW5nQ2FsY3VsYXRpb25zLmhhbmRsZXIiLCB0aGlzLnN0LCB0aGlzLnZkLCB0aGlzLnNkLCB0aGlzLnNyLCB0aGlzLnNydCwgYikpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IG4uZ3JvdXBGaWVsZC5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSAwOyBxID4gZDsgZCsrKSBnID0gbi5ncm91cEZpZWxkW2RdLCBlID0gbi5kaXNwbGF5RmllbGRbZF0sIGwgPSBiW2ddLCBlID0gbnVsbCA9PSBlID8gbnVsbCA6IGJbZV0sIG51bGwgPT0gZSAmJiAoZSA9IGwpLCB2b2lkIDAgIT09IGwgJiYgKDAgPT09IGMgPyAobi5ncm91cHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeDogZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUluZGV4OiBnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFJvdzogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY250OiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5OiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBuLmxhc3R2YWx1ZXNbZF0gPSBsLCBuLmNvdW50ZXJzW2RdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbnQ6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczogbi5ncm91cHMubGVuZ3RoIC0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtbWFyeTogYS5leHRlbmQoITAsIFtdLCBuLnN1bW1hcnkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYS5lYWNoKG4uY291bnRlcnNbZF0uc3VtbWFyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciksIG4uZ3JvdXBzW24uY291bnRlcnNbZF0ucG9zXS5zdW1tYXJ5ID0gbi5jb3VudGVyc1tkXS5zdW1tYXJ5KSA6ICJvYmplY3QiID09IHR5cGVvZiBsIHx8IChhLmlzQXJyYXkobi5pc0luVGhlU2FtZUdyb3VwKSAmJiBhLmlzRnVuY3Rpb24obi5pc0luVGhlU2FtZUdyb3VwW2RdKSA/IG4uaXNJblRoZVNhbWVHcm91cFtkXS5jYWxsKGssIG4ubGFzdHZhbHVlc1tkXSwgbCwgZCwgbikgOiBuLmxhc3R2YWx1ZXNbZF0gPT09IGwpID8gMSA9PT0gdSA/IChuLmdyb3Vwcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4OiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhSW5kZXg6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Um93OiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbnQ6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1bW1hcnk6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIG4ubGFzdHZhbHVlc1tkXSA9IGwsIG4uY291bnRlcnNbZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNudDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zOiBuLmdyb3Vwcy5sZW5ndGggLSAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5OiBhLmV4dGVuZCghMCwgW10sIG4uc3VtbWFyeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmVhY2gobi5jb3VudGVyc1tkXS5zdW1tYXJ5LCByKSwgbi5ncm91cHNbbi5jb3VudGVyc1tkXS5wb3NdLnN1bW1hcnkgPSBuLmNvdW50ZXJzW2RdLnN1bW1hcnkpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobi5jb3VudGVyc1tkXS5jbnQgKz0gMSwgbi5ncm91cHNbbi5jb3VudGVyc1tkXS5wb3NdLmNudCA9IG4uY291bnRlcnNbZF0uY250LCBhLmVhY2gobi5jb3VudGVyc1tkXS5zdW1tYXJ5LCByKSwgbi5ncm91cHNbbi5jb3VudGVyc1tkXS5wb3NdLnN1bW1hcnkgPSBuLmNvdW50ZXJzW2RdLnN1bW1hcnkpIDogKG4uZ3JvdXBzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJbmRleDogZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSb3c6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNudDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtbWFyeTogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgbi5sYXN0dmFsdWVzW2RdID0gbCwgdSA9IDEsIG4uY291bnRlcnNbZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNudDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zOiBuLmdyb3Vwcy5sZW5ndGggLSAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5OiBhLmV4dGVuZCghMCwgW10sIG4uc3VtbWFyeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmVhY2gobi5jb3VudGVyc1tkXS5zdW1tYXJ5LCByKSwgbi5ncm91cHNbbi5jb3VudGVyc1tkXS5wb3NdLnN1bW1hcnkgPSBuLmNvdW50ZXJzW2RdLnN1bW1hcnkpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBpbmdUb2dnbGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZ3JvdXBpbmdWaWV3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiLnNwbGl0KCJfIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHBhcnNlSW50KGRbZC5sZW5ndGggLSAyXSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zcGxpY2UoZC5sZW5ndGggLSAyLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsLCBlLCBuID0gZC5qb2luKCJfIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMubWludXNpY29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBjLnBsdXNpY29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhKCIjIiArIGEuamdyaWQuanFJRChiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGsubGVuZ3RoID8ga1swXS5uZXh0U2libGluZyA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGEoIiMiICsgYS5qZ3JpZC5qcUlEKGIpICsgIiBzcGFuLnRyZWUtd3JhcC0iICsgdGhpcy5wLmRpcmVjdGlvbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEubWFwKGIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3Vic3RyaW5nKDAsIG4ubGVuZ3RoICsgMSkgPT09IG4gKyAiXyIgPyBwYXJzZUludChhLnN1YnN0cmluZyhuLmxlbmd0aCArIDEpLCAxMCkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgYi5sZW5ndGggPyBiWzBdIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0aGlzLnAuZnJvemVuQ29sdW1ucyA/IHRoaXMucC5pZCArICJfZnJvemVuIiA6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSAoZSA9IHkgPyBhKCIjIiArIGEuamdyaWQuanFJRChiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiMiICsgYS5qZ3JpZC5qcUlEKHkpKSA6ICExKSAmJiBlLmxlbmd0aCA/IGVbMF0ubmV4dFNpYmxpbmcgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIuaGFzQ2xhc3MoZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGsgJiYgKGwgPSBxKGsuY2xhc3NOYW1lKSwgISh2b2lkIDAgIT09IGwgJiYgZyA+PSBsKSk7KSBhKGspLmhpZGUoKSwgayA9IGsubmV4dFNpYmxpbmcsIHkgJiYgKGEocCkuaGlkZSgpLCBwID0gcC5uZXh0U2libGluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5yZW1vdmVDbGFzcyhkKS5hZGRDbGFzcyhjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IHZvaWQgMDsgazspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsID0gcShrLmNsYXNzTmFtZSksIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHZvaWQgMCA9PT0gbCksIHogPSBhKGspLmhhc0NsYXNzKCJ1aS1zdWJncmlkIikgJiYgYShrKS5oYXNDbGFzcygidWktc2ctY29sbGFwc2VkIiksIHZvaWQgMCAhPT0gbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID49IGwpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPT09IGcgKyAxICYmICh6IHx8IChhKGspLnNob3coKS5maW5kKCI+dGQ+c3Bhbi50cmVlLXdyYXAtIiArIHRoaXMucC5kaXJlY3Rpb24pLnJlbW92ZUNsYXNzKGQpLmFkZENsYXNzKGMpLCB5ICYmIGEocCkuc2hvdygpLmZpbmQoIj50ZD5zcGFuLnRyZWUtd3JhcC0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLmRpcmVjdGlvbikucmVtb3ZlQ2xhc3MoZCkuYWRkQ2xhc3MoYykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGUgJiYgKHogfHwgKGEoaykuc2hvdygpLCB5ICYmIGEocCkuc2hvdygpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gay5uZXh0U2libGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgJiYgKHAgPSBwLm5leHRTaWJsaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5yZW1vdmVDbGFzcyhjKS5hZGRDbGFzcyhkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS50cmlnZ2VySGFuZGxlcigianFHcmlkR3JvdXBpbmdDbGlja0dyb3VwIiwgW2IsIHVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbih0aGlzLnAub25DbGlja0dyb3VwKSAmJiB0aGlzLnAub25DbGlja0dyb3VwLmNhbGwodGhpcywgYiwgdSkKICAgICAgICAgICAgICAgICAgICAgICAgfSksICExCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBncm91cGluZ1JlbmRlcjogZnVuY3Rpb24oYiwgYywgZCwgZykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gbChhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYikgZCA9IGNbYV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gY1thXS5pZHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBmKSBkID0gY1thXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IDAgPD0gYTsgYS0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjW2FdLmlkeCA9PT0gZiAtIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGNbYV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGUoYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLCBmLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGcsIHcgPSBsKGIsIGQsIGYpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gcS5wLmNvbE1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gdy5jbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IGU7IGMgPiBnOyBnKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSAiPHRkICIgKyBxLmZvcm1hdENvbChnLCAxLCAiIikgKyAiPiYjMTYwOzwvdGQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAiezB9IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKHcuc3VtbWFyeSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ubSA9PT0gbltnXS5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbltnXS5zdW1tYXJ5VHBsICYmIChrID0gbltnXS5zdW1tYXJ5VHBsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgdGhpcy5zdCAmJiAiYXZnIiA9PT0gdGhpcy5zdC50b0xvd2VyQ2FzZSgpICYmICh0aGlzLnNkICYmIHRoaXMudmQgPyB0aGlzLnYgLz0gdGhpcy52ZCA6IHRoaXMudiAmJiAwIDwgciAmJiAodGhpcy52IC89IHIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyb3VwQ291bnQgPSB3LmNudCwgdGhpcy5ncm91cEluZGV4ID0gdy5kYXRhSW5kZXgsIHRoaXMuZ3JvdXBWYWx1ZSA9IHcudmFsdWUsIGggPSBxLmZvcm1hdHRlcigiIiwgdGhpcy52LCBnLCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMudgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdSA9ICI8dGQgIiArIHEuZm9ybWF0Q29sKGcsIDEsICIiKSArICI+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQudGVtcGxhdGUoaywgaCkgKyAiPC90ZD4iLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiArPSB1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiwgaywgciwgcSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHEucC5ncm91cGluZ1ZpZXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gdS5ncm91cENvbGxhcHNlID8gdS5wbHVzaWNvbiA6IHUubWludXNpY29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdS5ncm91cEZpZWxkLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gYS5qZ3JpZC5zdHlsZVVJW3EucC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmNvbW1vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gcCArICIgdHJlZS13cmFwLSIgKyBxLnAuZGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKHEucC5jb2xNb2RlbCwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IHYgPiBjOyBjKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lmdyb3VwRmllbGRbY10gPT09IGIubmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1tjXSA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4LCBIID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFID0gYS5tYWtlQXJyYXkodS5ncm91cFN1bW1hcnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRS5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gcS5wLm11bHRpc2VsZWN0ID8gJyBjb2xzcGFuPSIyIicgOiAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaCh1Lmdyb3VwcywgZnVuY3Rpb24obCwgTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Ll9sb2NnciAmJiAhKEwuc3RhcnRSb3cgKyBMLmNudCA+IChkIC0gMSkgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyAmJiBMLnN0YXJ0Um93IDwgZCAqIGcpKSByZXR1cm4gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBxLnAuaWQgKyAiZ2hlYWRfIiArIEwuaWR4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBrICsgIl8iICsgbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gIjxzcGFuIHN0eWxlPSdjdXJzb3I6cG9pbnRlcjttYXJnaW4tcmlnaHQ6OHB4O21hcmdpbi1sZWZ0OjVweDsnIGNsYXNzPSciICsgQS5pY29uX2Jhc2UgKyAiICIgKyBwICsgIicgb25jbGljaz1cImpRdWVyeSgnIyIgKyBhLmpncmlkLmpxSUQocS5wLmlkKSArICInKS5qcUdyaWQoJ2dyb3VwaW5nVG9nZ2xlJywnIiArIG4gKyAiJyk7cmV0dXJuIGZhbHNlO1wiPjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNBcnJheSh1LmZvcm1hdERpc3BsYXlGaWVsZCkgJiYgYS5pc0Z1bmN0aW9uKHUuZm9ybWF0RGlzcGxheUZpZWxkW0wuaWR4XSkgPyAoTC5kaXNwbGF5VmFsdWUgPSB1LmZvcm1hdERpc3BsYXlGaWVsZFtMLmlkeF0uY2FsbChxLCBMLmRpc3BsYXlWYWx1ZSwgTC52YWx1ZSwgcS5wLmNvbE1vZGVsW0NbTC5pZHhdXSwgTC5pZHgsIHUpLCByID0gTC5kaXNwbGF5VmFsdWUpIDogciA9IHEuZm9ybWF0dGVyKG4sIEwuZGlzcGxheVZhbHVlLCBDW0wuaWR4XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwudmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gTC5kaXNwbGF5VmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEogPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IGEuaXNGdW5jdGlvbih1Lmdyb3VwVGV4dFtMLmlkeF0pID8gdS5ncm91cFRleHRbTC5pZHhdLmNhbGwocSwgciwgTC5jbnQsIEwuc3VtbWFyeSkgOiBhLmpncmlkLnRlbXBsYXRlKHUuZ3JvdXBUZXh0W0wuaWR4XSwgciwgTC5jbnQsIEwuc3VtbWFyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIEogJiYgIm51bWJlciIgIT0gdHlwZW9mIEogJiYgKEogPSByKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaGVhZGVyIiA9PT0gdS5ncm91cFN1bW1hcnlQb3NbTC5pZHhdID8gKHogKz0gJzx0ciBpZD0iJyArIG4gKyAnIicgKyAodS5ncm91cENvbGxhcHNlICYmIDAgPCBMLmlkeCA/ICcgc3R5bGU9ImRpc3BsYXk6bm9uZTsiICcgOiAiICIpICsgJ3JvbGU9InJvdyIgY2xhc3M9ICInICsgQS5jb250ZW50ICsgIiBqcWdyb3VwIHVpLXJvdy0iICsgcS5wLmRpcmVjdGlvbiArICIgIiArIGsgKyAnIj48dGQgc3R5bGU9InBhZGRpbmctbGVmdDonICsgMTIgKiBMLmlkeCArICdweDsiJyArIHggKyAiPiIgKyB5ICsgSiArICI8L3RkPiIsIHogKz0gZShsLCAwLCB1Lmdyb3VwcywgITEgPT09IHUuZ3JvdXBDb2x1bW5TaG93W0wuaWR4XSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiID09PSB4ID8gMiA6IDMgOiAiIiA9PT0geCA/IDEgOiAyKSwgeiArPSAiPC90cj4iKSA6IHogKz0gJzx0ciBpZD0iJyArIG4gKyAnIicgKyAodS5ncm91cENvbGxhcHNlICYmIDAgPCBMLmlkeCA/ICcgc3R5bGU9ImRpc3BsYXk6bm9uZTsiICcgOiAiICIpICsgJ3JvbGU9InJvdyIgY2xhc3M9ICInICsgQS5jb250ZW50ICsgIiBqcWdyb3VwIHVpLXJvdy0iICsgcS5wLmRpcmVjdGlvbiArICIgIiArIGsgKyAnIj48dGQgc3R5bGU9InBhZGRpbmctbGVmdDonICsgMTIgKiBMLmlkeCArICdweDsiIGNvbHNwYW49IicgKyAoITEgPT09IHUuZ3JvdXBDb2x1bW5TaG93W0wuaWR4XSA/IGMgLSAxIDogYykgKyAnIj4nICsgeSArIEogKyAiPC90ZD48L3RyPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYgLSAxID09PSBMLmlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRywgSiA9IHUuZ3JvdXBzW2wgKyAxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFEgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gTC5zdGFydFJvdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEYgPSB2b2lkIDAgIT09IEogPyBKLnN0YXJ0Um93IDogdS5ncm91cHNbbF0uc3RhcnRSb3cgKyB1Lmdyb3Vwc1tsXS5jbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodS5fbG9jZ3IgJiYgKFEgPSAoZCAtIDEpICogZywgUSA+IEwuc3RhcnRSb3cgJiYgKEcgPSBRKSk7IEYgPiBHICYmIGJbRyAtIFFdOyBHKyspIHogKz0gYltHIC0gUV0uam9pbigiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiaGVhZGVyIiAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuZ3JvdXBTdW1tYXJ5UG9zW0wuaWR4XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBKKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChJID0gMDsgSSA8IHUuZ3JvdXBGaWVsZC5sZW5ndGggJiYgSi5kYXRhSW5kZXggIT09IHUuZ3JvdXBGaWVsZFtJXTsgSSsrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIID0gdS5ncm91cEZpZWxkLmxlbmd0aCAtIEkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoSiA9IDA7IEggPiBKOyBKKyspIEVbSl0gJiYgKFEgPSAiIiwgdS5ncm91cENvbGxhcHNlICYmICF1LnNob3dTdW1tYXJ5T25IaWRlICYmIChRID0gJyBzdHlsZT0iZGlzcGxheTpub25lOyInKSwgeiArPSAiPHRyIiArIFEgKyAnIGpxZm9vdGxldmVsPSInICsgKEwuaWR4IC0gSikgKyAnIiByb2xlPSJyb3ciIGNsYXNzPSInICsgQS5jb250ZW50ICsgIiBqcWZvb3QgdWktcm93LSIgKyBxLnAuZGlyZWN0aW9uICsgJyI+JywgeiArPSBlKGwsIEosIHUuZ3JvdXBzLCAwKSwgeiArPSAiPC90cj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSBJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKHEucC5pZCkgKyAiIHRib2R5OmZpcnN0IikuYXBwZW5kKHopOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGdyb3VwaW5nR3JvdXBCeTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBiICYmIChiID0gW2JdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5wLmdyb3VwaW5nVmlldzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5ncm91cGluZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5fbG9jZ3IgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZC52aXNpYmlsdHlPbk5leHRHcm91cGluZyAmJiAoZC52aXNpYmlsdHlPbk5leHRHcm91cGluZyA9IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGQuZ3JvdXBGaWVsZC5sZW5ndGg7IGcrKykgIWQuZ3JvdXBDb2x1bW5TaG93W2ddICYmIGQudmlzaWJpbHR5T25OZXh0R3JvdXBpbmdbZ10gJiYgYSh0aGlzKS5qcUdyaWQoInNob3dDb2wiLCBkLmdyb3VwRmllbGRbZ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGIubGVuZ3RoOyBnKyspIGQudmlzaWJpbHR5T25OZXh0R3JvdXBpbmdbZ10gPSBhKCIjIiArIGEuamdyaWQuanFJRCh0aGlzLnAuaWQpICsgIl8iICsgYS5qZ3JpZC5qcUlEKGJbZ10pKS5pcygiOnZpc2libGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5ncm91cGluZ1ZpZXcgPSBhLmV4dGVuZCh0aGlzLnAuZ3JvdXBpbmdWaWV3LCBjIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZ3JvdXBGaWVsZCA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnRyaWdnZXIoInJlbG9hZEdyaWQiKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBpbmdSZW1vdmU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIgJiYgKGIgPSAhMCksIHRoaXMucC5ncm91cGluZyA9ICExLCAhMCA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkID0gdGhpcy5wLmdyb3VwaW5nVmlldzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZC5ncm91cEZpZWxkLmxlbmd0aDsgYysrKSAhZC5ncm91cENvbHVtblNob3dbY10gJiYgZC52aXNpYmlsdHlPbk5leHRHcm91cGluZ1tjXSAmJiBhKHRoaXMpLmpxR3JpZCgic2hvd0NvbCIsIGQuZ3JvdXBGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidHIuanFncm91cCwgdHIuanFmb290IiwgIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMucC5pZCkgKyAiIHRib2R5OmZpcnN0IikucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgidHIuanFncm93OmhpZGRlbiIsICIjIiArIGEuamdyaWQuanFJRCh0aGlzLnAuaWQpICsgIiB0Ym9keTpmaXJzdCIpLnNob3coKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEodGhpcykudHJpZ2dlcigicmVsb2FkR3JpZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBncm91cGluZ0NhbGN1bGF0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihhLCBiLCBjLCBkLCBnLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW06IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChiIHx8IDApICsgcGFyc2VGbG9hdChlW2NdIHx8IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiIgPT09IGIgPyBwYXJzZUZsb2F0KGVbY10gfHwgMCkgOiBNYXRoLm1pbihwYXJzZUZsb2F0KGIpLCBwYXJzZUZsb2F0KGVbY10gfHwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiIgPT09IGIgPyBwYXJzZUZsb2F0KGVbY10gfHwgMCkgOiBNYXRoLm1heChwYXJzZUZsb2F0KGIpLCBwYXJzZUZsb2F0KGVbY10gfHwgMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIiA9PT0gYiAmJiAoYiA9IDApLCBlLmhhc093blByb3BlcnR5KGMpID8gYiArIDEgOiAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zdW0oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5bYV0pIHRocm93ICJqcUdyaWQgR3JvdXBpbmcgTm8gc3VjaCBtZXRob2Q6ICIgKyBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IG5bYV0oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gZCAmJiAoImZpeGVkIiA9PT0gZyA/IGEgPSBhLnRvRml4ZWQoZCkgOiAoZCA9IE1hdGgucG93KDEwLCBkKSwgYSA9IE1hdGgucm91bmQoYSAqIGQpIC8gZCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0R3JvdXBIZWFkZXJzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VDb2xTcGFuU3R5bGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZGVyczogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGcsIGwsIGUsIG4sIGssIHIsIHEsIHUsIHo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnAuY29sTW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSB5Lmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IHRoaXMuZ3JpZC5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gYSgidGFibGUudWktanFncmlkLWh0YWJsZSIsIHRoaXMuZ3JpZC5oRGl2KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IHYuY2hpbGRyZW4oInRoZWFkIikuY2hpbGRyZW4oInRyLnVpLWpxZ3JpZC1sYWJlbHM6bGFzdCIpLmFkZENsYXNzKCJqcWctc2Vjb25kLXJvdy1oZWFkZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdi5jaGlsZHJlbigidGhlYWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHYuZmluZCgiLmpxZy1maXJzdC1yb3ctaGVhZGVyIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSBhLmpncmlkLnN0eWxlVUlbdGhpcy5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uYmFzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZ3JvdXBIZWFkZXIgfHwgKHRoaXMucC5ncm91cEhlYWRlciA9IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZ3JvdXBIZWFkZXIucHVzaChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IHhbMF0gPyB4ID0gYSgiPHRyPiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogInJvdyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICJ0cnVlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKCJqcWctZmlyc3Qtcm93LWhlYWRlciIpLmNzcygiaGVpZ2h0IiwgImF1dG8iKSA6IHguZW1wdHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRSwgTiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBiLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgZCA+IGM7IGMrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiW2NdLnN0YXJ0Q29sdW1uTmFtZSA9PT0gYSkgcmV0dXJuIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5wcmVwZW5kKGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhKCI8dHI+IiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAicm93IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKCJ1aS1qcWdyaWQtbGFiZWxzIGpxZy10aGlyZC1yb3ctaGVhZGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgcCA+IGM7IGMrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBDW2NdLmVsLCBuID0gYShlKSwgZCA9IHlbY10sIGsgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiMHB4IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogQ1tjXS53aWR0aCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZC5oaWRkZW4gPyAibm9uZSIgOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYSgiPHRoPiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiZ3JpZGNlbGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jc3MoaykuYWRkQ2xhc3MoInVpLWZpcnN0LXRoLSIgKyB0aGlzLnAuZGlyZWN0aW9uKS5hcHBlbmRUbyh4KSwgZS5zdHlsZS53aWR0aCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIiwgciA9IE4oZC5uYW1lLCBiLmdyb3VwSGVhZGVycyksIDAgPD0gcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGIuZ3JvdXBIZWFkZXJzW3JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IHIubnVtYmVyT2ZDb2x1bW5zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHIudGl0bGVUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IHIuY2xhc3NOYW1lIHx8ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChyID0gdSA9IDA7IHEgPiByICYmIHAgPiBjICsgcjsgcisrKSB5W2MgKyByXS5oaWRkZW4gfHwgdSsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoIjx0aD4iKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiY29sdW1uaGVhZGVyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuYWRkQ2xhc3MoSC5oZWFkZXJCb3ggKyAiIHVpLXRoLWNvbHVtbi1oZWFkZXIgdWktdGgtIiArIHRoaXMucC5kaXJlY3Rpb24gKyAiICIgKyB6KS5odG1sKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IHUgJiYgbC5hdHRyKCJjb2xzcGFuIiwgU3RyaW5nKHUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC5oZWFkZXJ0aXRsZXMgJiYgbC5hdHRyKCJ0aXRsZSIsIGwudGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IHUgJiYgbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmJlZm9yZShsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuYXBwZW5kKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSAwID09PSBxID8gYi51c2VDb2xTcGFuU3R5bGUgPyBuLmF0dHIoInJvd3NwYW4iLCAiMiIpIDogKGEoIjx0aD4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiY29sdW1uaGVhZGVyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcyhILmhlYWRlckJveCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIHVpLXRoLWNvbHVtbi1oZWFkZXIgdWktdGgtIiArIHRoaXMucC5kaXJlY3Rpb24pLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBkLmhpZGRlbiA/ICJub25lIiA6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmluc2VydEJlZm9yZShuKSwgZy5hcHBlbmQoZSkpIDogKGcuYXBwZW5kKGUpLCBxLS0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhKHRoaXMpLmNoaWxkcmVuKCJ0aGVhZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucHJlcGVuZCh4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmluc2VydEFmdGVyKEEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuYXBwZW5kKGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIudXNlQ29sU3BhblN0eWxlICYmICh2LmZpbmQoInNwYW4udWktanFncmlkLXJlc2l6ZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKS5wYXJlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5pcygiOnZpc2libGUiKSAmJiAodGhpcy5zdHlsZS5jc3NUZXh0ID0gImhlaWdodDogIiArIGIuaGVpZ2h0KCkgKyAicHggIWltcG9ydGFudDsgY3Vyc29yOiBjb2wtcmVzaXplOyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIHYuZmluZCgiZGl2LnVpLWpxZ3JpZC1zb3J0YWJsZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmlzKCI6dmlzaWJsZSIpICYmIGMuaXMoIjpoYXMoc3Bhbi51aS1qcWdyaWQtcmVzaXplKSIpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNzcygidG9wIiwgKGMuaGVpZ2h0KCkgLSBiLm91dGVySGVpZ2h0KCkpIC8gMiAtIDQgKyAicHgiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFID0gZC5maW5kKCJ0ci5qcWctZmlyc3Qtcm93LWhlYWRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYmluZCgianFHcmlkUmVzaXplU3RvcC5zZXRHcm91cEhlYWRlcnMiLCBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUuZmluZCgidGgiKS5lcShjKS53aWR0aChiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveUdyb3VwSGVhZGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgPT09IGIgJiYgKGIgPSAhMCksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBsLCBlLCBuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuZ3JpZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gYSgidGFibGUudWktanFncmlkLWh0YWJsZSB0aGVhZCIsIGQuaERpdiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHRoaXMucC5jb2xNb2RlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS51bmJpbmQoIi5zZXRHcm91cEhlYWRlcnMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgiPHRyPiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogInJvdyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygidWktanFncmlkLWxhYmVscyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBkLmhlYWRlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gbC5sZW5ndGg7IGcgPiBkOyBkKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHJbZF0uaGlkZGVuID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub25lIiA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYShsW2RdLmVsKS53aWR0aChsW2RdLndpZHRoKS5jc3MoImRpc3BsYXkiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlQXR0cigicm93U3BhbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuYXR0cigicm93U3BhbiIsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5hcHBlbmQoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBlLmNoaWxkcmVuKCJzcGFuLnVpLWpxZ3JpZC1yZXNpemUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IG4ubGVuZ3RoICYmIChuWzBdLnN0eWxlLmhlaWdodCA9ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jaGlsZHJlbigiZGl2IilbMF0uc3R5bGUudG9wID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShrKS5jaGlsZHJlbigidHIudWktanFncmlkLWxhYmVscyIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoaykucHJlcGVuZChjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gYiAmJiBhKHRoaXMpLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cEhlYWRlcjogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksIGEuamdyaWQgPSBhLmpncmlkIHx8IHt9LCBhLmV4dGVuZChhLmpncmlkLCB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVN0YXRlOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZVN0b3JhZ2U6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VUeXBlOiAibG9jYWxTdG9yYWdlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZXRJdGVtOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXByZXNzaW9uOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvbk1vZHVsZTogIkxaU3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvbk1ldGhvZDogImNvbXByZXNzVG9VVEYxNiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGMgfHwge30pLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgbCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gYSgiIyIgKyBiKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IGEobikuZGF0YSgiaW5saW5lTmF2IiksIGcgJiYgbi5wLmlubGluZU5hdiAmJiBhKG4pLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2lOOiBnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBnID0gYShuKS5kYXRhKCJmaWx0ZXJUb29sYmFyIiksIGcgJiYgbi5wLmZpbHRlclRvb2xiYXIgJiYgYShuKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9mVDogZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgbCA9IGEobikuanFHcmlkKCJqcUdyaWRFeHBvcnQiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHB0eXBlOiAianNvbnN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290OiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYShuLmdyaWQuYkRpdikuZmluZCgiLnVpLWpxZ3JpZC1idGFibGUgdHI6Z3QoMCkiKS5lYWNoKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgKz0gYi5vdXRlckhUTUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEuaXNGdW5jdGlvbihjLmJlZm9yZVNldEl0ZW0pICYmIChkID0gYy5iZWZvcmVTZXRJdGVtLmNhbGwobiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwpLCBudWxsICE9IGQgJiYgKGwgPSBkKSksIGMuY29tcHJlc3Npb24gJiYgYy5jb21wcmVzc2lvbk1vZHVsZSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHdpbmRvd1tjLmNvbXByZXNzaW9uTW9kdWxlXVtjLmNvbXByZXNzaW9uTWV0aG9kXShsKSwgbnVsbCAhPSBkICYmIChsID0gZCwgZSA9IHdpbmRvd1tjLmNvbXByZXNzaW9uTW9kdWxlXVtjLmNvbXByZXNzaW9uTWV0aG9kXShlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChrKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLnVzZVN0b3JhZ2UgJiYgYS5qZ3JpZC5pc0xvY2FsU3RvcmFnZSgpKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dbYy5zdG9yYWdlVHlwZV0uc2V0SXRlbSgianFHcmlkIiArIG4ucC5pZCwgbCksIHdpbmRvd1tjLnN0b3JhZ2VUeXBlXS5zZXRJdGVtKCJqcUdyaWQiICsgbi5wLmlkICsgIl9kYXRhIiwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIyID09PSBrLmNvZGUgJiYgYWxlcnQoIkxvY2FsIHN0b3JhZ2UgbGltaXQgaXMgb3ZlciEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBsb2FkU3RhdGU6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlU3RvcmFnZTogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZVR5cGU6ICJsb2NhbFN0b3JhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyQWZ0ZXJMb2FkOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZXRHcmlkOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU2V0R3JpZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvbXByZXNzaW9uOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvbXByZXNzaW9uTW9kdWxlOiAiTFpTdHJpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY29tcHJlc3Npb25NZXRob2Q6ICJkZWNvbXByZXNzRnJvbVVURjE2IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCB8fCB7fSksIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBsLCBlLCBuLCBrLCByID0gYSgiIyIgKyBiKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnVzZVN0b3JhZ2UpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHdpbmRvd1tkLnN0b3JhZ2VUeXBlXS5nZXRJdGVtKCJqcUdyaWQiICsgci5pZCksIGUgPSB3aW5kb3dbZC5zdG9yYWdlVHlwZV0uZ2V0SXRlbSgianFHcmlkIiArIHIuaWQgKyAiX2RhdGEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAocSkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuZGVjb21wcmVzc2lvbiAmJiBkLmRlY29tcHJlc3Npb25Nb2R1bGUpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB3aW5kb3dbZC5kZWNvbXByZXNzaW9uTW9kdWxlXVtkLmRlY29tcHJlc3Npb25NZXRob2RdKGMpLCBudWxsICE9IGcgJiYgKGMgPSBnLCBlID0gd2luZG93W2QuZGVjb21wcmVzc2lvbk1vZHVsZV1bZC5kZWNvbXByZXNzaW9uTWV0aG9kXShlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0ganFHcmlkVXRpbHMucGFyc2UoYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgJiYgIm9iamVjdCIgPT09IGEudHlwZShnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByLmdyaWQgJiYgYS5qZ3JpZC5ncmlkVW5sb2FkKGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oZC5iZWZvcmVTZXRHcmlkKSAmJiAobCA9IGQuYmVmb3JlU2V0R3JpZChnKSwgbCAmJiAib2JqZWN0IiA9PT0gYS50eXBlKGwpICYmIChnID0gbCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjY291bnQ6IGcucmVjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzOiBnLnJlY29yZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0cGFnZTogZy5sYXN0cGFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNocmlua1RvRml0OiBnLnNocmlua1RvRml0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZy5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXR5cGU6IGcuZGF0YXR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZzogZy5ncm91cGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnNocmlua1RvRml0ID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuZGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmRhdGF0eXBlID0gImxvY2FsIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5ncm91cGluZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmlubGluZU5hdiAmJiAobiA9IGcuX2lOLCBnLl9pTiA9IG51bGwsIGRlbGV0ZSBnLl9pTik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuZmlsdGVyVG9vbGJhciAmJiAoayA9IGcuX2ZULCBnLl9mVCA9IG51bGwsIGRlbGV0ZSBnLl9mVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhKCIjIiArIGIpLmpxR3JpZChnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIuYXBwZW5kKGUpLCBiLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnN0b3JlTmF2T3B0aW9ucyAmJiBnLm5hdkdyaWQgJiYgKGJbMF0ucC5uYXZHcmlkID0gITEsIGIuanFHcmlkKCJuYXZHcmlkIiwgZy5wYWdlciwgZy5uYXZPcHRpb25zLCBnLmVkaXRPcHRpb25zLCBnLmFkZE9wdGlvbnMsIGcuZGVsT3B0aW9ucywgZy5zZWFyY2hPcHRpb25zLCBnLnZpZXdPcHRpb25zKSwgZy5uYXZCdXR0b25zICYmIGcubmF2QnV0dG9ucy5sZW5ndGgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGcubmF2QnV0dG9ucy5sZW5ndGg7IGUrKykgInNlcGNsYXNzIiBpbiBnLm5hdkJ1dHRvbnNbZV1bMV0gPyBiLmpxR3JpZCgibmF2U2VwYXJhdG9yQWRkIiwgZy5uYXZCdXR0b25zW2VdWzBdLCBnLm5hdkJ1dHRvbnNbZV1bMV0pIDogYi5qcUdyaWQoIm5hdkJ1dHRvbkFkZCIsIGcubmF2QnV0dG9uc1tlXVswXSwgZy5uYXZCdXR0b25zW2VdWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5pbmxpbmVOYXYgJiYgbiAmJiAoYi5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZU5hdjogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGIuanFHcmlkKCJpbmxpbmVOYXYiLCBnLnBhZ2VyLCBuKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuZmlsdGVyVG9vbGJhciAmJiBrICYmIChiLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVG9vbGJhcjogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGsucmVzdG9yZUZyb21GaWx0ZXJzID0gITAsIGIuanFHcmlkKCJmaWx0ZXJUb29sYmFyIiwgaykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmZyb3plbkNvbHVtbnMgJiYgYi5qcUdyaWQoInNldEZyb3plbkNvbHVtbnMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYlswXS51cGRhdGVwYWdlcighMCwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oZC5hZnRlclNldEdyaWQpICYmIGQuYWZ0ZXJTZXRHcmlkKGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmNsZWFyQWZ0ZXJMb2FkICYmICh3aW5kb3dbZC5zdG9yYWdlVHlwZV0ucmVtb3ZlSXRlbSgianFHcmlkIiArIHIuaWQpLCB3aW5kb3dbZC5zdG9yYWdlVHlwZV0ucmVtb3ZlSXRlbSgianFHcmlkIiArIHIuaWQgKyAiX2RhdGEiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYWxlcnQoImNhbiBub3QgY29udmVydCB0byBvYmplY3QiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBpc0dyaWRJblN0b3JhZ2U6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZVR5cGU6ICJsb2NhbFN0b3JhZ2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEuZXh0ZW5kKGQsIGMgfHwge30pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZywgbCwgZTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB3aW5kb3dbZC5zdG9yYWdlVHlwZV0uZ2V0SXRlbSgianFHcmlkIiArIGIpLCBlID0gd2luZG93W2Quc3RvcmFnZVR5cGVdLmdldEl0ZW0oImpxR3JpZCIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgKyAiX2RhdGEiKSwgZyA9IG51bGwgIT0gbCAmJiBudWxsICE9IGUgJiYgInN0cmluZyIgPT0gdHlwZW9mIGwgJiYgInN0cmluZyIgPT0gdHlwZW9mIGUKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICExCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldFJlZ2lvbmFsOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZVR5cGU6ICJzZXNzaW9uU3RvcmFnZSIKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBhLmV4dGVuZChkLCBjIHx8IHt9KSwgZC5yZWdpb25hbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5zYXZlU3RhdGUoYiwgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmJlZm9yZVNldEdyaWQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEucmVnaW9uYWwgPSBkLnJlZ2lvbmFsLCBhLmZvcmNlX3JlZ2lvbmFsID0gITAsIGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmpncmlkLmxvYWRTdGF0ZShiLCBudWxsLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gYSgiIyIgKyBiKVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYShnKS5qcUdyaWQoImdldEdyaWRQYXJhbSIsICJjb2xNb2RlbCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gYS5qZ3JpZC5nZXRSZWdpb25hbChnLCAibmF2Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2gobCwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdHRlciAmJiAiYWN0aW9ucyIgPT09IHRoaXMuZm9ybWF0dGVyID8gKGUgPSBhLCAhMSkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAtIDEgIT09IGUgJiYgbiAmJiBhKCIjIiArIGIgKyAiIHRib2R5IHRyIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuY2VsbHNbZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5maW5kKCIudWktaW5saW5lLWVkaXQiKS5hdHRyKCJ0aXRsZSIsIG4uZWRpdHRpdGxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGIpLmZpbmQoIi51aS1pbmxpbmUtZGVsIikuYXR0cigidGl0bGUiLCBuLmRlbHRpdGxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGIpLmZpbmQoIi51aS1pbmxpbmUtc2F2ZSIpLmF0dHIoInRpdGxlIiwgbi5zYXZldGl0bGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYikuZmluZCgiLnVpLWlubGluZS1jYW5jZWwiKS5hdHRyKCJ0aXRsZSIsIG4uY2FuY2VsdGl0bGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93W2Quc3RvcmFnZVR5cGVdLnJlbW92ZUl0ZW0oImpxR3JpZCIgKyBnLmlkKSwgd2luZG93W2Quc3RvcmFnZVR5cGVdLnJlbW92ZUl0ZW0oImpxR3JpZCIgKyBnLmlkICsgIl9kYXRhIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGspIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGpxR3JpZEltcG9ydDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wdHlwZTogInhtbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBzdHJpbmc6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wdXJsOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG10eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcERhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1sR3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogInJvb3Q+Z3JpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogInJvb3Q+cm93cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uR3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogImdyaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICJkYXRhIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXhPcHRpb25zOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAoMCA9PT0gYi5pbmRleE9mKCIjIikgPyAiIiA6ICIjIikgKyBhLmpncmlkLmpxSUQoYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBlLCBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBhKGMueG1sR3JpZC5jb25maWcsIGIpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gYShjLnhtbEdyaWQuZGF0YSwgYilbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpxR3JpZFV0aWxzLnhtbFRvSlNPTikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0ganFHcmlkVXRpbHMueG1sVG9KU09OKGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgaW4gZikgZi5oYXNPd25Qcm9wZXJ0eShnKSAmJiAoZSA9IGZbZ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID8gKGcgPSBmLmdyaWQuZGF0YXR5cGUsIGYuZ3JpZC5kYXRhdHlwZSA9ICJ4bWxzdHJpbmciLCBmLmdyaWQuZGF0YXN0ciA9IGIsIGEoZCkuanFHcmlkKGUpLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXR5cGU6IGcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpIDogc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkuanFHcmlkKGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGFsZXJ0KCJ4bWwyanNvbiBvciBwYXJzZSBhcmUgbm90IHByZXNlbnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgJiYgInN0cmluZyIgPT0gdHlwZW9mIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBqcUdyaWRVdGlscy5wYXJzZShiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBmW2MuanNvbkdyaWQuY29uZmlnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgPSBmW2MuanNvbkdyaWQuZGF0YV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gZS5kYXRhdHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZGF0YXR5cGUgPSAianNvbnN0cmluZyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmRhdGFzdHIgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5qcUdyaWQoZSkuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXR5cGU6IGcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBhKGQpLmpxR3JpZChlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYy5pbXB0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ4bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYWpheChhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGMuaW1wdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogYy5tdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGMuaW1wRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAieG1sIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihiLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiID09PSBmICYmIChnKGIucmVzcG9uc2VYTUwsIGMpLCBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRJbXBvcnRDb21wbGV0ZSIsIFtiLCBjXSksIGEuaXNGdW5jdGlvbihjLmltcG9ydENvbXBsZXRlKSAmJiBjLmltcG9ydENvbXBsZXRlKGIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmFqYXhPcHRpb25zKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ4bWxzdHJpbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmltcHN0cmluZyAmJiAic3RyaW5nIiA9PSB0eXBlb2YgYy5pbXBzdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhLnBhcnNlWE1MKGMuaW1wc3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSAmJiAoZyhlLCBjKSwgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkSW1wb3J0Q29tcGxldGUiLCBbZSwgY10pLCBhLmlzRnVuY3Rpb24oYy5pbXBvcnRDb21wbGV0ZSkgJiYgYy5pbXBvcnRDb21wbGV0ZShlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJqc29uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmFqYXgoYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGMuaW1wdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBjLm10eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLmltcERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwoYi5yZXNwb25zZVRleHQsIGMpLCBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRJbXBvcnRDb21wbGV0ZSIsIFtiLCBjXSksIGEuaXNGdW5jdGlvbihjLmltcG9ydENvbXBsZXRlKSAmJiBjLmltcG9ydENvbXBsZXRlKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYy5hamF4T3B0aW9ucykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAianNvbnN0cmluZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5pbXBzdHJpbmcgJiYgInN0cmluZyIgPT0gdHlwZW9mIGMuaW1wc3RyaW5nICYmIChsKGMuaW1wc3RyaW5nLCBjKSwgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkSW1wb3J0Q29tcGxldGUiLCBbYy5pbXBzdHJpbmcsIGNdKSwgYS5pc0Z1bmN0aW9uKGMuaW1wb3J0Q29tcGxldGUpICYmIGMuaW1wb3J0Q29tcGxldGUoYy5pbXBzdHJpbmcpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksIGEuamdyaWQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICBqcUdyaWRFeHBvcnQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHR5cGU6ICJ4bWxzdHJpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdDogImdyaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQ6ICJcdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRPcHRpb25zOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9LCBiIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gYS5leHRlbmQoITAsIHt9LCBhKHRoaXMpLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiksIGIuYWRkT3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcucm93bnVtYmVycyAmJiAoZy5jb2xOYW1lcy5zcGxpY2UoMCwgMSksIGcuY29sTW9kZWwuc3BsaWNlKDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxKSksIGcubXVsdGlzZWxlY3QgJiYgKGcuY29sTmFtZXMuc3BsaWNlKDAsIDEpLCBnLmNvbE1vZGVsLnNwbGljZSgwLCAxKSksIGcuc3ViR3JpZCAmJiAoZy5jb2xOYW1lcy5zcGxpY2UoMCwgMSksIGcuY29sTW9kZWwuc3BsaWNlKDAsIDEpKSwgZy5rbnYgPSBudWxsLCBnLnRyZWVHcmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgaW4gZy50cmVlUmVhZGVyKSBnLnRyZWVSZWFkZXIuaGFzT3duUHJvcGVydHkoZCkgJiYgKGcuY29sTmFtZXMuc3BsaWNlKGcuY29sTmFtZXMubGVuZ3RoIC0gMSksIGcuY29sTW9kZWwuc3BsaWNlKGcuY29sTW9kZWwubGVuZ3RoIC0gMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYi5leHB0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInhtbHN0cmluZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gIjwiICsgYi5yb290ICsgIj4iICsganFHcmlkVXRpbHMuanNvblRvWE1MKGcsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWxEZWNsOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgKyAiPC8iICsgYi5yb290ICsgIj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImpzb25zdHJpbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGpxR3JpZFV0aWxzLnN0cmluZ2lmeShnKSwgYi5yb290ICYmIChjID0gInsiICsgYi5yb290ICsgIjoiICsgYyArICJ9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBleGNlbEV4cG9ydDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwdHlwZTogInJlbW90ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJvcGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWc6ICJleGNlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0T3B0aW9uczoge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlbW90ZSIgPT09IGIuZXhwdHlwZSAmJiAoYyA9IGEuZXh0ZW5kKHt9LCB0aGlzLnAucG9zdERhdGEpLCBjW2Iub3Blcl0gPSBiLnRhZywgYyA9IGpRdWVyeS5wYXJhbShjKSwgYyA9IC0xICE9PSBiLnVybC5pbmRleE9mKCI/IikgPyBiLnVybCArICImIiArIGMgOiBiLnVybCArICI/IiArIGMsIHdpbmRvdy5sb2NhdGlvbiA9IGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwgYS5qZ3JpZC5pbmxpbmVFZGl0ID0gYS5qZ3JpZC5pbmxpbmVFZGl0IHx8IHt9LCBhLmpncmlkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgZWRpdFJvdzogZnVuY3Rpb24oYiwgYywgZCwgZywgbCwgZSwgbiwgaywgcikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IGEubWFrZUFycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAib2JqZWN0IiA9PT0gYS50eXBlKHVbMF0pID8gcSA9IHVbMF0gOiAodm9pZCAwICE9PSBjICYmIChxLmtleXMgPSBjKSwgYS5pc0Z1bmN0aW9uKGQpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocS5vbmVkaXRmdW5jID0gZCksIGEuaXNGdW5jdGlvbihnKSAmJiAocS5zdWNjZXNzZnVuYyA9IGcpLCB2b2lkIDAgIT09IGwgJiYgKHEudXJsID0gbCksIHZvaWQgMCAhPT0gZSAmJiAocS5leHRyYXBhcmFtID0gZSksIGEuaXNGdW5jdGlvbihuKSAmJiAocS5hZnRlcnNhdmVmdW5jID0gbiksIGEuaXNGdW5jdGlvbihrKSAmJiAocS5lcnJvcmZ1bmMgPSBrKSwgYS5pc0Z1bmN0aW9uKHIpICYmIChxLmFmdGVycmVzdG9yZWZ1bmMgPSByKSksIHEgPSBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5czogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlldmVudDogImtleWRvd24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0ZnVuYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdW5jOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFwYXJhbToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlcnNhdmVmdW5jOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JmdW5jOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJyZXN0b3JlZnVuYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmVBZnRlckVycm9yOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG10eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2N1c0ZpZWxkOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmpncmlkLmlubGluZUVkaXQsIHEpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZSwgaCwgZywgbSwgbCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuanFHcmlkKCJnZXRTdHlsZVVJIiwgbC5wLnN0eWxlVUkgKyAiLmlubGluZWRpdCIsICJpbnB1dENsYXNzIiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbC5ncmlkICYmIChoID0gYShsKS5qcUdyaWQoImdldEluZCIsIGIsICEwKSwgITEgIT09IGggJiYgKG0gPSBhLmlzRnVuY3Rpb24ocS5iZWZvcmVFZGl0Um93KSA/IHEuYmVmb3JlRWRpdFJvdy5jYWxsKGwsIHEsIGIpIDogdm9pZCAwLCB2b2lkIDAgPT09IG0gJiYgKG0gPSAhMCksIG0gJiYgKGUgPSBhKGgpLmF0dHIoImVkaXRhYmxlIikgfHwgIjAiLCAiMCIgIT09IGUgfHwgYShoKS5oYXNDbGFzcygibm90LWVkaXRhYmxlLXJvdyIpIHx8IChnID0gbC5wLmNvbE1vZGVsLCBhKCd0ZFtyb2xlPSJncmlkY2VsbCJdJywgaCkuZWFjaChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGdbZV0ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9ICEwID09PSBsLnAudHJlZUdyaWQgJiYgYyA9PT0gbC5wLkV4cGFuZENvbHVtbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCkgZCA9IGEoInNwYW46Zmlyc3QiLCB0aGlzKS5odG1sKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS51bmZvcm1hdC5jYWxsKGwsIHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTW9kZWw6IGdbZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1tlXS5lZGl0dHlwZSAmJiAidGV4dGFyZWEiID09PSBnW2VdLmVkaXR0eXBlID8gYSh0aGlzKS50ZXh0KCkgOiBhKHRoaXMpLmh0bWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImNiIiAhPT0gYyAmJiAic3ViZ3JpZCIgIT09IGMgJiYgInJuIiAhPT0gYyAmJiAobC5wLmF1dG9lbmNvZGUgJiYgKGQgPSBhLmpncmlkLmh0bWxEZWNvZGUoZCkpLCBrW2NdID0gZCwgITAgPT09IGdbZV0uZWRpdGFibGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT09IG4gJiYgKG4gPSBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA/IGEoInNwYW46Zmlyc3QiLCB0aGlzKS5odG1sKCIiKSA6IGEodGhpcykuaHRtbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gYS5leHRlbmQoe30sIGdbZV0uZWRpdG9wdGlvbnMgfHwge30sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBiICsgIl8iICsgYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJlZGl0IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1tlXS5lZGl0dHlwZSB8fCAoZ1tlXS5lZGl0dHlwZSA9ICJ0ZXh0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgiJm5ic3A7IiA9PT0gZCB8fCAiJiMxNjA7IiA9PT0gZCB8fCAxID09PSBkLmxlbmd0aCAmJiAxNjAgPT09IGQuY2hhckNvZGVBdCgwKSkgJiYgKGQgPSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gYS5qZ3JpZC5jcmVhdGVFbC5jYWxsKGwsIGdbZV0uZWRpdHR5cGUsIHEsIGQsICEwLCBhLmV4dGVuZCh7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuYWpheE9wdGlvbnMsIGwucC5hamF4U2VsZWN0T3B0aW9ucyB8fCB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHUpLmFkZENsYXNzKCJlZGl0YWJsZSBpbmxpbmUtZWRpdC1jZWxsIik7IC0gMSA8IGEuaW5BcnJheShnW2VdLmVkaXR0eXBlLCBbInRleHQiLCAidGV4dGFyZWEiLCAicGFzc3dvcmQiLCAic2VsZWN0Il0pICYmIGEodSkuYWRkQ2xhc3Mocik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPyBhKCJzcGFuOmZpcnN0IiwgdGhpcykuYXBwZW5kKHUpIDogYSh0aGlzKS5hcHBlbmQodSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuYmluZEV2LmNhbGwobCwgdSwgcSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3QiID09PSBnW2VdLmVkaXR0eXBlICYmIHZvaWQgMCAhPT0gZ1tlXS5lZGl0b3B0aW9ucyAmJiAhMCA9PT0gZ1tlXS5lZGl0b3B0aW9ucy5tdWx0aXBsZSAmJiB2b2lkIDAgPT09IGdbZV0uZWRpdG9wdGlvbnMuZGF0YVVybCAmJiBhLmpncmlkLm1zaWUgJiYgYSh1KS53aWR0aChhKHUpLndpZHRoKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3KysKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgMCA8IHcgJiYgKGsuaWQgPSBiLCBsLnAuc2F2ZWRSb3cucHVzaChrKSwgYShoKS5hdHRyKCJlZGl0YWJsZSIsICIxIiksIHEuZm9jdXNGaWVsZCAmJiAoIm51bWJlciIgPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHEuZm9jdXNGaWVsZCAmJiBwYXJzZUludChxLmZvY3VzRmllbGQsIDEwKSA8PSBnLmxlbmd0aCAmJiAobiA9IHEuZm9jdXNGaWVsZCksIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEoInRkOmVxKCIgKyBuICsgIikgOmlucHV0OnZpc2libGUiLCBoKS5ub3QoIjpkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IGIubGVuZ3RoICYmIGIuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAwKSksICEwID09PSBxLmtleXMgJiYgYShoKS5iaW5kKHEua2V5ZXZlbnQsIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDI3ID09PSBjLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKGwpLmpxR3JpZCgicmVzdG9yZVJvdyIsIGIsIHEuYWZ0ZXJyZXN0b3JlZnVuYyksIGwucC5pbmxpbmVOYXYpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShsKS5qcUdyaWQoInNob3dBZGRFZGl0QnV0dG9ucyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChkKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEzID09PSBjLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiVEVYVEFSRUEiID09PSBjLnRhcmdldC50YWdOYW1lKSByZXR1cm4gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShsKS5qcUdyaWQoInNhdmVSb3ciLCBiLCBxKSAmJiBsLnAuaW5saW5lTmF2KSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEobCkuanFHcmlkKCJzaG93QWRkRWRpdEJ1dHRvbnMiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZCkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShsKS50cmlnZ2VySGFuZGxlcigianFHcmlkSW5saW5lRWRpdFJvdyIsIFtiLCBxXSksIGEuaXNGdW5jdGlvbihxLm9uZWRpdGZ1bmMpICYmIHEub25lZGl0ZnVuYy5jYWxsKGwsIGIpKSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNhdmVSb3c6IGZ1bmN0aW9uKGIsIGMsIGQsIGcsIGwsIGUsIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhLm1ha2VBcnJheShhcmd1bWVudHMpLnNsaWNlKDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IHRoaXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICJvYmplY3QiID09PSBhLnR5cGUoa1swXSkgPyByID0ga1swXSA6IChhLmlzRnVuY3Rpb24oYykgJiYgKHIuc3VjY2Vzc2Z1bmMgPSBjKSwgdm9pZCAwICE9PSBkICYmIChyLnVybCA9IGQpLCB2b2lkIDAgIT09IGcgJiYgKHIuZXh0cmFwYXJhbSA9IGcpLCBhLmlzRnVuY3Rpb24obCkgJiYgKHIuYWZ0ZXJzYXZlZnVuYyA9IGwpLCBhLmlzRnVuY3Rpb24oZSkgJiYgKHIuZXJyb3JmdW5jID0gZSksIGEuaXNGdW5jdGlvbihuKSAmJiAoci5hZnRlcnJlc3RvcmVmdW5jID0gbikpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IGEuZXh0ZW5kKCEwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bmM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhcGFyYW06IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyc2F2ZWZ1bmM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JmdW5jOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVycmVzdG9yZWZ1bmM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdG9yZUFmdGVyRXJyb3I6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG10eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZXVpOiAiZW5hYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZldGV4dDogYS5qZ3JpZC5nZXRSZWdpb25hbChxLCAiZGVmYXVsdHMuc2F2ZXRleHQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYS5qZ3JpZC5pbmxpbmVFZGl0LCByKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUsIHosIHksIHAsIEMsIHYgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE4gPSBhLnRyaW0oYShxKS5qcUdyaWQoImdldFN0eWxlVUkiLCBxLnAuc3R5bGVVSSArICIuY29tbW9uIiwgImVycm9yIiwgITApKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFxLmdyaWQgfHwgKEMgPSBhKHEpLmpxR3JpZCgiZ2V0SW5kIiwgYiwgITApLCAhMSA9PT0gQykpIHJldHVybiB2OwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgTCA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImVycm9ycyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImVkaXQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmlzRnVuY3Rpb24oci5iZWZvcmVTYXZlUm93KSA/IHIuYmVmb3JlU2F2ZVJvdy5jYWxsKHEsIHIsIGIpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBrICYmIChrID0gITApLCBrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeiA9IGEoQykuYXR0cigiZWRpdGFibGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByLnVybCA9IHIudXJsIHx8IHEucC5lZGl0dXJsLCAiMSIgPT09IHopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSgndGRbcm9sZT0iZ3JpZGNlbGwiXScsIEMpLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcgPSBxLnAuY29sTW9kZWxbYl0sIHUgPSBHLm5hbWUsICJjYiIgIT09IHUgJiYgInN1YmdyaWQiICE9PSB1ICYmICEwID09PSBHLmVkaXRhYmxlICYmICJybiIgIT09IHUgJiYgIWEodGhpcykuaGFzQ2xhc3MoIm5vdC1lZGl0YWJsZS1jZWxsIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKEcuZWRpdHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBbIlllcyIsICJObyJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRy5lZGl0b3B0aW9ucyAmJiAoYyA9IEcuZWRpdG9wdGlvbnMudmFsdWUuc3BsaXQoIjoiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBW3VdID0gYSgiaW5wdXQiLCB0aGlzKS5pcygiOmNoZWNrZWQiKSA/IGNbMF0gOiBjWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXNzd29yZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYnV0dG9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFbdV0gPSBhKCJpbnB1dCwgdGV4dGFyZWEiLCB0aGlzKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcuZWRpdG9wdGlvbnMubXVsdGlwbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInNlbGVjdCIsIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVt1XSA9IGEoYykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVt1XSA9IEFbdV0gPyBBW3VdLmpvaW4oIiwiKSA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInNlbGVjdCBvcHRpb246c2VsZWN0ZWQiLCB0aGlzKS5lYWNoKGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFtiXSA9IGEoYykudGV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeFt1XSA9IGQuam9pbigiLCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgQVt1XSA9IGEoInNlbGVjdCBvcHRpb246c2VsZWN0ZWQiLCB0aGlzKS52YWwoKSwgeFt1XSA9IGEoInNlbGVjdCBvcHRpb246c2VsZWN0ZWQiLCB0aGlzKS50ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHLmZvcm1hdHRlciAmJiAic2VsZWN0IiA9PT0gRy5mb3JtYXR0ZXIgJiYgKHggPSB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY3VzdG9tIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFHLmVkaXRvcHRpb25zIHx8ICFhLmlzRnVuY3Rpb24oRy5lZGl0b3B0aW9ucy5jdXN0b21fdmFsdWUpKSB0aHJvdyAiZTEiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBW3VdID0gRy5lZGl0b3B0aW9ucy5jdXN0b21fdmFsdWUuY2FsbChxLCBhKCIuY3VzdG9tZWxlbWVudCIsIHRoaXMpLCAiZ2V0IiksIHZvaWQgMCA9PT0gQVt1XSkgdGhyb3cgImUyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZTEiID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPyBhLmpncmlkLmluZm9fZGlhbG9nKEwuZXJyY2FwLCAiZnVuY3Rpb24gJ2N1c3RvbV92YWx1ZScgIiArIEoubXNnLm5vZGVmaW5lZCwgSi5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVVSTogcS5wLnN0eWxlVUkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGEuamdyaWQuaW5mb19kaWFsb2coTC5lcnJjYXAsIGYubWVzc2FnZSwgSi5iQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVVSTogcS5wLnN0eWxlVUkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9IGEuamdyaWQuY2hlY2tWYWx1ZXMuY2FsbChxLCBBW3VdLCBiKSwgITEgPT09IHBbMF0pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLnAuYXV0b2VuY29kZSAmJiAoQVt1XSA9IGEuamdyaWQuaHRtbEVuY29kZShBW3VdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNsaWVudEFycmF5IiAhPT0gci51cmwgJiYgRy5lZGl0b3B0aW9ucyAmJiAhMCA9PT0gRy5lZGl0b3B0aW9ucy5OdWxsSWZFbXB0eSAmJiAiIiA9PT0gQVt1XSAmJiAoSFt1XSA9ICJudWxsIiwgRSA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEgPT09IHBbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEID0gYShxKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRiA9IGEuamdyaWQuZmluZFBvcyhEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuaW5mb19kaWFsb2coTC5lcnJjYXAsIHBbMV0sIEouYkNsb3NlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogRlswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IEZbMV0gKyBhKEQpLm91dGVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVVSTogcS5wLnN0eWxlVUkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHBbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRiA9IHEucC5wcm1OYW1lczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRCA9ICExID09PSBxLnAua2V5TmFtZSA/IEYuaWQgOiBxLnAua2V5TmFtZSwgQSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQVtGLm9wZXJdID0gRi5lZGl0b3Blciwgdm9pZCAwID09PSBBW0RdIHx8ICIiID09PSBBW0RdKSBBW0RdID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoQy5pZCAhPT0gcS5wLmlkUHJlZml4ICsgQVtEXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRiA9IGEuamdyaWQuc3RyaXBQcmVmKHEucC5pZFByZWZpeCwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBxLnAuX2luZGV4W0ZdICYmIChxLnAuX2luZGV4W0FbRF1dID0gcS5wLl9pbmRleFtGXSwgZGVsZXRlIHEucC5faW5kZXhbRl0pLCBiID0gcS5wLmlkUHJlZml4ICsgQVtEXSwgYShDKS5hdHRyKCJpZCIsIGIpLCBxLnAuc2Vscm93ID09PSB6ICYmIChxLnAuc2Vscm93ID0gYiksIGEuaXNBcnJheShxLnAuc2VsYXJycm93KSkgRiA9IGEuaW5BcnJheSh6LCBxLnAuc2VsYXJycm93KSwgMCA8PSBGICYmIChxLnAuc2VsYXJycm93W0ZdID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEucC5tdWx0aXNlbGVjdCAmJiAoRiA9ICJqcWdfIiArIHEucC5pZCArICJfIiArIGIsIGEoImlucHV0LmNib3giLCBDKS5hdHRyKCJpZCIsIEYpLmF0dHIoIm5hbWUiLCBGKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IHEucC5pbmxpbmVEYXRhICYmIChxLnAuaW5saW5lRGF0YSA9IHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IGEuZXh0ZW5kKHt9LCBBLCBxLnAuaW5saW5lRGF0YSwgci5leHRyYXBhcmFtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImNsaWVudEFycmF5IiA9PT0gci51cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IGEuZXh0ZW5kKHt9LCBBLCB4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcS5wLmF1dG9lbmNvZGUgJiYgYS5lYWNoKEEsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFbYl0gPSBhLmpncmlkLmh0bWxEZWNvZGUoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEYgPSBhKHEpLmpxR3JpZCgic2V0Um93RGF0YSIsIGIsIEEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKEMpLmF0dHIoImVkaXRhYmxlIiwgIjAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChEID0gMDsgRCA8IHEucC5zYXZlZFJvdy5sZW5ndGg7IEQrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTdHJpbmcocS5wLnNhdmVkUm93W0RdLmlkKSA9PT0gU3RyaW5nKHopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IEQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8PSB5ICYmIHEucC5zYXZlZFJvdy5zcGxpY2UoeSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEocSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZElubGluZUFmdGVyU2F2ZVJvdyIsIFtiLCBGLCBBLCByXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihyLmFmdGVyc2F2ZWZ1bmMpICYmIHIuYWZ0ZXJzYXZlZnVuYy5jYWxsKHEsIGIsIEYsIEEsIHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoQykucmVtb3ZlQ2xhc3MoImpxZ3JpZC1uZXctcm93IikudW5iaW5kKCJrZXlkb3duIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYShxKS5qcUdyaWQoInByb2dyZXNzQmFyIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJzaG93IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZHR5cGU6IHIuc2F2ZXVpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sY29udGVudDogci5zYXZldGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBIID0gYS5leHRlbmQoe30sIEEsIEgpLCBIW0RdID0gYS5qZ3JpZC5zdHJpcFByZWYocS5wLmlkUHJlZml4LCBIW0RdKSwgYS5hamF4KGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiByLnVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYS5pc0Z1bmN0aW9uKHEucC5zZXJpYWxpemVSb3dEYXRhKSA/IHEucC5zZXJpYWxpemVSb3dEYXRhLmNhbGwocSwgSCkgOiBILAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiByLm10eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShxKS5qcUdyaWQoInByb2dyZXNzQmFyIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJoaWRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZHR5cGU6IHIuc2F2ZXVpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sY29udGVudDogci5zYXZldGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIiA9PT0gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBoID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPSBhKHEpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRJbmxpbmVTdWNjZXNzU2F2ZVJvdyIsIFtjLCBiLCByXSksIGEuaXNBcnJheShlKSB8fCAoZSA9IFshMCwgSF0pLCBlWzBdICYmIGEuaXNGdW5jdGlvbihyLnN1Y2Nlc3NmdW5jKSAmJiAoZSA9IHIuc3VjY2Vzc2Z1bmMuY2FsbChxLCBjKSksIGEuaXNBcnJheShlKSA/IChoID0gZVswXSwgQSA9IGVbMV0gfHwgQSkgOiBoID0gZSwgITAgPT09IGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcS5wLmF1dG9lbmNvZGUgJiYgYS5lYWNoKEEsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFbYl0gPSBhLmpncmlkLmh0bWxEZWNvZGUoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUgJiYgYS5lYWNoKEEsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudWxsIiA9PT0gQVthXSAmJiAoQVthXSA9ICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IGEuZXh0ZW5kKHt9LCBBLCB4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShxKS5qcUdyaWQoInNldFJvd0RhdGEiLCBiLCBBKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShDKS5hdHRyKCJlZGl0YWJsZSIsICIwIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBxLnAuc2F2ZWRSb3cubGVuZ3RoOyBlKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nKHEucC5zYXZlZFJvd1tlXS5pZCkgPT09IFN0cmluZyhiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPD0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgJiYgcS5wLnNhdmVkUm93LnNwbGljZSh5LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShxKS50cmlnZ2VySGFuZGxlcigianFHcmlkSW5saW5lQWZ0ZXJTYXZlUm93IiwgW2IsIGMsIEEsIHJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKHIuYWZ0ZXJzYXZlZnVuYykgJiYgci5hZnRlcnNhdmVmdW5jLmNhbGwocSwgYiwgYywgQSwgcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShDKS5yZW1vdmVDbGFzcygianFncmlkLW5ldy1yb3ciKS51bmJpbmQoImtleWRvd24iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBhKHEpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRJbmxpbmVFcnJvclNhdmVSb3ciLCBbYiwgYywgZCwgbnVsbCwgcl0pLCBhLmlzRnVuY3Rpb24oci5lcnJvcmZ1bmMpICYmIHIuZXJyb3JmdW5jLmNhbGwocSwgYiwgYywgZCwgbnVsbCksICEwID09PSByLnJlc3RvcmVBZnRlckVycm9yICYmIGEocSkuanFHcmlkKCJyZXN0b3JlUm93IiwgYiwgci5hZnRlcnJlc3RvcmVmdW5jKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oYywgZCwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoIiNsdWlfIiArIGEuamdyaWQuanFJRChxLnAuaWQpKS5oaWRlKCksIGEocSkudHJpZ2dlckhhbmRsZXIoImpxR3JpZElubGluZUVycm9yU2F2ZVJvdyIsIFtiLCBjLCBkLCBlLCByXSksIGEuaXNGdW5jdGlvbihyLmVycm9yZnVuYykpIHIuZXJyb3JmdW5jLmNhbGwocSwgYiwgYywgZCwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYy5yZXNwb25zZVRleHQgfHwgYy5zdGF0dXNUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuaW5mb19kaWFsb2coTC5lcnJjYXAsICc8ZGl2IGNsYXNzPSInICsgTiArICciPicgKyBjICsgIjwvZGl2PiIsIEouYkNsb3NlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25hbGlnbjogInJpZ2h0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlVUk6IHEucC5zdHlsZVVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0hMCA9PT0gci5yZXN0b3JlQWZ0ZXJFcnJvciAmJiBhKHEpLmpxR3JpZCgicmVzdG9yZVJvdyIsIGIsIHIuYWZ0ZXJyZXN0b3JlZnVuYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGEuamdyaWQuYWpheE9wdGlvbnMsIHEucC5hamF4Um93T3B0aW9ucyB8fCB7fSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByZXN0b3JlUm93OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJvYmplY3QiID09PSBhLnR5cGUoZFswXSkgPyBnID0gZFswXSA6IGEuaXNGdW5jdGlvbihjKSAmJiAoZy5hZnRlcnJlc3RvcmVmdW5jID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMpLCBnID0gYS5leHRlbmQoITAsIHt9LCBhLmpncmlkLmlubGluZUVkaXQsIGcpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgaCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLmdyaWQgJiYgKGMgPSBhKGgpLmpxR3JpZCgiZ2V0SW5kIiwgYiwgITApLCAhMSAhPT0gYykgJiYgKGQgPSBhLmlzRnVuY3Rpb24oZy5iZWZvcmVDYW5jZWxSb3cpID8gZy5iZWZvcmVDYW5jZWxSb3cuY2FsbChoLCBnLCBiKSA6IHZvaWQgMCwgdm9pZCAwID09PSBkICYmIChkID0gITApLCBkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBoLnAuc2F2ZWRSb3cubGVuZ3RoOyBkKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTdHJpbmcoaC5wLnNhdmVkUm93W2RdLmlkKSA9PT0gU3RyaW5nKGIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA8PSBtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmlzRnVuY3Rpb24oYS5mbi5kYXRlcGlja2VyKSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoImlucHV0Lmhhc0RhdGVwaWNrZXIiLCAiIyIgKyBhLmpncmlkLmpxSUQoYy5pZCkpLmRhdGVwaWNrZXIoImhpZGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goaC5wLmNvbE1vZGVsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSB0aGlzLmVkaXRhYmxlICYmIGgucC5zYXZlZFJvd1ttXS5oYXNPd25Qcm9wZXJ0eSh0aGlzLm5hbWUpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGtbdGhpcy5uYW1lXSA9IGgucC5zYXZlZFJvd1ttXVt0aGlzLm5hbWVdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShoKS5qcUdyaWQoInNldFJvd0RhdGEiLCBiLCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5hdHRyKCJlZGl0YWJsZSIsICIwIikudW5iaW5kKCJrZXlkb3duIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgucC5zYXZlZFJvdy5zcGxpY2UobSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGIpLCAiIyIgKyBhLmpncmlkLmpxSUQoaC5wLmlkKSkuaGFzQ2xhc3MoImpxZ3JpZC1uZXctcm93IikgJiYgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoaCkuanFHcmlkKCJkZWxSb3dEYXRhIiwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGgpLmpxR3JpZCgic2hvd0FkZEVkaXRCdXR0b25zIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShoKS50cmlnZ2VySGFuZGxlcigianFHcmlkSW5saW5lQWZ0ZXJSZXN0b3JlUm93IiwgW2JdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oZy5hZnRlcnJlc3RvcmVmdW5jKSAmJiBnLmFmdGVycmVzdG9yZWZ1bmMuY2FsbChoLCBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYWRkUm93OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiID0gYS5leHRlbmQoITAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lEOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJmaXJzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VEZWZWYWx1ZXM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlRm9ybWF0dGVyOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFJvd1BhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhcGFyYW06IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIgfHwge30pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS5pc0Z1bmN0aW9uKGIuYmVmb3JlQWRkUm93KSA/IGIuYmVmb3JlQWRkUm93LmNhbGwoYywgYi5hZGRSb3dQYXJhbXMpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGQgJiYgKGQgPSAhMCksIGQpKGIucm93SUQgPSBhLmlzRnVuY3Rpb24oYi5yb3dJRCkgPyBiLnJvd0lELmNhbGwoYywgYikgOiBudWxsICE9IGIucm93SUQgPyBiLnJvd0lEIDogYS5qZ3JpZC5yYW5kSWQoKSwgITAgPT09IGIudXNlRGVmVmFsdWVzICYmIGEoYy5wLmNvbE1vZGVsKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWRpdG9wdGlvbnMgJiYgdGhpcy5lZGl0b3B0aW9ucy5kZWZhdWx0VmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuZWRpdG9wdGlvbnMuZGVmYXVsdFZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS5pc0Z1bmN0aW9uKGQpID8gZC5jYWxsKGMpIDogZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmluaXRkYXRhW3RoaXMubmFtZV0gPSBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGMpLmpxR3JpZCgiYWRkUm93RGF0YSIsIGIucm93SUQsIGIuaW5pdGRhdGEsIGIucG9zaXRpb24pLCBiLnJvd0lEID0gYy5wLmlkUHJlZml4ICsgYi5yb3dJRCwgYSgiIyIgKyBhLmpncmlkLmpxSUQoYi5yb3dJRCksICIjIiArIGEuamdyaWQuanFJRChjLnAuaWQpKS5hZGRDbGFzcygianFncmlkLW5ldy1yb3ciKSwgYi51c2VGb3JtYXR0ZXIpID8gYSgiIyIgKyBhLmpncmlkLmpxSUQoYi5yb3dJRCkgKyAiIC51aS1pbmxpbmUtZWRpdCIsICIjIiArIGEuamdyaWQuanFJRChjLnAuaWQpKS5jbGljaygpIDogKGQgPSBjLnAucHJtTmFtZXMsIGIuYWRkUm93UGFyYW1zLmV4dHJhcGFyYW1bZC5vcGVyXSA9IGQuYWRkb3BlciwgYShjKS5qcUdyaWQoImVkaXRSb3ciLCBiLnJvd0lELCBiLmFkZFJvd1BhcmFtcyksIGEoYykuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBiLnJvd0lEKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGlubGluZU5hdjogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5qZ3JpZC5nZXRSZWdpb25hbChkLCAibmF2IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5zdHlsZVVJW2QucC5zdHlsZVVJXS5pbmxpbmVkaXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjID0gYS5leHRlbmQoITAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXQ6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGljb246IGwuaWNvbl9lZGl0X25hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRpY29uOiBsLmljb25fYWRkX25hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmU6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWljb246IGwuaWNvbl9zYXZlX25hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxpY29uOiBsLmljb25fY2FuY2VsX25hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFBhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFJvd1BhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYXBhcmFtOiB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0UGFyYW1zOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmVBZnRlclNlbGVjdDogITAKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZywgYyB8fCB7fSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgIXRoaXMucC5pbmxpbmVOYXYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGEuamdyaWQuanFJRChkLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS50cmltKGEoZCkuanFHcmlkKCJnZXRTdHlsZVVJIiwgZC5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJkaXNhYmxlZCIsICEwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQucC5uYXZHcmlkIHx8IGEoZCkuanFHcmlkKCJuYXZHcmlkIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWw6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKGQpLmRhdGEoImlubGluZU5hdiIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkuZGF0YSgiaW5saW5lTmF2IiwgYyksIGQucC5mb3JjZV9yZWdpb25hbCAmJiAoYyA9IGEuZXh0ZW5kKGMsIGcpKSwgZC5wLmlubGluZU5hdiA9ICEwLCAhMCA9PT0gYy5hZGRQYXJhbXMudXNlRm9ybWF0dGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrLCByID0gZC5wLmNvbE1vZGVsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgci5sZW5ndGg7IGsrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyW2tdLmZvcm1hdHRlciAmJiAiYWN0aW9ucyIgPT09IHJba10uZm9ybWF0dGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcltrXS5mb3JtYXRvcHRpb25zICYmIChrID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FZGl0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyU2F2ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJSZXN0b3JlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYXBhcmFtOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcltrXS5mb3JtYXRvcHRpb25zKSwgYy5hZGRQYXJhbXMuYWRkUm93UGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiBrLmtleXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdGZ1bmM6IGsub25FZGl0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVuYzogay5vblN1Y2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogay51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhcGFyYW06IGsuZXh0cmFwYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJzYXZlZnVuYzogay5hZnRlclNhdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yZnVuYzogay5vbkVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlcnJlc3RvcmVmdW5jOiBrLmFmdGVyUmVzdG9yZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuYWRkICYmIGEoZCkuanFHcmlkKCJuYXZCdXR0b25BZGQiLCBiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb246IGMuYWRkdGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGMuYWRkdGl0bGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbmljb246IGMuYWRkaWNvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGQucC5pZCArICJfaWxhZGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2tCdXR0b246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5qcUdyaWQoImFkZFJvdyIsIGMuYWRkUGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuYWRkUGFyYW1zLnVzZUZvcm1hdHRlciB8fCAoYSgiIyIgKyBlICsgIl9pbHNhdmUiKS5yZW1vdmVDbGFzcyhsKSwgYSgiIyIgKyBlICsgIl9pbGNhbmNlbCIpLnJlbW92ZUNsYXNzKGwpLCBhKCIjIiArIGUgKyAiX2lsYWRkIikuYWRkQ2xhc3MobCksIGEoIiMiICsgZSArICJfaWxlZGl0IikuYWRkQ2xhc3MobCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmVkaXQgJiYgYShkKS5qcUdyaWQoIm5hdkJ1dHRvbkFkZCIsIGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogYy5lZGl0dGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGMuZWRpdHRpdGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25pY29uOiBjLmVkaXRpY29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZC5wLmlkICsgIl9pbGVkaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbDogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2tCdXR0b246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKGQpLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiwgInNlbHJvdyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA/IChhKGQpLmpxR3JpZCgiZWRpdFJvdyIsIGIsIGMuZWRpdFBhcmFtcyksIGEoIiMiICsgZSArICJfaWxzYXZlIikucmVtb3ZlQ2xhc3MobCksIGEoIiMiICsgZSArICJfaWxjYW5jZWwiKS5yZW1vdmVDbGFzcyhsKSwgYSgiIyIgKyBlICsgIl9pbGFkZCIpLmFkZENsYXNzKGwpLCBhKCIjIiArIGUgKyAiX2lsZWRpdCIpLmFkZENsYXNzKGwpKSA6IChhLmpncmlkLnZpZXdNb2RhbCgiI2FsZXJ0bW9kXyIgKyBlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjanFnX2FscnQiKS5mb2N1cygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5zYXZlICYmIChhKGQpLmpxR3JpZCgibmF2QnV0dG9uQWRkIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBjLnNhdmV0ZXh0IHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYy5zYXZldGl0bGUgfHwgIlNhdmUgcm93IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uaWNvbjogYy5zYXZlaWNvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGQucC5pZCArICJfaWxzYXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrQnV0dG9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gZC5wLnNhdmVkUm93WzBdLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGQucC5wcm1OYW1lcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGYub3BlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGMuZWRpdFBhcmFtczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGEuamdyaWQuanFJRChiKSwgIiMiICsgZSkuaGFzQ2xhc3MoImpxZ3JpZC1uZXctcm93IikgPyAoYy5hZGRQYXJhbXMuYWRkUm93UGFyYW1zLmV4dHJhcGFyYW1bZ10gPSBmLmFkZG9wZXIsIGwgPSBjLmFkZFBhcmFtcy5hZGRSb3dQYXJhbXMpIDogKGMuZWRpdFBhcmFtcy5leHRyYXBhcmFtIHx8IChjLmVkaXRQYXJhbXMuZXh0cmFwYXJhbSA9IHt9KSwgYy5lZGl0UGFyYW1zLmV4dHJhcGFyYW1bZ10gPSBmLmVkaXRvcGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQpLmpxR3JpZCgic2F2ZVJvdyIsIGIsIGwpICYmIGEoZCkuanFHcmlkKCJzaG93QWRkRWRpdEJ1dHRvbnMiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEuamdyaWQudmlld01vZGFsKCIjYWxlcnRtb2RfIiArIGUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYm94OiAiI2dib3hfIiArIGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtOiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEoIiNqcWdfYWxydCIpLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjIiArIGUgKyAiX2lsc2F2ZSIpLmFkZENsYXNzKGwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmNhbmNlbCAmJiAoYShkKS5qcUdyaWQoIm5hdkJ1dHRvbkFkZCIsIGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogYy5jYW5jZWx0ZXh0IHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYy5jYW5jZWx0aXRsZSB8fCAiQ2FuY2VsIHJvdyBlZGl0aW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uaWNvbjogYy5jYW5jZWxpY29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZC5wLmlkICsgIl9pbGNhbmNlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGlja0J1dHRvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGQucC5zYXZlZFJvd1swXS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYy5lZGl0UGFyYW1zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA/IChhKCIjIiArIGEuamdyaWQuanFJRChiKSwgIiMiICsgZSkuaGFzQ2xhc3MoImpxZ3JpZC1uZXctcm93IikgJiYgKGYgPSBjLmFkZFBhcmFtcy5hZGRSb3dQYXJhbXMpLCBhKGQpLmpxR3JpZCgicmVzdG9yZVJvdyIsIGIsIGYpLCBhKGQpLmpxR3JpZCgic2hvd0FkZEVkaXRCdXR0b25zIikpIDogKGEuamdyaWQudmlld01vZGFsKCIjYWxlcnRtb2QiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2JveDogIiNnYm94XyIgKyBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbTogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKCIjanFnX2FscnQiKS5mb2N1cygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEoIiMiICsgZSArICJfaWxjYW5jZWwiKS5hZGRDbGFzcyhsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGMucmVzdG9yZUFmdGVyU2VsZWN0ICYmIGEoZCkuYmluZCgianFHcmlkQmVmb3JlU2VsZWN0Um93LmlubGluZU5hdiIsIGZ1bmN0aW9uKGIsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IGQucC5zYXZlZFJvdy5sZW5ndGggJiYgITAgPT09IGQucC5pbmxpbmVOYXYgJiYgZSAhPT0gZC5wLnNlbHJvdyAmJiBudWxsICE9PSBkLnAuc2Vscm93ICYmIChkLnAuc2Vscm93ID09PSBjLmFkZFBhcmFtcy5yb3dJRCA/IGEoZCkuanFHcmlkKCJkZWxSb3dEYXRhIiwgZC5wLnNlbHJvdykgOiBhKGQpLmpxR3JpZCgicmVzdG9yZVJvdyIsIGQucC5zZWxyb3csIGMuZWRpdFBhcmFtcyksIGEoZCkuanFHcmlkKCJzaG93QWRkRWRpdEJ1dHRvbnMiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2hvd0FkZEVkaXRCdXR0b25zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEuamdyaWQuanFJRCh0aGlzLnAuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYS50cmltKGEodGhpcykuanFHcmlkKCJnZXRTdHlsZVVJIiwgdGhpcy5wLnN0eWxlVUkgKyAiLmNvbW1vbiIsICJkaXNhYmxlZCIsICEwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBiICsgIl9pbHNhdmUiKS5hZGRDbGFzcyhjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGIgKyAiX2lsY2FuY2VsIikuYWRkQ2xhc3MoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiIyIgKyBiICsgIl9pbGFkZCIpLnJlbW92ZUNsYXNzKGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYiArICJfaWxlZGl0IikucmVtb3ZlQ2xhc3MoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwgYS5qZ3JpZC5tc2llICYmIDggPT09IGEuamdyaWQubXNpZXZlcigpICYmIChhLmV4cHJbIjoiXS5oaWRkZW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT09IGEub2Zmc2V0V2lkdGggfHwgMCA9PT0gYS5vZmZzZXRIZWlnaHQgfHwgIm5vbmUiID09PSBhLnN0eWxlLmRpc3BsYXkKICAgICAgICAgICAgICAgIH0pLCBhLmpncmlkLl9tdWx0aXNlbGVjdCA9ICExLCBhLnVpICYmIGEudWkubXVsdGlzZWxlY3QpIHsKICAgICAgICAgICAgICAgIGlmIChhLnVpLm11bHRpc2VsZWN0LnByb3RvdHlwZS5fc2V0U2VsZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IGEudWkubXVsdGlzZWxlY3QucHJvdG90eXBlLl9zZXRTZWxlY3RlZDsKICAgICAgICAgICAgICAgICAgICBhLnVpLm11bHRpc2VsZWN0LnByb3RvdHlwZS5fc2V0U2VsZWN0ZWQgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gRC5jYWxsKHRoaXMsIGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAmJiB0aGlzLnNlbGVjdGVkTGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMaXN0LmZpbmQoImxpIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmRhdGEoIm9wdGlvbkxpbmsiKSAmJiBhKHRoaXMpLmRhdGEoIm9wdGlvbkxpbmsiKS5yZW1vdmUoKS5hcHBlbmRUbyhnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGEudWkubXVsdGlzZWxlY3QucHJvdG90eXBlLmRlc3Ryb3kgJiYgKGEudWkubXVsdGlzZWxlY3QucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gYS5XaWRnZXQgPyBhLndpZGdldC5wcm90b3R5cGUuZGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogYS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBhLmpncmlkLl9tdWx0aXNlbGVjdCA9ICEwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYS5qZ3JpZC5leHRlbmQoewogICAgICAgICAgICAgICAgc29ydGFibGVDb2x1bW5zOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5kaXNhYmxlQ2xpY2sgPSAhMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhLmpncmlkLmpxSUQoZC5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9sZXJhbmNlOiAicG9pbnRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXhpczogIngiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAiMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6ICI+dGg6bm90KDpoYXMoI2pxZ2hfIiArIGcgKyAiX2NiLCNqcWdoXyIgKyBnICsgIl9ybiwjanFnaF8iICsgZyArICJfc3ViZ3JpZCksOmhpZGRlbikiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYlswXS5ub2RlTmFtZSkpLmFkZENsYXNzKGJbMF0uY2xhc3NOYW1lICsgIiB1aS1zb3J0YWJsZS1wbGFjZWhvbGRlciB1aS1zdGF0ZS1oaWdobGlnaHQiKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmhlaWdodChhLmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCkgLSBwYXJzZUludChhLmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ1RvcCIpIHx8IDAsIDEwKSAtIHBhcnNlSW50KGEuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nQm90dG9tIikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAxMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi53aWR0aChhLmN1cnJlbnRJdGVtLmlubmVyV2lkdGgoKSAtIHBhcnNlSW50KGEuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nTGVmdCIpIHx8IDAsIDEwKSAtIHBhcnNlSW50KGEuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nUmlnaHQiKSB8fCAwLCAxMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGEoYy5pdGVtKS5wYXJlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBhKCI+dGgiLCBmKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBkLnAuaWQgKyAiXyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChkLnAuY29sTW9kZWwsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdbdGhpcy5uYW1lXSA9IGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSgiPmRpdiIsIHRoaXMpLmdldCgwKS5pZC5yZXBsYWNlKC9eanFnaF8vLCAiIikucmVwbGFjZShtLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmhhc093blByb3BlcnR5KGIpICYmIGwucHVzaChnW2JdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS5qcUdyaWQoInJlbWFwQ29sdW1ucyIsIGwsICEwLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihkLnAuc29ydGFibGUudXBkYXRlKSAmJiBkLnAuc29ydGFibGUudXBkYXRlKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLmRpc2FibGVDbGljayA9ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnAuc29ydGFibGUub3B0aW9ucyA/IGEuZXh0ZW5kKGcsIGQucC5zb3J0YWJsZS5vcHRpb25zKSA6IGEuaXNGdW5jdGlvbihkLnAuc29ydGFibGUpICYmIChkLnAuc29ydGFibGUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiBkLnAuc29ydGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBnLnN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGcuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnN0YXJ0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLmNhbGwodGhpcywgYSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGcuc3RhcnQgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICBkLnAuc29ydGFibGUuZXhjbHVkZSAmJiAoZy5pdGVtcyArPSAiOm5vdCgiICsgZC5wLnNvcnRhYmxlLmV4Y2x1ZGUgKyAiKSIpOwogICAgICAgICAgICAgICAgICAgICAgICBnID0gYi5zb3J0YWJsZShnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGcuZGF0YSgic29ydGFibGUiKSB8fCBnLmRhdGEoInVpU29ydGFibGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBnICYmIChnLmRhdGEoInNvcnRhYmxlIikuZmxvYXRpbmcgPSAhMCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbHVtbkNob29zZXI6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKGIsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiAoInN0cmluZyIgPT0gdHlwZW9mIGIgPyBhLmZuW2JdICYmIGEuZm5bYl0uYXBwbHkoZCwgYS5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgyKSkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGIpICYmIGIuYXBwbHkoZCwgYS5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgyKSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBkLCBnLCBsLCBlLCBuID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgayA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICByID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBuLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiwgImNvbE1vZGVsIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBuLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiwgImNvbE5hbWVzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHogPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS51aS5tdWx0aXNlbGVjdC5wcm90b3R5cGUgJiYgYi5kYXRhKGEudWkubXVsdGlzZWxlY3QucHJvdG90eXBlLndpZGdldEZ1bGxOYW1lIHx8IGEudWkubXVsdGlzZWxlY3QucHJvdG90eXBlLndpZGdldE5hbWUpIHx8IGIuZGF0YSgidWktbXVsdGlzZWxlY3QiKSB8fCBiLmRhdGEoIm11bHRpc2VsZWN0IikKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzWzBdLCAiY29sIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhKCIjY29sY2hvb3Nlcl8iICsgYS5qZ3JpZC5qcUlEKG5bMF0ucC5pZCkpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IGEoJzxkaXYgaWQ9ImNvbGNob29zZXJfJyArIG5bMF0ucC5pZCArICciIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTtvdmVyZmxvdzpoaWRkZW4iPjxkaXY+PHNlbGVjdCBtdWx0aXBsZT0ibXVsdGlwbGUiPjwvc2VsZWN0PjwvZGl2PjwvZGl2PicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEoInNlbGVjdCIsIGQpLCBiID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NuYW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiBuLmpxR3JpZCgicmVtYXBDb2x1bW5zIiwgYSwgITApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2VsOiAibXVsdGlzZWxlY3QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRsb2c6ICJkaWFsb2ciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ19vcHRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbldpZHRoOiA0NzAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ0NsYXNzOiAidWktanFkaWFsb2ciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbG9nX29wdHM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNbYi5iU3VibWl0XSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5hcHBseV9wZXJtKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNsZWFudXAoITEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNbYi5iQ2FuY2VsXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5jbGVhbnVwKCEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmV4dGVuZCghMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uczogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNsZWFudXAoITApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6IGIubW9kYWwgfHwgITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemFibGU6IGIucmVzaXphYmxlIHx8ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIud2lkdGggKyA3MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB6KGcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYS5jb250YWluZXIuY2xvc2VzdCgiLnVpLWRpYWxvZy1jb250ZW50Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IGIubGVuZ3RoICYmICJvYmplY3QiID09IHR5cGVvZiBiWzBdLnN0eWxlID8gYlswXS5zdHlsZS53aWR0aCA9ICIiIDogYi5jc3MoIndpZHRoIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2VsZWN0ZWRMaXN0LmhlaWdodChNYXRoLm1heChhLnNlbGVjdGVkQ29udGFpbmVyLmhlaWdodCgpIC0gYS5zZWxlY3RlZEFjdGlvbnMub3V0ZXJIZWlnaHQoKSAtIDEsIDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmF2YWlsYWJsZUxpc3QuaGVpZ2h0KE1hdGgubWF4KGEuYXZhaWxhYmxlQ29udGFpbmVyLmhlaWdodCgpIC0gYS5hdmFpbGFibGVBY3Rpb25zLm91dGVySGVpZ2h0KCkgLSAxLCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYi5kaWFsb2dfb3B0cyB8fCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5X3Blcm06IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJvcHRpb24iLCBnKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5pcygiOnNlbGVjdGVkIikgPyBuLmpxR3JpZCgic2hvd0NvbCIsIHFbdGhpcy52YWx1ZV0ubmFtZSkgOiBuLmpxR3JpZCgiaGlkZUNvbCIsIHFbdGhpcy52YWx1ZV0ubmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIm9wdGlvbltzZWxlY3RlZF0iLCBnKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5wdXNoKHBhcnNlSW50KHRoaXMudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGtbcVtwYXJzZUludCh0aGlzLCAxMCldLm5hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goaywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHBhcnNlSW50KHRoaXMsIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLCBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDAgPD0gZCA/IChlID0gYi5zbGljZSgpLCBmID0gZS5zcGxpY2UoZCwgTWF0aC5tYXgoYi5sZW5ndGggLSBkLCBkKSksIGQgPiBiLmxlbmd0aCAmJiAoZCA9IGIubGVuZ3RoKSwgZVtkXSA9IGEsIGUuY29uY2F0KGYpKSA6IGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZG9uZSAmJiBiLmRvbmUuY2FsbChuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5qcUdyaWQoInNldEdyaWRXaWR0aCIsIG5bMF0ucC53aWR0aCwgblswXS5wLnNocmlua1RvRml0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYW51cDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKGIuZGxvZywgZCwgImRlc3Ryb3kiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyhiLm1zZWwsIGcsICJkZXN0cm95Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgJiYgYi5kb25lICYmIGIuZG9uZS5jYWxsKG4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2VsX29wdHM6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBsLCBiIHx8IHt9KSwgYS51aSAmJiBhLnVpLm11bHRpc2VsZWN0ICYmIGEudWkubXVsdGlzZWxlY3QuZGVmYXVsdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYS5qZ3JpZC5fbXVsdGlzZWxlY3QpIHJldHVybiB2b2lkIGFsZXJ0KCJNdWx0aXNlbGVjdCBwbHVnaW4gbG9hZGVkIGFmdGVyIGpxR3JpZC4gUGxlYXNlIGxvYWQgdGhlIHBsdWdpbiBiZWZvcmUgdGhlIGpxR3JpZCEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubXNlbF9vcHRzID0gYS5leHRlbmQoYS51aS5tdWx0aXNlbGVjdC5kZWZhdWx0cywgYi5tc2VsX29wdHMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYi5jYXB0aW9uICYmIGQuYXR0cigidGl0bGUiLCBiLmNhcHRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICBiLmNsYXNzbmFtZSAmJiAoZC5hZGRDbGFzcyhiLmNsYXNzbmFtZSksIGcuYWRkQ2xhc3MoYi5jbGFzc25hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi53aWR0aCAmJiAoYSgiPmRpdiIsIGQpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYi53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogIjAgYXV0byIKICAgICAgICAgICAgICAgICAgICAgICAgfSksIGcuY3NzKCJ3aWR0aCIsIGIud2lkdGgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgJiYgKGEoIj5kaXYiLCBkKS5jc3MoImhlaWdodCIsIGIuaGVpZ2h0KSwgZy5jc3MoImhlaWdodCIsIGIuaGVpZ2h0IC0gMTApKTsKICAgICAgICAgICAgICAgICAgICAgICAgZy5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2gocSwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtbdGhpcy5uYW1lXSA9IGIsIHRoaXMuaGlkZWRsZyA/IHZvaWQodGhpcy5oaWRkZW4gfHwgci5wdXNoKGIpKSA6IHZvaWQgZy5hcHBlbmQoIjxvcHRpb24gdmFsdWU9JyIgKyBiICsgIicgIiArICh0aGlzLmhpZGRlbiA/ICIiIDogInNlbGVjdGVkPSdzZWxlY3RlZCciKSArICI+IiArIGEuamdyaWQuc3RyaXBIdG1sKHVbYl0pICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9vcHRpb24+IikKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLmlzRnVuY3Rpb24oYi5kbG9nX29wdHMpID8gYi5kbG9nX29wdHMuY2FsbChuLCBiKSA6IGIuZGxvZ19vcHRzOwogICAgICAgICAgICAgICAgICAgICAgICBjKGIuZGxvZywgZCwgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLmlzRnVuY3Rpb24oYi5tc2VsX29wdHMpID8gYi5tc2VsX29wdHMuY2FsbChuLCBiKSA6IGIubXNlbF9vcHRzOwogICAgICAgICAgICAgICAgICAgICAgICBjKGIubXNlbCwgZywgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhKCIjY29sY2hvb3Nlcl8iICsgYS5qZ3JpZC5qcUlEKG5bMF0ucC5pZCkpOwogICAgICAgICAgICAgICAgICAgICAgICBsLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46ICJhdXRvIgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5maW5kKCI+ZGl2IikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogImF1dG8iCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBsID0geihnKTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5jb250YWluZXIuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogImF1dG8iCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBsLnNlbGVjdGVkQ29udGFpbmVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAwICogbC5vcHRpb25zLmRpdmlkZXJMb2NhdGlvbiArICIlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3hTaXppbmc6ICJib3JkZXItYm94IgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5hdmFpbGFibGVDb250YWluZXIuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCAqIGwub3B0aW9ucy5kaXZpZGVyTG9jYXRpb24gKyAiJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94U2l6aW5nOiAiYm9yZGVyLWJveCIKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwuc2VsZWN0ZWRMaXN0LmNzcygiaGVpZ2h0IiwgImF1dG8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5hdmFpbGFibGVMaXN0LmNzcygiaGVpZ2h0IiwgImF1dG8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IE1hdGgubWF4KGwuc2VsZWN0ZWRMaXN0LmhlaWdodCgpLCBsLmF2YWlsYWJsZUxpc3QuaGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5taW4oZSwgYSh3aW5kb3cpLmhlaWdodCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5zZWxlY3RlZExpc3QuY3NzKCJoZWlnaHQiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbC5hdmFpbGFibGVMaXN0LmNzcygiaGVpZ2h0IiwgZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc29ydGFibGVSb3dzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBjLmdyaWQgJiYgKGMucC50cmVlR3JpZCB8fCBhLmZuLnNvcnRhYmxlICYmIChiID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjogIm1vdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF4aXM6ICJ5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogIiA+IC5qcWdyb3ciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBiIHx8IHt9KSwgYi5zdGFydCAmJiBhLmlzRnVuY3Rpb24oYi5zdGFydCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGIuX3N0YXJ0XyA9IGIuc3RhcnQsIGRlbGV0ZSBiLnN0YXJ0KSA6IGIuX3N0YXJ0XyA9ICExLCBiLnVwZGF0ZSAmJiBhLmlzRnVuY3Rpb24oYi51cGRhdGUpID8gKGIuX3VwZGF0ZV8gPSBiLnVwZGF0ZSwgZGVsZXRlIGIudXBkYXRlKSA6IGIuX3VwZGF0ZV8gPSAhMSwgYi5zdGFydCA9IGZ1bmN0aW9uKGQsIGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShnLml0ZW0pLmNzcygiYm9yZGVyLXdpZHRoIiwgIjAiKSwgYSgidGQiLCBnLml0ZW0pLmVhY2goZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IGMuZ3JpZC5jb2xzW2FdLnN0eWxlLndpZHRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjLnAuc3ViR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGEoZy5pdGVtKS5hdHRyKCJpZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5qcUdyaWQoImNvbGxhcHNlU3ViR3JpZFJvdyIsIGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuX3N0YXJ0XyAmJiBiLl9zdGFydF8uYXBwbHkodGhpcywgW2QsIGddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYi51cGRhdGUgPSBmdW5jdGlvbihkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShnLml0ZW0pLmNzcygiYm9yZGVyLXdpZHRoIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBjLnAucm93bnVtYmVycyAmJiBhKCJ0ZC5qcWdyaWQtcm93bnVtIiwgYy5yb3dzKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5odG1sKGIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSArIChwYXJzZUludChjLnAucGFnZSwgMTApIC0gMSkgKiBwYXJzZUludChjLnAucm93TnVtLCAxMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5fdXBkYXRlXyAmJiBiLl91cGRhdGVfLmFwcGx5KHRoaXMsIFtkLCBnXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGEoInRib2R5OmZpcnN0IiwgYykuc29ydGFibGUoYiksIGEoInRib2R5OmZpcnN0ID4gLmpxZ3JvdyIsIGMpLmRpc2FibGVTZWxlY3Rpb24oKSkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBncmlkRG5EOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5kYXRhKGwsICJkbmQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoInRyLmpxZ3Jvdzpub3QoLnVpLWRyYWdnYWJsZSkiLCBsKS5kcmFnZ2FibGUoYS5pc0Z1bmN0aW9uKGIuZHJhZykgPyBiLmRyYWcuY2FsbChhKGwpLCBiKSA6IGIuZHJhZykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgbCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsLmdyaWQgJiYgIWwucC50cmVlR3JpZCAmJiBhLmZuLmRyYWdnYWJsZSAmJiBhLmZuLmRyb3BwYWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSgiI2pxZ3JpZF9kbmQiKVswXSAmJiBhKCJib2R5IikuYXBwZW5kKCI8dGFibGUgaWQ9J2pxZ3JpZF9kbmQnIGNsYXNzPSd1aS1qcWdyaWQtZG5kJz48L3RhYmxlPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBiICYmICJ1cGRhdGVEbkQiID09PSBiICYmICEwID09PSBsLnAuanFnZG5kKSByZXR1cm4gdm9pZCBjKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZzogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwucC5zdWJHcmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYShkLmhlbHBlcikuYXR0cigiaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShsKS5qcUdyaWQoImNvbGxhcHNlU3ViR3JpZFJvdyIsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChnKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBhLmRhdGEobCwgImRuZCIpLmNvbm5lY3RXaXRoLmxlbmd0aDsgZisrKSAwID09PSBhKGEuZGF0YShsLCAiZG5kIikuY29ubmVjdFdpdGhbZl0pLmpxR3JpZCgiZ2V0R3JpZFBhcmFtIiwgInJlY2NvdW50IikgJiYgYShhLmRhdGEobCwgImRuZCIpLmNvbm5lY3RXaXRoW2ZdKS5qcUdyaWQoImFkZFJvd0RhdGEiLCAianFnX2VtcHR5X3JvdyIsIHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5oZWxwZXIuYWRkQ2xhc3MoInVpLXN0YXRlLWhpZ2hsaWdodCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCJ0ZCIsIGQuaGVscGVyKS5lYWNoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuZ3JpZC5oZWFkZXJzW2FdLndpZHRoICsgInB4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vbnN0YXJ0ICYmIGEuaXNGdW5jdGlvbihiLm9uc3RhcnQpICYmIGIub25zdGFydC5jYWxsKGEobCksIGMsIGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmhlbHBlci5kcm9wcGVkICYmICFiLmRyYWdjb3B5ICYmIChmID0gYShkLmhlbHBlcikuYXR0cigiaWQiKSwgdm9pZCAwID09PSBmICYmIChmID0gYSh0aGlzKS5hdHRyKCJpZCIpKSwgYShsKS5qcUdyaWQoImRlbFJvd0RhdGEiLCBmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBhLmRhdGEobCwgImRuZCIpLmNvbm5lY3RXaXRoLmxlbmd0aDsgZisrKSBhKGEuZGF0YShsLCAiZG5kIikuY29ubmVjdFdpdGhbZl0pLmpxR3JpZCgiZGVsUm93RGF0YSIsICJqcWdfZW1wdHlfcm93Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIub25zdG9wICYmIGEuaXNGdW5jdGlvbihiLm9uc3RvcCkgJiYgYi5vbnN0b3AuY2FsbChhKGwpLCBjLCBkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIuZHJhZ19vcHRzIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEoYikuaGFzQ2xhc3MoImpxZ3JvdyIpKSByZXR1cm4gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEoYikuY2xvc2VzdCgidGFibGUudWktanFncmlkLWJ0YWJsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA8IGIubGVuZ3RoICYmIHZvaWQgMCAhPT0gYS5kYXRhKGJbMF0sICJkbmQiKSA/IChiID0gYS5kYXRhKGJbMF0sICJkbmQiKS5jb25uZWN0V2l0aCwgLTEgIT09IGEuaW5BcnJheSgiIyIgKyBhLmpncmlkLmpxSUQodGhpcy5pZCksIGIpID8gITAgOiAhMSkgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcDogZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYShkLmRyYWdnYWJsZSkuaGFzQ2xhc3MoImpxZ3JvdyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGEoZC5kcmFnZ2FibGUpLmF0dHIoImlkIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGQuZHJhZ2dhYmxlLnBhcmVudCgpLnBhcmVudCgpLmpxR3JpZCgiZ2V0Um93RGF0YSIsIGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFiLmRyb3BieW5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZywgaCwgbSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEoIiMiICsgYS5qZ3JpZC5qcUlEKHRoaXMuaWQpKS5qcUdyaWQoImdldEdyaWRQYXJhbSIsICJjb2xNb2RlbCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaCBpbiBmKSBmLmhhc093blByb3BlcnR5KGgpICYmIChnID0ga1ttXS5uYW1lLCAiY2IiICE9PSBnICYmICJybiIgIT09IGcgJiYgInN1YmdyaWQiICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyAmJiBmLmhhc093blByb3BlcnR5KGgpICYmIGtbbV0gJiYgKHdbZ10gPSBmW2hdKSwgbSsrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChwKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuaGVscGVyLmRyb3BwZWQgPSAhMCwgYi5iZWZvcmVkcm9wICYmIGEuaXNGdW5jdGlvbihiLmJlZm9yZWRyb3ApKSBnID0gYi5iZWZvcmVkcm9wLmNhbGwodGhpcywgYywgZCwgZiwgYSgiIyIgKyBhLmpncmlkLmpxSUQobC5wLmlkKSksIGEodGhpcykpLCB2b2lkIDAgIT09IGcgJiYgbnVsbCAhPT0gZyAmJiAib2JqZWN0IiA9PSB0eXBlb2YgZyAmJiAoZiA9IGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuaGVscGVyLmRyb3BwZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmF1dG9pZCAmJiAoYS5pc0Z1bmN0aW9uKGIuYXV0b2lkKSA/IHYgPSBiLmF1dG9pZC5jYWxsKHRoaXMsIGYpIDogKHYgPSBNYXRoLmNlaWwoMUUzICogTWF0aC5yYW5kb20oKSksIHYgPSBiLmF1dG9pZHByZWZpeCArIHYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGEuamdyaWQuanFJRCh0aGlzLmlkKSkuanFHcmlkKCJhZGRSb3dEYXRhIiwgdiwgZiwgYi5kcm9wcG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vbmRyb3AgJiYgYS5pc0Z1bmN0aW9uKGIub25kcm9wKSAmJiBiLm9uZHJvcC5jYWxsKHRoaXMsIGMsIGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIuZHJvcF9vcHRzIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbnN0YXJ0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbnN0b3A6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZWRyb3A6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZHJvcDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcF9vcHRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVDbGFzczogInVpLXN0YXRlLWFjdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3ZlckNsYXNzOiAidWktc3RhdGUtaG92ZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdfb3B0czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0OiAiaW52YWxpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXI6ICJjbG9uZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6ICJtb3ZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFRvOiAiI2pxZ3JpZF9kbmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA1RTMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2NvcHk6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wYnluYW1lOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHBvczogImZpcnN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b2lkOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b2lkcHJlZml4OiAiZG5kXyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBiIHx8IHt9KSwgYi5jb25uZWN0V2l0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIuY29ubmVjdFdpdGggPSBiLmNvbm5lY3RXaXRoLnNwbGl0KCIsIiksIGIuY29ubmVjdFdpdGggPSBhLm1hcChiLmNvbm5lY3RXaXRoLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS50cmltKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhLmRhdGEobCwgImRuZCIsIGIpLCAwID09PSBsLnAucmVjY291bnQgfHwgbC5wLmpxZ2RuZCB8fCBjKCksIGwucC5qcWdkbmQgPSAhMCwgZCA9IDA7IGQgPCBiLmNvbm5lY3RXaXRoLmxlbmd0aDsgZCsrKSBnID0gYi5jb25uZWN0V2l0aFtkXSwgYShnKS5kcm9wcGFibGUoYS5pc0Z1bmN0aW9uKGIuZHJvcCkgPyBiLmRyb3AuY2FsbChhKGwpLCBiKSA6IGIuZHJvcCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ3JpZFJlc2l6ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhLmpncmlkLmpxSUQoYy5wLmlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGc7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZ3JpZCAmJiBhLmZuLnJlc2l6YWJsZSAmJiAoKGIgPSBhLmV4dGVuZCh7fSwgYiB8fCB7fSksIGIuYWxzb1Jlc2l6ZSA/IChiLl9hbHNvUmVzaXplXyA9IGIuYWxzb1Jlc2l6ZSwgZGVsZXRlIGIuYWxzb1Jlc2l6ZSkgOiBiLl9hbHNvUmVzaXplXyA9ICExLCBiLnN0b3AgJiYgYS5pc0Z1bmN0aW9uKGIuc3RvcCkgPyAoYi5fc3RvcF8gPSBiLnN0b3AsIGRlbGV0ZSBiLnN0b3ApIDogYi5fc3RvcF8gPSAhMSwgYi5zdG9wID0gZnVuY3Rpb24obCwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGEoIiNndmlld18iICsgZCArICIgLnVpLWpxZ3JpZC1iZGl2IikuaGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5qcUdyaWQoInNldEdyaWRXaWR0aCIsIGUuc2l6ZS53aWR0aCwgYi5zaHJpbmtUb0ZpdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLl9zdG9wXyAmJiBiLl9zdG9wXy5jYWxsKGMsIGwsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5wLmNhcHRpb24gJiYgYSgiI2dib3hfIiArIGQpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiYXV0byIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5wLmZyb3plbkNvbHVtbnMgJiYgKGcgJiYgY2xlYXJUaW1lb3V0KGcpLCBnID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIGNsZWFyVGltZW91dChnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGQpLmpxR3JpZCgiZGVzdHJveUZyb3plbkNvbHVtbnMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArIGQpLmpxR3JpZCgic2V0RnJvemVuQ29sdW1ucyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgYi5fYWxzb1Jlc2l6ZV8pID8gYi5hbHNvUmVzaXplID0gZXZhbCgiKCIgKyAoInsnI2d2aWV3XyIgKyBkICsgIiAudWktanFncmlkLWJkaXYnOnRydWUsJyIgKyBiLl9hbHNvUmVzaXplXyArICInOnRydWV9IikgKyAiKSIpIDogYi5hbHNvUmVzaXplID0gYSgiLnVpLWpxZ3JpZC1iZGl2IiwgIiNndmlld18iICsgZCksIGRlbGV0ZSBiLl9hbHNvUmVzaXplXywgYSgiI2dib3hfIiArIGQpLnJlc2l6YWJsZShiKSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5hc3NvY0FycmF5U2l6ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiLCBjID0gMDsKICAgICAgICAgICAgICAgIGZvciAoYiBpbiBhKSBhLmhhc093blByb3BlcnR5KGIpICYmIGMrKzsKICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuamdyaWQuZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHBpdm90U2V0dXA6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBuID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cGluZ1ZpZXc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cEZpZWxkOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cFN1bW1hcnk6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwU3VtbWFyeVBvczogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgciA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBxID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93VG90YWxzOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1RvdGFsc1RleHQ6ICJUb3RhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xUb3RhbHM6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBTdW1tYXJ5OiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwU3VtbWFyeVBvczogImhlYWRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm96ZW5TdGF0aWNDb2xzOiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKGEsIGIsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPSBwLmNhbGwoYSwgYiwgZCksIDAgPCBlLmxlbmd0aCA/IGVbMF0gOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG0oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmhhc093blByb3BlcnR5KGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhW2NdICE9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2RdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkKyssIGQgPj0gdGhpcy5sZW5ndGgpIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgJiYgKEQgPSBiKSwgZQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB5KGIsIGMsIGQsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBoLCBtLCBsLCB3ID0gYy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNBcnJheShkKSA/IChsID0gZC5sZW5ndGgsIGsgPSBkKSA6IChsID0gMSwga1swXSA9IGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5yb290ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuX2NvdW50ID8gZi5fY291bnQrKyA6IGYuX2NvdW50ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IDA7IGwgPiBtOyBtKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSwgciA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IHcgPiBnOyBnKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZCkgdSA9IGggPSBhLnRyaW0oY1tnXS5tZW1iZXIpICsgIl8iICsgY1tnXS5hZ2dyZWdhdG9yLCBrWzBdID0gY1tnXS5sYWJlbCB8fCBjW2ddLmFnZ3JlZ2F0b3IgKyAiICIgKyBhLnRyaW0oY1tnXS5tZW1iZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBkW21dLnJlcGxhY2UoL1xzKy9nLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSAxID09PSB3ID8gcSArIHUgOiBxICsgdSArICJfIiArIGNbZ10uYWdncmVnYXRvciArICJfIiArIFN0cmluZyhnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoeikge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtbbV0gPSBkW21dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBoID0gaXNOYU4ocGFyc2VJbnQoaCwgMTApKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoIDogaCArICIgIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEIgPSByLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gZltoXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBjW2ddLm1lbWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IGYuX2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSyA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjW2ddLmFnZ3JlZ2F0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN1bSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSyA9IHBhcnNlRmxvYXQoeCB8fCAwKSArIHBhcnNlRmxvYXQoQVt2XSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvdW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIiAhPT0geCAmJiBudWxsICE9IHggfHwgKHggPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gQS5oYXNPd25Qcm9wZXJ0eSh2KSA/IHggKyAxIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1pbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSyA9ICIiID09PSB4IHx8IG51bGwgPT0geCA/IHBhcnNlRmxvYXQoQVt2XSB8fCAwKSA6IE1hdGgubWluKHBhcnNlRmxvYXQoeCksIHBhcnNlRmxvYXQoQVt2XSB8fCAwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtYXgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsgPSAiIiA9PT0geCB8fCBudWxsID09IHggPyBwYXJzZUZsb2F0KEFbdl0gfHwgMCkgOiBNYXRoLm1heChwYXJzZUZsb2F0KHgpLCBwYXJzZUZsb2F0KEFbdl0gfHwgMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYXZnIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLID0gKHBhcnNlRmxvYXQoeCB8fCAwKSAqIChDIC0gMSkgKyBwYXJzZUZsb2F0KEFbdl0gfHwgMCkpIC8gQwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZbeV0gPSBCW3BdID0gSzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSA+PSBtICYmICJfcl9Ub3RhbHMiICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSAmJiAiIiA9PT0gcSAmJiAocSA9IHUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVbaF0gPSByOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5baF0gPSBrW21dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB2KGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBjLCBlLCBmLCBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlIGluIGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJvYmplY3QiICE9IHR5cGVvZiBhW2VdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImxldmVsIiA9PT0gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IFNbYS5sZXZlbF0gJiYgKFNbYS5sZXZlbF0gPSAiIiwgMCA8IGEubGV2ZWwgJiYgLTEgPT09IGEudGV4dC5pbmRleE9mKCJfcl9Ub3RhbHMiKSAmJiAoclthLmxldmVsIC0gMV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VDb2xTcGFuU3R5bGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXJzOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksIFNbYS5sZXZlbF0gIT09IGEudGV4dCAmJiBhLmNoaWxkcmVuLmxlbmd0aCAmJiAtMSA9PT0gYS50ZXh0LmluZGV4T2YoIl9yX1RvdGFscyIpICYmIDAgPCBhLmxldmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJbYS5sZXZlbCAtIDFdLmdyb3VwSGVhZGVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlVGV4dDogYS5sYWJlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlck9mQ29sdW1uczogMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJbYS5sZXZlbCAtIDFdLmdyb3VwSGVhZGVycy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gMCA9PT0gYyA/IFYgOiBBYSArIEU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmxldmVsIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPT09IChxLnJvd1RvdGFscyA/IDEgOiAwKSAmJiAwIDwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDAsIGwgPSAwOyBjID4gbDsgbCsrKSBtICs9IHJbYS5sZXZlbCAtIDFdLmdyb3VwSGVhZGVyc1tsXS5udW1iZXJPZkNvbHVtbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtICYmIChnID0gbSArIHgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFtnXSAmJiAoclthLmxldmVsIC0gMV0uZ3JvdXBIZWFkZXJzW2NdLnN0YXJ0Q29sdW1uTmFtZSA9IGRbZ10ubmFtZSwgclthLmxldmVsIC0gMV0uZ3JvdXBIZWFkZXJzW2NdLm51bWJlck9mQ29sdW1ucyA9IGQubGVuZ3RoIC0gZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFhID0gZC5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1thLmxldmVsXSA9IGEudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEubGV2ZWwgPT09IEggJiYgImxldmVsIiA9PT0gZSAmJiAwIDwgSCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA8IEUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiBpbiBhLmZpZWxkcykgYS5maWVsZHMuaGFzT3duUHJvcGVydHkoYikgJiYgKDEgPT09IGMgJiYgcltIIC0gMV0uZ3JvdXBIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2x1bW5OYW1lOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyT2ZDb2x1bW5zOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVUZXh0OiBhLmxhYmVsIHx8IGEudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgYysrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcltIIC0gMV0uZ3JvdXBIZWFkZXJzW3JbSCAtIDFdLmdyb3VwSGVhZGVycy5sZW5ndGggLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMV0ubnVtYmVyT2ZDb2x1bW5zID0gYyAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugci5zcGxpY2UoSCAtIDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gYVtlXSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgYVtlXSAmJiB2KGFbZV0pLCAibGV2ZWwiID09PSBlICYmIDAgPCBhLmxldmVsICYmIChhLmxldmVsID09PSAoMCA9PT0gSCA/IGEubGV2ZWwgOiBIKSB8fCAtMSAhPT0gU1thLmxldmVsXS5pbmRleE9mKCJfcl9Ub3RhbHMiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgaW4gYyA9IDAsIGEuZmllbGRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmZpZWxkcy5oYXNPd25Qcm9wZXJ0eShiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiBpbiBxLmFnZ3JlZ2F0ZXNbY10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocS5hZ2dyZWdhdGVzW2NdLmhhc093blByb3BlcnR5KGYpKSBzd2l0Y2ggKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtZW1iZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxhYmVsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhZ2dyZWdhdG9yIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1tmXSA9IHEuYWdncmVnYXRlc1tjXVtmXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxIDwgRSA/IChnLm5hbWUgPSBiLCBnLmxhYmVsID0gcS5hZ2dyZWdhdGVzW2NdLmxhYmVsIHx8IGEubGFiZWwpIDogKGcubmFtZSA9IGEudGV4dCwgZy5sYWJlbCA9ICJfcl9Ub3RhbHMiID09PSBhLnRleHQgPyBxLnJvd1RvdGFsc1RleHQgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucHVzaChnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYysrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgQywgRCwgQSwgeCwgSCwgRSwgTiwgTCA9IGIubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHEucm93VG90YWxzICYmIDAgPCBxLnlEaW1lbnNpb24ubGVuZ3RoICYmIChxLnlEaW1lbnNpb24uc3BsaWNlKDAsIDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFOYW1lOiBxLnlEaW1lbnNpb25bMF0uZGF0YU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSksIHEueURpbWVuc2lvblswXS5jb252ZXJ0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiX3JfVG90YWxzIgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggPSBhLmlzQXJyYXkocS54RGltZW5zaW9uKSA/IHEueERpbWVuc2lvbi5sZW5ndGggOiAwLCBIID0gcS55RGltZW5zaW9uLmxlbmd0aCwgRSA9IGEuaXNBcnJheShxLmFnZ3JlZ2F0ZXMpID8gcS5hZ2dyZWdhdGVzLmxlbmd0aCA6IDAsIDAgPT09IHggfHwgMCA9PT0gRSkgdGhyb3cgInhEaW1lbnNpb24gb3IgYWdncmVnYXRlcyBvcHRpb25hIGFyZSBub3Qgc2V0ISI7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBHOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKEEgPSAwOyB4ID4gQTsgQSsrKSBHID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHEueERpbWVuc2lvbltBXS5kYXRhTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm96ZW46IHEuZnJvemVuU3RhdGljQ29scwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCA9PSBxLnhEaW1lbnNpb25bQV0uaXNHcm91cEZpZWxkICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocS54RGltZW5zaW9uW0FdLmlzR3JvdXBGaWVsZCA9ICEwKSwgRyA9IGEuZXh0ZW5kKCEwLCBHLCBxLnhEaW1lbnNpb25bQV0pLCBkLnB1c2goRyk7CiAgICAgICAgICAgICAgICAgICAgICAgIEcgPSB4IC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgRiA9IHt9OyBMID4gSjspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBiW0pdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEkgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIElbQV0gPSBhLnRyaW0oQ1txLnhEaW1lbnNpb25bQV0uZGF0YU5hbWVdKSwgTltxLnhEaW1lbnNpb25bQV0uZGF0YU5hbWVdID0gSVtBXSwgQSsrOyB3aGlsZSAoeCA+IEEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIE8gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEQgPSAtMSwgQSA9IGMoZywgbSwgSSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA8PSBEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPID0gMCwgMSA8PSBIKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKE8gPSAwOyBIID4gTzsgTysrKSBNW09dID0gYS50cmltKENbcS55RGltZW5zaW9uW09dLmRhdGFOYW1lXSksIHEueURpbWVuc2lvbltPXS5jb252ZXJ0ZXIgJiYgYS5pc0Z1bmN0aW9uKHEueURpbWVuc2lvbltPXS5jb252ZXJ0ZXIpICYmIChNW09dID0gcS55RGltZW5zaW9uW09dLmNvbnZlcnRlci5jYWxsKHRoaXMsIE1bT10sIEksIE0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSB5KEMsIHEuYWdncmVnYXRlcywgTSwgQSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIDAgPT09IEggJiYgKEEgPSB5KEMsIHEuYWdncmVnYXRlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsIEEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1tEXSA9IEEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPID0gMCwgMSA8PSBIKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoTyA9IDA7IEggPiBPOyBPKyspIE1bT10gPSBhLnRyaW0oQ1txLnlEaW1lbnNpb25bT10uZGF0YU5hbWVdKSwgcS55RGltZW5zaW9uW09dLmNvbnZlcnRlciAmJiBhLmlzRnVuY3Rpb24ocS55RGltZW5zaW9uW09dLmNvbnZlcnRlcikgJiYgKE1bT10gPSBxLnlEaW1lbnNpb25bT10uY29udmVydGVyLmNhbGwodGhpcywgTVtPXSwgSSwgTSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOID0geShDLCBxLmFnZ3JlZ2F0ZXMsIE0sIE4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIDAgPT09IEggJiYgKE4gPSB5KEMsIHEuYWdncmVnYXRlcywgbnVsbCwgTikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucHVzaChOKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBOID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoUCBpbiBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmhhc093blByb3BlcnR5KFApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBDKSBGLmNoaWxkcmVuICYmIHZvaWQgMCAhPT0gRi5jaGlsZHJlbiB8fCAoRiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBQCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBOID0gRi5jaGlsZHJlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoQSA9IDA7IEEgPCBOLmxlbmd0aDsgQSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChOW0FdLnRleHQgPT09IFApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA9IE5bQV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiA9IEkuY2hpbGRyZW4gOiAoTi5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBQLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogQywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiBlW1BdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbltQXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBOID0gTltOLmxlbmd0aCAtIDFdLmNoaWxkcmVuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMrKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEorKwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBTID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBYSA9IGQubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgViA9IEFhOwogICAgICAgICAgICAgICAgICAgICAgICAwIDwgSCAmJiAocltIIC0gMV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VDb2xTcGFuU3R5bGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXJzOiBbXQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdihGKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHEuY29sVG90YWxzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChKID0gZy5sZW5ndGg7IEotLTspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChBID0geDsgQSA8IGQubGVuZ3RoOyBBKyspIEwgPSBkW0FdLm5hbWUsIGxbTF0gPyBsW0xdICs9IHBhcnNlRmxvYXQoZ1tKXVtMXSB8fCAwKSA6IGxbTF0gPSBwYXJzZUZsb2F0KGdbSl1bTF0gfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwIDwgRykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoQSA9IDA7IEcgPiBBOyBBKyspIGRbQV0uaXNHcm91cEZpZWxkICYmIChrLmdyb3VwaW5nVmlldy5ncm91cEZpZWxkLnB1c2goZFtBXS5uYW1lKSwgay5ncm91cGluZ1ZpZXcuZ3JvdXBTdW1tYXJ5LnB1c2gocS5ncm91cFN1bW1hcnkpLCBrLmdyb3VwaW5nVmlldy5ncm91cFN1bW1hcnlQb3MucHVzaChxLmdyb3VwU3VtbWFyeVBvcykpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGsuZ3JvdXBpbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgay5zb3J0bmFtZSA9IGRbR10ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgay5ncm91cGluZ1ZpZXcuaGlkZUZpcnN0R3JvdXBDb2wgPSAhMAogICAgICAgICAgICAgICAgICAgIH0pLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbE1vZGVsOiBkLAogICAgICAgICAgICAgICAgICAgICAgICByb3dzOiBnLAogICAgICAgICAgICAgICAgICAgICAgICBncm91cE9wdGlvbnM6IGssCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZGVyczogciwKICAgICAgICAgICAgICAgICAgICAgICAgc3VtbWFyeTogbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBqcVBpdm90OiBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gbChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZywgbCA9IGpRdWVyeShlKS5qcUdyaWQoInBpdm90U2V0dXAiLCBiLCBjKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gMCA8IGEuYXNzb2NBcnJheVNpemUobC5zdW1tYXJ5KSA/ICEwIDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEuamdyaWQuZnJvbS5jYWxsKGUsIGwucm93cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmlnbm9yZUNhc2UgJiYgKGsgPSBrLmlnbm9yZUNhc2UoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgbC5ncm91cE9wdGlvbnMuZ3JvdXBpbmdWaWV3Lmdyb3VwRmllbGQubGVuZ3RoOyBiKyspIGYgPSBjLnhEaW1lbnNpb25bYl0uc29ydG9yZGVyID8gYy54RGltZW5zaW9uW2JdLnNvcnRvcmRlciA6ICJhc2MiLCBnID0gYy54RGltZW5zaW9uW2JdLnNvcnR0eXBlID8gYy54RGltZW5zaW9uW2JdLnNvcnR0eXBlIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGV4dCIsIGsub3JkZXJCeShsLmdyb3VwT3B0aW9ucy5ncm91cGluZ1ZpZXcuZ3JvdXBGaWVsZFtiXSwgZiwgZywgIiIsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGMueERpbWVuc2lvbi5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLmdyb3VwT3B0aW9ucy5zb3J0bmFtZSAmJiBiICYmIChmID0gYy54RGltZW5zaW9uW2IgLSAxXS5zb3J0b3JkZXIgPyBjLnhEaW1lbnNpb25bYiAtIDFdLnNvcnRvcmRlciA6ICJhc2MiLCBnID0gYy54RGltZW5zaW9uW2IgLSAxXS5zb3J0dHlwZSA/IGMueERpbWVuc2lvbltiIC0gMV0uc29ydHR5cGUgOiAidGV4dCIsIGsub3JkZXJCeShsLmdyb3VwT3B0aW9ucy5zb3J0bmFtZSwgZiwgZywgIiIsIGcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeShlKS5qcUdyaWQoYS5leHRlbmQoITAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXN0cjogYS5leHRlbmQoay5zZWxlY3QoKSwgdyA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJkYXRhOiBsLnN1bW1hcnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXR5cGU6ICJqc29uc3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVycm93OiB3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyRGF0YU9uRm9vdGVyOiB3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xNb2RlbDogbC5jb2xNb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld3JlY29yZHM6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0bmFtZTogYy54RGltZW5zaW9uWzBdLmRhdGFOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgbC5ncm91cE9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCB8fCB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGwuZ3JvdXBIZWFkZXJzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBmLmxlbmd0aDsgYisrKSBmW2JdICYmIGZbYl0uZ3JvdXBIZWFkZXJzLmxlbmd0aCAmJiBqUXVlcnkoZSkuanFHcmlkKCJzZXRHcm91cEhlYWRlcnMiLCBmW2JdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuZnJvemVuU3RhdGljQ29scyAmJiBqUXVlcnkoZSkuanFHcmlkKCJzZXRGcm96ZW5Db2x1bW5zIikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBiID8gYS5hamF4KGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbChhLmpncmlkLmdldEFjY2Vzc29yKGIsIGcgJiYgZy5yZWFkZXIgPyBnLnJlYWRlciA6ICJyb3dzIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGcgfHwge30pKSA6IGwoYikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5qZ3JpZC5leHRlbmQoewogICAgICAgICAgICAgICAgc2V0U3ViR3JpZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGM7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhLmpncmlkLnN0eWxlVUlbdGhpcy5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uc3ViZ3JpZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5zdWJHcmlkT3B0aW9ucyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGx1c2ljb246IGMuaWNvbl9wbHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnVzaWNvbjogYy5pY29uX21pbnVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5pY29uOiBjLmljb25fb3BlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRPbkxvYWQ6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5T25Mb2FkOiA1MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RPbkV4cGFuZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0T25Db2xsYXBzZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsb2FkT25FeHBhbmQ6ICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLnAuc3ViR3JpZE9wdGlvbnMgfHwge30pLCB0aGlzLnAuY29sTmFtZXMudW5zaGlmdCgiIiksIHRoaXMucC5jb2xNb2RlbC51bnNoaWZ0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAic3ViZ3JpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGEuamdyaWQuY2VsbF93aWR0aCA/IHRoaXMucC5zdWJHcmlkV2lkdGggKyB0aGlzLnAuY2VsbExheW91dCA6IHRoaXMucC5zdWJHcmlkV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZWRsZzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXhlZDogITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBiID0gdGhpcy5wLnN1YkdyaWRNb2RlbCwgYlswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYlswXS5hbGlnbiA9IGEuZXh0ZW5kKFtdLCBiWzBdLmFsaWduIHx8IFtdKSwgYyA9IDA7IGMgPCBiWzBdLm5hbWUubGVuZ3RoOyBjKyspIGJbMF0uYWxpZ25bY10gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJbMF0uYWxpZ25bY10gfHwgImxlZnQiCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhZGRTdWJHcmlkQ2VsbDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkLCBnLCBsLCBlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuZm9ybWF0Q29sKGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5wLmlkOwogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5wLnN1YkdyaWRPcHRpb25zLnBsdXNpY29uOwogICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5zdHlsZVVJW3RoaXMucC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmNvbW1vbgogICAgICAgICAgICAgICAgICAgIH0pLCAnPHRkIHJvbGU9ImdyaWRjZWxsIiBhcmlhLWRlc2NyaWJlZGJ5PSInICsgZyArICdfc3ViZ3JpZCIgY2xhc3M9InVpLXNnY29sbGFwc2VkIHNnY29sbGFwc2VkIiAnICsgZSArICI+PGEgc3R5bGU9J2N1cnNvcjpwb2ludGVyOycgY2xhc3M9J3VpLXNnaHJlZic+PHNwYW4gY2xhc3M9JyIgKyBsLmljb25fYmFzZSArICIgIiArIGQgKyAiJz48L3NwYW4+PC9hPjwvdGQ+IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFkZFN1YkdyaWQ6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLmdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnLCBsLCBlLCBuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGssIHIgPSBhLmpncmlkLnN0eWxlVUlbZC5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uYmFzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gYS5qZ3JpZC5zdHlsZVVJW2QucC5zdHlsZVVJIHx8ICJqUXVlcnlVSSJdLmNvbW1vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gZnVuY3Rpb24oYiwgYywgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSgiPHRkIGFsaWduPSciICsgZC5wLnN1YkdyaWRNb2RlbFswXS5hbGlnbltlXSArICInPjwvdGQ+IikuaHRtbChjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5hcHBlbmQoYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBmLCBnLCBtID0gYSgiPHRhYmxlIGNsYXNzPSciICsgci5yb3dUYWJsZSArICIgdWktY29tbW9uLXRhYmxlJz48dGJvZHk+PC90Ym9keT48L3RhYmxlPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoIjx0cj48L3RyPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgZC5wLnN1YkdyaWRNb2RlbFswXS5uYW1lLmxlbmd0aDsgZisrKSBlID0gYSgiPHRoIGNsYXNzPSciICsgci5oZWFkZXJCb3ggKyAiIHVpLXRoLXN1YmdyaWQgdWktdGgtY29sdW1uIHVpLXRoLSIgKyBkLnAuZGlyZWN0aW9uICsgIic+PC90aD4iKSwgYShlKS5odG1sKGQucC5zdWJHcmlkTW9kZWxbMF0ubmFtZVtmXSksIGEoZSkud2lkdGgoZC5wLnN1YkdyaWRNb2RlbFswXS53aWR0aFtmXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGwpLmFwcGVuZChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShtKS5hcHBlbmQobCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgKGcgPSBkLnAueG1sUmVhZGVyLnN1YmdyaWQsIGEoZy5yb290ICsgIiAiICsgZy5yb3csIGIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobCA9IGEoIjx0ciBjbGFzcz0nIiArIHEuY29udGVudCArICIgdWktc3VidGJsY2VsbCc+PC90cj4iKSwgITAgPT09IGcucmVwZWF0aXRlbXMpIGEoZy5jZWxsLCB0aGlzKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1KGwsIGEodGhpcykudGV4dCgpIHx8ICImIzE2MDsiLCBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGQucC5zdWJHcmlkTW9kZWxbMF0ubWFwcGluZyB8fCBkLnAuc3ViR3JpZE1vZGVsWzBdLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBiLmxlbmd0aDsgZisrKSB1KGwsIGEoYltmXSwgdGhpcykudGV4dCgpIHx8ICImIzE2MDsiLCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShtKS5hcHBlbmQobCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYSgidGFibGU6Zmlyc3QiLCBkLmdyaWQuYkRpdikuYXR0cigiaWQiKSArICJfIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGUgKyBjKSkuYXBwZW5kKG0pLCBkLmdyaWQuaERpdi5sb2FkaW5nID0gITEsIGEoIiNsb2FkXyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5qcUlEKGQucC5pZCkpLmhpZGUoKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBmLCBnLCBtLCBsLCB3ID0gYSgiPHRhYmxlIGNsYXNzPSciICsgci5yb3dUYWJsZSArICIgdWktY29tbW9uLXRhYmxlJz48dGJvZHk+PC90Ym9keT48L3RhYmxlPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGEoIjx0cj48L3RyPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgZC5wLnN1YkdyaWRNb2RlbFswXS5uYW1lLmxlbmd0aDsgZysrKSBlID0gYSgiPHRoIGNsYXNzPSciICsgci5oZWFkZXJCb3ggKyAiIHVpLXRoLXN1YmdyaWQgdWktdGgtY29sdW1uIHVpLXRoLSIgKyBkLnAuZGlyZWN0aW9uICsgIic+PC90aD4iKSwgYShlKS5odG1sKGQucC5zdWJHcmlkTW9kZWxbMF0ubmFtZVtnXSksIGEoZSkud2lkdGgoZC5wLnN1YkdyaWRNb2RlbFswXS53aWR0aFtnXSksIGEobikuYXBwZW5kKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSh3KS5hcHBlbmQobiksIGIgJiYgKG0gPSBkLnAuanNvblJlYWRlci5zdWJncmlkLCBmID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCBtLnJvb3QpLCB2b2lkIDAgIT09IGYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGYubGVuZ3RoOyBnKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZbZ10sIG4gPSBhKCI8dHIgY2xhc3M9JyIgKyBxLmNvbnRlbnQgKyAiIHVpLXN1YnRibGNlbGwnPjwvdHI+IiksICEwID09PSBtLnJlcGVhdGl0ZW1zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKG0uY2VsbCAmJiAoZSA9IGVbbS5jZWxsXSksIGwgPSAwOyBsIDwgZS5sZW5ndGg7IGwrKykgdShuLCBlW2xdIHx8ICImIzE2MDsiLCBsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBkLnAuc3ViR3JpZE1vZGVsWzBdLm1hcHBpbmcgfHwgZC5wLnN1YkdyaWRNb2RlbFswXS5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoay5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGwgPSAwOyBsIDwgay5sZW5ndGg7IGwrKykgdShuLCBlW2tbbF1dIHx8ICImIzE2MDsiLCBsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHcpLmFwcGVuZChuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYSgidGFibGU6Zmlyc3QiLCBkLmdyaWQuYkRpdikuYXR0cigiaWQiKSArICJfIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIiMiICsgYS5qZ3JpZC5qcUlEKGYgKyBjKSkuYXBwZW5kKHcpLCBkLmdyaWQuaERpdi5sb2FkaW5nID0gITEsIGEoIiNsb2FkXyIgKyBhLmpncmlkLmpxSUQoZC5wLmlkKSkuaGlkZSgpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGUsIGYsIGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYShiKS5hdHRyKCJpZCIpLCBlID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5kXzogKG5ldyBEYXRlKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2QucC5wcm1OYW1lcy5zdWJncmlkaWRdID0gYywgIWQucC5zdWJHcmlkTW9kZWxbMF0pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQucC5zdWJHcmlkTW9kZWxbMF0ucGFyYW1zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGQucC5zdWJHcmlkTW9kZWxbMF0ucGFyYW1zLmxlbmd0aDsgZysrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBkLnAuY29sTW9kZWwubGVuZ3RoOyBmKyspIGQucC5jb2xNb2RlbFtmXS5uYW1lID09PSBkLnAuc3ViR3JpZE1vZGVsWzBdLnBhcmFtc1tnXSAmJiAoZVtkLnAuY29sTW9kZWxbZl0ubmFtZV0gPSBhKCJ0ZDplcSgiICsgZiArICIpIiwgYikudGV4dCgpLnJlcGxhY2UoL1wmIzE2MFw7L2dpLCAiIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWQuZ3JpZC5oRGl2LmxvYWRpbmcpIHN3aXRjaCAoZC5ncmlkLmhEaXYubG9hZGluZyA9ICEwLCBhKCIjbG9hZF8iICsgYS5qZ3JpZC5qcUlEKGQucC5pZCkpLnNob3coKSwgZC5wLnN1YmdyaWR0eXBlIHx8IChkLnAuc3ViZ3JpZHR5cGUgPSBkLnAuZGF0YXR5cGUpLCBhLmlzRnVuY3Rpb24oZC5wLnN1YmdyaWR0eXBlKSA/IGQucC5zdWJncmlkdHlwZS5jYWxsKGQsIGUpIDogZC5wLnN1YmdyaWR0eXBlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5zdWJncmlkdHlwZS50b0xvd2VyQ2FzZSgpLCBkLnAuc3ViZ3JpZHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInhtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJqc29uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmFqYXgoYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBkLnAubXR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYS5pc0Z1bmN0aW9uKGQucC5zdWJHcmlkVXJsKSA/IGQucC5zdWJHcmlkVXJsLmNhbGwoZCwgZSkgOiBkLnAuc3ViR3JpZFVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IGQucC5zdWJncmlkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYS5pc0Z1bmN0aW9uKGQucC5zZXJpYWxpemVTdWJHcmlkRGF0YSkgPyBkLnAuc2VyaWFsaXplU3ViR3JpZERhdGEuY2FsbChkLCBlKSA6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieG1sIiA9PT0gZC5wLnN1YmdyaWR0eXBlID8geihiLnJlc3BvbnNlWE1MLCBjKSA6IHkoYS5qZ3JpZC5wYXJzZShiLnJlc3BvbnNlVGV4dCksIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmpncmlkLmFqYXhPcHRpb25zLCBkLnAuYWpheFN1YmdyaWRPcHRpb25zIHx8IHt9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGQucC5jb2xNb2RlbCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgIT09IHRoaXMuaGlkZGVuICYmICJybiIgIT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSAmJiAiY2IiICE9PSB0aGlzLm5hbWUgfHwgdisrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEID0gZC5yb3dzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodm9pZCAwICE9PSBjICYmIDAgPCBjICYmIChBID0gYywgRCA9IGMgKyAxKTsgRCA+IEE7KSBhKGQucm93c1tBXSkuaGFzQ2xhc3MoImpxZ3JvdyIpICYmIChkLnAuc2Nyb2xsICYmIGEoZC5yb3dzW0FdLmNlbGxzW2JdKS51bmJpbmQoImNsaWNrIiksIGEoZC5yb3dzW0FdLmNlbGxzW2JdKS5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKS5wYXJlbnQoInRyIilbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwgPSBkLnAuaWQsIGcgPSBjLmlkLCBrID0gYSgiIyIgKyBsICsgIl8iICsgZyArICJfZXhwYW5kZWRDb250ZW50IiksIGEodGhpcykuaGFzQ2xhc3MoInNnY29sbGFwc2VkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4gPSBhKGQpLnRyaWdnZXJIYW5kbGVyKCJqcUdyaWRTdWJHcmlkQmVmb3JlRXhwYW5kIiwgW2wgKyAiXyIgKyBnLCBnXSksIG4gPSAhMSA9PT0gbiB8fCAic3RvcCIgPT09IG4gPyAhMSA6ICEwLCBuICYmIGEuaXNGdW5jdGlvbihkLnAuc3ViR3JpZEJlZm9yZUV4cGFuZCkgJiYgKG4gPSBkLnAuc3ViR3JpZEJlZm9yZUV4cGFuZC5jYWxsKGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCArICJfIiArIGcsIGcpKSwgITEgPT09IG4pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGQucC5zdWJHcmlkT3B0aW9ucy5yZWxvYWRPbkV4cGFuZCB8fCAhMSA9PT0gZC5wLnN1YkdyaWRPcHRpb25zLnJlbG9hZE9uRXhwYW5kICYmICFrLmhhc0NsYXNzKCJ1aS1zdWJncmlkIikgPyAoZSA9IDEgPD0gYiA/ICI8dGQgY29sc3Bhbj0nIiArIGIgKyAiJz4mIzE2MDs8L3RkPiIgOiAiIiwgYShjKS5hZnRlcigiPHRyIHJvbGU9J3JvdycgaWQ9JyIgKyBsICsgIl8iICsgZyArICJfZXhwYW5kZWRDb250ZW50JyBjbGFzcz0ndWktc3ViZ3JpZCB1aS1zZy1leHBhbmRlZCc+IiArIGUgKyAiPHRkIGNsYXNzPSciICsgcS5jb250ZW50ICsgIiBzdWJncmlkLWNlbGwnPjxzcGFuIGNsYXNzPSciICsgcS5pY29uX2Jhc2UgKyAiICIgKyBkLnAuc3ViR3JpZE9wdGlvbnMub3Blbmljb24gKyAiJz48L3NwYW4+PC90ZD48dGQgY29sc3Bhbj0nIiArIHBhcnNlSW50KGQucC5jb2xOYW1lcy5sZW5ndGggLSAxIC0gdiwgMTApICsgIicgY2xhc3M9JyIgKyBxLmNvbnRlbnQgKyAiIHN1YmdyaWQtZGF0YSc+PGRpdiBpZD0iICsgbCArICJfIiArIGcgKyAiIGNsYXNzPSd0YWJsZWRpdic+PC9kaXY+PC90ZD48L3RyPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkKS50cmlnZ2VySGFuZGxlcigianFHcmlkU3ViR3JpZFJvd0V4cGFuZGVkIiwgW2wgKyAiXyIgKyBnLCBnXSksIGEuaXNGdW5jdGlvbihkLnAuc3ViR3JpZFJvd0V4cGFuZGVkKSA/IGQucC5zdWJHcmlkUm93RXhwYW5kZWQuY2FsbChkLCBsICsgIl8iICsgZywgZykgOiBwKGMpKSA6IGsuc2hvdygpLnJlbW92ZUNsYXNzKCJ1aS1zZy1jb2xsYXBzZWQiKS5hZGRDbGFzcygidWktc2ctZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5odG1sKCI8YSBzdHlsZT0nY3Vyc29yOnBvaW50ZXI7JyBjbGFzcz0ndWktc2docmVmJz48c3BhbiBjbGFzcz0nIiArIHEuaWNvbl9iYXNlICsgIiAiICsgZC5wLnN1YkdyaWRPcHRpb25zLm1pbnVzaWNvbiArICInPjwvc3Bhbj48L2E+IikucmVtb3ZlQ2xhc3MoInNnY29sbGFwc2VkIikuYWRkQ2xhc3MoInNnZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wLnN1YkdyaWRPcHRpb25zLnNlbGVjdE9uRXhwYW5kICYmIGEoZCkuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYSh0aGlzKS5oYXNDbGFzcygic2dleHBhbmRlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkudHJpZ2dlckhhbmRsZXIoImpxR3JpZFN1YkdyaWRSb3dDb2xhcHNlZCIsIFtsICsgIl8iICsgZywgZ10pLCBuID0gITEgPT09IG4gfHwgInN0b3AiID09PSBuID8gITEgOiAhMCwgbiAmJiBhLmlzRnVuY3Rpb24oZC5wLnN1YkdyaWRSb3dDb2xhcHNlZCkgJiYgKG4gPSBkLnAuc3ViR3JpZFJvd0NvbGFwc2VkLmNhbGwoZCwgbCArICJfIiArIGcsIGcpKSwgITEgPT09IG4pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITAgPT09IGQucC5zdWJHcmlkT3B0aW9ucy5yZWxvYWRPbkV4cGFuZCA/IGsucmVtb3ZlKCIudWktc3ViZ3JpZCIpIDogay5oYXNDbGFzcygidWktc3ViZ3JpZCIpICYmIGsuaGlkZSgpLmFkZENsYXNzKCJ1aS1zZy1jb2xsYXBzZWQiKS5yZW1vdmVDbGFzcygidWktc2ctZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5odG1sKCI8YSBzdHlsZT0nY3Vyc29yOnBvaW50ZXI7JyBjbGFzcz0ndWktc2docmVmJz48c3BhbiBjbGFzcz0nIiArIHEuaWNvbl9iYXNlICsgIiAiICsgZC5wLnN1YkdyaWRPcHRpb25zLnBsdXNpY29uICsgIic+PC9zcGFuPjwvYT4iKS5yZW1vdmVDbGFzcygic2dleHBhbmRlZCIpLmFkZENsYXNzKCJzZ2NvbGxhcHNlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAuc3ViR3JpZE9wdGlvbnMuc2VsZWN0T25Db2xsYXBzZSAmJiBhKGQpLmpxR3JpZCgic2V0U2VsZWN0aW9uIiwgZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksIEErKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBkLnAuc3ViR3JpZE9wdGlvbnMuZXhwYW5kT25Mb2FkICYmIGEoZC5yb3dzKS5maWx0ZXIoIi5qcWdyb3ciKS5lYWNoKGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGMuY2VsbHNbMF0pLmNsaWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zdWJHcmlkWG1sID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHooYSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnN1YkdyaWRKc29uID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkoYSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXhwYW5kU3ViR3JpZFJvdzogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodGhpcy5ncmlkIHx8IGIpICYmICEwID09PSB0aGlzLnAuc3ViR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0SW5kIiwgYiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiAoYyA9IGEoInRkLnNnY29sbGFwc2VkIiwgYylbMF0pICYmIGEoYykudHJpZ2dlcigiY2xpY2siKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb2xsYXBzZVN1YkdyaWRSb3c6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuZ3JpZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIpICYmICEwID09PSB0aGlzLnAuc3ViR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0SW5kIiwgYiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiAoYyA9IGEoInRkLnNnZXhwYW5kZWQiLCBjKVswXSkgJiYgYShjKS50cmlnZ2VyKCJjbGljayIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRvZ2dsZVN1YkdyaWRSb3c6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuZ3JpZCB8fCBiKSAmJiAhMCA9PT0gdGhpcy5wLnN1YkdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKS5qcUdyaWQoImdldEluZCIsIGIsICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhKCJ0ZC5zZ2NvbGxhcHNlZCIsIGMpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPyBhKGQpLnRyaWdnZXIoImNsaWNrIikgOiAoZCA9IGEoInRkLnNnZXhwYW5kZWQiLCBjKVswXSwgZCAmJiBhKGQpLnRyaWdnZXIoImNsaWNrIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5qZ3JpZC5leHRlbmQoewogICAgICAgICAgICAgICAgc2V0VHJlZU5vZGU6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLmdyaWQgJiYgZC5wLnRyZWVHcmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZywgbCwgZSwgbiwgaywgciwgcSwgdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9IGQucC5leHBDb2xJbmQsIHkgPSBkLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZCwgcCA9IGQucC50cmVlUmVhZGVyLmxlYWZfZmllbGQsIHYgPSBkLnAudHJlZVJlYWRlci5sZXZlbF9maWVsZCwgRCA9IGQucC50cmVlUmVhZGVyLmljb25fZmllbGQsIEEgPSBkLnAudHJlZVJlYWRlci5sb2FkZWQsIHggPSBhLmpncmlkLnN0eWxlVUlbZC5wLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uY29tbW9uOyBjID4gYjspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgSDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYS5qZ3JpZC5zdHJpcFByZWYoZC5wLmlkUHJlZml4LCBkLnJvd3NbYl0uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBkLnAuZGF0YVtkLnAuX2luZGV4W2VdXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmVzdGVkIiA9PT0gZC5wLnRyZWVHcmlkTW9kZWwgJiYgKHFbcF0gfHwgKGcgPSBwYXJzZUludChxW2QucC50cmVlUmVhZGVyLmxlZnRfZmllbGRdLCAxMCksIGwgPSBwYXJzZUludChxW2QucC50cmVlUmVhZGVyLnJpZ2h0X2ZpZWxkXSwgMTApLCBxW3BdID0gbCA9PT0gZyArIDEgPyAidHJ1ZSIgOiAiZmFsc2UiLCBkLnJvd3NbYl0uY2VsbHNbZC5wLl90cmVlbGVhZnBvc10uaW5uZXJIVE1MID0gcVtwXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBwYXJzZUludChxW3ZdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gZC5wLnRyZWVfcm9vdF9sZXZlbCA/IChuID0gZSArIDEsIGsgPSBlKSA6IChuID0gZSwgayA9IGUgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gIjxkaXYgY2xhc3M9J3RyZWUtd3JhcCB0cmVlLXdyYXAtIiArIGQucC5kaXJlY3Rpb24gKyAiJyBzdHlsZT0nd2lkdGg6IiArIDE4ICogbiArICJweDsnPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciArPSAiPGRpdiBzdHlsZT0nIiArICgicnRsIiA9PT0gZC5wLmRpcmVjdGlvbiA/ICJyaWdodDoiIDogImxlZnQ6IikgKyAxOCAqIGsgKyAicHg7JyBjbGFzcz0nIiArIHguaWNvbl9iYXNlICsgIiAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gcVtBXSAmJiAocVtBXSA9ICJ0cnVlIiA9PT0gcVtBXSB8fCAhMCA9PT0gcVtBXSA/ICEwIDogITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cnVlIiA9PT0gcVtwXSB8fCAhMCA9PT0gcVtwXSA/IChyICs9ICh2b2lkIDAgIT09IHFbRF0gJiYgIiIgIT09IHFbRF0gPyBxW0RdIDogZC5wLnRyZWVJY29ucy5sZWFmKSArICIgdHJlZS1sZWFmIHRyZWVjbGljayIsIHFbcF0gPSAhMCwgdSA9ICJsZWFmIikgOiAocVtwXSA9ICExLCB1ID0gIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFbeV0gPSAoInRydWUiID09PSBxW3ldIHx8ICEwID09PSBxW3ldID8gITAgOiAhMSkgJiYgKHFbQV0gfHwgdm9pZCAwID09PSBxW0FdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByICs9ICExID09PSBxW3ldID8gITAgPT09IHFbcF0gPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJyIgOiBkLnAudHJlZUljb25zLnBsdXMgKyAiIHRyZWUtcGx1cyB0cmVlY2xpY2snIiA6ICEwID09PSBxW3BdID8gIiciIDogZC5wLnRyZWVJY29ucy5taW51cyArICIgdHJlZS1taW51cyB0cmVlY2xpY2snIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByICs9ICI+PC9kaXY+PC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQucm93c1tiXS5jZWxsc1t6XSkud3JhcElubmVyKCI8c3BhbiBjbGFzcz0nY2VsbC13cmFwcGVyIiArIHUgKyAiJz48L3NwYW4+IikucHJlcGVuZChyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlICE9PSBwYXJzZUludChkLnAudHJlZV9yb290X2xldmVsLCAxMCkgJiYgKEggPSBhKGQpLmpxR3JpZCgiaXNWaXNpYmxlTm9kZSIsIHEpLCBIIHx8IGEoZC5yb3dzW2JdKS5jc3MoImRpc3BsYXkiLCAibm9uZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGQucm93c1tiXS5jZWxsc1t6XSkuZmluZCgiZGl2LnRyZWVjbGljayIpLmJpbmQoImNsaWNrIiwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYS5qZ3JpZC5zdHJpcFByZWYoZC5wLmlkUHJlZml4LCBhKGIudGFyZ2V0IHx8IGIuc3JjRWxlbWVudCwgZC5yb3dzKS5jbG9zZXN0KCJ0ci5qcWdyb3ciKVswXS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBkLnAuX2luZGV4W2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wLmRhdGFbYl1bcF0gfHwgKGQucC5kYXRhW2JdW3ldID8gKGEoZCkuanFHcmlkKCJjb2xsYXBzZVJvdyIsIGQucC5kYXRhW2JdKSwgYShkKS5qcUdyaWQoImNvbGxhcHNlTm9kZSIsIGQucC5kYXRhW2JdKSkgOiAoYShkKS5qcUdyaWQoImV4cGFuZFJvdyIsIGQucC5kYXRhW2JdKSwgYShkKS5qcUdyaWQoImV4cGFuZE5vZGUiLCBkLnAuZGF0YVtiXSkpKSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMCA9PT0gZC5wLkV4cGFuZENvbENsaWNrICYmIGEoZC5yb3dzW2JdLmNlbGxzW3pdKS5maW5kKCJzcGFuLmNlbGwtd3JhcHBlciIpLmNzcygiY3Vyc29yIiwgInBvaW50ZXIiKS5iaW5kKCJjbGljayIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEuamdyaWQuc3RyaXBQcmVmKGQucC5pZFByZWZpeCwgYShiLnRhcmdldCB8fCBiLnNyY0VsZW1lbnQsIGQucm93cykuY2xvc2VzdCgidHIuanFncm93IilbMF0uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGQucC5faW5kZXhbYl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnAuZGF0YVtjXVtwXSB8fCAoZC5wLmRhdGFbY11beV0gPyAoYShkKS5qcUdyaWQoImNvbGxhcHNlUm93IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucC5kYXRhW2NdKSwgYShkKS5qcUdyaWQoImNvbGxhcHNlTm9kZSIsIGQucC5kYXRhW2NdKSkgOiAoYShkKS5qcUdyaWQoImV4cGFuZFJvdyIsIGQucC5kYXRhW2NdKSwgYShkKS5qcUdyaWQoImV4cGFuZE5vZGUiLCBkLnAuZGF0YVtjXSkpKSwgYShkKS5qcUdyaWQoInNldFNlbGVjdGlvbiIsIGIpLCAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIrKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2V0VHJlZUdyaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBjLCBkLCBnID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEuamdyaWQuc3R5bGVVSVtnLnAuc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS50cmVlZ3JpZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wLnRyZWVkYXRhdHlwZSB8fCBhLmV4dGVuZChnLnAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlZGF0YXR5cGU6IGcucC5kYXRhdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnAubG9hZG9uY2UgJiYgKGcucC50cmVlZGF0YXR5cGUgPSAibG9jYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucC5zdWJHcmlkID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnAuYWx0Um93cyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wLnBnYnV0dG9ucyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wLnBnaW5wdXQgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucC5ncmlkdmlldyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gZy5wLnJvd1RvdGFsICYmIChnLnAucm93TnVtID0gMUU0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucC5tdWx0aXNlbGVjdCA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wLnJvd0xpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcucC5leHBDb2xJbmQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGsuaWNvbl9wbHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImpRdWVyeVVJIiA9PT0gZy5wLnN0eWxlVUkgJiYgKGIgKz0gInJ0bCIgPT09IGcucC5kaXJlY3Rpb24gPyAidyIgOiAiZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wLnRyZWVJY29ucyA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVzOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnVzOiBrLmljb25fbWludXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhZjogay5pY29uX2xlYWYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGcucC50cmVlSWNvbnMgfHwge30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5lc3RlZCIgPT09IGcucC50cmVlR3JpZE1vZGVsID8gZy5wLnRyZWVSZWFkZXIgPSBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWxfZmllbGQ6ICJsZXZlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdF9maWVsZDogImxmdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRfZmllbGQ6ICJyZ3QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYWZfZmllbGQ6ICJpc0xlYWYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkX2ZpZWxkOiAiZXhwYW5kZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogImxvYWRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9maWVsZDogImljb24iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBnLnAudHJlZVJlYWRlcikgOiAiYWRqYWNlbmN5IiA9PT0gZy5wLnRyZWVHcmlkTW9kZWwgJiYgKGcucC50cmVlUmVhZGVyID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsX2ZpZWxkOiAibGV2ZWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfaWRfZmllbGQ6ICJwYXJlbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFmX2ZpZWxkOiAiaXNMZWFmIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWRfZmllbGQ6ICJleHBhbmRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogImxvYWRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25fZmllbGQ6ICJpY29uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGcucC50cmVlUmVhZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgaW4gZy5wLmNvbE1vZGVsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnLnAuY29sTW9kZWwuaGFzT3duUHJvcGVydHkoYykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCBpbiBiID0gZy5wLmNvbE1vZGVsW2NdLm5hbWUsIGIgIT09IGcucC5FeHBhbmRDb2x1bW4gfHwgZSB8fCAoZSA9ICEwLCBnLnAuZXhwQ29sSW5kID0gbCksIGwrKywgZy5wLnRyZWVSZWFkZXIpIGcucC50cmVlUmVhZGVyLmhhc093blByb3BlcnR5KGQpICYmIGcucC50cmVlUmVhZGVyW2RdID09PSBiICYmIG4ucHVzaChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChnLnAudHJlZVJlYWRlciwgZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYgLTEgPT09IGEuaW5BcnJheShjLCBuKSAmJiAoImxlYWZfZmllbGQiID09PSBiICYmIChnLnAuX3RyZWVsZWFmcG9zID0gbCksIGwrKywgZy5wLmNvbE5hbWVzLnB1c2goYyksIGcucC5jb2xNb2RlbC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbjogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXphYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZWRsZzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXhwYW5kUm93OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmdyaWQgJiYgYy5wLnRyZWVHcmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEoYykuanFHcmlkKCJnZXROb2RlQ2hpbGRyZW4iLCBiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYy5wLnRyZWVSZWFkZXIuZXhwYW5kZWRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGJbYy5wLmxvY2FsUmVhZGVyLmlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICExICE9PSAoYS5pc0Z1bmN0aW9uKGMucC5iZWZvcmVFeHBhbmRUcmVlR3JpZFJvdykgPyBjLnAuYmVmb3JlRXhwYW5kVHJlZUdyaWRSb3cuY2FsbChjLCBsLCBiLCBkKSA6ICEwKSAmJiAoYShkKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYy5wLmlkUHJlZml4ICsgYS5qZ3JpZC5nZXRBY2Nlc3Nvcih0aGlzLCBjLnAubG9jYWxSZWFkZXIuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYShjKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwgYikpLmNzcygiZGlzcGxheSIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2ddICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYykuanFHcmlkKCJleHBhbmRSb3ciLCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEuaXNGdW5jdGlvbihjLnAuYWZ0ZXJFeHBhbmRUcmVlR3JpZFJvdykgJiYgYy5wLmFmdGVyRXhwYW5kVHJlZUdyaWRSb3cuY2FsbChjLCBsLCBiLCBkKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sbGFwc2VSb3c6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuZ3JpZCAmJiBjLnAudHJlZUdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYShjKS5qcUdyaWQoImdldE5vZGVDaGlsZHJlbiIsIGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBjLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYltjLnAubG9jYWxSZWFkZXIuaWRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09IChhLmlzRnVuY3Rpb24oYy5wLmJlZm9yZUNvbGxhcHNlVHJlZUdyaWRSb3cpID8gYy5wLmJlZm9yZUNvbGxhcHNlVHJlZUdyaWRSb3cuY2FsbChjLCBsLCBiLCBkKSA6ICEwKSAmJiAoYShkKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYy5wLmlkUHJlZml4ICsgYS5qZ3JpZC5nZXRBY2Nlc3Nvcih0aGlzLCBjLnAubG9jYWxSZWFkZXIuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYShjKS5qcUdyaWQoImdldEdyaWRSb3dCeUlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYikpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tnXSAmJiBhKGMpLmpxR3JpZCgiY29sbGFwc2VSb3ciLCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGEuaXNGdW5jdGlvbihjLnAuYWZ0ZXJDb2xsYXBzZVRyZWVHcmlkUm93KSAmJiBjLnAuYWZ0ZXJDb2xsYXBzZVRyZWVHcmlkUm93LmNhbGwoYywgbCwgYiwgZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldFJvb3ROb2RlczogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gW107CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcsIGwsIGUgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5ncmlkICYmIGUucC50cmVlR3JpZCkgc3dpdGNoICgiYm9vbGVhbiIgIT0gdHlwZW9mIGIgJiYgKGIgPSAhMSksIGwgPSBiID8gYShlKS5qcUdyaWQoImdldFJvd0RhdGEiLCBudWxsLCAhMCkgOiBlLnAuZGF0YSwgZS5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5lc3RlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGUucC50cmVlUmVhZGVyLmxldmVsX2ZpZWxkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEobCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQodGhpc1tkXSwgMTApID09PSBwYXJzZUludChlLnAudHJlZV9yb290X2xldmVsLCAxMCkgJiYgYy5wdXNoKGIgPyBlLnAuZGF0YVtlLnAuX2luZGV4W3RoaXNbZS5wLmtleU5hbWVdXV0gOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFkamFjZW5jeSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUucC50cmVlUmVhZGVyLnBhcmVudF9pZF9maWVsZCwgYShsKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzW2ddICYmICJudWxsIiAhPT0gU3RyaW5nKHRoaXNbZ10pLnRvTG93ZXJDYXNlKCkgfHwgYy5wdXNoKGIgPyBlLnAuZGF0YVtlLnAuX2luZGV4W3RoaXNbZS5wLmtleU5hbWVdXV0gOiB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldE5vZGVEZXB0aDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgc3dpdGNoICh0aGlzLnAudHJlZUdyaWRNb2RlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibmVzdGVkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gcGFyc2VJbnQoYlt0aGlzLnAudHJlZVJlYWRlci5sZXZlbF9maWVsZF0sIDEwKSAtIHBhcnNlSW50KHRoaXMucC50cmVlX3Jvb3RfbGV2ZWwsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFkamFjZW5jeSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEodGhpcykuanFHcmlkKCJnZXROb2RlQW5jZXN0b3JzIiwgYikubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldE5vZGVQYXJlbnQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0aGlzLnAudHJlZUdyaWQpIHN3aXRjaCAodGhpcy5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5lc3RlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5wLnRyZWVSZWFkZXIucmlnaHRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzLnAudHJlZVJlYWRlci5sZXZlbF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBhcnNlSW50KGJbZF0sIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHBhcnNlSW50KGJbZ10sIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHBhcnNlSW50KGJbbF0sIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMucC5kYXRhKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpc1tsXSwgMTApID09PSBrIC0gMSAmJiBwYXJzZUludCh0aGlzW2RdLCAxMCkgPCBlICYmIHBhcnNlSW50KHRoaXNbZ10sIDEwKSA+IG4gPyAoYyA9IHRoaXMsICExKSA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYWRqYWNlbmN5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciByID0gdGhpcy5wLnRyZWVSZWFkZXIucGFyZW50X2lkX2ZpZWxkLCBxID0gdGhpcy5wLmxvY2FsUmVhZGVyLmlkLCB1ID0gdGhpcy5wLl9pbmRleFtiW3FdXTsgdS0tOykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucC5kYXRhW3VdW3FdID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5qZ3JpZC5zdHJpcFByZWYodGhpcy5wLmlkUHJlZml4LCBiW3JdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMucC5kYXRhW3VdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksIGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXROb2RlQ2hpbGRyZW46IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuZ3JpZCAmJiBkLnAudHJlZUdyaWQpIHN3aXRjaCAoZC5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5lc3RlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBkLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gZC5wLnRyZWVSZWFkZXIucmlnaHRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBkLnAudHJlZVJlYWRlci5sZXZlbF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHBhcnNlSW50KGJbZ10sIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHBhcnNlSW50KGJbbF0sIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHBhcnNlSW50KGJbZV0sIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMucC5kYXRhKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludCh0aGlzW2VdLCAxMCkgPT09IHIgKyAxICYmIHBhcnNlSW50KHRoaXNbZ10sIDEwKSA+IG4gJiYgcGFyc2VJbnQodGhpc1tsXSwgMTApIDwgayAmJiBjLnB1c2godGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFkamFjZW5jeSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHEgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnAudHJlZVJlYWRlci5wYXJlbnRfaWRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBkLnAubG9jYWxSZWFkZXIuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzLnAuZGF0YSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1txXSA9PSBhLmpncmlkLnN0cmlwUHJlZihkLnAuaWRQcmVmaXgsIGJbdV0pICYmIGMucHVzaCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldEZ1bGxUcmVlTm9kZTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gW107CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcsIGwgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGwucC50cmVlUmVhZGVyLmV4cGFuZGVkX2ZpZWxkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobC5ncmlkICYmIGwucC50cmVlR3JpZCkgc3dpdGNoICgobnVsbCA9PSBjIHx8ICJib29sZWFuIiAhPSB0eXBlb2YgYykgJiYgKGMgPSAhMSksIGwucC50cmVlR3JpZE1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJuZXN0ZWQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbC5wLnRyZWVSZWFkZXIubGVmdF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGwucC50cmVlUmVhZGVyLnJpZ2h0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gbC5wLnRyZWVSZWFkZXIubGV2ZWxfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBwYXJzZUludChiW25dLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBwYXJzZUludChiW2tdLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSBwYXJzZUludChiW3JdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcy5wLmRhdGEpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHRoaXNbcl0sIDEwKSA+PSB6ICYmIHBhcnNlSW50KHRoaXNbbl0sIDEwKSA+PSBxICYmIHBhcnNlSW50KHRoaXNbbl0sIDEwKSA8PSB1ICYmIChjICYmICh0aGlzW2VdID0gITApLCBkLnB1c2godGhpcykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhZGphY2VuY3kiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucHVzaChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBsLnAudHJlZVJlYWRlci5wYXJlbnRfaWRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gbC5wLmxvY2FsUmVhZGVyLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMucC5kYXRhKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDA7IGcgPiBiOyBiKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuamdyaWQuc3RyaXBQcmVmKGwucC5pZFByZWZpeCwgZFtiXVtwXSkgPT09IHRoaXNbeV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiAodGhpc1tlXSA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wdXNoKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSwgZAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldE5vZGVBbmNlc3RvcnM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgdGhpcy5wLnRyZWVHcmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuanFHcmlkKCJnZXROb2RlUGFyZW50IiwgYik7IGQ7KSBjLnB1c2goZCksIGQgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0Tm9kZVBhcmVudCIsIGQpCiAgICAgICAgICAgICAgICAgICAgfSksIGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1Zpc2libGVOb2RlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAhMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0Tm9kZUFuY2VzdG9ycyIsIGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA9IGMgJiYgdGhpc1tnXSwgYyA/IHZvaWQgMCA6ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksIGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc05vZGVMb2FkZWQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnAudHJlZVJlYWRlci5sZWFmX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnAudHJlZVJlYWRlci5sb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gdm9pZCAwICE9PSBiID8gdm9pZCAwICE9PSBiW2ddID8gYltnXSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYltkXSB8fCAwIDwgYSh0aGlzKS5qcUdyaWQoImdldE5vZGVDaGlsZHJlbiIsIGIpLmxlbmd0aCA/ICEwIDogITEgOiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksIGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWxvYWROb2RlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0aGlzLnAudHJlZUdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5wLmxvY2FsUmVhZGVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLnAuc2Vscm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5qcUdyaWQoImRlbENoaWxkcmVuIiwgYltjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMucC50cmVlUmVhZGVyLmV4cGFuZGVkX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnAudHJlZVJlYWRlci5wYXJlbnRfaWRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHRoaXMucC50cmVlUmVhZGVyLmxvYWRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5wLnRyZWVSZWFkZXIubGV2ZWxfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHRoaXMucC50cmVlUmVhZGVyLmxlZnRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMucC50cmVlUmVhZGVyLnJpZ2h0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBhLmpncmlkLmdldEFjY2Vzc29yKGIsIHRoaXMucC5sb2NhbFJlYWRlci5pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcSA9IGEoIiMiICsgciwgdGhpcy5ncmlkLmJEaXYpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYltjXSA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiZGl2LnRyZWVjbGljayIsIHEpLnJlbW92ZUNsYXNzKHRoaXMucC50cmVlSWNvbnMucGx1cyArICIgdHJlZS1wbHVzIikuYWRkQ2xhc3ModGhpcy5wLnRyZWVJY29ucy5taW51cyArICIgdHJlZS1taW51cyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLnRyZWVBTm9kZSA9IHEucm93SW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuZGF0YXR5cGUgPSB0aGlzLnAudHJlZWRhdGF0eXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5lc3RlZCIgPT09IHRoaXMucC50cmVlR3JpZE1vZGVsID8gYSh0aGlzKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlaWQ6IHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fbGVmdDogYltrXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbl9yaWdodDogYltwXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbl9sZXZlbDogYltlXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYSh0aGlzKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlaWQ6IHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudGlkOiBiW2ddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuX2xldmVsOiBiW2VdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnRyaWdnZXIoInJlbG9hZEdyaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJbbF0gPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuZXN0ZWQiID09PSB0aGlzLnAudHJlZUdyaWRNb2RlbCA/IGEodGhpcykuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vscm93OiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVpZDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fbGVmdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fcmlnaHQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuX2xldmVsOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYSh0aGlzKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxyb3c6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50aWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuX2xldmVsOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGV4cGFuZE5vZGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5wLnRyZWVSZWFkZXIucGFyZW50X2lkX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnAudHJlZVJlYWRlci5sb2FkZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHRoaXMucC50cmVlUmVhZGVyLmxldmVsX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLnAudHJlZVJlYWRlci5yaWdodF9maWVsZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYltjXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCB0aGlzLnAubG9jYWxSZWFkZXIuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gYSgiIyIgKyB0aGlzLnAuaWRQcmVmaXggKyBhLmpncmlkLmpxSUQocCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuYkRpdilbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB0aGlzLnAuX2luZGV4W3BdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICExICE9PSAoYS5pc0Z1bmN0aW9uKHRoaXMucC5iZWZvcmVFeHBhbmRUcmVlR3JpZE5vZGUpID8gdGhpcy5wLmJlZm9yZUV4cGFuZFRyZWVHcmlkTm9kZS5jYWxsKHRoaXMsIHAsIGIpIDogITApICYmIChhKHRoaXMpLmpxR3JpZCgiaXNOb2RlTG9hZGVkIiwgdGhpcy5wLmRhdGFbcV0pID8gKGJbY10gPSAhMCwgYSgiZGl2LnRyZWVjbGljayIsIHIpLnJlbW92ZUNsYXNzKHRoaXMucC50cmVlSWNvbnMucGx1cyArICIgdHJlZS1wbHVzIikuYWRkQ2xhc3ModGhpcy5wLnRyZWVJY29ucy5taW51cyArICIgdHJlZS1taW51cyIpKSA6IHRoaXMuZ3JpZC5oRGl2LmxvYWRpbmcgfHwgKGJbY10gPSAhMCwgYSgiZGl2LnRyZWVjbGljayIsIHIpLnJlbW92ZUNsYXNzKHRoaXMucC50cmVlSWNvbnMucGx1cyArICIgdHJlZS1wbHVzIikuYWRkQ2xhc3ModGhpcy5wLnRyZWVJY29ucy5taW51cyArICIgdHJlZS1taW51cyIpLCB0aGlzLnAudHJlZUFOb2RlID0gci5yb3dJbmRleCwgdGhpcy5wLmRhdGF0eXBlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucC50cmVlZGF0YXR5cGUsICJuZXN0ZWQiID09PSB0aGlzLnAudHJlZUdyaWRNb2RlbCA/IGEodGhpcykuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuX2xlZnQ6IGJbZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fcmlnaHQ6IGJba10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fbGV2ZWw6IGJbbF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGEodGhpcykuanFHcmlkKCJzZXRHcmlkUGFyYW0iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRpZDogYltkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbl9sZXZlbDogYltsXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhKHRoaXMpLnRyaWdnZXIoInJlbG9hZEdyaWQiKSwgYltnXSA9ICEwLCAibmVzdGVkIiA9PT0gdGhpcy5wLnRyZWVHcmlkTW9kZWwgPyBhKHRoaXMpLmpxR3JpZCgic2V0R3JpZFBhcmFtIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVpZDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fbGVmdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fcmlnaHQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuX2xldmVsOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYSh0aGlzKS5qcUdyaWQoInNldEdyaWRQYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlaWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRpZDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5fbGV2ZWw6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBhLmlzRnVuY3Rpb24odGhpcy5wLmFmdGVyRXhwYW5kVHJlZUdyaWROb2RlKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAuYWZ0ZXJFeHBhbmRUcmVlR3JpZE5vZGUuY2FsbCh0aGlzLCBwLCBiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sbGFwc2VOb2RlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0aGlzLnAudHJlZUdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5wLnRyZWVSZWFkZXIuZXhwYW5kZWRfZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYltjXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5qZ3JpZC5nZXRBY2Nlc3NvcihiLCB0aGlzLnAubG9jYWxSZWFkZXIuaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5pc0Z1bmN0aW9uKHRoaXMucC5iZWZvcmVDb2xsYXBzZVRyZWVHcmlkTm9kZSkgPyB0aGlzLnAuYmVmb3JlQ29sbGFwc2VUcmVlR3JpZE5vZGUuY2FsbCh0aGlzLCBkLCBiKSA6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYSgiIyIgKyB0aGlzLnAuaWRQcmVmaXggKyBhLmpncmlkLmpxSUQoZCksIHRoaXMuZ3JpZC5iRGl2KVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYltjXSA9ICExLCAhMSAhPT0gZykgYSgiZGl2LnRyZWVjbGljayIsIGwpLnJlbW92ZUNsYXNzKHRoaXMucC50cmVlSWNvbnMubWludXMgKyAiIHRyZWUtbWludXMiKS5hZGRDbGFzcyh0aGlzLnAudHJlZUljb25zLnBsdXMgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIHRyZWUtcGx1cyIpLCBhLmlzRnVuY3Rpb24odGhpcy5wLmFmdGVyQ29sbGFwc2VUcmVlR3JpZE5vZGUpICYmIHRoaXMucC5hZnRlckNvbGxhcHNlVHJlZUdyaWROb2RlLmNhbGwodGhpcywgZCwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgU29ydFRyZWU6IGZ1bmN0aW9uKGIsIGMsIGQsIGcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwsIGUsIGssIHAsIHIgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0Um9vdE5vZGVzIiwgcS5wLnNlYXJjaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5qZ3JpZC5mcm9tLmNhbGwodGhpcywgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLm9yZGVyQnkoYiwgYywgZCwgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gbC5zZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlID0gcC5sZW5ndGg7IGUgPiBsOyBsKyspIGsgPSBwW2xdLCByLnB1c2goayksIGEodGhpcykuanFHcmlkKCJjb2xsZWN0Q2hpbGRyZW5Tb3J0VHJlZSIsIHIsIGssIGIsIGMsIGQsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKHIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuamdyaWQuZ2V0QWNjZXNzb3IodGhpcywgcS5wLmxvY2FsUmVhZGVyLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKCIjIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuamdyaWQuanFJRChxLnAuaWQpICsgIiB0Ym9keSB0cjplcSgiICsgYiArICIpIikuYWZ0ZXIoYSgidHIjIiArIGEuamdyaWQuanFJRChjKSwgcS5ncmlkLmJEaXYpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcCA9IGwgPSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlYXJjaFRyZWU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZywgbCA9IGIubGVuZ3RoIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgayA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gW107CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0aGlzLnAudHJlZUdyaWQgJiYgbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IHRoaXMucC5sb2NhbFJlYWRlci5pZCwgYyA9IDA7IGwgPiBjOyBjKyspIGUgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0Tm9kZUFuY2VzdG9ycyIsIGJbY10pLCBlLmxlbmd0aCB8fCBlLnB1c2goYltjXSksIGcgPSBlW2UubGVuZ3RoIC0gMV1bZF0sIC0xID09PSBhLmluQXJyYXkoZywgaykgJiYgKGsucHVzaChnKSwgZSA9IGEodGhpcykuanFHcmlkKCJnZXRGdWxsVHJlZU5vZGUiLCBlW2UubGVuZ3RoIC0gMV0sICEwKSwgcCA9IHAuY29uY2F0KGUpKQogICAgICAgICAgICAgICAgICAgIH0pLCBwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sbGVjdENoaWxkcmVuU29ydFRyZWU6IGZ1bmN0aW9uKGIsIGMsIGQsIGcsIGwsIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAudHJlZUdyaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrLCBwLCByLCBxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEodGhpcykuanFHcmlkKCJnZXROb2RlQ2hpbGRyZW4iLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmpncmlkLmZyb20uY2FsbCh0aGlzLCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsub3JkZXJCeShkLCBnLCBsLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBrLnNlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHAgPSBxLmxlbmd0aDsgcCA+IGs7IGsrKykgciA9IHFba10sIGIucHVzaChyKSwgYSh0aGlzKS5qcUdyaWQoImNvbGxlY3RDaGlsZHJlblNvcnRUcmVlIiwgYiwgciwgZCwgZywgbCwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2V0VHJlZVJvdzogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gITE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCAmJiAoZCA9IGEodGhpcykuanFHcmlkKCJzZXRSb3dEYXRhIiwgYiwgYykpCiAgICAgICAgICAgICAgICAgICAgfSksIGQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkZWxUcmVlTm9kZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBsLCBlLCBrID0gdGhpcy5wLmxvY2FsUmVhZGVyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMucC50cmVlUmVhZGVyLmxlZnRfZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gdGhpcy5wLnRyZWVSZWFkZXIucmlnaHRfZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQgJiYgdGhpcy5wLnRyZWVHcmlkICYmIChjID0gdGhpcy5wLl9pbmRleFtiXSwgdm9pZCAwICE9PSBjKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHBhcnNlSW50KHRoaXMucC5kYXRhW2NdW3JdLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZCAtIHBhcnNlSW50KHRoaXMucC5kYXRhW2NdW3BdLCAxMCkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBhKHRoaXMpLmpxR3JpZCgiZ2V0RnVsbFRyZWVOb2RlIiwgdGhpcy5wLmRhdGFbY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCBxLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgcS5sZW5ndGg7IGMrKykgYSh0aGlzKS5qcUdyaWQoImRlbFJvd0RhdGEiLCBxW2NdW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibmVzdGVkIiA9PT0gdGhpcy5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobCA9IGEuamdyaWQuZnJvbS5jYWxsKHRoaXMsIHRoaXMucC5kYXRhKS5ncmVhdGVyKHAsIGQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eXBlOiAiaW50ZWdlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc2VsZWN0KCksIGwubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUgaW4gbCkgbC5oYXNPd25Qcm9wZXJ0eShlKSAmJiAobFtlXVtwXSA9IHBhcnNlSW50KGxbZV1bcF0sIDEwKSAtIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsID0gYS5qZ3JpZC5mcm9tLmNhbGwodGhpcywgdGhpcy5wLmRhdGEpLmdyZWF0ZXIociwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlwZTogImludGVnZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zZWxlY3QoKSwgbC5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSBpbiBsKSBsLmhhc093blByb3BlcnR5KGUpICYmIChsW2VdW3JdID0gcGFyc2VJbnQobFtlXVtyXSwgMTApIC0gZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsQ2hpbGRyZW46IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZywgbCwgZSA9IHRoaXMucC5sb2NhbFJlYWRlci5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMucC50cmVlUmVhZGVyLnJpZ2h0X2ZpZWxkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMucC50cmVlR3JpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLnAuX2luZGV4W2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBwYXJzZUludCh0aGlzLnAuZGF0YVtyXVtwXSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjIC0gcGFyc2VJbnQodGhpcy5wLmRhdGFbcl1ba10sIDEwKSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGEodGhpcykuanFHcmlkKCJnZXRGdWxsVHJlZU5vZGUiLCB0aGlzLnAuZGF0YVtyXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPCByLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcSA9IDA7IHEgPCByLmxlbmd0aDsgcSsrKSByW3FdW2VdICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiBhKHRoaXMpLmpxR3JpZCgiZGVsUm93RGF0YSIsIHJbcV1bZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibmVzdGVkIiA9PT0gdGhpcy5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcgPSBhLmpncmlkLmZyb20odGhpcy5wLmRhdGEpLmdyZWF0ZXIoaywgYywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eXBlOiAiaW50ZWdlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNlbGVjdCgpLCBnLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobCBpbiBnKSBnLmhhc093blByb3BlcnR5KGwpICYmIChnW2xdW2tdID0gcGFyc2VJbnQoZ1tsXVtrXSwgMTApIC0gZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0gYS5qZ3JpZC5mcm9tKHRoaXMucC5kYXRhKS5ncmVhdGVyKHAsIGMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlwZTogImludGVnZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zZWxlY3QoKSwgZy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGwgaW4gZykgZy5oYXNPd25Qcm9wZXJ0eShsKSAmJiAoZ1tsXVtwXSA9IHBhcnNlSW50KGdbbF1bcF0sIDEwKSAtIGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhZGRDaGlsZE5vZGU6IGZ1bmN0aW9uKGIsIGMsIGQsIGcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IHRoaXNbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIGssIHAsIHIsIHEsIHUsIHosIHkgPSBsLnAudHJlZVJlYWRlci5leHBhbmRlZF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBsLnAudHJlZVJlYWRlci5sZWFmX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IGwucC50cmVlUmVhZGVyLmxldmVsX2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRCA9IGwucC50cmVlUmVhZGVyLnBhcmVudF9pZF9maWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSBsLnAudHJlZVJlYWRlci5sZWZ0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGwucC50cmVlUmVhZGVyLnJpZ2h0X2ZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSCA9IGwucC50cmVlUmVhZGVyLmxvYWRlZDsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBFID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gZyAmJiAoZyA9ICExKSwgbnVsbCA9PSBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocSA9IGwucC5kYXRhLmxlbmd0aCAtIDEsIDAgPD0gcSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgMCA8PSBxOykgZSA9IE1hdGgubWF4KGUsIHBhcnNlSW50KGwucC5kYXRhW3FdW2wucC5sb2NhbFJlYWRlci5pZF0sIDEwKSksIHEtLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBlICsgMQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBGID0gYShsKS5qcUdyaWQoImdldEluZCIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodSA9ICExLCB2b2lkIDAgPT09IGMgfHwgbnVsbCA9PT0gYyB8fCAiIiA9PT0gYykgRSA9IGMgPSBudWxsLCBlID0gImxhc3QiLCByID0gbC5wLnRyZWVfcm9vdF9sZXZlbCwgcSA9IGwucC5kYXRhLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICJhZnRlciI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gbC5wLl9pbmRleFtjXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBsLnAuZGF0YVtrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBwW2wucC5sb2NhbFJlYWRlci5pZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcGFyc2VJbnQocFtDXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEwgPSBhKGwpLmpxR3JpZCgiZ2V0RnVsbFRyZWVOb2RlIiwgcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMLmxlbmd0aCA/IChxID0gTFtMLmxlbmd0aCAtIDFdW2wucC5sb2NhbFJlYWRlci5pZF0sIEUgPSBxLCBxID0gYShsKS5qcUdyaWQoImdldEluZCIsIEUpICsgMSkgOiBxID0gYShsKS5qcUdyaWQoImdldEluZCIsIGMpICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBbdl0gJiYgKHUgPSAhMCwgcFt5XSA9ICEwLCBhKGwucm93c1tGXSkuZmluZCgic3Bhbi5jZWxsLXdyYXBwZXJsZWFmIikucmVtb3ZlQ2xhc3MoImNlbGwtd3JhcHBlcmxlYWYiKS5hZGRDbGFzcygiY2VsbC13cmFwcGVyIikuZW5kKCkuZmluZCgiZGl2LnRyZWUtbGVhZiIpLnJlbW92ZUNsYXNzKGwucC50cmVlSWNvbnMubGVhZiArICIgdHJlZS1sZWFmIikuYWRkQ2xhc3MobC5wLnRyZWVJY29ucy5taW51cyArICIgdHJlZS1taW51cyIpLCBsLnAuZGF0YVtrXVt2XSA9ICExLCBwW0hdID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgPSBxICsgMSwgdm9pZCAwID09PSBkW3ldICYmIChkW3ldID0gITEpLCB2b2lkIDAgPT09IGRbSF0gJiYgKGRbSF0gPSAhMSksIGRbQ10gPSByLCB2b2lkIDAgPT09IGRbdl0gJiYgKGRbdl0gPSAhMCksICJhZGphY2VuY3kiID09PSBsLnAudHJlZUdyaWRNb2RlbCAmJiAoZFtEXSA9IGMpLCAibmVzdGVkIiA9PT0gbC5wLnRyZWVHcmlkTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBKLCBHLCBJOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeiA9IHBhcnNlSW50KHBbeF0sIDEwKSwgSiA9IGEuamdyaWQuZnJvbS5jYWxsKGwsIGwucC5kYXRhKSwgSiA9IEouZ3JlYXRlck9yRXF1YWxzKHgsIHosIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eXBlOiAiaW50ZWdlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIEcgPSBKLnNlbGVjdCgpLCBHLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChJIGluIEcpIEcuaGFzT3duUHJvcGVydHkoSSkgJiYgKEdbSV1bQV0gPSBHW0ldW0FdID4geiA/IHBhcnNlSW50KEdbSV1bQV0sIDEwKSArIDIgOiBHW0ldW0FdLCBHW0ldW3hdID0gR1tJXVt4XSA+PSB6ID8gcGFyc2VJbnQoR1tJXVt4XSwgMTApICsgMiA6IEdbSV1beF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRbQV0gPSB6OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRbeF0gPSB6ICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeiA9IHBhcnNlSW50KGEobCkuanFHcmlkKCJnZXRDb2wiLCB4LCAhMSwgIm1heCIpLCAxMCksIEcgPSBhLmpncmlkLmZyb20uY2FsbChsLCBsLnAuZGF0YSkuZ3JlYXRlcihBLCB6LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlwZTogImludGVnZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNlbGVjdCgpLCBHLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChJIGluIEcpIEcuaGFzT3duUHJvcGVydHkoSSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChHW0ldW0FdID0gcGFyc2VJbnQoR1tJXVtBXSwgMTApICsgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcgPSBhLmpncmlkLmZyb20uY2FsbChsLCBsLnAuZGF0YSkuZ3JlYXRlcih4LCB6LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlwZTogImludGVnZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNlbGVjdCgpLCBHLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChJIGluIEcpIEcuaGFzT3duUHJvcGVydHkoSSkgJiYgKEdbSV1beF0gPSBwYXJzZUludChHW0ldW3hdLCAxMCkgKyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkW0FdID0geiArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFt4XSA9IHogKyAyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0obnVsbCA9PT0gYyB8fCBhKGwpLmpxR3JpZCgiaXNOb2RlTG9hZGVkIiwgcCkgfHwgdSkgJiYgKGEobCkuanFHcmlkKCJhZGRSb3dEYXRhIiwgYiwgZCwgZSwgRSksIGEobCkuanFHcmlkKCJzZXRUcmVlTm9kZSIsIHEsIGspKTsKICAgICAgICAgICAgICAgICAgICAgICAgcCAmJiAhcFt5XSAmJiBnICYmIGEobC5yb3dzW0ZdKS5maW5kKCJkaXYudHJlZWNsaWNrIikuY2xpY2soKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuZm4uanFEcmFnID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIE8odGhpcywgYSwgImQiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmpxUmVzaXplID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIE8odGhpcywgYSwgInIiLCBiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmpxRG5SID0gewogICAgICAgICAgICAgICAgZG5yOiB7fSwKICAgICAgICAgICAgICAgIGU6IDAsCiAgICAgICAgICAgICAgICBkcmFnOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJkIiA9PQogICAgICAgICAgICAgICAgICAgICAgICBGLmsgPyBNLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBGLlggKyBhLnBhZ2VYIC0gRi5wWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogRi5ZICsgYS5wYWdlWSAtIEYucFkKICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAoTS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4KGEucGFnZVggLSBGLnBYICsgRi5XLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoYS5wYWdlWSAtIEYucFkgKyBGLkgsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBTICYmIEkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChhLnBhZ2VYIC0gUy5wWCArIFMuVywgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KGEucGFnZVkgLSBTLnBZICsgUy5ILCAwKQogICAgICAgICAgICAgICAgICAgICAgICB9KSksICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgYShkb2N1bWVudCkudW5iaW5kKCJtb3VzZW1vdmUiLCB2LmRyYWcpLnVuYmluZCgibW91c2V1cCIsIHYuc3RvcCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHYgPSBhLmpxRG5SLAogICAgICAgICAgICAgICAgRiA9IHYuZG5yLAogICAgICAgICAgICAgICAgTSA9IHYuZSwKICAgICAgICAgICAgICAgIEksIFMsIE8gPSBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGMgPyBhKGMsIGIpIDogYjsKICAgICAgICAgICAgICAgICAgICAgICAgYy5iaW5kKCJtb3VzZWRvd24iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgazogZAogICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGIuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTSA9IGMuZSwgSSA9IGcgPyBhKGcpIDogITEsICJyZWxhdGl2ZSIgIT0gTS5jc3MoInBvc2l0aW9uIikpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTS5wb3NpdGlvbihkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZikge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChGID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYOiBkLmxlZnQgfHwgUCgibGVmdCIpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFk6IGQudG9wIHx8IFAoInRvcCIpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFc6IFAoIndpZHRoIikgfHwgTVswXS5zY3JvbGxXaWR0aCB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIOiBQKCJoZWlnaHQiKSB8fCBNWzBdLnNjcm9sbEhlaWdodCB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwWDogYi5wYWdlWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcFk6IGIucGFnZVksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGs6IGMuawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIFMgPSBJICYmICJkIiAhPSBjLmsgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFg6IGQubGVmdCB8fCBWKCJsZWZ0IikgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWTogZC50b3AgfHwgVigidG9wIikgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVzogSVswXS5vZmZzZXRXaWR0aCB8fCBWKCJ3aWR0aCIpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEg6IElbMF0ub2Zmc2V0SGVpZ2h0IHx8IFYoImhlaWdodCIpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBYOiBiLnBhZ2VYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwWTogYi5wYWdlWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgazogYy5rCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6ICExLCBhKCJpbnB1dC5oYXNEYXRlcGlja2VyIiwgTVswXSlbMF0pIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSgiaW5wdXQuaGFzRGF0ZXBpY2tlciIsIE1bMF0pLmRhdGVwaWNrZXIoImhpZGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZikge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKGRvY3VtZW50KS5tb3VzZW1vdmUoYS5qcURuUi5kcmFnKS5tb3VzZXVwKGEuanFEblIuc3RvcCksICExCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBQID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChNLmNzcyhhKSwKICAgICAgICAgICAgICAgICAgICAgICAgMTApIHx8ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgViA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoSS5jc3MoYSksIDEwKSB8fCAhMQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5mbi50aW55RHJhZ2dhYmxlID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgdmFyIGMgPSBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAwLAogICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGU6IDAKICAgICAgICAgICAgICAgIH0sIGIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgZCwgZiA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgKGMuaGFuZGxlID8gYShjLmhhbmRsZSwgZikgOiBmKS5vbih7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjLmV4Y2x1ZGUgfHwgIX5hLmluQXJyYXkoZS50YXJnZXQsIGEoYy5leGNsdWRlLCBmKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBmLm9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBlLnBhZ2VYIC0gZy5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBlLnBhZ2VZIC0gZy50b3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShkb2N1bWVudCkub24oIm1vdXNlbW92ZS5kcmFnIiwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLm9mZnNldCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGEucGFnZVkgLSBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYS5wYWdlWCAtIGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBtb3VzZXVwOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoZG9jdW1lbnQpLm9mZigibW91c2Vtb3ZlLmRyYWciKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uanFtID0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheTogNTAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlb3ZlcmxheTogITAsCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlDbGFzczogImpxbU92ZXJsYXkiLAogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAianFtQ2xvc2UiLAogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAiLmpxTW9kYWwiLAogICAgICAgICAgICAgICAgICAgICAgICBhamF4OiBXLAogICAgICAgICAgICAgICAgICAgICAgICBhamF4VGV4dDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogVywKICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6IFcsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvVG9wOiBXLAogICAgICAgICAgICAgICAgICAgICAgICBvblNob3c6IFcsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uSGlkZTogVywKICAgICAgICAgICAgICAgICAgICAgICAgb25Mb2FkOiBXCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fanFtID8gZmFbdGhpcy5fanFtXS5jID0gYS5leHRlbmQoe30sIGZhW3RoaXMuX2pxbV0uYywgYikgOiAobWErKywgdGhpcy5fanFtID0gbWEsIGZhW21hXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGM6IGEuZXh0ZW5kKGMsIGEuanFtLnBhcmFtcywgYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiBXLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdzogYSh0aGlzKS5hZGRDbGFzcygianFtSUQiICsgbWEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgczogbWEKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdm9pZChjLnRyaWdnZXIgJiYgYSh0aGlzKS5qcW1BZGRUcmlnZ2VyKGMudHJpZ2dlcikpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmpxbUFkZENsb3NlID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGcodGhpcywgYSwgImpxbUhpZGUiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmpxbUFkZFRyaWdnZXIgPQogICAgICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnKHRoaXMsIGEsICJqcW1TaG93IikKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uanFtU2hvdyA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgYS5qcW0ub3Blbih0aGlzLl9qcW0sIGIpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmpxbUhpZGUgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGEuanFtLmNsb3NlKHRoaXMuX2pxbSwgYikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuanFtID0gewogICAgICAgICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICAgICAgICBvcGVuOiBmdW5jdGlvbihkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBmYVtkXSwKICAgICAgICAgICAgICAgICAgICAgICAgayA9IGguYywKICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICIuIiArIGsuY2xvc2VDbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBhcnNlSW50KGgudy5jc3MoInotaW5kZXgiKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAwIDwgZSA/IGUgOiAzRTMsCiAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBhKCI8ZGl2PjwvZGl2PiIpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImZpeGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiei1pbmRleCI6IGUgLSAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogay5vdmVybGF5IC8gMTAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChoLmEpIHJldHVybiBXOwogICAgICAgICAgICAgICAgICAgIChoLnQgPSBnLCBoLmEgPSAhMCwgaC53LmNzcygiei1pbmRleCIsIGUpLCBrLm1vZGFsID8gKGFhWzBdIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgYygiYmluZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEpLCBhYS5wdXNoKGQpKSA6IDAgPCBrLm92ZXJsYXkgPyBrLmNsb3Nlb3ZlcmxheSAmJiBoLncuanFtQWRkQ2xvc2UobikgOiBuID0gVywgaC5vID0gbiA/IG4uYWRkQ2xhc3Moay5vdmVybGF5Q2xhc3MpLnByZXBlbmRUbygiYm9keSIpIDogVywgay5hamF4KSA/IChlID0gay50YXJnZXQgfHwgaC53LCBuID0gay5hamF4LCBlID0gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBhKGUsIGgudykgOiBhKGUpLCBuID0gIkAiID09PSBuLnN1YnN0cigwLCAxKSA/IGEoZykuYXR0cihuLnN1YnN0cmluZygxKSkgOiBuLCBlLmh0bWwoay5hamF4VGV4dCkubG9hZChuLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgay5vbkxvYWQgJiYgay5vbkxvYWQuY2FsbCh0aGlzLCBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbCAmJiBoLncuanFtQWRkQ2xvc2UoYShsLCBoLncpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYihoKQogICAgICAgICAgICAgICAgICAgIH0pKSA6IGwgJiYgaC53LmpxbUFkZENsb3NlKGEobCwgaC53KSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGsudG9Ub3AgJiYgaC5vICYmIGgudy5iZWZvcmUoJzxzcGFuIGlkPSJqcW1QJyArIGgud1swXS5fanFtICsgJyI+PC9zcGFuPicpLmluc2VydEFmdGVyKGgubyksCiAgICAgICAgICAgICAgICAgICAgICAgIGsub25TaG93ID8gay5vblNob3coaCkgOiBoLncuc2hvdygpLCBiKGgpLCBXCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gZmFbYl07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuYSA/IChiLmEgPSBXLCBhYVswXSAmJiAoYWEucG9wKCksIGFhWzBdIHx8IG5ldyBjKCJ1bmJpbmQiKSksIGIuYy50b1RvcCAmJiBiLm8gJiYgYSgiI2pxbVAiICsgYi53WzBdLl9qcW0pLmFmdGVyKGIudykucmVtb3ZlKCksIGIuYy5vbkhpZGUgPyBiLmMub25IaWRlKGIpIDogKGIudy5oaWRlKCksIGIubyAmJiBiLm8ucmVtb3ZlKCkpLCBXKSA6IFcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBtYSA9IDAsCiAgICAgICAgICAgICAgICBmYSA9IGEuanFtLmhhc2gsCiAgICAgICAgICAgICAgICBhYSA9IFtdLAogICAgICAgICAgICAgICAgVyA9ICExLAogICAgICAgICAgICAgICAgYiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGEuYy5mb2N1c0ZpZWxkICYmIChhLmMuZm9jdXNGaWVsZCA9IDApOwogICAgICAgICAgICAgICAgICAgIDAgPD0gYS5jLmZvY3VzRmllbGQgJiYgUChhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFAgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgYSgiOmlucHV0OnZpc2libGUiLCBiLncpW3BhcnNlSW50KGIuYy5mb2N1c0ZpZWxkLCAxMCldLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGMgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgYShkb2N1bWVudClbYl0oImtleXByZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgZClbYl0oImtleWRvd24iLCBkKVtiXSgibW91c2Vkb3duIiwgZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gZmFbYWFbYWEubGVuZ3RoIC0gMV1dLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gIWEoYi50YXJnZXQpLnBhcmVudHMoIi5qcW1JRCIgKyBjLnMpWzBdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBkICYmIChhKCIuanFtSUQiICsgYy5zKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYy5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcudG9wIDw9IGIucGFnZVkgJiYgYi5wYWdlWSA8PSBnLnRvcCArIGMuaGVpZ2h0KCkgJiYgZy5sZWZ0IDw9IGIucGFnZVggJiYgYi5wYWdlWCA8PSBnLmxlZnQgKyBjLndpZHRoKCkgPyAoZCA9ICExLCAhMSkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB9KSwgUChjKSksICFkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZyA9IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX2pxbTsKICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tkXSB8fCAodGhpc1tkXSA9IFtdLCBhKHRoaXMpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgaW4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganFtU2hvdzogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxbUhpZGU6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiBpbiB0aGlzW2FdKSBmYVt0aGlzW2FdW2JdXSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFbdGhpc1thXVtiXV0ud1thXSh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tkXS5wdXNoKGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm1hdHRlciA9IHt9OwogICAgICAgICAgICBhLmV4dGVuZChhLmZtYXR0ZXIsIHsKICAgICAgICAgICAgICAgIGlzQm9vbGVhbjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiYm9vbGVhbiIgPT0gdHlwZW9mIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc09iamVjdDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiICYmICgib2JqZWN0IiA9PSB0eXBlb2YgYiB8fCBhLmlzRnVuY3Rpb24oYikpIHx8ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc051bWJlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtYmVyIiA9PSB0eXBlb2YgYSAmJiBpc0Zpbml0ZShhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzVmFsdWU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc09iamVjdChhKSB8fCB0aGlzLmlzU3RyaW5nKGEpIHx8IHRoaXMuaXNOdW1iZXIoYSkgfHwgdGhpcy5pc0Jvb2xlYW4oYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzU3RyaW5nKGIpICYmIHRoaXMuaXNWYWx1ZShiKSA/ICExIDogdGhpcy5pc1ZhbHVlKGIpID8KICAgICAgICAgICAgICAgICAgICAgICAgKGIgPSBhLnRyaW0oYikucmVwbGFjZSgvXCZuYnNwXDsvZ2ksICIiKS5yZXBsYWNlKC9cJiMxNjBcOy9naSwgIiIpLCAiIiA9PT0gYikgOiAhMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5mbi5mbWF0dGVyID0gZnVuY3Rpb24oYiwgYywgZCwgZywgbCkgewogICAgICAgICAgICAgICAgdmFyIGUgPSBjOwogICAgICAgICAgICAgICAgZCA9IGEuZXh0ZW5kKHt9LCBhLmpncmlkLmdldFJlZ2lvbmFsKHRoaXMsICJmb3JtYXR0ZXIiKSwgZCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGUgPSBhLmZuLmZtYXR0ZXJbYl0uY2FsbCh0aGlzLCBjLCBkLCBnLCBsKQogICAgICAgICAgICAgICAgfSBjYXRjaCAoaykge30KICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm1hdHRlci51dGlsID0gewogICAgICAgICAgICAgICAgTnVtYmVyRm9ybWF0OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuZm1hdHRlci5pc051bWJlcihiKSB8fCAoYiAqPSAxKSwgYS5mbWF0dGVyLmlzTnVtYmVyKGIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gMCA+IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gU3RyaW5nKGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGMuZGVjaW1hbFNlcGFyYXRvciB8fCAiLiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmZtYXR0ZXIuaXNOdW1iZXIoYy5kZWNpbWFsUGxhY2VzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBjLmRlY2ltYWxQbGFjZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gTWF0aC5wb3coMTAsIGspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwgPSBTdHJpbmcoTWF0aC5yb3VuZChiICogZCkgLyBkKSwgZCA9IGwubGFzdEluZGV4T2YoIi4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDAgPiBkID8gKGwgKz0gZSwgZCA9IGwubGVuZ3RoIC0gMSkgOiAiLiIgIT09IGUgJiYgKGwgPSBsLnJlcGxhY2UoIi4iLCBlKSk7IGwubGVuZ3RoIC0gMSAtIGQgPCBrOykgbCArPSAiMCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy50aG91c2FuZHNTZXBhcmF0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBjLnRob3VzYW5kc1NlcGFyYXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBsLmxhc3RJbmRleE9mKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IC0xIDwgZCA/IGQgOiBsLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHAgPSBsLnN1YnN0cmluZyhkKSwgciA9IC0xLCBlID0gZDsgMCA8IGU7IGUtLSkgcisrLCAwID09PSByICUgMyAmJiBlICE9PSBkICYmICghZyB8fCAxIDwgZSkgJiYgKHAgPSBrICsgcCksIHAgPSBsLmNoYXJBdChlIC0gMSkgKyBwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbCA9IGMucHJlZml4ID8gYy5wcmVmaXggKyBsIDogbCwgYy5zdWZmaXggPyBsICsgYy5zdWZmaXggOiBsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5kZWZhdWx0Rm9ybWF0ID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGEuZm1hdHRlci5pc1ZhbHVlKGIpICYmICIiICE9PSBiID8gYiA6IGMuZGVmYXVsdFZhbHVlIHx8ICImIzE2MDsiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5lbWFpbCA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLmZtYXR0ZXIuaXNFbXB0eShiKSA/CiAgICAgICAgICAgICAgICAgICAgYS5mbi5mbWF0dGVyLmRlZmF1bHRGb3JtYXQoYiwgYykgOiAnPGEgaHJlZj0ibWFpbHRvOicgKyBiICsgJyI+JyArIGIgKyAiPC9hPiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5mbi5mbWF0dGVyLmNoZWNrYm94ID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQsIGcgPSBhLmV4dGVuZCh7fSwgYy5jaGVja2JveCk7CiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGMuY29sTW9kZWwgJiYgdm9pZCAwICE9PSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMgJiYgKGcgPSBhLmV4dGVuZCh7fSwgZywgYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zKSk7CiAgICAgICAgICAgICAgICBkID0gITAgPT09IGcuZGlzYWJsZWQgPyAnZGlzYWJsZWQ9ImRpc2FibGVkIicgOiAiIjsKICAgICAgICAgICAgICAgIChhLmZtYXR0ZXIuaXNFbXB0eShiKSB8fCB2b2lkIDAgPT09IGIpICYmIChiID0gYS5mbi5mbWF0dGVyLmRlZmF1bHRGb3JtYXQoYiwgZykpOwogICAgICAgICAgICAgICAgYiA9IFN0cmluZyhiKTsKICAgICAgICAgICAgICAgIGIgPSAoYiArICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iY2hlY2tib3giICcgKyAoMCA+IGIuc2VhcmNoKC8oZmFsc2V8ZnwwfG5vfG58b2ZmfHVuZGVmaW5lZCkvaSkgPyAiIGNoZWNrZWQ9J2NoZWNrZWQnICIgOiAiIikgKyAnIHZhbHVlPSInICsKICAgICAgICAgICAgICAgICAgICBiICsgJyIgb2ZmdmFsPSJubyIgJyArIGQgKyAiLz4iCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5saW5rID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogYy50YXJnZXQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGcgPSAiIjsKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgIT09IGMuY29sTW9kZWwgJiYgdm9pZCAwICE9PSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMgJiYgKGQgPSBhLmV4dGVuZCh7fSwgZCwgYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zKSksIGQudGFyZ2V0ICYmIChnID0gInRhcmdldD0iICsgZC50YXJnZXQpLCBhLmZtYXR0ZXIuaXNFbXB0eShiKSA/IGEuZm4uZm1hdHRlci5kZWZhdWx0Rm9ybWF0KGIsIGMpIDogIjxhICIgKyBnICsgJyBocmVmPSInICsgYiArICciPicgKyBiICsgIjwvYT4iCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5zaG93bGluayA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkLCBnID0gewogICAgICAgICAgICAgICAgICAgICAgICBiYXNlTGlua1VybDogYy5iYXNlTGlua1VybCwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0FjdGlvbjogYy5zaG93QWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRQYXJhbTogYy5hZGRQYXJhbSB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBjLnRhcmdldCwKICAgICAgICAgICAgICAgICAgICAgICAgaWROYW1lOiBjLmlkTmFtZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbCA9ICIiOwogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gYy5jb2xNb2RlbCAmJgogICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zICYmIChnID0gYS5leHRlbmQoe30sIGcsIGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucykpLCBnLnRhcmdldCAmJiAobCA9ICJ0YXJnZXQ9IiArIGcudGFyZ2V0KSwgZCA9IGcuYmFzZUxpbmtVcmwgKyBnLnNob3dBY3Rpb24gKyAiPyIgKyBnLmlkTmFtZSArICI9IiArIGMucm93SWQgKyBnLmFkZFBhcmFtLCBhLmZtYXR0ZXIuaXNTdHJpbmcoYikgfHwgYS5mbWF0dGVyLmlzTnVtYmVyKGIpID8gIjxhICIgKyBsICsgJyBocmVmPSInICsgZCArICciPicgKyBiICsgIjwvYT4iIDogYS5mbi5mbWF0dGVyLmRlZmF1bHRGb3JtYXQoYiwgYykKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5mbi5mbWF0dGVyLmludGVnZXIgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZXh0ZW5kKHt9LCBjLmludGVnZXIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gYy5jb2xNb2RlbCAmJiB2b2lkIDAgIT09IGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucyAmJiAoZCA9IGEuZXh0ZW5kKHt9LCBkLCBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMpKSwgYS5mbWF0dGVyLmlzRW1wdHkoYikgPyBkLmRlZmF1bHRWYWx1ZSA6IGEuZm1hdHRlci51dGlsLk51bWJlckZvcm1hdChiLAogICAgICAgICAgICAgICAgICAgIGQpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5udW1iZXIgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZXh0ZW5kKHt9LCBjLm51bWJlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBjLmNvbE1vZGVsICYmIHZvaWQgMCAhPT0gYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zICYmIChkID0gYS5leHRlbmQoe30sIGQsIGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucykpLCBhLmZtYXR0ZXIuaXNFbXB0eShiKSA/IGQuZGVmYXVsdFZhbHVlIDogYS5mbWF0dGVyLnV0aWwuTnVtYmVyRm9ybWF0KGIsIGQpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5jdXJyZW5jeSA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYS5leHRlbmQoe30sIGMuY3VycmVuY3kpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gYy5jb2xNb2RlbCAmJiB2b2lkIDAgIT09IGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucyAmJiAoZCA9IGEuZXh0ZW5kKHt9LCBkLCBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMpKSwgYS5mbWF0dGVyLmlzRW1wdHkoYikgPyBkLmRlZmF1bHRWYWx1ZSA6IGEuZm1hdHRlci51dGlsLk51bWJlckZvcm1hdChiLCBkKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmZtYXR0ZXIuZGF0ZSA9CiAgICAgICAgICAgICAgICBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IGEuZXh0ZW5kKHt9LCBjLmRhdGUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgIT09IGMuY29sTW9kZWwgJiYgdm9pZCAwICE9PSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMgJiYgKGQgPSBhLmV4dGVuZCh7fSwgZCwgYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zKSksIGQucmVmb3JtYXRBZnRlckVkaXQgfHwgImVkaXQiICE9PSBnID8gYS5mbWF0dGVyLmlzRW1wdHkoYikgPyBhLmZuLmZtYXR0ZXIuZGVmYXVsdEZvcm1hdChiLCBjKSA6IGEuamdyaWQucGFyc2VEYXRlLmNhbGwodGhpcywgZC5zcmNmb3JtYXQsIGIsIGQubmV3Zm9ybWF0LCBkKSA6IGEuZm4uZm1hdHRlci5kZWZhdWx0Rm9ybWF0KGIsIGMpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBhLmZuLmZtYXR0ZXIuc2VsZWN0ID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgYiA9IFN0cmluZyhiKTsKICAgICAgICAgICAgICAgIHZhciBkLCBnLCBsID0gITEsCiAgICAgICAgICAgICAgICAgICAgZSA9IFtdOwogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zID8gKGwgPSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMudmFsdWUsIGQgPSB2b2lkIDAgPT09IGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucy5zZXBhcmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAiOiIgOiBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMuc2VwYXJhdG9yLCBnID0gdm9pZCAwID09PSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMuZGVsaW1pdGVyID8gIjsiIDogYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zLmRlbGltaXRlcikgOiB2b2lkIDAgIT09IGMuY29sTW9kZWwuZWRpdG9wdGlvbnMgJiYgKGwgPSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zLnZhbHVlLCBkID0gdm9pZCAwID09PSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zLnNlcGFyYXRvciA/ICI6IiA6IGMuY29sTW9kZWwuZWRpdG9wdGlvbnMuc2VwYXJhdG9yLCBnID0gdm9pZCAwID09PSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zLmRlbGltaXRlciA/ICI7IiA6IGMuY29sTW9kZWwuZWRpdG9wdGlvbnMuZGVsaW1pdGVyKSwgbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBrLCBwID0gMSA9PSAobnVsbCAhPSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zICYmICEwID09PSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zLm11bHRpcGxlKSA/ICEwIDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAocCAmJiAociA9IGIuc3BsaXQoIiwiKSwgciA9IGEubWFwKHIsIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnRyaW0oYikKICAgICAgICAgICAgICAgICAgICAgICAgfSkpLAogICAgICAgICAgICAgICAgICAgICAgICBhLmZtYXR0ZXIuaXNTdHJpbmcobCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBsLnNwbGl0KGcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBxLmxlbmd0aDsgZysrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgPSBxW2ddLnNwbGl0KGQpLCAyIDwgay5sZW5ndGggJiYgKGtbMV0gPSBhLm1hcChrLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgYiA/IGEgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKGQpKSwgcCkgLSAxIDwgYS5pbkFycmF5KGtbMF0sIHIpICYmIChlW3VdID0ga1sxXSwgdSsrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEudHJpbShrWzBdKSA9PT0gYS50cmltKGIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlWzBdID0ga1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYS5mbWF0dGVyLmlzT2JqZWN0KGwpICYmIChwID8gZSA9IGEubWFwKHIsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxbYV0KICAgICAgICAgICAgICAgICAgICB9KSA6IGVbMF0gPSBsW2JdIHx8ICIiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGIgPSBlLmpvaW4oIiwgIiksICIiID09PSBiID8gYS5mbi5mbWF0dGVyLmRlZmF1bHRGb3JtYXQoYiwgYykgOiBiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZm4uZm1hdHRlci5yb3dhY3Rpb25zID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgdmFyIGMgPSBhKHRoaXMpLmNsb3Nlc3QoInRyLmpxZ3JvdyIpLAogICAgICAgICAgICAgICAgICAgIGQgPSBjLmF0dHIoImlkIiksCiAgICAgICAgICAgICAgICAgICAgZyA9IGEodGhpcykuY2xvc2VzdCgidGFibGUudWktanFncmlkLWJ0YWJsZSIpLmF0dHIoImlkIikucmVwbGFjZSgvX2Zyb3plbihbXl9dKikkLywKICAgICAgICAgICAgICAgICAgICAgICAgIiQxIiksCiAgICAgICAgICAgICAgICAgICAgZyA9IGEoIiMiICsgZyksCiAgICAgICAgICAgICAgICAgICAgbCA9IGdbMF0sCiAgICAgICAgICAgICAgICAgICAgZSA9IGwucCwKICAgICAgICAgICAgICAgICAgICBrID0gZS5jb2xNb2RlbFthLmpncmlkLmdldENlbGxJbmRleCh0aGlzKV0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGsuZnJvemVuID8gYSgidHIjIiArIGQgKyAiIHRkOmVxKCIgKyBhLmpncmlkLmdldENlbGxJbmRleCh0aGlzKSArICIpID4gZGl2IiwgZykgOiBhKHRoaXMpLnBhcmVudCgpLAogICAgICAgICAgICAgICAgICAgIHIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhcGFyYW06IHt9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBxID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICBhLmlzRnVuY3Rpb24oci5hZnRlclJlc3RvcmUpICYmIHIuYWZ0ZXJSZXN0b3JlLmNhbGwobCwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZmluZCgiZGl2LnVpLWlubGluZS1lZGl0LGRpdi51aS1pbmxpbmUtZGVsIikuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBwLmZpbmQoImRpdi51aS1pbmxpbmUtc2F2ZSxkaXYudWktaW5saW5lLWNhbmNlbCIpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGsuZm9ybWF0b3B0aW9ucyAmJiAociA9IGEuZXh0ZW5kKHIsIGsuZm9ybWF0b3B0aW9ucykpOwogICAgICAgICAgICAgICAgdm9pZCAwICE9PSBlLmVkaXRPcHRpb25zICYmIChyLmVkaXRPcHRpb25zID0gZS5lZGl0T3B0aW9ucyk7CiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGUuZGVsT3B0aW9ucyAmJiAoci5kZWxPcHRpb25zID0KICAgICAgICAgICAgICAgICAgICBlLmRlbE9wdGlvbnMpOwogICAgICAgICAgICAgICAgYy5oYXNDbGFzcygianFncmlkLW5ldy1yb3ciKSAmJiAoci5leHRyYXBhcmFtW2UucHJtTmFtZXMub3Blcl0gPSBlLnBybU5hbWVzLmFkZG9wZXIpOwogICAgICAgICAgICAgICAgYyA9IHsKICAgICAgICAgICAgICAgICAgICBrZXlzOiByLmtleXMsCiAgICAgICAgICAgICAgICAgICAgb25lZGl0ZnVuYzogci5vbkVkaXQsCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bmM6IHIub25TdWNjZXNzLAogICAgICAgICAgICAgICAgICAgIHVybDogci51cmwsCiAgICAgICAgICAgICAgICAgICAgZXh0cmFwYXJhbTogci5leHRyYXBhcmFtLAogICAgICAgICAgICAgICAgICAgIGFmdGVyc2F2ZWZ1bmM6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKHIuYWZ0ZXJTYXZlKSAmJiByLmFmdGVyU2F2ZS5jYWxsKGwsIGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICBwLmZpbmQoImRpdi51aS1pbmxpbmUtZWRpdCxkaXYudWktaW5saW5lLWRlbCIpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgcC5maW5kKCJkaXYudWktaW5saW5lLXNhdmUsZGl2LnVpLWlubGluZS1jYW5jZWwiKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yZnVuYzogci5vbkVycm9yLAogICAgICAgICAgICAgICAgICAgIGFmdGVycmVzdG9yZWZ1bmM6IHEsCiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZUFmdGVyRXJyb3I6IHIucmVzdG9yZUFmdGVyRXJyb3IsCiAgICAgICAgICAgICAgICAgICAgbXR5cGU6IHIubXR5cGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJlZGl0IjoKICAgICAgICAgICAgICAgICAgICAgICAgZy5qcUdyaWQoImVkaXRSb3ciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZmluZCgiZGl2LnVpLWlubGluZS1lZGl0LGRpdi51aS1pbmxpbmUtZGVsIikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBwLmZpbmQoImRpdi51aS1pbmxpbmUtc2F2ZSxkaXYudWktaW5saW5lLWNhbmNlbCIpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgZy50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJHcmlkQ29tcGxldGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAic2F2ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGcuanFHcmlkKCJzYXZlUm93IiwgZCwgYykgJiYgKHAuZmluZCgiZGl2LnVpLWlubGluZS1lZGl0LGRpdi51aS1pbmxpbmUtZGVsIikuc2hvdygpLCBwLmZpbmQoImRpdi51aS1pbmxpbmUtc2F2ZSxkaXYudWktaW5saW5lLWNhbmNlbCIpLmhpZGUoKSwgZy50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJHcmlkQ29tcGxldGUiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgImNhbmNlbCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGcuanFHcmlkKCJyZXN0b3JlUm93IiwgZCwgcSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZmluZCgiZGl2LnVpLWlubGluZS1lZGl0LGRpdi51aS1pbmxpbmUtZGVsIikuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBwLmZpbmQoImRpdi51aS1pbmxpbmUtc2F2ZSxkaXYudWktaW5saW5lLWNhbmNlbCIpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZy50cmlnZ2VySGFuZGxlcigianFHcmlkQWZ0ZXJHcmlkQ29tcGxldGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGVsIjoKICAgICAgICAgICAgICAgICAgICAgICAgZy5qcUdyaWQoImRlbEdyaWRSb3ciLCBkLCByLmRlbE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJmb3JtZWRpdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGcuanFHcmlkKCJzZXRTZWxlY3Rpb24iLCBkKSwgZy5qcUdyaWQoImVkaXRHcmlkUm93IiwgZCwgci5lZGl0T3B0aW9ucykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5mbi5mbWF0dGVyLmFjdGlvbnMgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCwgZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5czogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRidXR0b246ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxidXR0b246ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBlZGl0Zm9ybWJ1dHRvbjogITEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGwgPSBjLnJvd0lkLAogICAgICAgICAgICAgICAgICAgIGUgPSAiIiwKICAgICAgICAgICAgICAgICAgICBrID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzLCAibmF2IiksCiAgICAgICAgICAgICAgICAgICAgcCA9IGEuamdyaWQuc3R5bGVVSVtjLnN0eWxlVUkgfHwgImpRdWVyeVVJIl0uZm1hdHRlciwKICAgICAgICAgICAgICAgICAgICByID0gYS5qZ3JpZC5zdHlsZVVJW2Muc3R5bGVVSSB8fCAialF1ZXJ5VUkiXS5jb21tb247CiAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMgJiYgKGcgPSBhLmV4dGVuZChnLCBjLmNvbE1vZGVsLmZvcm1hdG9wdGlvbnMpKSwKICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGwgfHwgYS5mbWF0dGVyLmlzRW1wdHkobCkpIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIHZhciBxID0gIm9ubW91c2VvdmVyPWpRdWVyeSh0aGlzKS5hZGRDbGFzcygnIiArIHIuaG92ZXIgKyAiJyk7IG9ubW91c2VvdXQ9alF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCciICsgci5ob3ZlciArICInKTsgICI7CiAgICAgICAgICAgICAgICByZXR1cm4gZy5lZGl0Zm9ybWJ1dHRvbiA/IChkID0gImlkPSdqRWRpdEJ1dHRvbl8iICsgbCArICInIG9uY2xpY2s9alF1ZXJ5LmZuLmZtYXR0ZXIucm93YWN0aW9ucy5jYWxsKHRoaXMsJ2Zvcm1lZGl0Jyk7ICIgKyBxLCBlICs9ICI8ZGl2IHRpdGxlPSciICsgay5lZGl0dGl0bGUgKyAiJyBzdHlsZT0nZmxvYXQ6bGVmdDtjdXJzb3I6cG9pbnRlcjsnIGNsYXNzPSd1aS1wZy1kaXYgdWktaW5saW5lLWVkaXQnICIgKyBkICsgIj48c3BhbiBjbGFzcz0nIiArIHIuaWNvbl9iYXNlICsgIiAiICsgcC5pY29uX2VkaXQgKyAiJz48L3NwYW4+PC9kaXY+IikgOiBnLmVkaXRidXR0b24gJiYgKGQgPSAiaWQ9J2pFZGl0QnV0dG9uXyIgKyBsICsgIicgb25jbGljaz1qUXVlcnkuZm4uZm1hdHRlci5yb3dhY3Rpb25zLmNhbGwodGhpcywnZWRpdCcpOyAiICsKICAgICAgICAgICAgICAgICAgICAgICAgcSwgZSArPSAiPGRpdiB0aXRsZT0nIiArIGsuZWRpdHRpdGxlICsgIicgc3R5bGU9J2Zsb2F0OmxlZnQ7Y3Vyc29yOnBvaW50ZXI7JyBjbGFzcz0ndWktcGctZGl2IHVpLWlubGluZS1lZGl0JyAiICsgZCArICI+PHNwYW4gY2xhc3M9JyIgKyByLmljb25fYmFzZSArICIgIiArIHAuaWNvbl9lZGl0ICsgIic+PC9zcGFuPjwvZGl2PiIpLCBnLmRlbGJ1dHRvbiAmJiAoZCA9ICJpZD0nakRlbGV0ZUJ1dHRvbl8iICsgbCArICInIG9uY2xpY2s9alF1ZXJ5LmZuLmZtYXR0ZXIucm93YWN0aW9ucy5jYWxsKHRoaXMsJ2RlbCcpOyAiICsgcSwgZSArPSAiPGRpdiB0aXRsZT0nIiArIGsuZGVsdGl0bGUgKyAiJyBzdHlsZT0nZmxvYXQ6bGVmdDsnIGNsYXNzPSd1aS1wZy1kaXYgdWktaW5saW5lLWRlbCcgIiArIGQgKyAiPjxzcGFuIGNsYXNzPSciICsgci5pY29uX2Jhc2UgKyAiICIgKyBwLmljb25fZGVsICsgIic+PC9zcGFuPjwvZGl2PiIpLCBkID0gImlkPSdqU2F2ZUJ1dHRvbl8iICsgbCArICInIG9uY2xpY2s9alF1ZXJ5LmZuLmZtYXR0ZXIucm93YWN0aW9ucy5jYWxsKHRoaXMsJ3NhdmUnKTsgIiArCiAgICAgICAgICAgICAgICAgICAgcSwgZSArPSAiPGRpdiB0aXRsZT0nIiArIGsuc2F2ZXRpdGxlICsgIicgc3R5bGU9J2Zsb2F0OmxlZnQ7ZGlzcGxheTpub25lJyBjbGFzcz0ndWktcGctZGl2IHVpLWlubGluZS1zYXZlJyAiICsgZCArICI+PHNwYW4gY2xhc3M9JyIgKyByLmljb25fYmFzZSArICIgIiArIHAuaWNvbl9zYXZlICsgIic+PC9zcGFuPjwvZGl2PiIsIGQgPSAiaWQ9J2pDYW5jZWxCdXR0b25fIiArIGwgKyAiJyBvbmNsaWNrPWpRdWVyeS5mbi5mbWF0dGVyLnJvd2FjdGlvbnMuY2FsbCh0aGlzLCdjYW5jZWwnKTsgIiArIHEsIGUgKz0gIjxkaXYgdGl0bGU9JyIgKyBrLmNhbmNlbHRpdGxlICsgIicgc3R5bGU9J2Zsb2F0OmxlZnQ7ZGlzcGxheTpub25lOycgY2xhc3M9J3VpLXBnLWRpdiB1aS1pbmxpbmUtY2FuY2VsJyAiICsgZCArICI+PHNwYW4gY2xhc3M9JyIgKyByLmljb25fYmFzZSArICIgIiArIHAuaWNvbl9jYW5jZWwgKyAiJz48L3NwYW4+PC9kaXY+IiwgIjxkaXYgc3R5bGU9J21hcmdpbi1sZWZ0OjhweDsnPiIgKyBlICsgIjwvZGl2PiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS51bmZvcm1hdCA9IGZ1bmN0aW9uKGIsIGMsIGQsIGcpIHsKICAgICAgICAgICAgICAgIHZhciBsLAogICAgICAgICAgICAgICAgICAgIGUgPSBjLmNvbE1vZGVsLmZvcm1hdHRlciwKICAgICAgICAgICAgICAgICAgICBrID0gYy5jb2xNb2RlbC5mb3JtYXRvcHRpb25zIHx8IHt9LAogICAgICAgICAgICAgICAgICAgIHAgPSAvKFtcLlwqXF9cJ1woXClce1x9XCtcP1xcXSkvZywKICAgICAgICAgICAgICAgICAgICByID0gYy5jb2xNb2RlbC51bmZvcm1hdCB8fCBhLmZuLmZtYXR0ZXJbZV0gJiYgYS5mbi5mbWF0dGVyW2VdLnVuZm9ybWF0OwogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gciAmJiBhLmlzRnVuY3Rpb24ocikpIGwgPSByLmNhbGwodGhpcywgYShiKS50ZXh0KCksIGMsIGIpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodm9pZCAwICE9PSBlICYmIGEuZm1hdHRlci5pc1N0cmluZyhlKSkgc3dpdGNoIChsID0gYS5qZ3JpZC5nZXRSZWdpb25hbCh0aGlzLCAiZm9ybWF0dGVyIikgfHwge30sIGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJpbnRlZ2VyIjoKICAgICAgICAgICAgICAgICAgICAgICAgayA9IGEuZXh0ZW5kKHt9LCBsLmludGVnZXIsIGspOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gay50aG91c2FuZHNTZXBhcmF0b3IucmVwbGFjZShwLCAiXFwkMSIpOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gbmV3IFJlZ0V4cChjLCAiZyIpOwogICAgICAgICAgICAgICAgICAgICAgICBsID0gYShiKS50ZXh0KCkucmVwbGFjZShjLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmV4dGVuZCh7fSwgbC5udW1iZXIsIGspOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gay50aG91c2FuZHNTZXBhcmF0b3IucmVwbGFjZShwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxcJDEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IG5ldyBSZWdFeHAoYywgImciKTsKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoYikudGV4dCgpLnJlcGxhY2UoYywgIiIpLnJlcGxhY2Uoay5kZWNpbWFsU2VwYXJhdG9yLCAiLiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjdXJyZW5jeSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmV4dGVuZCh7fSwgbC5jdXJyZW5jeSwgayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBrLnRob3VzYW5kc1NlcGFyYXRvci5yZXBsYWNlKHAsICJcXCQxIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBuZXcgUmVnRXhwKGMsICJnIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhKGIpLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgay5wcmVmaXggJiYgay5wcmVmaXgubGVuZ3RoICYmIChsID0gbC5zdWJzdHIoay5wcmVmaXgubGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGsuc3VmZml4ICYmIGsuc3VmZml4Lmxlbmd0aCAmJiAobCA9IGwuc3Vic3RyKDAsIGwubGVuZ3RoIC0gay5zdWZmaXgubGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBsLnJlcGxhY2UoYywgIiIpLnJlcGxhY2Uoay5kZWNpbWFsU2VwYXJhdG9yLCAiLiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjaGVja2JveCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBjLmNvbE1vZGVsLmVkaXRvcHRpb25zID8gYy5jb2xNb2RlbC5lZGl0b3B0aW9ucy52YWx1ZS5zcGxpdCgiOiIpIDogWyJZZXMiLCAiTm8iXTsKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGEoImlucHV0IiwgYikuaXMoIjpjaGVja2VkIikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAga1swXSA6IGtbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInNlbGVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBhLnVuZm9ybWF0LnNlbGVjdChiLCBjLCBkLCBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiYWN0aW9ucyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBsID0gYShiKS50ZXh0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgIT09IGwgPyBsIDogITAgPT09IGcgPyBhKGIpLnRleHQoKSA6IGEuamdyaWQuaHRtbERlY29kZShhKGIpLmh0bWwoKSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS51bmZvcm1hdC5zZWxlY3QgPSBmdW5jdGlvbihiLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICBkID0gW107CiAgICAgICAgICAgICAgICBiID0gYShiKS50ZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoITAgPT09IGcpIHJldHVybiBiOwogICAgICAgICAgICAgICAgZyA9IGEuZXh0ZW5kKHt9LCB2b2lkIDAgIT09IGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucyA/IGMuY29sTW9kZWwuZm9ybWF0b3B0aW9ucyA6IGMuY29sTW9kZWwuZWRpdG9wdGlvbnMpOwogICAgICAgICAgICAgICAgYyA9IHZvaWQgMCA9PT0gZy5zZXBhcmF0b3IgPyAiOiIgOiBnLnNlcGFyYXRvcjsKICAgICAgICAgICAgICAgIHZhciBsID0gdm9pZCAwID09PSBnLmRlbGltaXRlciA/ICI7IiA6IGcuZGVsaW1pdGVyOwogICAgICAgICAgICAgICAgaWYgKGcudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSwgayA9IGcudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZyA9ICEwID09PSBnLm11bHRpcGxlID8gITAgOiAhMTsKICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChwID0gYi5zcGxpdCgiLCIpLCBwID0gYS5tYXAocCwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEudHJpbShiKQogICAgICAgICAgICAgICAgICAgICAgICB9KSksIGEuZm1hdHRlci5pc1N0cmluZyhrKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgciA9IGsuc3BsaXQobCksIHEgPSAwLCBsID0gMDsgbCA8IHIubGVuZ3RoOyBsKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IHJbbF0uc3BsaXQoYyksIDIgPCBlLmxlbmd0aCAmJiAoZVsxXSA9IGEubWFwKGUsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPCBiID8gYSA6IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oYykpLCBnKSAtIDEgPCBhLmluQXJyYXkoYS50cmltKGVbMV0pLCBwKSAmJiAoZFtxXSA9IGVbMF0sIHErKyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS50cmltKGVbMV0pID09PSBhLnRyaW0oYikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFswXSA9IGVbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlKGEuZm1hdHRlci5pc09iamVjdChrKSB8fCBhLmlzQXJyYXkoaykpICYmIChnIHx8IChwWzBdID0gYiksIGQgPSBhLm1hcChwLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5lYWNoKGssIGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID09PSBiID8gKGMgPSBhLCAhMSkgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgfSksIHZvaWQgMCAhPT0gYyA/IGMgOiB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuam9pbigiLCAiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGIgfHwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICB9OwogICAgICAgICAgICBhLnVuZm9ybWF0LmRhdGUgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEuamdyaWQuZ2V0UmVnaW9uYWwodGhpcywgImZvcm1hdHRlci5kYXRlIikgfHwge307CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBjLmZvcm1hdG9wdGlvbnMgJiYgKGQgPSBhLmV4dGVuZCh7fSwgZCwgYy5mb3JtYXRvcHRpb25zKSksIGEuZm1hdHRlci5pc0VtcHR5KGIpID8gYS5mbi5mbWF0dGVyLmRlZmF1bHRGb3JtYXQoYiwgYykgOiBhLmpncmlkLnBhcnNlRGF0ZS5jYWxsKHRoaXMsIGQubmV3Zm9ybWF0LCBiLCBkLnNyY2Zvcm1hdCwgZCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgd2luZG93LmpxR3JpZFV0aWxzID0gewogICAgICAgICAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGEsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGIgPyBiLnRvU3RyaW5nKCkgOiBiCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwYXJzZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGEsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBiICYmIC0xICE9PSBiLmluZGV4T2YoImZ1bmN0aW9uIikgPyBldmFsKCIoIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICsgIikiKSA6IGIKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVuY29kZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcoYSkucmVwbGFjZSgvJi9nLCAiJmFtcDsiKS5yZXBsYWNlKC88L2csICImbHQ7IikucmVwbGFjZSgvPi9nLCAiJmd0OyIpLnJlcGxhY2UoLyIvZywgIiZxdW90OyIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAganNvblRvWE1MOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWxEZWNsOiAnPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+XG4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cl9wcmVmaXg6ICItIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZTogITAKICAgICAgICAgICAgICAgICAgICAgICAgfSwgYyB8fCB7fSksCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIjdGV4dCIgPT09IGEgPyBkLmVuY29kZSA/IGcuZW5jb2RlKGIpIDogYiA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGIgPyAiPCIgKyBhICsgIj48IVtDREFUQVsiICsgYiArICJdXVx4M2U8LyIgKyBhICsgIj5cbiIgOiAiIiA9PT0gYiA/ICI8IiArIGEgKyAiPl9fRU1QVFlfU1RSSU5HXzwvIiArIGEgKyAiPlxuIiA6ICI8IiArIGEgKyAiPiIgKyAoZC5lbmNvZGUgPyBnLmVuY29kZShiKSA6IGIpICsgIjwvIiArIGEgKyAiPlxuIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBlID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IFtdLCBkID0gMDsgZCA8IGIubGVuZ3RoOyBkKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGJbZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY1tjLmxlbmd0aF0gPSAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZiB8fCBudWxsID09IGYgPyAiPCIgKyBhICsgIiAvPiIgOiAib2JqZWN0IiA9PSB0eXBlb2YgZiAmJiBmLmNvbnN0cnVjdG9yID09IEFycmF5ID8gZShhLCBmKSA6ICJvYmplY3QiID09IHR5cGVvZiBmID8gayhhLCBmKSA6IGwoYSwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLmxlbmd0aCB8fCAoY1swXSA9ICI8IiArIGEgKyAiPl9fRU1QVFlfQVJSQVlfPC8iICsgYSArICI+XG4iKSwgYy5qb2luKCIiKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBrID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSBpbiBiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLmhhc093blByb3BlcnR5KG0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gYlttXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5jaGFyQXQoMCkgIT09IGQuYXR0cl9wcmVmaXggPyBjW2MubGVuZ3RoXSA9IG51bGwgPT0gcCA/ICI8IiArIG0gKyAiIC8+IiA6ICJvYmplY3QiID09IHR5cGVvZiBwICYmIHAuY29uc3RydWN0b3IgPT09IEFycmF5ID8gZShtLCBwKSA6ICJvYmplY3QiID09IHR5cGVvZiBwID8gayhtLCBwKSA6IGwobSwgcCkgOiBmW2YubGVuZ3RoXSA9ICIgIiArIG0uc3Vic3RyaW5nKDEpICsgJz0iJyArIChkLmVuY29kZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmVuY29kZShwKSA6IHApICsgJyInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGYuam9pbigiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gYy5qb2luKCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGEgfHwgKG0gPSAwIDwgYy5sZW5ndGggPyBtLm1hdGNoKC9cbi8pID8gIjwiICsgYSArIGYgKyAiPlxuIiArIG0gKyAiPC8iICsgYSArICI+XG4iIDogIjwiICsgYSArIGYgKyAiPiIgKyBtICsgIjwvIiArIGEgKyAiPlxuIiA6ICI8IiArIGEgKyBmICsgIiAvPlxuIiksIG0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGsobnVsbCwgYik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQueG1sRGVjbCArIHAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB4bWxUb0pTT046IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VfYXJyYXk6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBhdHRyX3ByZWZpeDogIi0iCiAgICAgICAgICAgICAgICAgICAgfSwgYyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuZm9yY2VfYXJyYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBsID0gMDsgbCA8IGQuZm9yY2VfYXJyYXkubGVuZ3RoOyBsKyspIGdbZC5mb3JjZV9hcnJheVtsXV0gPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiAoYiA9IGEucGFyc2VYTUwoYikpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmRvY3VtZW50RWxlbWVudCAmJiAoYiA9IGIuZG9jdW1lbnRFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmluZGV4T2YoImZ1bmN0aW9uIikpIGQgPSBldmFsKCIoIiArIGQgKyAiKSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHN3aXRjaCAoZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiX19FTVBUWV9BUlJBWV8iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIl9fRU1QVFlfU1RSSU5HXyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmFsc2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1tiXSA/ICgxID09PSBjICYmIChhW2JdID0gW10pLCBhW2JdW2FbYl0ubGVuZ3RoXSA9IGQpIDogMSA9PT0gYyA/IGFbYl0gPSBkIDogMiA9PT0gYyA/IGFbYl0gPSBbYVtiXSwgZF0gOiBhW2JdW2FbYl0ubGVuZ3RoXSA9IGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICg3ICE9PSBhLm5vZGVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgzID09PSBhLm5vZGVUeXBlIHx8IDQgPT09IGEubm9kZVR5cGUpIHJldHVybiBudWxsID09IGEubm9kZVZhbHVlLm1hdGNoKC9bXlx4MDAtXHgyMF0vKSA/IHZvaWQgMCA6IGEubm9kZVZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYywgZiwgZywgbSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5hdHRyaWJ1dGVzICYmIGEuYXR0cmlidXRlcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSB7fSwgYyA9IDA7IGMgPCBhLmF0dHJpYnV0ZXMubGVuZ3RoOyBjKyspIGYgPSBhLmF0dHJpYnV0ZXNbY10ubm9kZU5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIGYgJiYgKGcgPSBhLmF0dHJpYnV0ZXNbY10ubm9kZVZhbHVlLCBnICYmIChmID0gZC5hdHRyX3ByZWZpeCArIGYsICJ1bmRlZmluZWQiID09IHR5cGVvZiBtW2ZdICYmIChtW2ZdID0gMCksIG1bZl0rKywgZShiLCBmLCBtW2ZdLCBnKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5jaGlsZE5vZGVzICYmIGEuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgKGYgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5jaGlsZE5vZGVzLmxlbmd0aCAmJiBmOyBjKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGEuY2hpbGROb2Rlc1tjXS5ub2RlVHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzICE9PSBsICYmIDQgIT09IGwgJiYgKGYgPSAhMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiB8fCAoYiA9ICIiKSwgYyA9IDA7IGMgPCBhLmNoaWxkTm9kZXMubGVuZ3RoOyBjKyspIGIgKz0gYS5jaGlsZE5vZGVzW2NdLm5vZGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgfHwgKGIgPSB7fSksIGMgPSAwOyBjIDwgYS5jaGlsZE5vZGVzLmxlbmd0aDsgYysrKSBmID0gYS5jaGlsZE5vZGVzW2NdLm5vZGVOYW1lLCAic3RyaW5nIiA9PSB0eXBlb2YgZiAmJiAoZyA9IGsoYS5jaGlsZE5vZGVzW2NdKSwgZyAmJiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIG1bZl0gJiYgKG1bZl0gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwKSwgbVtmXSsrLCBlKGIsIGYsIG1bZl0sIGcpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gayhiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdbYi5ub2RlTmFtZV0gJiYgKGwgPSBbbF0pLCAxMSAhPT0gYi5ub2RlVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBbYi5ub2RlTmFtZV0gPSBsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbImpxdWVyeSIsICIuLi9ncmlkLmJhc2UiXSwgYSkgOiBhKGpRdWVyeSkKICAgICAgICB9KShmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGEuamdyaWQgPSBhLmpncmlkIHx8IHt9OwogICAgICAgICAgICBhLmpncmlkLmhhc093blByb3BlcnR5KCJyZWdpb25hbCIpIHx8IChhLmpncmlkLnJlZ2lvbmFsID0gW10pOwogICAgICAgICAgICBhLmpncmlkLnJlZ2lvbmFsLmVuID0gewogICAgICAgICAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgICAgICAgICAgICByZWNvcmR0ZXh0OiAiVmlldyB7MH0gLSB7MX0gb2YgezJ9IiwKICAgICAgICAgICAgICAgICAgICBlbXB0eXJlY29yZHM6ICJObyByZWNvcmRzIHRvIHZpZXciLAogICAgICAgICAgICAgICAgICAgIGxvYWR0ZXh0OiAiTG9hZGluZy4uLiIsCiAgICAgICAgICAgICAgICAgICAgc2F2ZXRleHQ6ICJTYXZpbmcuLi4iLAogICAgICAgICAgICAgICAgICAgIHBndGV4dDogIlBhZ2UgezB9IG9mIHsxfSIsCiAgICAgICAgICAgICAgICAgICAgcGdmaXJzdDogIkZpcnN0IFBhZ2UiLAogICAgICAgICAgICAgICAgICAgIHBnbGFzdDogIkxhc3QgUGFnZSIsCiAgICAgICAgICAgICAgICAgICAgcGduZXh0OiAiTmV4dCBQYWdlIiwKICAgICAgICAgICAgICAgICAgICBwZ3ByZXY6ICJQcmV2aW91cyBQYWdlIiwKICAgICAgICAgICAgICAgICAgICBwZ3JlY3M6ICJSZWNvcmRzIHBlciBQYWdlIiwKICAgICAgICAgICAgICAgICAgICBzaG93aGlkZTogIlRvZ2dsZSBFeHBhbmQgQ29sbGFwc2UgR3JpZCIsCiAgICAgICAgICAgICAgICAgICAgcGFnZXJDYXB0aW9uOiAiR3JpZDo6UGFnZSBTZXR0aW5ncyIsCiAgICAgICAgICAgICAgICAgICAgcGFnZVRleHQ6ICJQYWdlOiIsCiAgICAgICAgICAgICAgICAgICAgcmVjb3JkUGFnZTogIlJlY29yZHMgcGVyIFBhZ2UiLAogICAgICAgICAgICAgICAgICAgIG5vbW9yZXJlY3M6ICJObyBtb3JlIHJlY29yZHMuLi4iLAogICAgICAgICAgICAgICAgICAgIHNjcm9sbFB1bGx1cDogIlB1bGwgdXAgdG8gbG9hZCBtb3JlLi4uIiwKICAgICAgICAgICAgICAgICAgICBzY3JvbGxQdWxsZG93bjogIlB1bGwgZG93biB0byByZWZyZXNoLi4uIiwKICAgICAgICAgICAgICAgICAgICBzY3JvbGxSZWZyZXNoOiAiUmVsZWFzZSB0byByZWZyZXNoLi4uIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlYXJjaDogewogICAgICAgICAgICAgICAgICAgIGNhcHRpb246ICJTZWFyY2guLi4iLAogICAgICAgICAgICAgICAgICAgIEZpbmQ6ICJGaW5kIiwKICAgICAgICAgICAgICAgICAgICBSZXNldDogIlJlc2V0IiwKICAgICAgICAgICAgICAgICAgICBvZGF0YTogW3sKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogImVxIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImVxdWFsIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogIm5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIm5vdCBlcXVhbCIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJsdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJsZXNzIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogImxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImxlc3Mgb3IgZXF1YWwiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAiZ3QiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiZ3JlYXRlciIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJncmVhdGVyIG9yIGVxdWFsIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogImJ3IiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImJlZ2lucyB3aXRoIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogImJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImRvZXMgbm90IGJlZ2luIHdpdGgiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAiaW4iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgaW4iCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAibmkiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgbm90IGluIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogImV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImVuZHMgd2l0aCIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJkb2VzIG5vdCBlbmQgd2l0aCIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJjbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJjb250YWlucyIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXI6ICJuYyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJkb2VzIG5vdCBjb250YWluIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcjogIm51IiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImlzIG51bGwiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVyOiAibm4iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgbm90IG51bGwiCiAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBPcHM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wOiAiQU5EIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImFsbCIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wOiAiT1IiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiYW55IgogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgIG9wZXJhbmRUaXRsZTogIkNsaWNrIHRvIHNlbGVjdCBzZWFyY2ggb3BlcmF0aW9uLiIsCiAgICAgICAgICAgICAgICAgICAgcmVzZXRUaXRsZTogIlJlc2V0IFNlYXJjaCBWYWx1ZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlZGl0OiB7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FwdGlvbjogIkFkZCBSZWNvcmQiLAogICAgICAgICAgICAgICAgICAgIGVkaXRDYXB0aW9uOiAiRWRpdCBSZWNvcmQiLAogICAgICAgICAgICAgICAgICAgIGJTdWJtaXQ6ICJTdWJtaXQiLAogICAgICAgICAgICAgICAgICAgIGJDYW5jZWw6ICJDYW5jZWwiLAogICAgICAgICAgICAgICAgICAgIGJDbG9zZTogIkNsb3NlIiwKICAgICAgICAgICAgICAgICAgICBzYXZlRGF0YTogIkRhdGEgaGFzIGJlZW4gY2hhbmdlZCEgU2F2ZSBjaGFuZ2VzPyIsCiAgICAgICAgICAgICAgICAgICAgYlllczogIlllcyIsCiAgICAgICAgICAgICAgICAgICAgYk5vOiAiTm8iLAogICAgICAgICAgICAgICAgICAgIGJFeGl0OiAiQ2FuY2VsIiwKICAgICAgICAgICAgICAgICAgICBtc2c6IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6ICJGaWVsZCBpcyByZXF1aXJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcjogIlBsZWFzZSwgZW50ZXIgdmFsaWQgbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsdWU6ICJ2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAiLAogICAgICAgICAgICAgICAgICAgICAgICBtYXhWYWx1ZTogInZhbHVlIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIiwKICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6ICJpcyBub3QgYSB2YWxpZCBlLW1haWwiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnRlZ2VyOiAiUGxlYXNlLCBlbnRlciB2YWxpZCBpbnRlZ2VyIHZhbHVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogIlBsZWFzZSwgZW50ZXIgdmFsaWQgZGF0ZSB2YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogImlzIG5vdCBhIHZhbGlkIFVSTC4gUHJlZml4IHJlcXVpcmVkICgnaHR0cDovLycgb3IgJ2h0dHBzOi8vJykiLAogICAgICAgICAgICAgICAgICAgICAgICBub2RlZmluZWQ6ICIgaXMgbm90IGRlZmluZWQhIiwKICAgICAgICAgICAgICAgICAgICAgICAgbm92YWx1ZTogIiByZXR1cm4gdmFsdWUgaXMgcmVxdWlyZWQhIiwKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tYXJyYXk6ICJDdXN0b20gZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhcnJheSEiLAogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21mY2hlY2s6ICJDdXN0b20gZnVuY3Rpb24gc2hvdWxkIGJlIHByZXNlbnQgaW4gY2FzZSBvZiBjdXN0b20gY2hlY2tpbmchIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2aWV3OiB7CiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogIlZpZXcgUmVjb3JkIiwKICAgICAgICAgICAgICAgICAgICBiQ2xvc2U6ICJDbG9zZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkZWw6IHsKICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiAiRGVsZXRlIiwKICAgICAgICAgICAgICAgICAgICBtc2c6ICJEZWxldGUgc2VsZWN0ZWQgcmVjb3JkKHMpPyIsCiAgICAgICAgICAgICAgICAgICAgYlN1Ym1pdDogIkRlbGV0ZSIsCiAgICAgICAgICAgICAgICAgICAgYkNhbmNlbDogIkNhbmNlbCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuYXY6IHsKICAgICAgICAgICAgICAgICAgICBlZGl0dGV4dDogIiIsCiAgICAgICAgICAgICAgICAgICAgZWRpdHRpdGxlOiAiRWRpdCBzZWxlY3RlZCByb3ciLAogICAgICAgICAgICAgICAgICAgIGFkZHRleHQ6ICIiLAogICAgICAgICAgICAgICAgICAgIGFkZHRpdGxlOiAiQWRkIG5ldyByb3ciLAogICAgICAgICAgICAgICAgICAgIGRlbHRleHQ6ICIiLAogICAgICAgICAgICAgICAgICAgIGRlbHRpdGxlOiAiRGVsZXRlIHNlbGVjdGVkIHJvdyIsCiAgICAgICAgICAgICAgICAgICAgc2VhcmNodGV4dDogIiIsCiAgICAgICAgICAgICAgICAgICAgc2VhcmNodGl0bGU6ICJGaW5kIHJlY29yZHMiLAogICAgICAgICAgICAgICAgICAgIHJlZnJlc2h0ZXh0OiAiIiwKICAgICAgICAgICAgICAgICAgICByZWZyZXNodGl0bGU6ICJSZWxvYWQgR3JpZCIsCiAgICAgICAgICAgICAgICAgICAgYWxlcnRjYXA6ICJXYXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICBhbGVydHRleHQ6ICJQbGVhc2UsIHNlbGVjdCByb3ciLAogICAgICAgICAgICAgICAgICAgIHZpZXd0ZXh0OiAiIiwKICAgICAgICAgICAgICAgICAgICB2aWV3dGl0bGU6ICJWaWV3IHNlbGVjdGVkIHJvdyIsCiAgICAgICAgICAgICAgICAgICAgc2F2ZXRleHQ6ICIiLAogICAgICAgICAgICAgICAgICAgIHNhdmV0aXRsZTogIlNhdmUgcm93IiwKICAgICAgICAgICAgICAgICAgICBjYW5jZWx0ZXh0OiAiIiwKICAgICAgICAgICAgICAgICAgICBjYW5jZWx0aXRsZTogIkNhbmNlbCByb3cgZWRpdGluZyIsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0Y2FwdGlvbjogIkFjdGlvbnMuLi4iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sOiB7CiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogIlNlbGVjdCBjb2x1bW5zIiwKICAgICAgICAgICAgICAgICAgICBiU3VibWl0OiAiT2siLAogICAgICAgICAgICAgICAgICAgIGJDYW5jZWw6ICJDYW5jZWwiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JzOiB7CiAgICAgICAgICAgICAgICAgICAgZXJyY2FwOiAiRXJyb3IiLAogICAgICAgICAgICAgICAgICAgIG5vdXJsOiAiTm8gdXJsIGlzIHNldCIsCiAgICAgICAgICAgICAgICAgICAgbm9yZWNvcmRzOiAiTm8gcmVjb3JkcyB0byBwcm9jZXNzIiwKICAgICAgICAgICAgICAgICAgICBtb2RlbDogIkxlbmd0aCBvZiBjb2xOYW1lcyA8PiBjb2xNb2RlbCEiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm9ybWF0dGVyOiB7CiAgICAgICAgICAgICAgICAgICAgaW50ZWdlcjogewogICAgICAgICAgICAgICAgICAgICAgICB0aG91c2FuZHNTZXBhcmF0b3I6ICIsIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG51bWJlcjogewogICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsU2VwYXJhdG9yOiAiLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRob3VzYW5kc1NlcGFyYXRvcjogIiwiLAogICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsUGxhY2VzOiAyLAogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIwLjAwIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVjaW1hbFNlcGFyYXRvcjogIi4iLAogICAgICAgICAgICAgICAgICAgICAgICB0aG91c2FuZHNTZXBhcmF0b3I6ICIsIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVjaW1hbFBsYWNlczogMiwKICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMC4wMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF5TmFtZXM6ICJTdW4gTW9uIFR1ZSBXZWQgVGhyIEZyaSBTYXQgU3VuZGF5IE1vbmRheSBUdWVzZGF5IFdlZG5lc2RheSBUaHVyc2RheSBGcmlkYXkgU2F0dXJkYXkiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoTmFtZXM6ICJKYW4gRmViIE1hciBBcHIgTWF5IEp1biBKdWwgQXVnIFNlcCBPY3QgTm92IERlYyBKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgICAgICBBbVBtOiBbImFtIiwgInBtIiwgIkFNIiwgIlBNIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIFM6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxMSA+IGEgfHwgMTMgPCBhID8gWyJzdCIsICJuZCIsICJyZCIsICJ0aCJdW01hdGgubWluKChhIC0gMSkgJSAxMCwgMyldIDogInRoIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzcmNmb3JtYXQ6ICJZLW0tZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld2Zvcm1hdDogIm4vai9ZIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VSZTogL1sjJVxcXC86XzsuLFx0XHMtXS8sCiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2tzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJU084NjAxTG9uZzogIlktbS1kIEg6aTpzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElTTzg2MDFTaG9ydDogIlktbS1kIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3J0RGF0ZTogIm4vai9ZIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvbmdEYXRlOiAibCwgRiBkLCBZIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bGxEYXRlVGltZTogImwsIEYgZCwgWSBnOmk6cyBBIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vbnRoRGF5OiAiRiBkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3J0VGltZTogImc6aSBBIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvbmdUaW1lOiAiZzppOnMgQSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3J0YWJsZURhdGVUaW1lOiAiWS1tLWRcXFRIOmk6cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbml2ZXJzYWxTb3J0YWJsZURhdGVUaW1lOiAiWS1tLWQgSDppOnNPIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFllYXJNb250aDogIkYsIFkiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZm9ybWF0QWZ0ZXJFZGl0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlckxvY2FsVGltZTogITEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGJhc2VMaW5rVXJsOiAiIiwKICAgICAgICAgICAgICAgICAgICBzaG93QWN0aW9uOiAiIiwKICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6ICIiLAogICAgICAgICAgICAgICAgICAgIGNoZWNrYm94OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiAhMAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaWROYW1lOiAiaWQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZGVmaW5lICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWyJqcXVlcnkiXSwgYSkgOiBhKGpRdWVyeSkKICAgICAgICB9KShmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHAoYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQsIGc7CiAgICAgICAgICAgICAgICBkID0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKCJhcmVhIiA9PT0gZCkgewogICAgICAgICAgICAgICAgICAgIGQgPSBiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgZyA9IGQubmFtZTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWIuaHJlZiB8fCAhZyB8fCAibWFwIiAhPT0gZC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgZCA9IGEoImltZ1t1c2VtYXA9JyMiICsgZyArICInXSIpWzBdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWQgJiYgayhkKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICgvXihpbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkLy50ZXN0KGQpID8gIWIuZGlzYWJsZWQgOiAiYSIgPT09IGQgPyBiLmhyZWYgfHwgYyA6IGMpICYmIGsoYikKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gayhiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5leHByLmZpbHRlcnMudmlzaWJsZShiKSAmJiAhYShiKS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImhpZGRlbiIgPT09IGEuY3NzKHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2aXNpYmlsaXR5IikKICAgICAgICAgICAgICAgIH0pLmxlbmd0aAogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBEKGEpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGM7IGEubGVuZ3RoICYmIGFbMF0gIT09IGRvY3VtZW50OykgewogICAgICAgICAgICAgICAgICAgIGMgPSBhLmNzcygicG9zaXRpb24iKTsKICAgICAgICAgICAgICAgICAgICBpZiAoImFic29sdXRlIiA9PT0gYyB8fCAicmVsYXRpdmUiID09PSBjIHx8ICJmaXhlZCIgPT09IGMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gcGFyc2VJbnQoYS5jc3MoInpJbmRleCIpLCAxMCksICFpc05hTihjKSAmJiAwICE9PSBjKSByZXR1cm4gYzsKICAgICAgICAgICAgICAgICAgICBhID0gYS5wYXJlbnQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2N1ckluc3QgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fa2V5RXZlbnQgPSAhMTsKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkSW5wdXRzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLl9pbkRpYWxvZyA9IHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nID0gITE7CiAgICAgICAgICAgICAgICB0aGlzLl9tYWluRGl2SWQgPSAidWktZGF0ZXBpY2tlci1kaXYiOwogICAgICAgICAgICAgICAgdGhpcy5faW5saW5lQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1pbmxpbmUiOwogICAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1hcHBlbmQiOwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlckNsYXNzID0gInVpLWRhdGVwaWNrZXItdHJpZ2dlciI7CiAgICAgICAgICAgICAgICB0aGlzLl9kaWFsb2dDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRpYWxvZyI7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1kaXNhYmxlZCI7CiAgICAgICAgICAgICAgICB0aGlzLl91bnNlbGVjdGFibGVDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLXVuc2VsZWN0YWJsZSI7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50Q2xhc3MgPSAidWktZGF0ZXBpY2tlci1jdXJyZW50LWRheSI7CiAgICAgICAgICAgICAgICB0aGlzLl9kYXlPdmVyQ2xhc3MgPSAidWktZGF0ZXBpY2tlci1kYXlzLWNlbGwtb3ZlciI7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvbmFsID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvbmFsWyIiXSA9IHsKICAgICAgICAgICAgICAgICAgICBjbG9zZVRleHQ6ICJEb25lIiwKICAgICAgICAgICAgICAgICAgICBwcmV2VGV4dDogIlByZXYiLAogICAgICAgICAgICAgICAgICAgIG5leHRUZXh0OiAiTmV4dCIsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFRleHQ6ICJUb2RheSIsCiAgICAgICAgICAgICAgICAgICAgbW9udGhOYW1lczogIkphbnVhcnkgRmVicnVhcnkgTWFyY2ggQXByaWwgTWF5IEp1bmUgSnVseSBBdWd1c3QgU2VwdGVtYmVyIE9jdG9iZXIgTm92ZW1iZXIgRGVjZW1iZXIiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgbW9udGhOYW1lc1Nob3J0OiAiSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWMiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgZGF5TmFtZXM6ICJTdW5kYXkgTW9uZGF5IFR1ZXNkYXkgV2VkbmVzZGF5IFRodXJzZGF5IEZyaWRheSBTYXR1cmRheSIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgICAgICBkYXlOYW1lc1Nob3J0OiAiU3VuIE1vbiBUdWUgV2VkIFRodSBGcmkgU2F0Ii5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgIGRheU5hbWVzTWluOiAiU3UgTW8gVHUgV2UgVGggRnIgU2EiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgd2Vla0hlYWRlcjogIldrIiwKICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0OiAibW0vZGQveXkiLAogICAgICAgICAgICAgICAgICAgIGZpcnN0RGF5OiAwLAogICAgICAgICAgICAgICAgICAgIGlzUlRMOiAhMSwKICAgICAgICAgICAgICAgICAgICBzaG93TW9udGhBZnRlclllYXI6ICExLAogICAgICAgICAgICAgICAgICAgIHllYXJTdWZmaXg6ICIiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdHMgPSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd09uOiAiZm9jdXMiLAogICAgICAgICAgICAgICAgICAgIHNob3dBbmltOiAiZmFkZUluIiwKICAgICAgICAgICAgICAgICAgICBzaG93T3B0aW9uczoge30sCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdERhdGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVGV4dDogIiIsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uVGV4dDogIi4uLiIsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSW1hZ2U6ICIiLAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbkltYWdlT25seTogITEsCiAgICAgICAgICAgICAgICAgICAgaGlkZUlmTm9QcmV2TmV4dDogITEsCiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbkFzRGF0ZUZvcm1hdDogITEsCiAgICAgICAgICAgICAgICAgICAgZ290b0N1cnJlbnQ6ICExLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZU1vbnRoOiAhMSwKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VZZWFyOiAhMSwKICAgICAgICAgICAgICAgICAgICB5ZWFyUmFuZ2U6ICJjLTEwOmMrMTAiLAogICAgICAgICAgICAgICAgICAgIHNob3dPdGhlck1vbnRoczogITEsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0T3RoZXJNb250aHM6ICExLAogICAgICAgICAgICAgICAgICAgIHNob3dXZWVrOiAhMSwKICAgICAgICAgICAgICAgICAgICBjYWxjdWxhdGVXZWVrOiB0aGlzLmlzbzg2MDFXZWVrLAogICAgICAgICAgICAgICAgICAgIHNob3J0WWVhckN1dG9mZjogIisxMCIsCiAgICAgICAgICAgICAgICAgICAgbWluRGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBtYXhEYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAiZmFzdCIsCiAgICAgICAgICAgICAgICAgICAgYmVmb3JlU2hvd0RheTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBiZWZvcmVTaG93OiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlTW9udGhZZWFyOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbnVtYmVyT2ZNb250aHM6IDEsCiAgICAgICAgICAgICAgICAgICAgc2hvd0N1cnJlbnRBdFBvczogMCwKICAgICAgICAgICAgICAgICAgICBzdGVwTW9udGhzOiAxLAogICAgICAgICAgICAgICAgICAgIHN0ZXBCaWdNb250aHM6IDEyLAogICAgICAgICAgICAgICAgICAgIGFsdEZpZWxkOiAiIiwKICAgICAgICAgICAgICAgICAgICBhbHRGb3JtYXQ6ICIiLAogICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbklucHV0OiAhMCwKICAgICAgICAgICAgICAgICAgICBzaG93QnV0dG9uUGFuZWw6ICExLAogICAgICAgICAgICAgICAgICAgIGF1dG9TaXplOiAhMSwKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogITEKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBhLmV4dGVuZCh0aGlzLl9kZWZhdWx0cywgdGhpcy5yZWdpb25hbFsiIl0pOwogICAgICAgICAgICAgICAgdGhpcy5yZWdpb25hbC5lbiA9IGEuZXh0ZW5kKCEwLCB7fSwgdGhpcy5yZWdpb25hbFsiIl0pOwogICAgICAgICAgICAgICAgdGhpcy5yZWdpb25hbFsiZW4tVVMiXSA9IGEuZXh0ZW5kKCEwLCB7fSwgdGhpcy5yZWdpb25hbC5lbik7CiAgICAgICAgICAgICAgICB0aGlzLmRwRGl2ID0gRihhKCI8ZGl2IGlkPSciICsgdGhpcy5fbWFpbkRpdklkICsgIicgY2xhc3M9J3VpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gRihiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYi5kZWxlZ2F0ZSgiYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhIiwgIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKTsgLSAxICE9PSB0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLXByZXYiKSAmJiBhKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1kYXRlcGlja2VyLXByZXYtaG92ZXIiKTsgLSAxICE9PSB0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLW5leHQiKSAmJgogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1kYXRlcGlja2VyLW5leHQtaG92ZXIiKQogICAgICAgICAgICAgICAgfSkuZGVsZWdhdGUoImJ1dHRvbiwgLnVpLWRhdGVwaWNrZXItcHJldiwgLnVpLWRhdGVwaWNrZXItbmV4dCwgLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgdGQgYSIsICJtb3VzZW92ZXIiLCBNKQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBNKCkgewogICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihXLmlubGluZSA/IFcuZHBEaXYucGFyZW50KClbMF0gOiBXLmlucHV0WzBdKSB8fCAoYSh0aGlzKS5wYXJlbnRzKCIudWktZGF0ZXBpY2tlci1jYWxlbmRhciIpLmZpbmQoImEiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKSwgYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKSwgLTEgIT09IHRoaXMuY2xhc3NOYW1lLmluZGV4T2YoInVpLWRhdGVwaWNrZXItcHJldiIpICYmIGEodGhpcykuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciIpLCAtMSAhPT0gdGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1uZXh0IikgJiYKICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKCJ1aS1kYXRlcGlja2VyLW5leHQtaG92ZXIiKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gSShiLCBjKSB7CiAgICAgICAgICAgICAgICBhLmV4dGVuZChiLCBjKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGQgaW4gYykgbnVsbCA9PSBjW2RdICYmIChiW2RdID0gY1tkXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBTKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuZWxlbWVudC52YWwoKTsKICAgICAgICAgICAgICAgICAgICBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpOwogICAgICAgICAgICAgICAgICAgIGMgIT09IHRoaXMuZWxlbWVudC52YWwoKSAmJiB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGEudWkgPSBhLnVpIHx8IHt9OwogICAgICAgICAgICBhLmV4dGVuZChhLnVpLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIGtleUNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBCQUNLU1BBQ0U6IDgsCiAgICAgICAgICAgICAgICAgICAgQ09NTUE6IDE4OCwKICAgICAgICAgICAgICAgICAgICBERUxFVEU6IDQ2LAogICAgICAgICAgICAgICAgICAgIERPV046IDQwLAogICAgICAgICAgICAgICAgICAgIEVORDogMzUsCiAgICAgICAgICAgICAgICAgICAgRU5URVI6IDEzLAogICAgICAgICAgICAgICAgICAgIEVTQ0FQRTogMjcsCiAgICAgICAgICAgICAgICAgICAgSE9NRTogMzYsCiAgICAgICAgICAgICAgICAgICAgTEVGVDogMzcsCiAgICAgICAgICAgICAgICAgICAgUEFHRV9ET1dOOiAzNCwKICAgICAgICAgICAgICAgICAgICBQQUdFX1VQOiAzMywKICAgICAgICAgICAgICAgICAgICBQRVJJT0Q6IDE5MCwKICAgICAgICAgICAgICAgICAgICBSSUdIVDogMzksCiAgICAgICAgICAgICAgICAgICAgU1BBQ0U6IDMyLAogICAgICAgICAgICAgICAgICAgIFRBQjogOSwKICAgICAgICAgICAgICAgICAgICBVUDogMzgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuZm4uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHNjcm9sbFBhcmVudDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jc3MoInBvc2l0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAiYWJzb2x1dGUiID09PSBjLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gYiA/IC8oYXV0b3xzY3JvbGx8aGlkZGVuKS8gOiAvKGF1dG98c2Nyb2xsKS87CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCAmJiAic3RhdGljIiA9PT0gYi5jc3MoInBvc2l0aW9uIikgPyAhMSA6IGcudGVzdChiLmNzcygib3ZlcmZsb3ciKSArIGIuY3NzKCJvdmVyZmxvdy15IikgKyBiLmNzcygib3ZlcmZsb3cteCIpKQogICAgICAgICAgICAgICAgICAgIH0pLmVxKDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAiZml4ZWQiICE9PSBjICYmIGIubGVuZ3RoID8gYiA6IGEodGhpc1swXS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCB8fCAodGhpcy5pZCA9ICJ1aS1pZC0iICsgKythKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0oKSwKICAgICAgICAgICAgICAgIHJlbW92ZVVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvXnVpLWlkLVxkKyQvLnRlc3QodGhpcy5pZCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQXR0cigiaWQiKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLmV4dGVuZChhLmV4cHJbIjoiXSwgewogICAgICAgICAgICAgICAgZGF0YTogYS5leHByLmNyZWF0ZVBzZXVkbyA/IGEuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWEuZGF0YShjLCBiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pIDogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWEuZGF0YShiLCBkWzNdKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZvY3VzYWJsZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwKGIsICFpc05hTihhLmF0dHIoYiwgInRhYmluZGV4IikpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRhYmJhYmxlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmF0dHIoYiwgInRhYmluZGV4IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBpc05hTihjKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGQgfHwgMCA8PSBjKSAmJiBwKGIsICFkKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYSgiPGE+Iikub3V0ZXJXaWR0aCgxKS5qcXVlcnkgfHwgYS5lYWNoKFsiV2lkdGgiLCAiSGVpZ2h0Il0sIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYiwgYywgZCwgZSkgewogICAgICAgICAgICAgICAgICAgIGEuZWFjaChnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYyAtPSBwYXJzZUZsb2F0KGEuY3NzKGIsICJwYWRkaW5nIiArIHRoaXMpKSB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICBkICYmIChjIC09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KGEuY3NzKGIsICJib3JkZXIiICsgdGhpcyArICJXaWR0aCIpKSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSAmJiAoYyAtPSBwYXJzZUZsb2F0KGEuY3NzKGIsICJtYXJnaW4iICsgdGhpcykpIHx8IDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBnID0gIldpZHRoIiA9PT0gYyA/IFsiTGVmdCIsICJSaWdodCJdIDogWyJUb3AiLCAiQm90dG9tIl0sCiAgICAgICAgICAgICAgICAgICAgZiA9IGMudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICBtID0gewogICAgICAgICAgICAgICAgICAgICAgICBpbm5lcldpZHRoOiBhLmZuLmlubmVyV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGlubmVySGVpZ2h0OiBhLmZuLmlubmVySGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBvdXRlcldpZHRoOiBhLmZuLm91dGVyV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVySGVpZ2h0OiBhLmZuLm91dGVySGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGEuZm5bImlubmVyIiArIGNdID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgPT09IGIgPyBtWyJpbm5lciIgKyBjXS5jYWxsKHRoaXMpIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmNzcyhmLCBkKHRoaXMsIGIpICsgInB4IikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGEuZm5bIm91dGVyIiArIGNdID0gZnVuY3Rpb24oYiwgZykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtYmVyIiAhPT0gdHlwZW9mIGIgPyBtWyJvdXRlciIgKyBjXS5jYWxsKHRoaXMsIGIpIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmNzcyhmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCh0aGlzLCBiLCAhMCwgZykgKyAicHgiKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLmZuLmFkZEJhY2sgfHwgKGEuZm4uYWRkQmFjayA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChudWxsID09IGEgPyB0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKGEpKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYSgiPGE+IikuZGF0YSgiYS1iIiwgImEiKS5yZW1vdmVEYXRhKCJhLWIiKS5kYXRhKCJhLWIiKSAmJiAoYS5mbi5yZW1vdmVEYXRhID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IGIuY2FsbCh0aGlzLCBhLmNhbWVsQ2FzZShjKSkgOiBiLmNhbGwodGhpcykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfShhLmZuLnJlbW92ZURhdGEpKTsKICAgICAgICAgICAgYS51aS5pZSA9ICEhL21zaWUgW1x3Ll0rLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgIGEuZm4uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1iZXIiID09PSB0eXBlb2YgYyA/IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgJiYgZC5jYWxsKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBjKQogICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGIuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0oYS5mbi5mb2N1cyksCiAgICAgICAgICAgICAgICBkaXNhYmxlU2VsZWN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9ICJvbnNlbGVjdHN0YXJ0IiBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSA/ICJzZWxlY3RzdGFydCIgOiAibW91c2Vkb3duIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJpbmQoYSArICIudWktZGlzYWJsZVNlbGVjdGlvbiIsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0oKSwKICAgICAgICAgICAgICAgIGVuYWJsZVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudW5iaW5kKCIudWktZGlzYWJsZVNlbGVjdGlvbiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgekluZGV4OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgcmV0dXJuIHRoaXMuY3NzKCJ6SW5kZXgiLCBiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEodGhpc1swXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGM7IGIubGVuZ3RoICYmIGJbMF0gIT09IGRvY3VtZW50OykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIuY3NzKCJwb3NpdGlvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJhYnNvbHV0ZSIgPT09IGMgfHwgInJlbGF0aXZlIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjIHx8ICJmaXhlZCIgPT09IGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPSBwYXJzZUludChiLmNzcygiekluZGV4IiksIDEwKSwgIWlzTmFOKGMpICYmIDAgIT09IGMpIHJldHVybiBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGIucGFyZW50KCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS51aS5wbHVnaW4gPSB7CiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZzsKICAgICAgICAgICAgICAgICAgICBiID0gYS51aVtiXS5wcm90b3R5cGU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChnIGluIGQpIGIucGx1Z2luc1tnXSA9IGIucGx1Z2luc1tnXSB8fCBbXSwgYi5wbHVnaW5zW2ddLnB1c2goW2MsIGRbZ11dKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNhbGw6IGZ1bmN0aW9uKGEsIGMsIGQsIGcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGMgPSBhLnBsdWdpbnNbY10pICYmIChnIHx8IGEuZWxlbWVudFswXS5wYXJlbnROb2RlICYmIDExICE9PSBhLmVsZW1lbnRbMF0ucGFyZW50Tm9kZS5ub2RlVHlwZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBjLmxlbmd0aDsgZysrKSBhLm9wdGlvbnNbY1tnXVswXV0gJiYgY1tnXVsxXS5hcHBseShhLmVsZW1lbnQsIGQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBPID0gMCwKICAgICAgICAgICAgICAgIFAgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgICAgICAgICAgIGEuY2xlYW5EYXRhID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgZjsKICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPQogICAgICAgICAgICAgICAgICAgICAgICAwOyBudWxsICE9IChnID0gY1tmXSk7IGYrKykgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgKGQgPSBhLl9kYXRhKGcsICJldmVudHMiKSkgJiYgZC5yZW1vdmUgJiYgYShnKS50cmlnZ2VySGFuZGxlcigicmVtb3ZlIikKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChtKSB7fQogICAgICAgICAgICAgICAgICAgIGIoYykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfShhLmNsZWFuRGF0YSk7CiAgICAgICAgICAgIGEud2lkZ2V0ID0gZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgdmFyIGcsIGYsIG0sIGgsIGsgPSB7fSwKICAgICAgICAgICAgICAgICAgICBsID0gYi5zcGxpdCgiLiIpWzBdOwogICAgICAgICAgICAgICAgYiA9IGIuc3BsaXQoIi4iKVsxXTsKICAgICAgICAgICAgICAgIGcgPSBsICsgIi0iICsgYjsKICAgICAgICAgICAgICAgIGQgfHwgKGQgPSBjLCBjID0gYS5XaWRnZXQpOwogICAgICAgICAgICAgICAgYS5leHByWyI6Il1bZy50b0xvd2VyQ2FzZSgpXSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFhLmRhdGEoYiwgZykKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBhW2xdID0gYVtsXSB8fCB7fTsKICAgICAgICAgICAgICAgIGYgPSBhW2xdW2JdOwogICAgICAgICAgICAgICAgbSA9IGFbbF1bYl0gPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9jcmVhdGVXaWRnZXQpIHJldHVybiBuZXcgbShhLCBiKTsKICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoICYmIHRoaXMuX2NyZWF0ZVdpZGdldChhLCBiKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGEuZXh0ZW5kKG0sIGYsIHsKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkLnZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgX3Byb3RvOiBhLmV4dGVuZCh7fSwgZCksCiAgICAgICAgICAgICAgICAgICAgX2NoaWxkQ29uc3RydWN0b3JzOiBbXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgICAgICBuZXcgYzsKICAgICAgICAgICAgICAgIGgub3B0aW9ucyA9IGEud2lkZ2V0LmV4dGVuZCh7fSwgaC5vcHRpb25zKTsKICAgICAgICAgICAgICAgIGEuZWFjaChkLCBmdW5jdGlvbihiLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGQpID8ga1tiXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLnByb3RvdHlwZVtiXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5wcm90b3R5cGVbYl0uYXBwbHkodGhpcywgYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5fc3VwZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuX3N1cGVyQXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyQXBwbHkgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyQXBwbHkgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0oKSA6IGtbYl0gPSBkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG0ucHJvdG90eXBlID0gYS53aWRnZXQuZXh0ZW5kKGgsIHsKICAgICAgICAgICAgICAgICAgICB3aWRnZXRFdmVudFByZWZpeDogZiA/IGgud2lkZ2V0RXZlbnRQcmVmaXggfHwgYiA6IGIKICAgICAgICAgICAgICAgIH0sIGssIHsKICAgICAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcjogbSwKICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IGwsCiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0TmFtZTogYiwKICAgICAgICAgICAgICAgICAgICB3aWRnZXRGdWxsTmFtZTogZwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmID8gKGEuZWFjaChmLl9jaGlsZENvbnN0cnVjdG9ycywgZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gYy5wcm90b3R5cGU7CiAgICAgICAgICAgICAgICAgICAgYS53aWRnZXQoZC5uYW1lc3BhY2UgKyAiLiIgKyBkLndpZGdldE5hbWUsIG0sIGMuX3Byb3RvKQogICAgICAgICAgICAgICAgfSksIGRlbGV0ZSBmLl9jaGlsZENvbnN0cnVjdG9ycykgOiBjLl9jaGlsZENvbnN0cnVjdG9ycy5wdXNoKG0pOwogICAgICAgICAgICAgICAgYS53aWRnZXQuYnJpZGdlKGIsIG0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS53aWRnZXQuZXh0ZW5kID0gZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IFAuY2FsbChhcmd1bWVudHMsIDEpLCBkID0gMCwgZyA9IGMubGVuZ3RoLCBmLCBtOyBkIDwgZzsgZCsrKQogICAgICAgICAgICAgICAgICAgIGZvciAoZiBpbiBjW2RdKSBtID0gY1tkXVtmXSwgY1tkXS5oYXNPd25Qcm9wZXJ0eShmKSAmJiB2b2lkIDAgIT09IG0gJiYgKGEuaXNQbGFpbk9iamVjdChtKSA/IGJbZl0gPSBhLmlzUGxhaW5PYmplY3QoYltmXSkgPyBhLndpZGdldC5leHRlbmQoe30sIGJbZl0sIG0pIDogYS53aWRnZXQuZXh0ZW5kKHt9LCBtKSA6IGJbZl0gPSBtKTsKICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEud2lkZ2V0LmJyaWRnZSA9IGZ1bmN0aW9uKGIsCiAgICAgICAgICAgICAgICBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGMucHJvdG90eXBlLndpZGdldEZ1bGxOYW1lIHx8IGI7CiAgICAgICAgICAgICAgICBhLmZuW2JdID0gZnVuY3Rpb24oZykgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gInN0cmluZyIgPT09IHR5cGVvZiBnLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gUC5jYWxsKGFyZ3VtZW50cywgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGYgPyB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBmID0gYS5kYXRhKHRoaXMsIGQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoImluc3RhbmNlIiA9PT0gZykgcmV0dXJuIGggPSBmLCAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmKSByZXR1cm4gYS5lcnJvcigiY2Fubm90IGNhbGwgbWV0aG9kcyBvbiAiICsgYiArICIgcHJpb3IgdG8gaW5pdGlhbGl6YXRpb247IGF0dGVtcHRlZCB0byBjYWxsIG1ldGhvZCAnIiArIGcgKyAiJyIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEuaXNGdW5jdGlvbihmW2ddKSB8fCAiXyIgPT09IGcuY2hhckF0KDApKSByZXR1cm4gYS5lcnJvcigibm8gc3VjaCBtZXRob2QgJyIgKyBnICsgIicgZm9yICIgKyBiICsgIiB3aWRnZXQgaW5zdGFuY2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGZbZ10uYXBwbHkoZiwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjICE9PSBmICYmIHZvaWQgMCAhPT0gYykgcmV0dXJuIGggPSBjICYmIGMuanF1ZXJ5ID8gaC5wdXNoU3RhY2soYy5nZXQoKSkgOiBjLCAhMQogICAgICAgICAgICAgICAgICAgIH0pIDogKG0ubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChnID0gYS53aWRnZXQuZXh0ZW5kLmFwcGx5KG51bGwsIFtnXS5jb25jYXQobSkpKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLmRhdGEodGhpcywgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID8gKGIub3B0aW9uKGcgfHwge30pLCBiLl9pbml0ICYmIGIuX2luaXQoKSkgOiBhLmRhdGEodGhpcywgZCwgbmV3IGMoZywgdGhpcykpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLldpZGdldCA9IGZ1bmN0aW9uKCkge307CiAgICAgICAgICAgIGEuV2lkZ2V0Ll9jaGlsZENvbnN0cnVjdG9ycyA9IFtdOwogICAgICAgICAgICBhLldpZGdldC5wcm90b3R5cGUgPSB7CiAgICAgICAgICAgICAgICB3aWRnZXROYW1lOiAid2lkZ2V0IiwKICAgICAgICAgICAgICAgIHdpZGdldEV2ZW50UHJlZml4OiAiIiwKICAgICAgICAgICAgICAgIGRlZmF1bHRFbGVtZW50OiAiPGRpdj4iLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiAhMSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlV2lkZ2V0OiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IGEoYyB8fCB0aGlzLmRlZmF1bHRFbGVtZW50IHx8IHRoaXMpWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGEoYyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51dWlkID0gTysrOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnROYW1lc3BhY2UgPSAiLiIgKyB0aGlzLndpZGdldE5hbWUgKyB0aGlzLnV1aWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kaW5ncyA9CiAgICAgICAgICAgICAgICAgICAgICAgIGEoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhvdmVyYWJsZSA9IGEoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzYWJsZSA9IGEoKTsKICAgICAgICAgICAgICAgICAgICBjICE9PSB0aGlzICYmIChhLmRhdGEoYywgdGhpcy53aWRnZXRGdWxsTmFtZSwgdGhpcyksIHRoaXMuX29uKCEwLCB0aGlzLmVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnRhcmdldCA9PT0gYyAmJiB0aGlzLmRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksIHRoaXMuZG9jdW1lbnQgPSBhKGMuc3R5bGUgPyBjLm93bmVyRG9jdW1lbnQgOiBjLmRvY3VtZW50IHx8IGMpLCB0aGlzLndpbmRvdyA9IGEodGhpcy5kb2N1bWVudFswXS5kZWZhdWx0VmlldyB8fCB0aGlzLmRvY3VtZW50WzBdLnBhcmVudFdpbmRvdykpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGEud2lkZ2V0LmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCB0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksIGIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoImNyZWF0ZSIsIG51bGwsIHRoaXMuX2dldENyZWF0ZUV2ZW50RGF0YSgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbml0KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0Q3JlYXRlT3B0aW9uczogYS5ub29wLAogICAgICAgICAgICAgICAgX2dldENyZWF0ZUV2ZW50RGF0YTogYS5ub29wLAogICAgICAgICAgICAgICAgX2NyZWF0ZTogYS5ub29wLAogICAgICAgICAgICAgICAgX2luaXQ6IGEubm9vcCwKICAgICAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZURhdGEodGhpcy53aWRnZXRGdWxsTmFtZSkucmVtb3ZlRGF0YShhLmNhbWVsQ2FzZSh0aGlzLndpZGdldEZ1bGxOYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53aWRnZXQoKS51bmJpbmQodGhpcy5ldmVudE5hbWVzcGFjZSkucmVtb3ZlQXR0cigiYXJpYS1kaXNhYmxlZCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUgKyAiLWRpc2FibGVkIHVpLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kaW5ncy51bmJpbmQodGhpcy5ldmVudE5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmFibGUucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGUucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWZvY3VzIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogYS5ub29wLAogICAgICAgICAgICAgICAgd2lkZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3B0aW9uOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBiLAogICAgICAgICAgICAgICAgICAgICAgICBnLCBmLCBtOwogICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gYS53aWRnZXQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0ge30sIGcgPSBiLnNwbGl0KCIuIiksIGIgPSBnLnNoaWZ0KCksIGcubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZFtiXSA9IGEud2lkZ2V0LmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zW2JdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobSA9IDA7IG0gPCBnLmxlbmd0aCAtIDE7IG0rKykgZltnW21dXSA9IGZbZ1ttXV0gfHwge30sIGYgPSBmW2dbbV1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGcucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZvaWQgMCA9PT0gZltiXSA/IG51bGwgOiBmW2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZltiXSA9IGMKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdm9pZCAwID09PSB0aGlzLm9wdGlvbnNbYl0gPyBudWxsIDogdGhpcy5vcHRpb25zW2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZFtiXSA9IGMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldE9wdGlvbnMoZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgaW4gYSkgdGhpcy5fc2V0T3B0aW9uKGMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFbY10pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1thXSA9IGM7CiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVkIiA9PT0gYSAmJiAodGhpcy53aWRnZXQoKS50b2dnbGVDbGFzcyh0aGlzLndpZGdldEZ1bGxOYW1lICsgIi1kaXNhYmxlZCIsICEhYyksIGMgJiYgKHRoaXMuaG92ZXJhYmxlLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLCB0aGlzLmZvY3VzYWJsZS5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiAhMQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NldE9wdGlvbnMoewogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogITAKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9vbjogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBnLCBmID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAiYm9vbGVhbiIgIT09IHR5cGVvZiBiICYmIChkID0gYywgYyA9IGIsIGIgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgZCA/IChjID0gZyA9IGEoYyksIHRoaXMuYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzLmFkZChjKSkgOiAoZCA9IGMsIGMgPSB0aGlzLmVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLndpZGdldCgpKTsKICAgICAgICAgICAgICAgICAgICBhLmVhY2goZCwgZnVuY3Rpb24oZCwgaCkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBrKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgfHwgITAgIT09IGYub3B0aW9ucy5kaXNhYmxlZCAmJiAhYSh0aGlzKS5oYXNDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSkgcmV0dXJuICgic3RyaW5nIiA9PT0gdHlwZW9mIGggPyBmW2hdIDogaCkuYXBwbHkoZiwgYXJndW1lbnRzKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpbmciICE9PSB0eXBlb2YgaCAmJiAoay5ndWlkID0gaC5ndWlkID0gaC5ndWlkIHx8IGsuZ3VpZCB8fCBhLmd1aWQrKyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gZC5tYXRjaCgvXihbXHc6LV0qKVxzKiguKikkLyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gbFsxXSArIGYuZXZlbnROYW1lc3BhY2U7CiAgICAgICAgICAgICAgICAgICAgICAgIChsID0gbFsyXSkgPyBnLmRlbGVnYXRlKGwsIGUsIGspOiBjLmJpbmQoZSwgaykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9vZmY6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKGMgfHwgIiIpLnNwbGl0KCIgIikuam9pbih0aGlzLmV2ZW50TmFtZXNwYWNlICsgIiAiKSArIHRoaXMuZXZlbnROYW1lc3BhY2U7CiAgICAgICAgICAgICAgICAgICAgYi51bmJpbmQoYykudW5kZWxlZ2F0ZShjKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdzID0gYSh0aGlzLmJpbmRpbmdzLm5vdChiKS5nZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGUgPSBhKHRoaXMuZm9jdXNhYmxlLm5vdChiKS5nZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmFibGUgPSBhKHRoaXMuaG92ZXJhYmxlLm5vdChiKS5nZXQoKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVsYXk6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoInN0cmluZyIgPT09IHR5cGVvZiBhID8gZFthXSA6IGEpLmFwcGx5KGQsIGFyZ3VtZW50cykKICAgICAgICAgICAgICAgICAgICB9LCBjIHx8IDApCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2hvdmVyYWJsZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJhYmxlID0gdGhpcy5ob3ZlcmFibGUuYWRkKGIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiLmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5jdXJyZW50VGFyZ2V0KS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZm9jdXNhYmxlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGUgPSB0aGlzLmZvY3VzYWJsZS5hZGQoYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24oYiwgewogICAgICAgICAgICAgICAgICAgICAgICBmb2N1c2luOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKGIuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoInVpLXN0YXRlLWZvY3VzIikKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNvdXQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi5jdXJyZW50VGFyZ2V0KS5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdHJpZ2dlcjogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBnLCBmID0gdGhpcy5vcHRpb25zW2JdOwogICAgICAgICAgICAgICAgICAgIGQgPSBkIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGMgPSBhLkV2ZW50KGMpOwogICAgICAgICAgICAgICAgICAgIGMudHlwZSA9IChiID09PSB0aGlzLndpZGdldEV2ZW50UHJlZml4ID8gYiA6IHRoaXMud2lkZ2V0RXZlbnRQcmVmaXggKyBiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIGMudGFyZ2V0ID0gdGhpcy5lbGVtZW50WzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChiID0gYy5vcmlnaW5hbEV2ZW50KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgaW4gYikgZyBpbiBjIHx8IChjW2ddID0gYltnXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoYywgZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEoYS5pc0Z1bmN0aW9uKGYpICYmICExID09PSBmLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2NdLmNvbmNhdChkKSkgfHwgYy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lYWNoKHsKICAgICAgICAgICAgICAgIHNob3c6ICJmYWRlSW4iLAogICAgICAgICAgICAgICAgaGlkZTogImZhZGVPdXQiCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIGEuV2lkZ2V0LnByb3RvdHlwZVsiXyIgKyBiXSA9IGZ1bmN0aW9uKGQsIGcsIGYpIHsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGcgJiYgKGcgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVmZmVjdDogZwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBtLCBoID0gZyA/ICEwID09PSBnIHx8ICJudW1iZXIiID09PSB0eXBlb2YgZyA/IGMgOiBnLmVmZmVjdCB8fCBjIDogYjsKICAgICAgICAgICAgICAgICAgICBnID0gZyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGcgJiYgKGcgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBnCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbSA9ICFhLmlzRW1wdHlPYmplY3QoZyk7CiAgICAgICAgICAgICAgICAgICAgZy5jb21wbGV0ZSA9IGY7CiAgICAgICAgICAgICAgICAgICAgZy5kZWxheSAmJiBkLmRlbGF5KGcuZGVsYXkpOwogICAgICAgICAgICAgICAgICAgIGlmIChtICYmIGEuZWZmZWN0cyAmJiBhLmVmZmVjdHMuZWZmZWN0W2hdKSBkW2JdKGcpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGggIT09IGIgJiYgZFtoXSkgZFtoXShnLmR1cmF0aW9uLCBnLmVhc2luZywgZik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBkLnF1ZXVlKGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKVtiXSgpOwogICAgICAgICAgICAgICAgICAgICAgICBmICYmIGYuY2FsbChkWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYygpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBWID0gITE7CiAgICAgICAgICAgIGEoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBWID0gITEKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5tb3VzZSIsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGNhbmNlbDogImlucHV0LHRleHRhcmVhLGJ1dHRvbixzZWxlY3Qsb3B0aW9uIiwKICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogMSwKICAgICAgICAgICAgICAgICAgICBkZWxheTogMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZUluaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYmluZCgibW91c2Vkb3duLiIgKyB0aGlzLndpZGdldE5hbWUsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuX21vdXNlRG93bihhKQogICAgICAgICAgICAgICAgICAgIH0pLmJpbmQoImNsaWNrLiIgKyB0aGlzLndpZGdldE5hbWUsIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEwID09PSBhLmRhdGEoYy50YXJnZXQsIGIud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKSkgcmV0dXJuIGEucmVtb3ZlRGF0YShjLnRhcmdldCwgYi53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIpLCBjLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCAhMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlRGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnVuYmluZCgiLiIgKyB0aGlzLndpZGdldE5hbWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlICYmIHRoaXMuZG9jdW1lbnQudW5iaW5kKCJtb3VzZW1vdmUuIiArCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2lkZ2V0TmFtZSwgdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZCgibW91c2V1cC4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlRG93bjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGlmICghVikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZU1vdmVkID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlU3RhcnRlZCAmJiB0aGlzLl9tb3VzZVVwKGIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZURvd25FdmVudCA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAxID09PSBiLndoaWNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICJzdHJpbmciID09PSB0eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbCAmJiBiLnRhcmdldC5ub2RlTmFtZSA/IGEoYi50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoIDogITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZCB8fCBnIHx8ICF0aGlzLl9tb3VzZUNhcHR1cmUoYikpIHJldHVybiAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZURlbGF5TWV0ID0gIXRoaXMub3B0aW9ucy5kZWxheTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZURlbGF5TWV0IHx8ICh0aGlzLl9tb3VzZURlbGF5VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5tb3VzZURlbGF5TWV0ID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmRlbGF5KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tb3VzZURpc3RhbmNlTWV0KGIpICYmIHRoaXMuX21vdXNlRGVsYXlNZXQoYikgJiYgKHRoaXMuX21vdXNlU3RhcnRlZCA9ICExICE9PSB0aGlzLl9tb3VzZVN0YXJ0KGIpLCAhdGhpcy5fbW91c2VTdGFydGVkKSkgcmV0dXJuIGIucHJldmVudERlZmF1bHQoKSwgITA7CiAgICAgICAgICAgICAgICAgICAgICAgICEwID09PSBhLmRhdGEoYi50YXJnZXQsIHRoaXMud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKSAmJiBhLnJlbW92ZURhdGEoYi50YXJnZXQsIHRoaXMud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5fbW91c2VNb3ZlKGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLl9tb3VzZVVwKGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuYmluZCgibW91c2Vtb3ZlLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS5iaW5kKCJtb3VzZXVwLiIgKyB0aGlzLndpZGdldE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBiLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBWID0gITAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlTW92ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tb3VzZU1vdmVkICYmIChhLnVpLmllICYmICghZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IDkgPiBkb2N1bWVudC5kb2N1bWVudE1vZGUpICYmICFiLmJ1dHRvbiB8fCAhYi53aGljaCkpIHJldHVybiB0aGlzLl9tb3VzZVVwKGIpOwogICAgICAgICAgICAgICAgICAgIGlmIChiLndoaWNoIHx8IGIuYnV0dG9uKSB0aGlzLl9tb3VzZU1vdmVkID0gITA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX21vdXNlU3RhcnRlZCkgcmV0dXJuIHRoaXMuX21vdXNlRHJhZyhiKSwgYi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYikgJiYgdGhpcy5fbW91c2VEZWxheU1ldChiKSAmJiAoKHRoaXMuX21vdXNlU3RhcnRlZCA9ICExICE9PSB0aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LCBiKSkgPyB0aGlzLl9tb3VzZURyYWcoYikgOiB0aGlzLl9tb3VzZVVwKGIpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuX21vdXNlU3RhcnRlZAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZVVwOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudC51bmJpbmQoIm1vdXNlbW92ZS4iICsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkudW5iaW5kKCJtb3VzZXVwLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VTdGFydGVkICYmICh0aGlzLl9tb3VzZVN0YXJ0ZWQgPSAhMSwgYi50YXJnZXQgPT09IHRoaXMuX21vdXNlRG93bkV2ZW50LnRhcmdldCAmJiBhLmRhdGEoYi50YXJnZXQsIHRoaXMud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiLCAhMCksIHRoaXMuX21vdXNlU3RvcChiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFYgPSAhMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZURpc3RhbmNlTWV0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VYIC0gYS5wYWdlWCksIE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZIC0gYS5wYWdlWSkpID49IHRoaXMub3B0aW9ucy5kaXN0YW5jZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZURlbGF5TWV0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3VzZURlbGF5TWV0CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKCkge30sCiAgICAgICAgICAgICAgICBfbW91c2VEcmFnOiBmdW5jdGlvbigpIHt9LAogICAgICAgICAgICAgICAgX21vdXNlU3RvcDogZnVuY3Rpb24oKSB7fSwKICAgICAgICAgICAgICAgIF9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtwYXJzZUZsb2F0KGFbMF0pICogKHAudGVzdChhWzBdKSA/IGIgLyAxMDAgOiAxKSwgcGFyc2VGbG9hdChhWzFdKSAqIChwLnRlc3QoYVsxXSkgPyBjIC8gMTAwIDogMSldCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiWzBdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiA5ID09PSBjLm5vZGVUeXBlID8gewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYi53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSA6IGEuaXNXaW5kb3coYykgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBiLndpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYi5oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGIuc2Nyb2xsVG9wKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBiLnNjcm9sbExlZnQoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSA6IGMucHJldmVudERlZmF1bHQgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBjLnBhZ2VZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYy5wYWdlWAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIub3V0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIub3V0ZXJIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBiLm9mZnNldCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYS51aSA9IGEudWkgfHwge307CiAgICAgICAgICAgICAgICB2YXIgZCwgZywgZiA9IE1hdGgubWF4LAogICAgICAgICAgICAgICAgICAgIG0gPSBNYXRoLmFicywKICAgICAgICAgICAgICAgICAgICBoID0gTWF0aC5yb3VuZCwKICAgICAgICAgICAgICAgICAgICBrID0gL2xlZnR8Y2VudGVyfHJpZ2h0LywKICAgICAgICAgICAgICAgICAgICBsID0gL3RvcHxjZW50ZXJ8Ym90dG9tLywKICAgICAgICAgICAgICAgICAgICBlID0gL1tcK1wtXVxkKyhcLltcZF0rKT8lPy8sCiAgICAgICAgICAgICAgICAgICAgbiA9IC9eXHcrLywKICAgICAgICAgICAgICAgICAgICBwID0gLyUkLywKICAgICAgICAgICAgICAgICAgICByID0gYS5mbi5wb3NpdGlvbjsKICAgICAgICAgICAgICAgIGEucG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsYmFyV2lkdGg6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBkKSByZXR1cm4gZDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMsIGUgPSBhKCI8ZGl2IHN0eWxlPSdkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjUwcHg7aGVpZ2h0OjUwcHg7b3ZlcmZsb3c6aGlkZGVuOyc+PGRpdiBzdHlsZT0naGVpZ2h0OjEwMHB4O3dpZHRoOmF1dG87Jz48L2Rpdj48L2Rpdj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGUuY2hpbGRyZW4oKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgYSgiYm9keSIpLmFwcGVuZChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGMub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGUuY3NzKCJvdmVyZmxvdyIsICJzY3JvbGwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGMub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPT09IGMgJiYgKGMgPSBlWzBdLmNsaWVudFdpZHRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPSBiIC0gYwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZ2V0U2Nyb2xsSW5mbzogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGIuaXNXaW5kb3cgfHwgYi5pc0RvY3VtZW50ID8gIiIgOiBiLmVsZW1lbnQuY3NzKCJvdmVyZmxvdy14IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYi5pc1dpbmRvdyB8fCBiLmlzRG9jdW1lbnQgPyAiIiA6IGIuZWxlbWVudC5jc3MoIm92ZXJmbG93LXkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAic2Nyb2xsIiA9PT0gYyB8fCAiYXV0byIgPT09IGMgJiYgYi53aWR0aCA8IGIuZWxlbWVudFswXS5zY3JvbGxXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAic2Nyb2xsIiA9PT0gZCB8fCAiYXV0byIgPT09IGQgJiYgYi5oZWlnaHQgPCBiLmVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ID8gYS5wb3NpdGlvbi5zY3JvbGxiYXJXaWR0aCgpIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYyA/IGEucG9zaXRpb24uc2Nyb2xsYmFyV2lkdGgoKSA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZ2V0V2l0aGluSW5mbzogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICBiID0gYShiIHx8IHdpbmRvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS5pc1dpbmRvdyhiWzBdKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhIWJbMF0gJiYgOSA9PT0gYlswXS5ub2RlVHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1dpbmRvdzogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRG9jdW1lbnQ6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGIub2Zmc2V0KCkgfHwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogYi5zY3JvbGxMZWZ0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IGIuc2Nyb2xsVG9wKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYyB8fCBkID8gYi53aWR0aCgpIDogYi5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGMgfHwgZCA/IGIuaGVpZ2h0KCkgOiBiLm91dGVySGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBhLmZuLnBvc2l0aW9uID0gZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIGlmICghZCB8fCAhZC5vZikgcmV0dXJuIHIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBkID0gYS5leHRlbmQoe30sIGQpOwogICAgICAgICAgICAgICAgICAgIHZhciB1LCBwLCB5LCB2LCBCLCBELCBBID0gYShkLm9mKSwKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGEucG9zaXRpb24uZ2V0V2l0aGluSW5mbyhkLndpdGhpbiksCiAgICAgICAgICAgICAgICAgICAgICAgIEggPSBhLnBvc2l0aW9uLmdldFNjcm9sbEluZm8oeCksCiAgICAgICAgICAgICAgICAgICAgICAgIEUgPSAoZC5jb2xsaXNpb24gfHwgImZsaXAiKS5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgICAgICBGID0ge307CiAgICAgICAgICAgICAgICAgICAgRCA9IGMoQSk7CiAgICAgICAgICAgICAgICAgICAgQVswXS5wcmV2ZW50RGVmYXVsdCAmJiAoZC5hdCA9ICJsZWZ0IHRvcCIpOwogICAgICAgICAgICAgICAgICAgIHAgPSBELndpZHRoOwogICAgICAgICAgICAgICAgICAgIHkgPSBELmhlaWdodDsKICAgICAgICAgICAgICAgICAgICB2ID0gRC5vZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgQiA9IGEuZXh0ZW5kKHt9LCB2KTsKICAgICAgICAgICAgICAgICAgICBhLmVhY2goWyJteSIsICJhdCJdLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRbdGhpc10gfHwgIiIpLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLCBjOwogICAgICAgICAgICAgICAgICAgICAgICAxID09PSBhLmxlbmd0aCAmJiAoYSA9IGsudGVzdChhWzBdKSA/IGEuY29uY2F0KFsiY2VudGVyIl0pIDogbC50ZXN0KGFbMF0pID8gWyJjZW50ZXIiXS5jb25jYXQoYSkgOiBbImNlbnRlciIsICJjZW50ZXIiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFbMF0gPSBrLnRlc3QoYVswXSkgPyBhWzBdIDogImNlbnRlciI7CiAgICAgICAgICAgICAgICAgICAgICAgIGFbMV0gPSBsLnRlc3QoYVsxXSkgPyBhWzFdIDogImNlbnRlciI7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBlLmV4ZWMoYVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBlLmV4ZWMoYVsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEZbdGhpc10gPSBbYiA/IGJbMF0gOiAwLCBjID8gY1swXSA6IDBdOwogICAgICAgICAgICAgICAgICAgICAgICBkW3RoaXNdID0gW24uZXhlYyhhWzBdKVswXSwgbi5leGVjKGFbMV0pWzBdXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIDEgPT09IEUubGVuZ3RoICYmIChFWzFdID0gRVswXSk7CiAgICAgICAgICAgICAgICAgICAgInJpZ2h0IiA9PT0gZC5hdFswXSA/IEIubGVmdCArPSBwIDogImNlbnRlciIgPT09IGQuYXRbMF0gJiYgKEIubGVmdCArPSBwIC8gMik7CiAgICAgICAgICAgICAgICAgICAgImJvdHRvbSIgPT09IGQuYXRbMV0gPyBCLnRvcCArPSB5IDogImNlbnRlciIgPT09IGQuYXRbMV0gJiYgKEIudG9wICs9IHkgLyAyKTsKICAgICAgICAgICAgICAgICAgICB1ID0gYihGLmF0LCBwLCB5KTsKICAgICAgICAgICAgICAgICAgICBCLmxlZnQgKz0gdVswXTsKICAgICAgICAgICAgICAgICAgICBCLnRvcCArPSB1WzFdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSwgbCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gbC5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gbC5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHBhcnNlSW50KGEuY3NzKHRoaXMsICJtYXJnaW5MZWZ0IiksIDEwKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHBhcnNlSW50KGEuY3NzKHRoaXMsICJtYXJnaW5Ub3AiKSwgMTApIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEID0gayArIHIgKyAocGFyc2VJbnQoYS5jc3ModGhpcywgIm1hcmdpblJpZ2h0IiksIDEwKSB8fCAwKSArIEgud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gbiArIHcgKyAocGFyc2VJbnQoYS5jc3ModGhpcywgIm1hcmdpbkJvdHRvbSIpLCAxMCkgfHwgMCkgKyBILmhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQgPSBhLmV4dGVuZCh7fSwgQiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gYihGLm15LCBsLm91dGVyV2lkdGgoKSwgbC5vdXRlckhlaWdodCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgInJpZ2h0IiA9PT0gZC5teVswXSA/IFQubGVmdCAtPSBrIDogImNlbnRlciIgPT09IGQubXlbMF0gJiYgKFQubGVmdCAtPSBrIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICJib3R0b20iID09PSBkLm15WzFdID8gVC50b3AgLT0gbiA6ICJjZW50ZXIiID09PSBkLm15WzFdICYmIChULnRvcCAtPSBuIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgIFQubGVmdCArPSBNWzBdOwogICAgICAgICAgICAgICAgICAgICAgICBULnRvcCArPSBNWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBnIHx8IChULmxlZnQgPSBoKFQubGVmdCksIFQudG9wID0gaChULnRvcCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblRvcDogdwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goWyJsZWZ0IiwgInRvcCJdLCBmdW5jdGlvbihiLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS51aS5wb3NpdGlvbltFW2JdXSkgYS51aS5wb3NpdGlvbltFW2JdXVtlXShULCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0V2lkdGg6IHAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0OiB5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1XaWR0aDogaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtSGVpZ2h0OiBuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvblBvc2l0aW9uOiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbldpZHRoOiBELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbkhlaWdodDogSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IFt1WzBdICsgTVswXSwgdVsxXSArIE1bMV1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15OiBkLm15LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0OiBkLmF0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhpbjogeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtOiBsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZC51c2luZyAmJiAoZSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdi5sZWZ0IC0gVC5sZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiICsgcCAtIGssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHYudG9wIC0gVC50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUgKyB5IC0gbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IEEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB2LmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHYudG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFQubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogVC50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsOiAwID4gYyA/ICJsZWZ0IiA6IDAgPCBiID8gInJpZ2h0IiA6ICJjZW50ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogMCA+IGcgPyAidG9wIiA6IDAgPCBlID8gImJvdHRvbSIgOiAibWlkZGxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwIDwgayAmJiBtKGIgKyBjKSA8IHAgJiYgKGguaG9yaXpvbnRhbCA9ICJjZW50ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPCBuICYmIG0oZSArIGcpIDwgeSAmJiAoaC52ZXJ0aWNhbCA9ICJtaWRkbGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYobShiKSwgbShjKSkgPiBmKG0oZSksIG0oZykpID8gaC5pbXBvcnRhbnQgPSAiaG9yaXpvbnRhbCIgOiBoLmltcG9ydGFudCA9ICJ2ZXJ0aWNhbCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnVzaW5nLmNhbGwodGhpcywgYSwgaCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwub2Zmc2V0KGEuZXh0ZW5kKFQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nOiBlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYS51aS5wb3NpdGlvbiA9IHsKICAgICAgICAgICAgICAgICAgICBmaXQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLndpdGhpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5pc1dpbmRvdyA/IGMuc2Nyb2xsTGVmdCA6IGMub2Zmc2V0LmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGMud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEubGVmdCAtIGIuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZCAtIGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGcgKyBiLmNvbGxpc2lvbldpZHRoIC0gZSAtIGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNvbGxpc2lvbldpZHRoID4gZSA/IDAgPCBjICYmIDAgPj0gaCA/IChkID0gYS5sZWZ0ICsgYyArIGIuY29sbGlzaW9uV2lkdGggLSBlIC0gZCwgYS5sZWZ0ICs9IGMgLSBkKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5sZWZ0ID0gMCA8IGggJiYgMCA+PSBjID8gZCA6IGMgPiBoID8gZCArIGUgLSBiLmNvbGxpc2lvbldpZHRoIDogZCA6IGEubGVmdCA9IDAgPCBjID8gYS5sZWZ0ICsgYyA6IDAgPCBoID8gYS5sZWZ0IC0gaCA6IGYoYS5sZWZ0IC0gZywgYS5sZWZ0KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYi53aXRoaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuaXNXaW5kb3cgPyBjLnNjcm9sbFRvcCA6IGMub2Zmc2V0LnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYi53aXRoaW4uaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhLnRvcCAtIGIuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luVG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBkIC0gZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gZyArIGIuY29sbGlzaW9uSGVpZ2h0IC0gZSAtIGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNvbGxpc2lvbkhlaWdodCA+IGUgPyAwIDwgYyAmJiAwID49IGggPyAoZCA9IGEudG9wICsgYyArIGIuY29sbGlzaW9uSGVpZ2h0IC0gZSAtIGQsIGEudG9wICs9IGMgLSBkKSA6IGEudG9wID0gMCA8IGggJiYgMCA+PSBjID8gZCA6IGMgPiBoID8gZCArIGUgLSBiLmNvbGxpc2lvbkhlaWdodCA6IGQgOiBhLnRvcCA9IDAgPCBjID8gYS50b3AgKyBjIDogMCA8IGggPyBhLnRvcCAtIGggOiBmKGEudG9wIC0gZywgYS50b3ApCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZsaXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLndpdGhpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5vZmZzZXQubGVmdCArIGMuc2Nyb2xsTGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYy5pc1dpbmRvdyA/IGMuc2Nyb2xsTGVmdCA6IGMub2Zmc2V0LmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEubGVmdCAtIGIuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZyAtIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGcgKyBiLmNvbGxpc2lvbldpZHRoIC0gZSAtIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICJsZWZ0IiA9PT0gYi5teVswXSA/IC1iLmVsZW1XaWR0aCA6ICJyaWdodCIgPT09IGIubXlbMF0gPyBiLmVsZW1XaWR0aCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICJsZWZ0IiA9PT0gYi5hdFswXSA/IGIudGFyZ2V0V2lkdGggOiAicmlnaHQiID09PSBiLmF0WzBdID8gLWIudGFyZ2V0V2lkdGggOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAtMiAqIGIub2Zmc2V0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPiBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBhLmxlZnQgKyBnICsgbCArIGsgKyBiLmNvbGxpc2lvbldpZHRoIC0gZSAtIGQsIDAgPiBkIHx8IGQgPCBtKGMpKSBhLmxlZnQgKz0gZyArIGwgKyBrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgMCA8IGggJiYgKGQgPSBhLmxlZnQgLSBiLmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpbkxlZnQgKyBnICsgbCArIGsgLSBmLCAwIDwgZCB8fCBtKGQpIDwgaCkgJiYgKGEubGVmdCArPSBnICsgbCArIGspCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLndpdGhpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5vZmZzZXQudG9wICsgYy5zY3JvbGxUb3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGMuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBjLmlzV2luZG93ID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnNjcm9sbFRvcCA6IGMub2Zmc2V0LnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS50b3AgLSBiLmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpblRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZyAtIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGcgKyBiLmNvbGxpc2lvbkhlaWdodCAtIGUgLSBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAidG9wIiA9PT0gYi5teVsxXSA/IC1iLmVsZW1IZWlnaHQgOiAiYm90dG9tIiA9PT0gYi5teVsxXSA/IGIuZWxlbUhlaWdodCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICJ0b3AiID09PSBiLmF0WzFdID8gYi50YXJnZXRIZWlnaHQgOiAiYm90dG9tIiA9PT0gYi5hdFsxXSA/IC1iLnRhcmdldEhlaWdodCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IC0yICogYi5vZmZzZXRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA+IGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IGEudG9wICsgZyArIGwgKyBrICsgYi5jb2xsaXNpb25IZWlnaHQgLSBlIC0gZCwgMCA+IGQgfHwgZCA8IG0oYykpIGEudG9wICs9IGcgKyBsICsgawogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIDAgPCBoICYmIChkID0gYS50b3AgLSBiLmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpblRvcCArIGcgKyBsICsgayAtIGYsIDAgPCBkIHx8IG0oZCkgPCBoKSAmJiAoYS50b3AgKz0gZyArIGwgKyBrKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmbGlwZml0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS51aS5wb3NpdGlvbi5mbGlwLmxlZnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudWkucG9zaXRpb24uZml0LmxlZnQuYXBwbHkodGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnVpLnBvc2l0aW9uLmZsaXAudG9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnVpLnBvc2l0aW9uLmZpdC50b3AuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYywgZCwgZSwgZiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF07CiAgICAgICAgICAgICAgICAgICAgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGYgPyAiZGl2IiA6ICJib2R5Iik7CiAgICAgICAgICAgICAgICAgICAgYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAibm9uZSIKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGYgJiYgYS5leHRlbmQoYywgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogIi0xMDAwcHgiLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICItMTAwMHB4IgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGZvciAoZSBpbiBjKSBiLnN0eWxlW2VdID0gY1tlXTsKICAgICAgICAgICAgICAgICAgICBiLmFwcGVuZENoaWxkKGQpOwogICAgICAgICAgICAgICAgICAgIGMgPSBmIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICBjLmluc2VydEJlZm9yZShiLCBjLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGQuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDEwLjc0MzIyMjJweDsiOwogICAgICAgICAgICAgICAgICAgIGQgPSBhKGQpLm9mZnNldCgpLmxlZnQ7CiAgICAgICAgICAgICAgICAgICAgZyA9IDEwIDwgZCAmJiAxMSA+IGQ7CiAgICAgICAgICAgICAgICAgICAgYi5pbm5lckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBjLnJlbW92ZUNoaWxkKGIpCiAgICAgICAgICAgICAgICB9KSgpCiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5hY2NvcmRpb24iLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IDAsCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZToge30sCiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2libGU6ICExLAogICAgICAgICAgICAgICAgICAgIGV2ZW50OiAiY2xpY2siLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcjogIj4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuIiwKICAgICAgICAgICAgICAgICAgICBoZWlnaHRTdHlsZTogImF1dG8iLAogICAgICAgICAgICAgICAgICAgIGljb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUhlYWRlcjogInVpLWljb24tdHJpYW5nbGUtMS1zIiwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiAidWktaWNvbi10cmlhbmdsZS0xLWUiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhY3RpdmF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBiZWZvcmVBY3RpdmF0ZTogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhpZGVQcm9wczogewogICAgICAgICAgICAgICAgICAgIGJvcmRlclRvcFdpZHRoOiAiaGlkZSIsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQm90dG9tV2lkdGg6ICJoaWRlIiwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nVG9wOiAiaGlkZSIsCiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ0JvdHRvbTogImhpZGUiLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogImhpZGUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2hvd1Byb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgYm9yZGVyVG9wV2lkdGg6ICJzaG93IiwKICAgICAgICAgICAgICAgICAgICBib3JkZXJCb3R0b21XaWR0aDogInNob3ciLAogICAgICAgICAgICAgICAgICAgIHBhZGRpbmdUb3A6ICJzaG93IiwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiAic2hvdyIsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAic2hvdyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZTaG93ID0gdGhpcy5wcmV2SGlkZSA9IGEoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWFjY29yZGlvbiB1aS13aWRnZXQgdWktaGVscGVyLXJlc2V0IikuYXR0cigicm9sZSIsICJ0YWJsaXN0Iik7CiAgICAgICAgICAgICAgICAgICAgYi5jb2xsYXBzaWJsZSB8fCAhMSAhPT0gYi5hY3RpdmUgJiYgbnVsbCAhPSBiLmFjdGl2ZSB8fCAoYi5hY3RpdmUgPSAwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzUGFuZWxzKCk7CiAgICAgICAgICAgICAgICAgICAgMCA+IGIuYWN0aXZlICYmIChiLmFjdGl2ZSArPSB0aGlzLmhlYWRlcnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0Q3JlYXRlRXZlbnREYXRhOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IHRoaXMuYWN0aXZlLAogICAgICAgICAgICAgICAgICAgICAgICBwYW5lbDogdGhpcy5hY3RpdmUubGVuZ3RoID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlLm5leHQoKSA6IGEoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlSWNvbnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5vcHRpb25zLmljb25zOwogICAgICAgICAgICAgICAgICAgIGIgJiYgKGEoIjxzcGFuPiIpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24taGVhZGVyLWljb24gdWktaWNvbiAiICsgYi5oZWFkZXIpLnByZXBlbmRUbyh0aGlzLmhlYWRlcnMpLCB0aGlzLmFjdGl2ZS5jaGlsZHJlbigiLnVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiIpLnJlbW92ZUNsYXNzKGIuaGVhZGVyKS5hZGRDbGFzcyhiLmFjdGl2ZUhlYWRlciksIHRoaXMuaGVhZGVycy5hZGRDbGFzcygidWktYWNjb3JkaW9uLWljb25zIikpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3lJY29uczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzLnJlbW92ZUNsYXNzKCJ1aS1hY2NvcmRpb24taWNvbnMiKS5jaGlsZHJlbigiLnVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiIpLnJlbW92ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktYWNjb3JkaW9uIHVpLXdpZGdldCB1aS1oZWxwZXItcmVzZXQiKS5yZW1vdmVBdHRyKCJyb2xlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzLnJlbW92ZUNsYXNzKCJ1aS1hY2NvcmRpb24taGVhZGVyIHVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtZGlzYWJsZWQgdWktY29ybmVyLXRvcCIpLnJlbW92ZUF0dHIoInJvbGUiKS5yZW1vdmVBdHRyKCJhcmlhLWV4cGFuZGVkIikucmVtb3ZlQXR0cigiYXJpYS1zZWxlY3RlZCIpLnJlbW92ZUF0dHIoImFyaWEtY29udHJvbHMiKS5yZW1vdmVBdHRyKCJ0YWJJbmRleCIpLnJlbW92ZVVuaXF1ZUlkKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVzdHJveUljb25zKCk7CiAgICAgICAgICAgICAgICAgICAgYSA9IHRoaXMuaGVhZGVycy5uZXh0KCkucmVtb3ZlQ2xhc3MoInVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLWFjY29yZGlvbi1jb250ZW50IHVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSB1aS1zdGF0ZS1kaXNhYmxlZCIpLmNzcygiZGlzcGxheSIsICIiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1oaWRkZW4iKS5yZW1vdmVBdHRyKCJhcmlhLWxhYmVsbGVkYnkiKS5yZW1vdmVVbmlxdWVJZCgpOwogICAgICAgICAgICAgICAgICAgICJjb250ZW50IiAhPT0gdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICYmIGEuY3NzKCJoZWlnaHQiLCAiIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgImFjdGl2ZSIgPT09IGEgPyB0aGlzLl9hY3RpdmF0ZShjKSA6ICgiZXZlbnQiID09PSBhICYmICh0aGlzLm9wdGlvbnMuZXZlbnQgJiYgdGhpcy5fb2ZmKHRoaXMuaGVhZGVycywgdGhpcy5vcHRpb25zLmV2ZW50KSwgdGhpcy5fc2V0dXBFdmVudHMoYykpLCB0aGlzLl9zdXBlcihhLCBjKSwgImNvbGxhcHNpYmxlIiAhPT0gYSB8fCBjIHx8ICExICE9PSB0aGlzLm9wdGlvbnMuYWN0aXZlIHx8IHRoaXMuX2FjdGl2YXRlKDApLCAiaWNvbnMiID09PSBhICYmICh0aGlzLl9kZXN0cm95SWNvbnMoKSwgYyAmJiB0aGlzLl9jcmVhdGVJY29ucygpKSwgImRpc2FibGVkIiA9PT0gYSAmJiAodGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhYykuYXR0cigiYXJpYS1kaXNhYmxlZCIsIGMpLCB0aGlzLmhlYWRlcnMuYWRkKHRoaXMuaGVhZGVycy5uZXh0KCkpLnRvZ2dsZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhYykpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9rZXlkb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFiLmFsdEtleSAmJiAhYi5jdHJsS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS51aS5rZXlDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuaGVhZGVycy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5oZWFkZXJzLmluZGV4KGIudGFyZ2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChiLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYy5SSUdIVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYy5ET1dOOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLmhlYWRlcnNbKGcgKyAxKSAlIGRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBjLkxFRlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGMuVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuaGVhZGVyc1soZyAtIDEgKyBkKSAlIGRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBjLlNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBjLkVOVEVSOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlcihiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYy5IT01FOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLmhlYWRlcnNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGMuRU5EOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLmhlYWRlcnNbZCAtIDFdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZiAmJiAoYShiLnRhcmdldCkuYXR0cigidGFiSW5kZXgiLCAtMSksIGEoZikuYXR0cigidGFiSW5kZXgiLCAwKSwgZi5mb2N1cygpLCBiLnByZXZlbnREZWZhdWx0KCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9wYW5lbEtleURvd246IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBiLmtleUNvZGUgPT09CiAgICAgICAgICAgICAgICAgICAgICAgIGEudWkua2V5Q29kZS5VUCAmJiBiLmN0cmxLZXkgJiYgYShiLmN1cnJlbnRUYXJnZXQpLnByZXYoKS5mb2N1cygpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1BhbmVscygpOwogICAgICAgICAgICAgICAgICAgICExID09PSBiLmFjdGl2ZSAmJiAhMCA9PT0gYi5jb2xsYXBzaWJsZSB8fCAhdGhpcy5oZWFkZXJzLmxlbmd0aCA/IChiLmFjdGl2ZSA9ICExLCB0aGlzLmFjdGl2ZSA9IGEoKSkgOiAhMSA9PT0gYi5hY3RpdmUgPyB0aGlzLl9hY3RpdmF0ZSgwKSA6IHRoaXMuYWN0aXZlLmxlbmd0aCAmJiAhYS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIHRoaXMuYWN0aXZlWzBdKSA/IHRoaXMuaGVhZGVycy5sZW5ndGggPT09IHRoaXMuaGVhZGVycy5maW5kKCIudWktc3RhdGUtZGlzYWJsZWQiKS5sZW5ndGggPyAoYi5hY3RpdmUgPSAhMSwgdGhpcy5hY3RpdmUgPSBhKCkpIDogdGhpcy5fYWN0aXZhdGUoTWF0aC5tYXgoMCwgYi5hY3RpdmUgLSAxKSkgOiBiLmFjdGl2ZSA9IHRoaXMuaGVhZGVycy5pbmRleCh0aGlzLmFjdGl2ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVzdHJveUljb25zKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3Byb2Nlc3NQYW5lbHM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5wYW5lbHM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzID0gdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmhlYWRlcikuYWRkQ2xhc3MoInVpLWFjY29yZGlvbi1oZWFkZXIgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbHMgPSB0aGlzLmhlYWRlcnMubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudCB1aS1oZWxwZXItcmVzZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSIpLmZpbHRlcigiOm5vdCgudWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlKSIpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBjICYmICh0aGlzLl9vZmYoYS5ub3QodGhpcy5oZWFkZXJzKSksIHRoaXMuX29mZihjLm5vdCh0aGlzLnBhbmVscykpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuaGVpZ2h0U3R5bGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLmVsZW1lbnQucGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSB0aGlzLl9maW5kQWN0aXZlKGMuYWN0aXZlKS5hZGRDbGFzcygidWktYWNjb3JkaW9uLWhlYWRlci1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiKS5yZW1vdmVDbGFzcygidWktY29ybmVyLWFsbCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlLm5leHQoKS5hZGRDbGFzcygidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIikuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5hdHRyKCJyb2xlIiwgInRhYiIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLnVuaXF1ZUlkKCkuYXR0cigiaWQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiLm5leHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkLnVuaXF1ZUlkKCkuYXR0cigiaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5hdHRyKCJhcmlhLWNvbnRyb2xzIiwgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuYXR0cigiYXJpYS1sYWJlbGxlZGJ5IiwgYykKICAgICAgICAgICAgICAgICAgICB9KS5uZXh0KCkuYXR0cigicm9sZSIsICJ0YWJwYW5lbCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5ub3QodGhpcy5hY3RpdmUpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6IC0xCiAgICAgICAgICAgICAgICAgICAgfSkubmV4dCgpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKICAgICAgICAgICAgICAgICAgICB9KS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUubGVuZ3RoID8gdGhpcy5hY3RpdmUuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLXNlbGVjdGVkIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6IDAKICAgICAgICAgICAgICAgICAgICB9KS5uZXh0KCkuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICB9KSA6IHRoaXMuaGVhZGVycy5lcSgwKS5hdHRyKCJ0YWJJbmRleCIsIDApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUljb25zKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBFdmVudHMoYy5ldmVudCk7CiAgICAgICAgICAgICAgICAgICAgImZpbGwiID09PSBkID8gKGIgPSBnLmhlaWdodCgpLCB0aGlzLmVsZW1lbnQuc2libGluZ3MoIjp2aXNpYmxlIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuY3NzKCJwb3NpdGlvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAiYWJzb2x1dGUiICE9PSBkICYmICJmaXhlZCIgIT09IGQgJiYgKGIgLT0gYy5vdXRlckhlaWdodCghMCkpCiAgICAgICAgICAgICAgICAgICAgfSksIHRoaXMuaGVhZGVycy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBiIC09IGEodGhpcykub3V0ZXJIZWlnaHQoITApCiAgICAgICAgICAgICAgICAgICAgfSksIHRoaXMuaGVhZGVycy5uZXh0KCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5oZWlnaHQoTWF0aC5tYXgoMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgLSBhKHRoaXMpLmlubmVySGVpZ2h0KCkgKyBhKHRoaXMpLmhlaWdodCgpKSkKICAgICAgICAgICAgICAgICAgICB9KS5jc3MoIm92ZXJmbG93IiwgImF1dG8iKSkgOiAiYXV0byIgPT09IGQgJiYgKGIgPSAwLCB0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBNYXRoLm1heChiLCBhKHRoaXMpLmNzcygiaGVpZ2h0IiwgIiIpLmhlaWdodCgpKQogICAgICAgICAgICAgICAgICAgIH0pLmhlaWdodChiKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWN0aXZhdGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gdGhpcy5fZmluZEFjdGl2ZShiKVswXTsKICAgICAgICAgICAgICAgICAgICBiICE9PSB0aGlzLmFjdGl2ZVswXSAmJiAoYiA9IGIgfHwgdGhpcy5hY3RpdmVbMF0sIHRoaXMuX2V2ZW50SGFuZGxlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFRhcmdldDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQ6IGEubm9vcAogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9maW5kQWN0aXZlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1iZXIiID09PSB0eXBlb2YgYiA/IHRoaXMuaGVhZGVycy5lcShiKSA6IGEoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXR1cEV2ZW50czogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gewogICAgICAgICAgICAgICAgICAgICAgICBrZXlkb3duOiAiX2tleWRvd24iCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBiICYmIGEuZWFjaChiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY1tiXSA9ICJfZXZlbnRIYW5kbGVyIgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29mZih0aGlzLmhlYWRlcnMuYWRkKHRoaXMuaGVhZGVycy5uZXh0KCkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLmhlYWRlcnMsIGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHRoaXMuaGVhZGVycy5uZXh0KCksIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogIl9wYW5lbEtleURvd24iCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faG92ZXJhYmxlKHRoaXMuaGVhZGVycyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNhYmxlKHRoaXMuaGVhZGVycykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZXZlbnRIYW5kbGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEoYi5jdXJyZW50VGFyZ2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGdbMF0gPT09IGRbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBmICYmIGMuY29sbGFwc2libGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBtID8gYSgpIDogZy5uZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBkLm5leHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZEhlYWRlcjogZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFBhbmVsOiBrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3SGVhZGVyOiBtID8gYSgpIDogZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1BhbmVsOiBoCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGYgJiYgIWMuY29sbGFwc2libGUgfHwgITEgPT09IHRoaXMuX3RyaWdnZXIoImJlZm9yZUFjdGl2YXRlIiwgYiwgaCkgfHwgKGMuYWN0aXZlID0KICAgICAgICAgICAgICAgICAgICAgICAgbSA/ICExIDogdGhpcy5oZWFkZXJzLmluZGV4KGcpLCB0aGlzLmFjdGl2ZSA9IGYgPyBhKCkgOiBnLCB0aGlzLl90b2dnbGUoaCksIGQucmVtb3ZlQ2xhc3MoInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSIpLCBjLmljb25zICYmIGQuY2hpbGRyZW4oIi51aS1hY2NvcmRpb24taGVhZGVyLWljb24iKS5yZW1vdmVDbGFzcyhjLmljb25zLmFjdGl2ZUhlYWRlcikuYWRkQ2xhc3MoYy5pY29ucy5oZWFkZXIpLCBmIHx8IChnLnJlbW92ZUNsYXNzKCJ1aS1jb3JuZXItYWxsIikuYWRkQ2xhc3MoInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wIiksIGMuaWNvbnMgJiYgZy5jaGlsZHJlbigiLnVpLWFjY29yZGlvbi1oZWFkZXItaWNvbiIpLnJlbW92ZUNsYXNzKGMuaWNvbnMuaGVhZGVyKS5hZGRDbGFzcyhjLmljb25zLmFjdGl2ZUhlYWRlciksIGcubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RvZ2dsZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0KICAgICAgICAgICAgICAgICAgICAgICAgYi5uZXdQYW5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMucHJldlNob3cubGVuZ3RoID8gdGhpcy5wcmV2U2hvdyA6IGIub2xkUGFuZWw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2U2hvdy5hZGQodGhpcy5wcmV2SGlkZSkuc3RvcCghMCwgITApOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJldlNob3cgPSBjOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJldkhpZGUgPSBkOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hbmltYXRlID8gdGhpcy5fYW5pbWF0ZShjLCBkLCBiKSA6IChkLmhpZGUoKSwgYy5zaG93KCksIHRoaXMuX3RvZ2dsZUNvbXBsZXRlKGIpKTsKICAgICAgICAgICAgICAgICAgICBkLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBkLnByZXYoKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtc2VsZWN0ZWQiOiAiZmFsc2UiLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjLmxlbmd0aCAmJiBkLmxlbmd0aCA/IGQucHJldigpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleDogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgogICAgICAgICAgICAgICAgICAgIH0pIDogYy5sZW5ndGggJiYgdGhpcy5oZWFkZXJzLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT09IHBhcnNlSW50KGEodGhpcykuYXR0cigidGFiSW5kZXgiKSwgMTApCiAgICAgICAgICAgICAgICAgICAgfSkuYXR0cigidGFiSW5kZXgiLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgYy5hdHRyKCJhcmlhLWhpZGRlbiIsICJmYWxzZSIpLnByZXYoKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtc2VsZWN0ZWQiOiAidHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleDogMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2FuaW1hdGU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZywgZiwgbSwgaCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gYS5jc3MoImJveC1zaXppbmciKSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEubGVuZ3RoICYmICghYy5sZW5ndGggfHwgYS5pbmRleCgpIDwgYy5pbmRleCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHRoaXMub3B0aW9ucy5hbmltYXRlIHx8IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBlID0gZSAmJiBuLmRvd24gfHwgbiwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5fdG9nZ2xlQ29tcGxldGUoZCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGUgJiYgKG0gPSBlKTsKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGUgJiYgKGYgPSBlKTsKICAgICAgICAgICAgICAgICAgICBmID0gZiB8fCBlLmVhc2luZyB8fCBuLmVhc2luZzsKICAgICAgICAgICAgICAgICAgICBtID0gbSB8fCBlLmR1cmF0aW9uIHx8IG4uZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjLmxlbmd0aCkgcmV0dXJuIGEuYW5pbWF0ZSh0aGlzLnNob3dQcm9wcywgbSwgZiwgcCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmxlbmd0aCkgcmV0dXJuIGMuYW5pbWF0ZSh0aGlzLmhpZGVQcm9wcywgbSwgZiwgcCk7CiAgICAgICAgICAgICAgICAgICAgZyA9IGEuc2hvdygpLm91dGVySGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgYy5hbmltYXRlKHRoaXMuaGlkZVByb3BzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBtLAogICAgICAgICAgICAgICAgICAgICAgICBlYXNpbmc6IGYsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubm93ID0gTWF0aC5yb3VuZChhKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYS5oaWRlKCkuYW5pbWF0ZSh0aGlzLnNob3dQcm9wcywgewogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogbSwKICAgICAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiBmLAogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogcCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5ub3cgPSBNYXRoLnJvdW5kKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImhlaWdodCIgIT09IGIucHJvcCA/ICJjb250ZW50LWJveCIgPT09IGwgJiYgKGsgKz0gYi5ub3cpIDogImNvbnRlbnQiICE9PSBoLm9wdGlvbnMuaGVpZ2h0U3R5bGUgJiYgKGIubm93ID0gTWF0aC5yb3VuZChnIC0gYy5vdXRlckhlaWdodCgpIC0gayksIGsgPSAwKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdG9nZ2xlQ29tcGxldGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEub2xkUGFuZWw7CiAgICAgICAgICAgICAgICAgICAgYy5yZW1vdmVDbGFzcygidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIikucHJldigpLnJlbW92ZUNsYXNzKCJ1aS1jb3JuZXItdG9wIikuYWRkQ2xhc3MoInVpLWNvcm5lci1hbGwiKTsKICAgICAgICAgICAgICAgICAgICBjLmxlbmd0aCAmJgogICAgICAgICAgICAgICAgICAgICAgICAoYy5wYXJlbnQoKVswXS5jbGFzc05hbWUgPSBjLnBhcmVudCgpWzBdLmNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigiYWN0aXZhdGUiLCBudWxsLCBhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLm1lbnUiLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIGRlZmF1bHRFbGVtZW50OiAiPHVsPiIsCiAgICAgICAgICAgICAgICBkZWxheTogMzAwLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGljb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1lbnU6ICJ1aS1pY29uLWNhcmF0LTEtZSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAiPiAqIiwKICAgICAgICAgICAgICAgICAgICBtZW51czogInVsIiwKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBteTogImxlZnQtMSB0b3AiLAogICAgICAgICAgICAgICAgICAgICAgICBhdDogInJpZ2h0IHRvcCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJvbGU6ICJtZW51IiwKICAgICAgICAgICAgICAgICAgICBibHVyOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGZvY3VzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTWVudSA9IHRoaXMuZWxlbWVudDsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdXNlSGFuZGxlZCA9ICExOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC51bmlxdWVJZCgpLmFkZENsYXNzKCJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCIpLnRvZ2dsZUNsYXNzKCJ1aS1tZW51LWljb25zIiwgISF0aGlzLmVsZW1lbnQuZmluZCgiLnVpLWljb24iKS5sZW5ndGgpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICByb2xlOiB0aGlzLm9wdGlvbnMucm9sZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpLmF0dHIoImFyaWEtZGlzYWJsZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1vdXNlZG93biAudWktbWVudS1pdGVtIjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGljayAudWktbWVudS1pdGVtIjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKGIudGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzLm1vdXNlSGFuZGxlZCAmJiBjLm5vdCgiLnVpLXN0YXRlLWRpc2FibGVkIikubGVuZ3RoICYmICh0aGlzLnNlbGVjdChiKSwgYi5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpIHx8ICh0aGlzLm1vdXNlSGFuZGxlZCA9ICEwKSwgYy5oYXMoIi51aS1tZW51IikubGVuZ3RoID8gdGhpcy5leHBhbmQoYikgOiAhdGhpcy5lbGVtZW50LmlzKCI6Zm9jdXMiKSAmJiBhKHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCkuY2xvc2VzdCgiLnVpLW1lbnUiKS5sZW5ndGggJiYgKHRoaXMuZWxlbWVudC50cmlnZ2VyKCJmb2N1cyIsIFshMF0pLCB0aGlzLmFjdGl2ZSAmJiAxID09PSB0aGlzLmFjdGl2ZS5wYXJlbnRzKCIudWktbWVudSIpLmxlbmd0aCAmJiBjbGVhclRpbWVvdXQodGhpcy50aW1lcikpKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAibW91c2VlbnRlciAudWktbWVudS1pdGVtIjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnByZXZpb3VzRmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhKGIuY3VycmVudFRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5zaWJsaW5ncygiLnVpLXN0YXRlLWFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKGIsIGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6ICJjb2xsYXBzZUFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtb3VzZWxlYXZlIC51aS1tZW51IjogImNvbGxhcHNlQWxsIiwKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5hY3RpdmUgfHwgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5lcSgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgfHwgdGhpcy5mb2N1cyhhLCBkKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbnRhaW5zKHRoaXMuZWxlbWVudFswXSwgdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50KSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxhcHNlQWxsKGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBrZXlkb3duOiAiX2tleWRvd24iCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy5kb2N1bWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xvc2VPbkRvY3VtZW50Q2xpY2soYSkgJiYgdGhpcy5jb2xsYXBzZUFsbChhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2VIYW5kbGVkID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyKCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnQiKS5maW5kKCIudWktbWVudSIpLmFkZEJhY2soKS5yZW1vdmVDbGFzcygidWktbWVudSB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktbWVudS1pY29ucyB1aS1mcm9udCIpLnJlbW92ZUF0dHIoInJvbGUiKS5yZW1vdmVBdHRyKCJ0YWJJbmRleCIpLnJlbW92ZUF0dHIoImFyaWEtbGFiZWxsZWRieSIpLnJlbW92ZUF0dHIoImFyaWEtZXhwYW5kZWQiKS5yZW1vdmVBdHRyKCJhcmlhLWhpZGRlbiIpLnJlbW92ZUF0dHIoImFyaWEtZGlzYWJsZWQiKS5yZW1vdmVVbmlxdWVJZCgpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZCgiLnVpLW1lbnUtaXRlbSIpLnJlbW92ZUNsYXNzKCJ1aS1tZW51LWl0ZW0iKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1kaXNhYmxlZCIpLnJlbW92ZVVuaXF1ZUlkKCkucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIikucmVtb3ZlQXR0cigidGFiSW5kZXgiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1oYXNwb3B1cCIpLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmRhdGEoInVpLW1lbnUtc3VibWVudS1jYXJhdCIpICYmIGIucmVtb3ZlKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZCgiLnVpLW1lbnUtZGl2aWRlciIpLnJlbW92ZUNsYXNzKCJ1aS1tZW51LWRpdmlkZXIgdWktd2lkZ2V0LWNvbnRlbnQiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9rZXlkb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGcsIGYgPSAhMDsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGIua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5QQUdFX1VQOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aW91c1BhZ2UoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuUEFHRV9ET1dOOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0UGFnZShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5IT01FOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgiZmlyc3QiLCAiZmlyc3QiLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5FTkQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlKCJsYXN0IiwgImxhc3QiLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5VUDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlvdXMoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5MRUZUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsYXBzZShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5SSUdIVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5pcygiLnVpLXN0YXRlLWRpc2FibGVkIikgJiYgdGhpcy5leHBhbmQoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRU5URVI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZhdGUoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRVNDQVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsYXBzZShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9ICExLCBjID0gdGhpcy5wcmV2aW91c0ZpbHRlciB8fCAiIiwgZCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYi5rZXlDb2RlKSwgZyA9ICExLCBjbGVhclRpbWVvdXQodGhpcy5maWx0ZXJUaW1lciksIGQgPT09IGMgPyBnID0gITAgOiBkID0gYyArIGQsIGMgPSB0aGlzLl9maWx0ZXJNZW51SXRlbXMoZCksIGMgPSBnICYmIC0xICE9PSBjLmluZGV4KHRoaXMuYWN0aXZlLm5leHQoKSkgPyB0aGlzLmFjdGl2ZS5uZXh0QWxsKCIudWktbWVudS1pdGVtIikgOiBjLCBjLmxlbmd0aCB8fCAoZCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYi5rZXlDb2RlKSwgYyA9IHRoaXMuX2ZpbHRlck1lbnVJdGVtcyhkKSksIGMubGVuZ3RoID8gKHRoaXMuZm9jdXMoYiwgYyksIHRoaXMucHJldmlvdXNGaWx0ZXIgPSBkLCB0aGlzLmZpbHRlclRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMucHJldmlvdXNGaWx0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDFFMykpIDogZGVsZXRlIHRoaXMucHJldmlvdXNGaWx0ZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZiAmJiBiLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWN0aXZhdGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZS5pcygiLnVpLXN0YXRlLWRpc2FibGVkIikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuYWN0aXZlLmlzKCJbYXJpYS1oYXNwb3B1cD0ndHJ1ZSddIikgPyB0aGlzLmV4cGFuZChhKSA6IHRoaXMuc2VsZWN0KGEpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBjID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMub3B0aW9ucy5pY29ucy5zdWJtZW51OwogICAgICAgICAgICAgICAgICAgIGIgPSB0aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMubWVudXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC50b2dnbGVDbGFzcygidWktbWVudS1pY29ucyIsICEhdGhpcy5lbGVtZW50LmZpbmQoIi51aS1pY29uIikubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBiLmZpbHRlcigiOm5vdCgudWktbWVudSkiKS5hZGRDbGFzcygidWktbWVudSB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktZnJvbnQiKS5oaWRlKCkuYXR0cih7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU6IHRoaXMub3B0aW9ucy5yb2xlLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgogICAgICAgICAgICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLnBhcmVudCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGEoIjxzcGFuPiIpLmFkZENsYXNzKCJ1aS1tZW51LWljb24gdWktaWNvbiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKS5kYXRhKCJ1aS1tZW51LXN1Ym1lbnUtY2FyYXQiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuYXR0cigiYXJpYS1oYXNwb3B1cCIsICJ0cnVlIikucHJlcGVuZChtKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5hdHRyKCJhcmlhLWxhYmVsbGVkYnkiLCBjLmF0dHIoImlkIikpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYiA9IGIuYWRkKHRoaXMuZWxlbWVudCkuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpOwogICAgICAgICAgICAgICAgICAgIGIubm90KCIudWktbWVudS1pdGVtIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjLl9pc0RpdmlkZXIoYikgJiYgYi5hZGRDbGFzcygidWktd2lkZ2V0LWNvbnRlbnQgdWktbWVudS1kaXZpZGVyIikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBiLm5vdCgiLnVpLW1lbnUtaXRlbSwgLnVpLW1lbnUtZGl2aWRlciIpLmFkZENsYXNzKCJ1aS1tZW51LWl0ZW0iKS51bmlxdWVJZCgpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleDogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU6IHRoaXMuX2l0ZW1Sb2xlKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBiLmZpbHRlcigiLnVpLXN0YXRlLWRpc2FibGVkIikuYXR0cigiYXJpYS1kaXNhYmxlZCIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgJiYgIWEuY29udGFpbnModGhpcy5lbGVtZW50WzBdLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVswXSkgJiYgdGhpcy5ibHVyKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaXRlbVJvbGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnU6ICJtZW51aXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Rib3g6ICJvcHRpb24iCiAgICAgICAgICAgICAgICAgICAgfVt0aGlzLm9wdGlvbnMucm9sZV0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgImljb25zIiA9PT0gYSAmJiB0aGlzLmVsZW1lbnQuZmluZCgiLnVpLW1lbnUtaWNvbiIpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5pY29ucy5zdWJtZW51KS5hZGRDbGFzcyhjLnN1Ym1lbnUpOwogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCIgPT09IGEgJiYgdGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhYykuYXR0cigiYXJpYS1kaXNhYmxlZCIsIGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKGEsIGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJsdXIoYSwgYSAmJiAiZm9jdXMiID09PSBhLnR5cGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbEludG9WaWV3KGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gYy5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmFjdGl2ZS5hZGRDbGFzcygidWktc3RhdGUtZm9jdXMiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJvbGUgJiYgdGhpcy5lbGVtZW50LmF0dHIoImFyaWEtYWN0aXZlZGVzY2VuZGFudCIsIGQuYXR0cigiaWQiKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUucGFyZW50KCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICBhICYmICJrZXlkb3duIiA9PT0gYS50eXBlID8gdGhpcy5fY2xvc2UoKSA6IHRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZGVsYXkpOwogICAgICAgICAgICAgICAgICAgIGQgPSBjLmNoaWxkcmVuKCIudWktbWVudSIpOwogICAgICAgICAgICAgICAgICAgIGQubGVuZ3RoICYmIGEgJiYgL15tb3VzZS8udGVzdChhLnR5cGUpICYmIHRoaXMuX3N0YXJ0T3BlbmluZyhkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZU1lbnUgPSBjLnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoImZvY3VzIiwgYSwgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBjCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYXNTY3JvbGwoKSAmJiAoYyA9IHBhcnNlRmxvYXQoYS5jc3ModGhpcy5hY3RpdmVNZW51WzBdLCAiYm9yZGVyVG9wV2lkdGgiKSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgMCwgZCA9IHBhcnNlRmxvYXQoYS5jc3ModGhpcy5hY3RpdmVNZW51WzBdLCAicGFkZGluZ1RvcCIpKSB8fCAwLCBjID0gYi5vZmZzZXQoKS50b3AgLSB0aGlzLmFjdGl2ZU1lbnUub2Zmc2V0KCkudG9wIC0gYyAtIGQsIGQgPSB0aGlzLmFjdGl2ZU1lbnUuc2Nyb2xsVG9wKCksIGcgPSB0aGlzLmFjdGl2ZU1lbnUuaGVpZ2h0KCksIGIgPSBiLm91dGVySGVpZ2h0KCksIDAgPiBjID8gdGhpcy5hY3RpdmVNZW51LnNjcm9sbFRvcChkICsgYykgOiBjICsgYiA+IGcgJiYgdGhpcy5hY3RpdmVNZW51LnNjcm9sbFRvcChkICsgYyAtIGcgKyBiKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYyB8fCBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgJiYgKHRoaXMuYWN0aXZlLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1mb2N1cyIpLCB0aGlzLmFjdGl2ZSA9IG51bGwsIHRoaXMuX3RyaWdnZXIoImJsdXIiLCBhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMuYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3N0YXJ0T3BlbmluZzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAidHJ1ZSIgPT09IGEuYXR0cigiYXJpYS1oaWRkZW4iKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50aW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29wZW4oYSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5kZWxheSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX29wZW46IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IHRoaXMuYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoIi51aS1tZW51Iikubm90KGIucGFyZW50cygiLnVpLW1lbnUiKSkuaGlkZSgpLmF0dHIoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICBiLnNob3coKS5yZW1vdmVBdHRyKCJhcmlhLWhpZGRlbiIpLmF0dHIoImFyaWEtZXhwYW5kZWQiLCAidHJ1ZSIpLnBvc2l0aW9uKGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sbGFwc2VBbGw6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGMgPyB0aGlzLmVsZW1lbnQgOiBhKGIgJiYgYi50YXJnZXQpLmNsb3Nlc3QodGhpcy5lbGVtZW50LmZpbmQoIi51aS1tZW51IikpOwogICAgICAgICAgICAgICAgICAgICAgICBkLmxlbmd0aCB8fCAoZCA9IHRoaXMuZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nsb3NlKGQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJsdXIoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTWVudSA9IGQKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmRlbGF5KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jbG9zZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgfHwgKGEgPSB0aGlzLmFjdGl2ZSA/IHRoaXMuYWN0aXZlLnBhcmVudCgpIDogdGhpcy5lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICBhLmZpbmQoIi51aS1tZW51IikuaGlkZSgpLmF0dHIoImFyaWEtaGlkZGVuIiwgInRydWUiKS5hdHRyKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIikuZW5kKCkuZmluZCgiLnVpLXN0YXRlLWFjdGl2ZSIpLm5vdCgiLnVpLXN0YXRlLWZvY3VzIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Nsb3NlT25Eb2N1bWVudENsaWNrOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFhKGIudGFyZ2V0KS5jbG9zZXN0KCIudWktbWVudSIpLmxlbmd0aAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pc0RpdmlkZXI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIS9bXlwtXHUyMDE0XHUyMDEzXHNdLy50ZXN0KGEudGV4dCgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbGxhcHNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZSAmJiB0aGlzLmFjdGl2ZS5wYXJlbnQoKS5jbG9zZXN0KCIudWktbWVudS1pdGVtIiwgdGhpcy5lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICBjICYmIGMubGVuZ3RoICYmICh0aGlzLl9jbG9zZSgpLCB0aGlzLmZvY3VzKGEsIGMpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGV4cGFuZDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5hY3RpdmUgJiYgdGhpcy5hY3RpdmUuY2hpbGRyZW4oIi51aS1tZW51ICIpLmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIGMgJiYgYy5sZW5ndGggJiYgKHRoaXMuX29wZW4oYy5wYXJlbnQoKSksIHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKGEsIGMpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdmUoIm5leHQiLCAiZmlyc3QiLCBhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByZXZpb3VzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgicHJldiIsICJsYXN0IiwgYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc0ZpcnN0SXRlbTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5wcmV2QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNMYXN0SXRlbTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlICYmCiAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzLmFjdGl2ZS5uZXh0QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdmU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZSAmJiAoZyA9ICJmaXJzdCIgPT09IGEgfHwgImxhc3QiID09PSBhID8gdGhpcy5hY3RpdmVbImZpcnN0IiA9PT0gYSA/ICJwcmV2QWxsIiA6ICJuZXh0QWxsIl0oIi51aS1tZW51LWl0ZW0iKS5lcSgtMSkgOiB0aGlzLmFjdGl2ZVthICsgIkFsbCJdKCIudWktbWVudS1pdGVtIikuZXEoMCkpOwogICAgICAgICAgICAgICAgICAgIGcgJiYgZy5sZW5ndGggJiYgdGhpcy5hY3RpdmUgfHwgKGcgPSB0aGlzLmFjdGl2ZU1lbnUuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpW2NdKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoZCwgZykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuZXh0UGFnZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID8gdGhpcy5pc0xhc3RJdGVtKCkgfHwgKHRoaXMuX2hhc1Njcm9sbCgpID8gKGQgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsIGcgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCksIHRoaXMuYWN0aXZlLm5leHRBbGwoIi51aS1tZW51LWl0ZW0iKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwID4gYy5vZmZzZXQoKS50b3AgLSBkIC0gZwogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmZvY3VzKGIsIGMpKSA6IHRoaXMuZm9jdXMoYiwgdGhpcy5hY3RpdmVNZW51LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKVt0aGlzLmFjdGl2ZSA/ICJsYXN0IiA6ICJmaXJzdCJdKCkpKSA6IHRoaXMubmV4dChiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByZXZpb3VzUGFnZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID8gdGhpcy5pc0ZpcnN0SXRlbSgpIHx8ICh0aGlzLl9oYXNTY3JvbGwoKSA/IChkID0gdGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wLCBnID0gdGhpcy5lbGVtZW50LmhlaWdodCgpLCB0aGlzLmFjdGl2ZS5wcmV2QWxsKCIudWktbWVudS1pdGVtIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwIDwgYy5vZmZzZXQoKS50b3AgLSBkICsgZwogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmZvY3VzKGIsIGMpKSA6IHRoaXMuZm9jdXMoYiwgdGhpcy5hY3RpdmVNZW51LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5maXJzdCgpKSkgOiB0aGlzLm5leHQoYikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaGFzU2Nyb2xsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkgPAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IHRoaXMuYWN0aXZlIHx8IGEoYi50YXJnZXQpLmNsb3Nlc3QoIi51aS1tZW51LWl0ZW0iKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogdGhpcy5hY3RpdmUKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlLmhhcygiLnVpLW1lbnUiKS5sZW5ndGggfHwgdGhpcy5jb2xsYXBzZUFsbChiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigic2VsZWN0IiwgYiwgYykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZmlsdGVyTWVudUl0ZW1zOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGIucmVwbGFjZSgvW1wtXFtcXXt9KCkqKz8uLFxcXF4kfCNcc10vZywgIlxcJCYiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyBSZWdFeHAoIl4iICsgYiwgImkiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVNZW51LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5maWx0ZXIoIi51aS1tZW51LWl0ZW0iKS5maWx0ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLnRlc3QoYS50cmltKGEodGhpcykudGV4dCgpKSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLmF1dG9jb21wbGV0ZSIsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgZGVmYXVsdEVsZW1lbnQ6ICI8aW5wdXQ+IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBhcHBlbmRUbzogbnVsbCwKICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXM6ICExLAogICAgICAgICAgICAgICAgICAgIGRlbGF5OiAzMDAsCiAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoOiAxLAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15OiAibGVmdCB0b3AiLAogICAgICAgICAgICAgICAgICAgICAgICBhdDogImxlZnQgYm90dG9tIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiAibm9uZSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgY2xvc2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZm9jdXM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgb3BlbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiBudWxsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdEluZGV4OiAwLAogICAgICAgICAgICAgICAgcGVuZGluZzogMCwKICAgICAgICAgICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBjLCBkLCBnID0gdGhpcy5lbGVtZW50WzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAidGV4dGFyZWEiID09PSBnLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gImlucHV0IiA9PT0gZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTXVsdGlMaW5lID0gZiA/ICEwIDogZyA/ICExIDogdGhpcy5lbGVtZW50LnByb3AoImlzQ29udGVudEVkaXRhYmxlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZU1ldGhvZCA9IHRoaXMuZWxlbWVudFtmIHx8IGcgPyAidmFsIiA6ICJ0ZXh0Il07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc05ld01lbnUgPSAhMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWF1dG9jb21wbGV0ZS1pbnB1dCIpLmF0dHIoImF1dG9jb21wbGV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJvZmYiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLmVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5wcm9wKCJyZWFkT25seSIpKSBjID0gZCA9IGIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBkID0gYiA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gYS51aS5rZXlDb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZi5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZy5QQUdFX1VQOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgicHJldmlvdXNQYWdlIiwgZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLlBBR0VfRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdmUoIm5leHRQYWdlIiwgZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLlVQOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5RXZlbnQoInByZXZpb3VzIiwgZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLkRPV046CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9rZXlFdmVudCgibmV4dCIsIGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZy5FTlRFUjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVudS5hY3RpdmUgJiYgKGIgPSAhMCwgZi5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLm1lbnUuc2VsZWN0KGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGcuVEFCOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51LmFjdGl2ZSAmJiB0aGlzLm1lbnUuc2VsZWN0KGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZy5FU0NBUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMuX3ZhbHVlKHRoaXMudGVybSksIHRoaXMuY2xvc2UoZiksIGYucHJldmVudERlZmF1bHQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAhMCwgdGhpcy5fc2VhcmNoVGltZW91dChmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAga2V5cHJlc3M6IGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSBiID0gITEsIHRoaXMuaXNNdWx0aUxpbmUgJiYgIXRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpIHx8IGQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBhLnVpLmtleUNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChkLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBmLlBBR0VfVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlKCJwcmV2aW91c1BhZ2UiLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGYuUEFHRV9ET1dOOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgibmV4dFBhZ2UiLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGYuVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9rZXlFdmVudCgicHJldmlvdXMiLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGYuRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleUV2ZW50KCJuZXh0IiwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID8gKGQgPSAhMSwgYS5wcmV2ZW50RGVmYXVsdCgpKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VhcmNoVGltZW91dChhKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmb2N1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzID0gdGhpcy5fdmFsdWUoKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbEJsdXIgPyBkZWxldGUgdGhpcy5jYW5jZWxCbHVyIDogKGNsZWFyVGltZW91dCh0aGlzLnNlYXJjaGluZyksIHRoaXMuY2xvc2UoYSksIHRoaXMuX2NoYW5nZShhKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRTb3VyY2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUgPSBhKCI8dWw+IikuYWRkQ2xhc3MoInVpLWF1dG9jb21wbGV0ZSB1aS1mcm9udCIpLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpLm1lbnUoewogICAgICAgICAgICAgICAgICAgICAgICByb2xlOiBudWxsCiAgICAgICAgICAgICAgICAgICAgfSkuaGlkZSgpLm1lbnUoImluc3RhbmNlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy5tZW51LmVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbEJsdXIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbEJsdXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm1lbnUuZWxlbWVudFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi50YXJnZXQpLmNsb3Nlc3QoIi51aS1tZW51LWl0ZW0iKS5sZW5ndGggfHwgdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQub25lKCJtb3VzZWRvd24iLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudGFyZ2V0ID09PSBiLmVsZW1lbnRbMF0gfHwgZC50YXJnZXQgPT09IGMgfHwgYS5jb250YWlucyhjLCBkLnRhcmdldCkgfHwgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVmb2N1czogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc05ld01lbnUgJiYgKHRoaXMuaXNOZXdNZW51ID0gITEsIGIub3JpZ2luYWxFdmVudCAmJiAvXm1vdXNlLy50ZXN0KGIub3JpZ2luYWxFdmVudC50eXBlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUuYmx1cigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQub25lKCJtb3VzZW1vdmUiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiLnRhcmdldCkudHJpZ2dlcihiLm9yaWdpbmFsRXZlbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5pdGVtLmRhdGEoInVpLWF1dG9jb21wbGV0ZS1pdGVtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSAhPT0gdGhpcy5fdHJpZ2dlcigiZm9jdXMiLCBiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIub3JpZ2luYWxFdmVudCAmJiAvXmtleS8udGVzdChiLm9yaWdpbmFsRXZlbnQudHlwZSkgJiYgdGhpcy5fdmFsdWUoZC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZCA9IGMuaXRlbS5hdHRyKCJhcmlhLWxhYmVsIikgfHwgZC52YWx1ZSkgJiYgYS50cmltKGQpLmxlbmd0aCAmJiAodGhpcy5saXZlUmVnaW9uLmNoaWxkcmVuKCkuaGlkZSgpLCBhKCI8ZGl2PiIpLnRleHQoZCkuYXBwZW5kVG8odGhpcy5saXZlUmVnaW9uKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbWVudXNlbGVjdDogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLml0ZW0uZGF0YSgidWktYXV0b2NvbXBsZXRlLWl0ZW0iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5wcmV2aW91czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50ICYmICh0aGlzLmVsZW1lbnQuZm9jdXMoKSwgdGhpcy5wcmV2aW91cyA9IGQsIHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlvdXMgPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09IHRoaXMuX3RyaWdnZXIoInNlbGVjdCIsIGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSAmJiB0aGlzLl92YWx1ZShjLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybSA9IHRoaXMuX3ZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBjCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxpdmVSZWdpb24gPSBhKCI8c3Bhbj4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU6ICJzdGF0dXMiLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1saXZlIjogImFzc2VydGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLXJlbGV2YW50IjogImFkZGl0aW9ucyIKICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIikuYXBwZW5kVG8odGhpcy5kb2N1bWVudFswXS5ib2R5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLndpbmRvdywgewogICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmV1bmxvYWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoImF1dG9jb21wbGV0ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zZWFyY2hpbmcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktYXV0b2NvbXBsZXRlLWlucHV0IikucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51LmVsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXZlUmVnaW9uLnJlbW92ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBjKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3VwZXIoYSwgYyk7CiAgICAgICAgICAgICAgICAgICAgInNvdXJjZSIgPT09IGEgJiYgdGhpcy5faW5pdFNvdXJjZSgpOwogICAgICAgICAgICAgICAgICAgICJhcHBlbmRUbyIgPT09IGEgJiYgdGhpcy5tZW51LmVsZW1lbnQuYXBwZW5kVG8odGhpcy5fYXBwZW5kVG8oKSk7CiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVkIiA9PT0gYSAmJiBjICYmIHRoaXMueGhyICYmIHRoaXMueGhyLmFib3J0KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXBwZW5kVG86IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5vcHRpb25zLmFwcGVuZFRvOwogICAgICAgICAgICAgICAgICAgIGIgJiYgKGIgPSBiLmpxdWVyeSB8fCBiLm5vZGVUeXBlID8gYShiKSA6IHRoaXMuZG9jdW1lbnQuZmluZChiKS5lcSgwKSk7CiAgICAgICAgICAgICAgICAgICAgYiAmJiBiWzBdIHx8IChiID0gdGhpcy5lbGVtZW50LmNsb3Nlc3QoIi51aS1mcm9udCIpKTsKICAgICAgICAgICAgICAgICAgICBiLmxlbmd0aCB8fCAoYiA9IHRoaXMuZG9jdW1lbnRbMF0uYm9keSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaW5pdFNvdXJjZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMsIGQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGEuaXNBcnJheSh0aGlzLm9wdGlvbnMuc291cmNlKSA/IChiID0gdGhpcy5vcHRpb25zLnNvdXJjZSwgdGhpcy5zb3VyY2UgPSBmdW5jdGlvbihjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQoYS51aS5hdXRvY29tcGxldGUuZmlsdGVyKGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnRlcm0pKQogICAgICAgICAgICAgICAgICAgIH0pIDogInN0cmluZyIgPT09IHR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlID8gKGMgPSB0aGlzLm9wdGlvbnMuc291cmNlLCB0aGlzLnNvdXJjZSA9IGZ1bmN0aW9uKGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC54aHIgJiYgZC54aHIuYWJvcnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZC54aHIgPSBhLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZihhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKFtdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pIDogdGhpcy5zb3VyY2UgPSB0aGlzLm9wdGlvbnMuc291cmNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NlYXJjaFRpbWVvdXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zZWFyY2hpbmcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoaW5nID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy50ZXJtID09PSB0aGlzLl92YWx1ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEuYWx0S2V5IHx8IGEuY3RybEtleSB8fCBhLm1ldGFLZXkgfHwgYS5zaGlmdEtleTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjIHx8IGMgJiYgIWQgJiYgIWcpIHRoaXMuc2VsZWN0ZWRJdGVtID0gbnVsbCwgdGhpcy5zZWFyY2gobnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEpCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmRlbGF5KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlYXJjaDogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIGEgPSBudWxsICE9IGEgPyBhIDogdGhpcy5fdmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm0gPSB0aGlzLl92YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChhLmxlbmd0aCA8IHRoaXMub3B0aW9ucy5taW5MZW5ndGgpIHJldHVybiB0aGlzLmNsb3NlKGMpOwogICAgICAgICAgICAgICAgICAgIGlmICghMSAhPT0gdGhpcy5fdHJpZ2dlcigic2VhcmNoIiwgYykpIHJldHVybiB0aGlzLl9zZWFyY2goYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2VhcmNoOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nKys7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsU2VhcmNoID0gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UoewogICAgICAgICAgICAgICAgICAgICAgICB0ZXJtOiBhCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fcmVzcG9uc2UoKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVzcG9uc2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gKyt0aGlzLnJlcXVlc3RJbmRleDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5wcm94eShmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID09PSB0aGlzLnJlcXVlc3RJbmRleCAmJiB0aGlzLl9fcmVzcG9uc2UoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmctLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZyB8fCB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYSAmJiAoYSA9IHRoaXMuX25vcm1hbGl6ZShhKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigicmVzcG9uc2UiLCBudWxsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGEKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAhdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIGEgJiYgYS5sZW5ndGggJiYgIXRoaXMuY2FuY2VsU2VhcmNoID8gKHRoaXMuX3N1Z2dlc3QoYSksIHRoaXMuX3RyaWdnZXIoIm9wZW4iKSkgOiB0aGlzLl9jbG9zZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbFNlYXJjaCA9ICEwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nsb3NlKGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Nsb3NlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikgJiYgKHRoaXMubWVudS5lbGVtZW50LmhpZGUoKSwgdGhpcy5tZW51LmJsdXIoKSwgdGhpcy5pc05ld01lbnUgPSAhMCwgdGhpcy5fdHJpZ2dlcigiY2xvc2UiLCBhKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2hhbmdlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aW91cyAhPT0gdGhpcy5fdmFsdWUoKSAmJiB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCBhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMuc2VsZWN0ZWRJdGVtCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbm9ybWFsaXplOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIubGVuZ3RoICYmIGJbMF0ubGFiZWwgJiYgYlswXS52YWx1ZSA/IGIgOiBhLm1hcChiLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBiCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBhLmV4dGVuZCh7fSwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGIubGFiZWwgfHwgYi52YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBiLnZhbHVlIHx8IGIubGFiZWwKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zdWdnZXN0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm1lbnUuZWxlbWVudC5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlck1lbnUoYywgYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc05ld01lbnUgPSAhMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUucmVmcmVzaCgpOwogICAgICAgICAgICAgICAgICAgIGMuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2l6ZU1lbnUoKTsKICAgICAgICAgICAgICAgICAgICBjLnBvc2l0aW9uKGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IHRoaXMuZWxlbWVudAogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5wb3NpdGlvbikpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdXRvRm9jdXMgJiYgdGhpcy5tZW51Lm5leHQoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZXNpemVNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMubWVudS5lbGVtZW50OwogICAgICAgICAgICAgICAgICAgIGEub3V0ZXJXaWR0aChNYXRoLm1heChhLndpZHRoKCIiKS5vdXRlcldpZHRoKCkgKwogICAgICAgICAgICAgICAgICAgICAgICAxLCB0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVuZGVyTWVudTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBhLmVhY2goYywgZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICBkLl9yZW5kZXJJdGVtRGF0YShiLCBjKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3JlbmRlckl0ZW1EYXRhOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckl0ZW0oYSwgYykuZGF0YSgidWktYXV0b2NvbXBsZXRlLWl0ZW0iLCBjKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZW5kZXJJdGVtOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoIjxsaT4iKS50ZXh0KGMubGFiZWwpLmFwcGVuZFRvKGIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdmU6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lbnUuaXNGaXJzdEl0ZW0oKSAmJiAvXnByZXZpb3VzLy50ZXN0KGEpIHx8IHRoaXMubWVudS5pc0xhc3RJdGVtKCkgJiYgL15uZXh0Ly50ZXN0KGEpKSB0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMuX3ZhbHVlKHRoaXMudGVybSksIHRoaXMubWVudS5ibHVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5tZW51W2FdKGMpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5zZWFyY2gobnVsbCwgYykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3aWRnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1lbnUuZWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF92YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVNZXRob2QuYXBwbHkodGhpcy5lbGVtZW50LCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2tleUV2ZW50OiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpKSB0aGlzLl9tb3ZlKGEsIGMpLCBjLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEuZXh0ZW5kKGEudWkuYXV0b2NvbXBsZXRlLCB7CiAgICAgICAgICAgICAgICBlc2NhcGVSZWdleDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnJlcGxhY2UoL1tcLVxbXF17fSgpKis/LixcXFxeJHwjXHNdL2csICJcXCQmIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBSZWdFeHAoYS51aS5hdXRvY29tcGxldGUuZXNjYXBlUmVnZXgoYyksICJpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZ3JlcChiLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnRlc3QoYS5sYWJlbCB8fCBhLnZhbHVlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkuYXV0b2NvbXBsZXRlIiwgYS51aS5hdXRvY29tcGxldGUsIHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlczogewogICAgICAgICAgICAgICAgICAgICAgICBub1Jlc3VsdHM6ICJObyBzZWFyY2ggcmVzdWx0cy4iLAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArICgxIDwgYSA/ICIgcmVzdWx0cyBhcmUiIDogIiByZXN1bHQgaXMiKSArICIgYXZhaWxhYmxlLCB1c2UgdXAgYW5kIGRvd24gYXJyb3cga2V5cyB0byBuYXZpZ2F0ZS4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX19yZXNwb25zZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyQXBwbHkoYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgdGhpcy5jYW5jZWxTZWFyY2ggfHwgKGMgPSBiICYmIGIubGVuZ3RoID8gdGhpcy5vcHRpb25zLm1lc3NhZ2VzLnJlc3VsdHMoYi5sZW5ndGgpIDogdGhpcy5vcHRpb25zLm1lc3NhZ2VzLm5vUmVzdWx0cywgdGhpcy5saXZlUmVnaW9uLmNoaWxkcmVuKCkuaGlkZSgpLCBhKCI8ZGl2PiIpLnRleHQoYykuYXBwZW5kVG8odGhpcy5saXZlUmVnaW9uKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBtYSwgZmEgPQogICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuZmluZCgiOnVpLWJ1dHRvbiIpLmJ1dHRvbigicmVmcmVzaCIpCiAgICAgICAgICAgICAgICAgICAgfSwgMSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhYSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGIubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGIuZm9ybSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEoW10pOwogICAgICAgICAgICAgICAgICAgIGMgJiYgKGMgPSBjLnJlcGxhY2UoLycvZywgIlxcJyIpLCBnID0gZCA/IGEoZCkuZmluZCgiW25hbWU9JyIgKyBjICsgIiddW3R5cGU9cmFkaW9dIikgOiBhKCJbbmFtZT0nIiArIGMgKyAiJ11bdHlwZT1yYWRpb10iLCBiLm93bmVyRG9jdW1lbnQpLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmZvcm0KICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5idXR0b24iLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIGRlZmF1bHRFbGVtZW50OiAiPGJ1dHRvbj4iLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICEwLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGljb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnk6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeTogbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuY2xvc2VzdCgiZm9ybSIpLnVuYmluZCgicmVzZXQiICsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudE5hbWVzcGFjZSkuYmluZCgicmVzZXQiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZmEpOwogICAgICAgICAgICAgICAgICAgICJib29sZWFuIiAhPT0gdHlwZW9mIHRoaXMub3B0aW9ucy5kaXNhYmxlZCA/IHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9ICEhdGhpcy5lbGVtZW50LnByb3AoImRpc2FibGVkIikgOiB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiLCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RldGVybWluZUJ1dHRvblR5cGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc1RpdGxlID0gISF0aGlzLmJ1dHRvbkVsZW1lbnQuYXR0cigidGl0bGUiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAiY2hlY2tib3giID09PSB0aGlzLnR5cGUgfHwgInJhZGlvIiA9PT0gdGhpcy50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gZCA/ICIiIDogInVpLXN0YXRlLWFjdGl2ZSI7CiAgICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gYy5sYWJlbCAmJiAoYy5sYWJlbCA9ICJpbnB1dCIgPT09IHRoaXMudHlwZSA/IHRoaXMuYnV0dG9uRWxlbWVudC52YWwoKSA6IHRoaXMuYnV0dG9uRWxlbWVudC5odG1sKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hvdmVyYWJsZSh0aGlzLmJ1dHRvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKS5hdHRyKCJyb2xlIiwgImJ1dHRvbiIpLmJpbmQoIm1vdXNlZW50ZXIiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZGlzYWJsZWQgfHwgdGhpcyA9PT0gbWEgJiYgYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKCJtb3VzZWxlYXZlIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjLmRpc2FibGVkIHx8IGEodGhpcykucmVtb3ZlQ2xhc3MoZykKICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKCJjbGljayIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZGlzYWJsZWQgJiYgKGEucHJldmVudERlZmF1bHQoKSwgYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktc3RhdGUtZm9jdXMiKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZCAmJiB0aGlzLmVsZW1lbnQuYmluZCgiY2hhbmdlIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBiLnJlZnJlc2goKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICJjaGVja2JveCIgPT09IHRoaXMudHlwZSA/IHRoaXMuYnV0dG9uRWxlbWVudC5iaW5kKCJjbGljayIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuZGlzYWJsZWQpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0pIDogInJhZGlvIiA9PT0gdGhpcy50eXBlID8gdGhpcy5idXR0b25FbGVtZW50LmJpbmQoImNsaWNrIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5kaXNhYmxlZCkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5idXR0b25FbGVtZW50LmF0dHIoImFyaWEtcHJlc3NlZCIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYi5lbGVtZW50WzBdOwogICAgICAgICAgICAgICAgICAgICAgICBhYShkKS5ub3QoZCkubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuYnV0dG9uKCJ3aWRnZXQiKVswXQogICAgICAgICAgICAgICAgICAgICAgICB9KS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIikuYXR0cigiYXJpYS1wcmVzc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWxzZSIpCiAgICAgICAgICAgICAgICAgICAgfSkgOiAodGhpcy5idXR0b25FbGVtZW50LmJpbmQoIm1vdXNlZG93biIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuZGlzYWJsZWQpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgYi5kb2N1bWVudC5vbmUoIm1vdXNldXAiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pLmJpbmQoIm1vdXNldXAiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmRpc2FibGVkKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgfSkuYmluZCgia2V5ZG93biIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmRpc2FibGVkKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGIua2V5Q29kZSAhPT0gYS51aS5rZXlDb2RlLlNQQUNFICYmIGIua2V5Q29kZSAhPT0gYS51aS5rZXlDb2RlLkVOVEVSIHx8IGEodGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgfSkuYmluZCgia2V5dXAiICsgdGhpcy5ldmVudE5hbWVzcGFjZSArCiAgICAgICAgICAgICAgICAgICAgICAgICIgYmx1ciIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmJ1dHRvbkVsZW1lbnQuaXMoImEiKSAmJiB0aGlzLmJ1dHRvbkVsZW1lbnQua2V5dXAoZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICBiLmtleUNvZGUgPT09IGEudWkua2V5Q29kZS5TUEFDRSAmJiBhKHRoaXMpLmNsaWNrKCkKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0T3B0aW9uKCJkaXNhYmxlZCIsIGMuZGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QnV0dG9uKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGV0ZXJtaW5lQnV0dG9uVHlwZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEsIGM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlzKCJbdHlwZT1jaGVja2JveF0iKSA/IHRoaXMudHlwZSA9ICJjaGVja2JveCIgOiB0aGlzLmVsZW1lbnQuaXMoIlt0eXBlPXJhZGlvXSIpID8gdGhpcy50eXBlID0gInJhZGlvIiA6IHRoaXMuZWxlbWVudC5pcygiaW5wdXQiKSA/IHRoaXMudHlwZSA9ICJpbnB1dCIgOiB0aGlzLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgICAgICAgICAgICAgICAiY2hlY2tib3giID09PSB0aGlzLnR5cGUgfHwgInJhZGlvIiA9PT0gdGhpcy50eXBlID8KICAgICAgICAgICAgICAgICAgICAgICAgKGEgPSB0aGlzLmVsZW1lbnQucGFyZW50cygpLmxhc3QoKSwgYyA9ICJsYWJlbFtmb3I9JyIgKyB0aGlzLmVsZW1lbnQuYXR0cigiaWQiKSArICInXSIsIHRoaXMuYnV0dG9uRWxlbWVudCA9IGEuZmluZChjKSwgdGhpcy5idXR0b25FbGVtZW50Lmxlbmd0aCB8fCAoYSA9IGEubGVuZ3RoID8gYS5zaWJsaW5ncygpIDogdGhpcy5lbGVtZW50LnNpYmxpbmdzKCksIHRoaXMuYnV0dG9uRWxlbWVudCA9IGEuZmlsdGVyKGMpLCB0aGlzLmJ1dHRvbkVsZW1lbnQubGVuZ3RoIHx8ICh0aGlzLmJ1dHRvbkVsZW1lbnQgPSBhLmZpbmQoYykpKSwgdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGUiKSwgKGEgPSB0aGlzLmVsZW1lbnQuaXMoIjpjaGVja2VkIikpICYmIHRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIiksIHRoaXMuYnV0dG9uRWxlbWVudC5wcm9wKCJhcmlhLXByZXNzZWQiLCBhKSkgOiB0aGlzLmJ1dHRvbkVsZW1lbnQgPSB0aGlzLmVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3aWRnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1dHRvbkVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWFjdGl2ZSB1aS1idXR0b24taWNvbnMtb25seSB1aS1idXR0b24taWNvbi1vbmx5IHVpLWJ1dHRvbi10ZXh0LWljb25zIHVpLWJ1dHRvbi10ZXh0LWljb24tcHJpbWFyeSB1aS1idXR0b24tdGV4dC1pY29uLXNlY29uZGFyeSB1aS1idXR0b24tdGV4dC1vbmx5IikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoImFyaWEtcHJlc3NlZCIpLmh0bWwodGhpcy5idXR0b25FbGVtZW50LmZpbmQoIi51aS1idXR0b24tdGV4dCIpLmh0bWwoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNUaXRsZSB8fCB0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cigidGl0bGUiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRPcHRpb246IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihhLAogICAgICAgICAgICAgICAgICAgICAgICBjKTsKICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZWQiID09PSBhID8gKHRoaXMud2lkZ2V0KCkudG9nZ2xlQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIiwgISFjKSwgdGhpcy5lbGVtZW50LnByb3AoImRpc2FibGVkIiwgISFjKSwgYyAmJiAoImNoZWNrYm94IiA9PT0gdGhpcy50eXBlIHx8ICJyYWRpbyIgPT09IHRoaXMudHlwZSA/IHRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKSA6IHRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMgdWktc3RhdGUtYWN0aXZlIikpKSA6IHRoaXMuX3Jlc2V0QnV0dG9uKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuZWxlbWVudC5pcygiaW5wdXQsIGJ1dHRvbiIpID8gdGhpcy5lbGVtZW50LmlzKCI6ZGlzYWJsZWQiKSA6IHRoaXMuZWxlbWVudC5oYXNDbGFzcygidWktYnV0dG9uLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgYiAhPT0gdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLCBiKTsKICAgICAgICAgICAgICAgICAgICAicmFkaW8iID09PSB0aGlzLnR5cGUgPyBhYSh0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuaXMoIjpjaGVja2VkIikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5idXR0b24oIndpZGdldCIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKCJhcmlhLXByZXNzZWQiLCAidHJ1ZSIpIDogYSh0aGlzKS5idXR0b24oIndpZGdldCIpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKCJhcmlhLXByZXNzZWQiLCAiZmFsc2UiKQogICAgICAgICAgICAgICAgICAgIH0pIDogImNoZWNrYm94IiA9PT0gdGhpcy50eXBlICYmICh0aGlzLmVsZW1lbnQuaXMoIjpjaGVja2VkIikgPyB0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsICJ0cnVlIikgOiB0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsICJmYWxzZSIpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZXNldEJ1dHRvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJpbnB1dCIgPT09IHRoaXMudHlwZSkgdGhpcy5vcHRpb25zLmxhYmVsICYmIHRoaXMuZWxlbWVudC52YWwodGhpcy5vcHRpb25zLmxhYmVsKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHkiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhKCI8c3Bhbj48L3NwYW4+IiwgdGhpcy5kb2N1bWVudFswXSkuYWRkQ2xhc3MoInVpLWJ1dHRvbi10ZXh0IikuaHRtbCh0aGlzLm9wdGlvbnMubGFiZWwpLmFwcGVuZFRvKGIuZW1wdHkoKSkudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMub3B0aW9ucy5pY29ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkLnByaW1hcnkgJiYgZC5zZWNvbmRhcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGQucHJpbWFyeSB8fCBkLnNlY29uZGFyeSA/ICh0aGlzLm9wdGlvbnMudGV4dCAmJiBmLnB1c2goInVpLWJ1dHRvbi10ZXh0LWljb24iICsgKGcgPyAicyIgOiBkLnByaW1hcnkgPyAiLXByaW1hcnkiIDogIi1zZWNvbmRhcnkiKSksIGQucHJpbWFyeSAmJiBiLnByZXBlbmQoIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1wcmltYXJ5IHVpLWljb24gIiArIGQucHJpbWFyeSArICInPjwvc3Bhbj4iKSwgZC5zZWNvbmRhcnkgJiYgYi5hcHBlbmQoIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1zZWNvbmRhcnkgdWktaWNvbiAiICsgZC5zZWNvbmRhcnkgKyAiJz48L3NwYW4+IiksIHRoaXMub3B0aW9ucy50ZXh0IHx8IChmLnB1c2goZyA/ICJ1aS1idXR0b24taWNvbnMtb25seSIgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVpLWJ1dHRvbi1pY29uLW9ubHkiKSwgdGhpcy5oYXNUaXRsZSB8fCBiLmF0dHIoInRpdGxlIiwgYS50cmltKGMpKSkpIDogZi5wdXNoKCJ1aS1idXR0b24tdGV4dC1vbmx5Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuYWRkQ2xhc3MoZi5qb2luKCIgIikpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLmJ1dHRvbnNldCIsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAiYnV0dG9uLCBpbnB1dFt0eXBlPWJ1dHRvbl0sIGlucHV0W3R5cGU9c3VibWl0XSwgaW5wdXRbdHlwZT1yZXNldF0sIGlucHV0W3R5cGU9Y2hlY2tib3hdLCBpbnB1dFt0eXBlPXJhZGlvXSwgYSwgOmRhdGEodWktYnV0dG9uKSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWJ1dHRvbnNldCIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2luaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCIgPT09IGEgJiYgdGhpcy5idXR0b25zLmJ1dHRvbigib3B0aW9uIiwgYSwgYyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3VwZXIoYSwgYykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICJydGwiID09PSB0aGlzLmVsZW1lbnQuY3NzKCJkaXJlY3Rpb24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5pdGVtcyksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjLmZpbHRlcigiOnVpLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgICAgIGMubm90KCI6dWktYnV0dG9uIikuYnV0dG9uKCk7CiAgICAgICAgICAgICAgICAgICAgZC5idXR0b24oInJlZnJlc2giKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbnMgPSBjLm1hcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuYnV0dG9uKCJ3aWRnZXQiKVswXQogICAgICAgICAgICAgICAgICAgIH0pLnJlbW92ZUNsYXNzKCJ1aS1jb3JuZXItYWxsIHVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodCIpLmZpbHRlcigiOmZpcnN0IikuYWRkQ2xhc3MoYiA/ICJ1aS1jb3JuZXItcmlnaHQiIDogInVpLWNvcm5lci1sZWZ0IikuZW5kKCkuZmlsdGVyKCI6bGFzdCIpLmFkZENsYXNzKGIgPyAidWktY29ybmVyLWxlZnQiIDogInVpLWNvcm5lci1yaWdodCIpLmVuZCgpLmVuZCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktYnV0dG9uc2V0Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b25zLm1hcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEodGhpcykuYnV0dG9uKCJ3aWRnZXQiKVswXQogICAgICAgICAgICAgICAgICAgIH0pLnJlbW92ZUNsYXNzKCJ1aS1jb3JuZXItbGVmdCB1aS1jb3JuZXItcmlnaHQiKS5lbmQoKS5idXR0b24oImRlc3Ryb3kiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS5leHRlbmQoYS51aSwgewogICAgICAgICAgICAgICAgZGF0ZXBpY2tlcjogewogICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgVzsKICAgICAgICAgICAgYS5leHRlbmQodi5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIG1hcmtlckNsYXNzTmFtZTogImhhc0RhdGVwaWNrZXIiLAogICAgICAgICAgICAgICAgbWF4Um93czogNCwKICAgICAgICAgICAgICAgIF93aWRnZXREYXRlcGlja2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kcERpdgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldERlZmF1bHRzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgSSh0aGlzLl9kZWZhdWx0cywgYSB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXR0YWNoRGF0ZXBpY2tlcjogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkLCBnLCBmOwogICAgICAgICAgICAgICAgICAgIGQgPSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgZyA9ICJkaXYiID09PSBkIHx8ICJzcGFuIiA9PT0gZDsKICAgICAgICAgICAgICAgICAgICBiLmlkIHx8ICh0aGlzLnV1aWQgKz0gMSwgYi5pZCA9ICJkcCIgKyB0aGlzLnV1aWQpOwogICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLl9uZXdJbnN0KGEoYiksIGcpOwogICAgICAgICAgICAgICAgICAgIGYuc2V0dGluZ3MgPSBhLmV4dGVuZCh7fSwgYyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgImlucHV0IiA9PT0gZCA/IHRoaXMuX2Nvbm5lY3REYXRlcGlja2VyKGIsIGYpIDogZyAmJiB0aGlzLl9pbmxpbmVEYXRlcGlja2VyKGIsIGYpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX25ld0luc3Q6IGZ1bmN0aW9uKGIsCiAgICAgICAgICAgICAgICAgICAgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBiWzBdLmlkLnJlcGxhY2UoLyhbXkEtWmEtejAtOV9cLV0pL2csICJcXFxcJDEiKSwKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRGF5OiAwLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZE1vbnRoOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFllYXI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdNb250aDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZHJhd1llYXI6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZTogYywKICAgICAgICAgICAgICAgICAgICAgICAgZHBEaXY6IGMgPyBGKGEoIjxkaXYgY2xhc3M9JyIgKyB0aGlzLl9pbmxpbmVDbGFzcyArICIgdWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGwnPjwvZGl2PiIpKSA6IHRoaXMuZHBEaXYKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Nvbm5lY3REYXRlcGlja2VyOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhKGIpOwogICAgICAgICAgICAgICAgICAgIGMuYXBwZW5kID0gYShbXSk7CiAgICAgICAgICAgICAgICAgICAgYy50cmlnZ2VyID0gYShbXSk7CiAgICAgICAgICAgICAgICAgICAgZC5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkgfHwgKHRoaXMuX2F0dGFjaG1lbnRzKGQsIGMpLCBkLmFkZENsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5rZXlkb3duKHRoaXMuX2RvS2V5RG93bikua2V5cHJlc3ModGhpcy5fZG9LZXlQcmVzcykua2V5dXAodGhpcy5fZG9LZXlVcCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9TaXplKGMpLCBhLmRhdGEoYiwgImRhdGVwaWNrZXIiLCBjKSwgYy5zZXR0aW5ncy5kaXNhYmxlZCAmJiB0aGlzLl9kaXNhYmxlRGF0ZXBpY2tlcihiKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXR0YWNobWVudHM6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZzsKICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fZ2V0KGMsICJhcHBlbmRUZXh0Iik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzLl9nZXQoYywgImlzUlRMIik7CiAgICAgICAgICAgICAgICAgICAgYy5hcHBlbmQgJiYgYy5hcHBlbmQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgZCAmJiAoYy5hcHBlbmQgPSBhKCI8c3BhbiBjbGFzcz0nIiArIHRoaXMuX2FwcGVuZENsYXNzICsgIic+IiArIGQgKyAiPC9zcGFuPiIpLCBiW2YgPyAiYmVmb3JlIiA6ICJhZnRlciJdKGMuYXBwZW5kKSk7CiAgICAgICAgICAgICAgICAgICAgYi51bmJpbmQoImZvY3VzIiwgdGhpcy5fc2hvd0RhdGVwaWNrZXIpOwogICAgICAgICAgICAgICAgICAgIGMudHJpZ2dlciAmJiBjLnRyaWdnZXIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX2dldChjLCAic2hvd09uIik7CiAgICAgICAgICAgICAgICAgICAgImZvY3VzIiAhPT0gZCAmJiAiYm90aCIgIT09IGQgfHwgYi5mb2N1cyh0aGlzLl9zaG93RGF0ZXBpY2tlcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJidXR0b24iID09PSBkIHx8ICJib3RoIiA9PT0gZCkgZCA9IHRoaXMuX2dldChjLAogICAgICAgICAgICAgICAgICAgICAgICAiYnV0dG9uVGV4dCIpLCBnID0gdGhpcy5fZ2V0KGMsICJidXR0b25JbWFnZSIpLCBjLnRyaWdnZXIgPSBhKHRoaXMuX2dldChjLCAiYnV0dG9uSW1hZ2VPbmx5IikgPyBhKCI8aW1nLz4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICBzcmM6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsdDogZCwKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGQKICAgICAgICAgICAgICAgICAgICB9KSA6IGEoIjxidXR0b24gdHlwZT0nYnV0dG9uJz48L2J1dHRvbj4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLmh0bWwoZyA/IGEoIjxpbWcvPiIpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICBzcmM6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsdDogZCwKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGQKICAgICAgICAgICAgICAgICAgICB9KSA6IGQpKSwgYltmID8gImJlZm9yZSIgOiAiYWZ0ZXIiXShjLnRyaWdnZXIpLCBjLnRyaWdnZXIuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgYS5kYXRlcGlja2VyLl9sYXN0SW5wdXQgPT09IGJbMF0gPyBhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCkgOiAoYS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiBhLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCAhPT0gYlswXSAmJiBhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKGJbMF0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXV0b1NpemU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZ2V0KGEsICJhdXRvU2l6ZSIpICYmICFhLmlubGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZywgZiwgbSA9IG5ldyBEYXRlKDIwMDksIDExLCAyMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5fZ2V0KGEsICJkYXRlRm9ybWF0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGgubWF0Y2goL1tETV0vKSAmJiAoYyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IGcgPSBkID0gMDsgZiA8IGEubGVuZ3RoOyBmKyspIGFbZl0ubGVuZ3RoID4gZCAmJiAoZCA9IGFbZl0ubGVuZ3RoLCBnID0gZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZwogICAgICAgICAgICAgICAgICAgICAgICB9LCBtLnNldE1vbnRoKGModGhpcy5fZ2V0KGEsIGgubWF0Y2goL01NLykgPyAibW9udGhOYW1lcyIgOiAibW9udGhOYW1lc1Nob3J0IikpKSwgbS5zZXREYXRlKGModGhpcy5fZ2V0KGEsIGgubWF0Y2goL0RELykgPyAiZGF5TmFtZXMiIDogImRheU5hbWVzU2hvcnQiKSkgKyAyMCAtIG0uZ2V0RGF5KCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5pbnB1dC5hdHRyKCJzaXplIiwgdGhpcy5fZm9ybWF0RGF0ZShhLCBtKS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pbmxpbmVEYXRlcGlja2VyOiBmdW5jdGlvbihiLAogICAgICAgICAgICAgICAgICAgIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEoYik7CiAgICAgICAgICAgICAgICAgICAgZC5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkgfHwgKGQuYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmFwcGVuZChjLmRwRGl2KSwgYS5kYXRhKGIsICJkYXRlcGlja2VyIiwgYyksIHRoaXMuX3NldERhdGUoYywgdGhpcy5fZ2V0RGVmYXVsdERhdGUoYyksICEwKSwgdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihjKSwgdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGMpLCBjLnNldHRpbmdzLmRpc2FibGVkICYmIHRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKGIpLCBjLmRwRGl2LmNzcygiZGlzcGxheSIsICJibG9jayIpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kaWFsb2dEYXRlcGlja2VyOiBmdW5jdGlvbihiLCBjLCBkLCBnLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG07CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuX2RpYWxvZ0luc3Q7CiAgICAgICAgICAgICAgICAgICAgYiB8fCAodGhpcy51dWlkICs9IDEsIGIgPSAiZHAiICsgdGhpcy51dWlkLCB0aGlzLl9kaWFsb2dJbnB1dCA9IGEoIjxpbnB1dCB0eXBlPSd0ZXh0JyBpZD0nIiArIGIgKyAiJyBzdHlsZT0ncG9zaXRpb246IGFic29sdXRlOyB0b3A6IC0xMDBweDsgd2lkdGg6IDBweDsnLz4iKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlhbG9nSW5wdXQua2V5ZG93bih0aGlzLl9kb0tleURvd24pLCBhKCJib2R5IikuYXBwZW5kKHRoaXMuX2RpYWxvZ0lucHV0KSwgYiA9IHRoaXMuX2RpYWxvZ0luc3QgPSB0aGlzLl9uZXdJbnN0KHRoaXMuX2RpYWxvZ0lucHV0LCAhMSksIGIuc2V0dGluZ3MgPSB7fSwgYS5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCAiZGF0ZXBpY2tlciIsIGIpKTsKICAgICAgICAgICAgICAgICAgICBJKGIuc2V0dGluZ3MsIGcgfHwge30pOwogICAgICAgICAgICAgICAgICAgIGMgPSBjICYmIGMuY29uc3RydWN0b3IgPT09IERhdGUgPyB0aGlzLl9mb3JtYXREYXRlKGIsIGMpIDogYzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaWFsb2dJbnB1dC52YWwoYyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9zID0gZiA/IGYubGVuZ3RoID8gZiA6IFtmLnBhZ2VYLCBmLnBhZ2VZXSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9zIHx8IChjID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCBnID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCwgZiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCwgbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AsIHRoaXMuX3BvcyA9IFtjIC8gMiAtIDEwMCArIGYsIGcgLyAyIC0gMTUwICsgbV0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RpYWxvZ0lucHV0LmNzcygibGVmdCIsIHRoaXMuX3Bvc1swXSArIDIwICsgInB4IikuY3NzKCJ0b3AiLCB0aGlzLl9wb3NbMV0gKyAicHgiKTsKICAgICAgICAgICAgICAgICAgICBiLnNldHRpbmdzLm9uU2VsZWN0ID0gZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbkRpYWxvZyA9ICEwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHBEaXYuYWRkQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dEYXRlcGlja2VyKHRoaXMuX2RpYWxvZ0lucHV0WzBdKTsKICAgICAgICAgICAgICAgICAgICBhLmJsb2NrVUkgJiYgYS5ibG9ja1VJKHRoaXMuZHBEaXYpOwogICAgICAgICAgICAgICAgICAgIGEuZGF0YSh0aGlzLl9kaWFsb2dJbnB1dFswXSwgImRhdGVwaWNrZXIiLCBiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95RGF0ZXBpY2tlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkID0gYShiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEuZGF0YShiLCAiZGF0ZXBpY2tlciIpOwogICAgICAgICAgICAgICAgICAgIGQuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpICYmIChjID0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBhLnJlbW92ZURhdGEoYiwgImRhdGVwaWNrZXIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0IiA9PT0gYyA/IChnLmFwcGVuZC5yZW1vdmUoKSwgZy50cmlnZ2VyLnJlbW92ZSgpLCBkLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS51bmJpbmQoImZvY3VzIiwgdGhpcy5fc2hvd0RhdGVwaWNrZXIpLnVuYmluZCgia2V5ZG93biIsIHRoaXMuX2RvS2V5RG93bikudW5iaW5kKCJrZXlwcmVzcyIsIHRoaXMuX2RvS2V5UHJlc3MpLnVuYmluZCgia2V5dXAiLCB0aGlzLl9kb0tleVVwKSkgOiAiZGl2IiAhPT0gYyAmJiAic3BhbiIgIT09IGMgfHwgZC5yZW1vdmVDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuZW1wdHkoKSwgVyA9PT0gZyAmJiAoVyA9IG51bGwpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9lbmFibGVEYXRlcGlja2VyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBhKGIpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5kYXRhKGIsICJkYXRlcGlja2VyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiaW5wdXQiID09PSBjKSBiLmRpc2FibGVkID0gITEsIGcudHJpZ2dlci5maWx0ZXIoImJ1dHRvbiIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfSkuZW5kKCkuZmlsdGVyKCJpbWciKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgiZGl2IiA9PT0gYyB8fCAic3BhbiIgPT09IGMpIGMgPSBkLmNoaWxkcmVuKCIuIiArIHRoaXMuX2lubGluZUNsYXNzKSwgYy5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpLCBjLmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIikucHJvcCgiZGlzYWJsZWQiLCAhMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkSW5wdXRzID0gYS5tYXAodGhpcy5fZGlzYWJsZWRJbnB1dHMsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBiID8gbnVsbCA6IGEKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rpc2FibGVEYXRlcGlja2VyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBhKGIpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5kYXRhKGIsICJkYXRlcGlja2VyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiaW5wdXQiID09PSBjKSBiLmRpc2FibGVkID0gITAsIGcudHJpZ2dlci5maWx0ZXIoImJ1dHRvbiIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gITAKICAgICAgICAgICAgICAgICAgICAgICAgfSkuZW5kKCkuZmlsdGVyKCJpbWciKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogIjAuNSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6ICJkZWZhdWx0IgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoImRpdiIgPT09IGMgfHwgInNwYW4iID09PSBjKSBjID0gZC5jaGlsZHJlbigiLiIgKyB0aGlzLl9pbmxpbmVDbGFzcyksIGMuY2hpbGRyZW4oKS5hZGRDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSwgYy5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhciIpLnByb3AoImRpc2FibGVkIiwgITApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlZElucHV0cyA9IGEubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IG51bGwgOiBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlZElucHV0c1t0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGhdID0gYgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaXNEaXNhYmxlZERhdGVwaWNrZXI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHRoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aDsgYysrKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGlzYWJsZWRJbnB1dHNbY10gPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKSByZXR1cm4gITA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldEluc3Q6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5kYXRhKGIsICJkYXRlcGlja2VyIikKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICJNaXNzaW5nIGluc3RhbmNlIGRhdGEgZm9yIHRoaXMgZGF0ZXBpY2tlciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9vcHRpb25EYXRlcGlja2VyOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcsIGYsIG0sIGgsIGsgPSB0aGlzLl9nZXRJbnN0KGIpOwogICAgICAgICAgICAgICAgICAgIGlmICgyID09PSBhcmd1bWVudHMubGVuZ3RoICYmICJzdHJpbmciID09PSB0eXBlb2YgYykgcmV0dXJuICJkZWZhdWx0cyIgPT09IGMgPyBhLmV4dGVuZCh7fSwgYS5kYXRlcGlja2VyLl9kZWZhdWx0cykgOiBrID8gImFsbCIgPT09IGMgPyBhLmV4dGVuZCh7fSwgay5zZXR0aW5ncykgOiB0aGlzLl9nZXQoaywgYykgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIGcgPSBjIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYyAmJiAoZyA9IHt9LCBnW2NdID0gZCk7CiAgICAgICAgICAgICAgICAgICAgayAmJiAodGhpcy5fY3VySW5zdCA9PT0gayAmJiB0aGlzLl9oaWRlRGF0ZXBpY2tlcigpLCBmID0gdGhpcy5fZ2V0RGF0ZURhdGVwaWNrZXIoYiwgITApLCBtID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShrLAogICAgICAgICAgICAgICAgICAgICAgICAibWluIiksIGggPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGssICJtYXgiKSwgSShrLnNldHRpbmdzLCBnKSwgbnVsbCAhPT0gbSAmJiB2b2lkIDAgIT09IGcuZGF0ZUZvcm1hdCAmJiB2b2lkIDAgPT09IGcubWluRGF0ZSAmJiAoay5zZXR0aW5ncy5taW5EYXRlID0gdGhpcy5fZm9ybWF0RGF0ZShrLCBtKSksIG51bGwgIT09IGggJiYgdm9pZCAwICE9PSBnLmRhdGVGb3JtYXQgJiYgdm9pZCAwID09PSBnLm1heERhdGUgJiYgKGsuc2V0dGluZ3MubWF4RGF0ZSA9IHRoaXMuX2Zvcm1hdERhdGUoaywgaCkpLCAiZGlzYWJsZWQiIGluIGcgJiYgKGcuZGlzYWJsZWQgPyB0aGlzLl9kaXNhYmxlRGF0ZXBpY2tlcihiKSA6IHRoaXMuX2VuYWJsZURhdGVwaWNrZXIoYikpLCB0aGlzLl9hdHRhY2htZW50cyhhKGIpLCBrKSwgdGhpcy5fYXV0b1NpemUoayksIHRoaXMuX3NldERhdGUoaywgZiksIHRoaXMuX3VwZGF0ZUFsdGVybmF0ZShrKSwgdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihrKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2hhbmdlRGF0ZXBpY2tlcjogZnVuY3Rpb24oYSwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbkRhdGVwaWNrZXIoYSwKICAgICAgICAgICAgICAgICAgICAgICAgYywgZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVmcmVzaERhdGVwaWNrZXI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAoYSA9IHRoaXMuX2dldEluc3QoYSkpICYmIHRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0RGF0ZURhdGVwaWNrZXI6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2dldEluc3QoYSk7CiAgICAgICAgICAgICAgICAgICAgZCAmJiAodGhpcy5fc2V0RGF0ZShkLCBjKSwgdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihkKSwgdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGQpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXREYXRlRGF0ZXBpY2tlcjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fZ2V0SW5zdChhKTsKICAgICAgICAgICAgICAgICAgICBkICYmICFkLmlubGluZSAmJiB0aGlzLl9zZXREYXRlRnJvbUZpZWxkKGQsIGMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gdGhpcy5fZ2V0RGF0ZShkKSA6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZG9LZXlEb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBhLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGMgPSAhMDsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGQuZHBEaXYuaXMoIi51aS1kYXRlcGlja2VyLXJ0bCIpOwogICAgICAgICAgICAgICAgICAgIGQuX2tleUV2ZW50ID0gITA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcpIHN3aXRjaCAoYi5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPSBhKCJ0ZC4iICsgYS5kYXRlcGlja2VyLl9kYXlPdmVyQ2xhc3MgKyAiOm5vdCguIiArIGEuZGF0ZXBpY2tlci5fY3VycmVudENsYXNzICsgIikiLCBkLmRwRGl2KSwgY1swXSAmJiBhLmRhdGVwaWNrZXIuX3NlbGVjdERheShiLnRhcmdldCwgZC5zZWxlY3RlZE1vbnRoLCBkLnNlbGVjdGVkWWVhciwgY1swXSksIChiID0gYS5kYXRlcGlja2VyLl9nZXQoZCwgIm9uU2VsZWN0IikpID8gKGMgPSBhLmRhdGVwaWNrZXIuX2Zvcm1hdERhdGUoZCksIGIuYXBwbHkoZC5pbnB1dCA/IGQuaW5wdXRbMF0gOiBudWxsLCBbYywgZF0pKSA6IGEuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKSwgITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCwgYi5jdHJsS2V5ID8gLWEuZGF0ZXBpY2tlci5fZ2V0KGQsICJzdGVwQmlnTW9udGhzIikgOiAtYS5kYXRlcGlja2VyLl9nZXQoZCwgInN0ZXBNb250aHMiKSwgIk0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGIudGFyZ2V0LCBiLmN0cmxLZXkgPyArYS5kYXRlcGlja2VyLl9nZXQoZCwgInN0ZXBCaWdNb250aHMiKSA6ICthLmRhdGVwaWNrZXIuX2dldChkLCAic3RlcE1vbnRocyIpLCAiTSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYi5jdHJsS2V5IHx8IGIubWV0YUtleSkgJiYgYS5kYXRlcGlja2VyLl9jbGVhckRhdGUoYi50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIuY3RybEtleSB8fCBiLm1ldGFLZXk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChiLmN0cmxLZXkgfHwgYi5tZXRhS2V5KSAmJiBhLmRhdGVwaWNrZXIuX2dvdG9Ub2RheShiLnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYi5jdHJsS2V5IHx8IGIubWV0YUtleTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGIuY3RybEtleSB8fCBiLm1ldGFLZXkpICYmIGEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCwgZyA/IDEgOiAtMSwgIkQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLmN0cmxLZXkgfHwgYi5tZXRhS2V5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vcmlnaW5hbEV2ZW50LmFsdEtleSAmJiBhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsIGIuY3RybEtleSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLWEuZGF0ZXBpY2tlci5fZ2V0KGQsICJzdGVwQmlnTW9udGhzIikgOiAtYS5kYXRlcGlja2VyLl9nZXQoZCwgInN0ZXBNb250aHMiKSwgIk0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGIuY3RybEtleSB8fCBiLm1ldGFLZXkpICYmIGEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCwgLTcsICJEIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYi5jdHJsS2V5IHx8IGIubWV0YUtleTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGIuY3RybEtleSB8fCBiLm1ldGFLZXkpICYmIGEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCwgZyA/IC0xIDogMSwgIkQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLmN0cmxLZXkgfHwgYi5tZXRhS2V5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vcmlnaW5hbEV2ZW50LmFsdEtleSAmJiBhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsIGIuY3RybEtleSA/ICthLmRhdGVwaWNrZXIuX2dldChkLCAic3RlcEJpZ01vbnRocyIpIDogK2EuZGF0ZXBpY2tlci5fZ2V0KGQsICJzdGVwTW9udGhzIiksICJNIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChiLmN0cmxLZXkgfHwgYi5tZXRhS2V5KSAmJiBhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNywgIkQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLmN0cmxLZXkgfHwgYi5tZXRhS2V5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gITEKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgMzYgPT09IGIua2V5Q29kZSAmJiBiLmN0cmxLZXkgPyBhLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRoaXMpIDogYyA9ICExOwogICAgICAgICAgICAgICAgICAgIGMgJiYgKGIucHJldmVudERlZmF1bHQoKSwgYi5zdG9wUHJvcGFnYXRpb24oKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZG9LZXlQcmVzczogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkOwogICAgICAgICAgICAgICAgICAgIGMgPSBhLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGlmIChhLmRhdGVwaWNrZXIuX2dldChjLCAiY29uc3RyYWluSW5wdXQiKSkgcmV0dXJuIGMgPSBhLmRhdGVwaWNrZXIuX3Bvc3NpYmxlQ2hhcnMoYS5kYXRlcGlja2VyLl9nZXQoYywgImRhdGVGb3JtYXQiKSksIGQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG51bGwgPT0gYi5jaGFyQ29kZSA/IGIua2V5Q29kZSA6IGIuY2hhckNvZGUpLCBiLmN0cmxLZXkgfHwgYi5tZXRhS2V5IHx8ICIgIiA+IGQgfHwgIWMgfHwgLTEgPCBjLmluZGV4T2YoZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZG9LZXlVcDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgIGIgPSBhLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGlmIChiLmlucHV0LnZhbCgpICE9PSBiLmxhc3RWYWwpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gYS5kYXRlcGlja2VyLnBhcnNlRGF0ZShhLmRhdGVwaWNrZXIuX2dldChiLCAiZGF0ZUZvcm1hdCIpLCBiLmlucHV0ID8gYi5pbnB1dC52YWwoKSA6IG51bGwsIGEuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGIpKSkgYS5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGIpLCBhLmRhdGVwaWNrZXIuX3VwZGF0ZUFsdGVybmF0ZShiKSwgYS5kYXRlcGlja2VyLl91cGRhdGVEYXRlcGlja2VyKGIpCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZCkge30KICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2hvd0RhdGVwaWNrZXI6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gYi50YXJnZXQgfHwgYjsKICAgICAgICAgICAgICAgICAgICAiaW5wdXQiICE9PSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgJiYgKGIgPSBhKCJpbnB1dCIsIGIucGFyZW50Tm9kZSlbMF0pOwogICAgICAgICAgICAgICAgICAgIGlmICghYS5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihiKSAmJiBhLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCAhPT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZywgZjsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEuZGF0ZXBpY2tlci5fZ2V0SW5zdChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9jdXJJbnN0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX2N1ckluc3QgIT09IGMgJiYgKGEuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKCEwLCAhMCksIGMgJiYgYS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiBhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKGEuZGF0ZXBpY2tlci5fY3VySW5zdC5pbnB1dFswXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBkID0gKGQgPSBhLmRhdGVwaWNrZXIuX2dldChjLCAiYmVmb3JlU2hvdyIpKSA/IGQuYXBwbHkoYiwgW2IsIGNdKSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoITEgIT09IGQgJiYgKEkoYy5zZXR0aW5ncywgZCksIGMubGFzdFZhbCA9IG51bGwsIGEuZGF0ZXBpY2tlci5fbGFzdElucHV0ID0gYiwgYS5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGMpLCBhLmRhdGVwaWNrZXIuX2luRGlhbG9nICYmIChiLnZhbHVlID0gIiIpLCBhLmRhdGVwaWNrZXIuX3BvcyB8fCAoYS5kYXRlcGlja2VyLl9wb3MgPSBhLmRhdGVwaWNrZXIuX2ZpbmRQb3MoYiksIGEuZGF0ZXBpY2tlci5fcG9zWzFdICs9IGIub2Zmc2V0SGVpZ2h0KSwgZyA9ICExLCBhKGIpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgfD0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZpeGVkIiA9PT0gYSh0aGlzKS5jc3MoInBvc2l0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBhLmRhdGVwaWNrZXIuX3Bvc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGEuZGF0ZXBpY2tlci5fcG9zWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmRhdGVwaWNrZXIuX3BvcyA9IG51bGwsIGMuZHBEaXYuZW1wdHkoKSwgYy5kcERpdi5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAiLTEwMDBweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoYyksIGQgPSBhLmRhdGVwaWNrZXIuX2NoZWNrT2Zmc2V0KGMsIGQsIGcpLCBjLmRwRGl2LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGEuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgYS5ibG9ja1VJID8gInN0YXRpYyIgOiBnID8gImZpeGVkIiA6ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGQubGVmdCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBkLnRvcCArICJweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhYy5pbmxpbmUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS5kYXRlcGlja2VyLl9nZXQoYywgInNob3dBbmltIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYS5kYXRlcGlja2VyLl9nZXQoYywgImR1cmF0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmRwRGl2LmNzcygiei1pbmRleCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRChhKGIpKSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZWZmZWN0cyAmJiBhLmVmZmVjdHMuZWZmZWN0W2RdKSBjLmRwRGl2LnNob3coZCwgYS5kYXRlcGlja2VyLl9nZXQoYywgInNob3dPcHRpb25zIiksIGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBjLmRwRGl2W2QgfHwgInNob3ciXShkID8gZiA6IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9zaG91bGRGb2N1c0lucHV0KGMpICYmIGMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5fY3VySW5zdCA9IGMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdXBkYXRlRGF0ZXBpY2tlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHRoaXMubWF4Um93cyA9IDQ7CiAgICAgICAgICAgICAgICAgICAgVyA9IGI7CiAgICAgICAgICAgICAgICAgICAgYi5kcERpdi5lbXB0eSgpLmFwcGVuZCh0aGlzLl9nZW5lcmF0ZUhUTUwoYikpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2F0dGFjaEhhbmRsZXJzKGIpOwogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkID0gdGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYiksCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkWzFdLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYi5kcERpdi5maW5kKCIuIiArIHRoaXMuX2RheU92ZXJDbGFzcyArICIgYSIpOwogICAgICAgICAgICAgICAgICAgIDAgPCBmLmxlbmd0aCAmJiBNLmFwcGx5KGYuZ2V0KDApKTsKICAgICAgICAgICAgICAgICAgICBiLmRwRGl2LnJlbW92ZUNsYXNzKCJ1aS1kYXRlcGlja2VyLW11bHRpLTIgdWktZGF0ZXBpY2tlci1tdWx0aS0zIHVpLWRhdGVwaWNrZXItbXVsdGktNCIpLndpZHRoKCIiKTsKICAgICAgICAgICAgICAgICAgICAxIDwgZyAmJiBiLmRwRGl2LmFkZENsYXNzKCJ1aS1kYXRlcGlja2VyLW11bHRpLSIgKyBnKS5jc3MoIndpZHRoIiwgMTcgKiBnICsgImVtIik7CiAgICAgICAgICAgICAgICAgICAgYi5kcERpdlsoMSAhPT0gZFswXSB8fCAxICE9PSBkWzFdID8gImFkZCIgOiAicmVtb3ZlIikgKyAiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1tdWx0aSIpOwogICAgICAgICAgICAgICAgICAgIGIuZHBEaXZbKHRoaXMuX2dldChiLCAiaXNSVEwiKSA/ICJhZGQiIDogInJlbW92ZSIpICsgIkNsYXNzIl0oInVpLWRhdGVwaWNrZXItcnRsIik7CiAgICAgICAgICAgICAgICAgICAgYiA9PT0gYS5kYXRlcGlja2VyLl9jdXJJbnN0ICYmIGEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgYS5kYXRlcGlja2VyLl9zaG91bGRGb2N1c0lucHV0KGIpICYmIGIuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICBiLnllYXJzaHRtbCAmJiAoYyA9IGIueWVhcnNodG1sLCBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjID09PSBiLnllYXJzaHRtbCAmJiBiLnllYXJzaHRtbCAmJiBiLmRwRGl2LmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLXllYXI6Zmlyc3QiKS5yZXBsYWNlV2l0aChiLnllYXJzaHRtbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLnllYXJzaHRtbCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgICAgICAgICAgfSwgMCkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3Nob3VsZEZvY3VzSW5wdXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5pbnB1dCAmJiBhLmlucHV0LmlzKCI6dmlzaWJsZSIpICYmICFhLmlucHV0LmlzKCI6ZGlzYWJsZWQiKSAmJiAhYS5pbnB1dC5pcygiOmZvY3VzIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2hlY2tPZmZzZXQ6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGIuZHBEaXYub3V0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYi5kcERpdi5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gYi5pbnB1dCA/IGIuaW5wdXQub3V0ZXJXaWR0aCgpIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGIuaW5wdXQgPyBiLmlucHV0Lm91dGVySGVpZ2h0KCkgOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBrID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoICsgKGQgPyAwIDogYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgKyAoZCA/IDAgOiBhKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk7CiAgICAgICAgICAgICAgICAgICAgYy5sZWZ0IC09IHRoaXMuX2dldChiLCAiaXNSVEwiKSA/IGcgLSBtIDogMDsKICAgICAgICAgICAgICAgICAgICBjLmxlZnQgLT0gZCAmJiBjLmxlZnQgPT09IGIuaW5wdXQub2Zmc2V0KCkubGVmdCA/IGEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICAgICAgYy50b3AgLT0gZCAmJiBjLnRvcCA9PT0gYi5pbnB1dC5vZmZzZXQoKS50b3AgKyBoID8gYShkb2N1bWVudCkuc2Nyb2xsVG9wKCkgOiAwOwogICAgICAgICAgICAgICAgICAgIGMubGVmdCAtPSBNYXRoLm1pbihjLmxlZnQsIGMubGVmdCArIGcgPiBrICYmIGsgPiBnID8gTWF0aC5hYnMoYy5sZWZ0ICsgZyAtIGspIDogMCk7CiAgICAgICAgICAgICAgICAgICAgYy50b3AgLT0gTWF0aC5taW4oYy50b3AsIGMudG9wICsgZiA+IGwgJiYgbCA+IGYgPyBNYXRoLmFicyhmICsgaCkgOiAwKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9maW5kUG9zOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IHRoaXMuX2dldEluc3QoYiksIGMgPSB0aGlzLl9nZXQoYywgImlzUlRMIik7IGIgJiYgKCJoaWRkZW4iID09PSBiLnR5cGUgfHwgMSAhPT0gYi5ub2RlVHlwZSB8fCBhLmV4cHIuZmlsdGVycy5oaWRkZW4oYikpOykgYiA9IGJbYyA/ICJwcmV2aW91c1NpYmxpbmciIDogIm5leHRTaWJsaW5nIl07CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoYikub2Zmc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtiLmxlZnQsIGIudG9wXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9oaWRlRGF0ZXBpY2tlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnID0gdGhpcy5fY3VySW5zdDsKICAgICAgICAgICAgICAgICAgICBpZiAoZyAmJiAoIWIgfHwgZyA9PT0gYS5kYXRhKGIsICJkYXRlcGlja2VyIikpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9nZXQoZywgInNob3dBbmltIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9nZXQoZywgImR1cmF0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5fdGlkeURpYWxvZyhnKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5lZmZlY3RzICYmIChhLmVmZmVjdHMuZWZmZWN0W2JdIHx8IGEuZWZmZWN0c1tiXSkpIGcuZHBEaXYuaGlkZShiLCBhLmRhdGVwaWNrZXIuX2dldChnLCAic2hvd09wdGlvbnMiKSwgYywgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgZy5kcERpdlsic2xpZGVEb3duIiA9PT0gYiA/ICJzbGlkZVVwIiA6ICJmYWRlSW4iID09PSBiID8gImZhZGVPdXQiIDogImhpZGUiXShiID8gYyA6IG51bGwsIGQpOwogICAgICAgICAgICAgICAgICAgICAgICBiIHx8IGQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGF0ZXBpY2tlclNob3dpbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgKGIgPSB0aGlzLl9nZXQoZywgIm9uQ2xvc2UiKSkgJiYgYi5hcHBseShnLmlucHV0ID8gZy5pbnB1dFswXSA6IG51bGwsIFtnLmlucHV0ID8gZy5pbnB1dC52YWwoKSA6ICIiLCBnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RJbnB1dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luRGlhbG9nICYmICh0aGlzLl9kaWFsb2dJbnB1dC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICItMTAwcHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhLmJsb2NrVUkgJiYgKGEudW5ibG9ja1VJKCksIGEoImJvZHkiKS5hcHBlbmQodGhpcy5kcERpdikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5EaWFsb2cgPSAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdGlkeURpYWxvZzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEuZHBEaXYucmVtb3ZlQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpLnVuYmluZCgiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jaGVja0V4dGVybmFsQ2xpY2s6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5kYXRlcGlja2VyLl9jdXJJbnN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBhKGIudGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmRhdGVwaWNrZXIuX2dldEluc3QoYlswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICghKGJbMF0uaWQgPT09IGEuZGF0ZXBpY2tlci5fbWFpbkRpdklkIHx8IDAgIT09IGIucGFyZW50cygiIyIgKyBhLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoIHx8IGIuaGFzQ2xhc3MoYS5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkgfHwgYi5jbG9zZXN0KCIuIiArIGEuZGF0ZXBpY2tlci5fdHJpZ2dlckNsYXNzKS5sZW5ndGggfHwgIWEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgYS5ibG9ja1VJKSB8fCBiLmhhc0NsYXNzKGEuZGF0ZXBpY2tlci5tYXJrZXJDbGFzc05hbWUpICYmIGEuZGF0ZXBpY2tlci5fY3VySW5zdCAhPT0gYykgJiYgYS5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9hZGp1c3REYXRlOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoYik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSB0aGlzLl9nZXRJbnN0KGJbMF0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKGJbMF0pIHx8ICh0aGlzLl9hZGp1c3RJbnN0RGF0ZShnLCBjICsgKCJNIiA9PT0gZCA/IHRoaXMuX2dldChnLCAic2hvd0N1cnJlbnRBdFBvcyIpIDogMCksIGQpLCB0aGlzLl91cGRhdGVEYXRlcGlja2VyKGcpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nb3RvVG9kYXk6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEoYiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9nZXRJbnN0KGNbMF0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldChkLCAiZ290b0N1cnJlbnQiKSAmJiBkLmN1cnJlbnREYXkgPyAoZC5zZWxlY3RlZERheSA9IGQuY3VycmVudERheSwgZC5kcmF3TW9udGggPSBkLnNlbGVjdGVkTW9udGggPSBkLmN1cnJlbnRNb250aCwKICAgICAgICAgICAgICAgICAgICAgICAgZC5kcmF3WWVhciA9IGQuc2VsZWN0ZWRZZWFyID0gZC5jdXJyZW50WWVhcikgOiAoYiA9IG5ldyBEYXRlLCBkLnNlbGVjdGVkRGF5ID0gYi5nZXREYXRlKCksIGQuZHJhd01vbnRoID0gZC5zZWxlY3RlZE1vbnRoID0gYi5nZXRNb250aCgpLCBkLmRyYXdZZWFyID0gZC5zZWxlY3RlZFllYXIgPSBiLmdldEZ1bGxZZWFyKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeUNoYW5nZShkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGp1c3REYXRlKGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NlbGVjdE1vbnRoWWVhcjogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIGIgPSBhKGIpOwogICAgICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcy5fZ2V0SW5zdChiWzBdKTsKICAgICAgICAgICAgICAgICAgICBnWyJzZWxlY3RlZCIgKyAoIk0iID09PSBkID8gIk1vbnRoIiA6ICJZZWFyIildID0gZ1siZHJhdyIgKyAoIk0iID09PSBkID8gIk1vbnRoIiA6ICJZZWFyIildID0gcGFyc2VJbnQoYy5vcHRpb25zW2Muc2VsZWN0ZWRJbmRleF0udmFsdWUsIDEwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ub3RpZnlDaGFuZ2UoZyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRqdXN0RGF0ZShiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZWxlY3REYXk6IGZ1bmN0aW9uKGIsIGMsIGQsIGcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZjsKICAgICAgICAgICAgICAgICAgICBmID0gYShiKTsKICAgICAgICAgICAgICAgICAgICBhKGcpLmhhc0NsYXNzKHRoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzKSB8fAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihmWzBdKSB8fCAoZiA9IHRoaXMuX2dldEluc3QoZlswXSksIGYuc2VsZWN0ZWREYXkgPSBmLmN1cnJlbnREYXkgPSBhKCJhIiwgZykuaHRtbCgpLCBmLnNlbGVjdGVkTW9udGggPSBmLmN1cnJlbnRNb250aCA9IGMsIGYuc2VsZWN0ZWRZZWFyID0gZi5jdXJyZW50WWVhciA9IGQsIHRoaXMuX3NlbGVjdERhdGUoYiwgdGhpcy5fZm9ybWF0RGF0ZShmLCBmLmN1cnJlbnREYXksIGYuY3VycmVudE1vbnRoLCBmLmN1cnJlbnRZZWFyKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NsZWFyRGF0ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGIgPSBhKGIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdERhdGUoYiwgIiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NlbGVjdERhdGU6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgICAgICBkID0gYShiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHRoaXMuX2dldEluc3QoZFswXSk7CiAgICAgICAgICAgICAgICAgICAgYyA9IG51bGwgIT0gYyA/IGMgOiB0aGlzLl9mb3JtYXREYXRlKGcpOwogICAgICAgICAgICAgICAgICAgIGcuaW5wdXQgJiYgZy5pbnB1dC52YWwoYyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGcpOwogICAgICAgICAgICAgICAgICAgIChkID0gdGhpcy5fZ2V0KGcsICJvblNlbGVjdCIpKSA/IGQuYXBwbHkoZy5pbnB1dCA/IGcuaW5wdXRbMF0gOgogICAgICAgICAgICAgICAgICAgICAgICBudWxsLCBbYywgZ10pOiBnLmlucHV0ICYmIGcuaW5wdXQudHJpZ2dlcigiY2hhbmdlIik7CiAgICAgICAgICAgICAgICAgICAgZy5pbmxpbmUgPyB0aGlzLl91cGRhdGVEYXRlcGlja2VyKGcpIDogKHRoaXMuX2hpZGVEYXRlcGlja2VyKCksIHRoaXMuX2xhc3RJbnB1dCA9IGcuaW5wdXRbMF0sICJvYmplY3QiICE9PSB0eXBlb2YgZy5pbnB1dFswXSAmJiBnLmlucHV0LmZvY3VzKCksIHRoaXMuX2xhc3RJbnB1dCA9IG51bGwpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3VwZGF0ZUFsdGVybmF0ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBmID0gdGhpcy5fZ2V0KGIsICJhbHRGaWVsZCIpOwogICAgICAgICAgICAgICAgICAgIGYgJiYgKGMgPSB0aGlzLl9nZXQoYiwgImFsdEZvcm1hdCIpIHx8IHRoaXMuX2dldChiLCAiZGF0ZUZvcm1hdCIpLCBkID0gdGhpcy5fZ2V0RGF0ZShiKSwgZyA9IHRoaXMuZm9ybWF0RGF0ZShjLCBkLCB0aGlzLl9nZXRGb3JtYXRDb25maWcoYikpLCBhKGYpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykudmFsKGcpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbm9XZWVrZW5kczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSBhLmdldERheSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMCA8IGEgJiYgNiA+IGEsICIiXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzbzg2MDFXZWVrOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZShhLmdldFRpbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYy5zZXREYXRlKGMuZ2V0RGF0ZSgpICsgNCAtIChjLmdldERheSgpIHx8IDcpKTsKICAgICAgICAgICAgICAgICAgICBhID0gYy5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgYy5zZXRNb250aCgwKTsKICAgICAgICAgICAgICAgICAgICBjLnNldERhdGUoMSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yb3VuZCgoYSAtIGMpIC8gODY0RTUpIC8gNykgKyAxCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyc2VEYXRlOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gYiB8fCBudWxsID09IGMpIHRocm93ICJJbnZhbGlkIGFyZ3VtZW50cyI7CiAgICAgICAgICAgICAgICAgICAgYyA9ICJvYmplY3QiID09PSB0eXBlb2YgYyA/IGMudG9TdHJpbmcoKSA6IGMgKyAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoIiIgPT09IGMpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIHZhciBnLCBmLCBtLCBoID0gMDsKICAgICAgICAgICAgICAgICAgICBmID0gKGQgPyBkLnNob3J0WWVhckN1dG9mZiA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZjsKICAgICAgICAgICAgICAgICAgICBmID0gInN0cmluZyIgIT09IHR5cGVvZiBmID8gZiA6IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAlIDEwMCArIHBhcnNlSW50KGYsIDEwKTsKICAgICAgICAgICAgICAgICAgICBtID0gKGQgPyBkLmRheU5hbWVzU2hvcnQgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0OwogICAgICAgICAgICAgICAgICAgIHZhciBrID0gKGQgPyBkLmRheU5hbWVzIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gKGQgPyBkLm1vbnRoTmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IChkID8gZC5tb250aE5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcywKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGQgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IC0xLAogICAgICAgICAgICAgICAgICAgICAgICByID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgdSwgeiA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhID0gZyArIDEgPCBiLmxlbmd0aCAmJiBiLmNoYXJBdChnICsgMSkgPT09IGEpICYmIGcrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHooYSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9ICJAIiA9PT0gYSA/IDE0IDogIiEiID09PSBhID8gMjAgOiAieSIgPT09IGEgJiYgYiA/IDQgOiAibyIgPT09IGEgPyAzIDogMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBuZXcgUmVnRXhwKCJeXFxkeyIgKyAoInkiID09PSBhID8gYiA6IDEpICsgIiwiICsgYiArICJ9Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gYy5zdWJzdHJpbmcoaCkubWF0Y2goYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEpIHRocm93ICJNaXNzaW5nIG51bWJlciBhdCBwb3NpdGlvbiAiICsgaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggKz0gYVswXS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoYVswXSwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBmdW5jdGlvbihiLCBkLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGEubWFwKHooYikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgOiBkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtiLCBhXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0oYVsxXS5sZW5ndGggLSBiWzFdLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGIsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGJbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuc3Vic3RyKGgsIGQubGVuZ3RoKS50b0xvd2VyQ2FzZSgpID09PSBkLnRvTG93ZXJDYXNlKCkpIHJldHVybiBmID0gYlswXSwgaCArPSBkLmxlbmd0aCwgITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0xICE9PSBmKSByZXR1cm4gZiArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAiVW5rbm93biBuYW1lIGF0IHBvc2l0aW9uICIgKyBoOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBDID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5jaGFyQXQoaCkgIT09IGIuY2hhckF0KGcpKSB0aHJvdyAiVW5leHBlY3RlZCBsaXRlcmFsIGF0IHBvc2l0aW9uICIgKyBoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCsrCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGIubGVuZ3RoOyBnKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxKSAiJyIgIT09IGIuY2hhckF0KGcpIHx8IHooIiciKSA/IEMoKSA6IHEgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBzd2l0Y2ggKGIuY2hhckF0KGcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0geSgiZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdigiRCIsIG0sIGspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkoIm8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSB5KCJtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJNIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gdigiTSIsIGwsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAieSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHkoInkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBuZXcgRGF0ZSh5KCJAIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB1LmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHUuZ2V0TW9udGgoKSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHUuZ2V0RGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiISI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IG5ldyBEYXRlKCh5KCIhIikgLSB0aGlzLl90aWNrc1RvMTk3MCkgLyAxRTQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB1LmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHUuZ2V0TW9udGgoKSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHUuZ2V0RGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiJyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeigiJyIpID8gQygpIDogcSA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChoIDwgYy5sZW5ndGggJiYgKG0gPSBjLnN1YnN0cihoKSwgIS9eXHMrLy50ZXN0KG0pKSkgdGhyb3cgIkV4dHJhL3VucGFyc2VkIGNoYXJhY3RlcnMgZm91bmQgaW4gZGF0ZTogIiArIG07IC0gMSA9PT0gZCA/IGQgPSAobmV3IERhdGUpLmdldEZ1bGxZZWFyKCkgOiAxMDAgPiBkICYmIChkICs9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAtIChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSAlCiAgICAgICAgICAgICAgICAgICAgICAgIDEwMCArIChkIDw9IGYgPyAwIDogLTEwMCkpOwogICAgICAgICAgICAgICAgICAgIGlmICgtMSA8IHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSByOwogICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy5fZ2V0RGF5c0luTW9udGgoZCwgbiAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAgPD0gZikgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwIC09IGYKICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoMSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGQsIG4gLSAxLCBwKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHUuZ2V0RnVsbFllYXIoKSAhPT0gZCB8fCB1LmdldE1vbnRoKCkgKyAxICE9PSBuIHx8IHUuZ2V0RGF0ZSgpICE9PSBwKSB0aHJvdyAiSW52YWxpZCBkYXRlIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEFUT006ICJ5eS1tbS1kZCIsCiAgICAgICAgICAgICAgICBDT09LSUU6ICJELCBkZCBNIHl5IiwKICAgICAgICAgICAgICAgIElTT184NjAxOiAieXktbW0tZGQiLAogICAgICAgICAgICAgICAgUkZDXzgyMjogIkQsIGQgTSB5IiwKICAgICAgICAgICAgICAgIFJGQ184NTA6ICJERCwgZGQtTS15IiwKICAgICAgICAgICAgICAgIFJGQ18xMDM2OiAiRCwgZCBNIHkiLAogICAgICAgICAgICAgICAgUkZDXzExMjM6ICJELCBkIE0geXkiLAogICAgICAgICAgICAgICAgUkZDXzI4MjI6ICJELCBkIE0geXkiLAogICAgICAgICAgICAgICAgUlNTOiAiRCwgZCBNIHkiLAogICAgICAgICAgICAgICAgVElDS1M6ICIhIiwKICAgICAgICAgICAgICAgIFRJTUVTVEFNUDogIkAiLAogICAgICAgICAgICAgICAgVzNDOiAieXktbW0tZGQiLAogICAgICAgICAgICAgICAgX3RpY2tzVG8xOTcwOiA4NjRFOSAqICg3MTg2ODUgKyBNYXRoLmZsb29yKDQ5Mi41KSAtIE1hdGguZmxvb3IoMTkuNykgKwogICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoNC45MjUpKSwKICAgICAgICAgICAgICAgIGZvcm1hdERhdGU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWMpIHJldHVybiAiIjsKICAgICAgICAgICAgICAgICAgICB2YXIgZywgZiA9IChkID8gZC5kYXlOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgbSA9IChkID8gZC5kYXlOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gKGQgPyBkLm1vbnRoTmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydDsKICAgICAgICAgICAgICAgICAgICBkID0gKGQgPyBkLm1vbnRoTmFtZXMgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzOwogICAgICAgICAgICAgICAgICAgIHZhciBrID0gZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMgPSBnICsgMSA8IGEubGVuZ3RoICYmIGEuY2hhckF0KGcgKyAxKSA9PT0gYykgJiYgZysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSAiIiArIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoayhhKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYi5sZW5ndGggPCBjOykgYiA9ICIwIiArIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBlID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGsoYSkgPyBkW2JdIDogY1tiXQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBuID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSAhMTsKICAgICAgICAgICAgICAgICAgICBpZiAoYykKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGEubGVuZ3RoOyBnKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocCkgIiciICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY2hhckF0KGcpIHx8IGsoIiciKSA/IG4gKz0gYS5jaGFyQXQoZykgOiBwID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHN3aXRjaCAoYS5jaGFyQXQoZykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBsKCJkIiwgYy5nZXREYXRlKCksIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJEIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBlKCJEIiwgYy5nZXREYXkoKSwgZiwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm8iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICs9IGwoIm8iLCBNYXRoLnJvdW5kKCgobmV3IERhdGUoYy5nZXRGdWxsWWVhcigpLCBjLmdldE1vbnRoKCksIGMuZ2V0RGF0ZSgpKSkuZ2V0VGltZSgpIC0gKG5ldyBEYXRlKGMuZ2V0RnVsbFllYXIoKSwgMCwgMCkpLmdldFRpbWUoKSkgLyA4NjRFNSksIDMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBsKCJtIiwgYy5nZXRNb250aCgpICsgMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIk0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICs9IGUoIk0iLCBjLmdldE1vbnRoKCksIGgsIGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBrKCJ5IikgPyBjLmdldEZ1bGxZZWFyKCkgOiAoMTAgPiBjLmdldFllYXIoKSAlIDEwMCA/ICIwIiA6ICIiKSArIGMuZ2V0WWVhcigpICUgMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJAIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBjLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiISI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gKz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDFFNCAqIGMuZ2V0VGltZSgpICsgdGhpcy5fdGlja3NUbzE5NzA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKCInIikgPyBuICs9ICInIiA6IHAgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSBhLmNoYXJBdChnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3Bvc3NpYmxlQ2hhcnM6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZCA9IGMgKyAxIDwgYS5sZW5ndGggJiYgYS5jaGFyQXQoYyArIDEpID09PSBkKSAmJiBjKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZykgIiciICE9PSBhLmNoYXJBdChjKSB8fCBmKCInIikgPyBkICs9IGEuY2hhckF0KGMpIDogZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHN3aXRjaCAoYS5jaGFyQXQoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgKz0gIjAxMjM0NTY3ODkiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJNIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYoIiciKSA/IGQgKz0gIiciIDogZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICs9IGEuY2hhckF0KGMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXQ6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PQogICAgICAgICAgICAgICAgICAgICAgICBhLnNldHRpbmdzW2NdID8gYS5zZXR0aW5nc1tjXSA6IHRoaXMuX2RlZmF1bHRzW2NdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldERhdGVGcm9tRmllbGQ6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5pbnB1dC52YWwoKSAhPT0gYS5sYXN0VmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fZ2V0KGEsICJkYXRlRm9ybWF0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5sYXN0VmFsID0gYS5pbnB1dCA/IGEuaW5wdXQudmFsKCkgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuX2dldERlZmF1bHREYXRlKGEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpOwogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IHRoaXMucGFyc2VEYXRlKGQsIGcsIGgpIHx8IGYKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGMgPyAiIiA6IGcKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhLnNlbGVjdGVkRGF5ID0gbS5nZXREYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZHJhd01vbnRoID0gYS5zZWxlY3RlZE1vbnRoID0gbS5nZXRNb250aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmRyYXdZZWFyID0gYS5zZWxlY3RlZFllYXIgPSBtLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuY3VycmVudERheSA9IGcgPyBtLmdldERhdGUoKSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuY3VycmVudE1vbnRoID0gZyA/IG0uZ2V0TW9udGgoKSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuY3VycmVudFllYXIgPSBnID8gbS5nZXRGdWxsWWVhcigpIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRqdXN0SW5zdERhdGUoYSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldERlZmF1bHREYXRlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsIHRoaXMuX2RldGVybWluZURhdGUoYSwgdGhpcy5fZ2V0KGEsICJkZWZhdWx0RGF0ZSIpLCBuZXcgRGF0ZSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RldGVybWluZURhdGU6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IERhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLnNldERhdGUoYi5nZXREYXRlKCkgKyBhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmRhdGVwaWNrZXIucGFyc2VEYXRlKGEuZGF0ZXBpY2tlci5fZ2V0KGIsICJkYXRlRm9ybWF0IiksIGMsIGEuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZCkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSAoYy50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eYy8pID8gYS5kYXRlcGlja2VyLl9nZXREYXRlKGIpIDogbnVsbCkgfHwgbmV3IERhdGUsIGcgPSBmLmdldEZ1bGxZZWFyKCksIGwgPSBmLmdldE1vbnRoKCksIGYgPSBmLmdldERhdGUoKSwgZSA9IC8oWytcLV0/WzAtOV0rKVxzKihkfER8d3xXfG18TXx5fFkpPy9nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gZS5leGVjKGMpOyBrOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoa1syXSB8fCAiZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiArPSBwYXJzZUludChrWzFdLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIlciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiArPSA3ICogcGFyc2VJbnQoa1sxXSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJNIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgKz0gcGFyc2VJbnQoa1sxXSwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IE1hdGgubWluKGYsIGEuZGF0ZXBpY2tlci5fZ2V0RGF5c0luTW9udGgoZywgbCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJZIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgKz0gcGFyc2VJbnQoa1sxXSwgMTApLCBmID0gTWF0aC5taW4oZiwgYS5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aChnLCBsKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGUuZXhlYyhjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGcsIGwsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPSAoYyA9IG51bGwgPT0gYyB8fCAiIiA9PT0gYyA/IGQgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGMgPyBmKGMpIDogIm51bWJlciIgPT09IHR5cGVvZiBjID8gaXNOYU4oYykgPyBkIDogZyhjKSA6IG5ldyBEYXRlKGMuZ2V0VGltZSgpKSkgJiYgIkludmFsaWQgRGF0ZSIgPT09IGMudG9TdHJpbmcoKSA/IGQgOiBjKSBjLnNldEhvdXJzKDApLAogICAgICAgICAgICAgICAgICAgICAgICBjLnNldE1pbnV0ZXMoMCksIGMuc2V0U2Vjb25kcygwKSwgYy5zZXRNaWxsaXNlY29uZHMoMCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RheWxpZ2h0U2F2aW5nQWRqdXN0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICBhLnNldEhvdXJzKDEyIDwgYS5nZXRIb3VycygpID8gYS5nZXRIb3VycygpICsgMiA6IDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldERhdGU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9ICFjLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYS5zZWxlY3RlZE1vbnRoLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gYS5zZWxlY3RlZFllYXI7CiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsIHRoaXMuX2RldGVybWluZURhdGUoYSwgYywgbmV3IERhdGUpKTsKICAgICAgICAgICAgICAgICAgICBhLnNlbGVjdGVkRGF5ID0gYS5jdXJyZW50RGF5ID0gYy5nZXREYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgYS5kcmF3TW9udGggPSBhLnNlbGVjdGVkTW9udGggPSBhLmN1cnJlbnRNb250aCA9IGMuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgICAgICBhLmRyYXdZZWFyID0gYS5zZWxlY3RlZFllYXIgPSBhLmN1cnJlbnRZZWFyID0gYy5nZXRGdWxsWWVhcigpOwogICAgICAgICAgICAgICAgICAgIGYgPT09IGEuc2VsZWN0ZWRNb250aCAmJiBtID09PQogICAgICAgICAgICAgICAgICAgICAgICBhLnNlbGVjdGVkWWVhciB8fCBkIHx8IHRoaXMuX25vdGlmeUNoYW5nZShhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGp1c3RJbnN0RGF0ZShhKTsKICAgICAgICAgICAgICAgICAgICBhLmlucHV0ICYmIGEuaW5wdXQudmFsKGcgPyAiIiA6IHRoaXMuX2Zvcm1hdERhdGUoYSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldERhdGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWEuY3VycmVudFllYXIgfHwgYS5pbnB1dCAmJiAiIiA9PT0gYS5pbnB1dC52YWwoKSA/IG51bGwgOiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShhLmN1cnJlbnRZZWFyLCBhLmN1cnJlbnRNb250aCwgYS5jdXJyZW50RGF5KSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXR0YWNoSGFuZGxlcnM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2dldChiLCAic3RlcE1vbnRocyIpLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gIiMiICsgYi5pZC5yZXBsYWNlKC9cXFxcL2csICJcXCIpOwogICAgICAgICAgICAgICAgICAgIGIuZHBEaXYuZmluZCgiW2RhdGEtaGFuZGxlcl0iKS5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYmluZCh0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1ldmVudCIpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoZCwgLWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJNIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoZCwgK2MsICJNIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2RheTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9nb3RvVG9kYXkoZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3REYXk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5fc2VsZWN0RGF5KGQsICt0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1tb250aCIpLCArdGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEteWVhciIpLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RNb250aDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRlcGlja2VyLl9zZWxlY3RNb250aFllYXIoZCwgdGhpcywgIk0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RZZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcihkLCB0aGlzLCAiWSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9W3RoaXMuZ2V0QXR0cmlidXRlKCJkYXRhLWhhbmRsZXIiKV0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2VuZXJhdGVIVE1MOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsCiAgICAgICAgICAgICAgICAgICAgICAgIGcsIGYsIG0sIGgsIGssIGwsIGUsIG4sIHAsIHIsIHEsIHUsIHosIHksIHYsIEMsIEQsIEEsIHgsIEgsIEUsIEYsIEksIEosIEcsIE0gPSBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgTSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKE0uZ2V0RnVsbFllYXIoKSwgTS5nZXRNb250aCgpLCBNLmdldERhdGUoKSkpLAogICAgICAgICAgICAgICAgICAgICAgICBPID0gdGhpcy5fZ2V0KGEsICJpc1JUTCIpOwogICAgICAgICAgICAgICAgICAgIGggPSB0aGlzLl9nZXQoYSwgInNob3dCdXR0b25QYW5lbCIpOwogICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLl9nZXQoYSwgImhpZGVJZk5vUHJldk5leHQiKTsKICAgICAgICAgICAgICAgICAgICBtID0gdGhpcy5fZ2V0KGEsICJuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0Iik7CiAgICAgICAgICAgICAgICAgICAgdmFyIFIgPSB0aGlzLl9nZXROdW1iZXJPZk1vbnRocyhhKSwKICAgICAgICAgICAgICAgICAgICAgICAgUCA9IHRoaXMuX2dldChhLCAic2hvd0N1cnJlbnRBdFBvcyIpOwogICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLl9nZXQoYSwgInN0ZXBNb250aHMiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgUyA9IDEgIT09IFJbMF0gfHwgMSAhPT0gUlsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgViA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KGEuY3VycmVudERheSA/IG5ldyBEYXRlKGEuY3VycmVudFllYXIsIGEuY3VycmVudE1vbnRoLCBhLmN1cnJlbnREYXkpIDogbmV3IERhdGUoOTk5OSwgOSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgVyA9IHRoaXMuX2dldE1pbk1heERhdGUoYSwgIm1pbiIpLAogICAgICAgICAgICAgICAgICAgICAgICBhYSA9IHRoaXMuX2dldE1pbk1heERhdGUoYSwgIm1heCIpLAogICAgICAgICAgICAgICAgICAgICAgICBQID0gYS5kcmF3TW9udGggLSBQLAogICAgICAgICAgICAgICAgICAgICAgICBZID0gYS5kcmF3WWVhcjsKICAgICAgICAgICAgICAgICAgICAwID4gUCAmJiAoUCArPSAxMiwgWS0tKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYWEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGFhLmdldEZ1bGxZZWFyKCksIGFhLmdldE1vbnRoKCkgLSBSWzBdICogUlsxXSArIDEsIGFhLmdldERhdGUoKSkpLCBjID0gVyAmJiBjIDwgVyA/IFcgOiBjOyB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShZLCBQLCAxKSkgPiBjOykgUC0tLCAwID4gUCAmJiAoUCA9IDExLCBZLS0pOwogICAgICAgICAgICAgICAgICAgIGEuZHJhd01vbnRoID0gUDsKICAgICAgICAgICAgICAgICAgICBhLmRyYXdZZWFyID0gWTsKICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5fZ2V0KGEsICJwcmV2VGV4dCIpOwogICAgICAgICAgICAgICAgICAgIGMgPSBtID8gdGhpcy5mb3JtYXREYXRlKGMsIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKFksIFAgLSBmLCAxKSksIHRoaXMuX2dldEZvcm1hdENvbmZpZyhhKSkgOiBjOwogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9jYW5BZGp1c3RNb250aChhLCAtMSwgWSwgUCkgPyAiPGEgY2xhc3M9J3VpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsJyBkYXRhLWhhbmRsZXI9J3ByZXYnIGRhdGEtZXZlbnQ9J2NsaWNrJyB0aXRsZT0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGMgKyAiJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0iICsgKE8gPyAiZSIgOiAidyIpICsgIic+IiArIGMgKyAiPC9zcGFuPjwvYT4iIDogZyA/ICIiIDogIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZCcgdGl0bGU9JyIgKyBjICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArIChPID8gImUiIDogInciKSArICInPiIgKyBjICsgIjwvc3Bhbj48L2E+IjsKICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fZ2V0KGEsICJuZXh0VGV4dCIpOwogICAgICAgICAgICAgICAgICAgIGQgPSBtID8gdGhpcy5mb3JtYXREYXRlKGQsIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKFksIFAgKyBmLCAxKSksIHRoaXMuX2dldEZvcm1hdENvbmZpZyhhKSkgOiBkOwogICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLl9jYW5BZGp1c3RNb250aChhLCAxLCBZLCBQKSA/ICI8YSBjbGFzcz0ndWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0nbmV4dCcgZGF0YS1ldmVudD0nY2xpY2snIHRpdGxlPSciICsgZCArICInPjxzcGFuIGNsYXNzPSd1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLSIgKwogICAgICAgICAgICAgICAgICAgICAgICAoTyA/ICJ3IiA6ICJlIikgKyAiJz4iICsgZCArICI8L3NwYW4+PC9hPiIgOiBnID8gIiIgOiAiPGEgY2xhc3M9J3VpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkJyB0aXRsZT0nIiArIGQgKyAiJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0iICsgKE8gPyAidyIgOiAiZSIpICsgIic+IiArIGQgKyAiPC9zcGFuPjwvYT4iOwogICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLl9nZXQoYSwgImN1cnJlbnRUZXh0Iik7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX2dldChhLCAiZ290b0N1cnJlbnQiKSAmJiBhLmN1cnJlbnREYXkgPyBWIDogTTsKICAgICAgICAgICAgICAgICAgICBmID0gbSA/IHRoaXMuZm9ybWF0RGF0ZShmLCBkLCB0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpIDogZjsKICAgICAgICAgICAgICAgICAgICBtID0gYS5pbmxpbmUgPyAiIiA6ICI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J3VpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0naGlkZScgZGF0YS1ldmVudD0nY2xpY2snPiIgKyB0aGlzLl9nZXQoYSwgImNsb3NlVGV4dCIpICsKICAgICAgICAgICAgICAgICAgICAgICAgIjwvYnV0dG9uPiI7CiAgICAgICAgICAgICAgICAgICAgaCA9IGggPyAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1idXR0b25wYW5lIHVpLXdpZGdldC1jb250ZW50Jz4iICsgKE8gPyBtIDogIiIpICsgKHRoaXMuX2lzSW5SYW5nZShhLCBkKSA/ICI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J3VpLWRhdGVwaWNrZXItY3VycmVudCB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXNlY29uZGFyeSB1aS1jb3JuZXItYWxsJyBkYXRhLWhhbmRsZXI9J3RvZGF5JyBkYXRhLWV2ZW50PSdjbGljayc+IiArIGYgKyAiPC9idXR0b24+IiA6ICIiKSArIChPID8gIiIgOiBtKSArICI8L2Rpdj4iIDogIiI7CiAgICAgICAgICAgICAgICAgICAgbSA9IHBhcnNlSW50KHRoaXMuX2dldChhLCAiZmlyc3REYXkiKSwgMTApOwogICAgICAgICAgICAgICAgICAgIG0gPSBpc05hTihtKSA/IDAgOiBtOwogICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLl9nZXQoYSwgInNob3dXZWVrIik7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX2dldChhLCAiZGF5TmFtZXMiKTsKICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy5fZ2V0KGEsICJkYXlOYW1lc01pbiIpOwogICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzLl9nZXQoYSwgIm1vbnRoTmFtZXMiKTsKICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5fZ2V0KGEsICJtb250aE5hbWVzU2hvcnQiKTsKICAgICAgICAgICAgICAgICAgICBuID0gdGhpcy5fZ2V0KGEsCiAgICAgICAgICAgICAgICAgICAgICAgICJiZWZvcmVTaG93RGF5Iik7CiAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMuX2dldChhLCAic2hvd090aGVyTW9udGhzIik7CiAgICAgICAgICAgICAgICAgICAgciA9IHRoaXMuX2dldChhLCAic2VsZWN0T3RoZXJNb250aHMiKTsKICAgICAgICAgICAgICAgICAgICBxID0gdGhpcy5fZ2V0RGVmYXVsdERhdGUoYSk7CiAgICAgICAgICAgICAgICAgICAgdSA9ICIiOwogICAgICAgICAgICAgICAgICAgIHo7CiAgICAgICAgICAgICAgICAgICAgZm9yICh5ID0gMDsgeSA8IFJbMF07IHkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF4Um93cyA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoQyA9IDA7IEMgPCBSWzFdOyBDKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEQgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShZLCBQLCBhLnNlbGVjdGVkRGF5KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gIiB1aS1jb3JuZXItYWxsIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSArPSAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1ncm91cCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPCBSWzFdKSBzd2l0Y2ggKEMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtZmlyc3QiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9ICIgdWktY29ybmVyLSIgKyAoTyA/ICJyaWdodCIgOiAibGVmdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUlsxXSAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBICs9ICIgdWktZGF0ZXBpY2tlci1ncm91cC1sYXN0IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHogPSAiIHVpLWNvcm5lci0iICsgKE8gPyAibGVmdCIgOiAicmlnaHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSArPSAiJz4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBICs9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLWhlYWRlciB1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCIgKyB6ICsgIic+IiArICgvYWxsfGxlZnQvLnRlc3QoeikgJiYgMCA9PT0geSA/IE8gPyBnIDogYyA6ICIiKSArICgvYWxsfHJpZ2h0Ly50ZXN0KHopICYmIDAgPT09IHkgPyBPID8gYyA6IGcgOiAiIikgKyB0aGlzLl9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcihhLCBQLCBZLCBXLCBhYSwgMCA8IHkgfHwgMCA8IEMsIGwsIGUpICsgIjwvZGl2Pjx0YWJsZSBjbGFzcz0ndWktZGF0ZXBpY2tlci1jYWxlbmRhcic+PHRoZWFkPjx0cj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGYgPyAiPHRoIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstY29sJz4iICsgdGhpcy5fZ2V0KGEsICJ3ZWVrSGVhZGVyIikgKyAiPC90aD4iIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHogPSAwOyA3ID4gejsgeisrKSBIID0gKHogKyBtKSAlIDcsIHggKz0gIjx0aCBzY29wZT0nY29sJyIgKyAoNSA8PSAoeiArIG0gKyA2KSAlIDcgPyAiIGNsYXNzPSd1aS1kYXRlcGlja2VyLXdlZWstZW5kJyIgOiAiIikgKyAiPjxzcGFuIHRpdGxlPSciICsgZFtIXSArICInPiIgKyBrW0hdICsgIjwvc3Bhbj48L3RoPiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBICs9IHggKyAiPC90cj48L3RoZWFkPjx0Ym9keT4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IHRoaXMuX2dldERheXNJbk1vbnRoKFksIFApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgWSA9PT0gYS5zZWxlY3RlZFllYXIgJiYgUCA9PT0gYS5zZWxlY3RlZE1vbnRoICYmIChhLnNlbGVjdGVkRGF5ID0gTWF0aC5taW4oYS5zZWxlY3RlZERheSwgeCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeiA9ICh0aGlzLl9nZXRGaXJzdERheU9mTW9udGgoWSwgUCkgLSBtICsgNykgJSA3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA9IE1hdGguY2VpbCgoeiArIHgpIC8gNyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1heFJvd3MgPSB4ID0gUyA/IHRoaXMubWF4Um93cyA+IHggPyB0aGlzLm1heFJvd3MgOiB4IDogeDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEggPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShZLCBQLCAxIC0geikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChFID0gMDsgRSA8IHg7IEUrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgKz0gIjx0cj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEYgPSBmID8gIjx0ZCBjbGFzcz0ndWktZGF0ZXBpY2tlci13ZWVrLWNvbCc+IiArIHRoaXMuX2dldChhLCAiY2FsY3VsYXRlV2VlayIpKEgpICsgIjwvdGQ+IiA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeiA9IDA7IDcgPiB6OyB6KyspIEkgPSBuID8gbi5hcHBseShhLmlucHV0ID8gYS5pbnB1dFswXSA6IG51bGwsIFtIXSkgOiBbITAsICIiXSwgRyA9IChKID0gSC5nZXRNb250aCgpICE9PSBQKSAmJiAhciB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhSVswXSB8fCBXICYmIEggPCBXIHx8IGFhICYmIEggPiBhYSwgRiArPSAiPHRkIGNsYXNzPSciICsgKDUgPD0gKHogKyBtICsgNikgJSA3ID8gIiB1aS1kYXRlcGlja2VyLXdlZWstZW5kIiA6ICIiKSArIChKID8gIiB1aS1kYXRlcGlja2VyLW90aGVyLW1vbnRoIiA6ICIiKSArIChILmdldFRpbWUoKSA9PT0gRC5nZXRUaW1lKCkgJiYgUCA9PT0gYS5zZWxlY3RlZE1vbnRoICYmIGEuX2tleUV2ZW50IHx8IHEuZ2V0VGltZSgpID09PSBILmdldFRpbWUoKSAmJiBxLmdldFRpbWUoKSA9PT0gRC5nZXRUaW1lKCkgPyAiICIgKyB0aGlzLl9kYXlPdmVyQ2xhc3MgOiAiIikgKyAoRyA/ICIgIiArIHRoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzICsgIiB1aS1zdGF0ZS1kaXNhYmxlZCIgOiAiIikgKyAoSiAmJiAhcCA/ICIiIDogIiAiICsgSVsxXSArIChILmdldFRpbWUoKSA9PT0gVi5nZXRUaW1lKCkgPyAiICIgKyB0aGlzLl9jdXJyZW50Q2xhc3MgOiAiIikgKyAoSC5nZXRUaW1lKCkgPT09IE0uZ2V0VGltZSgpID8gIiB1aS1kYXRlcGlja2VyLXRvZGF5IiA6ICIiKSkgKyAiJyIgKyAoSiAmJiAhcCB8fCAhSVsyXSA/ICIiIDogIiB0aXRsZT0nIiArIElbMl0ucmVwbGFjZSgvJy9nLCAiJiMzOTsiKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJyIpICsgKEcgPyAiIiA6ICIgZGF0YS1oYW5kbGVyPSdzZWxlY3REYXknIGRhdGEtZXZlbnQ9J2NsaWNrJyBkYXRhLW1vbnRoPSciICsgSC5nZXRNb250aCgpICsgIicgZGF0YS15ZWFyPSciICsgSC5nZXRGdWxsWWVhcigpICsgIiciKSArICI+IiArIChKICYmICFwID8gIiYjeGEwOyIgOiBHID8gIjxzcGFuIGNsYXNzPSd1aS1zdGF0ZS1kZWZhdWx0Jz4iICsgSC5nZXREYXRlKCkgKyAiPC9zcGFuPiIgOiAiPGEgY2xhc3M9J3VpLXN0YXRlLWRlZmF1bHQiICsgKEguZ2V0VGltZSgpID09PSBNLmdldFRpbWUoKSA/ICIgdWktc3RhdGUtaGlnaGxpZ2h0IiA6ICIiKSArIChILmdldFRpbWUoKSA9PT0gVi5nZXRUaW1lKCkgPyAiIHVpLXN0YXRlLWFjdGl2ZSIgOiAiIikgKyAoSiA/ICIgdWktcHJpb3JpdHktc2Vjb25kYXJ5IiA6ICIiKSArICInIGhyZWY9JyMnPiIgKyBILmdldERhdGUoKSArICI8L2E+IikgKyAiPC90ZD4iLCBILnNldERhdGUoSC5nZXREYXRlKCkgKyAxKSwgSCA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KEgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgKz0gRiArICI8L3RyPiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFArKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExIDwgUCAmJiAoUCA9IDAsIFkrKyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBICs9ICI8L3Rib2R5PjwvdGFibGU+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFMgPyAiPC9kaXY+IiArICgwIDwgUlswXSAmJiBDID09PSBSWzFdIC0gMSA/ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLXJvdy1icmVhayc+PC9kaXY+IiA6ICIiKSA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgKz0gQQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHUgKz0gdgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhLl9rZXlFdmVudCA9ICExOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB1ICsgaAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcjogZnVuY3Rpb24oYSwgYywgZCwgZywgZiwgbSwgaCwgaykgewogICAgICAgICAgICAgICAgICAgIHZhciBsLCBlLCBuLCBwID0gdGhpcy5fZ2V0KGEsICJjaGFuZ2VNb250aCIpLAogICAgICAgICAgICAgICAgICAgICAgICByID0gdGhpcy5fZ2V0KGEsICJjaGFuZ2VZZWFyIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSB0aGlzLl9nZXQoYSwgInNob3dNb250aEFmdGVyWWVhciIpLAogICAgICAgICAgICAgICAgICAgICAgICB1ID0gIjxkaXYgY2xhc3M9J3VpLWRhdGVwaWNrZXItdGl0bGUnPiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHogPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAobSB8fCAhcCkgeiArPSAiPHNwYW4gY2xhc3M9J3VpLWRhdGVwaWNrZXItbW9udGgnPiIgKyBoW2NdICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBoID0gZyAmJiBnLmdldEZ1bGxZZWFyKCkgPT09IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBmICYmIGYuZ2V0RnVsbFllYXIoKSA9PT0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgeiArPSAiPHNlbGVjdCBjbGFzcz0ndWktZGF0ZXBpY2tlci1tb250aCcgZGF0YS1oYW5kbGVyPSdzZWxlY3RNb250aCcgZGF0YS1ldmVudD0nY2hhbmdlJz4iOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUgPSAwOyAxMiA+IGU7IGUrKykoIWggfHwgZSA+PSBnLmdldE1vbnRoKCkpICYmICghbCB8fCBlIDw9IGYuZ2V0TW9udGgoKSkgJiYgKHogKz0gIjxvcHRpb24gdmFsdWU9JyIgKyBlICsgIiciICsgKGUgPT09IGMgPyAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIpICsgIj4iICsga1tlXSArICI8L29wdGlvbj4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgeiArPSAiPC9zZWxlY3Q+IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBxIHx8ICh1ICs9IHogKyAoIW0gJiYgcCAmJiByID8gIiIgOiAiJiN4YTA7IikpOwogICAgICAgICAgICAgICAgICAgIGlmICghYS55ZWFyc2h0bWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnllYXJzaHRtbCA9ICIiLCBtIHx8ICFyKSB1ICs9ICI8c3BhbiBjbGFzcz0ndWktZGF0ZXBpY2tlci15ZWFyJz4iICsgZCArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy5fZ2V0KGEsICJ5ZWFyUmFuZ2UiKS5zcGxpdCgiOiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEubWF0Y2goL2NbK1wtXS4qLykgPyBkICsgcGFyc2VJbnQoYS5zdWJzdHJpbmcoMSksIDEwKSA6IGEubWF0Y2goL1srXC1dLiovKSA/IG4gKyBwYXJzZUludChhLCAxMCkgOiBwYXJzZUludChhLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzTmFOKGEpID8gbiA6IGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gaChrWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBNYXRoLm1heChjLCBoKGtbMV0gfHwgIiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBnID8gTWF0aC5tYXgoYywgZy5nZXRGdWxsWWVhcigpKSA6IGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gZiA/IE1hdGgubWluKGssIGYuZ2V0RnVsbFllYXIoKSkgOiBrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChhLnllYXJzaHRtbCArPSAiPHNlbGVjdCBjbGFzcz0ndWktZGF0ZXBpY2tlci15ZWFyJyBkYXRhLWhhbmRsZXI9J3NlbGVjdFllYXInIGRhdGEtZXZlbnQ9J2NoYW5nZSc+IjsgYyA8PSBrOyBjKyspIGEueWVhcnNodG1sICs9ICI8b3B0aW9uIHZhbHVlPSciICsgYyArICInIiArIChjID09PSBkID8gIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIiA6ICIiKSArICI+IiArIGMgKyAiPC9vcHRpb24+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEueWVhcnNodG1sICs9ICI8L3NlbGVjdD4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSArPSBhLnllYXJzaHRtbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEueWVhcnNodG1sID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdSArPSB0aGlzLl9nZXQoYSwgInllYXJTdWZmaXgiKTsKICAgICAgICAgICAgICAgICAgICBxICYmICh1ICs9ICghbSAmJiBwICYmIHIgPyAiIiA6ICImI3hhMDsiKSArIHopOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB1ICsgIjwvZGl2PiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWRqdXN0SW5zdERhdGU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuZHJhd1llYXIgKyAoIlkiID09PSBkID8gYyA6IDApLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYS5kcmF3TW9udGggKwogICAgICAgICAgICAgICAgICAgICAgICAoIk0iID09PSBkID8gYyA6IDApOwogICAgICAgICAgICAgICAgICAgIGMgPSBNYXRoLm1pbihhLnNlbGVjdGVkRGF5LCB0aGlzLl9nZXREYXlzSW5Nb250aChnLCBmKSkgKyAoIkQiID09PSBkID8gYyA6IDApOwogICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLl9yZXN0cmljdE1pbk1heChhLCB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShnLCBmLCBjKSkpOwogICAgICAgICAgICAgICAgICAgIGEuc2VsZWN0ZWREYXkgPSBnLmdldERhdGUoKTsKICAgICAgICAgICAgICAgICAgICBhLmRyYXdNb250aCA9IGEuc2VsZWN0ZWRNb250aCA9IGcuZ2V0TW9udGgoKTsKICAgICAgICAgICAgICAgICAgICBhLmRyYXdZZWFyID0gYS5zZWxlY3RlZFllYXIgPSBnLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgIk0iICE9PSBkICYmICJZIiAhPT0gZCB8fCB0aGlzLl9ub3RpZnlDaGFuZ2UoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVzdHJpY3RNaW5NYXg6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2dldE1pbk1heERhdGUoYSwgIm1pbiIpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShhLCAibWF4IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBkICYmIGMgPCBkID8gZCA6IGM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcgJiYgZCA+IGcgPyBnIDogZAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9ub3RpZnlDaGFuZ2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2dldChhLCAib25DaGFuZ2VNb250aFllYXIiKTsKICAgICAgICAgICAgICAgICAgICBjICYmIGMuYXBwbHkoYS5pbnB1dCA/CiAgICAgICAgICAgICAgICAgICAgICAgIGEuaW5wdXRbMF0gOiBudWxsLCBbYS5zZWxlY3RlZFllYXIsIGEuc2VsZWN0ZWRNb250aCArIDEsIGFdKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXROdW1iZXJPZk1vbnRoczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLl9nZXQoYSwgIm51bWJlck9mTW9udGhzIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gYSA/IFsxLCAxXSA6ICJudW1iZXIiID09PSB0eXBlb2YgYSA/IFsxLCBhXSA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0TWluTWF4RGF0ZTogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXRlcm1pbmVEYXRlKGEsIHRoaXMuX2dldChhLCBjICsgIkRhdGUiKSwgbnVsbCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0RGF5c0luTW9udGg6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzIgLSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShhLCBjLCAzMikpLmdldERhdGUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRGaXJzdERheU9mTW9udGg6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKGEsIGMsIDEpKS5nZXREYXkoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jYW5BZGp1c3RNb250aDogZnVuY3Rpb24oYSwgYywgZCwgZykgewogICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYSk7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGQsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgKyAoMCA+IGMgPyBjIDogZlswXSAqIGZbMV0pLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgMCA+IGMgJiYgZC5zZXREYXRlKHRoaXMuX2dldERheXNJbk1vbnRoKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW5SYW5nZShhLCBkKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pc0luUmFuZ2U6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgZiA9IHRoaXMuX2dldE1pbk1heERhdGUoYSwgIm1pbiIpLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShhLCAibWF4IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBrID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IHRoaXMuX2dldChhLCAieWVhclJhbmdlIikpIGQgPSBkLnNwbGl0KCI6IiksIGcgPSAobmV3IERhdGUpLmdldEZ1bGxZZWFyKCksIGggPSBwYXJzZUludChkWzBdLCAxMCksIGsgPSBwYXJzZUludChkWzFdLCAxMCksIGRbMF0ubWF0Y2goL1srXC1dLiovKSAmJiAoaCArPSBnKSwgZFsxXS5tYXRjaCgvWytcLV0uKi8pICYmIChrICs9IGcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIWYgfHwgYy5nZXRUaW1lKCkgPj0gZi5nZXRUaW1lKCkpICYmICghbSB8fCBjLmdldFRpbWUoKSA8PSBtLmdldFRpbWUoKSkgJiYgKCFoIHx8IGMuZ2V0RnVsbFllYXIoKSA+PSBoKSAmJiAoIWsgfHwKICAgICAgICAgICAgICAgICAgICAgICAgYy5nZXRGdWxsWWVhcigpIDw9IGspCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldEZvcm1hdENvbmZpZzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fZ2V0KGEsICJzaG9ydFllYXJDdXRvZmYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICJzdHJpbmciICE9PSB0eXBlb2YgYyA/IGMgOiAobmV3IERhdGUpLmdldEZ1bGxZZWFyKCkgJSAxMDAgKyBwYXJzZUludChjLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRZZWFyQ3V0b2ZmOiBjLAogICAgICAgICAgICAgICAgICAgICAgICBkYXlOYW1lc1Nob3J0OiB0aGlzLl9nZXQoYSwgImRheU5hbWVzU2hvcnQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF5TmFtZXM6IHRoaXMuX2dldChhLCAiZGF5TmFtZXMiKSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhOYW1lc1Nob3J0OiB0aGlzLl9nZXQoYSwgIm1vbnRoTmFtZXNTaG9ydCIpLAogICAgICAgICAgICAgICAgICAgICAgICBtb250aE5hbWVzOiB0aGlzLl9nZXQoYSwgIm1vbnRoTmFtZXMiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZm9ybWF0RGF0ZTogZnVuY3Rpb24oYSwgYywgZCwgZykgewogICAgICAgICAgICAgICAgICAgIGMgfHwgKGEuY3VycmVudERheSA9IGEuc2VsZWN0ZWREYXksIGEuY3VycmVudE1vbnRoID0gYS5zZWxlY3RlZE1vbnRoLCBhLmN1cnJlbnRZZWFyID0gYS5zZWxlY3RlZFllYXIpOwogICAgICAgICAgICAgICAgICAgIGMgPSBjID8gIm9iamVjdCIgPT09IHR5cGVvZiBjID8gYyA6IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGcsCiAgICAgICAgICAgICAgICAgICAgICAgIGQsIGMpKSA6IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGEuY3VycmVudFllYXIsIGEuY3VycmVudE1vbnRoLCBhLmN1cnJlbnREYXkpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXREYXRlKHRoaXMuX2dldChhLCAiZGF0ZUZvcm1hdCIpLCBjLCB0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLmZuLmRhdGVwaWNrZXIgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubGVuZ3RoKSByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIGEuZGF0ZXBpY2tlci5pbml0aWFsaXplZCB8fCAoYShkb2N1bWVudCkubW91c2Vkb3duKGEuZGF0ZXBpY2tlci5fY2hlY2tFeHRlcm5hbENsaWNrKSwgYS5kYXRlcGlja2VyLmluaXRpYWxpemVkID0gITApOwogICAgICAgICAgICAgICAgMCA9PT0gYSgiIyIgKyBhLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoICYmIGEoImJvZHkiKS5hcHBlbmQoYS5kYXRlcGlja2VyLmRwRGl2KTsKICAgICAgICAgICAgICAgIHZhciBjID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGIgJiYgKCJpc0Rpc2FibGVkIiA9PT0KICAgICAgICAgICAgICAgICAgICBiIHx8ICJnZXREYXRlIiA9PT0gYiB8fCAid2lkZ2V0IiA9PT0gYikgfHwgIm9wdGlvbiIgPT09IGIgJiYgMiA9PT0gYXJndW1lbnRzLmxlbmd0aCAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGFyZ3VtZW50c1sxXSA/IGEuZGF0ZXBpY2tlclsiXyIgKyBiICsgIkRhdGVwaWNrZXIiXS5hcHBseShhLmRhdGVwaWNrZXIsIFt0aGlzWzBdXS5jb25jYXQoYykpIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYiA/IGEuZGF0ZXBpY2tlclsiXyIgKyBiICsgIkRhdGVwaWNrZXIiXS5hcHBseShhLmRhdGVwaWNrZXIsIFt0aGlzXS5jb25jYXQoYykpIDogYS5kYXRlcGlja2VyLl9hdHRhY2hEYXRlcGlja2VyKHRoaXMsIGIpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmRhdGVwaWNrZXIgPSBuZXcgdjsKICAgICAgICAgICAgYS5kYXRlcGlja2VyLmluaXRpYWxpemVkID0gITE7CiAgICAgICAgICAgIGEuZGF0ZXBpY2tlci51dWlkID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CiAgICAgICAgICAgIGEuZGF0ZXBpY2tlci52ZXJzaW9uID0gIjEuMTEuNCI7CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5kcmFnZ2FibGUiLCBhLnVpLm1vdXNlLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIHdpZGdldEV2ZW50UHJlZml4OiAiZHJhZyIsCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3NlczogITAsCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG86ICJwYXJlbnQiLAogICAgICAgICAgICAgICAgICAgIGF4aXM6ICExLAogICAgICAgICAgICAgICAgICAgIGNvbm5lY3RUb1NvcnRhYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICBjb250YWlubWVudDogITEsCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yQXQ6ICExLAogICAgICAgICAgICAgICAgICAgIGdyaWQ6ICExLAogICAgICAgICAgICAgICAgICAgIGhhbmRsZTogITEsCiAgICAgICAgICAgICAgICAgICAgaGVscGVyOiAib3JpZ2luYWwiLAogICAgICAgICAgICAgICAgICAgIGlmcmFtZUZpeDogITEsCiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogITEsCiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFBvc2l0aW9uczogITEsCiAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0OiAhMSwKICAgICAgICAgICAgICAgICAgICByZXZlcnREdXJhdGlvbjogNTAwLAogICAgICAgICAgICAgICAgICAgIHNjb3BlOiAiZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsOiAhMCwKICAgICAgICAgICAgICAgICAgICBzY3JvbGxTZW5zaXRpdml0eTogMjAsCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsU3BlZWQ6IDIwLAogICAgICAgICAgICAgICAgICAgIHNuYXA6ICExLAogICAgICAgICAgICAgICAgICAgIHNuYXBNb2RlOiAiYm90aCIsCiAgICAgICAgICAgICAgICAgICAgc25hcFRvbGVyYW5jZTogMjAsCiAgICAgICAgICAgICAgICAgICAgc3RhY2s6ICExLAogICAgICAgICAgICAgICAgICAgIHpJbmRleDogITEsCiAgICAgICAgICAgICAgICAgICAgZHJhZzogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzdG9wOiBudWxsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsIiA9PT0gdGhpcy5vcHRpb25zLmhlbHBlciAmJiB0aGlzLl9zZXRQb3NpdGlvblJlbGF0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmFkZENsYXNzZXMgJiYgdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZUluaXQoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRPcHRpb246IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihhLCBjKTsKICAgICAgICAgICAgICAgICAgICAiaGFuZGxlIiA9PT0gYSAmJiAodGhpcy5fcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAodGhpcy5oZWxwZXIgfHwgdGhpcy5lbGVtZW50KS5pcygiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpID8gdGhpcy5kZXN0cm95T25DbGVhciA9ICEwIDogKHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlIHVpLWRyYWdnYWJsZS1kcmFnZ2luZyB1aS1kcmFnZ2FibGUtZGlzYWJsZWQiKSwgdGhpcy5fcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lKCksIHRoaXMuX21vdXNlRGVzdHJveSgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ibHVyQWN0aXZlRWxlbWVudChiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oZWxwZXIgfHwgYy5kaXNhYmxlZCB8fCAwIDwgYShiLnRhcmdldCkuY2xvc2VzdCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiKS5sZW5ndGgpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZSA9IHRoaXMuX2dldEhhbmRsZShiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaGFuZGxlKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmxvY2tGcmFtZXMoITAgPT09IGMuaWZyYW1lRml4ID8gImlmcmFtZSIgOiBjLmlmcmFtZUZpeCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Jsb2NrRnJhbWVzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZnJhbWVCbG9ja3MgPSB0aGlzLmRvY3VtZW50LmZpbmQoYikubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKCI8ZGl2PiIpLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKS5hcHBlbmRUbyhiLnBhcmVudCgpKS5vdXRlcldpZHRoKGIub3V0ZXJXaWR0aCgpKS5vdXRlckhlaWdodChiLm91dGVySGVpZ2h0KCkpLm9mZnNldChiLm9mZnNldCgpKVswXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3VuYmxvY2tGcmFtZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaWZyYW1lQmxvY2tzICYmCiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmlmcmFtZUJsb2Nrcy5yZW1vdmUoKSwgZGVsZXRlIHRoaXMuaWZyYW1lQmxvY2tzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9ibHVyQWN0aXZlRWxlbWVudDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5kb2N1bWVudFswXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYW5kbGVFbGVtZW50LmlzKGIudGFyZ2V0KSkgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgYy5hY3RpdmVFbGVtZW50ICYmICJib2R5IiAhPT0gYy5hY3RpdmVFbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgJiYgYShjLmFjdGl2ZUVsZW1lbnQpLmJsdXIoKQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHt9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlciA9IHRoaXMuX2NyZWF0ZUhlbHBlcihiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlci5hZGRDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpOwogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyICYmIChhLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVNYXJnaW5zKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jc3NQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmNzcygicG9zaXRpb24iKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFBhcmVudCA9IHRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCghMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRQYXJlbnQgPSB0aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0ZpeGVkQW5jZXN0b3IgPSAwIDwgdGhpcy5oZWxwZXIucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJmaXhlZCIgPT09IGEodGhpcykuY3NzKCJwb3NpdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgfSkubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25BYnMgPSB0aGlzLmVsZW1lbnQub2Zmc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaE9mZnNldHMoYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbiA9IHRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYiwgITEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxQYWdlWCA9IGIucGFnZVg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFBhZ2VZID0gYi5wYWdlWTsKICAgICAgICAgICAgICAgICAgICBjLmN1cnNvckF0ICYmIHRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYy5jdXJzb3JBdCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0Q29udGFpbm1lbnQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IHRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgYikpIHJldHVybiB0aGlzLl9jbGVhcigpLCAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYgIWMuZHJvcEJlaGF2aW91ciAmJiBhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ub3JtYWxpemVSaWdodEJvdHRvbSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlRHJhZyhiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYgYS51aS5kZG1hbmFnZXIuZHJhZ1N0YXJ0KHRoaXMsIGIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZWZyZXNoT2Zmc2V0czogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHRoaXMucG9zaXRpb25BYnMudG9wIC0gdGhpcy5tYXJnaW5zLnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy5wb3NpdGlvbkFicy5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudDogdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlOiB0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldC5jbGljayA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYS5wYWdlWCAtIHRoaXMub2Zmc2V0LmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYS5wYWdlWSAtIHRoaXMub2Zmc2V0LnRvcAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VEcmFnOiBmdW5jdGlvbihiLAogICAgICAgICAgICAgICAgICAgIGMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0ZpeGVkQW5jZXN0b3IgJiYgKHRoaXMub2Zmc2V0LnBhcmVudCA9IHRoaXMuX2dldFBhcmVudE9mZnNldCgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihiLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX3VpSGFzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IHRoaXMuX3RyaWdnZXIoImRyYWciLCBiLCBkKSkgcmV0dXJuIHRoaXMuX21vdXNlVXAoe30pLCAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGQucG9zaXRpb24KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdCA9IHRoaXMucG9zaXRpb24ubGVmdCArICJweCI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXJbMF0uc3R5bGUudG9wID0gdGhpcy5wb3NpdGlvbi50b3AgKyAicHgiOwogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyICYmIGEudWkuZGRtYW5hZ2VyLmRyYWcodGhpcywgYik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RvcDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9ICExOwogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyICYmICF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciAmJgogICAgICAgICAgICAgICAgICAgICAgICAoZCA9IGEudWkuZGRtYW5hZ2VyLmRyb3AodGhpcywgYikpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcHBlZCAmJiAoZCA9IHRoaXMuZHJvcHBlZCwgdGhpcy5kcm9wcGVkID0gITEpOwogICAgICAgICAgICAgICAgICAgICJpbnZhbGlkIiA9PT0gdGhpcy5vcHRpb25zLnJldmVydCAmJiAhZCB8fCAidmFsaWQiID09PSB0aGlzLm9wdGlvbnMucmV2ZXJ0ICYmIGQgfHwgITAgPT09IHRoaXMub3B0aW9ucy5yZXZlcnQgfHwgYS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5yZXZlcnQpICYmIHRoaXMub3B0aW9ucy5yZXZlcnQuY2FsbCh0aGlzLmVsZW1lbnQsIGQpID8gYSh0aGlzLmhlbHBlcikuYW5pbWF0ZSh0aGlzLm9yaWdpbmFsUG9zaXRpb24sIHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwgMTApLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09IGMuX3RyaWdnZXIoInN0b3AiLCBiKSAmJiBjLl9jbGVhcigpCiAgICAgICAgICAgICAgICAgICAgfSkgOiAhMSAhPT0gdGhpcy5fdHJpZ2dlcigic3RvcCIsIGIpICYmIHRoaXMuX2NsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlVXA6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmJsb2NrRnJhbWVzKCk7CiAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIuZHJhZ1N0b3AodGhpcywgYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFbGVtZW50LmlzKGIudGFyZ2V0KSAmJiB0aGlzLmVsZW1lbnQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS51aS5tb3VzZS5wcm90b3R5cGUuX21vdXNlVXAuY2FsbCh0aGlzLCBiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXIuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKSA/IHRoaXMuX21vdXNlVXAoe30pIDogdGhpcy5fY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRIYW5kbGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhhbmRsZSA/ICEhYShiLnRhcmdldCkuY2xvc2VzdCh0aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMuaGFuZGxlKSkubGVuZ3RoIDogITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0SGFuZGxlQ2xhc3NOYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVsZW1lbnQgPSB0aGlzLm9wdGlvbnMuaGFuZGxlID8gdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmhhbmRsZSkgOiB0aGlzLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtaGFuZGxlIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZS1oYW5kbGUiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEuaXNGdW5jdGlvbihjLmhlbHBlcik7CiAgICAgICAgICAgICAgICAgICAgYiA9IGQgPyBhKGMuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2JdKSkgOiAiY2xvbmUiID09PSBjLmhlbHBlciA/IHRoaXMuZWxlbWVudC5jbG9uZSgpLnJlbW92ZUF0dHIoImlkIikgOiB0aGlzLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgYi5wYXJlbnRzKCJib2R5IikubGVuZ3RoIHx8IGIuYXBwZW5kVG8oInBhcmVudCIgPT09IGMuYXBwZW5kVG8gPyB0aGlzLmVsZW1lbnRbMF0ucGFyZW50Tm9kZSA6IGMuYXBwZW5kVG8pOwogICAgICAgICAgICAgICAgICAgIGQgJiYgYlswXSA9PT0gdGhpcy5lbGVtZW50WzBdICYmIHRoaXMuX3NldFBvc2l0aW9uUmVsYXRpdmUoKTsKICAgICAgICAgICAgICAgICAgICBiWzBdID09PSB0aGlzLmVsZW1lbnRbMF0gfHwgLyhmaXhlZHxhYnNvbHV0ZSkvLnRlc3QoYi5jc3MoInBvc2l0aW9uIikpIHx8IGIuY3NzKCJwb3NpdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhYnNvbHV0ZSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldFBvc2l0aW9uUmVsYXRpdmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIC9eKD86cnxhfGYpLy50ZXN0KHRoaXMuZWxlbWVudC5jc3MoInBvc2l0aW9uIikpIHx8ICh0aGlzLmVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBiICYmIChiID0gYi5zcGxpdCgiICIpKTsKICAgICAgICAgICAgICAgICAgICBhLmlzQXJyYXkoYikgJiYgKGIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICtiWzBdLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICtiWzFdIHx8IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAibGVmdCIgaW4gYiAmJiAodGhpcy5vZmZzZXQuY2xpY2subGVmdCA9IGIubGVmdCArIHRoaXMubWFyZ2lucy5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAicmlnaHQiIGluIGIgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gYi5yaWdodCArIHRoaXMubWFyZ2lucy5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAidG9wIiBpbiBiICYmICh0aGlzLm9mZnNldC5jbGljay50b3AgPSBiLnRvcCArIHRoaXMubWFyZ2lucy50b3ApOwogICAgICAgICAgICAgICAgICAgICJib3R0b20iIGluIGIgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gYi5ib3R0b20gKyB0aGlzLm1hcmdpbnMudG9wKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pc1Jvb3ROb2RlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC8oaHRtbHxib2R5KS9pLnRlc3QoYS50YWdOYW1lKSB8fCBhID09PSB0aGlzLmRvY3VtZW50WzBdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldFBhcmVudE9mZnNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuZG9jdW1lbnRbMF07CiAgICAgICAgICAgICAgICAgICAgImFic29sdXRlIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiAmJiB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gYyAmJiBhLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLCB0aGlzLm9mZnNldFBhcmVudFswXSkgJiYgKGIubGVmdCArPSB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCksIGIudG9wICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc1Jvb3ROb2RlKHRoaXMub2Zmc2V0UGFyZW50WzBdKSAmJiAoYiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBiLnRvcCArIChwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlclRvcFdpZHRoIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCkgfHwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGIubGVmdCArIChwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlckxlZnRXaWR0aCIpLCAxMCkgfHwgMCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldFJlbGF0aXZlT2Zmc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoInJlbGF0aXZlIiAhPT0gdGhpcy5jc3NQb3NpdGlvbikgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuZWxlbWVudC5wb3NpdGlvbigpLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5faXNSb290Tm9kZSh0aGlzLnNjcm9sbFBhcmVudFswXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBhLnRvcCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoInRvcCIpLCAxMCkgfHwgMCkgKyAoYyA/IDAgOiB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGEubGVmdCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSwgMTApIHx8IDApICsgKGMgPyAwIDogdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2FjaGVNYXJnaW5zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcmdpbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLCAxMCkgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblJpZ2h0IiksIDEwKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICBib3R0b206IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpLCAxMCkgfHwgMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXJQcm9wb3J0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRDb250YWlubWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMsIGQ7CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5kb2N1bWVudFswXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbGF0aXZlQ29udGFpbmVyID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoYi5jb250YWlubWVudCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ3aW5kb3ciID09PSBiLmNvbnRhaW5tZW50KSB0aGlzLmNvbnRhaW5tZW50ID0gW2Eod2luZG93KS5zY3JvbGxMZWZ0KCkgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0IC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LCBhKHdpbmRvdykuc2Nyb2xsVG9wKCkgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgLSB0aGlzLm9mZnNldC5wYXJlbnQudG9wLCBhKHdpbmRvdykuc2Nyb2xsTGVmdCgpICsgYSh3aW5kb3cpLndpZHRoKCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdGhpcy5tYXJnaW5zLmxlZnQsIGEod2luZG93KS5zY3JvbGxUb3AoKSArIChhKHdpbmRvdykuaGVpZ2h0KCkgfHwgYy5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgiZG9jdW1lbnQiID09PSBiLmNvbnRhaW5tZW50KSB0aGlzLmNvbnRhaW5tZW50ID0gWzAsIDAsIGEoYykud2lkdGgoKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwgKGEoYykuaGVpZ2h0KCkgfHwgYy5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcF07CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYi5jb250YWlubWVudC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHRoaXMuY29udGFpbm1lbnQgPSBiLmNvbnRhaW5tZW50OwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoInBhcmVudCIgPT09IGIuY29udGFpbm1lbnQgJiYgKGIuY29udGFpbm1lbnQgPSB0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlKSwgYyA9IGEoYi5jb250YWlubWVudCksIGQgPSBjWzBdKSBiID0gLyhzY3JvbGx8YXV0bykvLnRlc3QoYy5jc3MoIm92ZXJmbG93IikpLCB0aGlzLmNvbnRhaW5tZW50ID0gWyhwYXJzZUludChjLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksIDEwKSB8fCAwKSArIChwYXJzZUludChjLmNzcygicGFkZGluZ0xlZnQiKSwgMTApIHx8IDApLCAocGFyc2VJbnQoYy5jc3MoImJvcmRlclRvcFdpZHRoIiksIDEwKSB8fCAwKSArIChwYXJzZUludChjLmNzcygicGFkZGluZ1RvcCIpLCAxMCkgfHwgMCksIChiID8gTWF0aC5tYXgoZC5zY3JvbGxXaWR0aCwgZC5vZmZzZXRXaWR0aCkgOiBkLm9mZnNldFdpZHRoKSAtIChwYXJzZUludChjLmNzcygiYm9yZGVyUmlnaHRXaWR0aCIpLCAxMCkgfHwgMCkgLSAocGFyc2VJbnQoYy5jc3MoInBhZGRpbmdSaWdodCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTApIHx8IDApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0IC0gdGhpcy5tYXJnaW5zLnJpZ2h0LCAoYiA/IE1hdGgubWF4KGQuc2Nyb2xsSGVpZ2h0LCBkLm9mZnNldEhlaWdodCkgOiBkLm9mZnNldEhlaWdodCkgLSAocGFyc2VJbnQoYy5jc3MoImJvcmRlckJvdHRvbVdpZHRoIiksIDEwKSB8fCAwKSAtIChwYXJzZUludChjLmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCkgfHwgMCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3AgLSB0aGlzLm1hcmdpbnMuYm90dG9tXSwgdGhpcy5yZWxhdGl2ZUNvbnRhaW5lciA9IGMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5jb250YWlubWVudCA9IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY29udmVydFBvc2l0aW9uVG86IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICBjIHx8IChjID0gdGhpcy5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAiYWJzb2x1dGUiID09PSBhID8gMSA6IC0xLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5faXNSb290Tm9kZSh0aGlzLnNjcm9sbFBhcmVudFswXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBjLnRvcCArIHRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICsgdGhpcy5vZmZzZXQucGFyZW50LnRvcCAqIGQgLSAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLm9mZnNldC5zY3JvbGwudG9wIDogZyA/IDAgOiB0aGlzLm9mZnNldC5zY3JvbGwudG9wKSAqIGQsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGMubGVmdCArIHRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQgKiBkICsgdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKiBkIC0gKCJmaXhlZCIgPT09IHRoaXMuY3NzUG9zaXRpb24gPyAtdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQgOiBnID8gMCA6IHRoaXMub2Zmc2V0LnNjcm9sbC5sZWZ0KSAqIGQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dlbmVyYXRlUG9zaXRpb246IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgZiwgbSA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMuX2lzUm9vdE5vZGUodGhpcy5zY3JvbGxQYXJlbnRbMF0pOwogICAgICAgICAgICAgICAgICAgIGYgPSBhLnBhZ2VYOwogICAgICAgICAgICAgICAgICAgIGcgPSBhLnBhZ2VZOwogICAgICAgICAgICAgICAgICAgIGggJiYgdGhpcy5vZmZzZXQuc2Nyb2xsIHx8ICh0aGlzLm9mZnNldC5zY3JvbGwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGMgJiYgKHRoaXMuY29udGFpbm1lbnQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMucmVsYXRpdmVDb250YWluZXIgPyAoZCA9IHRoaXMucmVsYXRpdmVDb250YWluZXIub2Zmc2V0KCksIGQgPSBbdGhpcy5jb250YWlubWVudFswXSArIGQubGVmdCwgdGhpcy5jb250YWlubWVudFsxXSArIGQudG9wLCB0aGlzLmNvbnRhaW5tZW50WzJdICsgZC5sZWZ0LCB0aGlzLmNvbnRhaW5tZW50WzNdICsgZC50b3BdKSA6IGQgPSB0aGlzLmNvbnRhaW5tZW50LCBhLnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8IGRbMF0gJiYgKGYgPSBkWzBdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCksIGEucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPCBkWzFdICYmIChnID0gZFsxXSArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCksIGEucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gZFsyXSAmJiAoZiA9IGRbMl0gKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0KSwgYS5wYWdlWSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IGRbM10gJiYgKGcgPSBkWzNdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wKSksIG0uZ3JpZCAmJiAoZyA9IG0uZ3JpZFsxXSA/IHRoaXMub3JpZ2luYWxQYWdlWSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChnIC0gdGhpcy5vcmlnaW5hbFBhZ2VZKSAvIG0uZ3JpZFsxXSkgKiBtLmdyaWRbMV0gOiB0aGlzLm9yaWdpbmFsUGFnZVksIGcgPSBkID8gZyAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSBkWzFdIHx8IGcgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPiBkWzNdID8gZyA6IGcgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPj0gZFsxXSA/IGcgLSBtLmdyaWRbMV0gOiBnICsgbS5ncmlkWzFdIDogZywgZiA9IG0uZ3JpZFswXSA/IHRoaXMub3JpZ2luYWxQYWdlWCArIE1hdGgucm91bmQoKGYgLSB0aGlzLm9yaWdpbmFsUGFnZVgpIC8gbS5ncmlkWzBdKSAqIG0uZ3JpZFswXSA6IHRoaXMub3JpZ2luYWxQYWdlWCwgZiA9IGQgPyBmIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+PSBkWzBdIHx8IGYgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gZFsyXSA/IGYgOiBmIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+PSBkWzBdID8gZiAtIG0uZ3JpZFswXSA6IGYgKyBtLmdyaWRbMF0gOiBmKSwgInkiID09PSBtLmF4aXMgJiYgKGYgPSB0aGlzLm9yaWdpbmFsUGFnZVgpLCAieCIgPT09IG0uYXhpcyAmJiAoZyA9IHRoaXMub3JpZ2luYWxQYWdlWSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZyAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAtIHRoaXMub2Zmc2V0LnBhcmVudC50b3AgKyAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLm9mZnNldC5zY3JvbGwudG9wIDogaCA/IDAgOiB0aGlzLm9mZnNldC5zY3JvbGwudG9wKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZiAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0IC0gdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKyAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLm9mZnNldC5zY3JvbGwubGVmdCA6IGggPyAwIDogdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jbGVhcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXIucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyWzBdID09PSB0aGlzLmVsZW1lbnRbMF0gfHwgdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsIHx8IHRoaXMuaGVscGVyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3lPbkNsZWFyICYmIHRoaXMuZGVzdHJveSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX25vcm1hbGl6ZVJpZ2h0Qm90dG9tOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAieSIgIT09IHRoaXMub3B0aW9ucy5heGlzICYmICJhdXRvIiAhPT0gdGhpcy5oZWxwZXIuY3NzKCJyaWdodCIpICYmICh0aGlzLmhlbHBlci53aWR0aCh0aGlzLmhlbHBlci53aWR0aCgpKSwgdGhpcy5oZWxwZXIuY3NzKCJyaWdodCIsICJhdXRvIikpOwogICAgICAgICAgICAgICAgICAgICJ4IiAhPT0gdGhpcy5vcHRpb25zLmF4aXMgJiYgImF1dG8iICE9PSB0aGlzLmhlbHBlci5jc3MoImJvdHRvbSIpICYmICh0aGlzLmhlbHBlci5oZWlnaHQodGhpcy5oZWxwZXIuaGVpZ2h0KCkpLCB0aGlzLmhlbHBlci5jc3MoImJvdHRvbSIsICJhdXRvIikpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RyaWdnZXI6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICBkID0gZCB8fCB0aGlzLl91aUhhc2goKTsKICAgICAgICAgICAgICAgICAgICBhLnVpLnBsdWdpbi5jYWxsKHRoaXMsIGIsIFtjLCBkLCB0aGlzXSwgITApOwogICAgICAgICAgICAgICAgICAgIC9eKGRyYWd8c3RhcnR8c3RvcCkvLnRlc3QoYikgJiYgKHRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZC5vZmZzZXQgPSB0aGlzLnBvc2l0aW9uQWJzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcywgYiwgYywgZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7fSwKICAgICAgICAgICAgICAgIF91aUhhc2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHBlcjogdGhpcy5oZWxwZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFBvc2l0aW9uOiB0aGlzLm9yaWdpbmFsUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5wb3NpdGlvbkFicwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgImNvbm5lY3RUb1NvcnRhYmxlIiwgewogICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuZXh0ZW5kKHt9LCBjLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGQuZWxlbWVudAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGQuc29ydGFibGVzID0gW107CiAgICAgICAgICAgICAgICAgICAgYShkLm9wdGlvbnMuY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKS5zb3J0YWJsZSgiaW5zdGFuY2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiAhYy5vcHRpb25zLmRpc2FibGVkICYmIChkLnNvcnRhYmxlcy5wdXNoKGMpLCBjLnJlZnJlc2hQb3NpdGlvbnMoKSwgYy5fdHJpZ2dlcigiYWN0aXZhdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiwgZykpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBhLmV4dGVuZCh7fSwgYywgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBkLmVsZW1lbnQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBkLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMTsKICAgICAgICAgICAgICAgICAgICBhLmVhY2goZC5zb3J0YWJsZXMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3ZlciA/ICh0aGlzLmlzT3ZlciA9IDAsIGQuY2FuY2VsSGVscGVyUmVtb3ZhbCA9ICEwLCB0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMSwgdGhpcy5fc3RvcmVkQ1NTID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHRoaXMucGxhY2Vob2xkZXIuY3NzKCJwb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLnBsYWNlaG9sZGVyLmNzcygidG9wIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB0aGlzLnBsYWNlaG9sZGVyLmNzcygibGVmdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuX21vdXNlU3RvcChiKSwgdGhpcy5vcHRpb25zLmhlbHBlciA9IHRoaXMub3B0aW9ucy5faGVscGVyKSA6ICh0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwgPSAhMCwgdGhpcy5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIGIsIGcpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZHJhZzogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIGEuZWFjaChkLnNvcnRhYmxlcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgZi5wb3NpdGlvbkFicyA9IGQucG9zaXRpb25BYnM7CiAgICAgICAgICAgICAgICAgICAgICAgIGYuaGVscGVyUHJvcG9ydGlvbnMgPSBkLmhlbHBlclByb3BvcnRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICBmLm9mZnNldC5jbGljayA9IGQub2Zmc2V0LmNsaWNrOwogICAgICAgICAgICAgICAgICAgICAgICBmLl9pbnRlcnNlY3RzV2l0aChmLmNvbnRhaW5lckNhY2hlKSAmJiAoZyA9ICEwLCBhLmVhY2goZC5zb3J0YWJsZXMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkFicyA9IGQucG9zaXRpb25BYnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlclByb3BvcnRpb25zID0gZC5oZWxwZXJQcm9wb3J0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0LmNsaWNrID0gZC5vZmZzZXQuY2xpY2s7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzICE9PSBmICYmIHRoaXMuX2ludGVyc2VjdHNXaXRoKHRoaXMuY29udGFpbmVyQ2FjaGUpICYmIGEuY29udGFpbnMoZi5lbGVtZW50WzBdLCB0aGlzLmVsZW1lbnRbMF0pICYmIChnID0gITEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBnID8gKGYuaXNPdmVyIHx8IChmLmlzT3ZlciA9IDEsIGQuX3BhcmVudCA9IGMuaGVscGVyLnBhcmVudCgpLCBmLmN1cnJlbnRJdGVtID0gYy5oZWxwZXIuYXBwZW5kVG8oZi5lbGVtZW50KS5kYXRhKCJ1aS1zb3J0YWJsZS1pdGVtIiwgITApLCBmLm9wdGlvbnMuX2hlbHBlciA9IGYub3B0aW9ucy5oZWxwZXIsIGYub3B0aW9ucy5oZWxwZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5oZWxwZXJbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGIudGFyZ2V0ID0gZi5jdXJyZW50SXRlbVswXSwgZi5fbW91c2VDYXB0dXJlKGIsICEwKSwgZi5fbW91c2VTdGFydChiLCAhMCwgITApLCBmLm9mZnNldC5jbGljay50b3AgPSBkLm9mZnNldC5jbGljay50b3AsIGYub2Zmc2V0LmNsaWNrLmxlZnQgPSBkLm9mZnNldC5jbGljay5sZWZ0LCBmLm9mZnNldC5wYXJlbnQubGVmdCAtPSBkLm9mZnNldC5wYXJlbnQubGVmdCAtIGYub2Zmc2V0LnBhcmVudC5sZWZ0LCBmLm9mZnNldC5wYXJlbnQudG9wIC09IGQub2Zmc2V0LnBhcmVudC50b3AgLSBmLm9mZnNldC5wYXJlbnQudG9wLCBkLl90cmlnZ2VyKCJ0b1NvcnRhYmxlIiwgYiksIGQuZHJvcHBlZCA9IGYuZWxlbWVudCwgYS5lYWNoKGQuc29ydGFibGVzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGQuY3VycmVudEl0ZW0gPSBkLmVsZW1lbnQsIGYuZnJvbU91dHNpZGUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCksIGYuY3VycmVudEl0ZW0gJiYgKGYuX21vdXNlRHJhZyhiKSwgYy5wb3NpdGlvbiA9IGYucG9zaXRpb24pKSA6IGYuaXNPdmVyICYmIChmLmlzT3ZlciA9IDAsIGYuY2FuY2VsSGVscGVyUmVtb3ZhbCA9ICEwLCBmLm9wdGlvbnMuX3JldmVydCA9IGYub3B0aW9ucy5yZXZlcnQsIGYub3B0aW9ucy5yZXZlcnQgPSAhMSwgZi5fdHJpZ2dlcigib3V0IiwgYiwgZi5fdWlIYXNoKGYpKSwgZi5fbW91c2VTdG9wKGIsICEwKSwgZi5vcHRpb25zLnJldmVydCA9IGYub3B0aW9ucy5fcmV2ZXJ0LCBmLm9wdGlvbnMuaGVscGVyID0gZi5vcHRpb25zLl9oZWxwZXIsIGYucGxhY2Vob2xkZXIgJiYgZi5wbGFjZWhvbGRlci5yZW1vdmUoKSwgYy5oZWxwZXIuYXBwZW5kVG8oZC5fcGFyZW50KSwgZC5fcmVmcmVzaE9mZnNldHMoYiksIGMucG9zaXRpb24gPSBkLl9nZW5lcmF0ZVBvc2l0aW9uKGIsICEwKSwgZC5fdHJpZ2dlcigiZnJvbVNvcnRhYmxlIiwgYiksIGQuZHJvcHBlZCA9ICExLCBhLmVhY2goZC5zb3J0YWJsZXMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoUG9zaXRpb25zKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgImN1cnNvciIsIHsKICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoImJvZHkiKTsKICAgICAgICAgICAgICAgICAgICBkID0gZC5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIGIuY3NzKCJjdXJzb3IiKSAmJiAoZC5fY3Vyc29yID0gYi5jc3MoImN1cnNvciIpKTsKICAgICAgICAgICAgICAgICAgICBiLmNzcygiY3Vyc29yIiwgZC5jdXJzb3IpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIGIgPSBkLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgYi5fY3Vyc29yICYmIGEoImJvZHkiKS5jc3MoImN1cnNvciIsIGIuX2N1cnNvcikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgIm9wYWNpdHkiLCB7CiAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIGIgPSBhKGMuaGVscGVyKTsKICAgICAgICAgICAgICAgICAgICBkID0gZC5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIGIuY3NzKCJvcGFjaXR5IikgJiYgKGQuX29wYWNpdHkgPSBiLmNzcygib3BhY2l0eSIpKTsKICAgICAgICAgICAgICAgICAgICBiLmNzcygib3BhY2l0eSIsIGQub3BhY2l0eSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGQub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBiLl9vcGFjaXR5ICYmIGEoYy5oZWxwZXIpLmNzcygib3BhY2l0eSIsIGIuX29wYWNpdHkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsCiAgICAgICAgICAgICAgICAic2Nyb2xsIiwgewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc2Nyb2xsUGFyZW50Tm90SGlkZGVuIHx8IChkLnNjcm9sbFBhcmVudE5vdEhpZGRlbiA9IGQuaGVscGVyLnNjcm9sbFBhcmVudCghMSkpOwogICAgICAgICAgICAgICAgICAgICAgICBkLnNjcm9sbFBhcmVudE5vdEhpZGRlblswXSAhPT0gZC5kb2N1bWVudFswXSAmJiAiSFRNTCIgIT09IGQuc2Nyb2xsUGFyZW50Tm90SGlkZGVuWzBdLnRhZ05hbWUgJiYgKGQub3ZlcmZsb3dPZmZzZXQgPSBkLnNjcm9sbFBhcmVudE5vdEhpZGRlbi5vZmZzZXQoKSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGQub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBkLnNjcm9sbFBhcmVudE5vdEhpZGRlblswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBkLmRvY3VtZW50WzBdOwogICAgICAgICAgICAgICAgICAgICAgICBmICE9PSBtICYmICJIVE1MIiAhPT0gZi50YWdOYW1lID8gKGMuYXhpcyAmJiAieCIgPT09IGMuYXhpcyB8fCAoZC5vdmVyZmxvd09mZnNldC50b3AgKyBmLm9mZnNldEhlaWdodCAtIGIucGFnZVkgPCBjLnNjcm9sbFNlbnNpdGl2aXR5ID8gZi5zY3JvbGxUb3AgPSBnID0gZi5zY3JvbGxUb3AgKyBjLnNjcm9sbFNwZWVkIDogYi5wYWdlWSAtIGQub3ZlcmZsb3dPZmZzZXQudG9wIDwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKGYuc2Nyb2xsVG9wID0gZyA9IGYuc2Nyb2xsVG9wIC0gYy5zY3JvbGxTcGVlZCkpLCBjLmF4aXMgJiYgInkiID09PSBjLmF4aXMgfHwgKGQub3ZlcmZsb3dPZmZzZXQubGVmdCArIGYub2Zmc2V0V2lkdGggLSBiLnBhZ2VYIDwgYy5zY3JvbGxTZW5zaXRpdml0eSA/IGYuc2Nyb2xsTGVmdCA9IGcgPSBmLnNjcm9sbExlZnQgKyBjLnNjcm9sbFNwZWVkIDogYi5wYWdlWCAtIGQub3ZlcmZsb3dPZmZzZXQubGVmdCA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKGYuc2Nyb2xsTGVmdCA9IGcgPSBmLnNjcm9sbExlZnQgLSBjLnNjcm9sbFNwZWVkKSkpIDogKGMuYXhpcyAmJiAieCIgPT09IGMuYXhpcyB8fCAoYi5wYWdlWSAtIGEobSkuc2Nyb2xsVG9wKCkgPCBjLnNjcm9sbFNlbnNpdGl2aXR5ID8gZyA9IGEobSkuc2Nyb2xsVG9wKGEobSkuc2Nyb2xsVG9wKCkgLSBjLnNjcm9sbFNwZWVkKSA6IGEod2luZG93KS5oZWlnaHQoKSAtIChiLnBhZ2VZIC0gYShtKS5zY3JvbGxUb3AoKSkgPCBjLnNjcm9sbFNlbnNpdGl2aXR5ICYmIChnID0gYShtKS5zY3JvbGxUb3AoYShtKS5zY3JvbGxUb3AoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnNjcm9sbFNwZWVkKSkpLCBjLmF4aXMgJiYgInkiID09PSBjLmF4aXMgfHwgKGIucGFnZVggLSBhKG0pLnNjcm9sbExlZnQoKSA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgPyBnID0gYShtKS5zY3JvbGxMZWZ0KGEobSkuc2Nyb2xsTGVmdCgpIC0gYy5zY3JvbGxTcGVlZCkgOiBhKHdpbmRvdykud2lkdGgoKSAtIChiLnBhZ2VYIC0gYShtKS5zY3JvbGxMZWZ0KCkpIDwgYy5zY3JvbGxTZW5zaXRpdml0eSAmJiAoZyA9IGEobSkuc2Nyb2xsTGVmdChhKG0pLnNjcm9sbExlZnQoKSArIGMuc2Nyb2xsU3BlZWQpKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAhMSAhPT0gZyAmJiBhLnVpLmRkbWFuYWdlciAmJiAhYy5kcm9wQmVoYXZpb3VyICYmIGEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGQsIGIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInNuYXAiLCB7CiAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIGIgPSBkLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZC5zbmFwRWxlbWVudHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBhKGIuc25hcC5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nID8gYi5zbmFwLml0ZW1zIHx8ICI6ZGF0YSh1aS1kcmFnZ2FibGUpIiA6IGIuc25hcCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLm9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzICE9PSBkLmVsZW1lbnRbMF0gJiYgZC5zbmFwRWxlbWVudHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIub3V0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBiLm91dGVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGMudG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYy5sZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkcmFnOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcsIGYsIG0sIGgsIGssIGwsIGUsIG4sIHAsIHIsIHEgPSBkLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBxLnNuYXBUb2xlcmFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHogPSBjLm9mZnNldC5sZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICB5ID0geiArIGQuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBjLm9mZnNldC50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIEMgPSB2ICsgZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZm9yIChwID0gZC5zbmFwRWxlbWVudHMubGVuZ3RoIC0gMTsgMCA8PSBwOyBwLS0pIGsgPSBkLnNuYXBFbGVtZW50c1twXS5sZWZ0IC0gZC5tYXJnaW5zLmxlZnQsIGwgPSBrICsgZC5zbmFwRWxlbWVudHNbcF0ud2lkdGgsIGUgPSBkLnNuYXBFbGVtZW50c1twXS50b3AgLSBkLm1hcmdpbnMudG9wLCBuID0gZSArIGQuc25hcEVsZW1lbnRzW3BdLmhlaWdodCwgeSA8IGsgLSB1IHx8IHogPiBsICsgdSB8fCBDIDwKICAgICAgICAgICAgICAgICAgICAgICAgZSAtIHUgfHwgdiA+IG4gKyB1IHx8ICFhLmNvbnRhaW5zKGQuc25hcEVsZW1lbnRzW3BdLml0ZW0ub3duZXJEb2N1bWVudCwgZC5zbmFwRWxlbWVudHNbcF0uaXRlbSkgPyAoZC5zbmFwRWxlbWVudHNbcF0uc25hcHBpbmcgJiYgZC5vcHRpb25zLnNuYXAucmVsZWFzZSAmJiBkLm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoZC5lbGVtZW50LCBiLCBhLmV4dGVuZChkLl91aUhhc2goKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc25hcEl0ZW06IGQuc25hcEVsZW1lbnRzW3BdLml0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCBkLnNuYXBFbGVtZW50c1twXS5zbmFwcGluZyA9ICExKSA6ICgiaW5uZXIiICE9PSBxLnNuYXBNb2RlICYmIChnID0gTWF0aC5hYnMoZSAtIEMpIDw9IHUsIGYgPSBNYXRoLmFicyhuIC0gdikgPD0gdSwgbSA9IE1hdGguYWJzKGsgLSB5KSA8PSB1LCBoID0gTWF0aC5hYnMobCAtIHopIDw9IHUsIGcgJiYgKGMucG9zaXRpb24udG9wID0gZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBlIC0gZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRvcCksIGYgJiYgKGMucG9zaXRpb24udG9wID0gZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgICAgICB9KS50b3ApLCBtICYmIChjLnBvc2l0aW9uLmxlZnQgPSBkLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBrIC0gZC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aAogICAgICAgICAgICAgICAgICAgICAgICB9KS5sZWZ0KSwgaCAmJiAoYy5wb3NpdGlvbi5sZWZ0ID0gZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbAogICAgICAgICAgICAgICAgICAgICAgICB9KS5sZWZ0KSksIHIgPSBnIHx8IGYgfHwgbSB8fCBoLCAib3V0ZXIiICE9PSBxLnNuYXBNb2RlICYmIChnID0gTWF0aC5hYnMoZSAtIHYpIDw9IHUsIGYgPSBNYXRoLmFicyhuIC0gQykgPD0gdSwgbSA9IE1hdGguYWJzKGsgLSB6KSA8PSB1LCBoID0gTWF0aC5hYnMobCAtIHkpIDw9IHUsIGcgJiYgKGMucG9zaXRpb24udG9wID0gZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgICAgICB9KS50b3ApLCBmICYmIChjLnBvc2l0aW9uLnRvcCA9IGQuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogbiAtIGQuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgICAgICB9KS50b3ApLCBtICYmIChjLnBvc2l0aW9uLmxlZnQgPSBkLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBrCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmxlZnQpLCBoICYmIChjLnBvc2l0aW9uLmxlZnQgPSBkLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBsIC0gZC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aAogICAgICAgICAgICAgICAgICAgICAgICB9KS5sZWZ0KSksICFkLnNuYXBFbGVtZW50c1twXS5zbmFwcGluZyAmJiAoZyB8fCBmIHx8IG0gfHwgaCB8fCByKSAmJiBkLm9wdGlvbnMuc25hcC5zbmFwICYmIGQub3B0aW9ucy5zbmFwLnNuYXAuY2FsbChkLmVsZW1lbnQsIGIsIGEuZXh0ZW5kKGQuX3VpSGFzaCgpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbmFwSXRlbTogZC5zbmFwRWxlbWVudHNbcF0uaXRlbQogICAgICAgICAgICAgICAgICAgICAgICB9KSksIGQuc25hcEVsZW1lbnRzW3BdLnNuYXBwaW5nID0gZyB8fCBmIHx8IG0gfHwgaCB8fCByKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic3RhY2siLCB7CiAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBnOwogICAgICAgICAgICAgICAgICAgIGIgPSBhLm1ha2VBcnJheShhKGQub3B0aW9ucy5zdGFjaykpLnNvcnQoZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KGEoYikuY3NzKCJ6SW5kZXgiKSwgMTApIHx8IDApIC0gKHBhcnNlSW50KGEoYykuY3NzKCJ6SW5kZXgiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwKSB8fCAwKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGIubGVuZ3RoICYmIChnID0gcGFyc2VJbnQoYShiWzBdKS5jc3MoInpJbmRleCIpLCAxMCkgfHwgMCwgYShiKS5lYWNoKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5jc3MoInpJbmRleCIsIGcgKyBiKQogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmNzcygiekluZGV4IiwgZyArIGIubGVuZ3RoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgInpJbmRleCIsIHsKICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoYy5oZWxwZXIpOwogICAgICAgICAgICAgICAgICAgIGQgPSBkLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgYi5jc3MoInpJbmRleCIpICYmIChkLl96SW5kZXggPSBiLmNzcygiekluZGV4IikpOwogICAgICAgICAgICAgICAgICAgIGIuY3NzKCJ6SW5kZXgiLCBkLnpJbmRleCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGQub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBiLl96SW5kZXggJiYgYShjLmhlbHBlcikuY3NzKCJ6SW5kZXgiLCBiLl96SW5kZXgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkucmVzaXphYmxlIiwgYS51aS5tb3VzZSwgewogICAgICAgICAgICAgICAgdmVyc2lvbjogIjEuMTEuNCIsCiAgICAgICAgICAgICAgICB3aWRnZXRFdmVudFByZWZpeDogInJlc2l6ZSIsCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgYWxzb1Jlc2l6ZTogITEsCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZTogITEsCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZUR1cmF0aW9uOiAic2xvdyIsCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZUVhc2luZzogInN3aW5nIiwKICAgICAgICAgICAgICAgICAgICBhc3BlY3RSYXRpbzogITEsCiAgICAgICAgICAgICAgICAgICAgYXV0b0hpZGU6ICExLAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiAhMSwKICAgICAgICAgICAgICAgICAgICBnaG9zdDogITEsCiAgICAgICAgICAgICAgICAgICAgZ3JpZDogITEsCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlczogImUscyxzZSIsCiAgICAgICAgICAgICAgICAgICAgaGVscGVyOiAhMSwKICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAxMCwKICAgICAgICAgICAgICAgICAgICBtaW5XaWR0aDogMTAsCiAgICAgICAgICAgICAgICAgICAgekluZGV4OiA5MCwKICAgICAgICAgICAgICAgICAgICByZXNpemU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RvcDogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9udW06IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoYSwgMTApIHx8IDAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaXNOdW1iZXI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWlzTmFOKHBhcnNlSW50KGEsIDEwKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaGFzU2Nyb2xsOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJoaWRkZW4iID09PSBhKGIpLmNzcygib3ZlcmZsb3ciKSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIHZhciBkID0gYyAmJiAibGVmdCIgPT09IGMgPyAic2Nyb2xsTGVmdCIgOiAic2Nyb2xsVG9wIiwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICExOwogICAgICAgICAgICAgICAgICAgIGlmICgwIDwgYltkXSkgcmV0dXJuICEwOwogICAgICAgICAgICAgICAgICAgIGJbZF0gPSAxOwogICAgICAgICAgICAgICAgICAgIGcgPSAwIDwgYltkXTsKICAgICAgICAgICAgICAgICAgICBiW2RdID0gMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBjLCBkLAogICAgICAgICAgICAgICAgICAgICAgICBnLCBmLCBtID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXJlc2l6YWJsZSIpOwogICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2FzcGVjdFJhdGlvOiAhIWguYXNwZWN0UmF0aW8sCiAgICAgICAgICAgICAgICAgICAgICAgIGFzcGVjdFJhdGlvOiBoLmFzcGVjdFJhdGlvLAogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEVsZW1lbnQ6IHRoaXMuZWxlbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBfaGVscGVyOiBoLmhlbHBlciB8fCBoLmdob3N0IHx8IGguYW5pbWF0ZSA/IGguaGVscGVyIHx8ICJ1aS1yZXNpemFibGUtaGVscGVyIiA6IG51bGwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRbMF0ubm9kZU5hbWUubWF0Y2goL14oY2FudmFzfHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b258aW1nKSQvaSkgJiYgKHRoaXMuZWxlbWVudC53cmFwKGEoIjxkaXYgY2xhc3M9J3VpLXdyYXBwZXInIHN0eWxlPSdvdmVyZmxvdzogaGlkZGVuOyc+PC9kaXY+IikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB0aGlzLmVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLmVsZW1lbnQuY3NzKCJ0b3AiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuZWxlbWVudC5jc3MoImxlZnQiKQogICAgICAgICAgICAgICAgICAgICAgICB9KSksIHRoaXMuZWxlbWVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKCJ1aS1yZXNpemFibGUiLCB0aGlzLmVsZW1lbnQucmVzaXphYmxlKCJpbnN0YW5jZSIpKSwgdGhpcy5lbGVtZW50SXNXcmFwcGVyID0gITAsIHRoaXMuZWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5MZWZ0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luVG9wIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUgPSB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIpLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIsICJub25lIiksIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMucHVzaCh0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJzdGF0aWMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIKICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXMgPSBoLmhhbmRsZXMgfHwgKGEoIi51aS1yZXNpemFibGUtaGFuZGxlIiwgdGhpcy5lbGVtZW50KS5sZW5ndGggPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIG46ICIudWktcmVzaXphYmxlLW4iLAogICAgICAgICAgICAgICAgICAgICAgICBlOiAiLnVpLXJlc2l6YWJsZS1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgczogIi51aS1yZXNpemFibGUtcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHc6ICIudWktcmVzaXphYmxlLXciLAogICAgICAgICAgICAgICAgICAgICAgICBzZTogIi51aS1yZXNpemFibGUtc2UiLAogICAgICAgICAgICAgICAgICAgICAgICBzdzogIi51aS1yZXNpemFibGUtc3ciLAogICAgICAgICAgICAgICAgICAgICAgICBuZTogIi51aS1yZXNpemFibGUtbmUiLAogICAgICAgICAgICAgICAgICAgICAgICBudzogIi51aS1yZXNpemFibGUtbnciCiAgICAgICAgICAgICAgICAgICAgfSA6ICJlLHMsc2UiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVzID0gYSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhbmRsZXMuY29uc3RydWN0b3IgPT09IFN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgiYWxsIiA9PT0gdGhpcy5oYW5kbGVzICYmICh0aGlzLmhhbmRsZXMgPSAibixlLHMsdyxzZSxzdyxuZSxudyIpLCBiID0gdGhpcy5oYW5kbGVzLnNwbGl0KCIsIiksIHRoaXMuaGFuZGxlcyA9IHt9LCBjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIGQgPSBhLnRyaW0oYltjXSksIGYgPSAidWktcmVzaXphYmxlLSIgKyBkLCBnID0gYSgiPGRpdiBjbGFzcz0ndWktcmVzaXphYmxlLWhhbmRsZSAiICsgZiArICInPjwvZGl2PiIpLCBnLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IGguekluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAic2UiID09PSBkICYmIGcuYWRkQ2xhc3MoInVpLWljb24gdWktaWNvbi1ncmlwc21hbGwtZGlhZ29uYWwtc2UiKSwgdGhpcy5oYW5kbGVzW2RdID0gIi51aS1yZXNpemFibGUtIiArIGQsIHRoaXMuZWxlbWVudC5hcHBlbmQoZyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQXhpcyA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLCBmOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gYiB8fCB0aGlzLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiB0aGlzLmhhbmRsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhbmRsZXNbY10uY29uc3RydWN0b3IgPT09IFN0cmluZykgdGhpcy5oYW5kbGVzW2NdID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKHRoaXMuaGFuZGxlc1tjXSkuZmlyc3QoKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmhhbmRsZXNbY10uanF1ZXJ5IHx8IHRoaXMuaGFuZGxlc1tjXS5ub2RlVHlwZSkgdGhpcy5oYW5kbGVzW2NdID0gYSh0aGlzLmhhbmRsZXNbY10pLCB0aGlzLl9vbih0aGlzLmhhbmRsZXNbY10sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZWRvd246IG0uX21vdXNlRG93bgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRJc1dyYXBwZXIgJiYgdGhpcy5vcmlnaW5hbEVsZW1lbnRbMF0ubm9kZU5hbWUubWF0Y2goL14odGV4dGFyZWF8aW5wdXR8c2VsZWN0fGJ1dHRvbikkL2kpICYmIChkID0gYSh0aGlzLmhhbmRsZXNbY10sIHRoaXMuZWxlbWVudCksIGYgPSAvc3d8bmV8bnd8c2V8bnxzLy50ZXN0KGMpID8gZC5vdXRlckhlaWdodCgpIDogZC5vdXRlcldpZHRoKCksIGQgPSBbInBhZGRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9uZXxud3xuLy50ZXN0KGMpID8gIlRvcCIgOiAvc2V8c3d8cy8udGVzdChjKSA/ICJCb3R0b20iIDogL15lJC8udGVzdChjKSA/ICJSaWdodCIgOiAiTGVmdCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbigiIiksIGIuY3NzKGQsIGYpLCB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXMgPSB0aGlzLl9oYW5kbGVzLmFkZCh0aGlzLmhhbmRsZXNbY10pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlckF4aXModGhpcy5lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVzID0gdGhpcy5faGFuZGxlcy5hZGQodGhpcy5lbGVtZW50LmZpbmQoIi51aS1yZXNpemFibGUtaGFuZGxlIikpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXMuZGlzYWJsZVNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXMubW91c2VvdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBtLnJlc2l6aW5nIHx8ICh0aGlzLmNsYXNzTmFtZSAmJiAoZyA9IHRoaXMuY2xhc3NOYW1lLm1hdGNoKC91aS1yZXNpemFibGUtKHNlfHN3fG5lfG53fG58ZXxzfHcpL2kpKSwgbS5heGlzID0gZyAmJiBnWzFdID8gZ1sxXSA6ICJzZSIpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaC5hdXRvSGlkZSAmJiAodGhpcy5faGFuZGxlcy5oaWRlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcy5lbGVtZW50KS5hZGRDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIikubW91c2VlbnRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguZGlzYWJsZWQgfHwgKGEodGhpcykucmVtb3ZlQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpLCBtLl9oYW5kbGVzLnNob3coKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguZGlzYWJsZWQgfHwgbS5yZXNpemluZyB8fCAoYSh0aGlzKS5hZGRDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIiksIG0uX2hhbmRsZXMuaGlkZSgpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VJbml0KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VEZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMgPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoYikucmVtb3ZlQ2xhc3MoInVpLXJlc2l6YWJsZSB1aS1yZXNpemFibGUtZGlzYWJsZWQgdWktcmVzaXphYmxlLXJlc2l6aW5nIikucmVtb3ZlRGF0YSgicmVzaXphYmxlIikucmVtb3ZlRGF0YSgidWktcmVzaXphYmxlIikudW5iaW5kKCIucmVzaXphYmxlIikuZmluZCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiKS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50SXNXcmFwcGVyICYmIChjKHRoaXMuZWxlbWVudCksIGIgPSB0aGlzLmVsZW1lbnQsIHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBiLmNzcygicG9zaXRpb24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIub3V0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIub3V0ZXJIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBiLmNzcygidG9wIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGIuY3NzKCJsZWZ0IikKICAgICAgICAgICAgICAgICAgICB9KS5pbnNlcnRBZnRlcihiKSwgYi5yZW1vdmUoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiLCB0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUpOwogICAgICAgICAgICAgICAgICAgIGModGhpcy5vcmlnaW5hbEVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlQ2FwdHVyZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnID0gITE7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIHRoaXMuaGFuZGxlcykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBhKHRoaXMuaGFuZGxlc1tjXSlbMF0sIGQgPT09IGIudGFyZ2V0IHx8IGEuY29udGFpbnMoZCwgYi50YXJnZXQpKSBnID0gITA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgZwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQsIGcgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemluZyA9ICEwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlclByb3h5KCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuX251bSh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSk7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX251bSh0aGlzLmhlbHBlci5jc3MoInRvcCIpKTsKICAgICAgICAgICAgICAgICAgICBnLmNvbnRhaW5tZW50ICYmIChjICs9IGEoZy5jb250YWlubWVudCkuc2Nyb2xsTGVmdCgpIHx8IDAsIGQgKz0gYShnLmNvbnRhaW5tZW50KS5zY3JvbGxUb3AoKSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHRoaXMuaGVscGVyLm9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplID0gdGhpcy5faGVscGVyID8gewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5oZWxwZXIud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlbHBlci5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmLndpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZi5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFNpemUgPSB0aGlzLl9oZWxwZXIgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmLm91dGVyV2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBmLm91dGVySGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZi53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGYuaGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZURpZmYgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmLm91dGVyV2lkdGgoKSAtIGYud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBmLm91dGVySGVpZ2h0KCkgLSBmLmhlaWdodCgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsUG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE1vdXNlUG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGIucGFnZVgsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYi5wYWdlWQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hc3BlY3RSYXRpbyA9ICJudW1iZXIiID09PSB0eXBlb2YgZy5hc3BlY3RSYXRpbyA/IGcuYXNwZWN0UmF0aW8gOiB0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCAvIHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCB8fCAxOwogICAgICAgICAgICAgICAgICAgIGMgPSBhKCIudWktcmVzaXphYmxlLSIgKyB0aGlzLmF4aXMpLmNzcygiY3Vyc29yIik7CiAgICAgICAgICAgICAgICAgICAgYSgiYm9keSIpLmNzcygiY3Vyc29yIiwgImF1dG8iID09PSBjID8gdGhpcy5heGlzICsgIi1yZXNpemUiIDogYyk7CiAgICAgICAgICAgICAgICAgICAgZi5hZGRDbGFzcygidWktcmVzaXphYmxlLXJlc2l6aW5nIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGFnYXRlKCJzdGFydCIsIGIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZURyYWc6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIGMgPSBiLnBhZ2VYIC0gZC5sZWZ0IHx8IDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBiLnBhZ2VZIC0gZC50b3AgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuX2NoYW5nZVt0aGlzLmF4aXNdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVByZXZQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFnKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgYyA9IGcuYXBwbHkodGhpcywgW2IsIGMsIGRdKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVWaXJ0dWFsQm91bmRhcmllcyhiLnNoaWZ0S2V5KTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXNwZWN0UmF0aW8gfHwgYi5zaGlmdEtleSkgYyA9IHRoaXMuX3VwZGF0ZVJhdGlvKGMsIGIpOwogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9yZXNwZWN0U2l6ZShjLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVDYWNoZShjKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wYWdhdGUoInJlc2l6ZSIsIGIpOwogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9hcHBseUNoYW5nZXMoKTsKICAgICAgICAgICAgICAgICAgICAhdGhpcy5faGVscGVyICYmIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoICYmIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCk7CiAgICAgICAgICAgICAgICAgICAgYS5pc0VtcHR5T2JqZWN0KGMpIHx8ICh0aGlzLl91cGRhdGVQcmV2UHJvcGVydGllcygpLCB0aGlzLl90cmlnZ2VyKCJyZXNpemUiLAogICAgICAgICAgICAgICAgICAgICAgICBiLCB0aGlzLnVpKCkpLCB0aGlzLl9hcHBseUNoYW5nZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RvcDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzaXppbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgZywgZiA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oZWxwZXIgJiYgKGMgPSB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLCBjID0gKGQgPSBjLmxlbmd0aCAmJiAvdGV4dGFyZWEvaS50ZXN0KGNbMF0ubm9kZU5hbWUpKSAmJiB0aGlzLl9oYXNTY3JvbGwoY1swXSwgImxlZnQiKSA/IDAgOiB0aGlzLnNpemVEaWZmLmhlaWdodCwgZCA9IGQgPyAwIDogdGhpcy5zaXplRGlmZi53aWR0aCwgZCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuaGVscGVyLndpZHRoKCkgLSBkLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVscGVyLmhlaWdodCgpIC0gYwogICAgICAgICAgICAgICAgICAgIH0sIGMgPSBwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJsZWZ0IiksIDEwKSArICh0aGlzLnBvc2l0aW9uLmxlZnQgLSB0aGlzLm9yaWdpbmFsUG9zaXRpb24ubGVmdCkgfHwgbnVsbCwgZyA9IHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoInRvcCIpLCAxMCkgKyAodGhpcy5wb3NpdGlvbi50b3AgLQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsUG9zaXRpb24udG9wKSB8fCBudWxsLCBmLmFuaW1hdGUgfHwgdGhpcy5lbGVtZW50LmNzcyhhLmV4dGVuZChkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZywKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYwogICAgICAgICAgICAgICAgICAgIH0pKSwgdGhpcy5oZWxwZXIuaGVpZ2h0KHRoaXMuc2l6ZS5oZWlnaHQpLCB0aGlzLmhlbHBlci53aWR0aCh0aGlzLnNpemUud2lkdGgpLCB0aGlzLl9oZWxwZXIgJiYgIWYuYW5pbWF0ZSAmJiB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBhKCJib2R5IikuY3NzKCJjdXJzb3IiLCAiYXV0byIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLXJlc2l6aW5nIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGFnYXRlKCJzdG9wIiwgYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGVscGVyICYmIHRoaXMuaGVscGVyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF91cGRhdGVQcmV2UHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2UG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5wb3NpdGlvbi50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMucG9zaXRpb24ubGVmdAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2U2l6ZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuc2l6ZS53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLnNpemUuaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9hcHBseUNoYW5nZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0ge307CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbi50b3AgIT09IHRoaXMucHJldlBvc2l0aW9uLnRvcCAmJiAoYS50b3AgPSB0aGlzLnBvc2l0aW9uLnRvcCArICJweCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24ubGVmdCAhPT0gdGhpcy5wcmV2UG9zaXRpb24ubGVmdCAmJiAoYS5sZWZ0ID0gdGhpcy5wb3NpdGlvbi5sZWZ0ICsgInB4Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplLndpZHRoICE9PSB0aGlzLnByZXZTaXplLndpZHRoICYmIChhLndpZHRoID0gdGhpcy5zaXplLndpZHRoICsgInB4Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplLmhlaWdodCAhPT0gdGhpcy5wcmV2U2l6ZS5oZWlnaHQgJiYgKGEuaGVpZ2h0ID0gdGhpcy5zaXplLmhlaWdodCArICJweCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyLmNzcyhhKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF91cGRhdGVWaXJ0dWFsQm91bmRhcmllczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBmOwogICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWluV2lkdGg6IHRoaXMuX2lzTnVtYmVyKGYubWluV2lkdGgpID8gZi5taW5XaWR0aCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiB0aGlzLl9pc051bWJlcihmLm1heFdpZHRoKSA/IGYubWF4V2lkdGggOiBJbmZpbml0eSwKICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiB0aGlzLl9pc051bWJlcihmLm1pbkhlaWdodCkgPyBmLm1pbkhlaWdodCA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogdGhpcy5faXNOdW1iZXIoZi5tYXhIZWlnaHQpID8gZi5tYXhIZWlnaHQgOiBJbmZpbml0eQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FzcGVjdFJhdGlvIHx8IGEpIGEgPSBmLm1pbkhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW8sIGQgPSBmLm1pbldpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbywgYyA9IGYubWF4SGVpZ2h0ICogdGhpcy5hc3BlY3RSYXRpbywgZyA9IGYubWF4V2lkdGggLyB0aGlzLmFzcGVjdFJhdGlvLCBhID4gZi5taW5XaWR0aCAmJiAoZi5taW5XaWR0aCA9IGEpLCBkID4gZi5taW5IZWlnaHQgJiYgKGYubWluSGVpZ2h0ID0gZCksIGMgPCBmLm1heFdpZHRoICYmIChmLm1heFdpZHRoID0gYyksIGcgPCBmLm1heEhlaWdodCAmJiAoZi5tYXhIZWlnaHQgPSBnKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl92Qm91bmRhcmllcyA9IGYKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdXBkYXRlQ2FjaGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHRoaXMuaGVscGVyLm9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTnVtYmVyKGEubGVmdCkgJiYgKHRoaXMucG9zaXRpb24ubGVmdCA9IGEubGVmdCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNOdW1iZXIoYS50b3ApICYmICh0aGlzLnBvc2l0aW9uLnRvcCA9IGEudG9wKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc051bWJlcihhLmhlaWdodCkgJiYgKHRoaXMuc2l6ZS5oZWlnaHQgPSBhLmhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNOdW1iZXIoYS53aWR0aCkgJiYgKHRoaXMuc2l6ZS53aWR0aCA9IGEud2lkdGgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3VwZGF0ZVJhdGlvOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5zaXplLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5heGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTnVtYmVyKGEuaGVpZ2h0KSA/IGEud2lkdGggPSBhLmhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW8gOiB0aGlzLl9pc051bWJlcihhLndpZHRoKSAmJiAoYS5oZWlnaHQgPSBhLndpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbyk7CiAgICAgICAgICAgICAgICAgICAgInN3IiA9PT0gZyAmJiAoYS5sZWZ0ID0gYy5sZWZ0ICsgKGQud2lkdGggLSBhLndpZHRoKSwgYS50b3AgPSBudWxsKTsKICAgICAgICAgICAgICAgICAgICAibnciID09PSBnICYmIChhLnRvcCA9IGMudG9wICsgKGQuaGVpZ2h0IC0gYS5oZWlnaHQpLCBhLmxlZnQgPQogICAgICAgICAgICAgICAgICAgICAgICBjLmxlZnQgKyAoZC53aWR0aCAtIGEud2lkdGgpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZXNwZWN0U2l6ZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fdkJvdW5kYXJpZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmF4aXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLl9pc051bWJlcihhLndpZHRoKSAmJiBjLm1heFdpZHRoICYmIGMubWF4V2lkdGggPCBhLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy5faXNOdW1iZXIoYS5oZWlnaHQpICYmIGMubWF4SGVpZ2h0ICYmIGMubWF4SGVpZ2h0IDwgYS5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSB0aGlzLl9pc051bWJlcihhLndpZHRoKSAmJiBjLm1pbldpZHRoICYmIGMubWluV2lkdGggPiBhLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5faXNOdW1iZXIoYS5oZWlnaHQpICYmIGMubWluSGVpZ2h0ICYmIGMubWluSGVpZ2h0ID4gYS5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB0aGlzLm9yaWdpbmFsUG9zaXRpb24ubGVmdCArIHRoaXMub3JpZ2luYWxTaXplLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5wb3NpdGlvbi50b3AgKyB0aGlzLnNpemUuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBlID0gL3N3fG53fHcvLnRlc3QoZCksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAvbnd8bmV8bi8udGVzdChkKTsKICAgICAgICAgICAgICAgICAgICBtICYmIChhLndpZHRoID0gYy5taW5XaWR0aCk7CiAgICAgICAgICAgICAgICAgICAgaCAmJiAoYS5oZWlnaHQgPQogICAgICAgICAgICAgICAgICAgICAgICBjLm1pbkhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgZyAmJiAoYS53aWR0aCA9IGMubWF4V2lkdGgpOwogICAgICAgICAgICAgICAgICAgIGYgJiYgKGEuaGVpZ2h0ID0gYy5tYXhIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIG0gJiYgZSAmJiAoYS5sZWZ0ID0gayAtIGMubWluV2lkdGgpOwogICAgICAgICAgICAgICAgICAgIGcgJiYgZSAmJiAoYS5sZWZ0ID0gayAtIGMubWF4V2lkdGgpOwogICAgICAgICAgICAgICAgICAgIGggJiYgZCAmJiAoYS50b3AgPSBsIC0gYy5taW5IZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGYgJiYgZCAmJiAoYS50b3AgPSBsIC0gYy5tYXhIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGEud2lkdGggfHwgYS5oZWlnaHQgfHwgYS5sZWZ0IHx8ICFhLnRvcCA/IGEud2lkdGggfHwgYS5oZWlnaHQgfHwgYS50b3AgfHwgIWEubGVmdCB8fCAoYS5sZWZ0ID0gbnVsbCkgOiBhLnRvcCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0UGFkZGluZ1BsdXNCb3JkZXJEaW1lbnNpb25zOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBbYS5jc3MoImJvcmRlclRvcFdpZHRoIiksIGEuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksIGEuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLCBhLmNzcygiYm9yZGVyTGVmdFdpZHRoIildOwogICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IFthLmNzcygicGFkZGluZ1RvcCIpLCBhLmNzcygicGFkZGluZ1JpZ2h0IiksIGEuY3NzKCJwYWRkaW5nQm90dG9tIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNzcygicGFkZGluZ0xlZnQiKQogICAgICAgICAgICAgICAgICAgICAgICBdOyA0ID4gYzsgYysrKSBkW2NdID0gcGFyc2VJbnQoZ1tjXSwgMTApIHx8IDAsIGRbY10gKz0gcGFyc2VJbnQoYVtjXSwgMTApIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkWzBdICsgZFsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGRbMV0gKyBkWzNdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9wcm9wb3J0aW9uYWxseVJlc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhLCBjID0gMCwgZCA9IHRoaXMuaGVscGVyIHx8IHRoaXMuZWxlbWVudDsgYyA8IHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoOyBjKyspIGEgPSB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzW2NdLCB0aGlzLm91dGVyRGltZW5zaW9ucyB8fCAodGhpcy5vdXRlckRpbWVuc2lvbnMgPSB0aGlzLl9nZXRQYWRkaW5nUGx1c0JvcmRlckRpbWVuc2lvbnMoYSkpLCBhLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGQuaGVpZ2h0KCkgLSB0aGlzLm91dGVyRGltZW5zaW9ucy5oZWlnaHQgfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBkLndpZHRoKCkgLSB0aGlzLm91dGVyRGltZW5zaW9ucy53aWR0aCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVuZGVyUHJveHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudE9mZnNldCA9IHRoaXMuZWxlbWVudC5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oZWxwZXIgPyAodGhpcy5oZWxwZXIgPSB0aGlzLmhlbHBlciB8fCBhKCI8ZGl2IHN0eWxlPSdvdmVyZmxvdzpoaWRkZW47Jz48L2Rpdj4iKSwgdGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKSAtIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkgLSAxLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQgKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHRoaXMuZWxlbWVudE9mZnNldC50b3AgKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6ICsrYi56SW5kZXgKICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5oZWxwZXIuYXBwZW5kVG8oImJvZHkiKS5kaXNhYmxlU2VsZWN0aW9uKCkpIDogdGhpcy5oZWxwZXIgPSB0aGlzLmVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2hhbmdlOiB7CiAgICAgICAgICAgICAgICAgICAgZTogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxTaXplLndpZHRoICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHc6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0ICsgYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCAtIGMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbjogZnVuY3Rpb24oYSwgYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLm9yaWdpbmFsUG9zaXRpb24udG9wICsgZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0IC0gZAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzOiBmdW5jdGlvbihhLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCArIGQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2U6IGZ1bmN0aW9uKGIsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFtiLCBjLCBkXSkpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzdzogZnVuY3Rpb24oYiwgYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcywgW2IsIGMsIGRdKSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG5lOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzKSwgdGhpcy5fY2hhbmdlLmUuYXBwbHkodGhpcywgW2IsIGMsIGRdKSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG53OiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLl9jaGFuZ2Uudy5hcHBseSh0aGlzLCBbYiwgYywgZF0pKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcHJvcGFnYXRlOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYS51aS5wbHVnaW4uY2FsbCh0aGlzLCBiLCBbYywgdGhpcy51aSgpXSk7CiAgICAgICAgICAgICAgICAgICAgInJlc2l6ZSIgIT09IGIgJiYgdGhpcy5fdHJpZ2dlcihiLCBjLCB0aGlzLnVpKCkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGx1Z2luczoge30sCiAgICAgICAgICAgICAgICB1aTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxFbGVtZW50OiB0aGlzLm9yaWdpbmFsRWxlbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy5lbGVtZW50LAogICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXI6IHRoaXMuaGVscGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5zaXplLAogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFNpemU6IHRoaXMub3JpZ2luYWxTaXplLAogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFBvc2l0aW9uOiB0aGlzLm9yaWdpbmFsUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsCiAgICAgICAgICAgICAgICAiYW5pbWF0ZSIsIHsKICAgICAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5vcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZy5sZW5ndGggJiYgL3RleHRhcmVhL2kudGVzdChnWzBdLm5vZGVOYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBmICYmIGMuX2hhc1Njcm9sbChnWzBdLCAibGVmdCIpID8gMCA6IGMuc2l6ZURpZmYuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYy5zaXplLndpZHRoIC0gKGYgPyAwIDogYy5zaXplRGlmZi53aWR0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBjLnNpemUuaGVpZ2h0IC0gbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBwYXJzZUludChjLmVsZW1lbnQuY3NzKCJsZWZ0IiksIDEwKSArIChjLnBvc2l0aW9uLmxlZnQgLSBjLm9yaWdpbmFsUG9zaXRpb24ubGVmdCkgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBwYXJzZUludChjLmVsZW1lbnQuY3NzKCJ0b3AiKSwgMTApICsgKGMucG9zaXRpb24udG9wIC0gYy5vcmlnaW5hbFBvc2l0aW9uLnRvcCkgfHwgbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgYy5lbGVtZW50LmFuaW1hdGUoYS5leHRlbmQoZiwgaCAmJiBtID8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30pLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZC5hbmltYXRlRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYXNpbmc6IGQuYW5pbWF0ZUVhc2luZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogcGFyc2VJbnQoYy5lbGVtZW50LmNzcygid2lkdGgiKSwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHBhcnNlSW50KGMuZWxlbWVudC5jc3MoImhlaWdodCIpLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogcGFyc2VJbnQoYy5lbGVtZW50LmNzcygidG9wIiksIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcGFyc2VJbnQoYy5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgJiYgZy5sZW5ndGggJiYgYShnWzBdKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZC53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkLmhlaWdodAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuX3VwZGF0ZUNhY2hlKGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuX3Byb3BhZ2F0ZSgicmVzaXplIiwgYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCAiY29udGFpbm1lbnQiLCB7CiAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMsIGQsIGcsIGYsIG0gPSBhKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IG0uZWxlbWVudDsKICAgICAgICAgICAgICAgICAgICBkID0gbS5vcHRpb25zLmNvbnRhaW5tZW50OwogICAgICAgICAgICAgICAgICAgIGlmIChoID0gZCBpbnN0YW5jZW9mIGEgPyBkLmdldCgwKSA6IC9wYXJlbnQvLnRlc3QoZCkgPwogICAgICAgICAgICAgICAgICAgICAgICBoLnBhcmVudCgpLmdldCgwKSA6IGQpIG0uY29udGFpbmVyRWxlbWVudCA9IGEoaCksIC9kb2N1bWVudC8udGVzdChkKSB8fCBkID09PSBkb2N1bWVudCA/IChtLmNvbnRhaW5lck9mZnNldCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwCiAgICAgICAgICAgICAgICAgICAgfSwgbS5jb250YWluZXJQb3NpdGlvbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwCiAgICAgICAgICAgICAgICAgICAgfSwgbS5wYXJlbnREYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBhKGRvY3VtZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYShkb2N1bWVudCkud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhKGRvY3VtZW50KS5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgfSkgOiAoYiA9IGEoaCksIGMgPSBbXSwgYShbIlRvcCIsICJSaWdodCIsICJMZWZ0IiwgIkJvdHRvbSJdKS5lYWNoKGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY1thXSA9IG0uX251bShiLmNzcygicGFkZGluZyIgKyBkKSkKICAgICAgICAgICAgICAgICAgICB9KSwgbS5jb250YWluZXJPZmZzZXQgPSBiLm9mZnNldCgpLCBtLmNvbnRhaW5lclBvc2l0aW9uID0gYi5wb3NpdGlvbigpLCBtLmNvbnRhaW5lclNpemUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYi5pbm5lckhlaWdodCgpIC0gY1szXSwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIuaW5uZXJXaWR0aCgpIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbMV0KICAgICAgICAgICAgICAgICAgICB9LCBkID0gbS5jb250YWluZXJPZmZzZXQsIGcgPSBtLmNvbnRhaW5lclNpemUuaGVpZ2h0LCBmID0gbS5jb250YWluZXJTaXplLndpZHRoLCBmID0gbS5faGFzU2Nyb2xsKGgsICJsZWZ0IikgPyBoLnNjcm9sbFdpZHRoIDogZiwgZyA9IG0uX2hhc1Njcm9sbChoKSA/IGguc2Nyb2xsSGVpZ2h0IDogZywgbS5wYXJlbnREYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBoLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBkLmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZC50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGcKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBmID0gYSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIik7CiAgICAgICAgICAgICAgICAgICAgYyA9IGYub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBkID0gZi5jb250YWluZXJPZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgZyA9IGYucG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgYiA9IGYuX2FzcGVjdFJhdGlvIHx8IGIuc2hpZnRLZXk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBmLmNvbnRhaW5lckVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAhMDsKICAgICAgICAgICAgICAgICAgICBoWzBdICE9PSBkb2N1bWVudCAmJiAvc3RhdGljLy50ZXN0KGguY3NzKCJwb3NpdGlvbiIpKSAmJiAobSA9IGQpOwogICAgICAgICAgICAgICAgICAgIGcubGVmdCA8IChmLl9oZWxwZXIgPyBkLmxlZnQgOiAwKSAmJiAoZi5zaXplLndpZHRoICs9IGYuX2hlbHBlciA/CiAgICAgICAgICAgICAgICAgICAgICAgIGYucG9zaXRpb24ubGVmdCAtIGQubGVmdCA6IGYucG9zaXRpb24ubGVmdCAtIG0ubGVmdCwgYiAmJiAoZi5zaXplLmhlaWdodCA9IGYuc2l6ZS53aWR0aCAvIGYuYXNwZWN0UmF0aW8sIGsgPSAhMSksIGYucG9zaXRpb24ubGVmdCA9IGMuaGVscGVyID8gZC5sZWZ0IDogMCk7CiAgICAgICAgICAgICAgICAgICAgZy50b3AgPCAoZi5faGVscGVyID8gZC50b3AgOiAwKSAmJiAoZi5zaXplLmhlaWdodCArPSBmLl9oZWxwZXIgPyBmLnBvc2l0aW9uLnRvcCAtIGQudG9wIDogZi5wb3NpdGlvbi50b3AsIGIgJiYgKGYuc2l6ZS53aWR0aCA9IGYuc2l6ZS5oZWlnaHQgKiBmLmFzcGVjdFJhdGlvLCBrID0gITEpLCBmLnBvc2l0aW9uLnRvcCA9IGYuX2hlbHBlciA/IGQudG9wIDogMCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IGYuY29udGFpbmVyRWxlbWVudC5nZXQoMCkgPT09IGYuZWxlbWVudC5wYXJlbnQoKS5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgZyA9IC9yZWxhdGl2ZXxhYnNvbHV0ZS8udGVzdChmLmNvbnRhaW5lckVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpKTsKICAgICAgICAgICAgICAgICAgICBjICYmIGcgPyAoZi5vZmZzZXQubGVmdCA9IGYucGFyZW50RGF0YS5sZWZ0ICsgZi5wb3NpdGlvbi5sZWZ0LCBmLm9mZnNldC50b3AgPSBmLnBhcmVudERhdGEudG9wICsKICAgICAgICAgICAgICAgICAgICAgICAgZi5wb3NpdGlvbi50b3ApIDogKGYub2Zmc2V0LmxlZnQgPSBmLmVsZW1lbnQub2Zmc2V0KCkubGVmdCwgZi5vZmZzZXQudG9wID0gZi5lbGVtZW50Lm9mZnNldCgpLnRvcCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IE1hdGguYWJzKGYuc2l6ZURpZmYud2lkdGggKyAoZi5faGVscGVyID8gZi5vZmZzZXQubGVmdCAtIG0ubGVmdCA6IGYub2Zmc2V0LmxlZnQgLSBkLmxlZnQpKTsKICAgICAgICAgICAgICAgICAgICBkID0gTWF0aC5hYnMoZi5zaXplRGlmZi5oZWlnaHQgKyAoZi5faGVscGVyID8gZi5vZmZzZXQudG9wIC0gbS50b3AgOiBmLm9mZnNldC50b3AgLSBkLnRvcCkpOwogICAgICAgICAgICAgICAgICAgIGMgKyBmLnNpemUud2lkdGggPj0gZi5wYXJlbnREYXRhLndpZHRoICYmIChmLnNpemUud2lkdGggPSBmLnBhcmVudERhdGEud2lkdGggLSBjLCBiICYmIChmLnNpemUuaGVpZ2h0ID0gZi5zaXplLndpZHRoIC8gZi5hc3BlY3RSYXRpbywgayA9ICExKSk7CiAgICAgICAgICAgICAgICAgICAgZCArIGYuc2l6ZS5oZWlnaHQgPj0gZi5wYXJlbnREYXRhLmhlaWdodCAmJiAoZi5zaXplLmhlaWdodCA9IGYucGFyZW50RGF0YS5oZWlnaHQgLSBkLCBiICYmIChmLnNpemUud2lkdGggPSBmLnNpemUuaGVpZ2h0ICogZi5hc3BlY3RSYXRpbywgayA9ICExKSk7CiAgICAgICAgICAgICAgICAgICAgayB8fCAoZi5wb3NpdGlvbi5sZWZ0ID0gZi5wcmV2UG9zaXRpb24ubGVmdCwgZi5wb3NpdGlvbi50b3AgPSBmLnByZXZQb3NpdGlvbi50b3AsIGYuc2l6ZS53aWR0aCA9IGYucHJldlNpemUud2lkdGgsIGYuc2l6ZS5oZWlnaHQgPSBmLnByZXZTaXplLmhlaWdodCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gYi5vcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gYi5jb250YWluZXJPZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBiLmNvbnRhaW5lclBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYi5jb250YWluZXJFbGVtZW50LAogICAgICAgICAgICAgICAgICAgICAgICBtID0gYShiLmhlbHBlciksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBtLm9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrID0gbS5vdXRlcldpZHRoKCkgLSBiLnNpemVEaWZmLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBtID0gbS5vdXRlckhlaWdodCgpIC0gYi5zaXplRGlmZi5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgYi5faGVscGVyICYmICFjLmFuaW1hdGUgJiYgL3JlbGF0aXZlLy50ZXN0KGYuY3NzKCJwb3NpdGlvbiIpKSAmJiBhKHRoaXMpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGgubGVmdCAtIGcubGVmdCAtIGQubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGssCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogbQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGIuX2hlbHBlciAmJiAhYy5hbmltYXRlICYmCiAgICAgICAgICAgICAgICAgICAgICAgIC9zdGF0aWMvLnRlc3QoZi5jc3MoInBvc2l0aW9uIikpICYmIGEodGhpcykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGgubGVmdCAtIGcubGVmdCAtIGQubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBtCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJhbHNvUmVzaXplIiwgewogICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIikub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBhKGIuYWxzb1Jlc2l6ZSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmRhdGEoInVpLXJlc2l6YWJsZS1hbHNvcmVzaXplIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KGIud2lkdGgoKSwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBwYXJzZUludChiLmhlaWdodCgpLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwYXJzZUludChiLmNzcygibGVmdCIpLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHBhcnNlSW50KGIuY3NzKCJ0b3AiKSwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcykucmVzaXphYmxlKCJpbnN0YW5jZSIpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gZC5vcmlnaW5hbFNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBkLm9yaWdpbmFsUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGQuc2l6ZS5oZWlnaHQgLSBnLmhlaWdodCB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGQuc2l6ZS53aWR0aCAtIGcud2lkdGggfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZC5wb3NpdGlvbi50b3AgLSBmLnRvcCB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZC5wb3NpdGlvbi5sZWZ0IC0gZi5sZWZ0IHx8IDAKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBhKGQub3B0aW9ucy5hbHNvUmVzaXplKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYSh0aGlzKS5kYXRhKCJ1aS1yZXNpemFibGUtYWxzb3Jlc2l6ZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGIucGFyZW50cyhjLm9yaWdpbmFsRWxlbWVudFswXSkubGVuZ3RoID8gWyJ3aWR0aCIsICJoZWlnaHQiXSA6IFsid2lkdGgiLCAiaGVpZ2h0IiwgInRvcCIsICJsZWZ0Il07CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChlLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IChkW2JdIHx8IDApICsgKG1bYl0gfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjICYmIDAgPD0gYyAmJiAoZltiXSA9IGMgfHwgbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuY3NzKGYpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLnJlbW92ZURhdGEoInJlc2l6YWJsZS1hbHNvcmVzaXplIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImdob3N0IiwgewogICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiLnNpemU7CiAgICAgICAgICAgICAgICAgICAgYi5naG9zdCA9IGIub3JpZ2luYWxFbGVtZW50LmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgYi5naG9zdC5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAuMjUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGQuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZC53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAKICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygidWktcmVzaXphYmxlLWdob3N0IikuYWRkQ2xhc3MoInN0cmluZyIgPT09IHR5cGVvZiBjLmdob3N0ID8gYy5naG9zdCA6ICIiKTsKICAgICAgICAgICAgICAgICAgICBiLmdob3N0LmFwcGVuZFRvKGIuaGVscGVyKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKTsKICAgICAgICAgICAgICAgICAgICBiLmdob3N0ICYmIGIuZ2hvc3QuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYi5zaXplLmhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIuc2l6ZS53aWR0aAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpLnJlc2l6YWJsZSgiaW5zdGFuY2UiKTsKICAgICAgICAgICAgICAgICAgICBiLmdob3N0ICYmIGIuaGVscGVyICYmIGIuaGVscGVyLmdldCgwKS5yZW1vdmVDaGlsZChiLmdob3N0LmdldCgwKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwgImdyaWQiLCB7CiAgICAgICAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBjID0gYSh0aGlzKS5yZXNpemFibGUoImluc3RhbmNlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBjLnNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBjLm9yaWdpbmFsU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGMub3JpZ2luYWxQb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGMuYXhpcywKICAgICAgICAgICAgICAgICAgICAgICAgayA9ICJudW1iZXIiID09PSB0eXBlb2YgZC5ncmlkID8gW2QuZ3JpZCwgZC5ncmlkXSA6IGQuZ3JpZCwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGtbMF0gfHwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGtbMV0gfHwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IE1hdGgucm91bmQoKGcud2lkdGggLSBmLndpZHRoKSAvIGwpICogbCwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IE1hdGgucm91bmQoKGcuaGVpZ2h0IC0gZi5oZWlnaHQpIC8gZSkgKiBlLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gZi53aWR0aCArIG4sCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBmLmhlaWdodCArIGcsCiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBkLm1heFdpZHRoICYmIGQubWF4V2lkdGggPCBwLAogICAgICAgICAgICAgICAgICAgICAgICB1ID0gZC5tYXhIZWlnaHQgJiYgZC5tYXhIZWlnaHQgPCByLAogICAgICAgICAgICAgICAgICAgICAgICB2ID0gZC5taW5XaWR0aCAmJiBkLm1pbldpZHRoID4gcCwKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGQubWluSGVpZ2h0ICYmIGQubWluSGVpZ2h0ID4KICAgICAgICAgICAgICAgICAgICAgICAgcjsKICAgICAgICAgICAgICAgICAgICBkLmdyaWQgPSBrOwogICAgICAgICAgICAgICAgICAgIHYgJiYgKHAgKz0gbCk7CiAgICAgICAgICAgICAgICAgICAgeSAmJiAociArPSBlKTsKICAgICAgICAgICAgICAgICAgICBxICYmIChwIC09IGwpOwogICAgICAgICAgICAgICAgICAgIHUgJiYgKHIgLT0gZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKC9eKHNlfHN8ZSkkLy50ZXN0KGgpKSBjLnNpemUud2lkdGggPSBwLCBjLnNpemUuaGVpZ2h0ID0gcjsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgvXihuZSkkLy50ZXN0KGgpKSBjLnNpemUud2lkdGggPSBwLCBjLnNpemUuaGVpZ2h0ID0gciwgYy5wb3NpdGlvbi50b3AgPSBtLnRvcCAtIGc7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoL14oc3cpJC8udGVzdChoKSkgYy5zaXplLndpZHRoID0gcCwgYy5zaXplLmhlaWdodCA9IHIsIGMucG9zaXRpb24ubGVmdCA9IG0ubGVmdCAtIG47CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID49IHIgLSBlIHx8IDAgPj0gcCAtIGwpIGIgPSBjLl9nZXRQYWRkaW5nUGx1c0JvcmRlckRpbWVuc2lvbnModGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPCByIC0gZSA/IChjLnNpemUuaGVpZ2h0ID0gciwgYy5wb3NpdGlvbi50b3AgPSBtLnRvcCAtIGcpIDogKHIgPSBlIC0gYi5oZWlnaHQsIGMuc2l6ZS5oZWlnaHQgPSByLCBjLnBvc2l0aW9uLnRvcCA9IG0udG9wICsgZi5oZWlnaHQgLSByKTsKICAgICAgICAgICAgICAgICAgICAgICAgMCA8IHAgLSBsID8gKGMuc2l6ZS53aWR0aCA9IHAsIGMucG9zaXRpb24ubGVmdCA9IG0ubGVmdCAtIG4pIDogKHAgPSBsIC0gYi53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc2l6ZS53aWR0aCA9IHAsIGMucG9zaXRpb24ubGVmdCA9IG0ubGVmdCArIGYud2lkdGggLSBwKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5kaWFsb2ciLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBhcHBlbmRUbzogImJvZHkiLAogICAgICAgICAgICAgICAgICAgIGF1dG9PcGVuOiAhMCwKICAgICAgICAgICAgICAgICAgICBidXR0b25zOiBbXSwKICAgICAgICAgICAgICAgICAgICBjbG9zZU9uRXNjYXBlOiAhMCwKICAgICAgICAgICAgICAgICAgICBjbG9zZVRleHQ6ICJDbG9zZSIsCiAgICAgICAgICAgICAgICAgICAgZGlhbG9nQ2xhc3M6ICIiLAogICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogITAsCiAgICAgICAgICAgICAgICAgICAgaGlkZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICJhdXRvIiwKICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAxNTAsCiAgICAgICAgICAgICAgICAgICAgbWluV2lkdGg6IDE1MCwKICAgICAgICAgICAgICAgICAgICBtb2RhbDogITEsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgbXk6ICJjZW50ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBhdDogImNlbnRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mOiB3aW5kb3csCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjogImZpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHVzaW5nOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEodGhpcykuY3NzKGIpLm9mZnNldCgpLnRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPiBjICYmIGEodGhpcykuY3NzKCJ0b3AiLCBiLnRvcCAtIGMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogITAsCiAgICAgICAgICAgICAgICAgICAgc2hvdzogbnVsbCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzAwLAogICAgICAgICAgICAgICAgICAgIGJlZm9yZUNsb3NlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNsb3NlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGRyYWc6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZHJhZ1N0YXJ0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIGRyYWdTdG9wOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGZvY3VzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9wZW46IG51bGwsCiAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJlc2l6ZVN0YXJ0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJlc2l6ZVN0b3A6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzaXplUmVsYXRlZE9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBidXR0b25zOiAhMCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICEwLAogICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogITAsCiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6ICEwLAogICAgICAgICAgICAgICAgICAgIG1pbkhlaWdodDogITAsCiAgICAgICAgICAgICAgICAgICAgbWluV2lkdGg6ICEwLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlc2l6YWJsZVJlbGF0ZWRPcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiAhMCwKICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogITAsCiAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAhMCwKICAgICAgICAgICAgICAgICAgICBtaW5XaWR0aDogITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsQ3NzID0gewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0aGlzLmVsZW1lbnRbMF0uc3R5bGUuZGlzcGxheSwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuZWxlbWVudFswXS5zdHlsZS53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiB0aGlzLmVsZW1lbnRbMF0uc3R5bGUubWluSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IHRoaXMuZWxlbWVudFswXS5zdHlsZS5tYXhIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5lbGVtZW50WzBdLnN0eWxlLmhlaWdodAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMuZWxlbWVudC5wYXJlbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5jaGlsZHJlbigpLmluZGV4KHRoaXMuZWxlbWVudCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxUaXRsZSA9IHRoaXMuZWxlbWVudC5hdHRyKCJ0aXRsZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy50aXRsZSA9IHRoaXMub3B0aW9ucy50aXRsZSB8fCB0aGlzLm9yaWdpbmFsVGl0bGU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlV3JhcHBlcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zaG93KCkucmVtb3ZlQXR0cigidGl0bGUiKS5hZGRDbGFzcygidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnQiKS5hcHBlbmRUbyh0aGlzLnVpRGlhbG9nKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVUaXRsZWJhcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUJ1dHRvblBhbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlICYmIGEuZm4uZHJhZ2dhYmxlICYmIHRoaXMuX21ha2VEcmFnZ2FibGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVzaXphYmxlICYmIGEuZm4ucmVzaXphYmxlICYmIHRoaXMuX21ha2VSZXNpemFibGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc09wZW4gPSAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmFja0ZvY3VzKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF1dG9PcGVuICYmIHRoaXMub3BlbigpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2FwcGVuZFRvOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMub3B0aW9ucy5hcHBlbmRUbzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiAmJiAoYi5qcXVlcnkgfHwgYi5ub2RlVHlwZSkgPyBhKGIpIDogdGhpcy5kb2N1bWVudC5maW5kKGIgfHwgImJvZHkiKS5lcSgwKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSwgYyA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91bnRyYWNrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZXN0cm95T3ZlcmxheSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVVbmlxdWVJZCgpLnJlbW92ZUNsYXNzKCJ1aS1kaWFsb2ctY29udGVudCB1aS13aWRnZXQtY29udGVudCIpLmNzcyh0aGlzLm9yaWdpbmFsQ3NzKS5kZXRhY2goKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nLnN0b3AoITAsICEwKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsVGl0bGUgJiYgdGhpcy5lbGVtZW50LmF0dHIoInRpdGxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFRpdGxlKTsKICAgICAgICAgICAgICAgICAgICBhID0gYy5wYXJlbnQuY2hpbGRyZW4oKS5lcShjLmluZGV4KTsKICAgICAgICAgICAgICAgICAgICBhLmxlbmd0aCAmJiBhWzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gPyBhLmJlZm9yZSh0aGlzLmVsZW1lbnQpIDogYy5wYXJlbnQuYXBwZW5kKHRoaXMuZWxlbWVudCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3aWRnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVpRGlhbG9nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGlzYWJsZTogYS5ub29wLAogICAgICAgICAgICAgICAgZW5hYmxlOiBhLm5vb3AsCiAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNPcGVuICYmICExICE9PSB0aGlzLl90cmlnZ2VyKCJiZWZvcmVDbG9zZSIsIGIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzT3BlbiA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9mb2N1c2VkRWxlbWVudCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lPdmVybGF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VudHJhY2tJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3BlbmVyLmZpbHRlcigiOmZvY3VzYWJsZSIpLmZvY3VzKCkubGVuZ3RoKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMgPSB0aGlzLmRvY3VtZW50WzBdLmFjdGl2ZUVsZW1lbnQpICYmICJib2R5IiAhPT0gYy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShjKS5ibHVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZykge30KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZSh0aGlzLnVpRGlhbG9nLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLl90cmlnZ2VyKCJjbG9zZSIsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzT3BlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzT3BlbgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1vdmVUb1RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZVRvVG9wKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW92ZVRvVG9wOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMudWlEaWFsb2cuc2libGluZ3MoIi51aS1mcm9udDp2aXNpYmxlIikubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICthKHRoaXMpLmNzcygiei1pbmRleCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gTWF0aC5tYXguYXBwbHkobnVsbCwgZyk7CiAgICAgICAgICAgICAgICAgICAgZyA+PSArdGhpcy51aURpYWxvZy5jc3MoInotaW5kZXgiKSAmJiAodGhpcy51aURpYWxvZy5jc3MoInotaW5kZXgiLCBnICsgMSksIGQgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCAmJiAhYyAmJiB0aGlzLl90cmlnZ2VyKCJmb2N1cyIsIGIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzT3BlbiA/IHRoaXMuX21vdmVUb1RvcCgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzVGFiYmFibGUoKSA6ICh0aGlzLl9pc09wZW4gPSAhMCwgdGhpcy5vcGVuZXIgPSBhKHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCksIHRoaXMuX3NpemUoKSwgdGhpcy5fcG9zaXRpb24oKSwgdGhpcy5fY3JlYXRlT3ZlcmxheSgpLCB0aGlzLl9tb3ZlVG9Ub3AobnVsbCwgITApLCB0aGlzLm92ZXJsYXkgJiYgdGhpcy5vdmVybGF5LmNzcygiei1pbmRleCIsIHRoaXMudWlEaWFsb2cuY3NzKCJ6LWluZGV4IikgLSAxKSwgdGhpcy5fc2hvdyh0aGlzLnVpRGlhbG9nLCB0aGlzLm9wdGlvbnMuc2hvdywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLl9mb2N1c1RhYmJhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLl90cmlnZ2VyKCJmb2N1cyIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLl9tYWtlRm9jdXNUYXJnZXQoKSwgdGhpcy5fdHJpZ2dlcigib3BlbiIpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9mb2N1c1RhYmJhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2ZvY3VzZWRFbGVtZW50OwogICAgICAgICAgICAgICAgICAgIGEgfHwgKGEgPSB0aGlzLmVsZW1lbnQuZmluZCgiW2F1dG9mb2N1c10iKSk7CiAgICAgICAgICAgICAgICAgICAgYS5sZW5ndGggfHwgKGEgPSB0aGlzLmVsZW1lbnQuZmluZCgiOnRhYmJhYmxlIikpOwogICAgICAgICAgICAgICAgICAgIGEubGVuZ3RoIHx8IChhID0gdGhpcy51aURpYWxvZ0J1dHRvblBhbmUuZmluZCgiOnRhYmJhYmxlIikpOwogICAgICAgICAgICAgICAgICAgIGEubGVuZ3RoIHx8IChhID0gdGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UuZmlsdGVyKCI6dGFiYmFibGUiKSk7CiAgICAgICAgICAgICAgICAgICAgYS5sZW5ndGggfHwgKGEgPSB0aGlzLnVpRGlhbG9nKTsKICAgICAgICAgICAgICAgICAgICBhLmVxKDApLmZvY3VzKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfa2VlcEZvY3VzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmRvY3VtZW50WzBdLmFjdGl2ZUVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWlEaWFsb2dbMF0gPT09IGIgfHwgYS5jb250YWlucyh0aGlzLnVpRGlhbG9nWzBdLCBiKSB8fCB0aGlzLl9mb2N1c1RhYmJhYmxlKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGMuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWxheShjKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVXcmFwcGVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nID0gYSgiPGRpdj4iKS5hZGRDbGFzcygidWktZGlhbG9nIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIHVpLWZyb250ICIgKyB0aGlzLm9wdGlvbnMuZGlhbG9nQ2xhc3MpLmhpZGUoKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg6IC0xLAogICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiZGlhbG9nIgogICAgICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHRoaXMudWlEaWFsb2csIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jbG9zZU9uRXNjYXBlICYmICFiLmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIGIua2V5Q29kZSAmJiBiLmtleUNvZGUgPT09IGEudWkua2V5Q29kZS5FU0NBUEUpIGIucHJldmVudERlZmF1bHQoKSwgdGhpcy5jbG9zZShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGIua2V5Q29kZSA9PT0gYS51aS5rZXlDb2RlLlRBQiAmJiAhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy51aURpYWxvZy5maW5kKCI6dGFiYmFibGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuZmlsdGVyKCI6Zmlyc3QiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGMuZmlsdGVyKCI6bGFzdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIudGFyZ2V0ICE9PSBnWzBdICYmIGIudGFyZ2V0ICE9PSB0aGlzLnVpRGlhbG9nWzBdIHx8IGIuc2hpZnRLZXkgPyBiLnRhcmdldCAhPT0gZFswXSAmJiBiLnRhcmdldCAhPT0gdGhpcy51aURpYWxvZ1swXSB8fCAhYi5zaGlmdEtleSB8fCAodGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIucHJldmVudERlZmF1bHQoKSkgOiAodGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBiLnByZXZlbnREZWZhdWx0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZVRvVG9wKGEpICYmIHRoaXMuX2ZvY3VzVGFiYmFibGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoIlthcmlhLWRlc2NyaWJlZGJ5XSIpLmxlbmd0aCB8fCB0aGlzLnVpRGlhbG9nLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1kZXNjcmliZWRieSI6IHRoaXMuZWxlbWVudC51bmlxdWVJZCgpLmF0dHIoImlkIikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVUaXRsZWJhcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aURpYWxvZ1RpdGxlYmFyID0gYSgiPGRpdj4iKS5hZGRDbGFzcygidWktZGlhbG9nLXRpdGxlYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCB1aS1oZWxwZXItY2xlYXJmaXgiKS5wcmVwZW5kVG8odGhpcy51aURpYWxvZyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy51aURpYWxvZ1RpdGxlYmFyLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYShiLnRhcmdldCkuY2xvc2VzdCgiLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aURpYWxvZy5mb2N1cygpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nVGl0bGViYXJDbG9zZSA9IGEoIjxidXR0b24gdHlwZT0nYnV0dG9uJz48L2J1dHRvbj4iKS5idXR0b24oewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5vcHRpb25zLmNsb3NlVGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnk6ICJ1aS1pY29uLWNsb3NldGhpY2siCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICExCiAgICAgICAgICAgICAgICAgICAgfSkuYWRkQ2xhc3MoInVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIpLmFwcGVuZFRvKHRoaXMudWlEaWFsb2dUaXRsZWJhcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoYSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGIgPSBhKCI8c3Bhbj4iKS51bmlxdWVJZCgpLmFkZENsYXNzKCJ1aS1kaWFsb2ctdGl0bGUiKS5wcmVwZW5kVG8odGhpcy51aURpYWxvZ1RpdGxlYmFyKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aXRsZShiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1sYWJlbGxlZGJ5IjogYi5hdHRyKCJpZCIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdGl0bGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudGl0bGUgfHwKICAgICAgICAgICAgICAgICAgICAgICAgYS5odG1sKCImIzE2MDsiKTsKICAgICAgICAgICAgICAgICAgICBhLnRleHQodGhpcy5vcHRpb25zLnRpdGxlKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVCdXR0b25QYW5lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZSA9IGEoIjxkaXY+IikuYWRkQ2xhc3MoInVpLWRpYWxvZy1idXR0b25wYW5lIHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudWlCdXR0b25TZXQgPSBhKCI8ZGl2PiIpLmFkZENsYXNzKCJ1aS1kaWFsb2ctYnV0dG9uc2V0IikuYXBwZW5kVG8odGhpcy51aURpYWxvZ0J1dHRvblBhbmUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUJ1dHRvbnMoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVCdXR0b25zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnMuYnV0dG9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpQnV0dG9uU2V0LmVtcHR5KCk7CiAgICAgICAgICAgICAgICAgICAgYS5pc0VtcHR5T2JqZWN0KGMpIHx8IGEuaXNBcnJheShjKSAmJiAhYy5sZW5ndGggPyB0aGlzLnVpRGlhbG9nLnJlbW92ZUNsYXNzKCJ1aS1kaWFsb2ctYnV0dG9ucyIpIDoKICAgICAgICAgICAgICAgICAgICAgICAgKGEuZWFjaChjLCBmdW5jdGlvbihjLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhLmlzRnVuY3Rpb24oZykgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJidXR0b24iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBnLmNsaWNrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5jbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuYXBwbHkoYi5lbGVtZW50WzBdLCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uczogZy5pY29ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBnLnNob3dUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGcuaWNvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZy5zaG93VGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoIjxidXR0b24+PC9idXR0b24+IiwgZykuYnV0dG9uKG0pLmFwcGVuZFRvKGIudWlCdXR0b25TZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLnVpRGlhbG9nLmFkZENsYXNzKCJ1aS1kaWFsb2ctYnV0dG9ucyIpLCB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZS5hcHBlbmRUbyh0aGlzLnVpRGlhbG9nKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbWFrZURyYWdnYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogYS5vZmZzZXQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aURpYWxvZy5kcmFnZ2FibGUoewogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw6ICIudWktZGlhbG9nLWNvbnRlbnQsIC51aS1kaWFsb2ctdGl0bGViYXItY2xvc2UiLAogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICIudWktZGlhbG9nLXRpdGxlYmFyIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbm1lbnQ6ICJkb2N1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihkLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmFkZENsYXNzKCJ1aS1kaWFsb2ctZHJhZ2dpbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuX2Jsb2NrRnJhbWVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLl90cmlnZ2VyKCJkcmFnU3RhcnQiLCBkLCBiKGYpKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBkcmFnOiBmdW5jdGlvbihhLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLl90cmlnZ2VyKCJkcmFnIiwgYSwgYihkKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oZywgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBmLm9mZnNldC5sZWZ0IC0gYy5kb2N1bWVudC5zY3JvbGxMZWZ0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGYub2Zmc2V0LnRvcCAtIGMuZG9jdW1lbnQuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnBvc2l0aW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15OiAibGVmdCB0b3AiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0OiAibGVmdCIgKyAoMCA8PSBtID8gIisiIDogIiIpICsgbSArICIgdG9wIiArICgwIDw9IGggPyAiKyIgOiAiIikgKyBoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mOiBjLndpbmRvdwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1kcmFnZ2luZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5fdW5ibG9ja0ZyYW1lcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5fdHJpZ2dlcigiZHJhZ1N0b3AiLCBnLCBiKGYpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbWFrZVJlc2l6YWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFBvc2l0aW9uOiBhLm9yaWdpbmFsUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFNpemU6IGEub3JpZ2luYWxTaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGEucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBhLnNpemUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkLnJlc2l6YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMudWlEaWFsb2cuY3NzKCJwb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gInN0cmluZyIgPT09IHR5cGVvZiBnID8gZyA6ICJuLGUscyx3LHNlLHN3LG5lLG53IjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbDogIi51aS1kaWFsb2ctY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiAiZG9jdW1lbnQiLAogICAgICAgICAgICAgICAgICAgICAgICBhbHNvUmVzaXplOiB0aGlzLmVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBkLm1heFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IGQubWF4SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBtaW5XaWR0aDogZC5taW5XaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiB0aGlzLl9taW5IZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlczogZywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGQsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuYWRkQ2xhc3MoInVpLWRpYWxvZy1yZXNpemluZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5fYmxvY2tGcmFtZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuX3RyaWdnZXIoInJlc2l6ZVN0YXJ0IiwgZCwgYihmKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBmdW5jdGlvbihhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5fdHJpZ2dlcigicmVzaXplIiwgYSwgYihkKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oZiwgZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBjLnVpRGlhbG9nLm9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBrLmxlZnQgLSBjLmRvY3VtZW50LnNjcm9sbExlZnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gay50b3AgLSBjLmRvY3VtZW50LnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5oZWlnaHQgPSBjLnVpRGlhbG9nLmhlaWdodCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC53aWR0aCA9IGMudWlEaWFsb2cud2lkdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXk6ICJsZWZ0IHRvcCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXQ6ICJsZWZ0IiArICgwIDw9IGwgPyAiKyIgOiAiIikgKyBsICsgIiB0b3AiICsgKDAgPD0gayA/ICIrIiA6ICIiKSArIGssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IGMud2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5yZW1vdmVDbGFzcygidWktZGlhbG9nLXJlc2l6aW5nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLl91bmJsb2NrRnJhbWVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLl90cmlnZ2VyKCJyZXNpemVTdG9wIiwgZiwgYihnKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNzcygicG9zaXRpb24iLCBmKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF90cmFja0ZvY3VzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLndpZGdldCgpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzaW46IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21ha2VGb2N1c1RhcmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNlZEVsZW1lbnQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYi50YXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tYWtlRm9jdXNUYXJnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VudHJhY2tJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyYWNraW5nSW5zdGFuY2VzKCkudW5zaGlmdCh0aGlzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF91bnRyYWNrSW5zdGFuY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5fdHJhY2tpbmdJbnN0YW5jZXMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEuaW5BcnJheSh0aGlzLCBiKTsgLSAxICE9PSBjICYmIGIuc3BsaWNlKGMsIDEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RyYWNraW5nSW5zdGFuY2VzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuZG9jdW1lbnQuZGF0YSgidWktZGlhbG9nLWluc3RhbmNlcyIpOwogICAgICAgICAgICAgICAgICAgIGEgfHwgKGEgPSBbXSwgdGhpcy5kb2N1bWVudC5kYXRhKCJ1aS1kaWFsb2ctaW5zdGFuY2VzIiwgYSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21pbkhlaWdodDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJhdXRvIiA9PT0gYS5oZWlnaHQgPyBhLm1pbkhlaWdodCA6IE1hdGgubWluKGEubWluSGVpZ2h0LCBhLmhlaWdodCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcG9zaXRpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKTsKICAgICAgICAgICAgICAgICAgICBhIHx8IHRoaXMudWlEaWFsb2cuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudWlEaWFsb2cucG9zaXRpb24odGhpcy5vcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBhIHx8IHRoaXMudWlEaWFsb2cuaGlkZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbnM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHt9OwogICAgICAgICAgICAgICAgICAgIGEuZWFjaChiLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuX3NldE9wdGlvbihhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYSBpbiBjLnNpemVSZWxhdGVkT3B0aW9ucyAmJiAoZCA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYSBpbiBjLnJlc2l6YWJsZVJlbGF0ZWRPcHRpb25zICYmIChnW2FdID0gYikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBkICYmICh0aGlzLl9zaXplKCksIHRoaXMuX3Bvc2l0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudWlEaWFsb2cuaXMoIjpkYXRhKHVpLXJlc2l6YWJsZSkiKSAmJiB0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSgib3B0aW9uIiwgZykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcgPSB0aGlzLnVpRGlhbG9nOwogICAgICAgICAgICAgICAgICAgICJkaWFsb2dDbGFzcyIgPT09IGEgJiYgZy5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuZGlhbG9nQ2xhc3MpLmFkZENsYXNzKGMpOwogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCIgIT09CiAgICAgICAgICAgICAgICAgICAgYSAmJiAodGhpcy5fc3VwZXIoYSwgYyksICJhcHBlbmRUbyIgPT09IGEgJiYgdGhpcy51aURpYWxvZy5hcHBlbmRUbyh0aGlzLl9hcHBlbmRUbygpKSwgImJ1dHRvbnMiID09PSBhICYmIHRoaXMuX2NyZWF0ZUJ1dHRvbnMoKSwgImNsb3NlVGV4dCIgPT09IGEgJiYgdGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UuYnV0dG9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiIiArIGMKICAgICAgICAgICAgICAgICAgICAgICAgfSksICJkcmFnZ2FibGUiID09PSBhICYmICgoZCA9IGcuaXMoIjpkYXRhKHVpLWRyYWdnYWJsZSkiKSkgJiYgIWMgJiYgZy5kcmFnZ2FibGUoImRlc3Ryb3kiKSwgIWQgJiYgYyAmJiB0aGlzLl9tYWtlRHJhZ2dhYmxlKCkpLCAicG9zaXRpb24iID09PSBhICYmIHRoaXMuX3Bvc2l0aW9uKCksICJyZXNpemFibGUiID09PSBhICYmICgoZCA9IGcuaXMoIjpkYXRhKHVpLXJlc2l6YWJsZSkiKSkgJiYgIWMgJiYgZy5yZXNpemFibGUoImRlc3Ryb3kiKSwgZCAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGMgJiYgZy5yZXNpemFibGUoIm9wdGlvbiIsICJoYW5kbGVzIiwgYyksIGQgfHwgITEgPT09IGMgfHwgdGhpcy5fbWFrZVJlc2l6YWJsZSgpKSwgInRpdGxlIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiB0aGlzLl90aXRsZSh0aGlzLnVpRGlhbG9nVGl0bGViYXIuZmluZCgiLnVpLWRpYWxvZy10aXRsZSIpKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEsIGMsIGQsIGcgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNob3coKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICBtaW5IZWlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogIm5vbmUiLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBnLm1pbldpZHRoID4gZy53aWR0aCAmJiAoZy53aWR0aCA9IGcubWluV2lkdGgpOwogICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLnVpRGlhbG9nLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZy53aWR0aAogICAgICAgICAgICAgICAgICAgIH0pLm91dGVySGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgYyA9IE1hdGgubWF4KDAsIGcubWluSGVpZ2h0IC0gYSk7CiAgICAgICAgICAgICAgICAgICAgZCA9ICJudW1iZXIiID09PSB0eXBlb2YgZy5tYXhIZWlnaHQgPyBNYXRoLm1heCgwLCBnLm1heEhlaWdodCAtIGEpIDogIm5vbmUiOwogICAgICAgICAgICAgICAgICAgICJhdXRvIiA9PT0gZy5oZWlnaHQgPyB0aGlzLmVsZW1lbnQuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiBjLAogICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogImF1dG8iCiAgICAgICAgICAgICAgICAgICAgfSkgOiB0aGlzLmVsZW1lbnQuaGVpZ2h0KE1hdGgubWF4KDAsIGcuaGVpZ2h0IC0gYSkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudWlEaWFsb2cuaXMoIjpkYXRhKHVpLXJlc2l6YWJsZSkiKSAmJiB0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSgib3B0aW9uIiwgIm1pbkhlaWdodCIsIHRoaXMuX21pbkhlaWdodCgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9ibG9ja0ZyYW1lczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZnJhbWVCbG9ja3MgPSB0aGlzLmRvY3VtZW50LmZpbmQoImlmcmFtZSIpLm1hcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSgiPGRpdj4iKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYi5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmRUbyhiLnBhcmVudCgpKS5vZmZzZXQoYi5vZmZzZXQoKSlbMF0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF91bmJsb2NrRnJhbWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlmcmFtZUJsb2NrcyAmJiAodGhpcy5pZnJhbWVCbG9ja3MucmVtb3ZlKCksIGRlbGV0ZSB0aGlzLmlmcmFtZUJsb2NrcykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWxsb3dJbnRlcmFjdGlvbjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhKGIudGFyZ2V0KS5jbG9zZXN0KCIudWktZGlhbG9nIikubGVuZ3RoID8KICAgICAgICAgICAgICAgICAgICAgICAgITAgOiAhIWEoYi50YXJnZXQpLmNsb3Nlc3QoIi51aS1kYXRlcGlja2VyIikubGVuZ3RoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NyZWF0ZU92ZXJsYXk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuZGF0YSgidWktZGlhbG9nLW92ZXJsYXlzIikgfHwgdGhpcy5fb24odGhpcy5kb2N1bWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNpbjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgfHwgdGhpcy5fYWxsb3dJbnRlcmFjdGlvbihhKSB8fCAoYS5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLl90cmFja2luZ0luc3RhbmNlcygpWzBdLl9mb2N1c1RhYmJhYmxlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJsYXkgPSBhKCI8ZGl2PiIpLmFkZENsYXNzKCJ1aS13aWRnZXQtb3ZlcmxheSB1aS1mcm9udCIpLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLm92ZXJsYXksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlZG93bjogIl9rZWVwRm9jdXMiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5kb2N1bWVudC5kYXRhKCJ1aS1kaWFsb2ctb3ZlcmxheXMiKSB8fCAwKSArIDEpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95T3ZlcmxheTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RhbCAmJiB0aGlzLm92ZXJsYXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmRvY3VtZW50LmRhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIpIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYSA/IHRoaXMuZG9jdW1lbnQuZGF0YSgidWktZGlhbG9nLW92ZXJsYXlzIiwgYSkgOiB0aGlzLmRvY3VtZW50LnVuYmluZCgiZm9jdXNpbiIpLnJlbW92ZURhdGEoInVpLWRpYWxvZy1vdmVybGF5cyIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJsYXkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3ZlcmxheSA9IG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkuZHJvcHBhYmxlIiwgewogICAgICAgICAgICAgICAgdmVyc2lvbjogIjEuMTEuNCIsCiAgICAgICAgICAgICAgICB3aWRnZXRFdmVudFByZWZpeDogImRyb3AiLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGFjY2VwdDogIioiLAogICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNsYXNzOiAhMSwKICAgICAgICAgICAgICAgICAgICBhZGRDbGFzc2VzOiAhMCwKICAgICAgICAgICAgICAgICAgICBncmVlZHk6ICExLAogICAgICAgICAgICAgICAgICAgIGhvdmVyQ2xhc3M6ICExLAogICAgICAgICAgICAgICAgICAgIHNjb3BlOiAiZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgdG9sZXJhbmNlOiAiaW50ZXJzZWN0IiwKICAgICAgICAgICAgICAgICAgICBhY3RpdmF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBkZWFjdGl2YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGRyb3A6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgb3V0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIG92ZXI6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuYWNjZXB0OwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNvdmVyID0gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc291dCA9ICEwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjZXB0ID0gYS5pc0Z1bmN0aW9uKGQpID8gZCA6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuaXMoZCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcG9ydGlvbnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIGIgPSBhcmd1bWVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGIgPyBiIDogYiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZWxlbWVudFswXS5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkVG9NYW5hZ2VyKGMuc2NvcGUpOwogICAgICAgICAgICAgICAgICAgIGMuYWRkQ2xhc3NlcyAmJiB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyb3BwYWJsZSIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2FkZFRvTWFuYWdlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYl0gPSBhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2JdIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYl0ucHVzaCh0aGlzKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zcGxpY2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIGFbY10gPT09IHRoaXMgJiYgYS5zcGxpY2UoYywgMSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3BsaWNlKGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1kcm9wcGFibGUgdWktZHJvcHBhYmxlLWRpc2FibGVkIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgImFjY2VwdCIgPT09IGIgPyB0aGlzLmFjY2VwdCA9IGEuaXNGdW5jdGlvbihjKSA/IGMgOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlzKGMpCiAgICAgICAgICAgICAgICAgICAgfSA6ICJzY29wZSIgPT09IGIgJiYgKHRoaXMuX3NwbGljZShhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW3RoaXMub3B0aW9ucy5zY29wZV0pLCB0aGlzLl9hZGRUb01hbmFnZXIoYykpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKGIsIGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2FjdGl2YXRlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICBhLnVpLmRkbWFuYWdlci5jdXJyZW50OwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyAmJiB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjICYmIHRoaXMuX3RyaWdnZXIoImFjdGl2YXRlIiwgYiwgdGhpcy51aShjKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVhY3RpdmF0ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS51aS5kZG1hbmFnZXIuY3VycmVudDsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgJiYgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgYyAmJiB0aGlzLl90cmlnZ2VyKCJkZWFjdGl2YXRlIiwgYiwgdGhpcy51aShjKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfb3ZlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS51aS5kZG1hbmFnZXIuY3VycmVudDsKICAgICAgICAgICAgICAgICAgICBjICYmIChjLmN1cnJlbnRJdGVtIHx8IGMuZWxlbWVudClbMF0gIT09IHRoaXMuZWxlbWVudFswXSAmJiB0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSwgYy5jdXJyZW50SXRlbSB8fCBjLmVsZW1lbnQpICYmICh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyAmJiB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJvdmVyIiwgYiwgdGhpcy51aShjKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX291dDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS51aS5kZG1hbmFnZXIuY3VycmVudDsKICAgICAgICAgICAgICAgICAgICBjICYmIChjLmN1cnJlbnRJdGVtIHx8IGMuZWxlbWVudClbMF0gIT09IHRoaXMuZWxlbWVudFswXSAmJiB0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSwgYy5jdXJyZW50SXRlbSB8fCBjLmVsZW1lbnQpICYmICh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyAmJiB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpLCB0aGlzLl90cmlnZ2VyKCJvdXQiLCBiLCB0aGlzLnVpKGMpKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZHJvcDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gYyB8fCBhLnVpLmRkbWFuYWdlci5jdXJyZW50LAogICAgICAgICAgICAgICAgICAgICAgICBnID0gITE7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkIHx8IChkLmN1cnJlbnRJdGVtIHx8IGQuZWxlbWVudClbMF0gPT09IHRoaXMuZWxlbWVudFswXSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5maW5kKCI6ZGF0YSh1aS1kcm9wcGFibGUpIikubm90KCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5kcm9wcGFibGUoImluc3RhbmNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLm9wdGlvbnMuZ3JlZWR5ICYmICFjLm9wdGlvbnMuZGlzYWJsZWQgJiYgYy5vcHRpb25zLnNjb3BlID09PSBkLm9wdGlvbnMuc2NvcGUgJiYgYy5hY2NlcHQuY2FsbChjLmVsZW1lbnRbMF0sIGQuY3VycmVudEl0ZW0gfHwgZC5lbGVtZW50KSAmJiBhLnVpLmludGVyc2VjdChkLCBhLmV4dGVuZChjLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBjLmVsZW1lbnQub2Zmc2V0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjLm9wdGlvbnMudG9sZXJhbmNlLCBiKSkgcmV0dXJuIGcgPSAhMCwgITEKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZyA/ICExIDogdGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sIGQuY3VycmVudEl0ZW0gfHwgZC5lbGVtZW50KSA/ICh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgJiYgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyksIHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzICYmIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyksIHRoaXMuX3RyaWdnZXIoImRyb3AiLAogICAgICAgICAgICAgICAgICAgICAgICBiLCB0aGlzLnVpKGQpKSwgdGhpcy5lbGVtZW50KSA6ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdWk6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGEuY3VycmVudEl0ZW0gfHwgYS5lbGVtZW50LAogICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXI6IGEuaGVscGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBhLnBvc2l0aW9uQWJzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS51aS5pbnRlcnNlY3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhLCBjLCBkLCBnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjLm9mZnNldCkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIHZhciBmID0gKGEucG9zaXRpb25BYnMgfHwgYS5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCArIGEubWFyZ2lucy5sZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICBtID0gKGEucG9zaXRpb25BYnMgfHwgYS5wb3NpdGlvbi5hYnNvbHV0ZSkudG9wICsgYS5tYXJnaW5zLnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGYgKyBhLmhlbHBlclByb3BvcnRpb25zLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBrID0gbSArIGEuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBsID0gYy5vZmZzZXQubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGMub2Zmc2V0LnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGwgKyBjLnByb3BvcnRpb25zKCkud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBlICsgYy5wcm9wb3J0aW9ucygpLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZml0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsIDw9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiAmJiBoIDw9IG4gJiYgZSA8PSBtICYmIGsgPD0gcDsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW50ZXJzZWN0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsIDwgZiArIGEuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLyAyICYmIGggLSBhLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMiA8IG4gJiYgZSA8IG0gKyBhLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIgJiYgayAtIGEuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC8gMiA8IHA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInBvaW50ZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGcucGFnZVk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYy5wcm9wb3J0aW9ucygpLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0gYSA+PSBlICYmIGEgPCBlICsgZCkgZyA9IGcucGFnZVgsIGMgPSBjLnByb3BvcnRpb25zKCkud2lkdGgsIGUgPSBnID49IGwgJiYgZyA8IGwgKyBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRvdWNoIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobSA+PSBlICYmIG0gPD0gcCB8fCBrID49IGUgJiYgayA8PSBwIHx8IG0gPCBlICYmIGsgPiBwKSAmJiAoZiA+PSBsICYmIGYgPD0gbiB8fCBoID49IGwgJiYgaCA8PSBuIHx8IGYgPCBsICYmIGggPiBuKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSgpOwogICAgICAgICAgICBhLnVpLmRkbWFuYWdlciA9IHsKICAgICAgICAgICAgICAgIGN1cnJlbnQ6IG51bGwsCiAgICAgICAgICAgICAgICBkcm9wcGFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgImRlZmF1bHQiOiBbXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByZXBhcmVPZmZzZXRzOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQsCiAgICAgICAgICAgICAgICAgICAgICAgIGcsIGYgPSBhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Iub3B0aW9ucy5zY29wZV0gfHwgW10sCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBjID8gYy50eXBlIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IChiLmN1cnJlbnRJdGVtIHx8IGIuZWxlbWVudCkuZmluZCgiOmRhdGEodWktZHJvcHBhYmxlKSIpLmFkZEJhY2soKTsKICAgICAgICAgICAgICAgICAgICBkID0gMDsKICAgICAgICAgICAgICAgICAgICBhOiBmb3IgKDsgZCA8IGYubGVuZ3RoOyBkKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGZbZF0ub3B0aW9ucy5kaXNhYmxlZCB8fCBiICYmICFmW2RdLmFjY2VwdC5jYWxsKGZbZF0uZWxlbWVudFswXSwgYi5jdXJyZW50SXRlbSB8fCBiLmVsZW1lbnQpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGgubGVuZ3RoOyBnKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhbZ10gPT09IGZbZF0uZWxlbWVudFswXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmW2RdLnByb3BvcnRpb25zKCkuaGVpZ2h0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZbZF0udmlzaWJsZSA9ICJub25lIiAhPT0gZltkXS5lbGVtZW50LmNzcygiZGlzcGxheSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZltkXS52aXNpYmxlICYmICgibW91c2Vkb3duIiA9PT0gbSAmJiBmW2RdLl9hY3RpdmF0ZS5jYWxsKGZbZF0sIGMpLCBmW2RdLm9mZnNldCA9IGZbZF0uZWxlbWVudC5vZmZzZXQoKSwgZltkXS5wcm9wb3J0aW9ucyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZbZF0uZWxlbWVudFswXS5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGZbZF0uZWxlbWVudFswXS5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZHJvcDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gITE7CiAgICAgICAgICAgICAgICAgICAgYS5lYWNoKChhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Iub3B0aW9ucy5zY29wZV0gfHwgW10pLnNsaWNlKCksIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgJiYgKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgdGhpcy52aXNpYmxlICYmIGEudWkuaW50ZXJzZWN0KGIsIHRoaXMsIHRoaXMub3B0aW9ucy50b2xlcmFuY2UsIGMpICYmIChkID0gdGhpcy5fZHJvcC5jYWxsKHRoaXMsIGMpIHx8IGQpLCAhdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIHRoaXMudmlzaWJsZSAmJiB0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSwgYi5jdXJyZW50SXRlbSB8fCBiLmVsZW1lbnQpICYmICh0aGlzLmlzb3V0ID0gITAsIHRoaXMuaXNvdmVyID0gITEsIHRoaXMuX2RlYWN0aXZhdGUuY2FsbCh0aGlzLCBjKSkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkcmFnU3RhcnQ6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICBiLmVsZW1lbnQucGFyZW50c1VudGlsKCJib2R5IikuYmluZCgic2Nyb2xsLmRyb3BwYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMgfHwgYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYiwgYykKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkcmFnOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYi5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMgJiYgYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYiwgYyk7CiAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYi5vcHRpb25zLnNjb3BlXSB8fCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLmRpc2FibGVkICYmICF0aGlzLmdyZWVkeUNoaWxkICYmIHRoaXMudmlzaWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcsIGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYS51aS5pbnRlcnNlY3QoYiwgdGhpcywgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9ICFmICYmIHRoaXMuaXNvdmVyID8gImlzb3V0IiA6IGYgJiYgIXRoaXMuaXNvdmVyID8gImlzb3ZlciIgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSAmJiAodGhpcy5vcHRpb25zLmdyZWVkeSAmJiAoZyA9IHRoaXMub3B0aW9ucy5zY29wZSwgZiA9IHRoaXMuZWxlbWVudC5wYXJlbnRzKCI6ZGF0YSh1aS1kcm9wcGFibGUpIikuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKHRoaXMpLmRyb3BwYWJsZSgiaW5zdGFuY2UiKS5vcHRpb25zLnNjb3BlID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZi5sZW5ndGggJiYgKGQgPSBhKGZbMF0pLmRyb3BwYWJsZSgiaW5zdGFuY2UiKSwgZC5ncmVlZHlDaGlsZCA9ICJpc292ZXIiID09PSBtKSksIGQgJiYgImlzb3ZlciIgPT09IG0gJiYgKGQuaXNvdmVyID0gITEsIGQuaXNvdXQgPSAhMCwgZC5fb3V0LmNhbGwoZCwgYykpLCB0aGlzW21dID0gITAsIHRoaXNbImlzb3V0IiA9PT0gbSA/ICJpc292ZXIiIDogImlzb3V0Il0gPSAhMSwgdGhpc1siaXNvdmVyIiA9PT0gbSA/ICJfb3ZlciIgOiAiX291dCJdLmNhbGwodGhpcywgYyksIGQgJiYgImlzb3V0IiA9PT0gbSAmJiAoZC5pc291dCA9ICExLCBkLmlzb3ZlciA9ICEwLCBkLl9vdmVyLmNhbGwoZCwgYykpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkcmFnU3RvcDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIGIuZWxlbWVudC5wYXJlbnRzVW50aWwoImJvZHkiKS51bmJpbmQoInNjcm9sbC5kcm9wcGFibGUiKTsKICAgICAgICAgICAgICAgICAgICBiLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucyB8fCBhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyhiLCBjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmVmZmVjdHMgPSB7CiAgICAgICAgICAgICAgICBlZmZlY3Q6IHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIChmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkKGEsIGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGVbYi50eXBlXSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBhKSByZXR1cm4gYyB8fCAhYi5kZWYgPyBudWxsIDogYi5kZWY7CiAgICAgICAgICAgICAgICAgICAgYSA9IGQuZmxvb3IgPyB+fmEgOiBwYXJzZUZsb2F0KGEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc05hTihhKSA/IGIuZGVmIDogZC5tb2QgPyAoYSArIGQubW9kKSAlIGQubW9kIDogMCA+IGEgPyAwIDogZC5tYXggPCBhID8gZC5tYXggOiBhCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZyhjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBrKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBkLl9yZ2JhID0gW107CiAgICAgICAgICAgICAgICAgICAgYyA9IGMudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBxKGgsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGcgPSBiLnJlLmV4ZWMoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBnICYmIGIucGFyc2UoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBiLnNwYWNlIHx8ICJyZ2JhIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHJldHVybiBmID0gZFtnXShmKSwgZFtsW2ddLmNhY2hlXSA9IGZbbFtnXS5jYWNoZV0sIGUgPSBkLl9yZ2JhID0gZi5fcmdiYSwgITEKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5sZW5ndGggPyAoIjAsMCwwLDAiID09PSBlLmpvaW4oKSAmJiBhLmV4dGVuZChlLCByLnRyYW5zcGFyZW50KSwgZCkgOiByW2NdCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChjICsgMSkgJSAxOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAxID4gNiAqIGMgPyBhICsgKGIgLSBhKSAqIGMgKiA2IDogMSA+IDIgKiBjID8gYiA6IDIgPiAzICogYyA/IGEgKyAoYiAtIGEpICogKDIgLyAzIC0KICAgICAgICAgICAgICAgICAgICAgICAgYykgKiA2IDogYQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG0gPSAvXihbXC0rXSk9XHMqKFxkK1wuP1xkKikvLAogICAgICAgICAgICAgICAgICAgIGggPSBbewogICAgICAgICAgICAgICAgICAgICAgICByZTogL3JnYmE/XChccyooXGR7MSwzfSlccyosXHMqKFxkezEsM30pXHMqLFxzKihcZHsxLDN9KVxzKig/OixccyooXGQ/KD86XC5cZCspPylccyopP1wpLywKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbYVsxXSwgYVsyXSwgYVszXSwgYVs0XV0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmU6IC9yZ2JhP1woXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyooPzosXHMqKFxkPyg/OlwuXGQrKT8pXHMqKT9cKS8sCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIuNTUgKiBhWzFdLCAyLjU1ICogYVsyXSwgMi41NSAqIGFbM10sIGFbNF1dCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlOiAvIyhbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pKFthLWYwLTldezJ9KS8sCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BhcnNlSW50KGFbMV0sIDE2KSwgcGFyc2VJbnQoYVsyXSwgMTYpLCBwYXJzZUludChhWzNdLCAxNildCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlOiAvIyhbYS1mMC05XSkoW2EtZjAtOV0pKFthLWYwLTldKS8sCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3BhcnNlSW50KGFbMV0gKyBhWzFdLCAxNiksIHBhcnNlSW50KGFbMl0gKyBhWzJdLCAxNiksIHBhcnNlSW50KGFbM10gKyBhWzNdLCAxNildCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlOiAvaHNsYT9cKFxzKihcZCsoPzpcLlxkKyk/KVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKig/OixccyooXGQ/KD86XC5cZCspPylccyopP1wpLywKICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2U6ICJoc2xhIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbYVsxXSwgYVsyXSAvIDEwMCwgYVszXSAvIDEwMCwgYVs0XV0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgIGsgPSBhLkNvbG9yID0gZnVuY3Rpb24oYywgZCwgZSwgZikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGEuQ29sb3IuZm4ucGFyc2UoYywgZCwgZSwgZikKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGwgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJnYmE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImJ5dGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJieXRlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg6IDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJieXRlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgaHNsYTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZGVncmVlcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4OiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAicGVyY2VudCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZ2h0bmVzczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg6IDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJwZXJjZW50IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImJ5dGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vcjogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6IDI1NQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVncmVlczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kOiAzNjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vcjogITAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbiA9IGsuc3VwcG9ydCA9IHt9LAogICAgICAgICAgICAgICAgICAgIHAgPSBhKCI8cD4iKVswXSwKICAgICAgICAgICAgICAgICAgICByLCBxID0gYS5lYWNoOwogICAgICAgICAgICAgICAgcC5zdHlsZS5jc3NUZXh0ID0gImJhY2tncm91bmQtY29sb3I6cmdiYSgxLDEsMSwuNSkiOwogICAgICAgICAgICAgICAgbi5yZ2JhID0gLTEgPCBwLnN0eWxlLmJhY2tncm91bmRDb2xvci5pbmRleE9mKCJyZ2JhIik7CiAgICAgICAgICAgICAgICBxKGwsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICBiLmNhY2hlID0gIl8iICsgYTsKICAgICAgICAgICAgICAgICAgICBiLnByb3BzLmFscGhhID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZHg6IDMsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJwZXJjZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmOiAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBrLmZuID0gYS5leHRlbmQoay5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgICAgICBwYXJzZTogZnVuY3Rpb24oZSwgZiwgaCwgbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9PT0gYykgcmV0dXJuIHRoaXMuX3JnYmEgPSBbbnVsbCwgbnVsbCwgbnVsbCwgbnVsbF0sIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmpxdWVyeSB8fCBlLm5vZGVUeXBlKSBlID0gYShlKS5jc3MoZiksIGYgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gYS50eXBlKGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHRoaXMuX3JnYmEgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgZiAhPT0gYyAmJiAoZSA9IFtlLCBmLCBoLCBtXSwgcCA9ICJhcnJheSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoInN0cmluZyIgPT09IHApIHJldHVybiB0aGlzLnBhcnNlKGcoZSkgfHwgci5fZGVmYXVsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiYXJyYXkiID09PSBwKSByZXR1cm4gcShsLnJnYmEucHJvcHMsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZbYi5pZHhdID0gZChlW2IuaWR4XSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfSksIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PT0gcCkgcmV0dXJuIGUgaW5zdGFuY2VvZiBrID8gcShsLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVtiLmNhY2hlXSAmJiAobltiLmNhY2hlXSA9IGVbYi5jYWNoZV0uc2xpY2UoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogcShsLCBmdW5jdGlvbihjLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBmLmNhY2hlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEoZi5wcm9wcywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5bZ10gJiYgZi50bykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJhbHBoYSIgPT09IGEgfHwgbnVsbCA9PSBlW2FdKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuW2ddID0gZi50byhuLl9yZ2JhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5bZ11bYi5pZHhdID0gZChlW2FdLCBiLCAhMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuW2ddICYmIDAgPiBhLmluQXJyYXkobnVsbCwgbltnXS5zbGljZSgwLCAzKSkgJiYgKG5bZ11bM10gPSAxLCBmLmZyb20gJiYgKG4uX3JnYmEgPSBmLmZyb20obltnXSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBpczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGsoYSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgcShsLCBmdW5jdGlvbihhLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZyA9IGJbZS5jYWNoZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIChmID0gZFtlLmNhY2hlXSB8fCBlLnRvICYmIGUudG8oZC5fcmdiYSkgfHwgW10sIHEoZS5wcm9wcywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGdbYi5pZHhdKSByZXR1cm4gYyA9IGdbYi5pZHhdID09PSBmW2IuaWR4XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfc3BhY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIHEobCwgZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYltkLmNhY2hlXSAmJiBhLnB1c2goYykKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnBvcCgpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gayhhKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBjLl9zcGFjZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGxbZl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gMCA9PT0gdGhpcy5hbHBoYSgpID8gaygidHJhbnNwYXJlbnQiKSA6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gaFtnLmNhY2hlXSB8fCBnLnRvKGguX3JnYmEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IG0uc2xpY2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBjW2cuY2FjaGVdOwogICAgICAgICAgICAgICAgICAgICAgICBxKGcucHJvcHMsIGZ1bmN0aW9uKGEsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gZi5pZHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IG1bZ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGNbZ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGVbZi50eXBlXSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT09IGwgJiYgKG51bGwgPT09IGggPyBuW2ddID0gbCA6IChrLm1vZCAmJiAobCAtIGggPiBrLm1vZCAvIDIgPyBoICs9IGsubW9kIDogaCAtIGwgPiBrLm1vZCAvIDIgJiYgKGggLT0gay5tb2QpKSwgbltnXSA9IGQoKGwgLSBoKSAqIGIgKyBoLCBmKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tmXShuKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYmxlbmQ6IGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IHRoaXMuX3JnYmFbM10pIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX3JnYmEuc2xpY2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBkLnBvcCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGsoYykuX3JnYmE7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBrKGEubWFwKGQsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMSAtIGUpICogZltiXSArIGUgKiBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdG9SZ2JhU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAicmdiYSgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEubWFwKHRoaXMuX3JnYmEsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhID8gMiA8IGIgPyAxIDogMCA6IGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAxID09PSBkWzNdICYmIChkLnBvcCgpLCBjID0gInJnYigiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgKyBkLmpvaW4oKSArICIpIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdG9Ic2xhU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAiaHNsYSgiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEubWFwKHRoaXMuaHNsYSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSBhICYmIChhID0gMiA8IGIgPyAxIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgJiYgMyA+IGIgJiYgKGEgPSBNYXRoLnJvdW5kKDEwMCAqIGEpICsgIiUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgMSA9PT0gZFszXSAmJiAoZC5wb3AoKSwgYyA9ICJoc2woIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjICsgZC5qb2luKCkgKyAiKSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRvSGV4U3RyaW5nOiBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fcmdiYS5zbGljZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGQucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYgZC5wdXNoKH5+KDI1NSAqIGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIjIiArIGEubWFwKGQsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAoYSB8fCAwKS50b1N0cmluZygxNik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSA9PT0gYS5sZW5ndGggPyAiMCIgKyBhIDogYQogICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCIiKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5fcmdiYVszXSA/ICJ0cmFuc3BhcmVudCIgOiB0aGlzLnRvUmdiYVN0cmluZygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBrLmZuLnBhcnNlLnByb3RvdHlwZSA9IGsuZm47CiAgICAgICAgICAgICAgICBsLmhzbGEudG8gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gYVswXSB8fCBudWxsID09IGFbMV0gfHwgbnVsbCA9PSBhWzJdKSByZXR1cm4gW251bGwsIG51bGwsIG51bGwsIGFbM11dOwogICAgICAgICAgICAgICAgICAgIHZhciBiID0KICAgICAgICAgICAgICAgICAgICAgICAgYVswXSAvIDI1NSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGFbMV0gLyAyNTUsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhWzJdIC8gMjU1OwogICAgICAgICAgICAgICAgICAgIGEgPSBhWzNdOwogICAgICAgICAgICAgICAgICAgIHZhciBlID0gTWF0aC5tYXgoYiwgYywgZCksCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBNYXRoLm1pbihiLCBjLCBkKSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUgLSBmLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gZSArIGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAuNSAqIGg7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtNYXRoLnJvdW5kKGYgPT09IGUgPyAwIDogYiA9PT0gZSA/IDYwICogKGMgLSBkKSAvIGcgKyAzNjAgOiBjID09PSBlID8gNjAgKiAoZCAtIGIpIC8gZyArIDEyMCA6IDYwICogKGIgLSBjKSAvIGcgKyAyNDApICUgMzYwLCAwID09PSBnID8gMCA6IC41ID49IGwgPyBnIC8gaCA6IGcgLyAoMiAtIGgpLCBsLCBudWxsID09IGEgPyAxIDogYV0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBsLmhzbGEuZnJvbSA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBhWzBdIHx8IG51bGwgPT0gYVsxXSB8fCBudWxsID09IGFbMl0pIHJldHVybiBbbnVsbCwgbnVsbCwgbnVsbCwgYVszXV07CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhWzBdIC8gMzYwLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gYVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGFbMl07CiAgICAgICAgICAgICAgICAgICAgYSA9IGFbM107CiAgICAgICAgICAgICAgICAgICAgYyA9IC41ID49IGQgPyBkICogKDEgKyBjKSA6IGQgKyBjIC0gZCAqIGM7CiAgICAgICAgICAgICAgICAgICAgZCA9IDIgKiBkIC0gYzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW01hdGgucm91bmQoMjU1ICogZihkLCBjLCBiICsgMSAvIDMpKSwgTWF0aC5yb3VuZCgyNTUgKiBmKGQsIGMsIGIpKSwgTWF0aC5yb3VuZCgyNTUgKiBmKGQsIGMsIGIgLSAxIC8gMykpLCBhXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHEobCwgZnVuY3Rpb24oZSwgZikgewogICAgICAgICAgICAgICAgICAgIHZhciBnID0KICAgICAgICAgICAgICAgICAgICAgICAgZi5wcm9wcywKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGYuY2FjaGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBmLnRvLAogICAgICAgICAgICAgICAgICAgICAgICBuID0gZi5mcm9tOwogICAgICAgICAgICAgICAgICAgIGsuZm5bZV0gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGwgJiYgIXRoaXNbaF0gJiYgKHRoaXNbaF0gPSBsKHRoaXMuX3JnYmEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPT09IGMpIHJldHVybiB0aGlzW2hdLnNsaWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmLCBtID0gYS50eXBlKGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9ICJhcnJheSIgPT09IG0gfHwgIm9iamVjdCIgPT09IG0gPyBlIDogYXJndW1lbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXNbaF0uc2xpY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcShnLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHJbIm9iamVjdCIgPT09IG0gPyBhIDogYi5pZHhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSBjICYmIChjID0gcFtiLmlkeF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcFtiLmlkeF0gPSBkKGMsIGIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbiA/IChmID0gayhuKHApKSwgZltoXSA9IHAsIGYpIDogayhwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcShnLCBmdW5jdGlvbihjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGsuZm5bY10gfHwgKGsuZm5bY10gPSBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEudHlwZShmKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gImFscGhhIiA9PT0gYyA/IHRoaXMuX2hzbGEgPyAiaHNsYSIgOiAicmdiYSIgOiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzW2hdKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGxbZC5pZHhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSBnKSByZXR1cm4gazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IGcgJiYgKGYgPSBmLmNhbGwodGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKSwgZyA9IGEudHlwZShmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBmICYmIGQuZW1wdHkpIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IGcgJiYgKGcgPSBtLmV4ZWMoZikpICYmIChmID0gayArIHBhcnNlRmxvYXQoZ1syXSkgKiAoIisiID09PSBnWzFdID8gMSA6IC0xKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsW2QuaWR4XSA9IGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1toXShsKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGsuaG9vayA9IGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICBjID0gYy5zcGxpdCgiICIpOwogICAgICAgICAgICAgICAgICAgIHEoYywgZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhLmNzc0hvb2tzW2RdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihjLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGggPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoInRyYW5zcGFyZW50IiAhPT0gZSAmJiAoInN0cmluZyIgIT09IGEudHlwZShlKSB8fCAoZiA9IGcoZSkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gayhmIHx8IGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW4ucmdiYSAmJiAxICE9PSBlLl9yZ2JhWzNdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSAiYmFja2dyb3VuZENvbG9yIiA9PT0gZCA/IGMucGFyZW50Tm9kZSA6IGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCIiID09PSBoIHx8ICJ0cmFuc3BhcmVudCIgPT09IGgpICYmIGYgJiYgZi5zdHlsZTspIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEuY3NzKGYsICJiYWNrZ3JvdW5kQ29sb3IiKSwgZiA9IGYucGFyZW50Tm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobCkge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBlLmJsZW5kKGggJiYgInRyYW5zcGFyZW50IiAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID8gaCA6ICJfZGVmYXVsdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUudG9SZ2JhU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5zdHlsZVtkXSA9IGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChsKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmZ4LnN0ZXBbZF0gPSBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmNvbG9ySW5pdCB8fCAoYy5zdGFydCA9IGsoYy5lbGVtLCBkKSwgYy5lbmQgPSBrKGMuZW5kKSwgYy5jb2xvckluaXQgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNzc0hvb2tzW2RdLnNldChjLmVsZW0sIGMuc3RhcnQudHJhbnNpdGlvbihjLmVuZCwgYy5wb3MpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBrLmhvb2soImJhY2tncm91bmRDb2xvciBib3JkZXJCb3R0b21Db2xvciBib3JkZXJMZWZ0Q29sb3IgYm9yZGVyUmlnaHRDb2xvciBib3JkZXJUb3BDb2xvciBjb2xvciBjb2x1bW5SdWxlQ29sb3Igb3V0bGluZUNvbG9yIHRleHREZWNvcmF0aW9uQ29sb3IgdGV4dEVtcGhhc2lzQ29sb3IiKTsKICAgICAgICAgICAgICAgIGEuY3NzSG9va3MuYm9yZGVyQ29sb3IgPSB7CiAgICAgICAgICAgICAgICAgICAgZXhwYW5kOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIHEoWyJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiXSwgZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYlsiYm9yZGVyIiArIGQgKyAiQ29sb3IiXSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgciA9IGEuQ29sb3IubmFtZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgYXF1YTogIiMwMGZmZmYiLAogICAgICAgICAgICAgICAgICAgIGJsYWNrOiAiIzAwMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgYmx1ZTogIiMwMDAwZmYiLAogICAgICAgICAgICAgICAgICAgIGZ1Y2hzaWE6ICIjZmYwMGZmIiwKICAgICAgICAgICAgICAgICAgICBncmF5OiAiIzgwODA4MCIsCiAgICAgICAgICAgICAgICAgICAgZ3JlZW46ICIjMDA4MDAwIiwKICAgICAgICAgICAgICAgICAgICBsaW1lOiAiIzAwZmYwMCIsCiAgICAgICAgICAgICAgICAgICAgbWFyb29uOiAiIzgwMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgbmF2eTogIiMwMDAwODAiLAogICAgICAgICAgICAgICAgICAgIG9saXZlOiAiIzgwODAwMCIsCiAgICAgICAgICAgICAgICAgICAgcHVycGxlOiAiIzgwMDA4MCIsCiAgICAgICAgICAgICAgICAgICAgcmVkOiAiI2ZmMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgc2lsdmVyOiAiI2MwYzBjMCIsCiAgICAgICAgICAgICAgICAgICAgdGVhbDogIiMwMDgwODAiLAogICAgICAgICAgICAgICAgICAgIHdoaXRlOiAiI2ZmZmZmZiIsCiAgICAgICAgICAgICAgICAgICAgeWVsbG93OiAiI2ZmZmYwMCIsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IFtudWxsLCBudWxsLCBudWxsLCAwXSwKICAgICAgICAgICAgICAgICAgICBfZGVmYXVsdDogIiNmZmZmZmYiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKGEpOwogICAgICAgICAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCA9IGIub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyA/IGIub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGIsIG51bGwpIDogYi5jdXJyZW50U3R5bGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmxlbmd0aCAmJiBkWzBdICYmIGRbZFswXV0pCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmxlbmd0aDsgYi0tOykgYyA9IGRbYl0sICJzdHJpbmciID09PSB0eXBlb2YgZFtjXSAmJiAoaFthLmNhbWVsQ2FzZShjKV0gPSBkW2NdKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBkKSAic3RyaW5nIiA9PT0gdHlwZW9mIGRbY10gJiYgKGhbY10gPSBkW2NdKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGMgPSBbImFkZCIsICJyZW1vdmUiLCAidG9nZ2xlIl0sCiAgICAgICAgICAgICAgICAgICAgZCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAxLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJCb3R0b206IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAxLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0OiAxLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyVG9wOiAxLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAxLAogICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGEuZWFjaChbImJvcmRlckxlZnRTdHlsZSIsICJib3JkZXJSaWdodFN0eWxlIiwgImJvcmRlckJvdHRvbVN0eWxlIiwgImJvcmRlclRvcFN0eWxlIl0sIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICBhLmZ4LnN0ZXBbY10gPSBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibm9uZSIgIT09IGIuZW5kICYmICFiLnNldEF0dHIgfHwgMSA9PT0gYi5wb3MgJiYgIWIuc2V0QXR0cikgYS5zdHlsZShiLmVsZW0sIGMsIGIuZW5kKSwgYi5zZXRBdHRyID0gITAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGEuZm4uYWRkQmFjayB8fAogICAgICAgICAgICAgICAgICAgIChhLmZuLmFkZEJhY2sgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChudWxsID09IGEgPyB0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKGEpKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLmFuaW1hdGVDbGFzcyA9IGZ1bmN0aW9uKGcsIGYsIG0sIGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IGEuc3BlZWQoZiwgbSwgaCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBmLmF0dHIoImNsYXNzIikgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLCBtID0gay5jaGlsZHJlbiA/IGYuZmluZCgiKiIpLmFkZEJhY2soKSA6IGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gbS5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBiKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChjLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdbYl0pIGZbYiArICJDbGFzcyJdKGdbYl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBtLm1hcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW5kID0gYih0aGlzLmVsWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5zdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5lbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcsIGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgaW4gZSkgaCA9IGVbZ10sIGNbZ10gPT09IGggfHwgZFtnXSB8fCAhYS5meC5zdGVwW2ddICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNOYU4ocGFyc2VGbG9hdChoKSkgfHwgKGZbZ10gPSBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlmZiA9IGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZi5hdHRyKCJjbGFzcyIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBtID0gbS5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEuRGVmZXJyZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS5leHRlbmQoe30sIGssIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnJlc29sdmUoYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5hbmltYXRlKHRoaXMuZGlmZiwgZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5wcm9taXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEud2hlbi5hcHBseShhLCBtLmdldCgpKS5kb25lKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmVsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaCh0aGlzLmRpZmYsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5jc3MoYSwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgay5jb21wbGV0ZS5jYWxsKGZbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBhLmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3M6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMsIGQsIGgsIGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gYS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkOiBjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLCBrKSA6IGIuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfShhLmZuLmFkZENsYXNzKSwKICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzczogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYywgZCwgaCwgaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgPCBhcmd1bWVudHMubGVuZ3RoID8gYS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmU6IGMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGQsIGgsIGspIDogYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KGEuZm4ucmVtb3ZlQ2xhc3MpLAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjLCBkLCBoLCBrLCBsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gImJvb2xlYW4iID09PSB0eXBlb2YgZCB8fCB2b2lkIDAgPT09IGQgPyBoID8gYS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMsIGQgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkOiBjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZTogYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgaCwgaywgbCkgOiBiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBhLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZTogYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwgaCwgaykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0oYS5mbi50b2dnbGVDbGFzcyksCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoQ2xhc3M6IGZ1bmN0aW9uKGIsIGMsIGQsIGgsIGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZWZmZWN0cy5hbmltYXRlQ2xhc3MuY2FsbCh0aGlzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGQ6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmU6IGIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCwgaCwgaykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKGIsIGMsIGYsIGspIHsKICAgICAgICAgICAgICAgICAgICBhLmlzUGxhaW5PYmplY3QoYikgJiYgKGMgPSBiLCBiID0gYi5lZmZlY3QpOwogICAgICAgICAgICAgICAgICAgIGIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVmZmVjdDogYgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSBjICYmIChjID0ge30pOwogICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihjKSAmJiAoayA9IGMsIGYgPSBudWxsLCBjID0ge30pOwogICAgICAgICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGMgfHwgYS5meC5zcGVlZHNbY10pIGsgPSBmLCBmID0gYywgYyA9IHt9OwogICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihmKSAmJiAoayA9IGYsIGYgPSBudWxsKTsKICAgICAgICAgICAgICAgICAgICBjICYmIGEuZXh0ZW5kKGIsIGMpOwogICAgICAgICAgICAgICAgICAgIGYgPSBmIHx8IGMuZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgYi5kdXJhdGlvbiA9IGEuZngub2ZmID8gMCA6ICJudW1iZXIiID09PSB0eXBlb2YgZiA/IGYgOiBmIGluIGEuZnguc3BlZWRzID8gYS5meC5zcGVlZHNbZl0gOiBhLmZ4LnNwZWVkcy5fZGVmYXVsdDsKICAgICAgICAgICAgICAgICAgICBiLmNvbXBsZXRlID0gayB8fCBjLmNvbXBsZXRlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFiIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYiB8fCBhLmZ4LnNwZWVkc1tiXSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGIgJiYgIWEuZWZmZWN0cy5lZmZlY3RbYl0gfHwKICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGIpIHx8ICJvYmplY3QiID09PSB0eXBlb2YgYiAmJiAhYi5lZmZlY3QgPyAhMCA6ICExCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhLmV4dGVuZChhLmVmZmVjdHMsIHsKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgICAgICBzYXZlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykgbnVsbCAhPT0gYltjXSAmJiBhLmRhdGEoInVpLWVmZmVjdHMtIiArIGJbY10sIGFbMF0uc3R5bGVbYltjXV0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByZXN0b3JlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBrOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgYi5sZW5ndGg7IGsrKykgbnVsbCAhPT0gYltrXSAmJiAoYyA9IGEuZGF0YSgidWktZWZmZWN0cy0iICsgYltrXSksIHZvaWQgMCA9PT0gYyAmJiAoYyA9ICIiKSwgYS5jc3MoYltrXSwgYykpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXRNb2RlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0b2dnbGUiID09PSBiICYmIChiID0gYS5pcygiOmhpZGRlbiIpID8gInNob3ciIDogImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGdldEJhc2VsaW5lOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBrOwogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAuNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhWzBdIC8gYi5oZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gLjU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhWzFdIC8gYi53aWR0aAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogYwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVXcmFwcGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLnBhcmVudCgpLmlzKCIudWktZWZmZWN0cy13cmFwcGVyIikpIHJldHVybiBiLnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYi5vdXRlcldpZHRoKCEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIub3V0ZXJIZWlnaHQoITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmbG9hdCI6IGIuY3NzKCJmbG9hdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGEoIjxkaXY+PC9kaXY+IikuYWRkQ2xhc3MoInVpLWVmZmVjdHMtd3JhcHBlciIpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICIxMDAlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogIm5vbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGIud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGIuaGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAocCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGRvY3VtZW50LmJvZHkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBiLndyYXAoZik7CiAgICAgICAgICAgICAgICAgICAgICAgIChiWzBdID09PSBoIHx8IGEuY29udGFpbnMoYlswXSwgaCkpICYmIGEoaCkuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGIucGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0aWMiID09PSBiLmNzcygicG9zaXRpb24iKSA/IChmLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIgogICAgICAgICAgICAgICAgICAgICAgICB9KSwgYi5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIKICAgICAgICAgICAgICAgICAgICAgICAgfSkpIDogKGEuZXh0ZW5kKGMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBiLmNzcygicG9zaXRpb24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogYi5jc3MoInotaW5kZXgiKQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgYS5lYWNoKFsidG9wIiwgImxlZnQiLCAiYm90dG9tIiwgInJpZ2h0Il0sIGZ1bmN0aW9uKGEsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbZl0gPSBiLmNzcyhmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTmFOKHBhcnNlSW50KGNbZl0sIDEwKSkgJiYgKGNbZl0gPSAiYXV0byIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBiLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodDogImF1dG8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiAiYXV0byIKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmNzcyhrKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYuY3NzKGMpLnNob3coKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlV3JhcHBlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgICAgICAgICAgICAgICAgICAgICBiLnBhcmVudCgpLmlzKCIudWktZWZmZWN0cy13cmFwcGVyIikgJiYgKGIucGFyZW50KCkucmVwbGFjZVdpdGgoYiksIChiWzBdID09PSBjIHx8IGEuY29udGFpbnMoYlswXSwgYykpICYmIGEoYykuZm9jdXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbihiLCBjLCBmLCBrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBrIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmVhY2goYywgZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBiLmNzc1VuaXQoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgZ1swXSAmJiAoa1tjXSA9IGdbMF0gKiBmICsgZ1sxXSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBhLmZuLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgZWZmZWN0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBkKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaXNGdW5jdGlvbihmKSAmJiBmLmNhbGwoZVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pc0Z1bmN0aW9uKGIpICYmIGIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBnLmNvbXBsZXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBnLm1vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZS5pcygiOmhpZGRlbiIpID8gImhpZGUiID09PSBrIDogInNob3ciID09PSBrKSA/IChlW2tdKCksIGQoKSkgOiBoLmNhbGwoZVswXSwgZywgZCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGIuYXBwbHkodGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGcubW9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBnLnF1ZXVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEuZWZmZWN0cy5lZmZlY3RbZy5lZmZlY3RdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5meC5vZmYgfHwgIWggPyBmID8gdGhpc1tmXShnLmR1cmF0aW9uLCBnLmNvbXBsZXRlKSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuY29tcGxldGUgJiYgZy5jb21wbGV0ZS5jYWxsKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogITEgPT09IGsgPyB0aGlzLmVhY2goYykgOiB0aGlzLnF1ZXVlKGsgfHwgImZ4IiwgYykKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNob3c6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKGcpKSByZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLm1vZGUgPSAic2hvdyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lZmZlY3QuY2FsbCh0aGlzLCBmKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfShhLmZuLnNob3cpLAogICAgICAgICAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKGcpKSByZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLm1vZGUgPSAiaGlkZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lZmZlY3QuY2FsbCh0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KGEuZm4uaGlkZSksCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyhnKSB8fCAiYm9vbGVhbiIgPT09IHR5cGVvZiBnKSByZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLm1vZGUgPSAidG9nZ2xlIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVmZmVjdC5jYWxsKHRoaXMsIGYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KGEuZm4udG9nZ2xlKSwKICAgICAgICAgICAgICAgICAgICBjc3NVbml0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5jc3MoYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZWFjaChbImVtIiwgInB4IiwgIiUiLCAicHQiXSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8IGMuaW5kZXhPZihiKSAmJiAoZiA9IFtwYXJzZUZsb2F0KGMpLCBiXSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGIgPSB7fTsKICAgICAgICAgICAgICAgIGEuZWFjaChbIlF1YWQiLCAiQ3ViaWMiLCAiUXVhcnQiLCAiUXVpbnQiLCAiRXhwbyJdLCBmdW5jdGlvbihhLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgYltkXSA9IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KGIsIGEgKyAyKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYS5leHRlbmQoYiwgewogICAgICAgICAgICAgICAgICAgIFNpbmU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5jb3MoYSAqIE1hdGguUEkgLyAyKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgQ2lyYzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSAtIE1hdGguc3FydCgxIC0gYSAqIGEpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBFbGFzdGljOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwID09PSBhIHx8IDEgPT09IGEgPyBhIDogLU1hdGgucG93KDIsIDggKiAoYSAtIDEpKSAqIE1hdGguc2luKCg4MCAqIChhIC0gMSkgLSA3LjUpICogTWF0aC5QSSAvIDE1KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgQmFjazogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSAqIGEgKiAoMyAqIGEgLSAyKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgQm91bmNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIsIGcgPSA0OyBhIDwgKChiID0gTWF0aC5wb3coMiwgLS1nKSkgLSAxKSAvIDExOyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxIC8gTWF0aC5wb3coNCwgMyAtIGcpIC0gNy41NjI1ICogTWF0aC5wb3coKDMgKiBiIC0gMikgLyAyMiAtIGEsIDIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBhLmVhY2goYiwgZnVuY3Rpb24oYiwgZCkgewogICAgICAgICAgICAgICAgICAgIGEuZWFzaW5nWyJlYXNlSW4iICsgYl0gPSBkOwogICAgICAgICAgICAgICAgICAgIGEuZWFzaW5nWyJlYXNlT3V0IiArIGJdID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSAtIGQoMSAtIGEpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBhLmVhc2luZ1siZWFzZUluT3V0IiArIGJdID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLjUgPiBhID8gZCgyICogYSkgLyAyIDogMSAtIGQoLTIgKiBhICsgMikgLyAyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5ibGluZCA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBnID0gInBvc2l0aW9uIHRvcCBib3R0b20gbGVmdCByaWdodCBoZWlnaHQgd2lkdGgiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgZiA9IGEuZWZmZWN0cy5zZXRNb2RlKGQsIGIubW9kZSB8fCAiaGlkZSIpLAogICAgICAgICAgICAgICAgICAgIGsgPSBiLmRpcmVjdGlvbiB8fCAidXAiLAogICAgICAgICAgICAgICAgICAgIGggPSAvdXB8ZG93bnx2ZXJ0aWNhbC8udGVzdChrKSwKICAgICAgICAgICAgICAgICAgICBwID0gaCA/ICJoZWlnaHQiIDogIndpZHRoIiwKICAgICAgICAgICAgICAgICAgICBsID0gaCA/ICJ0b3AiIDogImxlZnQiLAogICAgICAgICAgICAgICAgICAgIGsgPSAvdXB8bGVmdHx2ZXJ0aWNhbHxob3Jpem9udGFsLy50ZXN0KGspLAogICAgICAgICAgICAgICAgICAgIGUgPSB7fSwKICAgICAgICAgICAgICAgICAgICBuID0gInNob3ciID09PSBmLAogICAgICAgICAgICAgICAgICAgIHYsIHIsIHE7CiAgICAgICAgICAgICAgICBkLnBhcmVudCgpLmlzKCIudWktZWZmZWN0cy13cmFwcGVyIikgPyBhLmVmZmVjdHMuc2F2ZShkLnBhcmVudCgpLCBnKSA6IGEuZWZmZWN0cy5zYXZlKGQsIGcpOwogICAgICAgICAgICAgICAgZC5zaG93KCk7CiAgICAgICAgICAgICAgICB2ID0gYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoZCkuY3NzKHsKICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgciA9IHZbcF0oKTsKICAgICAgICAgICAgICAgIHEgPSBwYXJzZUZsb2F0KHYuY3NzKGwpKSB8fCAwOwogICAgICAgICAgICAgICAgZVtwXSA9IG4gPyByIDogMDsKICAgICAgICAgICAgICAgIGsgfHwgKGQuY3NzKGggPwogICAgICAgICAgICAgICAgICAgICJib3R0b20iIDogInJpZ2h0IiwgMCkuY3NzKGggPyAidG9wIiA6ICJsZWZ0IiwgImF1dG8iKS5jc3MoewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiCiAgICAgICAgICAgICAgICB9KSwgZVtsXSA9IG4gPyBxIDogciArIHEpOwogICAgICAgICAgICAgICAgbiAmJiAodi5jc3MocCwgMCksIGsgfHwgdi5jc3MobCwgcSArIHIpKTsKICAgICAgICAgICAgICAgIHYuYW5pbWF0ZShlLCB7CiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGIuZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiBiLmVhc2luZywKICAgICAgICAgICAgICAgICAgICBxdWV1ZTogITEsCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAiaGlkZSIgPT09IGYgJiYgZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZXN0b3JlKGQsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5ib3VuY2UgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZyA9ICJwb3NpdGlvbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQgaGVpZ2h0IHdpZHRoIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgIGYgPSBhLmVmZmVjdHMuc2V0TW9kZShkLCBiLm1vZGUgfHwgImVmZmVjdCIpLAogICAgICAgICAgICAgICAgICAgIGsgPSAiaGlkZSIgPT09IGYsCiAgICAgICAgICAgICAgICAgICAgaCA9ICJzaG93IiA9PT0gZiwKICAgICAgICAgICAgICAgICAgICBwID0gYi5kaXJlY3Rpb24gfHwgInVwIiwKICAgICAgICAgICAgICAgICAgICBmID0gYi5kaXN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBsID0gYi50aW1lcyB8fCA1LAogICAgICAgICAgICAgICAgICAgIGUgPQogICAgICAgICAgICAgICAgICAgIDIgKiBsICsgKGggfHwgayA/IDEgOiAwKSwKICAgICAgICAgICAgICAgICAgICBuID0gYi5kdXJhdGlvbiAvIGUsCiAgICAgICAgICAgICAgICAgICAgdiA9IGIuZWFzaW5nLAogICAgICAgICAgICAgICAgICAgIHIgPSAidXAiID09PSBwIHx8ICJkb3duIiA9PT0gcCA/ICJ0b3AiIDogImxlZnQiLAogICAgICAgICAgICAgICAgICAgIHAgPSAidXAiID09PSBwIHx8ICJsZWZ0IiA9PT0gcCwKICAgICAgICAgICAgICAgICAgICBxLCB1LCB6ID0gZC5xdWV1ZSgpLAogICAgICAgICAgICAgICAgICAgIHkgPSB6Lmxlbmd0aDsKICAgICAgICAgICAgICAgIChoIHx8IGspICYmIGcucHVzaCgib3BhY2l0eSIpOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLnNhdmUoZCwgZyk7CiAgICAgICAgICAgICAgICBkLnNob3coKTsKICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGQpOwogICAgICAgICAgICAgICAgZiB8fCAoZiA9IGRbInRvcCIgPT09IHIgPyAib3V0ZXJIZWlnaHQiIDogIm91dGVyV2lkdGgiXSgpIC8gMyk7CiAgICAgICAgICAgICAgICBoICYmICh1ID0gewogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEKICAgICAgICAgICAgICAgIH0sIHVbcl0gPSAwLCBkLmNzcygib3BhY2l0eSIsIDApLmNzcyhyLCBwID8gMiAqIC1mIDogMiAqIGYpLmFuaW1hdGUodSwgbiwgdikpOwogICAgICAgICAgICAgICAgayAmJiAoZiAvPSBNYXRoLnBvdygyLCBsIC0gMSkpOwogICAgICAgICAgICAgICAgdSA9IHt9OwogICAgICAgICAgICAgICAgZm9yIChoID0gdVtyXSA9IDA7IGggPCBsOyBoKyspIHEgPSB7fSwgcVtyXSA9IChwID8gIi09IiA6ICIrPSIpICsgZiwgZC5hbmltYXRlKHEsIG4sIHYpLmFuaW1hdGUodSwgbiwgdiksIGYgPSBrID8gMiAqIGYgOiBmIC8gMjsKICAgICAgICAgICAgICAgIGsgJiYgKHEgPSB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMAogICAgICAgICAgICAgICAgfSwgcVtyXSA9IChwID8gIi09IiA6ICIrPSIpICsgZiwgZC5hbmltYXRlKHEsCiAgICAgICAgICAgICAgICAgICAgbiwgdikpOwogICAgICAgICAgICAgICAgZC5xdWV1ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBrICYmIGQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZXN0b3JlKGQsIGcpOwogICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGQpOwogICAgICAgICAgICAgICAgICAgIGMoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAxIDwgeSAmJiB6LnNwbGljZS5hcHBseSh6LCBbMSwgMF0uY29uY2F0KHouc3BsaWNlKHksIGUgKyAxKSkpOwogICAgICAgICAgICAgICAgZC5kZXF1ZXVlKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5jbGlwID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIGcgPSAicG9zaXRpb24gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0IGhlaWdodCB3aWR0aCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgICAgICBmID0gInNob3ciID09PSBhLmVmZmVjdHMuc2V0TW9kZShkLCBiLm1vZGUgfHwgImhpZGUiKSwKICAgICAgICAgICAgICAgICAgICBrID0gInZlcnRpY2FsIiA9PT0gKGIuZGlyZWN0aW9uIHx8ICJ2ZXJ0aWNhbCIpLAogICAgICAgICAgICAgICAgICAgIGggPSBrID8gImhlaWdodCIgOiAid2lkdGgiLAogICAgICAgICAgICAgICAgICAgIGsgPSBrID8gInRvcCIgOiAibGVmdCIsCiAgICAgICAgICAgICAgICAgICAgcCA9IHt9LAogICAgICAgICAgICAgICAgICAgIGwsIGU7CiAgICAgICAgICAgICAgICBhLmVmZmVjdHMuc2F2ZShkLCBnKTsKICAgICAgICAgICAgICAgIGQuc2hvdygpOwogICAgICAgICAgICAgICAgbCA9IGEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGQpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICJoaWRkZW4iCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGwgPSAiSU1HIiA9PT0gZFswXS50YWdOYW1lID8KICAgICAgICAgICAgICAgICAgICBsIDogZDsKICAgICAgICAgICAgICAgIGUgPSBsW2hdKCk7CiAgICAgICAgICAgICAgICBmICYmIChsLmNzcyhoLCAwKSwgbC5jc3MoaywgZSAvIDIpKTsKICAgICAgICAgICAgICAgIHBbaF0gPSBmID8gZSA6IDA7CiAgICAgICAgICAgICAgICBwW2tdID0gZiA/IDAgOiBlIC8gMjsKICAgICAgICAgICAgICAgIGwuYW5pbWF0ZShwLCB7CiAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBiLmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgIGVhc2luZzogYi5lYXNpbmcsCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmIHx8IGQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVzdG9yZShkLCBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3QuZHJvcCA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBnID0gInBvc2l0aW9uIHRvcCBib3R0b20gbGVmdCByaWdodCBvcGFjaXR5IGhlaWdodCB3aWR0aCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgICAgICBmID0gYS5lZmZlY3RzLnNldE1vZGUoZCwgYi5tb2RlIHx8ICJoaWRlIiksCiAgICAgICAgICAgICAgICAgICAgayA9ICJzaG93IiA9PT0gZiwKICAgICAgICAgICAgICAgICAgICBoID0gYi5kaXJlY3Rpb24gfHwgImxlZnQiLAogICAgICAgICAgICAgICAgICAgIHAgPSAidXAiID09PSBoIHx8ICJkb3duIiA9PT0gaCA/ICJ0b3AiIDogImxlZnQiLAogICAgICAgICAgICAgICAgICAgIGggPSAidXAiID09PSBoIHx8ICJsZWZ0IiA9PT0gaCA/ICJwb3MiIDogIm5lZyIsCiAgICAgICAgICAgICAgICAgICAgbCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogayA/IDEgOiAwCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBlOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLnNhdmUoZCwKICAgICAgICAgICAgICAgICAgICBnKTsKICAgICAgICAgICAgICAgIGQuc2hvdygpOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoZCk7CiAgICAgICAgICAgICAgICBlID0gYi5kaXN0YW5jZSB8fCBkWyJ0b3AiID09PSBwID8gIm91dGVySGVpZ2h0IiA6ICJvdXRlcldpZHRoIl0oITApIC8gMjsKICAgICAgICAgICAgICAgIGsgJiYgZC5jc3MoIm9wYWNpdHkiLCAwKS5jc3MocCwgInBvcyIgPT09IGggPyAtZSA6IGUpOwogICAgICAgICAgICAgICAgbFtwXSA9IChrID8gInBvcyIgPT09IGggPyAiKz0iIDogIi09IiA6ICJwb3MiID09PSBoID8gIi09IiA6ICIrPSIpICsgZTsKICAgICAgICAgICAgICAgIGQuYW5pbWF0ZShsLCB7CiAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBiLmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgIGVhc2luZzogYi5lYXNpbmcsCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAiaGlkZSIgPT09IGYgJiYgZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZXN0b3JlKGQsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5leHBsb2RlID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gZCgpIHsKICAgICAgICAgICAgICAgICAgICBuLnB1c2godGhpcyk7CiAgICAgICAgICAgICAgICAgICAgbi5sZW5ndGggPT09IGcgKiBmICYmIChrLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICJ2aXNpYmxlIgogICAgICAgICAgICAgICAgICAgIH0pLCBhKG4pLnJlbW92ZSgpLCBoIHx8IGsuaGlkZSgpLCBjKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZyA9IGIucGllY2VzID8KICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKE1hdGguc3FydChiLnBpZWNlcykpIDogMywKICAgICAgICAgICAgICAgICAgICBmID0gZywKICAgICAgICAgICAgICAgICAgICBrID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBoID0gInNob3ciID09PSBhLmVmZmVjdHMuc2V0TW9kZShrLCBiLm1vZGUgfHwgImhpZGUiKSwKICAgICAgICAgICAgICAgICAgICBwID0gay5zaG93KCkuY3NzKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpLm9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgIGwgPSBNYXRoLmNlaWwoay5vdXRlcldpZHRoKCkgLyBmKSwKICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5jZWlsKGsub3V0ZXJIZWlnaHQoKSAvIGcpLAogICAgICAgICAgICAgICAgICAgIG4gPSBbXSwKICAgICAgICAgICAgICAgICAgICB2LCByLCBxLCB1LCB6LCB5OwogICAgICAgICAgICAgICAgZm9yICh2ID0gMDsgdiA8IGc7IHYrKykKICAgICAgICAgICAgICAgICAgICBmb3IgKHUgPSBwLnRvcCArIHYgKiBlLCB5ID0gdiAtIChnIC0gMSkgLyAyLCByID0gMDsgciA8IGY7IHIrKykgcSA9IHAubGVmdCArIHIgKiBsLCB6ID0gciAtIChmIC0gMSkgLyAyLCBrLmNsb25lKCkuYXBwZW5kVG8oImJvZHkiKS53cmFwKCI8ZGl2PjwvZGl2PiIpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAidmlzaWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IC1yICogbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAtdiAqIGUKICAgICAgICAgICAgICAgICAgICB9KS5wYXJlbnQoKS5hZGRDbGFzcygidWktZWZmZWN0cy1leHBsb2RlIikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcSArIChoID8geiAqIGwgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB1ICsgKGggPyB5ICogZSA6IDApLAogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBoID8gMCA6IDEKICAgICAgICAgICAgICAgICAgICB9KS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcSArIChoID8gMCA6IHogKiBsKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB1ICsgKGggPyAwIDogeSAqIGUpLAogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBoID8gMSA6IDAKICAgICAgICAgICAgICAgICAgICB9LCBiLmR1cmF0aW9uIHx8IDUwMCwgYi5lYXNpbmcsIGQpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3QuZmFkZSA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBnID0gYS5lZmZlY3RzLnNldE1vZGUoZCwgYi5tb2RlIHx8ICJ0b2dnbGUiKTsKICAgICAgICAgICAgICAgIGQuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogZwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHF1ZXVlOiAhMSwKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICBlYXNpbmc6IGIuZWFzaW5nLAogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBjCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmVmZmVjdHMuZWZmZWN0LmZvbGQgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZyA9ICJwb3NpdGlvbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQgaGVpZ2h0IHdpZHRoIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgICAgICAgIGYgPSBhLmVmZmVjdHMuc2V0TW9kZShkLCBiLm1vZGUgfHwgImhpZGUiKSwKICAgICAgICAgICAgICAgICAgICBrID0gInNob3ciID09PSBmLAogICAgICAgICAgICAgICAgICAgIGggPSAiaGlkZSIgPT09IGYsCiAgICAgICAgICAgICAgICAgICAgZiA9IGIuc2l6ZSB8fCAxNSwKICAgICAgICAgICAgICAgICAgICBwID0gLyhbMC05XSspJS8uZXhlYyhmKSwKICAgICAgICAgICAgICAgICAgICBsID0gISFiLmhvcml6Rmlyc3QsCiAgICAgICAgICAgICAgICAgICAgZSA9IGsgIT09IGwsCiAgICAgICAgICAgICAgICAgICAgbiA9IGUgPyBbIndpZHRoIiwgImhlaWdodCJdIDogWyJoZWlnaHQiLCAid2lkdGgiXSwKICAgICAgICAgICAgICAgICAgICB2ID0gYi5kdXJhdGlvbiAvIDIsCiAgICAgICAgICAgICAgICAgICAgciwgcSA9IHt9LAogICAgICAgICAgICAgICAgICAgIHUgPSB7fTsKICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5zYXZlKGQsIGcpOwogICAgICAgICAgICAgICAgZC5zaG93KCk7CiAgICAgICAgICAgICAgICByID0gYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoZCkuY3NzKHsKICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZSA9IGUgPyBbci53aWR0aCgpLCByLmhlaWdodCgpXSA6IFtyLmhlaWdodCgpLCByLndpZHRoKCldOwogICAgICAgICAgICAgICAgcCAmJiAoZiA9IHBhcnNlSW50KHBbMV0sIDEwKSAvIDEwMCAqIGVbaCA/IDAgOiAxXSk7CiAgICAgICAgICAgICAgICBrICYmIHIuY3NzKGwgPyB7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmCiAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgIGhlaWdodDogZiwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBxW25bMF1dID0gayA/IGVbMF0gOiBmOwogICAgICAgICAgICAgICAgdVtuWzFdXSA9IGsgPyBlWzFdIDogMDsKICAgICAgICAgICAgICAgIHIuYW5pbWF0ZShxLCB2LCBiLmVhc2luZykuYW5pbWF0ZSh1LCB2LCBiLmVhc2luZywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaCAmJiBkLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVzdG9yZShkLCBnKTsKICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihkKTsKICAgICAgICAgICAgICAgICAgICBjKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3QuaGlnaGxpZ2h0ID0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBbImJhY2tncm91bmRJbWFnZSIsICJiYWNrZ3JvdW5kQ29sb3IiLCAib3BhY2l0eSJdLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gYS5lZmZlY3RzLnNldE1vZGUoZCwgYi5tb2RlIHx8ICJzaG93IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGQuY3NzKCJiYWNrZ3JvdW5kQ29sb3IiKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICJoaWRlIiA9PT0gZiAmJiAoay5vcGFjaXR5ID0gMCk7CiAgICAgICAgICAgICAgICAgICAgYS5lZmZlY3RzLnNhdmUoZCwgZyk7CiAgICAgICAgICAgICAgICAgICAgZC5zaG93KCkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAibm9uZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogYi5jb2xvciB8fCAiI2ZmZmY5OSIKICAgICAgICAgICAgICAgICAgICB9KS5hbmltYXRlKGssIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiBiLmVhc2luZywKICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImhpZGUiID09PSBmICYmIGQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5lZmZlY3RzLnJlc3RvcmUoZCwgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBhLmVmZmVjdHMuZWZmZWN0LnNpemUgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCwgZywgZiwgaywgaCwgcCwgbCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZSA9ICJwb3NpdGlvbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQgd2lkdGggaGVpZ2h0IG92ZXJmbG93IG9wYWNpdHkiLnNwbGl0KCIgIik7CiAgICAgICAgICAgICAgICBoID0gInBvc2l0aW9uIHRvcCBib3R0b20gbGVmdCByaWdodCBvdmVyZmxvdyBvcGFjaXR5Ii5zcGxpdCgiICIpOwogICAgICAgICAgICAgICAgdmFyIG4gPSBbIndpZHRoIiwgImhlaWdodCIsICJvdmVyZmxvdyJdLAogICAgICAgICAgICAgICAgICAgIHYgPSBbImZvbnRTaXplIl0sCiAgICAgICAgICAgICAgICAgICAgciA9IFsiYm9yZGVyVG9wV2lkdGgiLCAiYm9yZGVyQm90dG9tV2lkdGgiLCAicGFkZGluZ1RvcCIsICJwYWRkaW5nQm90dG9tIl0sCiAgICAgICAgICAgICAgICAgICAgcSA9IFsiYm9yZGVyTGVmdFdpZHRoIiwgImJvcmRlclJpZ2h0V2lkdGgiLCAicGFkZGluZ0xlZnQiLCAicGFkZGluZ1JpZ2h0Il0sCiAgICAgICAgICAgICAgICAgICAgdSA9IGEuZWZmZWN0cy5zZXRNb2RlKGwsIGIubW9kZSB8fCAiZWZmZWN0IiksCiAgICAgICAgICAgICAgICAgICAgeiA9IGIucmVzdG9yZSB8fCAiZWZmZWN0IiAhPT0gdSwKICAgICAgICAgICAgICAgICAgICB5ID0gYi5zY2FsZSB8fCAiYm90aCI7CiAgICAgICAgICAgICAgICBwID0gYi5vcmlnaW4gfHwgWyJtaWRkbGUiLCAiY2VudGVyIl07CiAgICAgICAgICAgICAgICB2YXIgRCA9IGwuY3NzKCJwb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgICAgIEMgPSB6ID8gZSA6IGgsCiAgICAgICAgICAgICAgICAgICAgRiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJIZWlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IDAKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgInNob3ciID09PSB1ICYmIGwuc2hvdygpOwogICAgICAgICAgICAgICAgaCA9IHsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGwuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGwud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogbC5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IGwub3V0ZXJXaWR0aCgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgInRvZ2dsZSIgPT09IGIubW9kZSAmJiAic2hvdyIgPT09IHUgPyAobC5mcm9tID0gYi50byB8fCBGLCBsLnRvID0gYi5mcm9tIHx8IGgpIDogKGwuZnJvbSA9IGIuZnJvbSB8fCAoInNob3ciID09PSB1ID8gRiA6IGgpLCBsLnRvID0gYi50byB8fCAoImhpZGUiID09PSB1ID8gRiA6IGgpKTsKICAgICAgICAgICAgICAgIGYgPSBsLmZyb20uaGVpZ2h0IC8gaC5oZWlnaHQ7CiAgICAgICAgICAgICAgICBrID0gbC5mcm9tLndpZHRoIC8gaC53aWR0aDsKICAgICAgICAgICAgICAgIGQgPSBsLnRvLmhlaWdodCAvIGguaGVpZ2h0OwogICAgICAgICAgICAgICAgZyA9IGwudG8ud2lkdGggLyBoLndpZHRoOwogICAgICAgICAgICAgICAgaWYgKCJib3giID09PSB5IHx8ICJib3RoIiA9PT0geSkgZiAhPT0gZCAmJiAoQyA9IEMuY29uY2F0KHIpLCBsLmZyb20gPSBhLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihsLCByLCBmLCBsLmZyb20pLCBsLnRvID0gYS5lZmZlY3RzLnNldFRyYW5zaXRpb24obCwgciwgZCwgbC50bykpLCBrICE9PSBnICYmIChDID0gQy5jb25jYXQocSksIGwuZnJvbSA9IGEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGwsIHEsIGssIGwuZnJvbSksIGwudG8gPSBhLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihsLAogICAgICAgICAgICAgICAgICAgIHEsIGcsIGwudG8pKTsKICAgICAgICAgICAgICAgICJjb250ZW50IiAhPT0geSAmJiAiYm90aCIgIT09IHkgfHwgZiA9PT0gZCB8fCAoQyA9IEMuY29uY2F0KHYpLmNvbmNhdChuKSwgbC5mcm9tID0gYS5lZmZlY3RzLnNldFRyYW5zaXRpb24obCwgdiwgZiwgbC5mcm9tKSwgbC50byA9IGEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGwsIHYsIGQsIGwudG8pKTsKICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5zYXZlKGwsIEMpOwogICAgICAgICAgICAgICAgbC5zaG93KCk7CiAgICAgICAgICAgICAgICBhLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihsKTsKICAgICAgICAgICAgICAgIGwuY3NzKCJvdmVyZmxvdyIsICJoaWRkZW4iKS5jc3MobC5mcm9tKTsKICAgICAgICAgICAgICAgIHAgJiYgKHAgPSBhLmVmZmVjdHMuZ2V0QmFzZWxpbmUocCwgaCksIGwuZnJvbS50b3AgPSAoaC5vdXRlckhlaWdodCAtIGwub3V0ZXJIZWlnaHQoKSkgKiBwLnksIGwuZnJvbS5sZWZ0ID0gKGgub3V0ZXJXaWR0aCAtIGwub3V0ZXJXaWR0aCgpKSAqIHAueCwgbC50by50b3AgPSAoaC5vdXRlckhlaWdodCAtIGwudG8ub3V0ZXJIZWlnaHQpICogcC55LCBsLnRvLmxlZnQgPSAoaC5vdXRlcldpZHRoIC0gbC50by5vdXRlcldpZHRoKSAqIHAueCk7CiAgICAgICAgICAgICAgICBsLmNzcyhsLmZyb20pOwogICAgICAgICAgICAgICAgaWYgKCJjb250ZW50IiA9PT0geSB8fAogICAgICAgICAgICAgICAgICAgICJib3RoIiA9PT0geSkgciA9IHIuY29uY2F0KFsibWFyZ2luVG9wIiwgIm1hcmdpbkJvdHRvbSJdKS5jb25jYXQodiksIHEgPSBxLmNvbmNhdChbIm1hcmdpbkxlZnQiLCAibWFyZ2luUmlnaHQiXSksIG4gPSBlLmNvbmNhdChyKS5jb25jYXQocSksIGwuZmluZCgiKlt3aWR0aF0iKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGMuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBjLndpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBjLm91dGVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBjLm91dGVyV2lkdGgoKTsKICAgICAgICAgICAgICAgICAgICB6ICYmIGEuZWZmZWN0cy5zYXZlKGMsIG4pOwogICAgICAgICAgICAgICAgICAgIGMuZnJvbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlICogZiwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGggKiBrLAogICAgICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogbCAqIGYsCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IHAgKiBrCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnRvID0gewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGUgKiBkLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaCAqIGcsCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVySGVpZ2h0OiBlICogZCwKICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJXaWR0aDogaCAqIGcKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGYgIT09IGQgJiYgKGMuZnJvbSA9IGEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsIHIsIGYsIGMuZnJvbSksIGMudG8gPSBhLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLCByLCBkLCBjLnRvKSk7CiAgICAgICAgICAgICAgICAgICAgayAhPT0gZyAmJiAoYy5mcm9tID0gYS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYywKICAgICAgICAgICAgICAgICAgICAgICAgcSwgaywgYy5mcm9tKSwgYy50byA9IGEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsIHEsIGcsIGMudG8pKTsKICAgICAgICAgICAgICAgICAgICBjLmNzcyhjLmZyb20pOwogICAgICAgICAgICAgICAgICAgIGMuYW5pbWF0ZShjLnRvLCBiLmR1cmF0aW9uLCBiLmVhc2luZywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHogJiYgYS5lZmZlY3RzLnJlc3RvcmUoYywgbikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsLmFuaW1hdGUobC50bywgewogICAgICAgICAgICAgICAgICAgIHF1ZXVlOiAhMSwKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICBlYXNpbmc6IGIuZWFzaW5nLAogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gbC50by5vcGFjaXR5ICYmIGwuY3NzKCJvcGFjaXR5IiwgbC5mcm9tLm9wYWNpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAiaGlkZSIgPT09IHUgJiYgbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZXN0b3JlKGwsIEMpOwogICAgICAgICAgICAgICAgICAgICAgICB6IHx8ICgic3RhdGljIiA9PT0gRCA/IGwuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBsLnRvLnRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGwudG8ubGVmdAogICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGEuZWFjaChbInRvcCIsICJsZWZ0Il0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuY3NzKGIsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHBhcnNlSW50KGMsIDEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEgPyBsLnRvLmxlZnQgOiBsLnRvLnRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gImF1dG8iID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID8gZSArICJweCIgOiBkICsgZSArICJweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIobCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3Quc2NhbGUgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZyA9IGEuZXh0ZW5kKCEwLCB7fSwgYiksCiAgICAgICAgICAgICAgICAgICAgZiA9IGEuZWZmZWN0cy5zZXRNb2RlKGQsIGIubW9kZSB8fCAiZWZmZWN0IiksCiAgICAgICAgICAgICAgICAgICAgayA9IHBhcnNlSW50KGIucGVyY2VudCwgMTApIHx8ICgwID09PSBwYXJzZUludChiLnBlcmNlbnQsIDEwKSA/IDAgOiAiaGlkZSIgPT09IGYgPyAwIDogMTAwKSwKICAgICAgICAgICAgICAgICAgICBoID0gYi5kaXJlY3Rpb24gfHwgImJvdGgiLAogICAgICAgICAgICAgICAgICAgIHAgPSBiLm9yaWdpbiwKICAgICAgICAgICAgICAgICAgICBsID0gewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGQuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBkLndpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVySGVpZ2h0OiBkLm91dGVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IGQub3V0ZXJXaWR0aCgpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBlID0gImhvcml6b250YWwiICE9PSBoID8gayAvIDEwMCA6IDEsCiAgICAgICAgICAgICAgICAgICAgayA9ICJ2ZXJ0aWNhbCIgIT09IGggPyBrIC8gMTAwIDogMTsKICAgICAgICAgICAgICAgIGcuZWZmZWN0ID0gInNpemUiOwogICAgICAgICAgICAgICAgZy5xdWV1ZSA9ICExOwogICAgICAgICAgICAgICAgZy5jb21wbGV0ZSA9IGM7CiAgICAgICAgICAgICAgICAiZWZmZWN0IiAhPT0gZiAmJiAoZy5vcmlnaW4gPSBwIHx8IFsibWlkZGxlIiwgImNlbnRlciJdLAogICAgICAgICAgICAgICAgICAgIGcucmVzdG9yZSA9ICEwKTsKICAgICAgICAgICAgICAgIGcuZnJvbSA9IGIuZnJvbSB8fCAoInNob3ciID09PSBmID8gewogICAgICAgICAgICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogMCwKICAgICAgICAgICAgICAgICAgICBvdXRlcldpZHRoOiAwCiAgICAgICAgICAgICAgICB9IDogbCk7CiAgICAgICAgICAgICAgICBnLnRvID0gewogICAgICAgICAgICAgICAgICAgIGhlaWdodDogbC5oZWlnaHQgKiBlLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBsLndpZHRoICogaywKICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogbC5vdXRlckhlaWdodCAqIGUsCiAgICAgICAgICAgICAgICAgICAgb3V0ZXJXaWR0aDogbC5vdXRlcldpZHRoICogawogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGcuZmFkZSAmJiAoInNob3ciID09PSBmICYmIChnLmZyb20ub3BhY2l0eSA9IDAsIGcudG8ub3BhY2l0eSA9IDEpLCAiaGlkZSIgPT09IGYgJiYgKGcuZnJvbS5vcGFjaXR5ID0gMSwgZy50by5vcGFjaXR5ID0gMCkpOwogICAgICAgICAgICAgICAgZC5lZmZlY3QoZykKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5wdWZmID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIGcgPSBhLmVmZmVjdHMuc2V0TW9kZShkLCBiLm1vZGUgfHwgImhpZGUiKSwKICAgICAgICAgICAgICAgICAgICBmID0gImhpZGUiID09PSBnLAogICAgICAgICAgICAgICAgICAgIGsgPSBwYXJzZUludChiLnBlcmNlbnQsIDEwKSB8fCAxNTAsCiAgICAgICAgICAgICAgICAgICAgaCA9IGsgLyAxMDAsCiAgICAgICAgICAgICAgICAgICAgcCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkLmhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZC53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogZC5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvdXRlcldpZHRoOiBkLm91dGVyV2lkdGgoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBhLmV4dGVuZChiLCB7CiAgICAgICAgICAgICAgICAgICAgZWZmZWN0OiAic2NhbGUiLAogICAgICAgICAgICAgICAgICAgIHF1ZXVlOiAhMSwKICAgICAgICAgICAgICAgICAgICBmYWRlOiAhMCwKICAgICAgICAgICAgICAgICAgICBtb2RlOiBnLAogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBjLAogICAgICAgICAgICAgICAgICAgIHBlcmNlbnQ6IGYgPyBrIDogMTAwLAogICAgICAgICAgICAgICAgICAgIGZyb206IGYgPyBwIDogewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHAuaGVpZ2h0ICogaCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHAud2lkdGggKiBoLAogICAgICAgICAgICAgICAgICAgICAgICBvdXRlckhlaWdodDogcC5vdXRlckhlaWdodCAqIGgsCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IHAub3V0ZXJXaWR0aCAqIGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGQuZWZmZWN0KGIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3QucHVsc2F0ZSA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBnID0gYS5lZmZlY3RzLnNldE1vZGUoZCwgYi5tb2RlIHx8ICJzaG93IiksCiAgICAgICAgICAgICAgICAgICAgZiA9ICJzaG93IiA9PT0gZywKICAgICAgICAgICAgICAgICAgICBrID0gImhpZGUiID09PSBnLAogICAgICAgICAgICAgICAgICAgIGcgPSAyICogKGIudGltZXMgfHwgNSkgKyAoZiB8fCAiaGlkZSIgPT09IGcgPyAxIDogMCksCiAgICAgICAgICAgICAgICAgICAgaCA9IGIuZHVyYXRpb24gLyBnLAogICAgICAgICAgICAgICAgICAgIHAgPSAwLAogICAgICAgICAgICAgICAgICAgIGwgPSBkLnF1ZXVlKCksCiAgICAgICAgICAgICAgICAgICAgZSA9IGwubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKGYgfHwgIWQuaXMoIjp2aXNpYmxlIikpIGQuY3NzKCJvcGFjaXR5IiwgMCkuc2hvdygpLCBwID0gMTsKICAgICAgICAgICAgICAgIGZvciAoZiA9IDE7IGYgPCBnOyBmKyspIGQuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IHAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGgsIGIuZWFzaW5nKSwgcCA9IDEgLSBwOwogICAgICAgICAgICAgICAgZC5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBwCiAgICAgICAgICAgICAgICB9LCBoLCBiLmVhc2luZyk7CiAgICAgICAgICAgICAgICBkLnF1ZXVlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGsgJiYgZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgYygpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIDEgPCBlICYmIGwuc3BsaWNlLmFwcGx5KGwsIFsxLCAwXS5jb25jYXQobC5zcGxpY2UoZSwgZyArIDEpKSk7CiAgICAgICAgICAgICAgICBkLmRlcXVldWUoKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLmVmZmVjdHMuZWZmZWN0LnNoYWtlID0gZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIGcgPSAicG9zaXRpb24gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0IGhlaWdodCB3aWR0aCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgICAgICBmID0gYS5lZmZlY3RzLnNldE1vZGUoZCwgYi5tb2RlIHx8ICJlZmZlY3QiKSwKICAgICAgICAgICAgICAgICAgICBrID0gYi5kaXJlY3Rpb24gfHwgImxlZnQiLAogICAgICAgICAgICAgICAgICAgIGggPSBiLmRpc3RhbmNlIHx8IDIwLAogICAgICAgICAgICAgICAgICAgIHAgPSBiLnRpbWVzIHx8IDMsCiAgICAgICAgICAgICAgICAgICAgbCA9IDIgKiBwICsgMSwKICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5yb3VuZChiLmR1cmF0aW9uIC8gbCksCiAgICAgICAgICAgICAgICAgICAgbiA9ICJ1cCIgPT09IGsgfHwgImRvd24iID09PSBrID8gInRvcCIgOiAibGVmdCIsCiAgICAgICAgICAgICAgICAgICAgdiA9ICJ1cCIgPT09IGsgfHwgImxlZnQiID09PSBrLAogICAgICAgICAgICAgICAgICAgIGsgPSB7fSwKICAgICAgICAgICAgICAgICAgICByID0ge30sCiAgICAgICAgICAgICAgICAgICAgcSA9IHt9LAogICAgICAgICAgICAgICAgICAgIHUgPSBkLnF1ZXVlKCksCiAgICAgICAgICAgICAgICAgICAgeiA9IHUubGVuZ3RoOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLnNhdmUoZCwKICAgICAgICAgICAgICAgICAgICBnKTsKICAgICAgICAgICAgICAgIGQuc2hvdygpOwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoZCk7CiAgICAgICAgICAgICAgICBrW25dID0gKHYgPyAiLT0iIDogIis9IikgKyBoOwogICAgICAgICAgICAgICAgcltuXSA9ICh2ID8gIis9IiA6ICItPSIpICsgMiAqIGg7CiAgICAgICAgICAgICAgICBxW25dID0gKHYgPyAiLT0iIDogIis9IikgKyAyICogaDsKICAgICAgICAgICAgICAgIGQuYW5pbWF0ZShrLCBlLCBiLmVhc2luZyk7CiAgICAgICAgICAgICAgICBmb3IgKGggPSAxOyBoIDwgcDsgaCsrKSBkLmFuaW1hdGUociwgZSwgYi5lYXNpbmcpLmFuaW1hdGUocSwgZSwgYi5lYXNpbmcpOwogICAgICAgICAgICAgICAgZC5hbmltYXRlKHIsIGUsIGIuZWFzaW5nKS5hbmltYXRlKGssIGUgLyAyLCBiLmVhc2luZykucXVldWUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgImhpZGUiID09PSBmICYmIGQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZXN0b3JlKGQsIGcpOwogICAgICAgICAgICAgICAgICAgIGEuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGQpOwogICAgICAgICAgICAgICAgICAgIGMoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAxIDwgeiAmJiB1LnNwbGljZS5hcHBseSh1LCBbMSwgMF0uY29uY2F0KHUuc3BsaWNlKHosIGwgKyAxKSkpOwogICAgICAgICAgICAgICAgZC5kZXF1ZXVlKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5lZmZlY3RzLmVmZmVjdC5zbGlkZSA9IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBnID0gInBvc2l0aW9uIHRvcCBib3R0b20gbGVmdCByaWdodCB3aWR0aCBoZWlnaHQiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICAgICAgZiA9IGEuZWZmZWN0cy5zZXRNb2RlKGQsIGIubW9kZSB8fCAic2hvdyIpLAogICAgICAgICAgICAgICAgICAgIGsgPSAic2hvdyIgPT09IGYsCiAgICAgICAgICAgICAgICAgICAgaCA9IGIuZGlyZWN0aW9uIHx8ICJsZWZ0IiwKICAgICAgICAgICAgICAgICAgICBwID0gInVwIiA9PT0gaCB8fCAiZG93biIgPT09IGggPyAidG9wIiA6ICJsZWZ0IiwKICAgICAgICAgICAgICAgICAgICBoID0gInVwIiA9PT0gaCB8fCAibGVmdCIgPT09IGgsCiAgICAgICAgICAgICAgICAgICAgbCwgZSA9IHt9OwogICAgICAgICAgICAgICAgYS5lZmZlY3RzLnNhdmUoZCwgZyk7CiAgICAgICAgICAgICAgICBkLnNob3coKTsKICAgICAgICAgICAgICAgIGwgPSBiLmRpc3RhbmNlIHx8IGRbInRvcCIgPT09IHAgPyAib3V0ZXJIZWlnaHQiIDogIm91dGVyV2lkdGgiXSghMCk7CiAgICAgICAgICAgICAgICBhLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihkKS5jc3MoewogICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBrICYmIGQuY3NzKHAsIGggPyBpc05hTihsKSA/ICItIiArIGwgOiAtbCA6IGwpOwogICAgICAgICAgICAgICAgZVtwXSA9IChrID8gaCA/ICIrPSIgOiAiLT0iIDogaCA/ICItPSIgOiAiKz0iKSArIGw7CiAgICAgICAgICAgICAgICBkLmFuaW1hdGUoZSwgewogICAgICAgICAgICAgICAgICAgIHF1ZXVlOiAhMSwKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICBlYXNpbmc6IGIuZWFzaW5nLAogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgImhpZGUiID09PSBmICYmIGQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmVmZmVjdHMucmVzdG9yZShkLCBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGEuZWZmZWN0cy5lZmZlY3QudHJhbnNmZXIgPSBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZyA9IGEoYi50byksCiAgICAgICAgICAgICAgICAgICAgZiA9ICJmaXhlZCIgPT09IGcuY3NzKCJwb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgICAgIGsgPSBhKCJib2R5IiksCiAgICAgICAgICAgICAgICAgICAgaCA9IGYgPyBrLnNjcm9sbFRvcCgpIDogMCwKICAgICAgICAgICAgICAgICAgICBrID0gZiA/IGsuc2Nyb2xsTGVmdCgpIDogMCwKICAgICAgICAgICAgICAgICAgICBwID0gZy5vZmZzZXQoKSwKICAgICAgICAgICAgICAgICAgICBnID0gewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHAudG9wIC0gaCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcC5sZWZ0IC0gaywKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBnLmlubmVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBnLmlubmVyV2lkdGgoKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGQub2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgICAgbCA9IGEoIjxkaXYgY2xhc3M9J3VpLWVmZmVjdHMtdHJhbnNmZXInPjwvZGl2PiIpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmFkZENsYXNzKGIuY2xhc3NOYW1lKS5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHAudG9wIC0gaCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcC5sZWZ0IC0gaywKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkLmlubmVySGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBkLmlubmVyV2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGYgPyAiZml4ZWQiIDogImFic29sdXRlIgogICAgICAgICAgICAgICAgICAgIH0pLmFuaW1hdGUoZywgYi5kdXJhdGlvbiwgYi5lYXNpbmcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBsLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjKCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgICBhLndpZGdldCgidWkucHJvZ3Jlc3NiYXIiLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBtYXg6IDEwMCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMCwKICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy5vcHRpb25zLnZhbHVlID0gdGhpcy5fY29uc3RyYWluZWRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogInByb2dyZXNzYmFyIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtdmFsdWVtaW4iOiB0aGlzLm1pbgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVEaXYgPSBhKCI8ZGl2IGNsYXNzPSd1aS1wcm9ncmVzc2Jhci12YWx1ZSB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1sZWZ0Jz48L2Rpdj4iKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW1pbiIpLnJlbW92ZUF0dHIoImFyaWEtdmFsdWVtYXgiKS5yZW1vdmVBdHRyKCJhcmlhLXZhbHVlbm93Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZURpdi5yZW1vdmUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl9jb25zdHJhaW5lZFZhbHVlKGEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NvbnN0cmFpbmVkVmFsdWU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGEgJiYgKGEgPSB0aGlzLm9wdGlvbnMudmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXRlcm1pbmF0ZSA9ICExID09PSBhOwogICAgICAgICAgICAgICAgICAgICJudW1iZXIiICE9PSB0eXBlb2YgYSAmJiAoYSA9IDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV0ZXJtaW5hdGUgPyAhMSA6IE1hdGgubWluKHRoaXMub3B0aW9ucy5tYXgsIE1hdGgubWF4KHRoaXMubWluLCBhKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgYS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl9jb25zdHJhaW5lZFZhbHVlKGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBjKSB7CiAgICAgICAgICAgICAgICAgICAgIm1heCIgPT09IGEgJiYgKGMgPSBNYXRoLm1heCh0aGlzLm1pbiwgYykpOwogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCIgPT09IGEgJiYgdGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhYykuYXR0cigiYXJpYS1kaXNhYmxlZCIsIGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKGEsIGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3BlcmNlbnRhZ2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV0ZXJtaW5hdGUgPyAxMDAgOiAxMDAgKiAodGhpcy5vcHRpb25zLnZhbHVlIC0gdGhpcy5taW4pIC8gKHRoaXMub3B0aW9ucy5tYXggLSB0aGlzLm1pbikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVmcmVzaFZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMub3B0aW9ucy52YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuX3BlcmNlbnRhZ2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlRGl2LnRvZ2dsZSh0aGlzLmluZGV0ZXJtaW5hdGUgfHwgYiA+IHRoaXMubWluKS50b2dnbGVDbGFzcygidWktY29ybmVyLXJpZ2h0IiwgYiA9PT0gdGhpcy5vcHRpb25zLm1heCkud2lkdGgoYy50b0ZpeGVkKDApICsgIiUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudG9nZ2xlQ2xhc3MoInVpLXByb2dyZXNzYmFyLWluZGV0ZXJtaW5hdGUiLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV0ZXJtaW5hdGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXRlcm1pbmF0ZSA/ICh0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW5vdyIpLCB0aGlzLm92ZXJsYXlEaXYgfHwgKHRoaXMub3ZlcmxheURpdiA9IGEoIjxkaXYgY2xhc3M9J3VpLXByb2dyZXNzYmFyLW92ZXJsYXknPjwvZGl2PiIpLmFwcGVuZFRvKHRoaXMudmFsdWVEaXYpKSkgOiAodGhpcy5lbGVtZW50LmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS12YWx1ZW1heCI6IHRoaXMub3B0aW9ucy5tYXgsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLXZhbHVlbm93IjogYgogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLm92ZXJsYXlEaXYgJiYgKHRoaXMub3ZlcmxheURpdi5yZW1vdmUoKSwgdGhpcy5vdmVybGF5RGl2ID0gbnVsbCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2xkVmFsdWUgIT09IGIgJiYgKHRoaXMub2xkVmFsdWUgPSBiLCB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiKSk7CiAgICAgICAgICAgICAgICAgICAgYiA9PT0gdGhpcy5vcHRpb25zLm1heCAmJiB0aGlzLl90cmlnZ2VyKCJjb21wbGV0ZSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkuc2VsZWN0YWJsZSIsIGEudWkubW91c2UsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGFwcGVuZFRvOiAiYm9keSIsCiAgICAgICAgICAgICAgICAgICAgYXV0b1JlZnJlc2g6ICEwLAogICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogIioiLAogICAgICAgICAgICAgICAgICAgIHRvbGVyYW5jZTogInRvdWNoIiwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpbmc6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RvcDogbnVsbCwKICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGVkOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHVuc2VsZWN0aW5nOiBudWxsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktc2VsZWN0YWJsZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2dlZCA9ICExOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBiID0gYShjLm9wdGlvbnMuZmlsdGVyLCBjLmVsZW1lbnRbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICBiLmFkZENsYXNzKCJ1aS1zZWxlY3RlZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIub2Zmc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50OiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGMubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGMudG9wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiBjLmxlZnQgKyBiLm91dGVyV2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3R0b206IGMudG9wICsgYi5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0c2VsZWN0ZWQ6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBiLmhhc0NsYXNzKCJ1aS1zZWxlY3RlZCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGluZzogYi5oYXNDbGFzcygidWktc2VsZWN0aW5nIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zZWxlY3Rpbmc6IGIuaGFzQ2xhc3MoInVpLXVuc2VsZWN0aW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVlcyA9IGIuYWRkQ2xhc3MoInVpLXNlbGVjdGVlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VJbml0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXIgPSBhKCI8ZGl2IGNsYXNzPSd1aS1zZWxlY3RhYmxlLWhlbHBlcic+PC9kaXY+IikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZXMucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVlIikucmVtb3ZlRGF0YSgic2VsZWN0YWJsZS1pdGVtIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RhYmxlIHVpLXNlbGVjdGFibGUtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZURlc3Ryb3koKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3BvcyA9IFtiLnBhZ2VYLCBiLnBhZ2VZXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgKHRoaXMuc2VsZWN0ZWVzID0gYShkLmZpbHRlciwgdGhpcy5lbGVtZW50WzBdKSwgdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBiKSwgYShkLmFwcGVuZFRvKS5hcHBlbmQodGhpcy5oZWxwZXIpLCB0aGlzLmhlbHBlci5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYi5wYWdlWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYi5wYWdlWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkLmF1dG9SZWZyZXNoICYmIHRoaXMucmVmcmVzaCgpLCB0aGlzLnNlbGVjdGVlcy5maWx0ZXIoIi51aS1zZWxlY3RlZCIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZGF0YSh0aGlzLCAic2VsZWN0YWJsZS1pdGVtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnN0YXJ0c2VsZWN0ZWQgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubWV0YUtleSB8fCBiLmN0cmxLZXkgfHwgKGQuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIiksIGQuc2VsZWN0ZWQgPSAhMSwgZC4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKSwgZC51bnNlbGVjdGluZyA9ICEwLCBjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsIGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGluZzogZC5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGEoYi50YXJnZXQpLnBhcmVudHMoKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBmID0gYS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSByZXR1cm4gZCA9ICFiLm1ldGFLZXkgJiYgIWIuY3RybEtleSB8fCAhZi4kZWxlbWVudC5oYXNDbGFzcygidWktc2VsZWN0ZWQiKSwgZi4kZWxlbWVudC5yZW1vdmVDbGFzcyhkID8gInVpLXVuc2VsZWN0aW5nIiA6ICJ1aS1zZWxlY3RlZCIpLmFkZENsYXNzKGQgPyAidWktc2VsZWN0aW5nIiA6ICJ1aS11bnNlbGVjdGluZyIpLCBmLnVuc2VsZWN0aW5nID0gIWQsIGYuc2VsZWN0aW5nID0gZCwgKGYuc2VsZWN0ZWQgPSBkKSA/IGMuX3RyaWdnZXIoInNlbGVjdGluZyIsIGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpbmc6IGYuZWxlbWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsIGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGluZzogZi5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgITEKICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlRHJhZzogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2dlZCA9ICEwOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLmRpc2FibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy5vcG9zWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHRoaXMub3Bvc1sxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBiLnBhZ2VYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGIucGFnZVk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYgPiBoICYmIChjID0gaCwgaCA9IGYsIGYgPSBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgayA+IHAgJiYgKGMgPSBwLCBwID0gaywgayA9IGMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlci5jc3MoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBoIC0gZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogcCAtIGsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWVzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZGF0YSh0aGlzLCAic2VsZWN0YWJsZS1pdGVtIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyAmJiBjLmVsZW1lbnQgIT09IGQuZWxlbWVudFswXSAmJiAoInRvdWNoIiA9PT0gZy50b2xlcmFuY2UgPyBlID0gIShjLmxlZnQgPiBoIHx8IGMucmlnaHQgPCBmIHx8IGMudG9wID4gcCB8fCBjLmJvdHRvbSA8IGspIDogImZpdCIgPT09IGcudG9sZXJhbmNlICYmIChlID0gYy5sZWZ0ID4gZiAmJiBjLnJpZ2h0IDwgaCAmJiBjLnRvcCA+IGsgJiYgYy5ib3R0b20gPCBwKSwgZSA/IChjLnNlbGVjdGVkICYmIChjLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZCIpLCBjLnNlbGVjdGVkID0gITEpLCBjLnVuc2VsZWN0aW5nICYmIChjLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS11bnNlbGVjdGluZyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMudW5zZWxlY3RpbmcgPSAhMSksIGMuc2VsZWN0aW5nIHx8IChjLiRlbGVtZW50LmFkZENsYXNzKCJ1aS1zZWxlY3RpbmciKSwgYy5zZWxlY3RpbmcgPSAhMCwgZC5fdHJpZ2dlcigic2VsZWN0aW5nIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGluZzogYy5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpIDogKGMuc2VsZWN0aW5nICYmICgoYi5tZXRhS2V5IHx8IGIuY3RybEtleSkgJiYgYy5zdGFydHNlbGVjdGVkID8gKGMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpLCBjLnNlbGVjdGluZyA9ICExLCBjLiRlbGVtZW50LmFkZENsYXNzKCJ1aS1zZWxlY3RlZCIpLCBjLnNlbGVjdGVkID0gITApIDogKGMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpLCBjLnNlbGVjdGluZyA9ICExLCBjLnN0YXJ0c2VsZWN0ZWQgJiYgKGMuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXVuc2VsZWN0aW5nIiksIGMudW5zZWxlY3RpbmcgPSAhMCksIGQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGluZzogYy5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKSwgIWMuc2VsZWN0ZWQgfHwgYi5tZXRhS2V5IHx8IGIuY3RybEtleSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc3RhcnRzZWxlY3RlZCB8fCAoYy4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKSwgYy5zZWxlY3RlZCA9ICExLCBjLiRlbGVtZW50LmFkZENsYXNzKCJ1aS11bnNlbGVjdGluZyIpLCBjLnVuc2VsZWN0aW5nID0gITAsIGQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGluZzogYy5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VTdG9wOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2dlZCA9ICExOwogICAgICAgICAgICAgICAgICAgIGEoIi51aS11bnNlbGVjdGluZyIsIHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOwogICAgICAgICAgICAgICAgICAgICAgICBkLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS11bnNlbGVjdGluZyIpOwogICAgICAgICAgICAgICAgICAgICAgICBkLnVuc2VsZWN0aW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc3RhcnRzZWxlY3RlZCA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICBjLl90cmlnZ2VyKCJ1bnNlbGVjdGVkIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zZWxlY3RlZDogZC5lbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYSgiLnVpLXNlbGVjdGluZyIsIHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgZC4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIikuYWRkQ2xhc3MoInVpLXNlbGVjdGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc2VsZWN0aW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc2VsZWN0ZWQgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgZC5zdGFydHNlbGVjdGVkID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuX3RyaWdnZXIoInNlbGVjdGVkIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGQuZWxlbWVudAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoInN0b3AiLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEud2lkZ2V0KCJ1aS5zZWxlY3RtZW51IiwgewogICAgICAgICAgICAgICAgdmVyc2lvbjogIjEuMTEuNCIsCiAgICAgICAgICAgICAgICBkZWZhdWx0RWxlbWVudDogIjxzZWxlY3Q+IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBhcHBlbmRUbzogbnVsbCwKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBpY29uczogewogICAgICAgICAgICAgICAgICAgICAgICBidXR0b246ICJ1aS1pY29uLXRyaWFuZ2xlLTEtcyIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15OiAibGVmdCB0b3AiLAogICAgICAgICAgICAgICAgICAgICAgICBhdDogImxlZnQgYm90dG9tIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiAibm9uZSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBjbG9zZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBmb2N1czogbnVsbCwKICAgICAgICAgICAgICAgICAgICBvcGVuOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5lbGVtZW50LnVuaXF1ZUlkKCkuYXR0cigiaWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlkcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogYSwKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBhICsgIi1idXR0b24iLAogICAgICAgICAgICAgICAgICAgICAgICBtZW51OiBhICsgIi1tZW51IgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHJhd0J1dHRvbigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdNZW51KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIHRoaXMuZGlzYWJsZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RyYXdCdXR0b246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsID0gYSgibGFiZWxbZm9yPSciICsgdGhpcy5pZHMuZWxlbWVudCArICInXSIpLmF0dHIoImZvciIsIHRoaXMuaWRzLmJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy5sYWJlbCwgewogICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b24uZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbiA9IGEoIjxzcGFuPiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogInVpLXNlbGVjdG1lbnUtYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiLAogICAgICAgICAgICAgICAgICAgICAgICB0YWJpbmRleDogdGhpcy5vcHRpb25zLmRpc2FibGVkID8gLTEgOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5pZHMuYnV0dG9uLAogICAgICAgICAgICAgICAgICAgICAgICByb2xlOiAiY29tYm9ib3giLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtb3ducyI6IHRoaXMuaWRzLm1lbnUsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWhhc3BvcHVwIjogInRydWUiCiAgICAgICAgICAgICAgICAgICAgfSkuaW5zZXJ0QWZ0ZXIodGhpcy5lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICBhKCI8c3Bhbj4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzcyI6ICJ1aS1pY29uICIgKyB0aGlzLm9wdGlvbnMuaWNvbnMuYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgfSkucHJlcGVuZFRvKHRoaXMuYnV0dG9uKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBhKCI8c3Bhbj4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzcyI6ICJ1aS1zZWxlY3RtZW51LXRleHQiCiAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8odGhpcy5idXR0b24pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFRleHQodGhpcy5idXR0b25UZXh0LCB0aGlzLmVsZW1lbnQuZmluZCgib3B0aW9uOnNlbGVjdGVkIikudGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNpemVCdXR0b24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLmJ1dHRvbiwgdGhpcy5fYnV0dG9uRXZlbnRzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5vbmUoImZvY3VzaW4iLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubWVudUl0ZW1zIHx8IGIuX3JlZnJlc2hNZW51KCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faG92ZXJhYmxlKHRoaXMuYnV0dG9uKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9mb2N1c2FibGUodGhpcy5idXR0b24pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RyYXdNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51ID0gYSgiPHVsPiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1sYWJlbGxlZGJ5IjogdGhpcy5pZHMuYnV0dG9uLAogICAgICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5pZHMubWVudQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVudVdyYXAgPSBhKCI8ZGl2PiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogInVpLXNlbGVjdG1lbnUtbWVudSB1aS1mcm9udCIKICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQodGhpcy5tZW51KS5hcHBlbmRUbyh0aGlzLl9hcHBlbmRUbygpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVJbnN0YW5jZSA9IHRoaXMubWVudS5tZW51KHsKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogImxpc3Rib3giLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuX3NldFNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5fc2VsZWN0KGQuaXRlbS5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSwgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGQuaXRlbS5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gYi5mb2N1c0luZGV4ICYmIGcuaW5kZXggIT09IGIuZm9jdXNJbmRleCAmJiAoYi5fdHJpZ2dlcigiZm9jdXMiLCBhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGIuaXNPcGVuIHx8IGIuX3NlbGVjdChnLCBhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmZvY3VzSW5kZXggPSBnLmluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5idXR0b24uYXR0cigiYXJpYS1hY3RpdmVkZXNjZW5kYW50IiwgYi5tZW51SXRlbXMuZXEoZy5pbmRleCkuYXR0cigiaWQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLm1lbnUoImluc3RhbmNlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51LmFkZENsYXNzKCJ1aS1jb3JuZXItYm90dG9tIikucmVtb3ZlQ2xhc3MoInVpLWNvcm5lci1hbGwiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVJbnN0YW5jZS5fb2ZmKHRoaXMubWVudSwgIm1vdXNlbGVhdmUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVJbnN0YW5jZS5fY2xvc2VPbkRvY3VtZW50Q2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVJbnN0YW5jZS5faXNEaXZpZGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoTWVudSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFRleHQodGhpcy5idXR0b25UZXh0LCB0aGlzLl9nZXRTZWxlY3RlZEl0ZW0oKS50ZXh0KCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy53aWR0aCB8fCB0aGlzLl9yZXNpemVCdXR0b24oKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZWZyZXNoTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51LmVtcHR5KCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICAgICAgICAgYSA9IHRoaXMuZWxlbWVudC5maW5kKCJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICBhLmxlbmd0aCAmJiAodGhpcy5fcGFyc2VPcHRpb25zKGEpLCB0aGlzLl9yZW5kZXJNZW51KHRoaXMubWVudSwgdGhpcy5pdGVtcyksIHRoaXMubWVudUluc3RhbmNlLnJlZnJlc2goKSwgdGhpcy5tZW51SXRlbXMgPSB0aGlzLm1lbnUuZmluZCgibGkiKS5ub3QoIi51aS1zZWxlY3RtZW51LW9wdGdyb3VwIiksIGEgPSB0aGlzLl9nZXRTZWxlY3RlZEl0ZW0oKSwgdGhpcy5tZW51SW5zdGFuY2UuZm9jdXMobnVsbCwgYSksIHRoaXMuX3NldEFyaWEoYS5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSksIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLCB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCB8fCAodGhpcy5tZW51SXRlbXMgPyAodGhpcy5tZW51LmZpbmQoIi51aS1zdGF0ZS1mb2N1cyIpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1mb2N1cyIpLCB0aGlzLm1lbnVJbnN0YW5jZS5mb2N1cyhudWxsLCB0aGlzLl9nZXRTZWxlY3RlZEl0ZW0oKSkpIDogdGhpcy5fcmVmcmVzaE1lbnUoKSwgdGhpcy5pc09wZW4gPSAhMCwgdGhpcy5fdG9nZ2xlQXR0cigpLCB0aGlzLl9yZXNpemVNZW51KCksIHRoaXMuX3Bvc2l0aW9uKCksIHRoaXMuX29uKHRoaXMuZG9jdW1lbnQsIHRoaXMuX2RvY3VtZW50Q2xpY2spLCB0aGlzLl90cmlnZ2VyKCJvcGVuIiwgYSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3Bvc2l0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVXcmFwLnBvc2l0aW9uKGEuZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IHRoaXMuYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuICYmICh0aGlzLmlzT3BlbiA9ICExLCB0aGlzLl90b2dnbGVBdHRyKCksIHRoaXMucmFuZ2UgPQogICAgICAgICAgICAgICAgICAgICAgICBudWxsLCB0aGlzLl9vZmYodGhpcy5kb2N1bWVudCksIHRoaXMuX3RyaWdnZXIoImNsb3NlIiwgYSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgd2lkZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idXR0b24KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtZW51V2lkZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tZW51CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3JlbmRlck1lbnU6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAiIjsKICAgICAgICAgICAgICAgICAgICBhLmVhY2goYywgZnVuY3Rpb24oYywgaykgewogICAgICAgICAgICAgICAgICAgICAgICBrLm9wdGdyb3VwICE9PSBnICYmIChhKCI8bGk+IiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogInVpLXNlbGVjdG1lbnUtb3B0Z3JvdXAgdWktbWVudS1kaXZpZGVyIiArIChrLmVsZW1lbnQucGFyZW50KCJvcHRncm91cCIpLnByb3AoImRpc2FibGVkIikgPyAiIHVpLXN0YXRlLWRpc2FibGVkIiA6ICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGsub3B0Z3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oYiksIGcgPSBrLm9wdGdyb3VwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZC5fcmVuZGVySXRlbURhdGEoYiwgaykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZW5kZXJJdGVtRGF0YTogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJJdGVtKGEsIGMpLmRhdGEoInVpLXNlbGVjdG1lbnUtaXRlbSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3JlbmRlckl0ZW06IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEoIjxsaT4iKTsKICAgICAgICAgICAgICAgICAgICBjLmRpc2FibGVkICYmIGQuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0VGV4dChkLCBjLmxhYmVsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5hcHBlbmRUbyhiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRUZXh0OiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYyA/IGEudGV4dChjKSA6IGEuaHRtbCgiJiMxNjA7IikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW92ZTogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkLCBnID0gIi51aS1tZW51LWl0ZW0iOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID8gZCA9IHRoaXMubWVudUl0ZW1zLmVxKHRoaXMuZm9jdXNJbmRleCkgOiAoZCA9IHRoaXMubWVudUl0ZW1zLmVxKHRoaXMuZWxlbWVudFswXS5zZWxlY3RlZEluZGV4KSwgZyArPSAiOm5vdCgudWktc3RhdGUtZGlzYWJsZWQpIik7CiAgICAgICAgICAgICAgICAgICAgZCA9ICJmaXJzdCIgPT09IGEgfHwgImxhc3QiID09PSBhID8gZFsiZmlyc3QiID09PSBhID8gInByZXZBbGwiIDogIm5leHRBbGwiXShnKS5lcSgtMSkgOiBkW2EgKyAiQWxsIl0oZykuZXEoMCk7CiAgICAgICAgICAgICAgICAgICAgZC5sZW5ndGggJiYgdGhpcy5tZW51SW5zdGFuY2UuZm9jdXMoYywgZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0U2VsZWN0ZWRJdGVtOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tZW51SXRlbXMuZXEodGhpcy5lbGVtZW50WzBdLnNlbGVjdGVkSW5kZXgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RvZ2dsZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNbdGhpcy5pc09wZW4gPyAiY2xvc2UiIDogIm9wZW4iXShhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRTZWxlY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmFuZ2UgJiYgKHdpbmRvdy5nZXRTZWxlY3Rpb24gPyAoYSA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgYS5yZW1vdmVBbGxSYW5nZXMoKSwgYS5hZGRSYW5nZSh0aGlzLnJhbmdlKSkgOiB0aGlzLnJhbmdlLnNlbGVjdCgpLCB0aGlzLmJ1dHRvbi5mb2N1cygpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kb2N1bWVudENsaWNrOiB7CiAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuICYmIChhKGIudGFyZ2V0KS5jbG9zZXN0KCIudWktc2VsZWN0bWVudS1tZW51LCAjIiArIHRoaXMuaWRzLmJ1dHRvbikubGVuZ3RoIHx8IHRoaXMuY2xvc2UoYikpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9idXR0b25FdmVudHM6IHsKICAgICAgICAgICAgICAgICAgICBtb3VzZWRvd246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbiA/IChhID0gd2luZG93LmdldFNlbGVjdGlvbigpLCBhLnJhbmdlQ291bnQgJiYgKHRoaXMucmFuZ2UgPSBhLmdldFJhbmdlQXQoMCkpKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGUoYSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGtleWRvd246IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChiLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlRBQjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVTQ0FQRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVOVEVSOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuICYmIHRoaXMuX3NlbGVjdEZvY3VzZWRJdGVtKGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5hbHRLZXkgPyB0aGlzLl90b2dnbGUoYikgOiB0aGlzLl9tb3ZlKCJwcmV2IiwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5ET1dOOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuYWx0S2V5ID8gdGhpcy5fdG9nZ2xlKGIpIDogdGhpcy5fbW92ZSgibmV4dCIsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuU1BBQ0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPyB0aGlzLl9zZWxlY3RGb2N1c2VkSXRlbShiKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RvZ2dsZShiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgicHJldiIsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuUklHSFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgibmV4dCIsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuSE9NRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlBBR0VfVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW92ZSgiZmlyc3QiLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVORDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlBBR0VfRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlKCJsYXN0IiwgYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVudS50cmlnZ2VyKGIpLCBjID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjICYmIGIucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2VsZWN0Rm9jdXNlZEl0ZW06IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMubWVudUl0ZW1zLmVxKHRoaXMuZm9jdXNJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYy5oYXNDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSB8fCB0aGlzLl9zZWxlY3QoYy5kYXRhKCJ1aS1zZWxlY3RtZW51LWl0ZW0iKSwgYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2VsZWN0OiBmdW5jdGlvbihhLAogICAgICAgICAgICAgICAgICAgIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuZWxlbWVudFswXS5zZWxlY3RlZEluZGV4OwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFswXS5zZWxlY3RlZEluZGV4ID0gYS5pbmRleDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRUZXh0KHRoaXMuYnV0dG9uVGV4dCwgYS5sYWJlbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0QXJpYShhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJzZWxlY3QiLCBjLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGEKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhLmluZGV4ICE9PSBkICYmIHRoaXMuX3RyaWdnZXIoImNoYW5nZSIsIGMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogYQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoYykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0QXJpYTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLm1lbnVJdGVtcy5lcShhLmluZGV4KS5hdHRyKCJpZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1sYWJlbGxlZGJ5IjogYSwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtYWN0aXZlZGVzY2VuZGFudCI6IGEKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUuYXR0cigiYXJpYS1hY3RpdmVkZXNjZW5kYW50IiwgYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgImljb25zIiA9PT0gYSAmJiB0aGlzLmJ1dHRvbi5maW5kKCJzcGFuLnVpLWljb24iKS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaWNvbnMuYnV0dG9uKS5hZGRDbGFzcyhjLmJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3VwZXIoYSwgYyk7CiAgICAgICAgICAgICAgICAgICAgImFwcGVuZFRvIiA9PT0gYSAmJiB0aGlzLm1lbnVXcmFwLmFwcGVuZFRvKHRoaXMuX2FwcGVuZFRvKCkpOwogICAgICAgICAgICAgICAgICAgICJkaXNhYmxlZCIgPT09IGEgJiYgKHRoaXMubWVudUluc3RhbmNlLm9wdGlvbigiZGlzYWJsZWQiLCBjKSwgdGhpcy5idXR0b24udG9nZ2xlQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIiwgYykuYXR0cigiYXJpYS1kaXNhYmxlZCIsIGMpLCB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiLCBjKSwgYyA/ICh0aGlzLmJ1dHRvbi5hdHRyKCJ0YWJpbmRleCIsIC0xKSwgdGhpcy5jbG9zZSgpKSA6IHRoaXMuYnV0dG9uLmF0dHIoInRhYmluZGV4IiwgMCkpOwogICAgICAgICAgICAgICAgICAgICJ3aWR0aCIgPT09IGEgJiYgdGhpcy5fcmVzaXplQnV0dG9uKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYXBwZW5kVG86IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5vcHRpb25zLmFwcGVuZFRvOwogICAgICAgICAgICAgICAgICAgIGIgJiYgKGIgPSBiLmpxdWVyeSB8fCBiLm5vZGVUeXBlID8gYShiKSA6IHRoaXMuZG9jdW1lbnQuZmluZChiKS5lcSgwKSk7CiAgICAgICAgICAgICAgICAgICAgYiAmJiBiWzBdIHx8IChiID0gdGhpcy5lbGVtZW50LmNsb3Nlc3QoIi51aS1mcm9udCIpKTsKICAgICAgICAgICAgICAgICAgICBiLmxlbmd0aCB8fCAoYiA9IHRoaXMuZG9jdW1lbnRbMF0uYm9keSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdG9nZ2xlQXR0cjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b24udG9nZ2xlQ2xhc3MoInVpLWNvcm5lci10b3AiLCB0aGlzLmlzT3BlbikudG9nZ2xlQ2xhc3MoInVpLWNvcm5lci1hbGwiLCAhdGhpcy5pc09wZW4pLmF0dHIoImFyaWEtZXhwYW5kZWQiLCB0aGlzLmlzT3Blbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51V3JhcC50b2dnbGVDbGFzcygidWktc2VsZWN0bWVudS1vcGVuIiwgdGhpcy5pc09wZW4pOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVudS5hdHRyKCJhcmlhLWhpZGRlbiIsICF0aGlzLmlzT3BlbikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVzaXplQnV0dG9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMub3B0aW9ucy53aWR0aDsKICAgICAgICAgICAgICAgICAgICBhIHx8IChhID0gdGhpcy5lbGVtZW50LnNob3coKS5vdXRlcldpZHRoKCksIHRoaXMuZWxlbWVudC5oaWRlKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLm91dGVyV2lkdGgoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVzaXplTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51Lm91dGVyV2lkdGgoTWF0aC5tYXgodGhpcy5idXR0b24ub3V0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnUud2lkdGgoIiIpLm91dGVyV2lkdGgoKSArIDEpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRDcmVhdGVPcHRpb25zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogdGhpcy5lbGVtZW50LnByb3AoImRpc2FibGVkIikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3BhcnNlT3B0aW9uczogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gW107CiAgICAgICAgICAgICAgICAgICAgYi5lYWNoKGZ1bmN0aW9uKGIsIGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBhKGcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGYucGFyZW50KCJvcHRncm91cCIpOwogICAgICAgICAgICAgICAgICAgICAgICBjLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGYudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZi50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRncm91cDogay5hdHRyKCJsYWJlbCIpIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGsucHJvcCgiZGlzYWJsZWQiKSB8fCBmLnByb3AoImRpc2FibGVkIikKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zID0gYwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVXcmFwLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZVVuaXF1ZUlkKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5hdHRyKCJmb3IiLCB0aGlzLmlkcy5lbGVtZW50KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLnNsaWRlciIsIGEudWkubW91c2UsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgd2lkZ2V0RXZlbnRQcmVmaXg6ICJzbGlkZSIsCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZTogITEsCiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IDAsCiAgICAgICAgICAgICAgICAgICAgbWF4OiAxMDAsCiAgICAgICAgICAgICAgICAgICAgbWluOiAwLAogICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiAiaG9yaXpvbnRhbCIsCiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6ICExLAogICAgICAgICAgICAgICAgICAgIHN0ZXA6IDEsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDAsCiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzbGlkZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzdG9wOiBudWxsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbnVtUGFnZXM6IDUsCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZVNsaWRpbmcgPSB0aGlzLl9rZXlTbGlkaW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0ZU9mZiA9ICEwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlSW5pdCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZU5ld01heCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktc2xpZGVyIHVpLXNsaWRlci0iICsgdGhpcy5vcmllbnRhdGlvbiArICIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0T3B0aW9uKCJkaXNhYmxlZCIsIHRoaXMub3B0aW9ucy5kaXNhYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0ZU9mZiA9ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3JlZnJlc2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlSGFuZGxlcygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwRXZlbnRzKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFZhbHVlKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlSGFuZGxlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGM7CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuZWxlbWVudC5maW5kKCIudWktc2xpZGVyLWhhbmRsZSIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGMgPSBiLnZhbHVlcyAmJiBiLnZhbHVlcy5sZW5ndGggfHwgMTsKICAgICAgICAgICAgICAgICAgICBkLmxlbmd0aCA+IGMgJiYgKGQuc2xpY2UoYykucmVtb3ZlKCksIGQgPSBkLnNsaWNlKDAsIGMpKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSBkLmxlbmd0aDsgYiA8IGM7IGIrKykgZy5wdXNoKCI8c3BhbiBjbGFzcz0ndWktc2xpZGVyLWhhbmRsZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwnIHRhYmluZGV4PScwJz48L3NwYW4+Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVzID0gZC5hZGQoYShnLmpvaW4oIiIpKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZSA9IHRoaXMuaGFuZGxlcy5lcSgwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuZGF0YSgidWktc2xpZGVyLWhhbmRsZS1pbmRleCIsIGIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlUmFuZ2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gIiI7CiAgICAgICAgICAgICAgICAgICAgYi5yYW5nZSA/ICghMCA9PT0gYi5yYW5nZSAmJiAoYi52YWx1ZXMgPyBiLnZhbHVlcy5sZW5ndGggJiYgMiAhPT0gYi52YWx1ZXMubGVuZ3RoID8gYi52YWx1ZXMgPSBbYi52YWx1ZXNbMF0sIGIudmFsdWVzWzBdXSA6IGEuaXNBcnJheShiLnZhbHVlcykgJiYgKGIudmFsdWVzID0gYi52YWx1ZXMuc2xpY2UoMCkpIDogYi52YWx1ZXMgPSBbdGhpcy5fdmFsdWVNaW4oKSwgdGhpcy5fdmFsdWVNaW4oKV0pLCB0aGlzLnJhbmdlICYmIHRoaXMucmFuZ2UubGVuZ3RoID8gdGhpcy5yYW5nZS5yZW1vdmVDbGFzcygidWktc2xpZGVyLXJhbmdlLW1pbiB1aS1zbGlkZXItcmFuZ2UtbWF4IikuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbTogIiIKICAgICAgICAgICAgICAgICAgICB9KSA6ICh0aGlzLnJhbmdlID0gYSgiPGRpdj48L2Rpdj4iKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpLCBjID0gInVpLXNsaWRlci1yYW5nZSB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiKSwgdGhpcy5yYW5nZS5hZGRDbGFzcyhjICsgKCJtaW4iID09PSBiLnJhbmdlIHx8ICJtYXgiID09PSBiLnJhbmdlID8gIiB1aS1zbGlkZXItcmFuZ2UtIiArIGIucmFuZ2UgOiAiIikpKSA6ICh0aGlzLnJhbmdlICYmIHRoaXMucmFuZ2UucmVtb3ZlKCksIHRoaXMucmFuZ2UgPSBudWxsKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXR1cEV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb2ZmKHRoaXMuaGFuZGxlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy5oYW5kbGVzLCB0aGlzLl9oYW5kbGVFdmVudHMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hvdmVyYWJsZSh0aGlzLmhhbmRsZXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzYWJsZSh0aGlzLmhhbmRsZXMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJhbmdlICYmIHRoaXMucmFuZ2UucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zbGlkZXIgdWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VEZXN0cm95KCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VDYXB0dXJlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGcsIGYsIGssIGggPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIGlmIChwLmRpc2FibGVkKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudE9mZnNldCA9IHRoaXMuZWxlbWVudC5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5fbm9ybVZhbHVlRnJvbU1vdXNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogYi5wYWdlWCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogYi5wYWdlWQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSArIDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IE1hdGguYWJzKGMgLSBoLnZhbHVlcyhiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID4gZSB8fCBkID09PSBlICYmIChiID09PSBoLl9sYXN0Q2hhbmdlZFZhbHVlIHx8IGgudmFsdWVzKGIpID09PSBwLm1pbikpIGQgPSBlLCBnID0gYSh0aGlzKSwgZiA9IGIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IHRoaXMuX3N0YXJ0KGIsIGYpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VTbGlkaW5nID0gITA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlSW5kZXggPSBmOwogICAgICAgICAgICAgICAgICAgIGcuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgayA9IGcub2Zmc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xpY2tPZmZzZXQgPSBhKGIudGFyZ2V0KS5wYXJlbnRzKCkuYWRkQmFjaygpLmlzKCIudWktc2xpZGVyLWhhbmRsZSIpID8gewogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBiLnBhZ2VYIC0gay5sZWZ0IC0gZy53aWR0aCgpIC8gMiwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBiLnBhZ2VZIC0gay50b3AgLSBnLmhlaWdodCgpIC8gMiAtIChwYXJzZUludChnLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApIC0gKHBhcnNlSW50KGcuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLCAxMCkgfHwgMCkgKyAocGFyc2VJbnQoZy5jc3MoIm1hcmdpblRvcCIpLCAxMCkgfHwgMCkKICAgICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcy5oYXNDbGFzcygidWktc3RhdGUtaG92ZXIiKSB8fCB0aGlzLl9zbGlkZShiLCBmLCBjKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0ZU9mZiA9ICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZURyYWc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBhLnBhZ2VYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogYS5wYWdlWQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zbGlkZShhLCB0aGlzLl9oYW5kbGVJbmRleCwgYyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX21vdXNlU3RvcDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcy5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VTbGlkaW5nID0gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RvcChhLCB0aGlzLl9oYW5kbGVJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlKGEsIHRoaXMuX2hhbmRsZUluZGV4KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbGlja09mZnNldCA9IHRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0ZU9mZiA9ICExCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2RldGVjdE9yaWVudGF0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWVudGF0aW9uID0gInZlcnRpY2FsIiA9PT0gdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uID8gInZlcnRpY2FsIiA6ICJob3Jpem9udGFsIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9ub3JtVmFsdWVGcm9tTW91c2U6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICAiaG9yaXpvbnRhbCIgPT09IHRoaXMub3JpZW50YXRpb24gPyAoYyA9IHRoaXMuZWxlbWVudFNpemUud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhLnggLSB0aGlzLmVsZW1lbnRPZmZzZXQubGVmdCAtICh0aGlzLl9jbGlja09mZnNldCA/IHRoaXMuX2NsaWNrT2Zmc2V0LmxlZnQgOiAwKSkgOiAoYyA9IHRoaXMuZWxlbWVudFNpemUuaGVpZ2h0LCBhID0gYS55IC0gdGhpcy5lbGVtZW50T2Zmc2V0LnRvcCAtICh0aGlzLl9jbGlja09mZnNldCA/IHRoaXMuX2NsaWNrT2Zmc2V0LnRvcCA6IDApKTsKICAgICAgICAgICAgICAgICAgICBjID0gYSAvIGM7CiAgICAgICAgICAgICAgICAgICAgMSA8IGMgJiYgKGMgPSAxKTsKICAgICAgICAgICAgICAgICAgICAwID4gYyAmJiAoYyA9IDApOwogICAgICAgICAgICAgICAgICAgICJ2ZXJ0aWNhbCIgPT09IHRoaXMub3JpZW50YXRpb24gJiYgKGMgPSAxIC0gYyk7CiAgICAgICAgICAgICAgICAgICAgYSA9IHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpOwogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl92YWx1ZU1pbigpICsgYyAqIGE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaW1BbGlnblZhbHVlKGMpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3N0YXJ0OiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZTogdGhpcy5oYW5kbGVzW2NdLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoICYmIChkLnZhbHVlID0gdGhpcy52YWx1ZXMoYyksIGQudmFsdWVzID0gdGhpcy52YWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXIoInN0YXJ0IiwgYSwgZCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2xpZGU6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID8gKGcgPSB0aGlzLnZhbHVlcyhjID8gMCA6IDEpLCAyID09PSB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCAmJiAhMCA9PT0gdGhpcy5vcHRpb25zLnJhbmdlICYmICgwID09PSBjICYmIGQgPiBnIHx8IDEgPT09IGMgJiYgZCA8IGcpICYmIChkID0gZyksIGQgIT09IHRoaXMudmFsdWVzKGMpICYmIChnID0gdGhpcy52YWx1ZXMoKSwgZ1tjXSA9IGQsIGEgPSB0aGlzLl90cmlnZ2VyKCJzbGlkZSIsIGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiB0aGlzLmhhbmRsZXNbY10sCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBkLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IGcKICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy52YWx1ZXMoYyA/IDAgOiAxKSwgITEgIT09IGEgJiYgdGhpcy52YWx1ZXMoYywgZCkpKSA6IGQgIT09IHRoaXMudmFsdWUoKSAmJiAoYSA9IHRoaXMuX3RyaWdnZXIoInNsaWRlIiwgYSwgewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGU6IHRoaXMuaGFuZGxlc1tjXSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGQKICAgICAgICAgICAgICAgICAgICB9KSwgITEgIT09IGEgJiYgdGhpcy52YWx1ZShkKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc3RvcDogZnVuY3Rpb24oYSwKICAgICAgICAgICAgICAgICAgICBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZTogdGhpcy5oYW5kbGVzW2NdLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoICYmIChkLnZhbHVlID0gdGhpcy52YWx1ZXMoYyksIGQudmFsdWVzID0gdGhpcy52YWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigic3RvcCIsIGEsIGQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NoYW5nZTogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fa2V5U2xpZGluZyAmJiAhdGhpcy5fbW91c2VTbGlkaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiB0aGlzLmhhbmRsZXNbY10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggJiYgKGQudmFsdWUgPSB0aGlzLnZhbHVlcyhjKSwgZC52YWx1ZXMgPSB0aGlzLnZhbHVlcygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdENoYW5nZWRWYWx1ZSA9IGM7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoImNoYW5nZSIsIGEsIGQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHRoaXMub3B0aW9ucy52YWx1ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaW1BbGlnblZhbHVlKGEpLCB0aGlzLl9yZWZyZXNoVmFsdWUoKSwgdGhpcy5fY2hhbmdlKG51bGwsIDApOwogICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX3ZhbHVlKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2YWx1ZXM6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZywgZjsKICAgICAgICAgICAgICAgICAgICBpZiAoMSA8IGFyZ3VtZW50cy5sZW5ndGgpIHRoaXMub3B0aW9ucy52YWx1ZXNbYl0gPSB0aGlzLl90cmltQWxpZ25WYWx1ZShjKSwgdGhpcy5fcmVmcmVzaFZhbHVlKCksIHRoaXMuX2NoYW5nZShudWxsLCBiKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLm9wdGlvbnMudmFsdWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGFyZ3VtZW50c1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IDA7IGYgPCBkLmxlbmd0aDsgZiArPSAxKSBkW2ZdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoZ1tmXSksIHRoaXMuX2NoYW5nZShudWxsLCBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCA/IHRoaXMuX3ZhbHVlcyhiKSA6IHRoaXMudmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl92YWx1ZXMoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zZXRPcHRpb246IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZyA9IDA7CiAgICAgICAgICAgICAgICAgICAgInJhbmdlIiA9PT0gYiAmJiAhMCA9PT0gdGhpcy5vcHRpb25zLnJhbmdlICYmICgibWluIiA9PT0gYyA/ICh0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl92YWx1ZXMoMCksIHRoaXMub3B0aW9ucy52YWx1ZXMgPSBudWxsKSA6ICJtYXgiID09PSBjICYmICh0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl92YWx1ZXModGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggLSAxKSwgdGhpcy5vcHRpb25zLnZhbHVlcyA9IG51bGwpKTsKICAgICAgICAgICAgICAgICAgICBhLmlzQXJyYXkodGhpcy5vcHRpb25zLnZhbHVlcykgJiYgKGcgPSB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgImRpc2FibGVkIiA9PT0gYiAmJiB0aGlzLmVsZW1lbnQudG9nZ2xlQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIiwgISFjKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihiLCBjKTsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib3JpZW50YXRpb24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGV0ZWN0T3JpZW50YXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIikuYWRkQ2xhc3MoInVpLXNsaWRlci0iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWVudGF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVzLmNzcygiaG9yaXpvbnRhbCIgPT09IGMgPyAiYm90dG9tIiA6ICJsZWZ0IiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInZhbHVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVPZmYgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlKG51bGwsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0ZU9mZiA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInZhbHVlcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmltYXRlT2ZmID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBnOyBkICs9IDEpIHRoaXMuX2NoYW5nZShudWxsLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVPZmYgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdGVwIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibWluIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibWF4IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVPZmYgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZU5ld01heCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmltYXRlT2ZmID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0ZU9mZiA9ICEwLCB0aGlzLl9yZWZyZXNoKCksIHRoaXMuX2FuaW1hdGVPZmYgPSAhMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5vcHRpb25zLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdmFsdWVzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBjID0gdGhpcy5vcHRpb25zLnZhbHVlc1thXSwgYyA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKGMpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnMudmFsdWVzLnNsaWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCArPSAxKSBjW2RdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoY1tkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF90cmltQWxpZ25WYWx1ZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhIDw9IHRoaXMuX3ZhbHVlTWluKCkpIHJldHVybiB0aGlzLl92YWx1ZU1pbigpOwogICAgICAgICAgICAgICAgICAgIGlmIChhID49IHRoaXMuX3ZhbHVlTWF4KCkpIHJldHVybiB0aGlzLl92YWx1ZU1heCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBjID0gMCA8IHRoaXMub3B0aW9ucy5zdGVwID8gdGhpcy5vcHRpb25zLnN0ZXAgOgogICAgICAgICAgICAgICAgICAgICAgICAxLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gKGEgLSB0aGlzLl92YWx1ZU1pbigpKSAlIGM7CiAgICAgICAgICAgICAgICAgICAgYSAtPSBkOwogICAgICAgICAgICAgICAgICAgIDIgKiBNYXRoLmFicyhkKSA+PSBjICYmIChhICs9IDAgPCBkID8gYyA6IC1jKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhLnRvRml4ZWQoNSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NhbGN1bGF0ZU5ld01heDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLm9wdGlvbnMubWF4LAogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5fdmFsdWVNaW4oKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMub3B0aW9ucy5zdGVwLAogICAgICAgICAgICAgICAgICAgICAgICBhID0gTWF0aC5mbG9vcigrKGEgLSBjKS50b0ZpeGVkKHRoaXMuX3ByZWNpc2lvbigpKSAvIGQpICogZCArIGM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXggPSBwYXJzZUZsb2F0KGEudG9GaXhlZCh0aGlzLl9wcmVjaXNpb24oKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3ByZWNpc2lvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9wcmVjaXNpb25PZih0aGlzLm9wdGlvbnMuc3RlcCk7CiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gdGhpcy5vcHRpb25zLm1pbiAmJiAoYSA9IE1hdGgubWF4KGEsIHRoaXMuX3ByZWNpc2lvbk9mKHRoaXMub3B0aW9ucy5taW4pKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcHJlY2lzaW9uT2Y6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBhID0gYS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS5pbmRleE9mKCIuIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xID09PSBjID8gMCA6IGEubGVuZ3RoIC0gYyAtIDEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdmFsdWVNaW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWluCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3ZhbHVlTWF4OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXgKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVmcmVzaFZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYywgZCwgZywgZiwgayA9IHRoaXMub3B0aW9ucy5yYW5nZSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB0aGlzLl9hbmltYXRlT2ZmID8gITEgOiBoLmFuaW1hdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCkgdGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gKHAudmFsdWVzKGQpIC0gcC5fdmFsdWVNaW4oKSkgLyAocC5fdmFsdWVNYXgoKSAtIHAuX3ZhbHVlTWluKCkpICogMTAwOwogICAgICAgICAgICAgICAgICAgICAgICBlWyJob3Jpem9udGFsIiA9PT0gcC5vcmllbnRhdGlvbiA/ICJsZWZ0IiA6ICJib3R0b20iXSA9IGMgKyAiJSI7CiAgICAgICAgICAgICAgICAgICAgICAgIGEodGhpcykuc3RvcCgxLCAxKVtsID8gImFuaW1hdGUiIDogImNzcyJdKGUsIGguYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gcC5vcHRpb25zLnJhbmdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJob3Jpem9udGFsIiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLm9yaWVudGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGQpIHAucmFuZ2Uuc3RvcCgxLCAxKVtsID8gImFuaW1hdGUiIDogImNzcyJdKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYyArICIlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGguYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IGQpIHAucmFuZ2VbbCA/ICJhbmltYXRlIiA6ICJjc3MiXSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBjIC0gYiArICIlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaC5hbmltYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGQpIHAucmFuZ2Uuc3RvcCgxLCAxKVtsID8gImFuaW1hdGUiIDogImNzcyJdKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBjICsgIiUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgaC5hbmltYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gZCkgcC5yYW5nZVtsID8gImFuaW1hdGUiIDogImNzcyJdKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBjIC0gYiArICIlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaC5hbmltYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMudmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuX3ZhbHVlTWluKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzLl92YWx1ZU1heCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gZiAhPT0gZyA/IChkIC0gZykgLyAoZiAtIGcpICogMTAwIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgZVsiaG9yaXpvbnRhbCIgPT09IHRoaXMub3JpZW50YXRpb24gPyAibGVmdCIgOiAiYm90dG9tIl0gPSBjICsgIiUiOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZS5zdG9wKDEsIDEpW2wgPyAiYW5pbWF0ZSIgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNzcyJdKGUsIGguYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibWluIiA9PT0gayAmJiAiaG9yaXpvbnRhbCIgPT09IHRoaXMub3JpZW50YXRpb24pIHRoaXMucmFuZ2Uuc3RvcCgxLCAxKVtsID8gImFuaW1hdGUiIDogImNzcyJdKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBjICsgIiUiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGguYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibWF4IiA9PT0gayAmJiAiaG9yaXpvbnRhbCIgPT09IHRoaXMub3JpZW50YXRpb24pIHRoaXMucmFuZ2VbbCA/ICJhbmltYXRlIiA6ICJjc3MiXSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAwIC0gYyArICIlIgogICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaC5hbmltYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIm1pbiIgPT09IGsgJiYgInZlcnRpY2FsIiA9PT0gdGhpcy5vcmllbnRhdGlvbikgdGhpcy5yYW5nZS5zdG9wKDEsIDEpW2wgPyAiYW5pbWF0ZSIgOiAiY3NzIl0oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBjICsgIiUiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGguYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibWF4IiA9PT0gayAmJiAidmVydGljYWwiID09PSB0aGlzLm9yaWVudGF0aW9uKSB0aGlzLnJhbmdlW2wgPyAiYW5pbWF0ZSIgOiAiY3NzIl0oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAgLSBjICsgIiUiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBoLmFuaW1hdGUKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2hhbmRsZUV2ZW50czogewogICAgICAgICAgICAgICAgICAgIGtleWRvd246IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLCBnLCBmID0gYShiLnRhcmdldCkuZGF0YSgidWktc2xpZGVyLWhhbmRsZS1pbmRleCIpOwogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGIua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuSE9NRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVORDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlBBR0VfVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5QQUdFX0RPV046CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5VUDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlJJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIucHJldmVudERlZmF1bHQoKSwgIXRoaXMuX2tleVNsaWRpbmcgJiYgKHRoaXMuX2tleVNsaWRpbmcgPSAhMCwgYShiLnRhcmdldCkuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLCBjID0gdGhpcy5fc3RhcnQoYiwgZiksICExID09PSBjKSkgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMub3B0aW9ucy5zdGVwOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCA/IGQgPSB0aGlzLnZhbHVlcyhmKSA6IGQgPSB0aGlzLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYi5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5IT01FOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZU1pbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRU5EOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLl92YWx1ZU1heCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuUEFHRV9VUDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoYyArICh0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSkgLyB0aGlzLm51bVBhZ2VzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlBBR0VfRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoYyAtICh0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSkgLyB0aGlzLm51bVBhZ2VzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlVQOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuUklHSFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IHRoaXMuX3ZhbHVlTWF4KCkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoYyArIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IHRoaXMuX3ZhbHVlTWluKCkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoYyAtIGcpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2xpZGUoYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYsIGQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBrZXl1cDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEoYi50YXJnZXQpLmRhdGEoInVpLXNsaWRlci1oYW5kbGUtaW5kZXgiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5U2xpZGluZyAmJiAodGhpcy5fa2V5U2xpZGluZyA9ICExLCB0aGlzLl9zdG9wKGIsIGMpLCB0aGlzLl9jaGFuZ2UoYiwgYyksIGEoYi50YXJnZXQpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkuc29ydGFibGUiLCBhLnVpLm1vdXNlLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIHdpZGdldEV2ZW50UHJlZml4OiAic29ydCIsCiAgICAgICAgICAgICAgICByZWFkeTogITEsCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG86ICJwYXJlbnQiLAogICAgICAgICAgICAgICAgICAgIGF4aXM6ICExLAogICAgICAgICAgICAgICAgICAgIGNvbm5lY3RXaXRoOiAhMSwKICAgICAgICAgICAgICAgICAgICBjb250YWlubWVudDogITEsCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiAiYXV0byIsCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yQXQ6ICExLAogICAgICAgICAgICAgICAgICAgIGRyb3BPbkVtcHR5OiAhMCwKICAgICAgICAgICAgICAgICAgICBmb3JjZVBsYWNlaG9sZGVyU2l6ZTogITEsCiAgICAgICAgICAgICAgICAgICAgZm9yY2VIZWxwZXJTaXplOiAhMSwKICAgICAgICAgICAgICAgICAgICBncmlkOiAhMSwKICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICExLAogICAgICAgICAgICAgICAgICAgIGhlbHBlcjogIm9yaWdpbmFsIiwKICAgICAgICAgICAgICAgICAgICBpdGVtczogIj4gKiIsCiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogITEsCiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICExLAogICAgICAgICAgICAgICAgICAgIHJldmVydDogITEsCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsOiAhMCwKICAgICAgICAgICAgICAgICAgICBzY3JvbGxTZW5zaXRpdml0eTogMjAsCiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsU3BlZWQ6IDIwLAogICAgICAgICAgICAgICAgICAgIHNjb3BlOiAiZGVmYXVsdCIsCiAgICAgICAgICAgICAgICAgICAgdG9sZXJhbmNlOiAiaW50ZXJzZWN0IiwKICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDFFMywKICAgICAgICAgICAgICAgICAgICBhY3RpdmF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBiZWZvcmVTdG9wOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBkZWFjdGl2YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG91dDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBvdmVyOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJlY2VpdmU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHNvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RvcDogbnVsbCwKICAgICAgICAgICAgICAgICAgICB1cGRhdGU6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaXNPdmVyQXhpczogZnVuY3Rpb24oYSwgYywgZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID49IGMgJiYgYSA8IGMgKyBkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2lzRmxvYXRpbmc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gL2xlZnR8cmlnaHQvLnRlc3QoYS5jc3MoImZsb2F0IikpIHx8IC9pbmxpbmV8dGFibGUtY2VsbC8udGVzdChhLmNzcygiZGlzcGxheSIpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyQ2FjaGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNvcnRhYmxlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VJbml0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWFkeSA9ICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKGEsIGMpOwogICAgICAgICAgICAgICAgICAgICJoYW5kbGUiID09PSBhICYmIHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldEhhbmRsZUNsYXNzTmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoIi51aS1zb3J0YWJsZS1oYW5kbGUiKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGFuZGxlIik7CiAgICAgICAgICAgICAgICAgICAgYS5lYWNoKHRoaXMuaXRlbXMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnN0YW5jZS5vcHRpb25zLmhhbmRsZSA/IHRoaXMuaXRlbS5maW5kKHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUpIDogdGhpcy5pdGVtKS5hZGRDbGFzcygidWktc29ydGFibGUtaGFuZGxlIikKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlIHVpLXNvcnRhYmxlLWRpc2FibGVkIikuZmluZCgiLnVpLXNvcnRhYmxlLWhhbmRsZSIpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oYW5kbGUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZURlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyAwIDw9IGE7IGEtLSkgdGhpcy5pdGVtc1thXS5pdGVtLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lICsgIi1pdGVtIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VDYXB0dXJlOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJldmVydGluZyB8fCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgInN0YXRpYyIgPT09IHRoaXMub3B0aW9ucy50eXBlKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaEl0ZW1zKGIpOwogICAgICAgICAgICAgICAgICAgIGEoYi50YXJnZXQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5kYXRhKHRoaXMsIGYud2lkZ2V0TmFtZSArICItaXRlbSIpID09PSBmKSByZXR1cm4gZCA9IGEodGhpcyksICExCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYS5kYXRhKGIudGFyZ2V0LCBmLndpZGdldE5hbWUgKyAiLWl0ZW0iKSA9PT0gZiAmJiAoZCA9IGEoYi50YXJnZXQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWQgfHwgdGhpcy5vcHRpb25zLmhhbmRsZSAmJiAhYyAmJiAoYSh0aGlzLm9wdGlvbnMuaGFuZGxlLCBkKS5maW5kKCIqIikuYWRkQmFjaygpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIudGFyZ2V0ICYmIChnID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCAhZykpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRJdGVtID0gZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJyZW50c0Zyb21JdGVtcygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGc7CiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb250YWluZXIgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFBvc2l0aW9ucygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyID0gdGhpcy5fY3JlYXRlSGVscGVyKGIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZU1hcmdpbnMoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFBhcmVudCA9IHRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gdGhpcy5jdXJyZW50SXRlbS5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLm9mZnNldC50b3AgLSB0aGlzLm1hcmdpbnMudG9wLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB0aGlzLm9mZnNldC5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGEuZXh0ZW5kKHRoaXMub2Zmc2V0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBiLnBhZ2VYIC0gdGhpcy5vZmZzZXQubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYi5wYWdlWSAtIHRoaXMub2Zmc2V0LnRvcAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMuX2dldFBhcmVudE9mZnNldCgpLAogICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZTogdGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNzc1Bvc2l0aW9uID0gdGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFBhZ2VYID0gYi5wYWdlWDsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsUGFnZVkgPSBiLnBhZ2VZOwogICAgICAgICAgICAgICAgICAgIGMuY3Vyc29yQXQgJiYgdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihjLmN1cnNvckF0KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbVBvc2l0aW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2OiB0aGlzLmN1cnJlbnRJdGVtLnByZXYoKVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50OiB0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlclswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSAmJiB0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpOwogICAgICAgICAgICAgICAgICAgIGMuY29udGFpbm1lbnQgJiYgdGhpcy5fc2V0Q29udGFpbm1lbnQoKTsKICAgICAgICAgICAgICAgICAgICBjLmN1cnNvciAmJiAiYXV0byIgIT09IGMuY3Vyc29yICYmIChnID0gdGhpcy5kb2N1bWVudC5maW5kKCJib2R5IiksIHRoaXMuc3RvcmVkQ3Vyc29yID0gZy5jc3MoImN1cnNvciIpLCBnLmNzcygiY3Vyc29yIiwgYy5jdXJzb3IpLCB0aGlzLnN0b3JlZFN0eWxlc2hlZXQgPSBhKCI8c3R5bGU+KnsgY3Vyc29yOiAiICsgYy5jdXJzb3IgKyAiICFpbXBvcnRhbnQ7IH08L3N0eWxlPiIpLmFwcGVuZFRvKGcpKTsKICAgICAgICAgICAgICAgICAgICBjLm9wYWNpdHkgJiYgKHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIpICYmICh0aGlzLl9zdG9yZWRPcGFjaXR5ID0gdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5IikpLCB0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiLCBjLm9wYWNpdHkpKTsKICAgICAgICAgICAgICAgICAgICBjLnpJbmRleCAmJiAodGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiKSAmJiAodGhpcy5fc3RvcmVkWkluZGV4ID0gdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiKSksIHRoaXMuaGVscGVyLmNzcygiekluZGV4IiwgYy56SW5kZXgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudFswXSAmJiAiSFRNTCIgIT09IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgJiYgKHRoaXMub3ZlcmZsb3dPZmZzZXQgPSB0aGlzLnNjcm9sbFBhcmVudC5vZmZzZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBiLCB0aGlzLl91aUhhc2goKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9ucyB8fCB0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pIHRoaXMuY29udGFpbmVyc1tkXS5fdHJpZ2dlcigiYWN0aXZhdGUiLCBiLCB0aGlzLl91aUhhc2godGhpcykpOwogICAgICAgICAgICAgICAgICAgIGEudWkuZGRtYW5hZ2VyICYmIChhLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYgIWMuZHJvcEJlaGF2aW91ciAmJiBhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdnaW5nID0gITA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWxwZXIuYWRkQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlRHJhZyhiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VEcmFnOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQsIGcsIGY7CiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMub3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBkID0gITE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uQWJzIHx8ICh0aGlzLmxhc3RQb3NpdGlvbkFicyA9IHRoaXMucG9zaXRpb25BYnMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zY3JvbGwgJiYgKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSB0aGlzLmRvY3VtZW50WzBdICYmICJIVE1MIiAhPT0gdGhpcy5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSA/ICh0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCArIHRoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodCAtIGIucGFnZVkgPCBjLnNjcm9sbFNlbnNpdGl2aXR5ID8gdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wID0gZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCArIGMuc2Nyb2xsU3BlZWQgOiBiLnBhZ2VZIC0gdGhpcy5vdmVyZmxvd09mZnNldC50b3AgPAogICAgICAgICAgICAgICAgICAgICAgICBjLnNjcm9sbFNlbnNpdGl2aXR5ICYmICh0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgPSBkID0gdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wIC0gYy5zY3JvbGxTcGVlZCksIHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCArIHRoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoIC0gYi5wYWdlWCA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgPyB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgKyBjLnNjcm9sbFNwZWVkIDogYi5wYWdlWCAtIHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgJiYgKHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgPSBkID0gdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCAtIGMuc2Nyb2xsU3BlZWQpKSA6IChiLnBhZ2VZIC0gdGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKSA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgPyBkID0gdGhpcy5kb2N1bWVudC5zY3JvbGxUb3AodGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKSAtCiAgICAgICAgICAgICAgICAgICAgICAgIGMuc2Nyb2xsU3BlZWQpIDogdGhpcy53aW5kb3cuaGVpZ2h0KCkgLSAoYi5wYWdlWSAtIHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkpIDwgYy5zY3JvbGxTZW5zaXRpdml0eSAmJiAoZCA9IHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkgKyBjLnNjcm9sbFNwZWVkKSksIGIucGFnZVggLSB0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKSA8IGMuc2Nyb2xsU2Vuc2l0aXZpdHkgPyBkID0gdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpIC0gYy5zY3JvbGxTcGVlZCkgOiB0aGlzLndpbmRvdy53aWR0aCgpIC0gKGIucGFnZVggLSB0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKSkgPCBjLnNjcm9sbFNlbnNpdGl2aXR5ICYmIChkID0gdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpICsgYy5zY3JvbGxTcGVlZCkpKSwgITEgIT09IGQgJiYgYS51aS5kZG1hbmFnZXIgJiYgIWMuZHJvcEJlaGF2aW91ciAmJiBhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBiKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkFicyA9IHRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5heGlzICYmICJ5IiA9PT0gdGhpcy5vcHRpb25zLmF4aXMgfHwgKHRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQgPSB0aGlzLnBvc2l0aW9uLmxlZnQgKyAicHgiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuYXhpcyAmJiAieCIgPT09IHRoaXMub3B0aW9ucy5heGlzIHx8ICh0aGlzLmhlbHBlclswXS5zdHlsZS50b3AgPSB0aGlzLnBvc2l0aW9uLnRvcCArICJweCIpOwogICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgMCA8PSBjOyBjLS0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gdGhpcy5pdGVtc1tjXSwgZyA9IGQuaXRlbVswXSwgKGYgPSB0aGlzLl9pbnRlcnNlY3RzV2l0aFBvaW50ZXIoZCkpICYmIGQuaW5zdGFuY2UgPT09IHRoaXMuY3VycmVudENvbnRhaW5lciAmJiBnICE9PSB0aGlzLmN1cnJlbnRJdGVtWzBdICYmIHRoaXMucGxhY2Vob2xkZXJbMSA9PT0gZiA/ICJuZXh0IiA6ICJwcmV2Il0oKVswXSAhPT0gZyAmJiAhYS5jb250YWlucyh0aGlzLnBsYWNlaG9sZGVyWzBdLCBnKSAmJiAoInNlbWktZHluYW1pYyIgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnR5cGUgPyAhYS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIGcpIDogMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMSA9PT0gZiA/ICJkb3duIiA6ICJ1cCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoInBvaW50ZXIiID09PSB0aGlzLm9wdGlvbnMudG9sZXJhbmNlIHx8IHRoaXMuX2ludGVyc2VjdHNXaXRoU2lkZXMoZCkpIHRoaXMuX3JlYXJyYW5nZShiLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLCBiLCB0aGlzLl91aUhhc2goKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29udGFjdENvbnRhaW5lcnMoYik7CiAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYgYS51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJzb3J0IiwgYiwgdGhpcy5fdWlIYXNoKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uQWJzID0gdGhpcy5wb3NpdGlvbkFiczsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfbW91c2VTdG9wOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYS51aS5kZG1hbmFnZXIgJiYgIXRoaXMub3B0aW9ucy5kcm9wQmVoYXZpb3VyICYmIGEudWkuZGRtYW5hZ2VyLmRyb3AodGhpcywgYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmV2ZXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5wbGFjZWhvbGRlci5vZmZzZXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy5vcHRpb25zLmF4aXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiAmJiAieCIgIT09IGYgfHwgKGsubGVmdCA9IGcubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQgKyAodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYm9keSA/IDAgOiB0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmICYmICJ5IiAhPT0gZiB8fCAoay50b3AgPSBnLnRvcCAtIHRoaXMub2Zmc2V0LnBhcmVudC50b3AgLSB0aGlzLm1hcmdpbnMudG9wICsgKHRoaXMub2Zmc2V0UGFyZW50WzBdID09PSB0aGlzLmRvY3VtZW50WzBdLmJvZHkgPyAwIDogdGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJldmVydGluZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzLmhlbHBlcikuYW5pbWF0ZShrLCBwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0LCAxMCkgfHwgNTAwLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLl9jbGVhcihiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2NsZWFyKGIsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kcmFnZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZVVwKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsIiA9PT0gdGhpcy5vcHRpb25zLmhlbHBlciA/IHRoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpIDogdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgMCA8PSBiOyBiLS0pIHRoaXMuY29udGFpbmVyc1tiXS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIG51bGwsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5vdmVyICYmICh0aGlzLmNvbnRhaW5lcnNbYl0uX3RyaWdnZXIoIm91dCIsIG51bGwsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5vdmVyID0gMCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciAmJiAodGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlICYmIHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKSwgIm9yaWdpbmFsIiAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmhlbHBlciAmJiB0aGlzLmhlbHBlciAmJiB0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlICYmIHRoaXMuaGVscGVyLnJlbW92ZSgpLCBhLmV4dGVuZCh0aGlzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZzogITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZlcnRpbmc6ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX25vRmluYWxTb3J0OiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmRvbVBvc2l0aW9uLnByZXYgPyBhKHRoaXMuZG9tUG9zaXRpb24ucHJldikuYWZ0ZXIodGhpcy5jdXJyZW50SXRlbSkgOiBhKHRoaXMuZG9tUG9zaXRpb24ucGFyZW50KS5wcmVwZW5kKHRoaXMuY3VycmVudEl0ZW0pKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fZ2V0SXRlbXNBc2pRdWVyeShiICYmIGIuY29ubmVjdGVkKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGIgPSBiIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGEoYykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAoYShiLml0ZW0gfHwgdGhpcykuYXR0cihiLmF0dHJpYnV0ZSB8fCAiaWQiKSB8fCAiIikubWF0Y2goYi5leHByZXNzaW9uIHx8IC8oLispW1wtPV9dKC4rKS8pOwogICAgICAgICAgICAgICAgICAgICAgICBjICYmIGQucHVzaCgoYi5rZXkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbMV0gKyAiW10iKSArICI9IiArIChiLmtleSAmJiBiLmV4cHJlc3Npb24gPyBjWzFdIDogY1syXSkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgIWQubGVuZ3RoICYmIGIua2V5ICYmIGQucHVzaChiLmtleSArICI9Iik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuam9pbigiJiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdG9BcnJheTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fZ2V0SXRlbXNBc2pRdWVyeShiICYmIGIuY29ubmVjdGVkKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGIgPSBiIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5wdXNoKGEoYi5pdGVtIHx8IHRoaXMpLmF0dHIoYi5hdHRyaWJ1dGUgfHwgImlkIikgfHwgIiIpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaW50ZXJzZWN0c1dpdGg6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMucG9zaXRpb25BYnMubGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5wb3NpdGlvbkFicy50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBnICsgdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhLmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBrICsgYS53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGEudG9wLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gcCArIGEuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5vZmZzZXQuY2xpY2sudG9wLAogICAgICAgICAgICAgICAgICAgICAgICBuID0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9ICJ5IiA9PT0gdGhpcy5vcHRpb25zLmF4aXMgfHwgYyArIG4gPiBrICYmIGMgKyBuIDwgaCwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9ICgieCIgPT09IHRoaXMub3B0aW9ucy5heGlzIHx8IGcgKyBlID4gcCAmJiBnICsgZSA8IGwpICYmIG47CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJwb2ludGVyIiA9PT0gdGhpcy5vcHRpb25zLnRvbGVyYW5jZSB8fCB0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVycyB8fCAicG9pbnRlciIgIT09IHRoaXMub3B0aW9ucy50b2xlcmFuY2UgJiYgdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nID8gIndpZHRoIiA6ICJoZWlnaHQiXSA+IGFbdGhpcy5mbG9hdGluZyA/ICJ3aWR0aCIgOiAiaGVpZ2h0Il0gPyBlIDogayA8IGMgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMiAmJiBkIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAvIDIgPCBoICYmIHAgPCBnICsgdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLyAyICYmIGYgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIgPCBsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2ludGVyc2VjdHNXaXRoUG9pbnRlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gIngiID09PSB0aGlzLm9wdGlvbnMuYXhpcyB8fAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wLCBhLnRvcCwgYS5oZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGEgPSAieSIgPT09IHRoaXMub3B0aW9ucy5heGlzIHx8IHRoaXMuX2lzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy5sZWZ0ICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCwgYS5sZWZ0LCBhLndpZHRoKTsKICAgICAgICAgICAgICAgICAgICBjID0gYyAmJiBhOwogICAgICAgICAgICAgICAgICAgIGEgPSB0aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPyB0aGlzLmZsb2F0aW5nID8gZCAmJiAicmlnaHQiID09PSBkIHx8ICJkb3duIiA9PT0gYSA/IDIgOiAxIDogYSAmJiAoImRvd24iID09PSBhID8gMiA6IDEpIDogITEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaW50ZXJzZWN0c1dpdGhTaWRlczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCwgYS50b3AgKyBhLmhlaWdodCAvIDIsIGEuaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBhID0gdGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQgKwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldC5jbGljay5sZWZ0LCBhLmxlZnQgKyBhLndpZHRoIC8gMiwgYS53aWR0aCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvYXRpbmcgJiYgZyA/ICJyaWdodCIgPT09IGcgJiYgYSB8fCAibGVmdCIgPT09IGcgJiYgIWEgOiBkICYmICgiZG93biIgPT09IGQgJiYgYyB8fCAidXAiID09PSBkICYmICFjKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXREcmFnVmVydGljYWxEaXJlY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5wb3NpdGlvbkFicy50b3AgLSB0aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgIT09IGEgJiYgKDAgPCBhID8gImRvd24iIDogInVwIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5wb3NpdGlvbkFicy5sZWZ0IC0gdGhpcy5sYXN0UG9zaXRpb25BYnMubGVmdDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCAhPT0gYSAmJiAoMCA8IGEgPyAicmlnaHQiIDogImxlZnQiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoSXRlbXMoYSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoUG9zaXRpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY29ubmVjdFdpdGg6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBbYS5jb25uZWN0V2l0aF0gOiBhLmNvbm5lY3RXaXRoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldEl0ZW1zQXNqUXVlcnk6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKCkgewogICAgICAgICAgICAgICAgICAgICAgICBrLnB1c2godGhpcykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGcsIGYsIGsgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gdGhpcy5fY29ubmVjdFdpdGgoKTsKICAgICAgICAgICAgICAgICAgICBpZiAocCAmJiBiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSBwLmxlbmd0aCAtIDE7IDAgPD0gYjsgYi0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gYShwW2JdLCB0aGlzLmRvY3VtZW50WzBdKSwgZCA9IGcubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pKGYgPSBhLmRhdGEoZ1tkXSwgdGhpcy53aWRnZXRGdWxsTmFtZSkpICYmIGYgIT09IHRoaXMgJiYgIWYub3B0aW9ucy5kaXNhYmxlZCAmJiBoLnB1c2goW2EuaXNGdW5jdGlvbihmLm9wdGlvbnMuaXRlbXMpID8gZi5vcHRpb25zLml0ZW1zLmNhbGwoZi5lbGVtZW50KSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYShmLm9wdGlvbnMuaXRlbXMsIGYuZWxlbWVudCkubm90KCIudWktc29ydGFibGUtaGVscGVyIikubm90KCIudWktc29ydGFibGUtcGxhY2Vob2xkZXIiKSwgZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgaC5wdXNoKFthLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKSA/IHRoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCwgbnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMuY3VycmVudEl0ZW0KICAgICAgICAgICAgICAgICAgICB9KSA6IGEodGhpcy5vcHRpb25zLml0ZW1zLCB0aGlzLmVsZW1lbnQpLm5vdCgiLnVpLXNvcnRhYmxlLWhlbHBlciIpLm5vdCgiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIiksIHRoaXNdKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSBoLmxlbmd0aCAtIDE7IDAgPD0gYjsgYi0tKSBoW2JdWzBdLmVhY2goYyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEoaykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5jdXJyZW50SXRlbS5maW5kKCI6ZGF0YSgiICsgdGhpcy53aWRnZXROYW1lICsgIi1pdGVtKSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBhLmdyZXAodGhpcy5pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBiLmxlbmd0aDsgZCsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiW2RdID09PSBhLml0ZW1bMF0pIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZWZyZXNoSXRlbXM6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zID0gW107CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJzID0gW3RoaXNdOwogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBmLCBrLCBoID0gdGhpcy5pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFthLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKSA/IHRoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudFswXSwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMuY3VycmVudEl0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogYSh0aGlzLm9wdGlvbnMuaXRlbXMsIHRoaXMuZWxlbWVudCksIHRoaXNdCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgaWYgKChrID0gdGhpcy5fY29ubmVjdFdpdGgoKSkgJiYgdGhpcy5yZWFkeSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gay5sZW5ndGggLSAxOyAwIDw9IGM7IGMtLSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IGEoa1tjXSwgdGhpcy5kb2N1bWVudFswXSksIGQgPSBnLmxlbmd0aCAtIDE7IDAgPD0gZDsgZC0tKShmID0gYS5kYXRhKGdbZF0sIHRoaXMud2lkZ2V0RnVsbE5hbWUpKSAmJiBmICE9PSB0aGlzICYmICFmLm9wdGlvbnMuZGlzYWJsZWQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocC5wdXNoKFthLmlzRnVuY3Rpb24oZi5vcHRpb25zLml0ZW1zKSA/IGYub3B0aW9ucy5pdGVtcy5jYWxsKGYuZWxlbWVudFswXSwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiB0aGlzLmN1cnJlbnRJdGVtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBhKGYub3B0aW9ucy5pdGVtcywgZi5lbGVtZW50KSwgZl0pLCB0aGlzLmNvbnRhaW5lcnMucHVzaChmKSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gcC5sZW5ndGggLSAxOyAwIDw9IGM7IGMtLSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gcFtjXVsxXSwgZyA9IHBbY11bMF0sIGQgPSAwLCBrID0gZy5sZW5ndGg7IGQgPCBrOyBkKyspIGYgPSBhKGdbZF0pLCBmLmRhdGEodGhpcy53aWRnZXROYW1lICsgIi1pdGVtIiwgYiksIGgucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2U6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWZyZXNoUG9zaXRpb25zOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG9hdGluZyA9IHRoaXMuaXRlbXMubGVuZ3RoID8gIngiID09PSB0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuaXRlbXNbMF0uaXRlbSkgOiAhMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldFBhcmVudCAmJiB0aGlzLmhlbHBlciAmJiAodGhpcy5vZmZzZXQucGFyZW50ID0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkpOwogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnOwogICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgMCA8PSBjOyBjLS0pIGQgPSB0aGlzLml0ZW1zW2NdLCBkLmluc3RhbmNlICE9PSB0aGlzLmN1cnJlbnRDb250YWluZXIgJiYgdGhpcy5jdXJyZW50Q29udGFpbmVyICYmIGQuaXRlbVswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSB8fCAoZyA9IHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50ID8gYSh0aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudCwgZC5pdGVtKSA6IGQuaXRlbSwgYiB8fCAoZC53aWR0aCA9IGcub3V0ZXJXaWR0aCgpLCBkLmhlaWdodCA9IGcub3V0ZXJIZWlnaHQoKSksIGcgPSBnLm9mZnNldCgpLCBkLmxlZnQgPSBnLmxlZnQsIGQudG9wID0gZy50b3ApOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY3VzdG9tICYmIHRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMpIHRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyAwIDw9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjOyBjLS0pIGcgPSB0aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudC5vZmZzZXQoKSwgdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLmxlZnQgPSBnLmxlZnQsIHRoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS50b3AgPSBnLnRvcCwgdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLndpZHRoID0gdGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJXaWR0aCgpLCB0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUuaGVpZ2h0ID0gdGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVQbGFjZWhvbGRlcjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGIgPSBiIHx8IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBiLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZC5wbGFjZWhvbGRlciAmJiBkLnBsYWNlaG9sZGVyLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgfHwgKGMgPSBkLnBsYWNlaG9sZGVyLCBkLnBsYWNlaG9sZGVyID0gewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYi5jdXJyZW50SXRlbVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBhKCI8IiArIGQgKyAiPiIsIGIuZG9jdW1lbnRbMF0pLmFkZENsYXNzKGMgfHwgYi5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUgKyAiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIikucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInRib2R5IiA9PT0gZCA/IGIuX2NyZWF0ZVRyUGxhY2Vob2xkZXIoYi5jdXJyZW50SXRlbS5maW5kKCJ0ciIpLmVxKDApLCBhKCI8dHI+IiwgYi5kb2N1bWVudFswXSkuYXBwZW5kVG8oZikpIDogInRyIiA9PT0gZCA/IGIuX2NyZWF0ZVRyUGxhY2Vob2xkZXIoYi5jdXJyZW50SXRlbSwgZikgOiAiaW1nIiA9PT0gZCAmJiBmLmF0dHIoInNyYyIsIGIuY3VycmVudEl0ZW0uYXR0cigic3JjIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyB8fCBmLmNzcygidmlzaWJpbGl0eSIsICJoaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oYSwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjIHx8IGQuZm9yY2VQbGFjZWhvbGRlclNpemUpIGYuaGVpZ2h0KCkgfHwgZi5oZWlnaHQoYi5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpIC0gcGFyc2VJbnQoYi5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdUb3AiKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDEwKSAtIHBhcnNlSW50KGIuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nQm90dG9tIikgfHwgMCwgMTApKSwgZi53aWR0aCgpIHx8IGYud2lkdGgoYi5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCkgLSBwYXJzZUludChiLmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ0xlZnQiKSB8fCAwLCAxMCkgLSBwYXJzZUludChiLmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ1JpZ2h0IikgfHwgMCwgMTApKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYi5wbGFjZWhvbGRlciA9IGEoZC5wbGFjZWhvbGRlci5lbGVtZW50LmNhbGwoYi5lbGVtZW50LCBiLmN1cnJlbnRJdGVtKSk7CiAgICAgICAgICAgICAgICAgICAgYi5jdXJyZW50SXRlbS5hZnRlcihiLnBsYWNlaG9sZGVyKTsKICAgICAgICAgICAgICAgICAgICBkLnBsYWNlaG9sZGVyLnVwZGF0ZShiLCBiLnBsYWNlaG9sZGVyKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jcmVhdGVUclBsYWNlaG9sZGVyOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGIuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBhKCI8dGQ+JiMxNjA7PC90ZD4iLCBkLmRvY3VtZW50WzBdKS5hdHRyKCJjb2xzcGFuIiwgYSh0aGlzKS5hdHRyKCJjb2xzcGFuIikgfHwgMSkuYXBwZW5kVG8oYykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jb250YWN0Q29udGFpbmVyczogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnLCBmLCBrLCBoLCBwLCBsLCBlID0gZiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gdGhpcy5jb250YWluZXJzLmxlbmd0aCAtIDE7IDAgPD0gYzsgYy0tKSBhLmNvbnRhaW5zKHRoaXMuY3VycmVudEl0ZW1bMF0sIHRoaXMuY29udGFpbmVyc1tjXS5lbGVtZW50WzBdKSB8fCAodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlKSA/IGYgJiYgYS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudFswXSwgZi5lbGVtZW50WzBdKSB8fCAoZiA9IHRoaXMuY29udGFpbmVyc1tjXSwgZSA9IGMpIDogdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLm92ZXIgJiYgKHRoaXMuY29udGFpbmVyc1tjXS5fdHJpZ2dlcigib3V0IiwgYiwgdGhpcy5fdWlIYXNoKHRoaXMpKSwgdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLm92ZXIgPSAwKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09PSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoKSB0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3ZlciB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuY29udGFpbmVyc1tlXS5fdHJpZ2dlcigib3ZlciIsIGIsIHRoaXMuX3VpSGFzaCh0aGlzKSksIHRoaXMuY29udGFpbmVyc1tlXS5jb250YWluZXJDYWNoZS5vdmVyID0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDFFNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IChkID0gZi5mbG9hdGluZyB8fCB0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuY3VycmVudEl0ZW0pKSA/ICJsZWZ0IiA6ICJ0b3AiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGQgPyAid2lkdGgiIDogImhlaWdodCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gZCA/ICJjbGllbnRYIiA6ICJjbGllbnRZIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZCA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pIGEuY29udGFpbnModGhpcy5jb250YWluZXJzW2VdLmVsZW1lbnRbMF0sIHRoaXMuaXRlbXNbZF0uaXRlbVswXSkgJiYgdGhpcy5pdGVtc1tkXS5pdGVtWzBdICE9PSB0aGlzLmN1cnJlbnRJdGVtWzBdICYmIChoID0gdGhpcy5pdGVtc1tkXS5pdGVtLm9mZnNldCgpW2ZdLCBwID0gITEsIGJbbF0gLSBoID4gdGhpcy5pdGVtc1tkXVtrXSAvIDIgJiYgKHAgPSAhMCksIE1hdGguYWJzKGJbbF0gLSBoKSA8IGMgJiYgKGMgPSBNYXRoLmFicyhiW2xdIC0gaCksIGcgPSB0aGlzLml0ZW1zW2RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gcCA/ICJ1cCIgOiAiZG93biIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnIHx8IHRoaXMub3B0aW9ucy5kcm9wT25FbXB0eSkgdGhpcy5jdXJyZW50Q29udGFpbmVyID09PSB0aGlzLmNvbnRhaW5lcnNbZV0gPyB0aGlzLmN1cnJlbnRDb250YWluZXIuY29udGFpbmVyQ2FjaGUub3ZlciB8fCAodGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKCJvdmVyIiwgYiwgdGhpcy5fdWlIYXNoKCkpLCB0aGlzLmN1cnJlbnRDb250YWluZXIuY29udGFpbmVyQ2FjaGUub3ZlciA9IDEpIDogKGcgPyB0aGlzLl9yZWFycmFuZ2UoYiwgZywgbnVsbCwgITApIDogdGhpcy5fcmVhcnJhbmdlKGIsIG51bGwsIHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50LCAhMCksIHRoaXMuX3RyaWdnZXIoImNoYW5nZSIsIGIsIHRoaXMuX3VpSGFzaCgpKSwgdGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKCJjaGFuZ2UiLCBiLCB0aGlzLl91aUhhc2godGhpcykpLCB0aGlzLmN1cnJlbnRDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcnNbZV0sIHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlci51cGRhdGUodGhpcy5jdXJyZW50Q29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIpLCB0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoIm92ZXIiLCBiLCB0aGlzLl91aUhhc2godGhpcykpLCB0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3ZlciA9IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlSGVscGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEuaXNGdW5jdGlvbihjLmhlbHBlcikgPyBhKGMuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2IsIHRoaXMuY3VycmVudEl0ZW1dKSkgOiAiY2xvbmUiID09PSBjLmhlbHBlciA/IHRoaXMuY3VycmVudEl0ZW0uY2xvbmUoKSA6IHRoaXMuY3VycmVudEl0ZW07CiAgICAgICAgICAgICAgICAgICAgYi5wYXJlbnRzKCJib2R5IikubGVuZ3RoIHx8IGEoInBhcmVudCIgIT09IGMuYXBwZW5kVG8gPyBjLmFwcGVuZFRvIDogdGhpcy5jdXJyZW50SXRlbVswXS5wYXJlbnROb2RlKVswXS5hcHBlbmRDaGlsZChiWzBdKTsKICAgICAgICAgICAgICAgICAgICBiWzBdID09PSB0aGlzLmN1cnJlbnRJdGVtWzBdICYmICh0aGlzLl9zdG9yZWRDU1MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogdGhpcy5jdXJyZW50SXRlbS5jc3MoInBvc2l0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5jdXJyZW50SXRlbS5jc3MoInRvcCIpLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB0aGlzLmN1cnJlbnRJdGVtLmNzcygibGVmdCIpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgYlswXS5zdHlsZS53aWR0aCAmJiAhYy5mb3JjZUhlbHBlclNpemUgfHwgYi53aWR0aCh0aGlzLmN1cnJlbnRJdGVtLndpZHRoKCkpOwogICAgICAgICAgICAgICAgICAgIGJbMF0uc3R5bGUuaGVpZ2h0ICYmICFjLmZvcmNlSGVscGVyU2l6ZSB8fCBiLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBiICYmIChiID0gYi5zcGxpdCgiICIpKTsKICAgICAgICAgICAgICAgICAgICBhLmlzQXJyYXkoYikgJiYgKGIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICtiWzBdLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICtiWzFdIHx8IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAibGVmdCIgaW4gYiAmJiAodGhpcy5vZmZzZXQuY2xpY2subGVmdCA9IGIubGVmdCArIHRoaXMubWFyZ2lucy5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAicmlnaHQiIGluIGIgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gYi5yaWdodCArIHRoaXMubWFyZ2lucy5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAidG9wIiBpbiBiICYmICh0aGlzLm9mZnNldC5jbGljay50b3AgPSBiLnRvcCArIHRoaXMubWFyZ2lucy50b3ApOwogICAgICAgICAgICAgICAgICAgICJib3R0b20iIGluIGIgJiYgKHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA9IHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gYi5ib3R0b20gKyB0aGlzLm1hcmdpbnMudG9wKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRQYXJlbnRPZmZzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0UGFyZW50ID0gdGhpcy5oZWxwZXIub2Zmc2V0UGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICAiYWJzb2x1dGUiID09PSB0aGlzLmNzc1Bvc2l0aW9uICYmIHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSB0aGlzLmRvY3VtZW50WzBdICYmIGEuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sIHRoaXMub2Zmc2V0UGFyZW50WzBdKSAmJiAoYi5sZWZ0ICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSwgYi50b3AgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9mZnNldFBhcmVudFswXSA9PT0gdGhpcy5kb2N1bWVudFswXS5ib2R5IHx8IHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUgJiYgImh0bWwiID09PSB0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgJiYgYS51aS5pZSkgYiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGIudG9wICsgKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBiLmxlZnQgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwgMTApIHx8IDApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRSZWxhdGl2ZU9mZnNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCJyZWxhdGl2ZSIgPT09IHRoaXMuY3NzUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGEudG9wIC0gKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygidG9wIiksIDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYS5sZWZ0IC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJsZWZ0IiksIDEwKSB8fCAwKSArIHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY2FjaGVNYXJnaW5zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcmdpbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5MZWZ0IiksIDEwKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5Ub3AiKSwgMTApIHx8IDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0Q29udGFpbm1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiLCBjLCBkOwogICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgInBhcmVudCIgPT09IGMuY29udGFpbm1lbnQgJiYgKGMuY29udGFpbm1lbnQgPSB0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoImRvY3VtZW50IiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgYy5jb250YWlubWVudCB8fCAid2luZG93IiA9PT0gYy5jb250YWlubWVudCkgdGhpcy5jb250YWlubWVudCA9IFswIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LCAwIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wIC0gdGhpcy5vZmZzZXQucGFyZW50LnRvcCwgImRvY3VtZW50IiA9PT0gYy5jb250YWlubWVudCA/IHRoaXMuZG9jdW1lbnQud2lkdGgoKSA6IHRoaXMud2luZG93LndpZHRoKCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdGhpcy5tYXJnaW5zLmxlZnQsICgiZG9jdW1lbnQiID09PSBjLmNvbnRhaW5tZW50ID8gdGhpcy5kb2N1bWVudC53aWR0aCgpIDogdGhpcy53aW5kb3cuaGVpZ2h0KCkgfHwgdGhpcy5kb2N1bWVudFswXS5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcF07CiAgICAgICAgICAgICAgICAgICAgL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGMuY29udGFpbm1lbnQpIHx8IChiID0gYShjLmNvbnRhaW5tZW50KVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGEoYy5jb250YWlubWVudCkub2Zmc2V0KCksIGQgPSAiaGlkZGVuIiAhPT0gYShiKS5jc3MoIm92ZXJmbG93IiksIHRoaXMuY29udGFpbm1lbnQgPSBbYy5sZWZ0ICsgKHBhcnNlSW50KGEoYikuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwgMTApIHx8IDApICsgKHBhcnNlSW50KGEoYikuY3NzKCJwYWRkaW5nTGVmdCIpLCAxMCkgfHwgMCkgLSB0aGlzLm1hcmdpbnMubGVmdCwgYy50b3AgKyAocGFyc2VJbnQoYShiKS5jc3MoImJvcmRlclRvcFdpZHRoIiksIDEwKSB8fCAwKSArIChwYXJzZUludChhKGIpLmNzcygicGFkZGluZ1RvcCIpLCAxMCkgfHwgMCkgLSB0aGlzLm1hcmdpbnMudG9wLCBjLmxlZnQgKyAoZCA/IE1hdGgubWF4KGIuc2Nyb2xsV2lkdGgsIGIub2Zmc2V0V2lkdGgpIDogYi5vZmZzZXRXaWR0aCkgLSAocGFyc2VJbnQoYShiKS5jc3MoImJvcmRlckxlZnRXaWR0aCIpLCAxMCkgfHwgMCkgLSAocGFyc2VJbnQoYShiKS5jc3MoInBhZGRpbmdSaWdodCIpLCAxMCkgfHwgMCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gdGhpcy5tYXJnaW5zLmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnRvcCArIChkID8gTWF0aC5tYXgoYi5zY3JvbGxIZWlnaHQsIGIub2Zmc2V0SGVpZ2h0KSA6IGIub2Zmc2V0SGVpZ2h0KSAtIChwYXJzZUludChhKGIpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwgMTApIHx8IDApIC0gKHBhcnNlSW50KGEoYikuY3NzKCJwYWRkaW5nQm90dG9tIiksIDEwKSB8fCAwKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcAogICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9jb252ZXJ0UG9zaXRpb25UbzogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIGMgfHwgKGMgPSB0aGlzLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9ICJhYnNvbHV0ZSIgPT09IGIgPyAxIDogLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAiYWJzb2x1dGUiICE9PSB0aGlzLmNzc1Bvc2l0aW9uIHx8IHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSB0aGlzLmRvY3VtZW50WzBdICYmIGEuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sIHRoaXMub2Zmc2V0UGFyZW50WzBdKSA/IHRoaXMuc2Nyb2xsUGFyZW50IDogdGhpcy5vZmZzZXRQYXJlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAvKGh0bWx8Ym9keSkvaS50ZXN0KGdbMF0udGFnTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBjLnRvcCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgKiBkICsgdGhpcy5vZmZzZXQucGFyZW50LnRvcCAqIGQgLSAoImZpeGVkIiA9PT0gdGhpcy5jc3NQb3NpdGlvbiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSA6IGYgPyAwIDogZy5zY3JvbGxUb3AoKSkgKiBkLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBjLmxlZnQgKyB0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0ICogZCArIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0ICogZCAtICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSA6IGYgPyAwIDogZy5zY3JvbGxMZWZ0KCkpICogZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZ2VuZXJhdGVQb3NpdGlvbjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBnID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIGQgPSBiLnBhZ2VYOwogICAgICAgICAgICAgICAgICAgIGMgPSBiLnBhZ2VZOwogICAgICAgICAgICAgICAgICAgIHZhciBmID0gImFic29sdXRlIiAhPT0gdGhpcy5jc3NQb3NpdGlvbiB8fCB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gdGhpcy5kb2N1bWVudFswXSAmJiBhLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLCB0aGlzLm9mZnNldFBhcmVudFswXSkgPyB0aGlzLnNjcm9sbFBhcmVudCA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0UGFyZW50LAogICAgICAgICAgICAgICAgICAgICAgICBrID0gLyhodG1sfGJvZHkpL2kudGVzdChmWzBdLnRhZ05hbWUpOwogICAgICAgICAgICAgICAgICAgICJyZWxhdGl2ZSIgIT09IHRoaXMuY3NzUG9zaXRpb24gfHwgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMuZG9jdW1lbnRbMF0gJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IHRoaXMub2Zmc2V0UGFyZW50WzBdIHx8ICh0aGlzLm9mZnNldC5yZWxhdGl2ZSA9IHRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxQb3NpdGlvbiAmJiAodGhpcy5jb250YWlubWVudCAmJiAoYi5wYWdlWCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPCB0aGlzLmNvbnRhaW5tZW50WzBdICYmIChkID0gdGhpcy5jb250YWlubWVudFswXSArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLCBiLnBhZ2VZIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIDwgdGhpcy5jb250YWlubWVudFsxXSAmJiAoYyA9IHRoaXMuY29udGFpbm1lbnRbMV0gKyB0aGlzLm9mZnNldC5jbGljay50b3ApLCBiLnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+IHRoaXMuY29udGFpbm1lbnRbMl0gJiYKICAgICAgICAgICAgICAgICAgICAgICAgKGQgPSB0aGlzLmNvbnRhaW5tZW50WzJdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCksIGIucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPiB0aGlzLmNvbnRhaW5tZW50WzNdICYmIChjID0gdGhpcy5jb250YWlubWVudFszXSArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCkpLCBnLmdyaWQgJiYgKGMgPSB0aGlzLm9yaWdpbmFsUGFnZVkgKyBNYXRoLnJvdW5kKChjIC0gdGhpcy5vcmlnaW5hbFBhZ2VZKSAvIGcuZ3JpZFsxXSkgKiBnLmdyaWRbMV0sIGMgPSB0aGlzLmNvbnRhaW5tZW50ID8gYyAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSB0aGlzLmNvbnRhaW5tZW50WzFdICYmIGMgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPD0gdGhpcy5jb250YWlubWVudFszXSA/IGMgOiBjIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID49IHRoaXMuY29udGFpbm1lbnRbMV0gPyBjIC0gZy5ncmlkWzFdIDogYyArIGcuZ3JpZFsxXSA6IGMsIGQgPSB0aGlzLm9yaWdpbmFsUGFnZVggKyBNYXRoLnJvdW5kKChkIC0gdGhpcy5vcmlnaW5hbFBhZ2VYKSAvIGcuZ3JpZFswXSkgKiBnLmdyaWRbMF0sIGQgPSB0aGlzLmNvbnRhaW5tZW50ID8KICAgICAgICAgICAgICAgICAgICAgICAgZCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPj0gdGhpcy5jb250YWlubWVudFswXSAmJiBkIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8PSB0aGlzLmNvbnRhaW5tZW50WzJdID8gZCA6IGQgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IHRoaXMuY29udGFpbm1lbnRbMF0gPyBkIC0gZy5ncmlkWzBdIDogZCArIGcuZ3JpZFswXSA6IGQpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGMgLSB0aGlzLm9mZnNldC5jbGljay50b3AgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgLSB0aGlzLm9mZnNldC5wYXJlbnQudG9wICsgKCJmaXhlZCIgPT09IHRoaXMuY3NzUG9zaXRpb24gPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkgOiBrID8gMCA6IGYuc2Nyb2xsVG9wKCkpLAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBkIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQgLSB0aGlzLm9mZnNldC5wYXJlbnQubGVmdCArICgiZml4ZWQiID09PSB0aGlzLmNzc1Bvc2l0aW9uID8gLXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSA6IGsgPyAwIDogZi5zY3JvbGxMZWZ0KCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZWFycmFuZ2U6IGZ1bmN0aW9uKGEsCiAgICAgICAgICAgICAgICAgICAgYywgZCwgZykgewogICAgICAgICAgICAgICAgICAgIGQgPyBkWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pIDogYy5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sICJkb3duIiA9PT0gdGhpcy5kaXJlY3Rpb24gPyBjLml0ZW1bMF0gOiBjLml0ZW1bMF0ubmV4dFNpYmxpbmcpOwogICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5jb3VudGVyID0gdGhpcy5jb3VudGVyID8gKyt0aGlzLmNvdW50ZXIgOiAxOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmID09PSB0aGlzLmNvdW50ZXIgJiYgdGhpcy5yZWZyZXNoUG9zaXRpb25zKCFnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NsZWFyOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZChhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLl90cmlnZ2VyKGEsIGQsIGIuX3VpSGFzaChiKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJldmVydGluZyA9ICExOwogICAgICAgICAgICAgICAgICAgIHZhciBnLCBmID0gW107CiAgICAgICAgICAgICAgICAgICAgIXRoaXMuX25vRmluYWxTb3J0ICYmIHRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoICYmIHRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKHRoaXMuY3VycmVudEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX25vRmluYWxTb3J0ID0KICAgICAgICAgICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oZWxwZXJbMF0gPT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnIGluIHRoaXMuX3N0b3JlZENTUykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiYXV0byIgPT09IHRoaXMuX3N0b3JlZENTU1tnXSB8fCAic3RhdGljIiA9PT0gdGhpcy5fc3RvcmVkQ1NTW2ddKSB0aGlzLl9zdG9yZWRDU1NbZ10gPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIikKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mcm9tT3V0c2lkZSAmJiAhYyAmJiBmLnB1c2goZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJyZWNlaXZlIiwgYSwgdGhpcy5fdWlIYXNoKHRoaXMuZnJvbU91dHNpZGUpKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICF0aGlzLmZyb21PdXRzaWRlICYmIHRoaXMuZG9tUG9zaXRpb24ucHJldiA9PT0gdGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KCIudWktc29ydGFibGUtaGVscGVyIilbMF0gJiYgdGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQgPT09IHRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0gfHwKICAgICAgICAgICAgICAgICAgICAgICAgYyB8fCBmLnB1c2goZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigidXBkYXRlIiwgYSwgdGhpcy5fdWlIYXNoKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMgPT09IHRoaXMuY3VycmVudENvbnRhaW5lciB8fCBjIHx8IChmLnB1c2goZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLCBhLCB0aGlzLl91aUhhc2goKSkKICAgICAgICAgICAgICAgICAgICB9KSwgZi5wdXNoKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuX3RyaWdnZXIoInJlY2VpdmUiLCBiLCB0aGlzLl91aUhhc2godGhpcykpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LmNhbGwodGhpcywgdGhpcy5jdXJyZW50Q29udGFpbmVyKSksIGYucHVzaChmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLl90cmlnZ2VyKCJ1cGRhdGUiLCBiLCB0aGlzLl91aUhhc2godGhpcykpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LmNhbGwodGhpcywgdGhpcy5jdXJyZW50Q29udGFpbmVyKSkpOwogICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxOyAwIDw9IGc7IGctLSkgYyB8fCBmLnB1c2goZCgiZGVhY3RpdmF0ZSIsIHRoaXMsIHRoaXMuY29udGFpbmVyc1tnXSkpLCB0aGlzLmNvbnRhaW5lcnNbZ10uY29udGFpbmVyQ2FjaGUub3ZlciAmJgogICAgICAgICAgICAgICAgICAgICAgICAoZi5wdXNoKGQoIm91dCIsIHRoaXMsIHRoaXMuY29udGFpbmVyc1tnXSkpLCB0aGlzLmNvbnRhaW5lcnNbZ10uY29udGFpbmVyQ2FjaGUub3ZlciA9IDApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVkQ3Vyc29yICYmICh0aGlzLmRvY3VtZW50LmZpbmQoImJvZHkiKS5jc3MoImN1cnNvciIsIHRoaXMuc3RvcmVkQ3Vyc29yKSwgdGhpcy5zdG9yZWRTdHlsZXNoZWV0LnJlbW92ZSgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZWRPcGFjaXR5ICYmIHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIsIHRoaXMuX3N0b3JlZE9wYWNpdHkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlZFpJbmRleCAmJiB0aGlzLmhlbHBlci5jc3MoInpJbmRleCIsICJhdXRvIiA9PT0gdGhpcy5fc3RvcmVkWkluZGV4ID8gIiIgOiB0aGlzLl9zdG9yZWRaSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2dpbmcgPSAhMTsKICAgICAgICAgICAgICAgICAgICBjIHx8IHRoaXMuX3RyaWdnZXIoImJlZm9yZVN0b3AiLCBhLCB0aGlzLl91aUhhc2goKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCB8fAogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5oZWxwZXJbMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0gJiYgdGhpcy5oZWxwZXIucmVtb3ZlKCksIHRoaXMuaGVscGVyID0gbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBmLmxlbmd0aDsgZysrKSBmW2ddLmNhbGwodGhpcywgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoInN0b3AiLCBhLCB0aGlzLl91aUhhc2goKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mcm9tT3V0c2lkZSA9ICExOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RyaWdnZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICExID09PSBhLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSAmJiB0aGlzLmNhbmNlbCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3VpSGFzaDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYiB8fCB0aGlzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHBlcjogYy5oZWxwZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBjLnBsYWNlaG9sZGVyIHx8IGEoW10pLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYy5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxQb3NpdGlvbjogYy5vcmlnaW5hbFBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGMucG9zaXRpb25BYnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGMuY3VycmVudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogYiA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmVsZW1lbnQgOiBudWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLnNwaW5uZXIiLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIGRlZmF1bHRFbGVtZW50OiAiPGlucHV0PiIsCiAgICAgICAgICAgICAgICB3aWRnZXRFdmVudFByZWZpeDogInNwaW4iLAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIGN1bHR1cmU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgaWNvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZG93bjogInVpLWljb24tdHJpYW5nbGUtMS1zIiwKICAgICAgICAgICAgICAgICAgICAgICAgdXA6ICJ1aS1pY29uLXRyaWFuZ2xlLTEtbiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGluY3JlbWVudGFsOiAhMCwKICAgICAgICAgICAgICAgICAgICBtYXg6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbWluOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG51bWJlckZvcm1hdDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBwYWdlOiAxMCwKICAgICAgICAgICAgICAgICAgICBzdGVwOiAxLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzcGluOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudWxsLAogICAgICAgICAgICAgICAgICAgIHN0b3A6IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRPcHRpb24oIm1heCIsIHRoaXMub3B0aW9ucy5tYXgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldE9wdGlvbigibWluIiwgdGhpcy5vcHRpb25zLm1pbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0T3B0aW9uKCJzdGVwIiwgdGhpcy5vcHRpb25zLnN0ZXApOwogICAgICAgICAgICAgICAgICAgICIiICE9PSB0aGlzLnZhbHVlKCkgJiYgdGhpcy5fdmFsdWUodGhpcy5lbGVtZW50LnZhbCgpLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHJhdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHRoaXMuX2V2ZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHRoaXMud2luZG93LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZXVubG9hZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldENyZWF0ZU9wdGlvbnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgYS5lYWNoKFsibWluIiwgIm1heCIsICJzdGVwIl0sIGZ1bmN0aW9uKGEsIGcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBjLmF0dHIoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gZiAmJiBmLmxlbmd0aCAmJiAoYltnXSA9IGYpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFydChhKSAmJiB0aGlzLl9rZXlkb3duKGEpICYmIGEucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAga2V5dXA6ICJfc3RvcCIsCiAgICAgICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzID0gdGhpcy5lbGVtZW50LnZhbCgpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsQmx1ciA/IGRlbGV0ZSB0aGlzLmNhbmNlbEJsdXIgOiAodGhpcy5fc3RvcCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpLCB0aGlzLnByZXZpb3VzICE9PSB0aGlzLmVsZW1lbnQudmFsKCkgJiYgdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgYSkpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBtb3VzZXdoZWVsOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc3Bpbm5pbmcgJiYgIXRoaXMuX3N0YXJ0KGEpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zcGluKCgwIDwgYyA/IDEgOiAtMSkgKiB0aGlzLm9wdGlvbnMuc3RlcCwgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5tb3VzZXdoZWVsVGltZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZXdoZWVsVGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uaW5nICYmIHRoaXMuX3N0b3AoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm1vdXNlZG93biAudWktc3Bpbm5lci1idXR0b24iOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRbMF0gIT09IHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCAmJiAodGhpcy5lbGVtZW50LmZvY3VzKCksIHRoaXMucHJldmlvdXMgPSBkLCB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmVsZW1lbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCA/IHRoaXMucHJldmlvdXMgOiB0aGlzLmVsZW1lbnQudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbEJsdXIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxCbHVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jYWxsKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAhMSAhPT0gdGhpcy5fc3RhcnQoYikgJiYgdGhpcy5fcmVwZWF0KG51bGwsIGEoYi5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcygidWktc3Bpbm5lci11cCIpID8gMSA6IC0xLCBiKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm1vdXNldXAgLnVpLXNwaW5uZXItYnV0dG9uIjogIl9zdG9wIiwKICAgICAgICAgICAgICAgICAgICAibW91c2VlbnRlciAudWktc3Bpbm5lci1idXR0b24iOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhKGIuY3VycmVudFRhcmdldCkuaGFzQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IHRoaXMuX3N0YXJ0KGIpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXBlYXQobnVsbCwgYShiLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKCJ1aS1zcGlubmVyLXVwIikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgOiAtMSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIm1vdXNlbGVhdmUgLnVpLXNwaW5uZXItYnV0dG9uIjogIl9zdG9wIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kcmF3OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMudWlTcGlubmVyID0gdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1zcGlubmVyLWlucHV0IikuYXR0cigiYXV0b2NvbXBsZXRlIiwgIm9mZiIpLndyYXAodGhpcy5fdWlTcGlubmVySHRtbCgpKS5wYXJlbnQoKS5hcHBlbmQodGhpcy5fYnV0dG9uSHRtbCgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cigicm9sZSIsICJzcGluYnV0dG9uIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b25zID0gYS5maW5kKCIudWktc3Bpbm5lci1idXR0b24iKS5hdHRyKCJ0YWJJbmRleCIsIC0xKS5idXR0b24oKS5yZW1vdmVDbGFzcygidWktY29ybmVyLWFsbCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9ucy5oZWlnaHQoKSA+IE1hdGguY2VpbCguNSAqIGEuaGVpZ2h0KCkpICYmIDAgPCBhLmhlaWdodCgpICYmIGEuaGVpZ2h0KGEuaGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiB0aGlzLmRpc2FibGUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9rZXlkb3duOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhLnVpLmtleUNvZGU7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChiLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBkLlVQOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcGVhdChudWxsLCAxLCBiKSwgITA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZC5ET1dOOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcGVhdChudWxsLCAtMSwgYiksICEwOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGQuUEFHRV9VUDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXBlYXQobnVsbCwgYy5wYWdlLCBiKSwgITA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZC5QQUdFX0RPV046CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVwZWF0KG51bGwsIC1jLnBhZ2UsIGIpLCAhMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdWlTcGlubmVySHRtbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0ndWktc3Bpbm5lciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCc+PC9zcGFuPiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYnV0dG9uSHRtbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8YSBjbGFzcz0ndWktc3Bpbm5lci1idXR0b24gdWktc3Bpbm5lci11cCB1aS1jb3JuZXItdHInPjxzcGFuIGNsYXNzPSd1aS1pY29uICIgKyB0aGlzLm9wdGlvbnMuaWNvbnMudXAgKyAiJz4mIzk2NTA7PC9zcGFuPjwvYT48YSBjbGFzcz0ndWktc3Bpbm5lci1idXR0b24gdWktc3Bpbm5lci1kb3duIHVpLWNvcm5lci1icic+PHNwYW4gY2xhc3M9J3VpLWljb24gIiArCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5pY29ucy5kb3duICsgIic+JiM5NjYwOzwvc3Bhbj48L2E+IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zdGFydDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zcGlubmluZyAmJiAhMSA9PT0gdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBhKSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY291bnRlciB8fCAodGhpcy5jb3VudGVyID0gMSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3Bpbm5pbmcgPSAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZXBlYXQ6IGZ1bmN0aW9uKGEsIGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICBhID0gYSB8fCA1MDA7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVwZWF0KDQwLCBjLCBkKQogICAgICAgICAgICAgICAgICAgIH0sIGEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NwaW4oYyAqIHRoaXMub3B0aW9ucy5zdGVwLCBkKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9zcGluOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnZhbHVlKCkgfHwgMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ZXIgfHwgKHRoaXMuY291bnRlciA9IDEpOwogICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9hZGp1c3RWYWx1ZShkICsgYSAqIHRoaXMuX2luY3JlbWVudCh0aGlzLmNvdW50ZXIpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uaW5nICYmICExID09PSB0aGlzLl90cmlnZ2VyKCJzcGluIiwKICAgICAgICAgICAgICAgICAgICAgICAgYywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGQKICAgICAgICAgICAgICAgICAgICAgICAgfSkgfHwgKHRoaXMuX3ZhbHVlKGQpLCB0aGlzLmNvdW50ZXIrKykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfaW5jcmVtZW50OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm9wdGlvbnMuaW5jcmVtZW50YWw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPyBhLmlzRnVuY3Rpb24oYykgPyBjKGIpIDogTWF0aC5mbG9vcihiICogYiAqIGIgLyA1RTQgLSBiICogYiAvIDUwMCArIDE3ICogYiAvIDIwMCArIDEpIDogMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9wcmVjaXNpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcHJlY2lzaW9uT2YodGhpcy5vcHRpb25zLnN0ZXApOwogICAgICAgICAgICAgICAgICAgIG51bGwgIT09IHRoaXMub3B0aW9ucy5taW4gJiYgKGEgPSBNYXRoLm1heChhLCB0aGlzLl9wcmVjaXNpb25PZih0aGlzLm9wdGlvbnMubWluKSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3ByZWNpc2lvbk9mOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuaW5kZXhPZigiLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMSA9PT0gYyA/IDAgOiBhLmxlbmd0aCAtIGMgLSAxCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2FkanVzdFZhbHVlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgYyA9IG51bGwgIT09IGQubWluID8gZC5taW4gOiAwOwogICAgICAgICAgICAgICAgICAgIGEgPSBNYXRoLnJvdW5kKChhIC0KICAgICAgICAgICAgICAgICAgICAgICAgYykgLyBkLnN0ZXApICogZC5zdGVwOwogICAgICAgICAgICAgICAgICAgIGEgPSBjICsgYTsKICAgICAgICAgICAgICAgICAgICBhID0gcGFyc2VGbG9hdChhLnRvRml4ZWQodGhpcy5fcHJlY2lzaW9uKCkpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPT0gZC5tYXggJiYgYSA+IGQubWF4ID8gZC5tYXggOiBudWxsICE9PSBkLm1pbiAmJiBhIDwgZC5taW4gPyBkLm1pbiA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc3RvcDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5pbmcgJiYgKGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKSwgY2xlYXJUaW1lb3V0KHRoaXMubW91c2V3aGVlbFRpbWVyKSwgdGhpcy5jb3VudGVyID0gMCwgdGhpcy5zcGlubmluZyA9ICExLCB0aGlzLl90cmlnZ2VyKCJzdG9wIiwgYSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgIGlmICgiY3VsdHVyZSIgPT09IGEgfHwgIm51bWJlckZvcm1hdCIgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLl9wYXJzZSh0aGlzLmVsZW1lbnQudmFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbYV0gPSBjOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsKHRoaXMuX2Zvcm1hdChkKSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgIm1heCIgIT09IGEgJiYgIm1pbiIgIT09IGEgJiYgInN0ZXAiICE9PSBhIHx8ICJzdHJpbmciICE9PSB0eXBlb2YgYyB8fCAoYyA9IHRoaXMuX3BhcnNlKGMpKSwKICAgICAgICAgICAgICAgICAgICAgICAgImljb25zIiA9PT0gYSAmJiAodGhpcy5idXR0b25zLmZpcnN0KCkuZmluZCgiLnVpLWljb24iKS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaWNvbnMudXApLmFkZENsYXNzKGMudXApLCB0aGlzLmJ1dHRvbnMubGFzdCgpLmZpbmQoIi51aS1pY29uIikucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmljb25zLmRvd24pLmFkZENsYXNzKGMuZG93bikpLCB0aGlzLl9zdXBlcihhLCBjKSwgImRpc2FibGVkIiA9PT0gYSAmJiAodGhpcy53aWRnZXQoKS50b2dnbGVDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiLCAhIWMpLCB0aGlzLmVsZW1lbnQucHJvcCgiZGlzYWJsZWQiLCAhIWMpLCB0aGlzLmJ1dHRvbnMuYnV0dG9uKGMgPyAiZGlzYWJsZSIgOiAiZW5hYmxlIikpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbnM6IFMoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKGEpCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIF9wYXJzZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAiIiAhPT0gYSAmJiAoYSA9IHdpbmRvdy5HbG9iYWxpemUgJiYgdGhpcy5vcHRpb25zLm51bWJlckZvcm1hdCA/IEdsb2JhbGl6ZS5wYXJzZUZsb2F0KGEsCiAgICAgICAgICAgICAgICAgICAgICAgIDEwLCB0aGlzLm9wdGlvbnMuY3VsdHVyZSkgOiArYSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiID09PSBhIHx8IGlzTmFOKGEpID8gbnVsbCA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZm9ybWF0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiID09PSBhID8gIiIgOiB3aW5kb3cuR2xvYmFsaXplICYmIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQgPyBHbG9iYWxpemUuZm9ybWF0KGEsIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQsIHRoaXMub3B0aW9ucy5jdWx0dXJlKSA6IGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVmcmVzaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS12YWx1ZW1pbiI6IHRoaXMub3B0aW9ucy5taW4sCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLXZhbHVlbWF4IjogdGhpcy5vcHRpb25zLm1heCwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtdmFsdWVub3ciOiB0aGlzLl9wYXJzZSh0aGlzLmVsZW1lbnQudmFsKCkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1ZhbGlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMudmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PT0gYSA/ICExIDogYSA9PT0gdGhpcy5fYWRqdXN0VmFsdWUoYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdmFsdWU6IGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgICAgICAiIiAhPT0gYSAmJiAoZCA9IHRoaXMuX3BhcnNlKGEpLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBkICYmIChjIHx8IChkID0gdGhpcy5fYWRqdXN0VmFsdWUoZCkpLCBhID0gdGhpcy5fZm9ybWF0KGQpKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnZhbChhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zcGlubmVyLWlucHV0IikucHJvcCgiZGlzYWJsZWQiLCAhMSkucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoImFyaWEtdmFsdWVtaW4iKS5yZW1vdmVBdHRyKCJhcmlhLXZhbHVlbWF4IikucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW5vdyIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudWlTcGlubmVyLnJlcGxhY2VXaXRoKHRoaXMuZWxlbWVudCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdGVwVXA6IFMoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBVcChhKQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBfc3RlcFVwOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhcnQoKSAmJiAodGhpcy5fc3BpbigoYSB8fCAxKSAqIHRoaXMub3B0aW9ucy5zdGVwKSwgdGhpcy5fc3RvcCgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN0ZXBEb3duOiBTKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGVwRG93bihhKQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBfc3RlcERvd246IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFydCgpICYmICh0aGlzLl9zcGluKChhIHx8IDEpICogLXRoaXMub3B0aW9ucy5zdGVwKSwgdGhpcy5fc3RvcCgpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHBhZ2VVcDogUyhmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RlcFVwKChhIHx8IDEpICogdGhpcy5vcHRpb25zLnBhZ2UpCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHBhZ2VEb3duOiBTKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGVwRG93bigoYSB8fCAxKSAqIHRoaXMub3B0aW9ucy5wYWdlKQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX3BhcnNlKHRoaXMuZWxlbWVudC52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgUyh0aGlzLl92YWx1ZSkuY2FsbCh0aGlzLCBhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHdpZGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudWlTcGlubmVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhLndpZGdldCgidWkudGFicyIsIHsKICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjExLjQiLAogICAgICAgICAgICAgICAgZGVsYXk6IDMwMCwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2libGU6ICExLAogICAgICAgICAgICAgICAgICAgIGV2ZW50OiAiY2xpY2siLAogICAgICAgICAgICAgICAgICAgIGhlaWdodFN0eWxlOiAiY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgaGlkZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzaG93OiBudWxsLAogICAgICAgICAgICAgICAgICAgIGFjdGl2YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGJlZm9yZUFjdGl2YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGJlZm9yZUxvYWQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbG9hZDogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pc0xvY2FsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IC8jLiokLzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCwgZzsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGMuY2xvbmVOb2RlKCExKTsKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGMuaHJlZi5yZXBsYWNlKGEsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZShhLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gZGVjb2RlVVJJQ29tcG9uZW50KGQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZGVjb2RlVVJJQ29tcG9uZW50KGcpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxIDwgYy5oYXNoLmxlbmd0aCAmJiBkID09PSBnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSgpLAogICAgICAgICAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgICAgICAgICAgIHRoaXMucnVubmluZyA9ICExOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIpLnRvZ2dsZUNsYXNzKCJ1aS10YWJzLWNvbGxhcHNpYmxlIiwgYy5jb2xsYXBzaWJsZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1RhYnMoKTsKICAgICAgICAgICAgICAgICAgICBjLmFjdGl2ZSA9IHRoaXMuX2luaXRpYWxBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBhLmlzQXJyYXkoYy5kaXNhYmxlZCkgJiYgKGMuZGlzYWJsZWQgPSBhLnVuaXF1ZShjLmRpc2FibGVkLmNvbmNhdChhLm1hcCh0aGlzLnRhYnMuZmlsdGVyKCIudWktc3RhdGUtZGlzYWJsZWQiKSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi50YWJzLmluZGV4KGEpCiAgICAgICAgICAgICAgICAgICAgfSkpKS5zb3J0KCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gITEgIT09IHRoaXMub3B0aW9ucy5hY3RpdmUgJiYgdGhpcy5hbmNob3JzLmxlbmd0aCA/IHRoaXMuX2ZpbmRBY3RpdmUoYy5hY3RpdmUpIDogYSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZS5sZW5ndGggJiYgdGhpcy5sb2FkKGMuYWN0aXZlKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9pbml0aWFsQWN0aXZlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMub3B0aW9ucy5hY3RpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnMuY29sbGFwc2libGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgICAgICBudWxsID09PSBiICYmIChkICYmIHRoaXMudGFicy5lYWNoKGZ1bmN0aW9uKGMsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEoZikuYXR0cigiYXJpYS1jb250cm9scyIpID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCkgcmV0dXJuIGIgPSBjLCAhMQogICAgICAgICAgICAgICAgICAgIH0pLCBudWxsID09PSBiICYmIChiID0gdGhpcy50YWJzLmluZGV4KHRoaXMudGFicy5maWx0ZXIoIi51aS10YWJzLWFjdGl2ZSIpKSksIG51bGwgPT09IGIgfHwgLTEgPT09IGIpICYmIChiID0gdGhpcy50YWJzLmxlbmd0aCA/IDAgOiAhMSk7CiAgICAgICAgICAgICAgICAgICAgITEgIT09IGIgJiYgKGIgPSB0aGlzLnRhYnMuaW5kZXgodGhpcy50YWJzLmVxKGIpKSwgLTEgPT09IGIgJiYgKGIgPSBjID8gITEgOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgIWMgJiYgITEgPT09IGIgJiYgdGhpcy5hbmNob3JzLmxlbmd0aCAmJiAoYiA9IDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldENyZWF0ZUV2ZW50RGF0YTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFiOiB0aGlzLmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFuZWw6IHRoaXMuYWN0aXZlLmxlbmd0aCA/IHRoaXMuX2dldFBhbmVsRm9yVGFiKHRoaXMuYWN0aXZlKSA6IGEoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdGFiS2V5ZG93bjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSh0aGlzLmRvY3VtZW50WzBdLmFjdGl2ZUVsZW1lbnQpLmNsb3Nlc3QoImxpIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLnRhYnMuaW5kZXgoYyksCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSAhMDsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2hhbmRsZVBhZ2VOYXYoYikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChiLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLlJJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuRE9XTjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5VUDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQtLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVORDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5hbmNob3JzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGEudWkua2V5Q29kZS5IT01FOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBhLnVpLmtleUNvZGUuU1BBQ0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmFjdGl2YXRpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2YXRlKGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgYS51aS5rZXlDb2RlLkVOVEVSOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5hY3RpdmF0aW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmF0ZShkID09PSB0aGlzLm9wdGlvbnMuYWN0aXZlID8gITEgOiBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGIucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuYWN0aXZhdGluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9mb2N1c05leHRUYWIoZCwgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuY3RybEtleSB8fCBiLm1ldGFLZXkgfHwgKGMuYXR0cigiYXJpYS1zZWxlY3RlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFsc2UiKSwgdGhpcy50YWJzLmVxKGQpLmF0dHIoImFyaWEtc2VsZWN0ZWQiLCAidHJ1ZSIpLCB0aGlzLmFjdGl2YXRpbmcgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uKCJhY3RpdmUiLCBkKQogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmRlbGF5KSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3BhbmVsS2V5ZG93bjogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICF0aGlzLl9oYW5kbGVQYWdlTmF2KGIpICYmIGIuY3RybEtleSAmJiBiLmtleUNvZGUgPT09IGEudWkua2V5Q29kZS5VUCAmJiAoYi5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLmFjdGl2ZS5mb2N1cygpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9oYW5kbGVQYWdlTmF2OiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIuYWx0S2V5ICYmIGIua2V5Q29kZSA9PT0gYS51aS5rZXlDb2RlLlBBR0VfVVApIHJldHVybiB0aGlzLl9hY3RpdmF0ZSh0aGlzLl9mb2N1c05leHRUYWIodGhpcy5vcHRpb25zLmFjdGl2ZSAtIDEsICExKSksICEwOwogICAgICAgICAgICAgICAgICAgIGlmIChiLmFsdEtleSAmJiBiLmtleUNvZGUgPT09IGEudWkua2V5Q29kZS5QQUdFX0RPV04pIHJldHVybiB0aGlzLl9hY3RpdmF0ZSh0aGlzLl9mb2N1c05leHRUYWIodGhpcy5vcHRpb25zLmFjdGl2ZSArCiAgICAgICAgICAgICAgICAgICAgICAgIDEsICEwKSksICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2ZpbmROZXh0VGFiOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYiA+IGcgJiYgKGIgPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgMCA+IGIgJiYgKGIgPSBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IHRoaXMudGFicy5sZW5ndGggLSAxOyAtIDEgIT09IGEuaW5BcnJheShkKCksIHRoaXMub3B0aW9ucy5kaXNhYmxlZCk7KSBiID0gYyA/IGIgKyAxIDogYiAtIDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZm9jdXNOZXh0VGFiOiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IHRoaXMuX2ZpbmROZXh0VGFiKGEsIGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGFicy5lcShhKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICJhY3RpdmUiID09PSBhID8gdGhpcy5fYWN0aXZhdGUoYykgOiAiZGlzYWJsZWQiID09PSBhID8gdGhpcy5fc2V0dXBEaXNhYmxlZChjKSA6ICh0aGlzLl9zdXBlcihhLCBjKSwgImNvbGxhcHNpYmxlIiA9PT0gYSAmJiAodGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCJ1aS10YWJzLWNvbGxhcHNpYmxlIiwgYyksIGMgfHwgITEgIT09IHRoaXMub3B0aW9ucy5hY3RpdmUgfHwgdGhpcy5fYWN0aXZhdGUoMCkpLCAiZXZlbnQiID09PQogICAgICAgICAgICAgICAgICAgICAgICBhICYmIHRoaXMuX3NldHVwRXZlbnRzKGMpLCAiaGVpZ2h0U3R5bGUiID09PSBhICYmIHRoaXMuX3NldHVwSGVpZ2h0U3R5bGUoYykpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3Nhbml0aXplU2VsZWN0b3I6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA/IGEucmVwbGFjZSgvWyEiJCUmJygpKissLlwvOjs8PT4/QFxbXF1cXmB7fH1+XS9nLCAiXFwkJiIpIDogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMudGFibGlzdC5jaGlsZHJlbigiOmhhcyhhW2hyZWZdKSIpOwogICAgICAgICAgICAgICAgICAgIGIuZGlzYWJsZWQgPSBhLm1hcChjLmZpbHRlcigiLnVpLXN0YXRlLWRpc2FibGVkIiksIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuaW5kZXgoYSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzVGFicygpOwogICAgICAgICAgICAgICAgICAgICExICE9PSBiLmFjdGl2ZSAmJiB0aGlzLmFuY2hvcnMubGVuZ3RoID8gdGhpcy5hY3RpdmUubGVuZ3RoICYmICFhLmNvbnRhaW5zKHRoaXMudGFibGlzdFswXSwgdGhpcy5hY3RpdmVbMF0pID8gdGhpcy50YWJzLmxlbmd0aCA9PT0gYi5kaXNhYmxlZC5sZW5ndGggPyAoYi5hY3RpdmUgPSAhMSwgdGhpcy5hY3RpdmUgPQogICAgICAgICAgICAgICAgICAgICAgICBhKCkpIDogdGhpcy5fYWN0aXZhdGUodGhpcy5fZmluZE5leHRUYWIoTWF0aC5tYXgoMCwgYi5hY3RpdmUgLSAxKSwgITEpKSA6IGIuYWN0aXZlID0gdGhpcy50YWJzLmluZGV4KHRoaXMuYWN0aXZlKSA6IChiLmFjdGl2ZSA9ICExLCB0aGlzLmFjdGl2ZSA9IGEoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3JlZnJlc2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwRGlzYWJsZWQodGhpcy5vcHRpb25zLmRpc2FibGVkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cEV2ZW50cyh0aGlzLm9wdGlvbnMuZXZlbnQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwSGVpZ2h0U3R5bGUodGhpcy5vcHRpb25zLmhlaWdodFN0eWxlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRhYnMubm90KHRoaXMuYWN0aXZlKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtc2VsZWN0ZWQiOiAiZmFsc2UiLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiAtMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxzLm5vdCh0aGlzLl9nZXRQYW5lbEZvclRhYih0aGlzLmFjdGl2ZSkpLmhpZGUoKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUubGVuZ3RoID8KICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuYWN0aXZlLmFkZENsYXNzKCJ1aS10YWJzLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLXNlbGVjdGVkIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleDogMAogICAgICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5fZ2V0UGFuZWxGb3JUYWIodGhpcy5hY3RpdmUpLnNob3coKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICJmYWxzZSIKICAgICAgICAgICAgICAgICAgICAgICAgfSkpIDogdGhpcy50YWJzLmVxKDApLmF0dHIoInRhYkluZGV4IiwgMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcHJvY2Vzc1RhYnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMudGFicywKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuYW5jaG9ycywKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMucGFuZWxzOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGFibGlzdCA9IHRoaXMuX2dldExpc3QoKS5hZGRDbGFzcygidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiKS5hdHRyKCJyb2xlIiwgInRhYmxpc3QiKS5kZWxlZ2F0ZSgiPiBsaSIsICJtb3VzZWRvd24iICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICBhKHRoaXMpLmlzKCIudWktc3RhdGUtZGlzYWJsZWQiKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICAgICAgfSkuZGVsZWdhdGUoIi51aS10YWJzLWFuY2hvciIsICJmb2N1cyIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5jbG9zZXN0KCJsaSIpLmlzKCIudWktc3RhdGUtZGlzYWJsZWQiKSAmJiB0aGlzLmJsdXIoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGFicyA9IHRoaXMudGFibGlzdC5maW5kKCI+IGxpOmhhcyhhW2hyZWZdKSIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3AiKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogInRhYiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiAtMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9ycyA9IHRoaXMudGFicy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKCJhIiwgdGhpcylbMF0KICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygidWktdGFicy1hbmNob3IiKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiAtMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxzID0gYSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcsIGssIGwgPSBhKGQpLnVuaXF1ZUlkKCkuYXR0cigiaWQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBhKGQpLmNsb3Nlc3QoImxpIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gZS5hdHRyKCJhcmlhLWNvbnRyb2xzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuX2lzTG9jYWwoZCkgPyAoZyA9IGQuaGFzaCwgayA9IGcuc3Vic3RyaW5nKDEpLCBnID0gYi5lbGVtZW50LmZpbmQoYi5fc2FuaXRpemVTZWxlY3RvcihnKSkpIDogKGsgPSBlLmF0dHIoImFyaWEtY29udHJvbHMiKSB8fCBhKHt9KS51bmlxdWVJZCgpWzBdLmlkLCBnID0gYi5lbGVtZW50LmZpbmQoIiMiICsgayksIGcubGVuZ3RoIHx8IChnID0gYi5fY3JlYXRlUGFuZWwoayksIGcuaW5zZXJ0QWZ0ZXIoYi5wYW5lbHNbYyAtIDFdIHx8IGIudGFibGlzdCkpLCBnLmF0dHIoImFyaWEtbGl2ZSIsICJwb2xpdGUiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGcubGVuZ3RoICYmIChiLnBhbmVscyA9IGIucGFuZWxzLmFkZChnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG4gJiYgZS5kYXRhKCJ1aS10YWJzLWFyaWEtY29udHJvbHMiLCBuKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWNvbnRyb2xzIjogaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWxhYmVsbGVkYnkiOiBsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBnLmF0dHIoImFyaWEtbGFiZWxsZWRieSIsIGwpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbHMuYWRkQ2xhc3MoInVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSIpLmF0dHIoInJvbGUiLAogICAgICAgICAgICAgICAgICAgICAgICAidGFicGFuZWwiKTsKICAgICAgICAgICAgICAgICAgICBjICYmICh0aGlzLl9vZmYoYy5ub3QodGhpcy50YWJzKSksIHRoaXMuX29mZihkLm5vdCh0aGlzLmFuY2hvcnMpKSwgdGhpcy5fb2ZmKGcubm90KHRoaXMucGFuZWxzKSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldExpc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRhYmxpc3QgfHwgdGhpcy5lbGVtZW50LmZpbmQoIm9sLHVsIikuZXEoMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfY3JlYXRlUGFuZWw6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSgiPGRpdj4iKS5hdHRyKCJpZCIsIGIpLmFkZENsYXNzKCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iKS5kYXRhKCJ1aS10YWJzLWRlc3Ryb3kiLCAhMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0dXBEaXNhYmxlZDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIGEuaXNBcnJheShiKSAmJiAoYi5sZW5ndGggPyBiLmxlbmd0aCA9PT0gdGhpcy5hbmNob3JzLmxlbmd0aCAmJiAoYiA9ICEwKSA6IGIgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQ7IGQgPSB0aGlzLnRhYnNbY107IGMrKykgITAgPT09IGIgfHwgLTEgIT09IGEuaW5BcnJheShjLCBiKSA/IGEoZCkuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIikuYXR0cigiYXJpYS1kaXNhYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0cnVlIikgOiBhKGQpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpLnJlbW92ZUF0dHIoImFyaWEtZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSBiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldHVwRXZlbnRzOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBiICYmIGEuZWFjaChiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY1tiXSA9ICJfZXZlbnRIYW5kbGVyIgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29mZih0aGlzLmFuY2hvcnMuYWRkKHRoaXMudGFicykuYWRkKHRoaXMucGFuZWxzKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24oITAsIHRoaXMuYW5jaG9ycywgewogICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbih0aGlzLmFuY2hvcnMsIGMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKHRoaXMudGFicywgewogICAgICAgICAgICAgICAgICAgICAgICBrZXlkb3duOiAiX3RhYktleWRvd24iCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24odGhpcy5wYW5lbHMsIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ZG93bjogIl9wYW5lbEtleWRvd24iCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNhYmxlKHRoaXMudGFicyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faG92ZXJhYmxlKHRoaXMudGFicykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfc2V0dXBIZWlnaHRTdHlsZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5lbGVtZW50LnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgICJmaWxsIiA9PT0gYiA/IChjID0gZC5oZWlnaHQoKSwgYyAtPSB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSAtIHRoaXMuZWxlbWVudC5oZWlnaHQoKSwgdGhpcy5lbGVtZW50LnNpYmxpbmdzKCI6dmlzaWJsZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiLmNzcygicG9zaXRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgImFic29sdXRlIiAhPT0gZCAmJiAiZml4ZWQiICE9PSBkICYmIChjIC09IGIub3V0ZXJIZWlnaHQoITApKQogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oKS5ub3QodGhpcy5wYW5lbHMpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgLT0gYSh0aGlzKS5vdXRlckhlaWdodCghMCkKICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5wYW5lbHMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5oZWlnaHQoTWF0aC5tYXgoMCwgYyAtIGEodGhpcykuaW5uZXJIZWlnaHQoKSArIGEodGhpcykuaGVpZ2h0KCkpKQogICAgICAgICAgICAgICAgICAgIH0pLmNzcygib3ZlcmZsb3ciLCAiYXV0byIpKSA6ICJhdXRvIiA9PT0gYiAmJiAoYyA9IDAsIHRoaXMucGFuZWxzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBNYXRoLm1heChjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSh0aGlzKS5oZWlnaHQoIiIpLmhlaWdodCgpKQogICAgICAgICAgICAgICAgICAgIH0pLmhlaWdodChjKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZXZlbnRIYW5kbGVyOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB0aGlzLmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEoYi5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KCJsaSIpLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gZ1swXSA9PT0gZFswXSwKICAgICAgICAgICAgICAgICAgICAgICAgayA9IGYgJiYgYy5jb2xsYXBzaWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGsgPyBhKCkgOiB0aGlzLl9nZXRQYW5lbEZvclRhYihnKSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGQubGVuZ3RoID8gdGhpcy5fZ2V0UGFuZWxGb3JUYWIoZCkgOiBhKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRUYWI6IGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQYW5lbDogcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RhYjogayA/IGEoKSA6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQYW5lbDogaAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGIucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBnLmhhc0NsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpIHx8IGcuaGFzQ2xhc3MoInVpLXRhYnMtbG9hZGluZyIpIHx8IHRoaXMucnVubmluZyB8fCBmICYmICFjLmNvbGxhcHNpYmxlIHx8ICExID09PSB0aGlzLl90cmlnZ2VyKCJiZWZvcmVBY3RpdmF0ZSIsIGIsIGQpIHx8IChjLmFjdGl2ZSA9IGsgPyAhMSA6IHRoaXMudGFicy5pbmRleChnKSwgdGhpcy5hY3RpdmUgPSBmID8gYSgpIDoKICAgICAgICAgICAgICAgICAgICAgICAgZywgdGhpcy54aHIgJiYgdGhpcy54aHIuYWJvcnQoKSwgcC5sZW5ndGggfHwgaC5sZW5ndGggfHwgYS5lcnJvcigialF1ZXJ5IFVJIFRhYnM6IE1pc21hdGNoaW5nIGZyYWdtZW50IGlkZW50aWZpZXIuIiksIGgubGVuZ3RoICYmIHRoaXMubG9hZCh0aGlzLnRhYnMuaW5kZXgoZyksIGIpLCB0aGlzLl90b2dnbGUoYiwgZCkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3RvZ2dsZTogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYucnVubmluZyA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICBmLl90cmlnZ2VyKCJhY3RpdmF0ZSIsIGIsIGMpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBnKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjLm5ld1RhYi5jbG9zZXN0KCJsaSIpLmFkZENsYXNzKCJ1aS10YWJzLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgay5sZW5ndGggJiYgZi5vcHRpb25zLnNob3cgPyBmLl9zaG93KGssIGYub3B0aW9ucy5zaG93LCBkKSA6IChrLnNob3coKSwgZCgpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBjLm5ld1BhbmVsLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gYy5vbGRQYW5lbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSAhMDsKICAgICAgICAgICAgICAgICAgICBoLmxlbmd0aCAmJiB0aGlzLm9wdGlvbnMuaGlkZSA/IHRoaXMuX2hpZGUoaCwgdGhpcy5vcHRpb25zLmhpZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5vbGRUYWIuY2xvc2VzdCgibGkiKS5yZW1vdmVDbGFzcygidWktdGFicy1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAoYy5vbGRUYWIuY2xvc2VzdCgibGkiKS5yZW1vdmVDbGFzcygidWktdGFicy1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIiksIGguaGlkZSgpLCBnKCkpOwogICAgICAgICAgICAgICAgICAgIGguYXR0cigiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgIGMub2xkVGFiLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGsubGVuZ3RoICYmIGgubGVuZ3RoID8gYy5vbGRUYWIuYXR0cigidGFiSW5kZXgiLCAtMSkgOiBrLmxlbmd0aCAmJiB0aGlzLnRhYnMuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gYSh0aGlzKS5hdHRyKCJ0YWJJbmRleCIpCiAgICAgICAgICAgICAgICAgICAgfSkuYXR0cigidGFiSW5kZXgiLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgay5hdHRyKCJhcmlhLWhpZGRlbiIsICJmYWxzZSIpOwogICAgICAgICAgICAgICAgICAgIGMubmV3VGFiLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICAiYXJpYS1zZWxlY3RlZCI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiAwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWN0aXZhdGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gdGhpcy5fZmluZEFjdGl2ZShiKTsKICAgICAgICAgICAgICAgICAgICBiWzBdICE9PSB0aGlzLmFjdGl2ZVswXSAmJiAoYi5sZW5ndGggfHwgKGIgPSB0aGlzLmFjdGl2ZSksIGIgPSBiLmZpbmQoIi51aS10YWJzLWFuY2hvciIpWzBdLCB0aGlzLl9ldmVudEhhbmRsZXIoewogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUYXJnZXQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBhLm5vb3AKICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZmluZEFjdGl2ZTogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMSA9PT0gYiA/IGEoKSA6IHRoaXMudGFicy5lcShiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9nZXRJbmRleDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAoYSA9IHRoaXMuYW5jaG9ycy5pbmRleCh0aGlzLmFuY2hvcnMuZmlsdGVyKCJbaHJlZiQ9JyIgKyBhICsgIiddIikpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9kZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnhociAmJiB0aGlzLnhoci5hYm9ydCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50YWJsaXN0LnJlbW92ZUNsYXNzKCJ1aS10YWJzLW5hdiB1aS1oZWxwZXItcmVzZXQgdWktaGVscGVyLWNsZWFyZml4IHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCIpLnJlbW92ZUF0dHIoInJvbGUiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFuY2hvcnMucmVtb3ZlQ2xhc3MoInVpLXRhYnMtYW5jaG9yIikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoInRhYkluZGV4IikucmVtb3ZlVW5pcXVlSWQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRhYmxpc3QudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGFicy5hZGQodGhpcy5wYW5lbHMpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0YSh0aGlzLCAidWktdGFicy1kZXN0cm95IikgPyBhKHRoaXMpLnJlbW92ZSgpIDogYSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtZGlzYWJsZWQgdWktY29ybmVyLXRvcCB1aS1jb3JuZXItYm90dG9tIHVpLXdpZGdldC1jb250ZW50IHVpLXRhYnMtYWN0aXZlIHVpLXRhYnMtcGFuZWwiKS5yZW1vdmVBdHRyKCJ0YWJJbmRleCIpLnJlbW92ZUF0dHIoImFyaWEtbGl2ZSIpLnJlbW92ZUF0dHIoImFyaWEtYnVzeSIpLnJlbW92ZUF0dHIoImFyaWEtc2VsZWN0ZWQiKS5yZW1vdmVBdHRyKCJhcmlhLWxhYmVsbGVkYnkiKS5yZW1vdmVBdHRyKCJhcmlhLWhpZGRlbiIpLnJlbW92ZUF0dHIoImFyaWEtZXhwYW5kZWQiKS5yZW1vdmVBdHRyKCJyb2xlIikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRhYnMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGIuZGF0YSgidWktdGFicy1hcmlhLWNvbnRyb2xzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPyBiLmF0dHIoImFyaWEtY29udHJvbHMiLCBjKS5yZW1vdmVEYXRhKCJ1aS10YWJzLWFyaWEtY29udHJvbHMiKSA6IGIucmVtb3ZlQXR0cigiYXJpYS1jb250cm9scyIpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbHMuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICJjb250ZW50IiAhPT0gdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICYmIHRoaXMucGFuZWxzLmNzcygiaGVpZ2h0IiwgIiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5hYmxlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLm9wdGlvbnMuZGlzYWJsZWQ7CiAgICAgICAgICAgICAgICAgICAgITEgIT09IGMgJiYgKHZvaWQgMCA9PT0gYiA/IGMgPSAhMSA6IChiID0gdGhpcy5fZ2V0SW5kZXgoYiksIGMgPSBhLmlzQXJyYXkoYykgPyBhLm1hcChjLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhICE9PSBiID8gYSA6IG51bGwKICAgICAgICAgICAgICAgICAgICB9KSA6IGEubWFwKHRoaXMudGFicywgZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyAhPT0gYiA/IGMgOiBudWxsCiAgICAgICAgICAgICAgICAgICAgfSkpLCB0aGlzLl9zZXR1cERpc2FibGVkKGMpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZDsKICAgICAgICAgICAgICAgICAgICBpZiAoITAgIT09IGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYikgYyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9nZXRJbmRleChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtMSAhPT0gYS5pbkFycmF5KGIsIGMpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYS5pc0FycmF5KGMpID8gYS5tZXJnZShbYl0sIGMpLnNvcnQoKSA6IFtiXQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwRGlzYWJsZWQoYykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9hZDogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9nZXRJbmRleChiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnRhYnMuZXEoYiksCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBnLmZpbmQoIi51aS10YWJzLWFuY2hvciIpLAogICAgICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy5fZ2V0UGFuZWxGb3JUYWIoZyksCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWI6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYW5lbDogawogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBwID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFib3J0IiA9PT0gYiAmJiBkLnBhbmVscy5zdG9wKCExLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnJlbW92ZUNsYXNzKCJ1aS10YWJzLWxvYWRpbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsucmVtb3ZlQXR0cigiYXJpYS1idXN5Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID09PSBkLnhociAmJiBkZWxldGUgZC54aHIKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0xvY2FsKGZbMF0pIHx8ICh0aGlzLnhociA9IGEuYWpheCh0aGlzLl9hamF4U2V0dGluZ3MoZiwKICAgICAgICAgICAgICAgICAgICAgICAgYywgaCkpKSAmJiAiY2FuY2VsZWQiICE9PSB0aGlzLnhoci5zdGF0dXNUZXh0ICYmIChnLmFkZENsYXNzKCJ1aS10YWJzLWxvYWRpbmciKSwgay5hdHRyKCJhcmlhLWJ1c3kiLCAidHJ1ZSIpLCB0aGlzLnhoci5kb25lKGZ1bmN0aW9uKGEsIGIsIGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsuaHRtbChhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuX3RyaWdnZXIoImxvYWQiLCBjLCBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAoZiwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMSkKICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAoYSwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMSkKICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWpheFNldHRpbmdzOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYi5hdHRyKCJocmVmIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKGIsIGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnLl90cmlnZ2VyKCJiZWZvcmVMb2FkIiwgYywgYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpxWEhSOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXhTZXR0aW5nczogawogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2dldFBhbmVsRm9yVGFiOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGEoYikuYXR0cigiYXJpYS1jb250cm9scyIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuZmluZCh0aGlzLl9zYW5pdGl6ZVNlbGVjdG9yKCIjIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYS53aWRnZXQoInVpLnRvb2x0aXAiLCB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4xMS40IiwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpLmF0dHIoInRpdGxlIikgfHwgIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKCI8YT4iKS50ZXh0KGIpLmh0bWwoKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGlkZTogITAsCiAgICAgICAgICAgICAgICAgICAgaXRlbXM6ICJbdGl0bGVdOm5vdChbZGlzYWJsZWRdKSIsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgbXk6ICJsZWZ0IHRvcCsxNSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGF0OiAibGVmdCBib3R0b20iLAogICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246ICJmbGlwZml0IGZsaXAiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzaG93OiAhMCwKICAgICAgICAgICAgICAgICAgICB0b29sdGlwQ2xhc3M6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgdHJhY2s6ICExLAogICAgICAgICAgICAgICAgICAgIGNsb3NlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG9wZW46IG51bGwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYWRkRGVzY3JpYmVkQnk6IGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IChiLmF0dHIoImFyaWEtZGVzY3JpYmVkYnkiKSB8fCAiIikuc3BsaXQoL1xzKy8pOwogICAgICAgICAgICAgICAgICAgIGQucHVzaChjKTsKICAgICAgICAgICAgICAgICAgICBiLmRhdGEoInVpLXRvb2x0aXAtaWQiLCBjKS5hdHRyKCJhcmlhLWRlc2NyaWJlZGJ5IiwgYS50cmltKGQuam9pbigiICIpKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVtb3ZlRGVzY3JpYmVkQnk6IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICAgICAgICAgIGIuZGF0YSgidWktdG9vbHRpcC1pZCIpLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gKGIuYXR0cigiYXJpYS1kZXNjcmliZWRieSIpIHx8ICIiKS5zcGxpdCgvXHMrLyksCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhLmluQXJyYXkoYywgZCk7IC0gMSAhPT0gYyAmJiBkLnNwbGljZShjLCAxKTsKICAgICAgICAgICAgICAgICAgICBiLnJlbW92ZURhdGEoInVpLXRvb2x0aXAtaWQiKTsKICAgICAgICAgICAgICAgICAgICAoZCA9IGEudHJpbShkLmpvaW4oIiAiKSkpID8gYi5hdHRyKCJhcmlhLWRlc2NyaWJlZGJ5IiwgZCk6IGIucmVtb3ZlQXR0cigiYXJpYS1kZXNjcmliZWRieSIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb24oewogICAgICAgICAgICAgICAgICAgICAgICBtb3VzZW92ZXI6ICJvcGVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNpbjogIm9wZW4iCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50b29sdGlwcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50cyA9IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiB0aGlzLl9kaXNhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXZlUmVnaW9uID0gYSgiPGRpdj4iKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogImxvZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcmlhLWxpdmUiOiAiYXNzZXJ0aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFyaWEtcmVsZXZhbnQiOiAiYWRkaXRpb25zIgogICAgICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGUiKS5hcHBlbmRUbyh0aGlzLmRvY3VtZW50WzBdLmJvZHkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAiZGlzYWJsZWQiID09PSBiID8gKHRoaXNbYyA/ICJfZGlzYWJsZSIgOiAiX2VuYWJsZSJdKCksIHRoaXMub3B0aW9uc1tiXSA9IGMpIDogKHRoaXMuX3N1cGVyKGIsIGMpLCAiY29udGVudCIgPT09IGIgJiYgYS5lYWNoKHRoaXMudG9vbHRpcHMsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5fdXBkYXRlQ29udGVudChiLmVsZW1lbnQpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rpc2FibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBhLmVhY2godGhpcy50b29sdGlwcywgZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuRXZlbnQoImJsdXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZy50YXJnZXQgPSBnLmN1cnJlbnRUYXJnZXQgPSBkLmVsZW1lbnRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoZywgITApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmlzKCJbdGl0bGVdIikgJiYgYi5kYXRhKCJ1aS10b29sdGlwLXRpdGxlIiwgYi5hdHRyKCJ0aXRsZSIpKS5yZW1vdmVBdHRyKCJ0aXRsZSIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpICYmIGIuYXR0cigidGl0bGUiLCBiLmRhdGEoInVpLXRvb2x0aXAtdGl0bGUiKSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBhKGIgPyBiLnRhcmdldCA6IHRoaXMuZWxlbWVudCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuaXRlbXMpOwogICAgICAgICAgICAgICAgICAgIGQubGVuZ3RoICYmICFkLmRhdGEoInVpLXRvb2x0aXAtaWQiKSAmJiAoZC5hdHRyKCJ0aXRsZSIpICYmIGQuZGF0YSgidWktdG9vbHRpcC10aXRsZSIsIGQuYXR0cigidGl0bGUiKSksIGQuZGF0YSgidWktdG9vbHRpcC1vcGVuIiwgITApLCBiICYmICJtb3VzZW92ZXIiID09PSBiLnR5cGUgJiYgZC5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZDsKICAgICAgICAgICAgICAgICAgICAgICAgYi5kYXRhKCJ1aS10b29sdGlwLW9wZW4iKSAmJiAoZCA9IGEuRXZlbnQoImJsdXIiKSwgZC50YXJnZXQgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5jdXJyZW50VGFyZ2V0ID0gdGhpcywgYy5jbG9zZShkLCAhMCkpOwogICAgICAgICAgICAgICAgICAgICAgICBiLmF0dHIoInRpdGxlIikgJiYgKGIudW5pcXVlSWQoKSwgYy5wYXJlbnRzW3RoaXMuaWRdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBiLmF0dHIoInRpdGxlIikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgYi5hdHRyKCJ0aXRsZSIsICIiKSkKICAgICAgICAgICAgICAgICAgICB9KSwgdGhpcy5fcmVnaXN0ZXJDbG9zZUhhbmRsZXJzKGIsIGQpLCB0aGlzLl91cGRhdGVDb250ZW50KGQsIGIpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF91cGRhdGVDb250ZW50OiBmdW5jdGlvbihhLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMub3B0aW9ucy5jb250ZW50OwogICAgICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGMgPyBjLnR5cGUgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGQpIHJldHVybiB0aGlzLl9vcGVuKGMsIGEsIGQpOwogICAgICAgICAgICAgICAgICAgIChkID0gZC5jYWxsKGFbMF0sIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZy5fZGVsYXkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRhdGEoInVpLXRvb2x0aXAtb3BlbiIpICYmIChjICYmIChjLnR5cGUgPSBmKSwgdGhpcy5fb3BlbihjLCBhLCBkKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KSkgJiYgdGhpcy5fb3BlbihjLCBhLCBkKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9vcGVuOiBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZyhhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAub2YgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYTsKICAgICAgICAgICAgICAgICAgICAgICAgay5pcygiOmhpZGRlbiIpIHx8IGsucG9zaXRpb24ocCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGYsIGssIGgsIHAgPSBhLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBkICYmICgoZiA9IHRoaXMuX2ZpbmQoYykpID8gZi50b29sdGlwLmZpbmQoIi51aS10b29sdGlwLWNvbnRlbnQiKS5odG1sKGQpIDogKGMuaXMoIlt0aXRsZV0iKSAmJiAoYiAmJiAibW91c2VvdmVyIiA9PT0gYi50eXBlID8gYy5hdHRyKCJ0aXRsZSIsICIiKSA6IGMucmVtb3ZlQXR0cigidGl0bGUiKSksIGYgPSB0aGlzLl90b29sdGlwKGMpLCBrID0gZi50b29sdGlwLCB0aGlzLl9hZGREZXNjcmliZWRCeShjLCBrLmF0dHIoImlkIikpLCBrLmZpbmQoIi51aS10b29sdGlwLWNvbnRlbnQiKS5odG1sKGQpLCB0aGlzLmxpdmVSZWdpb24uY2hpbGRyZW4oKS5oaWRlKCksIGQuY2xvbmUgJiYgKGQgPSBkLmNsb25lKCksIGQucmVtb3ZlQXR0cigiaWQiKS5maW5kKCJbaWRdIikucmVtb3ZlQXR0cigiaWQiKSksIGEoIjxkaXY+IikuaHRtbChkKS5hcHBlbmRUbyh0aGlzLmxpdmVSZWdpb24pLCB0aGlzLm9wdGlvbnMudHJhY2sgJiYKICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiAvXm1vdXNlLy50ZXN0KGIudHlwZSkgPyAodGhpcy5fb24odGhpcy5kb2N1bWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW91c2Vtb3ZlOiBnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBnKGIpKSA6IGsucG9zaXRpb24oYS5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IGMKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uKSksIGsuaGlkZSgpLCB0aGlzLl9zaG93KGssIHRoaXMub3B0aW9ucy5zaG93KSwgdGhpcy5vcHRpb25zLnNob3cgJiYgdGhpcy5vcHRpb25zLnNob3cuZGVsYXkgJiYgKGggPSB0aGlzLmRlbGF5ZWRTaG93ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrLmlzKCI6dmlzaWJsZSIpICYmIChnKHAub2YpLCBjbGVhckludGVydmFsKGgpKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBhLmZ4LmludGVydmFsKSksIHRoaXMuX3RyaWdnZXIoIm9wZW4iLCBiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBrCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfcmVnaXN0ZXJDbG9zZUhhbmRsZXJzOiBmdW5jdGlvbihiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleXVwOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmtleUNvZGUgPT09IGEudWkua2V5Q29kZS5FU0NBUEUgJiYgKGIgPSBhLkV2ZW50KGIpLCBiLmN1cnJlbnRUYXJnZXQgPSBjWzBdLCB0aGlzLmNsb3NlKGIsICEwKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY1swXSAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50WzBdICYmIChkLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlVG9vbHRpcCh0aGlzLl9maW5kKGMpLnRvb2x0aXApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGIgJiYgIm1vdXNlb3ZlciIgIT09IGIudHlwZSB8fCAoZC5tb3VzZWxlYXZlID0gImNsb3NlIik7CiAgICAgICAgICAgICAgICAgICAgYiAmJiAiZm9jdXNpbiIgIT09IGIudHlwZSB8fCAoZC5mb2N1c291dCA9ICJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uKCEwLCBjLCBkKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICBnID0gYShiID8gYi5jdXJyZW50VGFyZ2V0IDogdGhpcy5lbGVtZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuX2ZpbmQoZyk7CiAgICAgICAgICAgICAgICAgICAgZiA/IChjID0gZi50b29sdGlwLCBmLmNsb3NpbmcgfHwgKGNsZWFySW50ZXJ2YWwodGhpcy5kZWxheWVkU2hvdyksIGcuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpICYmICFnLmF0dHIoInRpdGxlIikgJiYgZy5hdHRyKCJ0aXRsZSIsIGcuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpKSwgdGhpcy5fcmVtb3ZlRGVzY3JpYmVkQnkoZyksIGYuaGlkaW5nID0gITAsIGMuc3RvcCghMCksIHRoaXMuX2hpZGUoYywgdGhpcy5vcHRpb25zLmhpZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5fcmVtb3ZlVG9vbHRpcChhKHRoaXMpKQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgZy5yZW1vdmVEYXRhKCJ1aS10b29sdGlwLW9wZW4iKSwgdGhpcy5fb2ZmKGcsICJtb3VzZWxlYXZlIGZvY3Vzb3V0IGtleXVwIiksIGdbMF0gIT09IHRoaXMuZWxlbWVudFswXSAmJiB0aGlzLl9vZmYoZywgInJlbW92ZSIpLCB0aGlzLl9vZmYodGhpcy5kb2N1bWVudCwgIm1vdXNlbW92ZSIpLCBiICYmICJtb3VzZWxlYXZlIiA9PT0gYi50eXBlICYmIGEuZWFjaCh0aGlzLnBhcmVudHMsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYShjLmVsZW1lbnQpLmF0dHIoInRpdGxlIiwgYy50aXRsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkLnBhcmVudHNbYl0KICAgICAgICAgICAgICAgICAgICB9KSwgZi5jbG9zaW5nID0gITAsIHRoaXMuX3RyaWdnZXIoImNsb3NlIiwgYiwgewogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBjCiAgICAgICAgICAgICAgICAgICAgfSksIGYuaGlkaW5nIHx8IChmLmNsb3NpbmcgPSAhMSkpKSA6IGcucmVtb3ZlRGF0YSgidWktdG9vbHRpcC1vcGVuIikKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfdG9vbHRpcDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYSgiPGRpdj4iKS5hdHRyKCJyb2xlIiwgInRvb2x0aXAiKS5hZGRDbGFzcygidWktdG9vbHRpcCB1aS13aWRnZXQgdWktY29ybmVyLWFsbCB1aS13aWRnZXQtY29udGVudCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLm9wdGlvbnMudG9vbHRpcENsYXNzIHx8ICIiKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjLnVuaXF1ZUlkKCkuYXR0cigiaWQiKTsKICAgICAgICAgICAgICAgICAgICBhKCI8ZGl2PiIpLmFkZENsYXNzKCJ1aS10b29sdGlwLWNvbnRlbnQiKS5hcHBlbmRUbyhjKTsKICAgICAgICAgICAgICAgICAgICBjLmFwcGVuZFRvKHRoaXMuZG9jdW1lbnRbMF0uYm9keSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9vbHRpcHNbZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IGMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2ZpbmQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGEgPSBhLmRhdGEoInVpLXRvb2x0aXAtaWQiKSkgPyB0aGlzLnRvb2x0aXBzW2FdIDogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF9yZW1vdmVUb29sdGlwOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgYS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy50b29sdGlwc1thLmF0dHIoImlkIildCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBhLmVhY2godGhpcy50b29sdGlwcywgZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuRXZlbnQoImJsdXIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBkLmVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGcudGFyZ2V0ID0gZy5jdXJyZW50VGFyZ2V0ID0gZlswXTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5jbG9zZShnLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoIiMiICsgYykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGYuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpICYmIChmLmF0dHIoInRpdGxlIikgfHwgZi5hdHRyKCJ0aXRsZSIsIGYuZGF0YSgidWktdG9vbHRpcC10aXRsZSIpKSwgZi5yZW1vdmVEYXRhKCJ1aS10b29sdGlwLXRpdGxlIikpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXZlUmVnaW9uLnJlbW92ZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICA8L3NjcmlwdD4KCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CgkJYm9keSB7CgkJcGFkZGluZy10b3A6IDUwcHg7CgkJcGFkZGluZy1ib3R0b206IDIwcHg7CgkJfQoKCQkudGFibGUgLnByb2dyZXNzIHsKCQltYXJnaW4tYm90dG9tOiAwcHg7CgkJfQoJCS8qISBqUXVlcnkgVUkgLSB2MS4xMS40IC0gMjAxNS0wMy0xMQoJCSogaHR0cDovL2pxdWVyeXVpLmNvbQoJCSogSW5jbHVkZXM6IGNvcmUuY3NzLCBhY2NvcmRpb24uY3NzLCBhdXRvY29tcGxldGUuY3NzLCBidXR0b24uY3NzLCBkYXRlcGlja2VyLmNzcywgZGlhbG9nLmNzcywgZHJhZ2dhYmxlLmNzcywgbWVudS5jc3MsIHByb2dyZXNzYmFyLmNzcywgcmVzaXphYmxlLmNzcywgc2VsZWN0YWJsZS5jc3MsIHNlbGVjdG1lbnUuY3NzLCBzbGlkZXIuY3NzLCBzb3J0YWJsZS5jc3MsIHNwaW5uZXIuY3NzLCB0YWJzLmNzcywgdG9vbHRpcC5jc3MsIHRoZW1lLmNzcwoJCSogVG8gdmlldyBhbmQgbW9kaWZ5IHRoaXMgdGhlbWUsIHZpc2l0IGh0dHA6Ly9qcXVlcnl1aS5jb20vdGhlbWVyb2xsZXIvP2ZmRGVmYXVsdD1WZXJkYW5hJTJDQXJpYWwlMkNzYW5zLXNlcmlmJmZ3RGVmYXVsdD1ub3JtYWwmZnNEZWZhdWx0PTEuMWVtJmNvcm5lclJhZGl1cz00cHgmYmdDb2xvckhlYWRlcj1jY2NjY2MmYmdUZXh0dXJlSGVhZGVyPWhpZ2hsaWdodF9zb2Z0JmJnSW1nT3BhY2l0eUhlYWRlcj03NSZib3JkZXJDb2xvckhlYWRlcj1hYWFhYWEmZmNIZWFkZXI9MjIyMjIyJmljb25Db2xvckhlYWRlcj0yMjIyMjImYmdDb2xvckNvbnRlbnQ9ZmZmZmZmJmJnVGV4dHVyZUNvbnRlbnQ9ZmxhdCZiZ0ltZ09wYWNpdHlDb250ZW50PTc1JmJvcmRlckNvbG9yQ29udGVudD1hYWFhYWEmZmNDb250ZW50PTIyMjIyMiZpY29uQ29sb3JDb250ZW50PTIyMjIyMiZiZ0NvbG9yRGVmYXVsdD1lNmU2ZTYmYmdUZXh0dXJlRGVmYXVsdD1nbGFzcyZiZ0ltZ09wYWNpdHlEZWZhdWx0PTc1JmJvcmRlckNvbG9yRGVmYXVsdD1kM2QzZDMmZmNEZWZhdWx0PTU1NTU1NSZpY29uQ29sb3JEZWZhdWx0PTg4ODg4OCZiZ0NvbG9ySG92ZXI9ZGFkYWRhJmJnVGV4dHVyZUhvdmVyPWdsYXNzJmJnSW1nT3BhY2l0eUhvdmVyPTc1JmJvcmRlckNvbG9ySG92ZXI9OTk5OTk5JmZjSG92ZXI9MjEyMTIxJmljb25Db2xvckhvdmVyPTQ1NDU0NSZiZ0NvbG9yQWN0aXZlPWZmZmZmZiZiZ1RleHR1cmVBY3RpdmU9Z2xhc3MmYmdJbWdPcGFjaXR5QWN0aXZlPTY1JmJvcmRlckNvbG9yQWN0aXZlPWFhYWFhYSZmY0FjdGl2ZT0yMTIxMjEmaWNvbkNvbG9yQWN0aXZlPTQ1NDU0NSZiZ0NvbG9ySGlnaGxpZ2h0PWZiZjllZSZiZ1RleHR1cmVIaWdobGlnaHQ9Z2xhc3MmYmdJbWdPcGFjaXR5SGlnaGxpZ2h0PTU1JmJvcmRlckNvbG9ySGlnaGxpZ2h0PWZjZWZhMSZmY0hpZ2hsaWdodD0zNjM2MzYmaWNvbkNvbG9ySGlnaGxpZ2h0PTJlODNmZiZiZ0NvbG9yRXJyb3I9ZmVmMWVjJmJnVGV4dHVyZUVycm9yPWdsYXNzJmJnSW1nT3BhY2l0eUVycm9yPTk1JmJvcmRlckNvbG9yRXJyb3I9Y2QwYTBhJmZjRXJyb3I9Y2QwYTBhJmljb25Db2xvckVycm9yPWNkMGEwYSZiZ0NvbG9yT3ZlcmxheT1hYWFhYWEmYmdUZXh0dXJlT3ZlcmxheT1mbGF0JmJnSW1nT3BhY2l0eU92ZXJsYXk9MCZvcGFjaXR5T3ZlcmxheT0zMCZiZ0NvbG9yU2hhZG93PWFhYWFhYSZiZ1RleHR1cmVTaGFkb3c9ZmxhdCZiZ0ltZ09wYWNpdHlTaGFkb3c9MCZvcGFjaXR5U2hhZG93PTMwJnRoaWNrbmVzc1NoYWRvdz04cHgmb2Zmc2V0VG9wU2hhZG93PS04cHgmb2Zmc2V0TGVmdFNoYWRvdz0tOHB4JmNvcm5lclJhZGl1c1NoYWRvdz04cHgKCQkqIENvcHlyaWdodCAyMDE1IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVCAqLwoJCS8qIExheW91dCBoZWxwZXJzCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgoJCS51aS1oZWxwZXItaGlkZGVuIHsKCQlkaXNwbGF5OiBub25lOwoJCX0KCgkJLnVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZSB7CgkJYm9yZGVyOiAwOwoJCWNsaXA6IHJlY3QoMCAwIDAgMCk7CgkJaGVpZ2h0OiAxcHg7CgkJbWFyZ2luOiAtMXB4OwoJCW92ZXJmbG93OiBoaWRkZW47CgkJcGFkZGluZzogMDsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IDFweDsKCQl9CgoJCS51aS1oZWxwZXItcmVzZXQgewoJCW1hcmdpbjogMDsKCQlwYWRkaW5nOiAwOwoJCWJvcmRlcjogMDsKCQlvdXRsaW5lOiAwOwoJCWxpbmUtaGVpZ2h0OiAxLjM7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWZvbnQtc2l6ZTogMTAwJTsKCQlsaXN0LXN0eWxlOiBub25lOwoJCX0KCgkJLnVpLWhlbHBlci1jbGVhcmZpeDpiZWZvcmUsCgkJLnVpLWhlbHBlci1jbGVhcmZpeDphZnRlciB7CgkJY29udGVudDogIiI7CgkJZGlzcGxheTogdGFibGU7CgkJYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKCQl9CgoJCS51aS1oZWxwZXItY2xlYXJmaXg6YWZ0ZXIgewoJCWNsZWFyOiBib3RoOwoJCX0KCgkJLnVpLWhlbHBlci1jbGVhcmZpeCB7CgkJbWluLWhlaWdodDogMDsKCQkvKiBzdXBwb3J0OiBJRTcgKi8KCQl9CgoJCS51aS1oZWxwZXItemZpeCB7CgkJd2lkdGg6IDEwMCU7CgkJaGVpZ2h0OiAxMDAlOwoJCXRvcDogMDsKCQlsZWZ0OiAwOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlvcGFjaXR5OiAwOwoJCWZpbHRlcjogQWxwaGEoT3BhY2l0eT0wKTsKCQkvKiBzdXBwb3J0OiBJRTggKi8KCQl9CgoJCS51aS1mcm9udCB7CgkJei1pbmRleDogMTAwOwoJCX0KCQkvKiBJbnRlcmFjdGlvbiBDdWVzCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgoJCS51aS1zdGF0ZS1kaXNhYmxlZCB7CgkJY3Vyc29yOiBkZWZhdWx0ICFpbXBvcnRhbnQ7CgkJfQoJCS8qIEljb25zCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgkJLyogc3RhdGVzIGFuZCBpbWFnZXMgKi8KCgkJLnVpLWljb24gewoJCWRpc3BsYXk6IGJsb2NrOwoJCXRleHQtaW5kZW50OiAtOTk5OTlweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCWJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJfQoJCS8qIE1pc2MgdmlzdWFscwoJCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoJCS8qIE92ZXJsYXlzICovCgoJCS51aS13aWRnZXQtb3ZlcmxheSB7CgkJcG9zaXRpb246IGZpeGVkOwoJCXRvcDogMDsKCQlsZWZ0OiAwOwoJCXdpZHRoOiAxMDAlOwoJCWhlaWdodDogMTAwJTsKCQl9CgoJCS51aS1hY2NvcmRpb24gLnVpLWFjY29yZGlvbi1oZWFkZXIgewoJCWRpc3BsYXk6IGJsb2NrOwoJCWN1cnNvcjogcG9pbnRlcjsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJbWFyZ2luOiAycHggMCAwIDA7CgkJcGFkZGluZzogLjVlbSAuNWVtIC41ZW0gLjdlbTsKCQltaW4taGVpZ2h0OiAwOwoJCS8qIHN1cHBvcnQ6IElFNyAqLwoJCWZvbnQtc2l6ZTogMTAwJTsKCQl9CgoJCS51aS1hY2NvcmRpb24gLnVpLWFjY29yZGlvbi1pY29ucyB7CgkJcGFkZGluZy1sZWZ0OiAyLjJlbTsKCQl9CgoJCS51aS1hY2NvcmRpb24gLnVpLWFjY29yZGlvbi1pY29ucyAudWktYWNjb3JkaW9uLWljb25zIHsKCQlwYWRkaW5nLWxlZnQ6IDIuMmVtOwoJCX0KCgkJLnVpLWFjY29yZGlvbiAudWktYWNjb3JkaW9uLWhlYWRlciAudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJbGVmdDogLjVlbTsKCQl0b3A6IDUwJTsKCQltYXJnaW4tdG9wOiAtOHB4OwoJCX0KCgkJLnVpLWFjY29yZGlvbiAudWktYWNjb3JkaW9uLWNvbnRlbnQgewoJCXBhZGRpbmc6IDFlbSAyLjJlbTsKCQlib3JkZXItdG9wOiAwOwoJCW92ZXJmbG93OiBhdXRvOwoJCX0KCgkJLnVpLWF1dG9jb21wbGV0ZSB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXRvcDogMDsKCQlsZWZ0OiAwOwoJCWN1cnNvcjogZGVmYXVsdDsKCQl9CgoJCS51aS1idXR0b24gewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJcGFkZGluZzogMDsKCQlsaW5lLWhlaWdodDogbm9ybWFsOwoJCW1hcmdpbi1yaWdodDogLjFlbTsKCQljdXJzb3I6IHBvaW50ZXI7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZTsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJb3ZlcmZsb3c6IHZpc2libGU7CgkJLyogcmVtb3ZlcyBleHRyYSB3aWR0aCBpbiBJRSAqLwoJCX0KCgkJLnVpLWJ1dHRvbiwKCQkudWktYnV0dG9uOmxpbmssCgkJLnVpLWJ1dHRvbjp2aXNpdGVkLAoJCS51aS1idXR0b246aG92ZXIsCgkJLnVpLWJ1dHRvbjphY3RpdmUgewoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQl9CgkJLyogdG8gbWFrZSByb29tIGZvciB0aGUgaWNvbiwgYSB3aWR0aCBuZWVkcyB0byBiZSBzZXQgaGVyZSAqLwoKCQkudWktYnV0dG9uLWljb24tb25seSB7CgkJd2lkdGg6IDIuMmVtOwoJCX0KCQkvKiBidXR0b24gZWxlbWVudHMgc2VlbSB0byBuZWVkIGEgbGl0dGxlIG1vcmUgd2lkdGggKi8KCgkJYnV0dG9uLnVpLWJ1dHRvbi1pY29uLW9ubHkgewoJCXdpZHRoOiAyLjRlbTsKCQl9CgoJCS51aS1idXR0b24taWNvbnMtb25seSB7CgkJd2lkdGg6IDMuNGVtOwoJCX0KCgkJYnV0dG9uLnVpLWJ1dHRvbi1pY29ucy1vbmx5IHsKCQl3aWR0aDogMy43ZW07CgkJfQoJCS8qIGJ1dHRvbiB0ZXh0IGVsZW1lbnQgKi8KCgkJLnVpLWJ1dHRvbiAudWktYnV0dG9uLXRleHQgewoJCWRpc3BsYXk6IGJsb2NrOwoJCWxpbmUtaGVpZ2h0OiBub3JtYWw7CgkJfQoKCQkudWktYnV0dG9uLXRleHQtb25seSAudWktYnV0dG9uLXRleHQgewoJCXBhZGRpbmc6IC40ZW0gMWVtOwoJCX0KCgkJLnVpLWJ1dHRvbi1pY29uLW9ubHkgLnVpLWJ1dHRvbi10ZXh0LAoJCS51aS1idXR0b24taWNvbnMtb25seSAudWktYnV0dG9uLXRleHQgewoJCXBhZGRpbmc6IC40ZW07CgkJdGV4dC1pbmRlbnQ6IC05OTk5OTk5cHg7CgkJfQoKCQkudWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IC51aS1idXR0b24tdGV4dCwKCQkudWktYnV0dG9uLXRleHQtaWNvbnMgLnVpLWJ1dHRvbi10ZXh0IHsKCQlwYWRkaW5nOiAuNGVtIDFlbSAuNGVtIDIuMWVtOwoJCX0KCgkJLnVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IC51aS1idXR0b24tdGV4dCwKCQkudWktYnV0dG9uLXRleHQtaWNvbnMgLnVpLWJ1dHRvbi10ZXh0IHsKCQlwYWRkaW5nOiAuNGVtIDIuMWVtIC40ZW0gMWVtOwoJCX0KCgkJLnVpLWJ1dHRvbi10ZXh0LWljb25zIC51aS1idXR0b24tdGV4dCB7CgkJcGFkZGluZy1sZWZ0OiAyLjFlbTsKCQlwYWRkaW5nLXJpZ2h0OiAyLjFlbTsKCQl9CgkJLyogbm8gaWNvbiBzdXBwb3J0IGZvciBpbnB1dCBlbGVtZW50cywgcHJvdmlkZSBwYWRkaW5nIGJ5IGRlZmF1bHQgKi8KCgkJaW5wdXQudWktYnV0dG9uIHsKCQlwYWRkaW5nOiAuNGVtIDFlbTsKCQl9CgkJLyogYnV0dG9uIGljb24gZWxlbWVudChzKSAqLwoKCQkudWktYnV0dG9uLWljb24tb25seSAudWktaWNvbiwKCQkudWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IC51aS1pY29uLAoJCS51aS1idXR0b24tdGV4dC1pY29uLXNlY29uZGFyeSAudWktaWNvbiwKCQkudWktYnV0dG9uLXRleHQtaWNvbnMgLnVpLWljb24sCgkJLnVpLWJ1dHRvbi1pY29ucy1vbmx5IC51aS1pY29uIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiA1MCU7CgkJbWFyZ2luLXRvcDogLThweDsKCQl9CgoJCS51aS1idXR0b24taWNvbi1vbmx5IC51aS1pY29uIHsKCQlsZWZ0OiA1MCU7CgkJbWFyZ2luLWxlZnQ6IC04cHg7CgkJfQoKCQkudWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IC51aS1idXR0b24taWNvbi1wcmltYXJ5LAoJCS51aS1idXR0b24tdGV4dC1pY29ucyAudWktYnV0dG9uLWljb24tcHJpbWFyeSwKCQkudWktYnV0dG9uLWljb25zLW9ubHkgLnVpLWJ1dHRvbi1pY29uLXByaW1hcnkgewoJCWxlZnQ6IC41ZW07CgkJfQoKCQkudWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkgLnVpLWJ1dHRvbi1pY29uLXNlY29uZGFyeSwKCQkudWktYnV0dG9uLXRleHQtaWNvbnMgLnVpLWJ1dHRvbi1pY29uLXNlY29uZGFyeSwKCQkudWktYnV0dG9uLWljb25zLW9ubHkgLnVpLWJ1dHRvbi1pY29uLXNlY29uZGFyeSB7CgkJcmlnaHQ6IC41ZW07CgkJfQoJCS8qIGJ1dHRvbiBzZXRzICovCgoJCS51aS1idXR0b25zZXQgewoJCW1hcmdpbi1yaWdodDogN3B4OwoJCX0KCgkJLnVpLWJ1dHRvbnNldCAudWktYnV0dG9uIHsKCQltYXJnaW4tbGVmdDogMDsKCQltYXJnaW4tcmlnaHQ6IC0uM2VtOwoJCX0KCQkvKiB3b3JrYXJvdW5kcyAqLwoJCS8qIHJlc2V0IGV4dHJhIHBhZGRpbmcgaW4gRmlyZWZveCwgc2VlIGg1YnAuY29tL2wgKi8KCgkJaW5wdXQudWktYnV0dG9uOjotbW96LWZvY3VzLWlubmVyLAoJCWJ1dHRvbi51aS1idXR0b246Oi1tb3otZm9jdXMtaW5uZXIgewoJCWJvcmRlcjogMDsKCQlwYWRkaW5nOiAwOwoJCX0KCgkJLnVpLWRhdGVwaWNrZXIgewoJCXdpZHRoOiAxN2VtOwoJCXBhZGRpbmc6IC4yZW0gLjJlbSAwOwoJCWRpc3BsYXk6IG5vbmU7CgkJfQoKCQkudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1oZWFkZXIgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlwYWRkaW5nOiAuMmVtIDA7CgkJfQoKCQkudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2LAoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLW5leHQgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl0b3A6IDJweDsKCQl3aWR0aDogMS44ZW07CgkJaGVpZ2h0OiAxLjhlbTsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXByZXYtaG92ZXIsCgkJLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciB7CgkJdG9wOiAxcHg7CgkJfQoKCQkudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2IHsKCQlsZWZ0OiAycHg7CgkJfQoKCQkudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1uZXh0IHsKCQlyaWdodDogMnB4OwoJCX0KCgkJLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciB7CgkJbGVmdDogMXB4OwoJCX0KCgkJLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciB7CgkJcmlnaHQ6IDFweDsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXByZXYgc3BhbiwKCQkudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1uZXh0IHNwYW4gewoJCWRpc3BsYXk6IGJsb2NrOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlsZWZ0OiA1MCU7CgkJbWFyZ2luLWxlZnQ6IC04cHg7CgkJdG9wOiA1MCU7CgkJbWFyZ2luLXRvcDogLThweDsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXRpdGxlIHsKCQltYXJnaW46IDAgMi4zZW07CgkJbGluZS1oZWlnaHQ6IDEuOGVtOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXRpdGxlIHNlbGVjdCB7CgkJZm9udC1zaXplOiAxZW07CgkJbWFyZ2luOiAxcHggMDsKCQl9CgoJCS51aS1kYXRlcGlja2VyIHNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLAoJCS51aS1kYXRlcGlja2VyIHNlbGVjdC51aS1kYXRlcGlja2VyLXllYXIgewoJCXdpZHRoOiA0NSU7CgkJfQoKCQkudWktZGF0ZXBpY2tlciB0YWJsZSB7CgkJd2lkdGg6IDEwMCU7CgkJZm9udC1zaXplOiAuOWVtOwoJCWJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7CgkJbWFyZ2luOiAwIDAgLjRlbTsKCQl9CgoJCS51aS1kYXRlcGlja2VyIHRoIHsKCQlwYWRkaW5nOiAuN2VtIC4zZW07CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCWZvbnQtd2VpZ2h0OiBib2xkOwoJCWJvcmRlcjogMDsKCQl9CgoJCS51aS1kYXRlcGlja2VyIHRkIHsKCQlib3JkZXI6IDA7CgkJcGFkZGluZzogMXB4OwoJCX0KCgkJLnVpLWRhdGVwaWNrZXIgdGQgc3BhbiwKCQkudWktZGF0ZXBpY2tlciB0ZCBhIHsKCQlkaXNwbGF5OiBibG9jazsKCQlwYWRkaW5nOiAuMmVtOwoJCXRleHQtYWxpZ246IHJpZ2h0OwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmU7CgkJbWFyZ2luOiAuN2VtIDAgMCAwOwoJCXBhZGRpbmc6IDAgLjJlbTsKCQlib3JkZXItbGVmdDogMDsKCQlib3JkZXItcmlnaHQ6IDA7CgkJYm9yZGVyLWJvdHRvbTogMDsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgYnV0dG9uIHsKCQlmbG9hdDogcmlnaHQ7CgkJbWFyZ2luOiAuNWVtIC4yZW0gLjRlbTsKCQljdXJzb3I6IHBvaW50ZXI7CgkJcGFkZGluZzogLjJlbSAuNmVtIC4zZW0gLjZlbTsKCQl3aWR0aDogYXV0bzsKCQlvdmVyZmxvdzogdmlzaWJsZTsKCQl9CgoJCS51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgYnV0dG9uLnVpLWRhdGVwaWNrZXItY3VycmVudCB7CgkJZmxvYXQ6IGxlZnQ7CgkJfQoJCS8qIHdpdGggbXVsdGlwbGUgY2FsZW5kYXJzICovCgoJCS51aS1kYXRlcGlja2VyLnVpLWRhdGVwaWNrZXItbXVsdGkgewoJCXdpZHRoOiBhdXRvOwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAgewoJCWZsb2F0OiBsZWZ0OwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAgdGFibGUgewoJCXdpZHRoOiA5NSU7CgkJbWFyZ2luOiAwIGF1dG8gLjRlbTsKCQl9CgoJCS51aS1kYXRlcGlja2VyLW11bHRpLTIgLnVpLWRhdGVwaWNrZXItZ3JvdXAgewoJCXdpZHRoOiA1MCU7CgkJfQoKCQkudWktZGF0ZXBpY2tlci1tdWx0aS0zIC51aS1kYXRlcGlja2VyLWdyb3VwIHsKCQl3aWR0aDogMzMuMyU7CgkJfQoKCQkudWktZGF0ZXBpY2tlci1tdWx0aS00IC51aS1kYXRlcGlja2VyLWdyb3VwIHsKCQl3aWR0aDogMjUlOwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAtbGFzdCAudWktZGF0ZXBpY2tlci1oZWFkZXIsCgkJLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlIC51aS1kYXRlcGlja2VyLWhlYWRlciB7CgkJYm9yZGVyLWxlZnQtd2lkdGg6IDA7CgkJfQoKCQkudWktZGF0ZXBpY2tlci1tdWx0aSAudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIHsKCQljbGVhcjogbGVmdDsKCQl9CgoJCS51aS1kYXRlcGlja2VyLXJvdy1icmVhayB7CgkJY2xlYXI6IGJvdGg7CgkJd2lkdGg6IDEwMCU7CgkJZm9udC1zaXplOiAwOwoJCX0KCQkvKiBSVEwgc3VwcG9ydCAqLwoKCQkudWktZGF0ZXBpY2tlci1ydGwgewoJCWRpcmVjdGlvbjogcnRsOwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLXByZXYgewoJCXJpZ2h0OiAycHg7CgkJbGVmdDogYXV0bzsKCQl9CgoJCS51aS1kYXRlcGlja2VyLXJ0bCAudWktZGF0ZXBpY2tlci1uZXh0IHsKCQlsZWZ0OiAycHg7CgkJcmlnaHQ6IGF1dG87CgkJfQoKCQkudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItcHJldjpob3ZlciB7CgkJcmlnaHQ6IDFweDsKCQlsZWZ0OiBhdXRvOwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLW5leHQ6aG92ZXIgewoJCWxlZnQ6IDFweDsKCQlyaWdodDogYXV0bzsKCQl9CgoJCS51aS1kYXRlcGlja2VyLXJ0bCAudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIHsKCQljbGVhcjogcmlnaHQ7CgkJfQoKCQkudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSBidXR0b24gewoJCWZsb2F0OiBsZWZ0OwoJCX0KCgkJLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgYnV0dG9uLnVpLWRhdGVwaWNrZXItY3VycmVudCwKCQkudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItZ3JvdXAgewoJCWZsb2F0OiByaWdodDsKCQl9CgoJCS51aS1kYXRlcGlja2VyLXJ0bCAudWktZGF0ZXBpY2tlci1ncm91cC1sYXN0IC51aS1kYXRlcGlja2VyLWhlYWRlciwKCQkudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlIC51aS1kYXRlcGlja2VyLWhlYWRlciB7CgkJYm9yZGVyLXJpZ2h0LXdpZHRoOiAwOwoJCWJvcmRlci1sZWZ0LXdpZHRoOiAxcHg7CgkJfQoKCQkudWktZGlhbG9nIHsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl0b3A6IDA7CgkJbGVmdDogMDsKCQlwYWRkaW5nOiAuMmVtOwoJCW91dGxpbmU6IDA7CgkJfQoKCQkudWktZGlhbG9nIC51aS1kaWFsb2ctdGl0bGViYXIgewoJCXBhZGRpbmc6IC40ZW0gMWVtOwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl9CgoJCS51aS1kaWFsb2cgLnVpLWRpYWxvZy10aXRsZSB7CgkJZmxvYXQ6IGxlZnQ7CgkJbWFyZ2luOiAuMWVtIDA7CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQl3aWR0aDogOTAlOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CgkJfQoKCQkudWktZGlhbG9nIC51aS1kaWFsb2ctdGl0bGViYXItY2xvc2UgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlyaWdodDogLjNlbTsKCQl0b3A6IDUwJTsKCQl3aWR0aDogMjBweDsKCQltYXJnaW46IC0xMHB4IDAgMCAwOwoJCXBhZGRpbmc6IDFweDsKCQloZWlnaHQ6IDIwcHg7CgkJfQoKCQkudWktZGlhbG9nIC51aS1kaWFsb2ctY29udGVudCB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWJvcmRlcjogMDsKCQlwYWRkaW5nOiAuNWVtIDFlbTsKCQliYWNrZ3JvdW5kOiBub25lOwoJCW92ZXJmbG93OiBhdXRvOwoJCX0KCgkJLnVpLWRpYWxvZyAudWktZGlhbG9nLWJ1dHRvbnBhbmUgewoJCXRleHQtYWxpZ246IGxlZnQ7CgkJYm9yZGVyLXdpZHRoOiAxcHggMCAwIDA7CgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKCQltYXJnaW4tdG9wOiAuNWVtOwoJCXBhZGRpbmc6IC4zZW0gMWVtIC41ZW0gLjRlbTsKCQl9CgoJCS51aS1kaWFsb2cgLnVpLWRpYWxvZy1idXR0b25wYW5lIC51aS1kaWFsb2ctYnV0dG9uc2V0IHsKCQlmbG9hdDogcmlnaHQ7CgkJfQoKCQkudWktZGlhbG9nIC51aS1kaWFsb2ctYnV0dG9ucGFuZSBidXR0b24gewoJCW1hcmdpbjogLjVlbSAuNGVtIC41ZW0gMDsKCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoKCQkudWktZGlhbG9nIC51aS1yZXNpemFibGUtc2UgewoJCXdpZHRoOiAxMnB4OwoJCWhlaWdodDogMTJweDsKCQlyaWdodDogLTVweDsKCQlib3R0b206IC01cHg7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMTZweCAxNnB4OwoJCX0KCgkJLnVpLWRyYWdnYWJsZSAudWktZGlhbG9nLXRpdGxlYmFyIHsKCQljdXJzb3I6IG1vdmU7CgkJfQoKCQkudWktZHJhZ2dhYmxlLWhhbmRsZSB7CgkJLW1zLXRvdWNoLWFjdGlvbjogbm9uZTsKCQl0b3VjaC1hY3Rpb246IG5vbmU7CgkJfQoKCQkudWktbWVudSB7CgkJbGlzdC1zdHlsZTogbm9uZTsKCQlwYWRkaW5nOiAwOwoJCW1hcmdpbjogMDsKCQlkaXNwbGF5OiBibG9jazsKCQlvdXRsaW5lOiBub25lOwoJCX0KCgkJLnVpLW1lbnUgLnVpLW1lbnUgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl9CgoJCS51aS1tZW51IC51aS1tZW51LWl0ZW0gewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQltYXJnaW46IDA7CgkJcGFkZGluZzogM3B4IDFlbSAzcHggLjRlbTsKCQljdXJzb3I6IHBvaW50ZXI7CgkJbWluLWhlaWdodDogMDsKCQkvKiBzdXBwb3J0OiBJRTcgKi8KCQkvKiBzdXBwb3J0OiBJRTEwLCBzZWUgIzg4NDQgKi8KCQlsaXN0LXN0eWxlLWltYWdlOiB1cmwoImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQUFBQUFQLy8veUg1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlCUkFBNyIpOwoJCX0KCgkJLnVpLW1lbnUgLnVpLW1lbnUtZGl2aWRlciB7CgkJbWFyZ2luOiA1cHggMDsKCQloZWlnaHQ6IDA7CgkJZm9udC1zaXplOiAwOwoJCWxpbmUtaGVpZ2h0OiAwOwoJCWJvcmRlci13aWR0aDogMXB4IDAgMCAwOwoJCX0KCgkJLnVpLW1lbnUgLnVpLXN0YXRlLWZvY3VzLAoJCS51aS1tZW51IC51aS1zdGF0ZS1hY3RpdmUgewoJCW1hcmdpbjogLTFweDsKCQl9CgkJLyogaWNvbiBzdXBwb3J0ICovCgoJCS51aS1tZW51LWljb25zIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJfQoKCQkudWktbWVudS1pY29ucyAudWktbWVudS1pdGVtIHsKCQlwYWRkaW5nLWxlZnQ6IDJlbTsKCQl9CgkJLyogbGVmdC1hbGlnbmVkICovCgoJCS51aS1tZW51IC51aS1pY29uIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwOwoJCWJvdHRvbTogMDsKCQlsZWZ0OiAuMmVtOwoJCW1hcmdpbjogYXV0byAwOwoJCX0KCQkvKiByaWdodC1hbGlnbmVkICovCgoJCS51aS1tZW51IC51aS1tZW51LWljb24gewoJCWxlZnQ6IGF1dG87CgkJcmlnaHQ6IDA7CgkJfQoKCQkudWktcHJvZ3Jlc3NiYXIgewoJCWhlaWdodDogMmVtOwoJCXRleHQtYWxpZ246IGxlZnQ7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQl9CgoJCS51aS1wcm9ncmVzc2JhciAudWktcHJvZ3Jlc3NiYXItdmFsdWUgewoJCW1hcmdpbjogLTFweDsKCQloZWlnaHQ6IDEwMCU7CgkJfQoKCQkudWktcHJvZ3Jlc3NiYXIgLnVpLXByb2dyZXNzYmFyLW92ZXJsYXkgewoJCWJhY2tncm91bmQ6IHVybCgiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoS0FBb0FJQUJBQUFBQVAvLy95SC9DMDVGVkZORFFWQkZNaTR3QXdFQUFBQWgrUVFKQVFBQkFDd0FBQUFBS0FBb0FBQUNrWXdOcVhyZEM1MkRTMDZhN01GWkkrNEZIQkNLb0RlV0tYcXltUHFHcXh2SnJYWmJNeDdUdGMrdzlYZ1UyRkIzbE95UVJXRVQySUZHaVU5bTFmckRWcHhaWmM2YmZId3Y0YzFZWFA2azFWZHkyOTJGYjZVa3V2RnRYcHZXU3pBK0h5Y1hKSFVYaUdZSWlNZzJSNlc0NTlnbldHZkhOZGpJcURXVnFlbUgyZWtwT2JrcE9scHBXVXFaaXFyNmVkcXFXUUFBSWZrRUNRRUFBUUFzQUFBQUFDZ0FLQUFBQXBTTWdabkdmYXFjZzFFMnV1ekRtbUhVQlI4UWlsOTVoaVBLcVduM2FxdExzUzE4eTdHMVN6TmVvd1dCRU50UWQrVDFKa3RQMDVuelBUZEpabFI2dlV4TldXalYrdlVXaFdOa1dGd3hsOVZwWlJlZFljZmxJT0xhZmFhMjhYZHNIL3lubGNjMXVQVkRaeFFJUjBLMjUrY0lDQ21vcUNlNW1HaFpPZmVZU1VoNXlKY0p5cmtaV1dwYVI4ZG9KMm80TllxNjJsQUFBQ0g1QkFrQkFBRUFMQUFBQUFBb0FDZ0FBQUtWREk0WXkyMlpuSU5STnFvc3cwQnY3aTFneUhVa0ZqN29TYVdsdTNvdkM4R3hOc281Zmx1ejNxTFZoQlZlVC9MejdaVEh5eEw1ZERhbFFXUFZPc1FXdFJudXdYYUZUajlqVlZoOHBtYTlKalo0ellTajVaT3ltYTd1dW9sZmZoK0lSNWFXOTdjSHVCVVhLR0tYbEtqbitEaUhXTWNZSmFoNE4wbFlDTWxKT1hpcEdScjVxZGdvU1RycVdTcTZXRmwyeXBvYVVBQUFJZmtFQ1FFQUFRQXNBQUFBQUNnQUtBQUFBcGFFYjZITGdkL2lPN0ZOV3RjRldlK3VmT0RHalJmb2lKMmFrU2hidWViMHd0STUwem0wMnBidndmV0VNV0JRMXpLR2xMSWhza2lFUG05UjZ2Ulh4VjRaeldUMnlIT0dwV015b3JibEtsTnA4SG1IRWIvbENYamNXN2JtdFhQOFh0MjI5T1ZXUjFmb2QyZVdxTmZIdU1qWENQa0lHTmlsZU9pSW1WbUNPRW1vU2ZuM3lYbEpXbW9IR2hxcDZpbFl1V1lwbVRxS1VnQUFJZmtFQ1FFQUFRQXNBQUFBQUNnQUtBQUFBcGlFSDZrYjU4YmlRM0ZOV3RNRldXM2VOVmNvanVGR2ZxblpxU2VidVMwNnc1VjgwL1gwMnBLZTh6RndQNkVGV09UMWxERms4ckdFUmgxVFROT29jUTYxSG00WG0yVmV4VUhwemp5bVZpSHJGYmlFTHNlZlZybjZYS2ZudDJROUcvK1hkaWU0OTlYSGQyZzRoN2lvT0doWEdKYm9HQW5YU0Jub0J3S1l5ZmlvdWJaSjJIbjBSdVJaYWZsWk9pbDU2WnA2aWlvS1NYcFVBQUFoK1FRSkFRQUJBQ3dBQUFBQUtBQW9BQUFDa29RUnFSdm54dUk3a1UxYTFVVTViZDV0blNlT1pYaG1uNWxXSzNxTlRXdlJkUXhQOHF2YUMrL3lhWVF6WE83Qk12YVVFbUpSZDNUc2lNQWdzd21OWXJTZ1pkWXJUWDZ0U0hHWk83M2V6dUF3MnV4dVErQmJlWmZNeHNleFkzNSsvUWU0SjFpblYwZzR4M1dIdU1oSWwyalhPS1QyUStWVTVmZ29TVUk1MlZmWnlma0pHa2hhNmptWSthYVlkaXJxK2xRQUFDSDVCQWtCQUFFQUxBQUFBQUFvQUNnQUFBS1dCSUtwWWUwTDNZTktUb3Fzd1VsdnpuaWdkNHdpUjRLaFpyS3Q5VXBxaXA2MWk5RTN2TXZ4UmRIbGJFRmlFWGZrOVlBUll4T1paRDZWUTJwVXVuQm10UlhvMUxmOGhNVlZjTmw4SmFmVjM4YU0yL0Z1NVYxNkJuNjNyNnh0OTdqMDkrTVhTRmk0Qm5pR0ZhZTNoemJIOStoWUJ6a3B1VWg1YVptSHVhblpPWmdJdXZiR2lOZW9tQ25heHhhcDJ1cGFDWnNxKzFrQUFDSDVCQWtCQUFFQUxBQUFBQUFvQUNnQUFBS1hqSThCeTV6ZjRrT3hUVnJYTlZsdjFYMGQ4SUdaR0tMbk5wWXRtOExyOWNxVmV1T1N2Zk9XNzlEOWFESGl6TmhESmlkRlpoTnlkRWFoT2FESDZub210SmpwMXR1dEtvTldrdkE2SnFmUlZMSFUvUVVmYXU5bDJ4N0c1NGQxZmw5OTV4Y0lHQWRYcU1mQk5hZG9ZcmhIK01nMktCbHBWcGJsdUNpWG1NbloyU2g0R0JxSitja0lPcXFKNkxtS1NsbFptc29xNndwUUFBQWgrUVFKQVFBQkFDd0FBQUFBS0FBb0FBQUNsWXgvb0x2b3h1SkRrVTFhMVlVWmJKNTluU2QyWlhoV3FiUmEyL2dGOEd1MkRZM2lxczd5cnEreEJZRWtZdkZTTThhU1NPYkUrWmdSbDFCSEZaTnI3cFJDYXZaNUJXMjE0MmhZM0FOL3pXdHNtZjEycDlYeHhGbDJscExuMXJzZXp0ZlhaamRJV0lmMnM1ZEl0d2pZS0Jnbzl5ZzVwSGd6SlhURWVHbFp1ZW5weVBtcEdRb0tPV2tZbVNwYVNucUtpbGVJMkZBQUFDSDVCQWtCQUFFQUxBQUFBQUFvQUNnQUFBS1ZqQitndStqRzRrT1JUVnJWaFJsc25uMmRKM1psZUZhcHRGcmIrQ1htTzlPb3plTDVWZlA5OUh2QVdocGlVZGN3a3BCSDM4MjVBd1lkVTh4VHFsTEdodENvc0FyS01wdmZhMW1NUmFlOVZ2V1pmZUIyWGZQa2VMbW0xOGxVY0JqK3A1ZG5OOGpYWjNZSUdFaFl1T1VuNDVhb0NEa3AxNmhsNUlqWUp2aldLY25vR1FwcXlQbHBPaHIzYUVsYXFycTU2QnE3VkFBQU93PT0iKTsKCQloZWlnaHQ6IDEwMCU7CgkJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTI1KTsKCQkvKiBzdXBwb3J0OiBJRTggKi8KCQlvcGFjaXR5OiAwLjI1OwoJCX0KCgkJLnVpLXByb2dyZXNzYmFyLWluZGV0ZXJtaW5hdGUgLnVpLXByb2dyZXNzYmFyLXZhbHVlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiBub25lOwoJCX0KCgkJLnVpLXJlc2l6YWJsZSB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1oYW5kbGUgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlmb250LXNpemU6IDAuMXB4OwoJCWRpc3BsYXk6IGJsb2NrOwoJCS1tcy10b3VjaC1hY3Rpb246IG5vbmU7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1kaXNhYmxlZCAudWktcmVzaXphYmxlLWhhbmRsZSwKCQkudWktcmVzaXphYmxlLWF1dG9oaWRlIC51aS1yZXNpemFibGUtaGFuZGxlIHsKCQlkaXNwbGF5OiBub25lOwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1uIHsKCQljdXJzb3I6IG4tcmVzaXplOwoJCWhlaWdodDogN3B4OwoJCXdpZHRoOiAxMDAlOwoJCXRvcDogLTVweDsKCQlsZWZ0OiAwOwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1zIHsKCQljdXJzb3I6IHMtcmVzaXplOwoJCWhlaWdodDogN3B4OwoJCXdpZHRoOiAxMDAlOwoJCWJvdHRvbTogLTVweDsKCQlsZWZ0OiAwOwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1lIHsKCQljdXJzb3I6IGUtcmVzaXplOwoJCXdpZHRoOiA3cHg7CgkJcmlnaHQ6IC01cHg7CgkJdG9wOiAwOwoJCWhlaWdodDogMTAwJTsKCQl9CgoJCS51aS1yZXNpemFibGUtdyB7CgkJY3Vyc29yOiB3LXJlc2l6ZTsKCQl3aWR0aDogN3B4OwoJCWxlZnQ6IC01cHg7CgkJdG9wOiAwOwoJCWhlaWdodDogMTAwJTsKCQl9CgoJCS51aS1yZXNpemFibGUtc2UgewoJCWN1cnNvcjogc2UtcmVzaXplOwoJCXdpZHRoOiAxMnB4OwoJCWhlaWdodDogMTJweDsKCQlyaWdodDogMXB4OwoJCWJvdHRvbTogMXB4OwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1zdyB7CgkJY3Vyc29yOiBzdy1yZXNpemU7CgkJd2lkdGg6IDlweDsKCQloZWlnaHQ6IDlweDsKCQlsZWZ0OiAtNXB4OwoJCWJvdHRvbTogLTVweDsKCQl9CgoJCS51aS1yZXNpemFibGUtbncgewoJCWN1cnNvcjogbnctcmVzaXplOwoJCXdpZHRoOiA5cHg7CgkJaGVpZ2h0OiA5cHg7CgkJbGVmdDogLTVweDsKCQl0b3A6IC01cHg7CgkJfQoKCQkudWktcmVzaXphYmxlLW5lIHsKCQljdXJzb3I6IG5lLXJlc2l6ZTsKCQl3aWR0aDogOXB4OwoJCWhlaWdodDogOXB4OwoJCXJpZ2h0OiAtNXB4OwoJCXRvcDogLTVweDsKCQl9CgoJCS51aS1zZWxlY3RhYmxlIHsKCQktbXMtdG91Y2gtYWN0aW9uOiBub25lOwoJCXRvdWNoLWFjdGlvbjogbm9uZTsKCQl9CgoJCS51aS1zZWxlY3RhYmxlLWhlbHBlciB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXotaW5kZXg6IDEwMDsKCQlib3JkZXI6IDFweCBkb3R0ZWQgYmxhY2s7CgkJfQoKCQkudWktc2VsZWN0bWVudS1tZW51IHsKCQlwYWRkaW5nOiAwOwoJCW1hcmdpbjogMDsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwOwoJCWxlZnQ6IDA7CgkJZGlzcGxheTogbm9uZTsKCQl9CgoJCS51aS1zZWxlY3RtZW51LW1lbnUgLnVpLW1lbnUgewoJCW92ZXJmbG93OiBhdXRvOwoJCS8qIFN1cHBvcnQ6IElFNyAqLwoJCW92ZXJmbG93LXg6IGhpZGRlbjsKCQlwYWRkaW5nLWJvdHRvbTogMXB4OwoJCX0KCgkJLnVpLXNlbGVjdG1lbnUtbWVudSAudWktbWVudSAudWktc2VsZWN0bWVudS1vcHRncm91cCB7CgkJZm9udC1zaXplOiAxZW07CgkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJbGluZS1oZWlnaHQ6IDEuNTsKCQlwYWRkaW5nOiAycHggMC40ZW07CgkJbWFyZ2luOiAwLjVlbSAwIDAgMDsKCQloZWlnaHQ6IGF1dG87CgkJYm9yZGVyOiAwOwoJCX0KCgkJLnVpLXNlbGVjdG1lbnUtb3BlbiB7CgkJZGlzcGxheTogYmxvY2s7CgkJfQoKCQkudWktc2VsZWN0bWVudS1idXR0b24gewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJY3Vyc29yOiBwb2ludGVyOwoJCX0KCgkJLnVpLXNlbGVjdG1lbnUtYnV0dG9uIHNwYW4udWktaWNvbiB7CgkJcmlnaHQ6IDAuNWVtOwoJCWxlZnQ6IGF1dG87CgkJbWFyZ2luLXRvcDogLThweDsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiA1MCU7CgkJfQoKCQkudWktc2VsZWN0bWVudS1idXR0b24gc3Bhbi51aS1zZWxlY3RtZW51LXRleHQgewoJCXRleHQtYWxpZ246IGxlZnQ7CgkJcGFkZGluZzogMC40ZW0gMi4xZW0gMC40ZW0gMWVtOwoJCWRpc3BsYXk6IGJsb2NrOwoJCWxpbmUtaGVpZ2h0OiAxLjQ7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQl3aGl0ZS1zcGFjZTogbm93cmFwOwoJCX0KCgkJLnVpLXNsaWRlciB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXRleHQtYWxpZ246IGxlZnQ7CgkJfQoKCQkudWktc2xpZGVyIC51aS1zbGlkZXItaGFuZGxlIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJei1pbmRleDogMjsKCQl3aWR0aDogMS4yZW07CgkJaGVpZ2h0OiAxLjJlbTsKCQljdXJzb3I6IGRlZmF1bHQ7CgkJLW1zLXRvdWNoLWFjdGlvbjogbm9uZTsKCQl0b3VjaC1hY3Rpb246IG5vbmU7CgkJfQoKCQkudWktc2xpZGVyIC51aS1zbGlkZXItcmFuZ2UgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl6LWluZGV4OiAxOwoJCWZvbnQtc2l6ZTogLjdlbTsKCQlkaXNwbGF5OiBibG9jazsKCQlib3JkZXI6IDA7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwOwoJCX0KCQkvKiBzdXBwb3J0OiBJRTggLSBTZWUgIzY3MjcgKi8KCgkJLnVpLXNsaWRlci51aS1zdGF0ZS1kaXNhYmxlZCAudWktc2xpZGVyLWhhbmRsZSwKCQkudWktc2xpZGVyLnVpLXN0YXRlLWRpc2FibGVkIC51aS1zbGlkZXItcmFuZ2UgewoJCWZpbHRlcjogaW5oZXJpdDsKCQl9CgoJCS51aS1zbGlkZXItaG9yaXpvbnRhbCB7CgkJaGVpZ2h0OiAuOGVtOwoJCX0KCgkJLnVpLXNsaWRlci1ob3Jpem9udGFsIC51aS1zbGlkZXItaGFuZGxlIHsKCQl0b3A6IC0uM2VtOwoJCW1hcmdpbi1sZWZ0OiAtLjZlbTsKCQl9CgoJCS51aS1zbGlkZXItaG9yaXpvbnRhbCAudWktc2xpZGVyLXJhbmdlIHsKCQl0b3A6IDA7CgkJaGVpZ2h0OiAxMDAlOwoJCX0KCgkJLnVpLXNsaWRlci1ob3Jpem9udGFsIC51aS1zbGlkZXItcmFuZ2UtbWluIHsKCQlsZWZ0OiAwOwoJCX0KCgkJLnVpLXNsaWRlci1ob3Jpem9udGFsIC51aS1zbGlkZXItcmFuZ2UtbWF4IHsKCQlyaWdodDogMDsKCQl9CgoJCS51aS1zbGlkZXItdmVydGljYWwgewoJCXdpZHRoOiAuOGVtOwoJCWhlaWdodDogMTAwcHg7CgkJfQoKCQkudWktc2xpZGVyLXZlcnRpY2FsIC51aS1zbGlkZXItaGFuZGxlIHsKCQlsZWZ0OiAtLjNlbTsKCQltYXJnaW4tbGVmdDogMDsKCQltYXJnaW4tYm90dG9tOiAtLjZlbTsKCQl9CgoJCS51aS1zbGlkZXItdmVydGljYWwgLnVpLXNsaWRlci1yYW5nZSB7CgkJbGVmdDogMDsKCQl3aWR0aDogMTAwJTsKCQl9CgoJCS51aS1zbGlkZXItdmVydGljYWwgLnVpLXNsaWRlci1yYW5nZS1taW4gewoJCWJvdHRvbTogMDsKCQl9CgoJCS51aS1zbGlkZXItdmVydGljYWwgLnVpLXNsaWRlci1yYW5nZS1tYXggewoJCXRvcDogMDsKCQl9CgoJCS51aS1zb3J0YWJsZS1oYW5kbGUgewoJCS1tcy10b3VjaC1hY3Rpb246IG5vbmU7CgkJdG91Y2gtYWN0aW9uOiBub25lOwoJCX0KCgkJLnVpLXNwaW5uZXIgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQlwYWRkaW5nOiAwOwoJCXZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CgkJfQoKCQkudWktc3Bpbm5lci1pbnB1dCB7CgkJYm9yZGVyOiBub25lOwoJCWJhY2tncm91bmQ6IG5vbmU7CgkJY29sb3I6IGluaGVyaXQ7CgkJcGFkZGluZzogMDsKCQltYXJnaW46IC4yZW0gMDsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwoJCW1hcmdpbi1sZWZ0OiAuNGVtOwoJCW1hcmdpbi1yaWdodDogMjJweDsKCQl9CgoJCS51aS1zcGlubmVyLWJ1dHRvbiB7CgkJd2lkdGg6IDE2cHg7CgkJaGVpZ2h0OiA1MCU7CgkJZm9udC1zaXplOiAuNWVtOwoJCXBhZGRpbmc6IDA7CgkJbWFyZ2luOiAwOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJY3Vyc29yOiBkZWZhdWx0OwoJCWRpc3BsYXk6IGJsb2NrOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJcmlnaHQ6IDA7CgkJfQoJCS8qIG1vcmUgc3BlY2lmaWNpdHkgcmVxdWlyZWQgaGVyZSB0byBvdmVycmlkZSBkZWZhdWx0IGJvcmRlcnMgKi8KCgkJLnVpLXNwaW5uZXIgYS51aS1zcGlubmVyLWJ1dHRvbiB7CgkJYm9yZGVyLXRvcDogbm9uZTsKCQlib3JkZXItYm90dG9tOiBub25lOwoJCWJvcmRlci1yaWdodDogbm9uZTsKCQl9CgkJLyogdmVydGljYWxseSBjZW50ZXIgaWNvbiAqLwoKCQkudWktc3Bpbm5lciAudWktaWNvbiB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCW1hcmdpbi10b3A6IC04cHg7CgkJdG9wOiA1MCU7CgkJbGVmdDogMDsKCQl9CgoJCS51aS1zcGlubmVyLXVwIHsKCQl0b3A6IDA7CgkJfQoKCQkudWktc3Bpbm5lci1kb3duIHsKCQlib3R0b206IDA7CgkJfQoJCS8qIFRSIG92ZXJyaWRlcyAqLwoKCQkudWktc3Bpbm5lciAudWktaWNvbi10cmlhbmdsZS0xLXMgewoJCS8qIG5lZWQgdG8gZml4IGljb25zIHNwcml0ZSAqLwoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NXB4IC0xNnB4OwoJCX0KCgkJLnVpLXRhYnMgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkvKiBwb3NpdGlvbjogcmVsYXRpdmUgcHJldmVudHMgSUUgc2Nyb2xsIGJ1ZyAoZWxlbWVudCB3aXRoIHBvc2l0aW9uOiByZWxhdGl2ZSBpbnNpZGUgY29udGFpbmVyIHdpdGggb3ZlcmZsb3c6IGF1dG8gYXBwZWFyIGFzICJmaXhlZCIpICovCgkJcGFkZGluZzogLjJlbTsKCQl9CgoJCS51aS10YWJzIC51aS10YWJzLW5hdiB7CgkJbWFyZ2luOiAwOwoJCXBhZGRpbmc6IC4yZW0gLjJlbSAwOwoJCX0KCgkJLnVpLXRhYnMgLnVpLXRhYnMtbmF2IGxpIHsKCQlsaXN0LXN0eWxlOiBub25lOwoJCWZsb2F0OiBsZWZ0OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl0b3A6IDA7CgkJbWFyZ2luOiAxcHggLjJlbSAwIDA7CgkJYm9yZGVyLWJvdHRvbS13aWR0aDogMDsKCQlwYWRkaW5nOiAwOwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJfQoKCQkudWktdGFicyAudWktdGFicy1uYXYgLnVpLXRhYnMtYW5jaG9yIHsKCQlmbG9hdDogbGVmdDsKCQlwYWRkaW5nOiAuNWVtIDFlbTsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJfQoKCQkudWktdGFicyAudWktdGFicy1uYXYgbGkudWktdGFicy1hY3RpdmUgewoJCW1hcmdpbi1ib3R0b206IC0xcHg7CgkJcGFkZGluZy1ib3R0b206IDFweDsKCQl9CgoJCS51aS10YWJzIC51aS10YWJzLW5hdiBsaS51aS10YWJzLWFjdGl2ZSAudWktdGFicy1hbmNob3IsCgkJLnVpLXRhYnMgLnVpLXRhYnMtbmF2IGxpLnVpLXN0YXRlLWRpc2FibGVkIC51aS10YWJzLWFuY2hvciwKCQkudWktdGFicyAudWktdGFicy1uYXYgbGkudWktdGFicy1sb2FkaW5nIC51aS10YWJzLWFuY2hvciB7CgkJY3Vyc29yOiB0ZXh0OwoJCX0KCgkJLnVpLXRhYnMtY29sbGFwc2libGUgLnVpLXRhYnMtbmF2IGxpLnVpLXRhYnMtYWN0aXZlIC51aS10YWJzLWFuY2hvciB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCX0KCgkJLnVpLXRhYnMgLnVpLXRhYnMtcGFuZWwgewoJCWRpc3BsYXk6IGJsb2NrOwoJCWJvcmRlci13aWR0aDogMDsKCQlwYWRkaW5nOiAxZW0gMS40ZW07CgkJYmFja2dyb3VuZDogbm9uZTsKCQl9CgoJCS51aS10b29sdGlwIHsKCQlwYWRkaW5nOiA4cHg7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXotaW5kZXg6IDk5OTk7CgkJbWF4LXdpZHRoOiAzMDBweDsKCQktd2Via2l0LWJveC1zaGFkb3c6IDAgMCA1cHggI2FhYTsKCQlib3gtc2hhZG93OiAwIDAgNXB4ICNhYWE7CgkJfQoKCQlib2R5IC51aS10b29sdGlwIHsKCQlib3JkZXItd2lkdGg6IDJweDsKCQl9CgkJLyogQ29tcG9uZW50IGNvbnRhaW5lcnMKCQktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCgkJLnVpLXdpZGdldCB7CgkJZm9udC1mYW1pbHk6IFZlcmRhbmEsIEFyaWFsLCBzYW5zLXNlcmlmOwoJCWZvbnQtc2l6ZTogMS4xZW07CgkJfQoKCQkudWktd2lkZ2V0IC51aS13aWRnZXQgewoJCWZvbnQtc2l6ZTogMWVtOwoJCX0KCgkJLnVpLXdpZGdldCBpbnB1dCwKCQkudWktd2lkZ2V0IHNlbGVjdCwKCQkudWktd2lkZ2V0IHRleHRhcmVhLAoJCS51aS13aWRnZXQgYnV0dG9uIHsKCQlmb250LWZhbWlseTogVmVyZGFuYSwgQXJpYWwsIHNhbnMtc2VyaWY7CgkJZm9udC1zaXplOiAxZW07CgkJfQoKCQkudWktd2lkZ2V0LWNvbnRlbnQgewoJCWJvcmRlcjogMXB4IHNvbGlkICNhYWFhYWE7CgkJYmFja2dyb3VuZDogI2ZmZmZmZiB1cmwoImltYWdlcy91aS1iZ19mbGF0Xzc1X2ZmZmZmZl80MHgxMDAucG5nIikgNTAlIDUwJSByZXBlYXQteDsKCQljb2xvcjogIzIyMjIyMjsKCQl9CgoJCS51aS13aWRnZXQtY29udGVudCBhIHsKCQljb2xvcjogIzIyMjIyMjsKCQl9CgoJCS51aS13aWRnZXQtaGVhZGVyIHsKCQlib3JkZXI6IDFweCBzb2xpZCAjYWFhYWFhOwoJCWJhY2tncm91bmQ6ICNjY2NjY2MgdXJsKCJpbWFnZXMvdWktYmdfaGlnaGxpZ2h0LXNvZnRfNzVfY2NjY2NjXzF4MTAwLnBuZyIpIDUwJSA1MCUgcmVwZWF0LXg7CgkJY29sb3I6ICMyMjIyMjI7CgkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJfQoKCQkudWktd2lkZ2V0LWhlYWRlciBhIHsKCQljb2xvcjogIzIyMjIyMjsKCQl9CgkJLyogSW50ZXJhY3Rpb24gc3RhdGVzCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgoJCS51aS1zdGF0ZS1kZWZhdWx0LAoJCS51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZGVmYXVsdCwKCQkudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZGVmYXVsdCB7CgkJYm9yZGVyOiAxcHggc29saWQgI2QzZDNkMzsKCQliYWNrZ3JvdW5kOiAjZTZlNmU2IHVybCgiaW1hZ2VzL3VpLWJnX2dsYXNzXzc1X2U2ZTZlNl8xeDQwMC5wbmciKSA1MCUgNTAlIHJlcGVhdC14OwoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJY29sb3I6ICM1NTU1NTU7CgkJfQoKCQkudWktc3RhdGUtZGVmYXVsdCBhLAoJCS51aS1zdGF0ZS1kZWZhdWx0IGE6bGluaywKCQkudWktc3RhdGUtZGVmYXVsdCBhOnZpc2l0ZWQgewoJCWNvbG9yOiAjNTU1NTU1OwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQl9CgoJCS51aS1zdGF0ZS1ob3ZlciwKCQkudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWhvdmVyLAoJCS51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1ob3ZlciwKCQkudWktc3RhdGUtZm9jdXMsCgkJLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1mb2N1cywKCQkudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZm9jdXMgewoJCWJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7CgkJYmFja2dyb3VuZDogI2RhZGFkYSB1cmwoImltYWdlcy91aS1iZ19nbGFzc183NV9kYWRhZGFfMXg0MDAucG5nIikgNTAlIDUwJSByZXBlYXQteDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCWNvbG9yOiAjMjEyMTIxOwoJCX0KCgkJLnVpLXN0YXRlLWhvdmVyIGEsCgkJLnVpLXN0YXRlLWhvdmVyIGE6aG92ZXIsCgkJLnVpLXN0YXRlLWhvdmVyIGE6bGluaywKCQkudWktc3RhdGUtaG92ZXIgYTp2aXNpdGVkLAoJCS51aS1zdGF0ZS1mb2N1cyBhLAoJCS51aS1zdGF0ZS1mb2N1cyBhOmhvdmVyLAoJCS51aS1zdGF0ZS1mb2N1cyBhOmxpbmssCgkJLnVpLXN0YXRlLWZvY3VzIGE6dmlzaXRlZCB7CgkJY29sb3I6ICMyMTIxMjE7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCX0KCgkJLnVpLXN0YXRlLWFjdGl2ZSwKCQkudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWFjdGl2ZSwKCQkudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtYWN0aXZlIHsKCQlib3JkZXI6IDFweCBzb2xpZCAjYWFhYWFhOwoJCWJhY2tncm91bmQ6ICNmZmZmZmYgdXJsKCJpbWFnZXMvdWktYmdfZ2xhc3NfNjVfZmZmZmZmXzF4NDAwLnBuZyIpIDUwJSA1MCUgcmVwZWF0LXg7CgkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQljb2xvcjogIzIxMjEyMTsKCQl9CgoJCS51aS1zdGF0ZS1hY3RpdmUgYSwKCQkudWktc3RhdGUtYWN0aXZlIGE6bGluaywKCQkudWktc3RhdGUtYWN0aXZlIGE6dmlzaXRlZCB7CgkJY29sb3I6ICMyMTIxMjE7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCX0KCQkvKiBJbnRlcmFjdGlvbiBDdWVzCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgoJCS51aS1zdGF0ZS1oaWdobGlnaHQsCgkJLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1oaWdobGlnaHQsCgkJLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWhpZ2hsaWdodCB7CgkJYm9yZGVyOiAxcHggc29saWQgI2ZjZWZhMTsKCQliYWNrZ3JvdW5kOiAjZmJmOWVlIHVybCgiaW1hZ2VzL3VpLWJnX2dsYXNzXzU1X2ZiZjllZV8xeDQwMC5wbmciKSA1MCUgNTAlIHJlcGVhdC14OwoJCWNvbG9yOiAjMzYzNjM2OwoJCX0KCgkJLnVpLXN0YXRlLWhpZ2hsaWdodCBhLAoJCS51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaGlnaGxpZ2h0IGEsCgkJLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWhpZ2hsaWdodCBhIHsKCQljb2xvcjogIzM2MzYzNjsKCQl9CgoJCS51aS1zdGF0ZS1lcnJvciwKCQkudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWVycm9yLAoJCS51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1lcnJvciB7CgkJYm9yZGVyOiAxcHggc29saWQgI2NkMGEwYTsKCQliYWNrZ3JvdW5kOiAjZmVmMWVjIHVybCgiaW1hZ2VzL3VpLWJnX2dsYXNzXzk1X2ZlZjFlY18xeDQwMC5wbmciKSA1MCUgNTAlIHJlcGVhdC14OwoJCWNvbG9yOiAjY2QwYTBhOwoJCX0KCgkJLnVpLXN0YXRlLWVycm9yIGEsCgkJLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1lcnJvciBhLAoJCS51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1lcnJvciBhIHsKCQljb2xvcjogI2NkMGEwYTsKCQl9CgoJCS51aS1zdGF0ZS1lcnJvci10ZXh0LAoJCS51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZXJyb3ItdGV4dCwKCQkudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZXJyb3ItdGV4dCB7CgkJY29sb3I6ICNjZDBhMGE7CgkJfQoKCQkudWktcHJpb3JpdHktcHJpbWFyeSwKCQkudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXByaW9yaXR5LXByaW1hcnksCgkJLnVpLXdpZGdldC1oZWFkZXIgLnVpLXByaW9yaXR5LXByaW1hcnkgewoJCWZvbnQtd2VpZ2h0OiBib2xkOwoJCX0KCgkJLnVpLXByaW9yaXR5LXNlY29uZGFyeSwKCQkudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXByaW9yaXR5LXNlY29uZGFyeSwKCQkudWktd2lkZ2V0LWhlYWRlciAudWktcHJpb3JpdHktc2Vjb25kYXJ5IHsKCQlvcGFjaXR5OiAuNzsKCQlmaWx0ZXI6IEFscGhhKE9wYWNpdHk9NzApOwoJCS8qIHN1cHBvcnQ6IElFOCAqLwoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJfQoKCQkudWktc3RhdGUtZGlzYWJsZWQsCgkJLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1kaXNhYmxlZCwKCQkudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZGlzYWJsZWQgewoJCW9wYWNpdHk6IC4zNTsKCQlmaWx0ZXI6IEFscGhhKE9wYWNpdHk9MzUpOwoJCS8qIHN1cHBvcnQ6IElFOCAqLwoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmU7CgkJfQoKCQkudWktc3RhdGUtZGlzYWJsZWQgLnVpLWljb24gewoJCWZpbHRlcjogQWxwaGEoT3BhY2l0eT0zNSk7CgkJLyogc3VwcG9ydDogSUU4IC0gU2VlICM2MDU5ICovCgkJfQoJCS8qIEljb25zCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgkJLyogc3RhdGVzIGFuZCBpbWFnZXMgKi8KCgkJLnVpLWljb24gewoJCXdpZHRoOiAxNnB4OwoJCWhlaWdodDogMTZweDsKCQl9CgoJCS51aS1pY29uLAoJCS51aS13aWRnZXQtY29udGVudCAudWktaWNvbiB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJpbWFnZXMvdWktaWNvbnNfMjIyMjIyXzI1NngyNDAucG5nIik7CgkJfQoKCQkudWktd2lkZ2V0LWhlYWRlciAudWktaWNvbiB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJpbWFnZXMvdWktaWNvbnNfMjIyMjIyXzI1NngyNDAucG5nIik7CgkJfQoKCQkudWktc3RhdGUtZGVmYXVsdCAudWktaWNvbiB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJpbWFnZXMvdWktaWNvbnNfODg4ODg4XzI1NngyNDAucG5nIik7CgkJfQoKCQkudWktc3RhdGUtaG92ZXIgLnVpLWljb24sCgkJLnVpLXN0YXRlLWZvY3VzIC51aS1pY29uIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoImltYWdlcy91aS1pY29uc180NTQ1NDVfMjU2eDI0MC5wbmciKTsKCQl9CgoJCS51aS1zdGF0ZS1hY3RpdmUgLnVpLWljb24gewoJCWJhY2tncm91bmQtaW1hZ2U6IHVybCgiaW1hZ2VzL3VpLWljb25zXzQ1NDU0NV8yNTZ4MjQwLnBuZyIpOwoJCX0KCgkJLnVpLXN0YXRlLWhpZ2hsaWdodCAudWktaWNvbiB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCJpbWFnZXMvdWktaWNvbnNfMmU4M2ZmXzI1NngyNDAucG5nIik7CgkJfQoKCQkudWktc3RhdGUtZXJyb3IgLnVpLWljb24sCgkJLnVpLXN0YXRlLWVycm9yLXRleHQgLnVpLWljb24gewoJCWJhY2tncm91bmQtaW1hZ2U6IHVybCgiaW1hZ2VzL3VpLWljb25zX2NkMGEwYV8yNTZ4MjQwLnBuZyIpOwoJCX0KCQkvKiBwb3NpdGlvbmluZyAqLwoKCQkudWktaWNvbi1ibGFuayB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMTZweCAxNnB4OwoJCX0KCgkJLnVpLWljb24tY2FyYXQtMS1uIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7CgkJfQoKCQkudWktaWNvbi1jYXJhdC0xLW5lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAwOwoJCX0KCgkJLnVpLWljb24tY2FyYXQtMS1lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAwOwoJCX0KCgkJLnVpLWljb24tY2FyYXQtMS1zZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggMDsKCQl9CgoJCS51aS1pY29uLWNhcmF0LTEtcyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggMDsKCQl9CgoJCS51aS1pY29uLWNhcmF0LTEtc3cgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC04MHB4IDA7CgkJfQoKCQkudWktaWNvbi1jYXJhdC0xLXcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC05NnB4IDA7CgkJfQoKCQkudWktaWNvbi1jYXJhdC0xLW53IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTEycHggMDsKCQl9CgoJCS51aS1pY29uLWNhcmF0LTItbi1zIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTI4cHggMDsKCQl9CgoJCS51aS1pY29uLWNhcmF0LTItZS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTQ0cHggMDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTEtbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMTZweDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTEtbmUgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC0xNnB4OwoJCX0KCgkJLnVpLWljb24tdHJpYW5nbGUtMS1lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMTZweDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTEtc2UgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC0xNnB4OwoJCX0KCgkJLnVpLWljb24tdHJpYW5nbGUtMS1zIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtNjRweCAtMTZweDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTEtc3cgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC04MHB4IC0xNnB4OwoJCX0KCgkJLnVpLWljb24tdHJpYW5nbGUtMS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtOTZweCAtMTZweDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTEtbncgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMTJweCAtMTZweDsKCQl9CgoJCS51aS1pY29uLXRyaWFuZ2xlLTItbi1zIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTI4cHggLTE2cHg7CgkJfQoKCQkudWktaWNvbi10cmlhbmdsZS0yLWUtdyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE0NHB4IC0xNnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMS1uIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0zMnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMS1uZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2cHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvdy0xLWUgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0zMnB4IC0zMnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMS1zZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvdy0xLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0zMnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMS1zdyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTgwcHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvdy0xLXcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC05NnB4IC0zMnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMS1udyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTExMnB4IC0zMnB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3ctMi1uLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjhweCAtMzJweDsKCQl9CgoJCS51aS1pY29uLWFycm93LTItbmUtc3cgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNDRweCAtMzJweDsKCQl9CgoJCS51aS1pY29uLWFycm93LTItZS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTYwcHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvdy0yLXNlLW53IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTc2cHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3N0b3AtMS1uIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTkycHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3N0b3AtMS1lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjA4cHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3N0b3AtMS1zIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjI0cHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3N0b3AtMS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjQwcHggLTMycHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrLTEtbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtNDhweDsKCQl9CgoJCS51aS1pY29uLWFycm93dGhpY2stMS1uZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2cHggLTQ4cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrLTEtZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTQ4cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrLTEtc2UgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3d0aGljay0xLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3d0aGljay0xLXN3IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtNDhweDsKCQl9CgoJCS51aS1pY29uLWFycm93dGhpY2stMS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtOTZweCAtNDhweDsKCQl9CgoJCS51aS1pY29uLWFycm93dGhpY2stMS1udyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTExMnB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3d0aGljay0yLW4tcyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTEyOHB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3d0aGljay0yLW5lLXN3IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTQ0cHggLTQ4cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrLTItZS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTYwcHggLTQ4cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrLTItc2UtbncgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNzZweCAtNDhweDsKCQl9CgoJCS51aS1pY29uLWFycm93dGhpY2tzdG9wLTEtbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE5MnB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3d0aGlja3N0b3AtMS1lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjA4cHggLTQ4cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3RoaWNrc3RvcC0xLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0yMjRweCAtNDhweDsKCQl9CgoJCS51aS1pY29uLWFycm93dGhpY2tzdG9wLTEtdyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTI0MHB4IC00OHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3dyZXR1cm50aGljay0xLXcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IDAgLTY0cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3JldHVybnRoaWNrLTEtbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2cHggLTY0cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3JldHVybnRoaWNrLTEtZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTY0cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3JldHVybnRoaWNrLTEtcyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTY0cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3JldHVybi0xLXcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC02NHB4OwoJCX0KCgkJLnVpLWljb24tYXJyb3dyZXR1cm4tMS1uIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93cmV0dXJuLTEtZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTk2cHggLTY0cHg7CgkJfQoKCQkudWktaWNvbi1hcnJvd3JldHVybi0xLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMTJweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93cmVmcmVzaC0xLXcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjhweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93cmVmcmVzaC0xLW4gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNDRweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93cmVmcmVzaC0xLWUgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNjBweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93cmVmcmVzaC0xLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNzZweCAtNjRweDsKCQl9CgoJCS51aS1pY29uLWFycm93LTQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IDAgLTgwcHg7CgkJfQoKCQkudWktaWNvbi1hcnJvdy00LWRpYWcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC04MHB4OwoJCX0KCgkJLnVpLWljb24tZXh0bGluayB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTgwcHg7CgkJfQoKCQkudWktaWNvbi1uZXd3aW4gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC04MHB4OwoJCX0KCgkJLnVpLWljb24tcmVmcmVzaCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggLTgwcHg7CgkJfQoKCQkudWktaWNvbi1zaHVmZmxlIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtODBweDsKCQl9CgoJCS51aS1pY29uLXRyYW5zZmVyLWUtdyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTk2cHggLTgwcHg7CgkJfQoKCQkudWktaWNvbi10cmFuc2ZlcnRoaWNrLWUtdyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTExMnB4IC04MHB4OwoJCX0KCgkJLnVpLWljb24tZm9sZGVyLWNvbGxhcHNlZCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtOTZweDsKCQl9CgoJCS51aS1pY29uLWZvbGRlci1vcGVuIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLWRvY3VtZW50IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLWRvY3VtZW50LWIgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC05NnB4OwoJCX0KCgkJLnVpLWljb24tbm90ZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggLTk2cHg7CgkJfQoKCQkudWktaWNvbi1tYWlsLWNsb3NlZCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTgwcHggLTk2cHg7CgkJfQoKCQkudWktaWNvbi1tYWlsLW9wZW4gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC05NnB4IC05NnB4OwoJCX0KCgkJLnVpLWljb24tc3VpdGNhc2UgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMTJweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLWNvbW1lbnQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjhweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLXBlcnNvbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE0NHB4IC05NnB4OwoJCX0KCgkJLnVpLWljb24tcHJpbnQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNjBweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLXRyYXNoIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTc2cHggLTk2cHg7CgkJfQoKCQkudWktaWNvbi1sb2NrZWQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xOTJweCAtOTZweDsKCQl9CgoJCS51aS1pY29uLXVubG9ja2VkIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjA4cHggLTk2cHg7CgkJfQoKCQkudWktaWNvbi1ib29rbWFyayB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTIyNHB4IC05NnB4OwoJCX0KCgkJLnVpLWljb24tdGFnIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjQwcHggLTk2cHg7CgkJfQoKCQkudWktaWNvbi1ob21lIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xMTJweDsKCQl9CgoJCS51aS1pY29uLWZsYWcgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLWNhbGVuZGFyIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1jYXJ0IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtNDhweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1wZW5jaWwgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLWNsb2NrIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1kaXNrIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtOTZweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1jYWxjdWxhdG9yIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTEycHggLTExMnB4OwoJCX0KCgkJLnVpLWljb24tem9vbWluIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTI4cHggLTExMnB4OwoJCX0KCgkJLnVpLWljb24tem9vbW91dCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE0NHB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLXNlYXJjaCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2MHB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLXdyZW5jaCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE3NnB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLWdlYXIgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xOTJweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1oZWFydCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTIwOHB4IC0xMTJweDsKCQl9CgoJCS51aS1pY29uLXN0YXIgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0yMjRweCAtMTEycHg7CgkJfQoKCQkudWktaWNvbi1saW5rIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMjQwcHggLTExMnB4OwoJCX0KCgkJLnVpLWljb24tY2FuY2VsIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xMjhweDsKCQl9CgoJCS51aS1pY29uLXBsdXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLXBsdXN0aGljayB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTEyOHB4OwoJCX0KCgkJLnVpLWljb24tbWludXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLW1pbnVzdGhpY2sgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLWNsb3NlIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi1jbG9zZXRoaWNrIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtOTZweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi1rZXkgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMTJweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi1saWdodGJ1bGIgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjhweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi1zY2lzc29ycyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE0NHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLWNsaXBib2FyZCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2MHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLWNvcHkgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNzZweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi1jb250YWN0IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTkycHggLTEyOHB4OwoJCX0KCgkJLnVpLWljb24taW1hZ2UgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0yMDhweCAtMTI4cHg7CgkJfQoKCQkudWktaWNvbi12aWRlbyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTIyNHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLXNjcmlwdCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTI0MHB4IC0xMjhweDsKCQl9CgoJCS51aS1pY29uLWFsZXJ0IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xNDRweDsKCQl9CgoJCS51aS1pY29uLWluZm8gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC0xNDRweDsKCQl9CgoJCS51aS1pY29uLW5vdGljZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTE0NHB4OwoJCX0KCgkJLnVpLWljb24taGVscCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTE0NHB4OwoJCX0KCgkJLnVpLWljb24tY2hlY2sgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0xNDRweDsKCQl9CgoJCS51aS1pY29uLWJ1bGxldCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTgwcHggLTE0NHB4OwoJCX0KCgkJLnVpLWljb24tcmFkaW8tb24gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC05NnB4IC0xNDRweDsKCQl9CgoJCS51aS1pY29uLXJhZGlvLW9mZiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTExMnB4IC0xNDRweDsKCQl9CgoJCS51aS1pY29uLXBpbi13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTI4cHggLTE0NHB4OwoJCX0KCgkJLnVpLWljb24tcGluLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNDRweCAtMTQ0cHg7CgkJfQoKCQkudWktaWNvbi1wbGF5IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xNjBweDsKCQl9CgoJCS51aS1pY29uLXBhdXNlIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAtMTYwcHg7CgkJfQoKCQkudWktaWNvbi1zZWVrLW5leHQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0zMnB4IC0xNjBweDsKCQl9CgoJCS51aS1pY29uLXNlZWstcHJldiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTE2MHB4OwoJCX0KCgkJLnVpLWljb24tc2Vlay1lbmQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0xNjBweDsKCQl9CgoJCS51aS1pY29uLXNlZWstc3RhcnQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC04MHB4IC0xNjBweDsKCQl9CgkJLyogdWktaWNvbi1zZWVrLWZpcnN0IGlzIGRlcHJlY2F0ZWQsIHVzZSB1aS1pY29uLXNlZWstc3RhcnQgaW5zdGVhZCAqLwoKCQkudWktaWNvbi1zZWVrLWZpcnN0IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMTYwcHg7CgkJfQoKCQkudWktaWNvbi1zdG9wIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtOTZweCAtMTYwcHg7CgkJfQoKCQkudWktaWNvbi1lamVjdCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTExMnB4IC0xNjBweDsKCQl9CgoJCS51aS1pY29uLXZvbHVtZS1vZmYgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjhweCAtMTYwcHg7CgkJfQoKCQkudWktaWNvbi12b2x1bWUtb24gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNDRweCAtMTYwcHg7CgkJfQoKCQkudWktaWNvbi1wb3dlciB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMTc2cHg7CgkJfQoKCQkudWktaWNvbi1zaWduYWwtZGlhZyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2cHggLTE3NnB4OwoJCX0KCgkJLnVpLWljb24tc2lnbmFsIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMTc2cHg7CgkJfQoKCQkudWktaWNvbi1iYXR0ZXJ5LTAgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC0xNzZweDsKCQl9CgoJCS51aS1pY29uLWJhdHRlcnktMSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggLTE3NnB4OwoJCX0KCgkJLnVpLWljb24tYmF0dGVyeS0yIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMTc2cHg7CgkJfQoKCQkudWktaWNvbi1iYXR0ZXJ5LTMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC05NnB4IC0xNzZweDsKCQl9CgoJCS51aS1pY29uLWNpcmNsZS1wbHVzIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xOTJweDsKCQl9CgoJCS51aS1pY29uLWNpcmNsZS1taW51cyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTE2cHggLTE5MnB4OwoJCX0KCgkJLnVpLWljb24tY2lyY2xlLWNsb3NlIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTE5MnB4OwoJCX0KCgkJLnVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0xOTJweDsKCQl9CgoJCS51aS1pY29uLWNpcmNsZS10cmlhbmdsZS13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtbiB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTk2cHggLTE5MnB4OwoJCX0KCgkJLnVpLWljb24tY2lyY2xlLWFycm93LWUgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xMTJweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGUtYXJyb3ctcyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTEyOHB4IC0xOTJweDsKCQl9CgoJCS51aS1pY29uLWNpcmNsZS1hcnJvdy13IHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTQ0cHggLTE5MnB4OwoJCX0KCgkJLnVpLWljb24tY2lyY2xlLWFycm93LW4gewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xNjBweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGUtem9vbWluIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTc2cHggLTE5MnB4OwoJCX0KCgkJLnVpLWljb24tY2lyY2xlLXpvb21vdXQgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0xOTJweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGUtY2hlY2sgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC0yMDhweCAtMTkycHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGVzbWFsbC1wbHVzIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yMDhweDsKCQl9CgoJCS51aS1pY29uLWNpcmNsZXNtYWxsLW1pbnVzIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAtMjA4cHg7CgkJfQoKCQkudWktaWNvbi1jaXJjbGVzbWFsbC1jbG9zZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTMycHggLTIwOHB4OwoJCX0KCgkJLnVpLWljb24tc3F1YXJlc21hbGwtcGx1cyB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTQ4cHggLTIwOHB4OwoJCX0KCgkJLnVpLWljb24tc3F1YXJlc21hbGwtbWludXMgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC02NHB4IC0yMDhweDsKCQl9CgoJCS51aS1pY29uLXNxdWFyZXNtYWxsLWNsb3NlIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtODBweCAtMjA4cHg7CgkJfQoKCQkudWktaWNvbi1ncmlwLWRvdHRlZC12ZXJ0aWNhbCB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMjI0cHg7CgkJfQoKCQkudWktaWNvbi1ncmlwLWRvdHRlZC1ob3Jpem9udGFsIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAtMjI0cHg7CgkJfQoKCQkudWktaWNvbi1ncmlwLXNvbGlkLXZlcnRpY2FsIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMjI0cHg7CgkJfQoKCQkudWktaWNvbi1ncmlwLXNvbGlkLWhvcml6b250YWwgewoJCWJhY2tncm91bmQtcG9zaXRpb246IC00OHB4IC0yMjRweDsKCQl9CgoJCS51aS1pY29uLWdyaXBzbWFsbC1kaWFnb25hbC1zZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggLTIyNHB4OwoJCX0KCgkJLnVpLWljb24tZ3JpcC1kaWFnb25hbC1zZSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogLTgwcHggLTIyNHB4OwoJCX0KCQkvKiBNaXNjIHZpc3VhbHMKCQktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCQkvKiBDb3JuZXIgcmFkaXVzICovCgoJCS51aS1jb3JuZXItYWxsLAoJCS51aS1jb3JuZXItdG9wLAoJCS51aS1jb3JuZXItbGVmdCwKCQkudWktY29ybmVyLXRsIHsKCQlib3JkZXItdG9wLWxlZnQtcmFkaXVzOiA0cHg7CgkJfQoKCQkudWktY29ybmVyLWFsbCwKCQkudWktY29ybmVyLXRvcCwKCQkudWktY29ybmVyLXJpZ2h0LAoJCS51aS1jb3JuZXItdHIgewoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiA0cHg7CgkJfQoKCQkudWktY29ybmVyLWFsbCwKCQkudWktY29ybmVyLWJvdHRvbSwKCQkudWktY29ybmVyLWxlZnQsCgkJLnVpLWNvcm5lci1ibCB7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNHB4OwoJCX0KCgkJLnVpLWNvcm5lci1hbGwsCgkJLnVpLWNvcm5lci1ib3R0b20sCgkJLnVpLWNvcm5lci1yaWdodCwKCQkudWktY29ybmVyLWJyIHsKCQlib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNHB4OwoJCX0KCQkvKiBPdmVybGF5cyAqLwoKCQkudWktd2lkZ2V0LW92ZXJsYXkgewoJCWJhY2tncm91bmQ6ICNhYWFhYWEgdXJsKCJpbWFnZXMvdWktYmdfZmxhdF8wX2FhYWFhYV80MHgxMDAucG5nIikgNTAlIDUwJSByZXBlYXQteDsKCQlvcGFjaXR5OiAuMzsKCQlmaWx0ZXI6IEFscGhhKE9wYWNpdHk9MzApOwoJCS8qIHN1cHBvcnQ6IElFOCAqLwoJCX0KCgkJLnVpLXdpZGdldC1zaGFkb3cgewoJCW1hcmdpbjogLThweCAwIDAgLThweDsKCQlwYWRkaW5nOiA4cHg7CgkJYmFja2dyb3VuZDogI2FhYWFhYSB1cmwoImltYWdlcy91aS1iZ19mbGF0XzBfYWFhYWFhXzQweDEwMC5wbmciKSA1MCUgNTAlIHJlcGVhdC14OwoJCW9wYWNpdHk6IC4zOwoJCWZpbHRlcjogQWxwaGEoT3BhY2l0eT0zMCk7CgkJLyogc3VwcG9ydDogSUU4ICovCgkJYm9yZGVyLXJhZGl1czogOHB4OwoJCX0KCQkvKkdyaWQqLwoKCQkudWktanFncmlkIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJYm9yZGVyOiAxcHggc29saWQgI2RkZDsKCQkvKmRlZmF1bHQqLwoJCS13ZWJraXQtYm9yZGVyLXJhZGl1czogM3B4OwoJCS1tb3otYm9yZGVyLXJhZGl1czogM3B4OwoJCWJvcmRlci1yYWRpdXM6IDNweDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC12aWV3IHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJbGVmdDogMDsKCQl0b3A6IDA7CgkJcGFkZGluZzogMDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWNvbW1vbi10YWJsZSB7fQoJCS8qIENhcHRpb24qLwoKCQkudWktanFncmlkIC51aS1qcWdyaWQtdGl0bGViYXIgewoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJbWluLWhlaWdodDogMzdweDsKCQlwYWRkaW5nOiA0cHggOHB4OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQltYXJnaW4tcmlnaHQ6IDJweDsKCQlib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RkZDsKCQkvKmRlZmF1bHQqLwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWNhcHRpb24gewoJCXRleHQtYWxpZ246IGxlZnQ7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtdGl0bGUgewoJCXBhZGRpbmctdG9wOiA1cHg7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC10aXRsZWJhci1jbG9zZSB7CgkJY29sb3I6IGluaGVyaXQ7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXRvcDogNTAlOwoJCW1hcmdpbjogLTEwcHggN3B4IDAgMDsKCQlwYWRkaW5nOiAxcHg7CgkJY3Vyc29yOiBwb2ludGVyOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRpdGxlYmFyLWNsb3NlIHNwYW4gewoJCWRpc3BsYXk6IGJsb2NrOwoJCW1hcmdpbjogMXB4OwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRpdGxlYmFyLWNsb3NlOmhvdmVyIHt9CgkJLyogSGVhZGVyKi8KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWhkaXYgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQltYXJnaW46IDA7CgkJcGFkZGluZzogMDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWhib3ggewoJCWZsb2F0OiBsZWZ0OwoJCXBhZGRpbmctcmlnaHQ6IDIwcHg7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtaHRhYmxlIHsKCQltYXJnaW4tYm90dG9tOiAwOwoJCXRhYmxlLWxheW91dDogZml4ZWQ7CgkJYm9yZGVyLXRvcDogbm9uZTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1odGFibGUgdGhlYWQgdGggewoJCW92ZXJmbG93OiBoaWRkZW47CgkJYm9yZGVyLWJvdHRvbTogbm9uZTsKCQlwYWRkaW5nLXJpZ2h0OiAycHg7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtaHRhYmxlIHRoZWFkIHRoIGRpdiB7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJfQoKCQkudWktdGgtY29sdW1uLAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1odGFibGUgdGgudWktdGgtY29sdW1uIHsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJfQoKCQkudWktdGgtY29sdW1uLWhlYWRlciwKCQkudWktanFncmlkIC51aS1qcWdyaWQtaHRhYmxlIHRoLnVpLXRoLWNvbHVtbi1oZWFkZXIgewoJCW92ZXJmbG93OiBoaWRkZW47CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQl9CgoJCS51aS10aC1sdHIsCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWh0YWJsZSB0aC51aS10aC1sdHIge30KCgkJLnVpLXRoLXJ0bCwKCQkudWktanFncmlkIC51aS1qcWdyaWQtaHRhYmxlIHRoLnVpLXRoLXJ0bCB7CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCX0KCgkJLnVpLWZpcnN0LXRoLWx0ciB7fQoKCQkudWktZmlyc3QtdGgtcnRsIHt9CgoJCS51aS1qcWdyaWQgdHIuanFnLWZpcnN0LXJvdy1oZWFkZXIgdGggewoJCWhlaWdodDogYXV0bzsKCQlib3JkZXItdG9wOiBub25lOwoJCXBhZGRpbmctYm90dG9tOiAwOwoJCXBhZGRpbmctdG9wOiAwOwoJCWJvcmRlci1ib3R0b206IG5vbmU7CgkJcGFkZGluZy1yaWdodDogMnB4OwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQl9CgoJCS51aS1qcWdyaWQgdHIuanFnLXNlY29uZC1yb3ctaGVhZGVyIHRoLAoJCS51aS1qcWdyaWQgdHIuanFnLXRoaXJkLS1yb3ctaGVhZGVyIHRoIHsKCQlib3JkZXItdG9wOiBub25lOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXRoLWRpdi1pZSB7CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQl6b29tOiAxOwoJCWhlaWdodDogMTdweDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1yZXNpemUgewoJCWhlaWdodDogMjBweCAhaW1wb3J0YW50OwoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQljdXJzb3I6IGUtcmVzaXplOwoJCWRpc3BsYXk6IGlubGluZTsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktZ3JpZC1pY28tc29ydCB7CgkJbWFyZ2luLWxlZnQ6IDVweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlyaWdodDogM3B4OwoJCWZvbnQtc2l6ZTogMTJweDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWljb24tYXNjIHsKCQltYXJnaW4tdG9wOiAtM3B4OwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktaWNvbi1kZXNjIHsKCQltYXJnaW4tdG9wOiA0cHg7CgkJfQoKCQkudWktanFncmlkIC51aS1pLWFzYyB7CgkJbWFyZ2luLXRvcDogMDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWktZGVzYyB7CgkJbWFyZ2luLXRvcDogMDsKCQltYXJnaW4tcmlnaHQ6IDEzcHg7CgkJfQoKCQkudWktanFncmlkIC51aS1zaW5nbGUtc29ydC1hc2MgewoJCW1hcmdpbi10b3A6IDA7CgkJfQoKCQkudWktanFncmlkIC51aS1zaW5nbGUtc29ydC1kZXNjIHt9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1zb3J0YWJsZSB7CgkJY3Vyc29yOiBwb2ludGVyOwoJCX0KCgkJLnVpLWpxZ3JpZCB0ci51aS1zZWFyY2gtdG9vbGJhciB0aCB7fQoKCQkudWktanFncmlkIC51aS1zZWFyY2gtdGFibGUgdGQudWktc2VhcmNoLWNsZWFyIHt9CgoJCS51aS1qcWdyaWQgdHIudWktc2VhcmNoLXRvb2xiYXIgdGQgPiBpbnB1dCB7fQoKCQkudWktanFncmlkIHRyLnVpLXNlYXJjaC10b29sYmFyIHNlbGVjdCB7fQoJCS8qIEJvZHkgKi8KCgkJLnVpLWpxZ3JpZCAudGFibGUtYm9yZGVyZWQsCgkJLnVpLWpxZ3JpZCAudGFibGUtYm9yZGVyZWQgdGQsCgkJLnVpLWpxZ3JpZCAudGFibGUtYm9yZGVyZWQgdGgudWktdGgtbHRyIHsKCQlib3JkZXItbGVmdDogMHB4IG5vbmUgIWltcG9ydGFudDsKCQl9CgoJCS51aS1qcWdyaWQgLnRhYmxlLWJvcmRlcmVkIHRoLnVpLXRoLXJ0bCB7CgkJYm9yZGVyLXJpZ2h0OiAwcHggbm9uZSAhaW1wb3J0YW50OwoJCX0KCgkJLnVpLWpxZ3JpZCAudGFibGUtYm9yZGVyZWQgdHIudWktcm93LXJ0bCB0ZCB7CgkJYm9yZGVyLXJpZ2h0OiAwcHggbm9uZSAhaW1wb3J0YW50OwoJCWJvcmRlci1sZWZ0OiAxcHggc29saWQgI2RkZCAhaW1wb3J0YW50OwoJCX0KCgkJZGl2LnRhYmxlZGl2ID4gLnRhYmxlLWJvcmRlcmVkIHsKCQlib3JkZXItbGVmdDogMXB4IHNvbGlkICNkZGQgIWltcG9ydGFudDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1iZGl2IHRhYmxlLnRhYmxlLWJvcmRlcmVkIHRkIHsKCQlib3JkZXItdG9wOiAwcHggbm9uZTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1iZGl2IHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJbWFyZ2luOiAwOwoJCXBhZGRpbmc6IDA7CgkJb3ZlcmZsb3c6IGF1dG87CgkJdGV4dC1hbGlnbjogbGVmdDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1idGFibGUgewoJCXRhYmxlLWxheW91dDogZml4ZWQ7CgkJYm9yZGVyLWxlZnQ6IG5vbmU7CgkJYm9yZGVyLXRvcDogbm9uZTsKCQltYXJnaW4tYm90dG9tOiAwcHgKCQl9CgoJCS51aS1qcWdyaWQgdHIuanFncm93IHsKCQlvdXRsaW5lLXN0eWxlOiBub25lOwoJCX0KCgkJLnVpLWpxZ3JpZCB0ci5qcWdyb3VwIHsKCQlvdXRsaW5lLXN0eWxlOiBub25lOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWJ0YWJsZSB0Ym9keSB0ci5qcWdyb3cgdGQgewoJCW92ZXJmbG93OiBoaWRkZW47CgkJd2hpdGUtc3BhY2U6IHByZTsKCQlwYWRkaW5nLXJpZ2h0OiAycHg7CgkJfQoKCQkudWktanFncmlkIHRyLmpxZ2ZpcnN0cm93IHRkIHsKCQloZWlnaHQ6IGF1dG87CgkJYm9yZGVyLXRvcDogbm9uZTsKCQlwYWRkaW5nLWJvdHRvbTogMDsKCQlwYWRkaW5nLXRvcDogMDsKCQlib3JkZXItYm90dG9tOiBub25lOwoJCXBhZGRpbmctcmlnaHQ6IDJweDsKCQl9CgoJCS51aS1qcWdyaWQgdHIuanFncm91cCB0ZCB7fQoKCQkudWktanFncmlkIHRyLmpxZm9vdCB0ZCB7fQoKCQkudWktanFncmlkIHRyLnVpLXJvdy1sdHIgdGQge30KCgkJLnVpLWpxZ3JpZCB0ci51aS1yb3ctcnRsIHRkIHt9CgoJCS51aS1qcWdyaWQgdGQuanFncmlkLXJvd251bSB7fQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcmVzaXplLW1hcmsgewoJCXdpZHRoOiAycHg7CgkJbGVmdDogMDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjNzc3OwoJCWN1cnNvcjogZS1yZXNpemU7CgkJY3Vyc29yOiBjb2wtcmVzaXplOwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl0b3A6IDA7CgkJaGVpZ2h0OiAxMDBweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCWRpc3BsYXk6IG5vbmU7CgkJYm9yZGVyOiAwIG5vbmU7CgkJei1pbmRleDogOTk5OTk7CgkJfQoJCS8qIEZvb3RlciAqLwoKCQkudWktanFncmlkIC51aS1qcWdyaWQtc2RpdiB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCW1hcmdpbjogMDsKCQlwYWRkaW5nOiAwOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJYm9yZGVyLWxlZnQ6IDAgbm9uZSAhaW1wb3J0YW50OwoJCWJvcmRlci10b3A6IDAgbm9uZSAhaW1wb3J0YW50OwoJCWJvcmRlci1yaWdodDogMCBub25lICFpbXBvcnRhbnQ7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtZnRhYmxlIHsKCQl0YWJsZS1sYXlvdXQ6IGZpeGVkOwoJCW1hcmdpbi1ib3R0b206IDA7CgkJfQoKCQkudWktanFncmlkIHRyLmZvb3Ryb3cgdGQgewoJCWZvbnQtd2VpZ2h0OiBib2xkOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQlwYWRkaW5nLXJpZ2h0OiAycHg7CgkJYm9yZGVyLWJvdHRvbTogMHB4IG5vbmU7CgkJfQoKCQkudWktanFncmlkIHRyLmZvb3Ryb3ctbHRyIHRkIHsKCQl0ZXh0LWFsaWduOiBsZWZ0OwoJCX0KCgkJLnVpLWpxZ3JpZCB0ci5mb290cm93LXJ0bCB0ZCB7CgkJdGV4dC1hbGlnbjogcmlnaHQ7CgkJfQoJCS8qIFBhZ2VyKi8KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXBhZ2VyLAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC10b3BwYWdlciB7CgkJYm9yZGVyLWxlZnQtd2lkdGg6IDBweDsKCQlib3JkZXItdG9wOiAxcHggc29saWQgI2RkZDsKCQkvKnBhZGRpbmcgOiA0cHggMHB4OyovCgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCS8qaGVpZ2h0OiBhdXRvOyAqLwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC10b3BwYWdlciB7CgkJYm9yZGVyLXRvcC13aWR0aDogMDsKCQlib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RkZDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC10b3BwYWdlciAudWktcGFnZXItY29udHJvbCwKCQkudWktanFncmlkIC51aS1qcWdyaWQtcGFnZXIgLnVpLXBhZ2VyLWNvbnRyb2wgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlib3JkZXItbGVmdDogMDsKCQlib3JkZXItYm90dG9tOiAwOwoJCWJvcmRlci10b3A6IDA7CgkJLypoZWlnaHQ6IDMwcHg7Ki8KCQl9CgoJCS51aS1qcWdyaWQgLnVpLXBnLXRhYmxlIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJcGFkZGluZzogMXB4IDA7CgkJd2lkdGg6IGF1dG87CgkJbWFyZ2luOiAwOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktcGctdGFibGUgdGQgewoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZTsKCQkvKnBhZGRpbmc6MHB4IDZweDsqLwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktcGFnZXItY29udHJvbCAudWktcGFnZXItdGFibGUgdGQgewoJCWJvcmRlci10b3A6IDBweCBub25lICFpbXBvcnRhbnQ7CgkJbWluLWhlaWdodDogMjBweCAhaW1wb3J0YW50OwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktcGctYnV0dG9uIHsKCQloZWlnaHQ6IGF1dG87CgkJfQoKCQkudWktanFncmlkIC51aS1wYWdpbmctcGFnZXIgdGQgewoJCXBhZGRpbmc6IDAgNXB4OwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktcGctYnV0dG9uIHNwYW4gewoJCWRpc3BsYXk6IGJsb2NrOwoJCW1hcmdpbjogMHB4IDJweDsKCQlmbG9hdDogbGVmdDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXBnLWJ1dHRvbjpob3ZlciB7fQoKCQkudWktanFncmlkIC51aS1kaXNhYmxlZDpob3ZlciB7fQoKCQkudWktanFncmlkIC51aS1wZy1pbnB1dCwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdG9wcGFnZXIgLnVpLXBnLWlucHV0IHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJaGVpZ2h0OiBhdXRvOwoJCXdpZHRoOiBhdXRvOwoJCWZvbnQtc2l6ZTogLjllbTsKCQltYXJnaW46IDA7CgkJbGluZS1oZWlnaHQ6IGluaGVyaXQ7CgkJYm9yZGVyOiBub25lOwoJCXBhZGRpbmc6IDBweCAzcHgKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXBnLXNlbGJveCwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdG9wcGFnZXIgLnVpLXBnLXNlbGJveCB7CgkJZm9udC1zaXplOiAuOWVtOwoJCWxpbmUtaGVpZ2h0OiBpbmhlcml0OwoJCWRpc3BsYXk6IGJsb2NrOwoJCWhlaWdodDogMjJweDsKCQltYXJnaW46IDA7CgkJcGFkZGluZzogM3B4IDBweCAzcHggM3B4OwoJCWJvcmRlcjogbm9uZTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXNlcGFyYXRvciB7CgkJaGVpZ2h0OiAxOHB4OwoJCWJvcmRlcjogbm9uZTsKCQlib3JkZXItbGVmdDogMnB4IHNvbGlkICNjY2M7CgkJLypkZWZhdWx0Ki8KCQl9CgoJCS51aS1zZXBhcmF0b3ItbGkgewoJCWhlaWdodDogMnB4OwoJCWJvcmRlcjogbm9uZTsKCQlib3JkZXItdG9wOiAycHggc29saWQgI2NjYzsKCQkvKmRlZmF1bHQqLwoJCW1hcmdpbjogMDsKCQlwYWRkaW5nOiAwOwoJCXdpZHRoOiAxMDAlCgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcGFnZXIgLnVpLXBnLWRpdiwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdG9wcGFnZXIgLnVpLXBnLWRpdiB7CgkJZmxvYXQ6IGxlZnQ7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXBhZ2VyIC51aS1wZy1idXR0b24sCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRvcHBhZ2VyIC51aS1wZy1idXR0b24gewoJCWN1cnNvcjogcG9pbnRlcjsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1wYWdlciAudWktcGctZGl2IHNwYW4sCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRvcHBhZ2VyIC51aS1wZy1kaXYgc3BhbiB7CgkJZmxvYXQ6IGxlZnQ7CgkJfQoKCQkudWktanFncmlkIHRkIGlucHV0LAoJCS51aS1qcWdyaWQgdGQgc2VsZWN0LAoJCS51aS1qcWdyaWQgdGQgdGV4dGFyZWEgewoJCW1hcmdpbjogMDsKCQl9CgoJCS51aS1qcWdyaWQgdGQgdGV4dGFyZWEgewoJCXdpZHRoOiBhdXRvOwoJCWhlaWdodDogYXV0bzsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1wYWdlciAudWktcGFnZXItdGFibGUsCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRvcHBhZ2VyIC51aS1wYWdlci10YWJsZSB7CgkJd2lkdGg6IDEwMCU7CgkJdGFibGUtbGF5b3V0OiBmaXhlZDsKCQloZWlnaHQ6IDEwMCU7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcGFnZXIgLnVpLXBhZ2luZy1pbmZvLAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC10b3BwYWdlciAudWktcGFnaW5nLWluZm8gewoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJaGVpZ2h0OiBhdXRvOwoJCW1hcmdpbi10b3A6IDNweDsKCQltYXJnaW4tcmlnaHQ6IDRweDsKCQlkaXNwbGF5OiBpbmxpbmU7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcGFnZXIgLnVpLXBhZ2luZy1wYWdlciwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdG9wcGFnZXIgLnVpLXBhZ2luZy1wYWdlciB7CgkJdGFibGUtbGF5b3V0OiBhdXRvOwoJCWhlaWdodDogMTAwJTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1wYWdlciAubmF2dGFibGUsCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRvcHBhZ2VyIC5uYXZ0YWJsZSB7CgkJZmxvYXQ6IGxlZnQ7CgkJdGFibGUtbGF5b3V0OiBhdXRvOwoJCWhlaWdodDogMTAwJTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1wYWdlciAubmF2dGFibGUgdGQsCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLXRvcHBhZ2VyIC5uYXZ0YWJsZSB0ZCB7CgkJcGFkZGluZzogMCA1cHg7CgkJfQoJCS8qU3ViZ3JpZCovCgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1idGFibGUgLnVpLXNnY29sbGFwc2VkIHNwYW4gewoJCWRpc3BsYXk6IGJsb2NrOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktc3ViZ3JpZCB7CgkJbWFyZ2luOiAwOwoJCXBhZGRpbmc6IDA7CgkJd2lkdGg6IDEwMCU7CgkJfQoKCQkudWktanFncmlkIC51aS1zdWJncmlkIHRhYmxlIHsKCQl0YWJsZS1sYXlvdXQ6IGZpeGVkOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktc3ViZ3JpZCB0ci51aS1zdWJ0YmxjZWxsIHRkIHt9CgoJCS51aS1qcWdyaWQgLnVpLXN1YmdyaWQgdGQuc3ViZ3JpZC1kYXRhIHsKCQlib3JkZXItdG9wOiAwIG5vbmUgIWltcG9ydGFudDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXN1YmdyaWQgdGQuc3ViZ3JpZC1jZWxsIHsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlCgkJfQoKCQkudWktanFncmlkIGEudWktc2docmVmIHsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJY29sb3I6ICMwMTAxMDE7CgkJLypkZWZhdWx0Ki8KCQl9CgoJCS51aS1qcWdyaWQgLnVpLXRoLXN1YmdyaWQgewoJCWhlaWdodDogMjBweDsKCQl9CgoJCS50YWJsZWRpdiA+IC5yb3cgewoJCW1hcmdpbjogMCAwCgkJfQoJCS8qIGxvYWRpbmcgKi8KCgkJLnVpLWpxZ3JpZCAubG9hZGluZyB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXRvcDogNDUlOwoJCWxlZnQ6IDQ1JTsKCQl3aWR0aDogYXV0bzsKCQl6LWluZGV4OiAxMDE7CgkJcGFkZGluZzogNnB4OwoJCW1hcmdpbjogNXB4OwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQlkaXNwbGF5OiBub25lOwoJCWJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CgkJLypkZWZhdWx0Ki8KCQlmb250LXNpemU6IDE0cHg7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Q5ZWRmNzsKCQl9CgoJCS51aS1qcWdyaWQgLmpxZ3JpZC1vdmVybGF5IHsKCQlkaXNwbGF5OiBub25lOwoJCXotaW5kZXg6IDEwMDsKCQl9CgkJLyogSUUgKiBodG1sIC5qcWdyaWQtb3ZlcmxheSB7d2lkdGg6IGV4cHJlc3Npb24odGhpcy5wYXJlbnROb2RlLm9mZnNldFdpZHRoKydweCcpO2hlaWdodDogZXhwcmVzc2lvbih0aGlzLnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0KydweCcpO30gKi8KCgkJKiAuanFncmlkLW92ZXJsYXkgaWZyYW1lIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwOwoJCWxlZnQ6IDA7CgkJei1pbmRleDogLTE7CgkJfQoJCS8qIElFIHdpZHRoOiBleHByZXNzaW9uKHRoaXMucGFyZW50Tm9kZS5vZmZzZXRXaWR0aCsncHgnKTtoZWlnaHQ6IGV4cHJlc3Npb24odGhpcy5wYXJlbnROb2RlLm9mZnNldEhlaWdodCsncHgnKTt9Ki8KCQkvKiBlbmQgbG9hZGluZyBkaXYgKi8KCQkvKiBUb29sYmFyICovCgoJCS51aS1qcWdyaWQgLnVpLXVzZXJkYXRhIHsKCQlwYWRkaW5nOiA0cHggMHB4OwoJCW92ZXJmbG93OiBoaWRkZW47CgkJbWluLWhlaWdodDogMzJweDsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXVzZXJkYXRhLXRvcCB7CgkJYm9yZGVyLWxlZnQtd2lkdGg6IDBweDsKCQkvKmRlZmF1bHQqLwoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktdXNlcmRhdGEtYm90dG9tIHsKCQlib3JkZXItbGVmdC13aWR0aDogMHB4OwoJCS8qZGVmYXVsdCovCgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNkZGQ7CgkJfQoJCS8qTW9kYWwgV2luZG93ICovCgoJCS51aS1qcWRpYWxvZyB7fQoKCQkudWktanFkaWFsb2cgewoJCWRpc3BsYXk6IG5vbmU7CgkJd2lkdGg6IDUwMHB4OwoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkvKnBhZGRpbmc6IDVweDsgKi8KCQlvdmVyZmxvdzogdmlzaWJsZTsKCQl9CgoJCS51aS1qcWRpYWxvZyAudWktanFkaWFsb2ctdGl0bGViYXIgewoJCXBhZGRpbmc6IC4xZW0gLjFlbTsKCQltaW4taGVpZ2h0OiAzNXB4OwoJCX0KCgkJLnVpLWpxZGlhbG9nIC51aS1qcWRpYWxvZy10aXRsZSB7CgkJbWFyZ2luOiAuM2VtIDAgLjJlbTsKCQlmb250LXdlaWdodDogYm9sZDsKCQlwYWRkaW5nLWxlZnQ6IDZweDsKCQlwYWRkaW5nLXJpZ2h0OiA2cHg7CgkJfQoKCQkudWktanFkaWFsb2cgLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwJTsKCQltYXJnaW46IDNweCA1cHggMCAwOwoJCXBhZGRpbmc6IDhweDsKCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoKCQkudWktanFkaWFsb2cgLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHNwYW4ge30KCgkJLnVpLWpxZGlhbG9nIC51aS1qcWRpYWxvZy10aXRsZWJhci1jbG9zZTpob3ZlciwKCQkudWktanFkaWFsb2cgLnVpLWpxZGlhbG9nLXRpdGxlYmFyLWNsb3NlOmZvY3VzIHsKCQlwYWRkaW5nOiA4cHg7CgkJfQoKCQkudWktanFkaWFsb2ctY29udGVudCwKCQkudWktanFkaWFsb2cgLnVpLWpxZGlhbG9nLWNvbnRlbnQgewoJCWJvcmRlcjogMDsKCQlwYWRkaW5nOiAuM2VtIC4yZW07CgkJYmFja2dyb3VuZDogbm9uZTsKCQloZWlnaHQ6IGF1dG87CgkJfQoKCQkudWktanFkaWFsb2cgLnVpLWpxY29uZmlybSB7CgkJcGFkZGluZzogLjRlbSAxZW07CgkJYm9yZGVyLXdpZHRoOiAzcHg7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCWJvdHRvbTogMTBweDsKCQlyaWdodDogMTBweDsKCQlvdmVyZmxvdzogdmlzaWJsZTsKCQlkaXNwbGF5OiBub25lOwoJCWhlaWdodDogMTIwcHg7CgkJd2lkdGg6IDIyMHB4OwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwoJCWJvcmRlci1yYWRpdXM6IDRweDsKCQktd2Via2l0LWJvcmRlci1yYWRpdXM6IDRweDsKCQktbW96LWJvcmRlci1yYWRpdXM6IDRweDsKCQl9CgoJCS51aS1qcWRpYWxvZz4udWktcmVzaXphYmxlLXNlIHt9CgoJCS51aS1qcWdyaWQ+LnVpLXJlc2l6YWJsZS1zZSB7fQoJCS8qIGVuZCBNb2RhbCB3aW5kb3cqLwoJCS8qIEZvcm0gZWRpdCAqLwoKCQkudWktanFkaWFsb2ctY29udGVudCAuRm9ybUdyaWQgewoJCW1hcmdpbjogMCA4cHggMCA4cHg7CgkJb3ZlcmZsb3c6IGF1dG87CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCX0KCgkJLnVpLWpxZGlhbG9nLWNvbnRlbnQgLkVkaXRUYWJsZSB7CgkJd2lkdGg6IDEwMCU7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQl9CgoJCS51aS1qcWRpYWxvZy1jb250ZW50IC5EZWxUYWJsZSB7CgkJd2lkdGg6IDEwMCU7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQl9CgoJCS5FZGl0VGFibGUgdGQgaW5wdXQsCgkJLkVkaXRUYWJsZSB0ZCBzZWxlY3QsCgkJLkVkaXRUYWJsZSB0ZCB0ZXh0YXJlYSB7CgkJd2lkdGg6IDk4JTsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJfQoKCQkuRWRpdFRhYmxlIHRkIHRleHRhcmVhIHsKCQl3aWR0aDogYXV0bzsKCQloZWlnaHQ6IGF1dG87CgkJfQoKCQkuRWRpdFRhYmxlIC5Gb3JtRGF0YSB0ZCB7CgkJaGVpZ2h0OiAzN3B4ICFpbXBvcnRhbnQ7CgkJfQoKCQkudWktanFkaWFsb2ctY29udGVudCB0ZC5FZGl0QnV0dG9uIHsKCQl0ZXh0LWFsaWduOiByaWdodDsKCQlwYWRkaW5nOiA1cHggNXB4IDVweCAwOwoJCX0KCgkJLnVpLWpxZGlhbG9nLWNvbnRlbnQgdGQubmF2QnV0dG9uIHsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJYm9yZGVyLWxlZnQ6IDAgbm9uZTsKCQlib3JkZXItdG9wOiAwIG5vbmU7CgkJYm9yZGVyLXJpZ2h0OiAwIG5vbmU7CgkJcGFkZGluZy1ib3R0b206IDVweDsKCQlwYWRkaW5nLXRvcDogNXB4OwoJCX0KCgkJLnVpLWpxZGlhbG9nLWNvbnRlbnQgaW5wdXQuRm9ybUVsZW1lbnQgewoJCXBhZGRpbmc6IC41ZW0gLjNlbTsKCQltYXJnaW4tYm90dG9tOiA1cHgKCQl9CgoJCS51aS1qcWRpYWxvZy1jb250ZW50IHNlbGVjdC5Gb3JtRWxlbWVudCB7CgkJcGFkZGluZzogLjNlbTsKCQltYXJnaW4tYm90dG9tOiAzcHg7CgkJfQoKCQkudWktanFkaWFsb2ctY29udGVudCAuZGF0YS1saW5lIHsKCQlwYWRkaW5nLXRvcDogLjFlbTsKCQlib3JkZXI6IDAgbm9uZTsKCQl9CgoJCS51aS1qcWRpYWxvZy1jb250ZW50IC5DYXB0aW9uVEQgewoJCXZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CgkJYm9yZGVyOiAwIG5vbmU7CgkJcGFkZGluZzogMnB4OwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJfQoKCQkudWktanFkaWFsb2ctY29udGVudCAuRGF0YVREIHsKCQlwYWRkaW5nOiAycHg7CgkJYm9yZGVyOiAwIG5vbmU7CgkJdmVydGljYWwtYWxpZ246IHRvcDsKCQl9CgoJCS51aS1qcWRpYWxvZy1jb250ZW50IC5mb3JtLXZpZXctZGF0YSB7CgkJd2hpdGUtc3BhY2U6IHByZQoJCX0KCgkJLmZtLWJ1dHRvbiB7fQoKCQkuZm0tYnV0dG9uLWljb24tbGVmdCB7CgkJbWFyZ2luLWxlZnQ6IDRweDsKCQltYXJnaW4tcmlnaHQ6IDRweDsKCQl9CgoJCS5mbS1idXR0b24taWNvbi1yaWdodCB7CgkJbWFyZ2luLWxlZnQ6IDRweDsKCQltYXJnaW4tcmlnaHQ6IDRweDsKCQl9CgoJCS5mbS1idXR0b24taWNvbi1sZWZ0IHt9CgoJCS5mbS1idXR0b24taWNvbi1yaWdodCB7fQoKCQkjbkRhdGEsCgkJI3BEYXRhIHsKCQltYXJnaW4tbGVmdDogNHB4OwoJCW1hcmdpbi1yaWdodDogNHB4OwoJCX0KCgkJI3NEYXRhIHNwYW4sCgkJI2NEYXRhIHNwYW4gewoJCW1hcmdpbi1sZWZ0OiA1cHg7CgkJfQoJCS8qIEVuZCBFb3JtIGVkaXQgKi8KCQkvKi51aS1qcWdyaWQgLmVkaXQtY2VsbCB7fSovCgoJCS51aS1qcWdyaWQgLnNlbGVjdGVkLXJvdywKCQlkaXYudWktanFncmlkIC5zZWxlY3RlZC1yb3cgdGQgewoJCWZvbnQtc3R5bGU6IG5vcm1hbDsKCQl9CgkJLyogaW5saW5lIGVkaXQgYWN0aW9ucyBidXR0b24qLwoKCQkudWktaW5saW5lLWRlbCwKCQkudWktaW5saW5lLWNhbmNlbCB7CgkJbWFyZ2luLWxlZnQ6IDE0cHg7CgkJfQoKCQkudWktanFncmlkIC5pbmxpbmUtZWRpdC1jZWxsIHt9CgkJLyogVHJlZSBHcmlkICovCgoJCS51aS1qcWdyaWQgLnRyZWUtd3JhcCB7CgkJZmxvYXQ6IGxlZnQ7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWhlaWdodDogMThweDsKCQl3aGl0ZS1zcGFjZTogbm93cmFwOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJfQoKCQkudWktanFncmlkIC50cmVlLW1pbnVzIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJaGVpZ2h0OiAxOHB4OwoJCXdpZHRoOiAxOHB4OwoJCW92ZXJmbG93OiBoaWRkZW47CgkJfQoKCQkudWktanFncmlkIC50cmVlLXBsdXMgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQloZWlnaHQ6IDE4cHg7CgkJd2lkdGg6IDE4cHg7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQl9CgoJCS51aS1qcWdyaWQgLnRyZWUtbGVhZiB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCWhlaWdodDogMThweDsKCQl3aWR0aDogMThweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCX0KCgkJLnVpLWpxZ3JpZCAudHJlZWNsaWNrIHsKCQljdXJzb3I6IHBvaW50ZXI7CgkJfQoJCS8qIG1vZGEgZGlhbG9nICovCgoJCSogaWZyYW1lLmpxbSB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXRvcDogMDsKCQlsZWZ0OiAwOwoJCXotaW5kZXg6IC0xOwoJCX0KCQkvKgkgd2lkdGg6IGV4cHJlc3Npb24odGhpcy5wYXJlbnROb2RlLm9mZnNldFdpZHRoKydweCcpO2hlaWdodDogZXhwcmVzc2lvbih0aGlzLnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0KydweCcpO30qLwoKCQkudWktanFncmlkLWRuZCB0ciB0ZCB7CgkJYm9yZGVyLXJpZ2h0LXdpZHRoOiAxcHg7CgkJYm9yZGVyLXJpZ2h0LWNvbG9yOiBpbmhlcml0OwoJCWJvcmRlci1yaWdodC1zdHlsZTogc29saWQ7CgkJaGVpZ2h0OiAyMHB4CgkJfQoJCS8qIFJUTCBTdXBwb3J0ICovCgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1jYXB0aW9uLXJ0bCB7CgkJdGV4dC1hbGlnbjogcmlnaHQ7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtaGJveC1ydGwgewoJCWZsb2F0OiByaWdodDsKCQlwYWRkaW5nLWxlZnQ6IDIwcHg7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcmVzaXplLWx0ciB7CgkJZmxvYXQ6IHJpZ2h0OwoJCW1hcmdpbjogLTJweCAtMnB4IC0ycHggMDsKCQloZWlnaHQ6IDEwMCU7CgkJfQoKCQkudWktanFncmlkIC51aS1qcWdyaWQtcmVzaXplLXJ0bCB7CgkJZmxvYXQ6IGxlZnQ7CgkJbWFyZ2luOiAtMnB4IC0ycHggLTJweCAtMHB4OwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktc29ydC1ydGwge30KCgkJLnVpLWpxZ3JpZCAudHJlZS13cmFwLWx0ciB7CgkJZmxvYXQ6IGxlZnQ7CgkJfQoKCQkudWktanFncmlkIC50cmVlLXdyYXAtcnRsIHsKCQlmbG9hdDogcmlnaHQ7CgkJfQoKCQkudWktanFncmlkIC51aS1lbGxpcHNpcyB7CgkJLW1vei10ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQl9CgkJLyogVG9vbGJhciBTZWFyY2ggTWVudS4gTmF2IG1lbnUgKi8KCgkJLnVpLXNlYXJjaC1tZW51LAoJCS51aS1uYXYtbWVudSB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXBhZGRpbmc6IDJweCA1cHg7CgkJei1pbmRleDogOTk5OTk7CgkJfQoKCQkudWktc2VhcmNoLW1lbnUudWktbWVudSAudWktbWVudS1pdGVtLAoJCS51aS1uYXYtbWVudS51aS1tZW51IC51aS1tZW51LWl0ZW0gewoJCWxpc3Qtc3R5bGUtaW1hZ2U6IG5vbmU7CgkJcGFkZGluZy1yaWdodDogMDsKCQlwYWRkaW5nLWxlZnQ6IDA7CgkJfQoKCQkudWktc2VhcmNoLW1lbnUudWktbWVudSAudWktbWVudS1pdGVtIGEsCgkJLnVpLW5hdi1tZW51LnVpLW1lbnUgLnVpLW1lbnUtaXRlbSBhIHsKCQlkaXNwbGF5OiBibG9jazsKCQl9CgoJCS51aS1zZWFyY2gtbWVudS51aS1tZW51IC51aS1tZW51LWl0ZW0gYS5nLW1lbnUtaXRlbTpob3ZlciwKCQkudWktbmF2LW1lbnUudWktbWVudSAudWktbWVudS1pdGVtIGEuZy1tZW51LWl0ZW06aG92ZXIgewoJCW1hcmdpbjogLTFweDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCX0KCgkJLnVpLWpxZ3JpZCAudWktc2VhcmNoLXRhYmxlIHsKCQlwYWRkaW5nOiAwOwoJCWJvcmRlcjogMCBub25lOwoJCWhlaWdodDogMjBweDsKCQl3aWR0aDogMTAwJTsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLXNlYXJjaC10YWJsZSAudWktc2VhcmNoLW9wZXIgewoJCXdpZHRoOiAyMHB4OwoJCX0KCgkJYS5nLW1lbnUtaXRlbSwKCQlhLnNvcHRjbGFzcywKCQlhLmNsZWFyc2VhcmNoY2xhc3MgewoJCWN1cnNvcjogcG9pbnRlcjsKCQl9CgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC12aWV3IGlucHV0LAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC12aWV3IHNlbGVjdCwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdmlldyB0ZXh0YXJlYSwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdmlldyBidXR0b24gewoJCS8qZm9udC1zaXplOiAxMXB4Ki8KCQl9CgoJCS51aS1qcWdyaWQgLnVpLXNjcm9sbC1wb3B1cCB7CgkJd2lkdGg6IDEwMHB4OwoJCX0KCgkJLnVpLXNlYXJjaC10YWJsZSBzZWxlY3QsCgkJLnVpLXNlYXJjaC10YWJsZSBpbnB1dCB7CgkJcGFkZGluZzogNHB4IDNweDsKCQl9CgoJCS51aS1kaXNhYmxlZCB7CgkJb3BhY2l0eTogLjM1OwoJCWZpbHRlcjogQWxwaGEoT3BhY2l0eT0zNSk7CgkJLyogc3VwcG9ydDogSUU4ICovCgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKCQl9CgoJCS51aS1vdmVybGF5IHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJdG9wOiAwOwoJCWxlZnQ6IDA7CgkJd2lkdGg6IDEwMCU7CgkJaGVpZ2h0OiAxMDAlOwoJCWJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41KTsKCQlvcGFjaXR5OiAuMzsKCQlmaWx0ZXI6IEFscGhhKE9wYWNpdHk9MzApOwoJCS8qIHN1cHBvcnQ6IElFOCAqLwoJCX0KCgkJLnVpLWpxZ3JpZC1wYWdlciAudWktcGctdGFibGUgLnVpLXBnLWJ1dHRvbjpob3ZlciwKCQkudWktanFncmlkLXRvcHBhZ2VyIC51aS1wZy10YWJsZSAudWktcGctYnV0dG9uOmhvdmVyIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGRkOwoJCX0KCgkJLnVpLWpxZ3JpZC1jb3JuZXIgewoJCWJvcmRlci1yYWRpdXM6IDVweAoJCX0KCgkJLnVpLXJlc2l6YWJsZS1oYW5kbGUgewoJCS8qcG9zaXRpb246IGFic29sdXRlOyovCgkJZGlzcGxheTogYmxvY2s7CgkJbGVmdDogOTclOwoJCX0KCgkJLnVpLWpxZGlhbG9nIC51aS1yZXNpemFibGUtc2UgewoJCXdpZHRoOiAxMnB4OwoJCWhlaWdodDogMTJweDsKCQlyaWdodDogLTVweDsKCQlib3R0b206IC01cHg7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMTZweCAxNnB4OwoJCX0KCgkJLnVpLXJlc2l6YWJsZS1zZSB7CgkJY3Vyc29yOiBzZS1yZXNpemU7CgkJd2lkdGg6IDEycHg7CgkJaGVpZ2h0OiAxMnB4OwoJCXJpZ2h0OiAxcHg7CgkJYm90dG9tOiAxcHg7CgkJfQoKCQkudWktdG9wLWNvcm5lciB7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNXB4OwoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiA1cHg7CgkJfQoKCQkudWktYm90dG9tLWNvcm5lciB7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7CgkJfQoKCQkudWktc2VhcmNoLXRhYmxlIHsKCQltYXJnaW4tYm90dG9tOiAwOwoJCX0KCgkJLnVpLXNlYXJjaC10YWJsZSAuY29sdW1ucywKCQkudWktc2VhcmNoLXRhYmxlIC5vcGVyYXRvcnMgewoJCXBhZGRpbmctcmlnaHQ6IDVweDsKCQl9CgoJCS5vcHNlbCB7CgkJZmxvYXQ6IGxlZnQ7CgkJd2lkdGg6IDEwMHB4OwoJCW1hcmdpbi1yaWdodDogNXB4OwoJCX0KCgkJLmFkZC1ncm91cCwKCQkuYWRkLXJ1bGUsCgkJLmRlbGV0ZS1ncm91cCB7CgkJd2lkdGg6IDE0JTsKCQltYXJnaW4tcmlnaHQ6IDVweDsKCQl9CgoJCS5kZWxldGUtcnVsZSB7CgkJd2lkdGg6IDE1cHg7CgkJfQoKCQl1bC51aS1zZWFyY2gtbWVudSwKCQl1bC51aS1uYXYtbWVudSB7CgkJbGlzdC1zdHlsZS10eXBlOiBub25lOwoJCX0KCgkJdWwudWktc2VhcmNoLW1lbnUgbGkgYSwKCQl1bC51aS1uYXYtbWVudSBsaSBhLAoJCS5zb3B0Y2xhc3MsCgkJLmNsZWFyc2VhcmNoY2xhc3MgewoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQljb2xvcjogIzAxMDEwMTsKCQl9CgoJCXVsLnVpLXNlYXJjaC1tZW51IGxpIGE6aG92ZXIsCgkJdWwudWktbmF2LW1lbnUgbGkgYTpob3ZlciwKCQlhLnNvcHRjbGFzczpob3ZlciwKCQlhLmNsZWFyc2VhcmNoY2xhc3M6aG92ZXIgewoJCWJhY2tncm91bmQtY29sb3I6ICNkZGQ7CgkJcGFkZGluZzogMXB4IDFweDsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJfQoKCQl1bC51aS1zZWFyY2gtbWVudSBsaSwKCQl1bC51aS1uYXYtbWVudSBsaSB7CgkJcGFkZGluZzogNXB4IDVweDsKCQl9CgoJCS51aS1tZW51LWl0ZW0gaHIgewoJCW1hcmdpbi1ib3R0b206IDBweDsKCQltYXJnaW4tdG9wOiAwcHg7CgkJfQoKCQkuc2VhcmNoRmlsdGVyIC51aS1zZWFyY2gtdGFibGUgdGQsCgkJLnNlYXJjaEZpbHRlciAudWktc2VhcmNoLXRhYmxlIHRoIHsKCQlib3JkZXItdG9wOiAwcHggbm9uZSAhaW1wb3J0YW50OwoJCX0KCgkJLnNlYXJjaEZpbHRlciAucXVlcnlyZXN1bHQgewoJCW1hcmdpbi1ib3R0b206IDVweDsKCQl9CgoJCS5zZWFyY2hGaWx0ZXIgLnF1ZXJ5cmVzdWx0IHRyIHRkIHsKCQlib3JkZXItdG9wOiAwcHggbm9uZTsKCQl9CgoJCS51aS1zZWFyY2gtbGFiZWwgewoJCXBhZGRpbmctbGVmdDogNXB4OwoJCX0KCgkJLmZyb3plbi1kaXYsCgkJLmZyb3plbi1iZGl2IHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwoJCX0KCQkvKgoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1jYXB0aW9uLAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1wYWdlciwKCQkudWktanFncmlkIC51aS1qcWdyaWQtdG9wcGFnZXIsCgkJLnVpLWpxZ3JpZCAudWktanFncmlkLWh0YWJsZSB0aGVhZCB0aCwKCQkudWktanFncmlkIC51aS11c2VyZGF0YS10b3AsCgkJLnVpLWpxZ3JpZCAudWktdXNlcmRhdGEtYm90dG9tLAoJCS51aS1qcWdyaWQgLnVpLWpxZ3JpZC1oZGl2LAoJCS51aS1qcWRpYWxvZyAudWktanFkaWFsb2ctdGl0bGViYXIKCQl7CgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZSwgbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZiAwcHgsICNlMGUwZTAgMTAwJSk7CgkJYmFja2dyb3VuZC1yZXBlYXQ6IHJlcGVhdC14OwoJCWJvcmRlci1jb2xvcjogI2NjYzsKCQl0ZXh0LXNoYWRvdzogMCAxcHggMCAjZmZmOwoJCX0KCQkqLwoKCQlAaW1wb3J0IHVybCgiLy9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PU5ld3MrQ3ljbGU6NDAwLDcwMCIpOwoJCS8qIQoJCSogQm9vdHN0cmFwIHYzLjAuMAoJCSoKCQkqIENvcHlyaWdodCAyMDEzIFR3aXR0ZXIsIEluYwoJCSogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlIHYyLjAKCQkqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCSoKCQkqIERlc2lnbmVkIGFuZCBidWlsdCB3aXRoIGFsbCB0aGUgbG92ZSBpbiB0aGUgd29ybGQgYnkgQG1kbyBhbmQgQGZhdC4KCQkqLwoJCS8qISBub3JtYWxpemUuY3NzIHYyLjEuMCB8IE1JVCBMaWNlbnNlIHwgZ2l0LmlvL25vcm1hbGl6ZSAqLwoKCQlhcnRpY2xlLAoJCWFzaWRlLAoJCWRldGFpbHMsCgkJZmlnY2FwdGlvbiwKCQlmaWd1cmUsCgkJZm9vdGVyLAoJCWhlYWRlciwKCQloZ3JvdXAsCgkJbWFpbiwKCQluYXYsCgkJc2VjdGlvbiwKCQlzdW1tYXJ5IHsKCQlkaXNwbGF5OiBibG9jawoJCX0KCgkJYXVkaW8sCgkJY2FudmFzLAoJCXZpZGVvIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2sKCQl9CgoJCWF1ZGlvOm5vdChbY29udHJvbHNdKSB7CgkJZGlzcGxheTogbm9uZTsKCQloZWlnaHQ6IDAKCQl9CgoJCVtoaWRkZW5dIHsKCQlkaXNwbGF5OiBub25lCgkJfQoKCQlodG1sIHsKCQlmb250LWZhbWlseTogc2Fucy1zZXJpZjsKCQktd2Via2l0LXRleHQtc2l6ZS1hZGp1c3Q6IDEwMCU7CgkJLW1zLXRleHQtc2l6ZS1hZGp1c3Q6IDEwMCUKCQl9CgoJCWJvZHkgewoJCW1hcmdpbjogMAoJCX0KCgkJYTpmb2N1cyB7CgkJb3V0bGluZTogdGhpbiBkb3R0ZWQKCQl9CgoJCWE6YWN0aXZlLAoJCWE6aG92ZXIgewoJCW91dGxpbmU6IDAKCQl9CgoJCWgxIHsKCQltYXJnaW46IC42N2VtIDA7CgkJZm9udC1zaXplOiAyZW0KCQl9CgoJCWFiYnJbdGl0bGVdIHsKCQlib3JkZXItYm90dG9tOiAxcHggZG90dGVkCgkJfQoKCQliLAoJCXN0cm9uZyB7CgkJZm9udC13ZWlnaHQ6IGJvbGQKCQl9CgoJCWRmbiB7CgkJZm9udC1zdHlsZTogaXRhbGljCgkJfQoKCQlociB7CgkJaGVpZ2h0OiAwOwoJCS1tb3otYm94LXNpemluZzogY29udGVudC1ib3g7CgkJYm94LXNpemluZzogY29udGVudC1ib3gKCQl9CgoJCW1hcmsgewoJCWNvbG9yOiAjMDAwOwoJCWJhY2tncm91bmQ6ICNmZjAKCQl9CgoJCWNvZGUsCgkJa2JkLAoJCXByZSwKCQlzYW1wIHsKCQlmb250LWZhbWlseTogbW9ub3NwYWNlLCBzZXJpZjsKCQlmb250LXNpemU6IDFlbQoJCX0KCgkJcHJlIHsKCQl3aGl0ZS1zcGFjZTogcHJlLXdyYXAKCQl9CgoJCXEgewoJCXF1b3RlczogIlwyMDFDIiAiXDIwMUQiICJcMjAxOCIgIlwyMDE5IgoJCX0KCgkJc21hbGwgewoJCWZvbnQtc2l6ZTogODAlCgkJfQoKCQlzdWIsCgkJc3VwIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJZm9udC1zaXplOiA3NSU7CgkJbGluZS1oZWlnaHQ6IDA7CgkJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lCgkJfQoKCQlzdXAgewoJCXRvcDogLTAuNWVtCgkJfQoKCQlzdWIgewoJCWJvdHRvbTogLTAuMjVlbQoJCX0KCgkJaW1nIHsKCQlib3JkZXI6IDAKCQl9CgoJCXN2Zzpub3QoOnJvb3QpIHsKCQlvdmVyZmxvdzogaGlkZGVuCgkJfQoKCQlmaWd1cmUgewoJCW1hcmdpbjogMAoJCX0KCgkJZmllbGRzZXQgewoJCXBhZGRpbmc6IC4zNWVtIC42MjVlbSAuNzVlbTsKCQltYXJnaW46IDAgMnB4OwoJCWJvcmRlcjogMXB4IHNvbGlkICNjMGMwYzAKCQl9CgoJCWxlZ2VuZCB7CgkJcGFkZGluZzogMDsKCQlib3JkZXI6IDAKCQl9CgoJCWJ1dHRvbiwKCQlpbnB1dCwKCQlzZWxlY3QsCgkJdGV4dGFyZWEgewoJCW1hcmdpbjogMDsKCQlmb250LWZhbWlseTogaW5oZXJpdDsKCQlmb250LXNpemU6IDEwMCUKCQl9CgoJCWJ1dHRvbiwKCQlpbnB1dCB7CgkJbGluZS1oZWlnaHQ6IG5vcm1hbAoJCX0KCgkJYnV0dG9uLAoJCXNlbGVjdCB7CgkJdGV4dC10cmFuc2Zvcm06IG5vbmUKCQl9CgoJCWJ1dHRvbiwKCQlodG1sIGlucHV0W3R5cGU9ImJ1dHRvbiJdLAoJCWlucHV0W3R5cGU9InJlc2V0Il0sCgkJaW5wdXRbdHlwZT0ic3VibWl0Il0gewoJCWN1cnNvcjogcG9pbnRlcjsKCQktd2Via2l0LWFwcGVhcmFuY2U6IGJ1dHRvbgoJCX0KCgkJYnV0dG9uW2Rpc2FibGVkXSwKCQlodG1sIGlucHV0W2Rpc2FibGVkXSB7CgkJY3Vyc29yOiBkZWZhdWx0CgkJfQoKCQlpbnB1dFt0eXBlPSJjaGVja2JveCJdLAoJCWlucHV0W3R5cGU9InJhZGlvIl0gewoJCXBhZGRpbmc6IDA7CgkJYm94LXNpemluZzogYm9yZGVyLWJveAoJCX0KCgkJaW5wdXRbdHlwZT0ic2VhcmNoIl0gewoJCS13ZWJraXQtYm94LXNpemluZzogY29udGVudC1ib3g7CgkJLW1vei1ib3gtc2l6aW5nOiBjb250ZW50LWJveDsKCQlib3gtc2l6aW5nOiBjb250ZW50LWJveDsKCQktd2Via2l0LWFwcGVhcmFuY2U6IHRleHRmaWVsZAoJCX0KCgkJaW5wdXRbdHlwZT0ic2VhcmNoIl06Oi13ZWJraXQtc2VhcmNoLWNhbmNlbC1idXR0b24sCgkJaW5wdXRbdHlwZT0ic2VhcmNoIl06Oi13ZWJraXQtc2VhcmNoLWRlY29yYXRpb24gewoJCS13ZWJraXQtYXBwZWFyYW5jZTogbm9uZQoJCX0KCgkJYnV0dG9uOjotbW96LWZvY3VzLWlubmVyLAoJCWlucHV0OjotbW96LWZvY3VzLWlubmVyIHsKCQlwYWRkaW5nOiAwOwoJCWJvcmRlcjogMAoJCX0KCgkJdGV4dGFyZWEgewoJCW92ZXJmbG93OiBhdXRvOwoJCXZlcnRpY2FsLWFsaWduOiB0b3AKCQl9CgoJCXRhYmxlIHsKCQlib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwoJCWJvcmRlci1zcGFjaW5nOiAwCgkJfQoKCQlAbWVkaWEgcHJpbnQgewoJCSogewoJCWNvbG9yOiAjMDAwIWltcG9ydGFudDsKCQl0ZXh0LXNoYWRvdzogbm9uZSFpbXBvcnRhbnQ7CgkJYmFja2dyb3VuZDogdHJhbnNwYXJlbnQhaW1wb3J0YW50OwoJCWJveC1zaGFkb3c6IG5vbmUhaW1wb3J0YW50CgkJfQoJCWEsCgkJYTp2aXNpdGVkIHsKCQl0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZQoJCX0KCQlhW2hyZWZdOmFmdGVyIHsKCQljb250ZW50OiAiICgiIGF0dHIoaHJlZikgIikiCgkJfQoJCWFiYnJbdGl0bGVdOmFmdGVyIHsKCQljb250ZW50OiAiICgiIGF0dHIodGl0bGUpICIpIgoJCX0KCQkuaXIgYTphZnRlciwKCQlhW2hyZWZePSJqYXZhc2NyaXB0OiJdOmFmdGVyLAoJCWFbaHJlZl49IiMiXTphZnRlciB7CgkJY29udGVudDogIiIKCQl9CgkJcHJlLAoJCWJsb2NrcXVvdGUgewoJCWJvcmRlcjogMXB4IHNvbGlkICM5OTk7CgkJcGFnZS1icmVhay1pbnNpZGU6IGF2b2lkCgkJfQoJCXRoZWFkIHsKCQlkaXNwbGF5OiB0YWJsZS1oZWFkZXItZ3JvdXAKCQl9CgkJdHIsCgkJaW1nIHsKCQlwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQKCQl9CgkJaW1nIHsKCQltYXgtd2lkdGg6IDEwMCUhaW1wb3J0YW50CgkJfQoJCUBwYWdlIHsKCQltYXJnaW46IDJjbSAuNWNtCgkJfQoJCXAsCgkJaDIsCgkJaDMgewoJCW9ycGhhbnM6IDM7CgkJd2lkb3dzOiAzCgkJfQoJCWgyLAoJCWgzIHsKCQlwYWdlLWJyZWFrLWFmdGVyOiBhdm9pZAoJCX0KCQkubmF2YmFyIHsKCQlkaXNwbGF5OiBub25lCgkJfQoJCS50YWJsZSB0ZCwKCQkudGFibGUgdGggewoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYhaW1wb3J0YW50CgkJfQoJCS5idG4+LmNhcmV0LAoJCS5kcm9wdXA+LmJ0bj4uY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICMwMDAhaW1wb3J0YW50CgkJfQoJCS5sYWJlbCB7CgkJYm9yZGVyOiAxcHggc29saWQgIzAwMAoJCX0KCQkudGFibGUgewoJCWJvcmRlci1jb2xsYXBzZTogY29sbGFwc2UhaW1wb3J0YW50CgkJfQoJCS50YWJsZS1ib3JkZXJlZCB0aCwKCQkudGFibGUtYm9yZGVyZWQgdGQgewoJCWJvcmRlcjogMXB4IHNvbGlkICNkZGQhaW1wb3J0YW50CgkJfQoJCX0KCgkJKiwKCQkqOmJlZm9yZSwKCQkqOmFmdGVyIHsKCQktd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7CgkJLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94OwoJCWJveC1zaXppbmc6IGJvcmRlci1ib3gKCQl9CgoJCWh0bWwgewoJCWZvbnQtc2l6ZTogNjIuNSU7CgkJLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDApCgkJfQoKCQlib2R5IHsKCQlmb250LWZhbWlseTogR2VvcmdpYSwgIlRpbWVzIE5ldyBSb21hbiIsIFRpbWVzLCBzZXJpZjsKCQlmb250LXNpemU6IDE1cHg7CgkJbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDI5OwoJCWNvbG9yOiAjNzc3OwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYKCQl9CgoJCWlucHV0LAoJCWJ1dHRvbiwKCQlzZWxlY3QsCgkJdGV4dGFyZWEgewoJCWZvbnQtZmFtaWx5OiBpbmhlcml0OwoJCWZvbnQtc2l6ZTogaW5oZXJpdDsKCQlsaW5lLWhlaWdodDogaW5oZXJpdAoJCX0KCgkJYnV0dG9uLAoJCWlucHV0LAoJCXNlbGVjdFttdWx0aXBsZV0sCgkJdGV4dGFyZWEgewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmUKCQl9CgoJCWEgewoJCWNvbG9yOiAjZWI2ODY0OwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZQoJCX0KCgkJYTpob3ZlciwKCQlhOmZvY3VzIHsKCQljb2xvcjogI2UyMjYyMDsKCQl0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZQoJCX0KCgkJYTpmb2N1cyB7CgkJb3V0bGluZTogdGhpbiBkb3R0ZWQgIzMzMzsKCQlvdXRsaW5lOiA1cHggYXV0byAtd2Via2l0LWZvY3VzLXJpbmctY29sb3I7CgkJb3V0bGluZS1vZmZzZXQ6IC0ycHgKCQl9CgoJCWltZyB7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZQoJCX0KCgkJLmltZy1yZXNwb25zaXZlIHsKCQlkaXNwbGF5OiBibG9jazsKCQloZWlnaHQ6IGF1dG87CgkJbWF4LXdpZHRoOiAxMDAlCgkJfQoKCQkuaW1nLXJvdW5kZWQgewoJCWJvcmRlci1yYWRpdXM6IDZweAoJCX0KCgkJLmltZy10aHVtYm5haWwgewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQloZWlnaHQ6IGF1dG87CgkJbWF4LXdpZHRoOiAxMDAlOwoJCXBhZGRpbmc6IDRweDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCQlib3JkZXI6IDFweCBzb2xpZCAjZGRkOwoJCWJvcmRlci1yYWRpdXM6IDRweDsKCQktd2Via2l0LXRyYW5zaXRpb246IGFsbCAuMnMgZWFzZS1pbi1vdXQ7CgkJdHJhbnNpdGlvbjogYWxsIC4ycyBlYXNlLWluLW91dAoJCX0KCgkJLmltZy1jaXJjbGUgewoJCWJvcmRlci1yYWRpdXM6IDUwJQoJCX0KCgkJaHIgewoJCW1hcmdpbi10b3A6IDIxcHg7CgkJbWFyZ2luLWJvdHRvbTogMjFweDsKCQlib3JkZXI6IDA7CgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWUKCQl9CgoJCS5zci1vbmx5IHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IDFweDsKCQloZWlnaHQ6IDFweDsKCQlwYWRkaW5nOiAwOwoJCW1hcmdpbjogLTFweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCWNsaXA6IHJlY3QoMCAwIDAgMCk7CgkJYm9yZGVyOiAwCgkJfQoKCQlwIHsKCQltYXJnaW46IDAgMCAxMC41cHgKCQl9CgoJCS5sZWFkIHsKCQltYXJnaW4tYm90dG9tOiAyMXB4OwoJCWZvbnQtc2l6ZTogMTcuMjVweDsKCQlmb250LXdlaWdodDogMjAwOwoJCWxpbmUtaGVpZ2h0OiAxLjQKCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIHsKCQkubGVhZCB7CgkJZm9udC1zaXplOiAyMi41cHgKCQl9CgkJfQoKCQlzbWFsbCB7CgkJZm9udC1zaXplOiA4NSUKCQl9CgoJCWNpdGUgewoJCWZvbnQtc3R5bGU6IG5vcm1hbAoJCX0KCgkJLnRleHQtbXV0ZWQgewoJCWNvbG9yOiAjOTk5CgkJfQoKCQkudGV4dC1wcmltYXJ5IHsKCQljb2xvcjogI2ViNjg2NAoJCX0KCgkJLnRleHQtd2FybmluZyB7CgkJY29sb3I6ICNjMDk4NTMKCQl9CgoJCS50ZXh0LWRhbmdlciB7CgkJY29sb3I6ICNiOTRhNDgKCQl9CgoJCS50ZXh0LXN1Y2Nlc3MgewoJCWNvbG9yOiAjNDY4ODQ3CgkJfQoKCQkudGV4dC1pbmZvIHsKCQljb2xvcjogIzNhODdhZAoJCX0KCgkJLnRleHQtbGVmdCB7CgkJdGV4dC1hbGlnbjogbGVmdAoJCX0KCgkJLnRleHQtcmlnaHQgewoJCXRleHQtYWxpZ246IHJpZ2h0CgkJfQoKCQkudGV4dC1jZW50ZXIgewoJCXRleHQtYWxpZ246IGNlbnRlcgoJCX0KCgkJaDEsCgkJaDIsCgkJaDMsCgkJaDQsCgkJaDUsCgkJaDYsCgkJLmgxLAoJCS5oMiwKCQkuaDMsCgkJLmg0LAoJCS5oNSwKCQkuaDYgewoJCWZvbnQtZmFtaWx5OiBHZW9yZ2lhLCAiVGltZXMgTmV3IFJvbWFuIiwgVGltZXMsIHNlcmlmOwoJCWZvbnQtd2VpZ2h0OiA1MDA7CgkJbGluZS1oZWlnaHQ6IDEuMQoJCX0KCgkJaDEgc21hbGwsCgkJaDIgc21hbGwsCgkJaDMgc21hbGwsCgkJaDQgc21hbGwsCgkJaDUgc21hbGwsCgkJaDYgc21hbGwsCgkJLmgxIHNtYWxsLAoJCS5oMiBzbWFsbCwKCQkuaDMgc21hbGwsCgkJLmg0IHNtYWxsLAoJCS5oNSBzbWFsbCwKCQkuaDYgc21hbGwgewoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJbGluZS1oZWlnaHQ6IDE7CgkJY29sb3I6ICM5OTkKCQl9CgoJCWgxLAoJCWgyLAoJCWgzIHsKCQltYXJnaW4tdG9wOiAyMXB4OwoJCW1hcmdpbi1ib3R0b206IDEwLjVweAoJCX0KCgkJaDQsCgkJaDUsCgkJaDYgewoJCW1hcmdpbi10b3A6IDEwLjVweDsKCQltYXJnaW4tYm90dG9tOiAxMC41cHgKCQl9CgoJCWgxLAoJCS5oMSB7CgkJZm9udC1zaXplOiAzOXB4CgkJfQoKCQloMiwKCQkuaDIgewoJCWZvbnQtc2l6ZTogMzJweAoJCX0KCgkJaDMsCgkJLmgzIHsKCQlmb250LXNpemU6IDI2cHgKCQl9CgoJCWg0LAoJCS5oNCB7CgkJZm9udC1zaXplOiAxOXB4CgkJfQoKCQloNSwKCQkuaDUgewoJCWZvbnQtc2l6ZTogMTVweAoJCX0KCgkJaDYsCgkJLmg2IHsKCQlmb250LXNpemU6IDEzcHgKCQl9CgoJCWgxIHNtYWxsLAoJCS5oMSBzbWFsbCB7CgkJZm9udC1zaXplOiAyNnB4CgkJfQoKCQloMiBzbWFsbCwKCQkuaDIgc21hbGwgewoJCWZvbnQtc2l6ZTogMTlweAoJCX0KCgkJaDMgc21hbGwsCgkJLmgzIHNtYWxsLAoJCWg0IHNtYWxsLAoJCS5oNCBzbWFsbCB7CgkJZm9udC1zaXplOiAxNXB4CgkJfQoKCQkucGFnZS1oZWFkZXIgewoJCXBhZGRpbmctYm90dG9tOiA5LjVweDsKCQltYXJnaW46IDQycHggMCAyMXB4OwoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlCgkJfQoKCQl1bCwKCQlvbCB7CgkJbWFyZ2luLXRvcDogMDsKCQltYXJnaW4tYm90dG9tOiAxMC41cHgKCQl9CgoJCXVsIHVsLAoJCW9sIHVsLAoJCXVsIG9sLAoJCW9sIG9sIHsKCQltYXJnaW4tYm90dG9tOiAwCgkJfQoKCQkubGlzdC11bnN0eWxlZCB7CgkJcGFkZGluZy1sZWZ0OiAwOwoJCWxpc3Qtc3R5bGU6IG5vbmUKCQl9CgoJCS5saXN0LWlubGluZSB7CgkJcGFkZGluZy1sZWZ0OiAwOwoJCWxpc3Qtc3R5bGU6IG5vbmUKCQl9CgoJCS5saXN0LWlubGluZT5saSB7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCXBhZGRpbmctcmlnaHQ6IDVweDsKCQlwYWRkaW5nLWxlZnQ6IDVweAoJCX0KCgkJZGwgewoJCW1hcmdpbi1ib3R0b206IDIxcHgKCQl9CgoJCWR0LAoJCWRkIHsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0MjkKCQl9CgoJCWR0IHsKCQlmb250LXdlaWdodDogYm9sZAoJCX0KCgkJZGQgewoJCW1hcmdpbi1sZWZ0OiAwCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLmRsLWhvcml6b250YWwgZHQgewoJCWZsb2F0OiBsZWZ0OwoJCXdpZHRoOiAxNjBweDsKCQlvdmVyZmxvdzogaGlkZGVuOwoJCWNsZWFyOiBsZWZ0OwoJCXRleHQtYWxpZ246IHJpZ2h0OwoJCXRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwoJCXdoaXRlLXNwYWNlOiBub3dyYXAKCQl9CgkJLmRsLWhvcml6b250YWwgZGQgewoJCW1hcmdpbi1sZWZ0OiAxODBweAoJCX0KCQkuZGwtaG9yaXpvbnRhbCBkZDpiZWZvcmUsCgkJLmRsLWhvcml6b250YWwgZGQ6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCQkuZGwtaG9yaXpvbnRhbCBkZDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgkJLmRsLWhvcml6b250YWwgZGQ6YmVmb3JlLAoJCS5kbC1ob3Jpem9udGFsIGRkOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgkJLmRsLWhvcml6b250YWwgZGQ6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoJCS5kbC1ob3Jpem9udGFsIGRkOmJlZm9yZSwKCQkuZGwtaG9yaXpvbnRhbCBkZDphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoJCS5kbC1ob3Jpem9udGFsIGRkOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCQkuZGwtaG9yaXpvbnRhbCBkZDpiZWZvcmUsCgkJLmRsLWhvcml6b250YWwgZGQ6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCQkuZGwtaG9yaXpvbnRhbCBkZDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgkJLmRsLWhvcml6b250YWwgZGQ6YmVmb3JlLAoJCS5kbC1ob3Jpem9udGFsIGRkOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgkJLmRsLWhvcml6b250YWwgZGQ6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoJCX0KCgkJYWJiclt0aXRsZV0sCgkJYWJicltkYXRhLW9yaWdpbmFsLXRpdGxlXSB7CgkJY3Vyc29yOiBoZWxwOwoJCWJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQgIzk5OQoJCX0KCgkJYWJici5pbml0aWFsaXNtIHsKCQlmb250LXNpemU6IDkwJTsKCQl0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlCgkJfQoKCQlibG9ja3F1b3RlIHsKCQlwYWRkaW5nOiAxMC41cHggMjFweDsKCQltYXJnaW46IDAgMCAyMXB4OwoJCWJvcmRlci1sZWZ0OiA1cHggc29saWQgI2VlZQoJCX0KCgkJYmxvY2txdW90ZSBwIHsKCQlmb250LXNpemU6IDE4Ljc1cHg7CgkJZm9udC13ZWlnaHQ6IDMwMDsKCQlsaW5lLWhlaWdodDogMS4yNQoJCX0KCgkJYmxvY2txdW90ZSBwOmxhc3QtY2hpbGQgewoJCW1hcmdpbi1ib3R0b206IDAKCQl9CgoJCWJsb2NrcXVvdGUgc21hbGwgewoJCWRpc3BsYXk6IGJsb2NrOwoJCWxpbmUtaGVpZ2h0OiAxLjQyODU3MTQyOTsKCQljb2xvcjogIzk5OQoJCX0KCgkJYmxvY2txdW90ZSBzbWFsbDpiZWZvcmUgewoJCWNvbnRlbnQ6ICdcMjAxNCBcMDBBMCcKCQl9CgoJCWJsb2NrcXVvdGUucHVsbC1yaWdodCB7CgkJcGFkZGluZy1yaWdodDogMTVweDsKCQlwYWRkaW5nLWxlZnQ6IDA7CgkJYm9yZGVyLXJpZ2h0OiA1cHggc29saWQgI2VlZTsKCQlib3JkZXItbGVmdDogMAoJCX0KCgkJYmxvY2txdW90ZS5wdWxsLXJpZ2h0IHAsCgkJYmxvY2txdW90ZS5wdWxsLXJpZ2h0IHNtYWxsIHsKCQl0ZXh0LWFsaWduOiByaWdodAoJCX0KCgkJYmxvY2txdW90ZS5wdWxsLXJpZ2h0IHNtYWxsOmJlZm9yZSB7CgkJY29udGVudDogJycKCQl9CgoJCWJsb2NrcXVvdGUucHVsbC1yaWdodCBzbWFsbDphZnRlciB7CgkJY29udGVudDogJ1wwMEEwIFwyMDE0JwoJCX0KCgkJcTpiZWZvcmUsCgkJcTphZnRlciwKCQlibG9ja3F1b3RlOmJlZm9yZSwKCQlibG9ja3F1b3RlOmFmdGVyIHsKCQljb250ZW50OiAiIgoJCX0KCgkJYWRkcmVzcyB7CgkJZGlzcGxheTogYmxvY2s7CgkJbWFyZ2luLWJvdHRvbTogMjFweDsKCQlmb250LXN0eWxlOiBub3JtYWw7CgkJbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDI5CgkJfQoKCQljb2RlLAoJCXByZSB7CgkJZm9udC1mYW1pbHk6IE1vbmFjbywgTWVubG8sIENvbnNvbGFzLCAiQ291cmllciBOZXciLCBtb25vc3BhY2UKCQl9CgoJCWNvZGUgewoJCXBhZGRpbmc6IDJweCA0cHg7CgkJZm9udC1zaXplOiA5MCU7CgkJY29sb3I6ICNjNzI1NGU7CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjlmMmY0OwoJCWJvcmRlci1yYWRpdXM6IDRweAoJCX0KCgkJcHJlIHsKCQlkaXNwbGF5OiBibG9jazsKCQlwYWRkaW5nOiAxMHB4OwoJCW1hcmdpbjogMCAwIDEwLjVweDsKCQlmb250LXNpemU6IDE0cHg7CgkJbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDI5OwoJCWNvbG9yOiAjMzMzOwoJCXdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKCQl3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKCQlib3JkZXI6IDFweCBzb2xpZCAjY2NjOwoJCWJvcmRlci1yYWRpdXM6IDRweAoJCX0KCgkJcHJlLnByZXR0eXByaW50IHsKCQltYXJnaW4tYm90dG9tOiAyMXB4CgkJfQoKCQlwcmUgY29kZSB7CgkJcGFkZGluZzogMDsKCQlmb250LXNpemU6IGluaGVyaXQ7CgkJY29sb3I6IGluaGVyaXQ7CgkJd2hpdGUtc3BhY2U6IHByZS13cmFwOwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwoJCWJvcmRlcjogMAoJCX0KCgkJLnByZS1zY3JvbGxhYmxlIHsKCQltYXgtaGVpZ2h0OiAzNDBweDsKCQlvdmVyZmxvdy15OiBzY3JvbGwKCQl9CgoJCS5jb250YWluZXIgewoJCXBhZGRpbmctcmlnaHQ6IDE1cHg7CgkJcGFkZGluZy1sZWZ0OiAxNXB4OwoJCW1hcmdpbi1yaWdodDogYXV0bzsKCQltYXJnaW4tbGVmdDogYXV0bwoJCX0KCgkJLmNvbnRhaW5lcjpiZWZvcmUsCgkJLmNvbnRhaW5lcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY29udGFpbmVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLmNvbnRhaW5lcjpiZWZvcmUsCgkJLmNvbnRhaW5lcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY29udGFpbmVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLmNvbnRhaW5lcjpiZWZvcmUsCgkJLmNvbnRhaW5lcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY29udGFpbmVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLmNvbnRhaW5lcjpiZWZvcmUsCgkJLmNvbnRhaW5lcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY29udGFpbmVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLmNvbnRhaW5lcjpiZWZvcmUsCgkJLmNvbnRhaW5lcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY29udGFpbmVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLnJvdyB7CgkJbWFyZ2luLXJpZ2h0OiAtMTVweDsKCQltYXJnaW4tbGVmdDogLTE1cHgKCQl9CgoJCS5yb3c6YmVmb3JlLAoJCS5yb3c6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnJvdzphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5yb3c6YmVmb3JlLAoJCS5yb3c6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnJvdzphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5yb3c6YmVmb3JlLAoJCS5yb3c6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnJvdzphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5yb3c6YmVmb3JlLAoJCS5yb3c6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnJvdzphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5yb3c6YmVmb3JlLAoJCS5yb3c6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnJvdzphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5jb2wteHMtMSwKCQkuY29sLXhzLTIsCgkJLmNvbC14cy0zLAoJCS5jb2wteHMtNCwKCQkuY29sLXhzLTUsCgkJLmNvbC14cy02LAoJCS5jb2wteHMtNywKCQkuY29sLXhzLTgsCgkJLmNvbC14cy05LAoJCS5jb2wteHMtMTAsCgkJLmNvbC14cy0xMSwKCQkuY29sLXhzLTEyLAoJCS5jb2wtc20tMSwKCQkuY29sLXNtLTIsCgkJLmNvbC1zbS0zLAoJCS5jb2wtc20tNCwKCQkuY29sLXNtLTUsCgkJLmNvbC1zbS02LAoJCS5jb2wtc20tNywKCQkuY29sLXNtLTgsCgkJLmNvbC1zbS05LAoJCS5jb2wtc20tMTAsCgkJLmNvbC1zbS0xMSwKCQkuY29sLXNtLTEyLAoJCS5jb2wtbWQtMSwKCQkuY29sLW1kLTIsCgkJLmNvbC1tZC0zLAoJCS5jb2wtbWQtNCwKCQkuY29sLW1kLTUsCgkJLmNvbC1tZC02LAoJCS5jb2wtbWQtNywKCQkuY29sLW1kLTgsCgkJLmNvbC1tZC05LAoJCS5jb2wtbWQtMTAsCgkJLmNvbC1tZC0xMSwKCQkuY29sLW1kLTEyLAoJCS5jb2wtbGctMSwKCQkuY29sLWxnLTIsCgkJLmNvbC1sZy0zLAoJCS5jb2wtbGctNCwKCQkuY29sLWxnLTUsCgkJLmNvbC1sZy02LAoJCS5jb2wtbGctNywKCQkuY29sLWxnLTgsCgkJLmNvbC1sZy05LAoJCS5jb2wtbGctMTAsCgkJLmNvbC1sZy0xMSwKCQkuY29sLWxnLTEyIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJbWluLWhlaWdodDogMXB4OwoJCXBhZGRpbmctcmlnaHQ6IDE1cHg7CgkJcGFkZGluZy1sZWZ0OiAxNXB4CgkJfQoKCQkuY29sLXhzLTEsCgkJLmNvbC14cy0yLAoJCS5jb2wteHMtMywKCQkuY29sLXhzLTQsCgkJLmNvbC14cy01LAoJCS5jb2wteHMtNiwKCQkuY29sLXhzLTcsCgkJLmNvbC14cy04LAoJCS5jb2wteHMtOSwKCQkuY29sLXhzLTEwLAoJCS5jb2wteHMtMTEgewoJCWZsb2F0OiBsZWZ0CgkJfQoKCQkuY29sLXhzLTEgewoJCXdpZHRoOiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgoJCS5jb2wteHMtMiB7CgkJd2lkdGg6IDE2LjY2NjY2NjY2NjY2NjY2NCUKCQl9CgoJCS5jb2wteHMtMyB7CgkJd2lkdGg6IDI1JQoJCX0KCgkJLmNvbC14cy00IHsKCQl3aWR0aDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoKCQkuY29sLXhzLTUgewoJCXdpZHRoOiA0MS42NjY2NjY2NjY2NjY2NyUKCQl9CgoJCS5jb2wteHMtNiB7CgkJd2lkdGg6IDUwJQoJCX0KCgkJLmNvbC14cy03IHsKCQl3aWR0aDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCgkJLmNvbC14cy04IHsKCQl3aWR0aDogNjYuNjY2NjY2NjY2NjY2NjYlCgkJfQoKCQkuY29sLXhzLTkgewoJCXdpZHRoOiA3NSUKCQl9CgoJCS5jb2wteHMtMTAgewoJCXdpZHRoOiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgoJCS5jb2wteHMtMTEgewoJCXdpZHRoOiA5MS42NjY2NjY2NjY2NjY2NiUKCQl9CgoJCS5jb2wteHMtMTIgewoJCXdpZHRoOiAxMDAlCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLmNvbnRhaW5lciB7CgkJbWF4LXdpZHRoOiA3NTBweAoJCX0KCQkuY29sLXNtLTEsCgkJLmNvbC1zbS0yLAoJCS5jb2wtc20tMywKCQkuY29sLXNtLTQsCgkJLmNvbC1zbS01LAoJCS5jb2wtc20tNiwKCQkuY29sLXNtLTcsCgkJLmNvbC1zbS04LAoJCS5jb2wtc20tOSwKCQkuY29sLXNtLTEwLAoJCS5jb2wtc20tMTEgewoJCWZsb2F0OiBsZWZ0CgkJfQoJCS5jb2wtc20tMSB7CgkJd2lkdGg6IDguMzMzMzMzMzMzMzMzMzMyJQoJCX0KCQkuY29sLXNtLTIgewoJCXdpZHRoOiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtc20tMyB7CgkJd2lkdGg6IDI1JQoJCX0KCQkuY29sLXNtLTQgewoJCXdpZHRoOiAzMy4zMzMzMzMzMzMzMzMzMyUKCQl9CgkJLmNvbC1zbS01IHsKCQl3aWR0aDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtc20tNiB7CgkJd2lkdGg6IDUwJQoJCX0KCQkuY29sLXNtLTcgewoJCXdpZHRoOiA1OC4zMzMzMzMzMzMzMzMzMzYlCgkJfQoJCS5jb2wtc20tOCB7CgkJd2lkdGg6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLXNtLTkgewoJCXdpZHRoOiA3NSUKCQl9CgkJLmNvbC1zbS0xMCB7CgkJd2lkdGg6IDgzLjMzMzMzMzMzMzMzMzM0JQoJCX0KCQkuY29sLXNtLTExIHsKCQl3aWR0aDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtc20tMTIgewoJCXdpZHRoOiAxMDAlCgkJfQoJCS5jb2wtc20tcHVzaC0xIHsKCQlsZWZ0OiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgkJLmNvbC1zbS1wdXNoLTIgewoJCWxlZnQ6IDE2LjY2NjY2NjY2NjY2NjY2NCUKCQl9CgkJLmNvbC1zbS1wdXNoLTMgewoJCWxlZnQ6IDI1JQoJCX0KCQkuY29sLXNtLXB1c2gtNCB7CgkJbGVmdDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoJCS5jb2wtc20tcHVzaC01IHsKCQlsZWZ0OiA0MS42NjY2NjY2NjY2NjY2NyUKCQl9CgkJLmNvbC1zbS1wdXNoLTYgewoJCWxlZnQ6IDUwJQoJCX0KCQkuY29sLXNtLXB1c2gtNyB7CgkJbGVmdDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCQkuY29sLXNtLXB1c2gtOCB7CgkJbGVmdDogNjYuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtc20tcHVzaC05IHsKCQlsZWZ0OiA3NSUKCQl9CgkJLmNvbC1zbS1wdXNoLTEwIHsKCQlsZWZ0OiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgkJLmNvbC1zbS1wdXNoLTExIHsKCQlsZWZ0OiA5MS42NjY2NjY2NjY2NjY2NiUKCQl9CgkJLmNvbC1zbS1wdWxsLTEgewoJCXJpZ2h0OiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgkJLmNvbC1zbS1wdWxsLTIgewoJCXJpZ2h0OiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtc20tcHVsbC0zIHsKCQlyaWdodDogMjUlCgkJfQoJCS5jb2wtc20tcHVsbC00IHsKCQlyaWdodDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoJCS5jb2wtc20tcHVsbC01IHsKCQlyaWdodDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtc20tcHVsbC02IHsKCQlyaWdodDogNTAlCgkJfQoJCS5jb2wtc20tcHVsbC03IHsKCQlyaWdodDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCQkuY29sLXNtLXB1bGwtOCB7CgkJcmlnaHQ6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLXNtLXB1bGwtOSB7CgkJcmlnaHQ6IDc1JQoJCX0KCQkuY29sLXNtLXB1bGwtMTAgewoJCXJpZ2h0OiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgkJLmNvbC1zbS1wdWxsLTExIHsKCQlyaWdodDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtc20tb2Zmc2V0LTEgewoJCW1hcmdpbi1sZWZ0OiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgkJLmNvbC1zbS1vZmZzZXQtMiB7CgkJbWFyZ2luLWxlZnQ6IDE2LjY2NjY2NjY2NjY2NjY2NCUKCQl9CgkJLmNvbC1zbS1vZmZzZXQtMyB7CgkJbWFyZ2luLWxlZnQ6IDI1JQoJCX0KCQkuY29sLXNtLW9mZnNldC00IHsKCQltYXJnaW4tbGVmdDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoJCS5jb2wtc20tb2Zmc2V0LTUgewoJCW1hcmdpbi1sZWZ0OiA0MS42NjY2NjY2NjY2NjY2NyUKCQl9CgkJLmNvbC1zbS1vZmZzZXQtNiB7CgkJbWFyZ2luLWxlZnQ6IDUwJQoJCX0KCQkuY29sLXNtLW9mZnNldC03IHsKCQltYXJnaW4tbGVmdDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCQkuY29sLXNtLW9mZnNldC04IHsKCQltYXJnaW4tbGVmdDogNjYuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtc20tb2Zmc2V0LTkgewoJCW1hcmdpbi1sZWZ0OiA3NSUKCQl9CgkJLmNvbC1zbS1vZmZzZXQtMTAgewoJCW1hcmdpbi1sZWZ0OiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgkJLmNvbC1zbS1vZmZzZXQtMTEgewoJCW1hcmdpbi1sZWZ0OiA5MS42NjY2NjY2NjY2NjY2NiUKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjk5MnB4KSB7CgkJLmNvbnRhaW5lciB7CgkJbWF4LXdpZHRoOiA5NzBweAoJCX0KCQkuY29sLW1kLTEsCgkJLmNvbC1tZC0yLAoJCS5jb2wtbWQtMywKCQkuY29sLW1kLTQsCgkJLmNvbC1tZC01LAoJCS5jb2wtbWQtNiwKCQkuY29sLW1kLTcsCgkJLmNvbC1tZC04LAoJCS5jb2wtbWQtOSwKCQkuY29sLW1kLTEwLAoJCS5jb2wtbWQtMTEgewoJCWZsb2F0OiBsZWZ0CgkJfQoJCS5jb2wtbWQtMSB7CgkJd2lkdGg6IDguMzMzMzMzMzMzMzMzMzMyJQoJCX0KCQkuY29sLW1kLTIgewoJCXdpZHRoOiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtbWQtMyB7CgkJd2lkdGg6IDI1JQoJCX0KCQkuY29sLW1kLTQgewoJCXdpZHRoOiAzMy4zMzMzMzMzMzMzMzMzMyUKCQl9CgkJLmNvbC1tZC01IHsKCQl3aWR0aDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtbWQtNiB7CgkJd2lkdGg6IDUwJQoJCX0KCQkuY29sLW1kLTcgewoJCXdpZHRoOiA1OC4zMzMzMzMzMzMzMzMzMzYlCgkJfQoJCS5jb2wtbWQtOCB7CgkJd2lkdGg6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLW1kLTkgewoJCXdpZHRoOiA3NSUKCQl9CgkJLmNvbC1tZC0xMCB7CgkJd2lkdGg6IDgzLjMzMzMzMzMzMzMzMzM0JQoJCX0KCQkuY29sLW1kLTExIHsKCQl3aWR0aDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtbWQtMTIgewoJCXdpZHRoOiAxMDAlCgkJfQoJCS5jb2wtbWQtcHVzaC0wIHsKCQlsZWZ0OiBhdXRvCgkJfQoJCS5jb2wtbWQtcHVzaC0xIHsKCQlsZWZ0OiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgkJLmNvbC1tZC1wdXNoLTIgewoJCWxlZnQ6IDE2LjY2NjY2NjY2NjY2NjY2NCUKCQl9CgkJLmNvbC1tZC1wdXNoLTMgewoJCWxlZnQ6IDI1JQoJCX0KCQkuY29sLW1kLXB1c2gtNCB7CgkJbGVmdDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoJCS5jb2wtbWQtcHVzaC01IHsKCQlsZWZ0OiA0MS42NjY2NjY2NjY2NjY2NyUKCQl9CgkJLmNvbC1tZC1wdXNoLTYgewoJCWxlZnQ6IDUwJQoJCX0KCQkuY29sLW1kLXB1c2gtNyB7CgkJbGVmdDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCQkuY29sLW1kLXB1c2gtOCB7CgkJbGVmdDogNjYuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtbWQtcHVzaC05IHsKCQlsZWZ0OiA3NSUKCQl9CgkJLmNvbC1tZC1wdXNoLTEwIHsKCQlsZWZ0OiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgkJLmNvbC1tZC1wdXNoLTExIHsKCQlsZWZ0OiA5MS42NjY2NjY2NjY2NjY2NiUKCQl9CgkJLmNvbC1tZC1wdWxsLTAgewoJCXJpZ2h0OiBhdXRvCgkJfQoJCS5jb2wtbWQtcHVsbC0xIHsKCQlyaWdodDogOC4zMzMzMzMzMzMzMzMzMzIlCgkJfQoJCS5jb2wtbWQtcHVsbC0yIHsKCQlyaWdodDogMTYuNjY2NjY2NjY2NjY2NjY0JQoJCX0KCQkuY29sLW1kLXB1bGwtMyB7CgkJcmlnaHQ6IDI1JQoJCX0KCQkuY29sLW1kLXB1bGwtNCB7CgkJcmlnaHQ6IDMzLjMzMzMzMzMzMzMzMzMzJQoJCX0KCQkuY29sLW1kLXB1bGwtNSB7CgkJcmlnaHQ6IDQxLjY2NjY2NjY2NjY2NjY3JQoJCX0KCQkuY29sLW1kLXB1bGwtNiB7CgkJcmlnaHQ6IDUwJQoJCX0KCQkuY29sLW1kLXB1bGwtNyB7CgkJcmlnaHQ6IDU4LjMzMzMzMzMzMzMzMzMzNiUKCQl9CgkJLmNvbC1tZC1wdWxsLTggewoJCXJpZ2h0OiA2Ni42NjY2NjY2NjY2NjY2NiUKCQl9CgkJLmNvbC1tZC1wdWxsLTkgewoJCXJpZ2h0OiA3NSUKCQl9CgkJLmNvbC1tZC1wdWxsLTEwIHsKCQlyaWdodDogODMuMzMzMzMzMzMzMzMzMzQlCgkJfQoJCS5jb2wtbWQtcHVsbC0xMSB7CgkJcmlnaHQ6IDkxLjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLW1kLW9mZnNldC0wIHsKCQltYXJnaW4tbGVmdDogMAoJCX0KCQkuY29sLW1kLW9mZnNldC0xIHsKCQltYXJnaW4tbGVmdDogOC4zMzMzMzMzMzMzMzMzMzIlCgkJfQoJCS5jb2wtbWQtb2Zmc2V0LTIgewoJCW1hcmdpbi1sZWZ0OiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtbWQtb2Zmc2V0LTMgewoJCW1hcmdpbi1sZWZ0OiAyNSUKCQl9CgkJLmNvbC1tZC1vZmZzZXQtNCB7CgkJbWFyZ2luLWxlZnQ6IDMzLjMzMzMzMzMzMzMzMzMzJQoJCX0KCQkuY29sLW1kLW9mZnNldC01IHsKCQltYXJnaW4tbGVmdDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtbWQtb2Zmc2V0LTYgewoJCW1hcmdpbi1sZWZ0OiA1MCUKCQl9CgkJLmNvbC1tZC1vZmZzZXQtNyB7CgkJbWFyZ2luLWxlZnQ6IDU4LjMzMzMzMzMzMzMzMzMzNiUKCQl9CgkJLmNvbC1tZC1vZmZzZXQtOCB7CgkJbWFyZ2luLWxlZnQ6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLW1kLW9mZnNldC05IHsKCQltYXJnaW4tbGVmdDogNzUlCgkJfQoJCS5jb2wtbWQtb2Zmc2V0LTEwIHsKCQltYXJnaW4tbGVmdDogODMuMzMzMzMzMzMzMzMzMzQlCgkJfQoJCS5jb2wtbWQtb2Zmc2V0LTExIHsKCQltYXJnaW4tbGVmdDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDoxMjAwcHgpIHsKCQkuY29udGFpbmVyIHsKCQltYXgtd2lkdGg6IDExNzBweAoJCX0KCQkuY29sLWxnLTEsCgkJLmNvbC1sZy0yLAoJCS5jb2wtbGctMywKCQkuY29sLWxnLTQsCgkJLmNvbC1sZy01LAoJCS5jb2wtbGctNiwKCQkuY29sLWxnLTcsCgkJLmNvbC1sZy04LAoJCS5jb2wtbGctOSwKCQkuY29sLWxnLTEwLAoJCS5jb2wtbGctMTEgewoJCWZsb2F0OiBsZWZ0CgkJfQoJCS5jb2wtbGctMSB7CgkJd2lkdGg6IDguMzMzMzMzMzMzMzMzMzMyJQoJCX0KCQkuY29sLWxnLTIgewoJCXdpZHRoOiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtbGctMyB7CgkJd2lkdGg6IDI1JQoJCX0KCQkuY29sLWxnLTQgewoJCXdpZHRoOiAzMy4zMzMzMzMzMzMzMzMzMyUKCQl9CgkJLmNvbC1sZy01IHsKCQl3aWR0aDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtbGctNiB7CgkJd2lkdGg6IDUwJQoJCX0KCQkuY29sLWxnLTcgewoJCXdpZHRoOiA1OC4zMzMzMzMzMzMzMzMzMzYlCgkJfQoJCS5jb2wtbGctOCB7CgkJd2lkdGg6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLWxnLTkgewoJCXdpZHRoOiA3NSUKCQl9CgkJLmNvbC1sZy0xMCB7CgkJd2lkdGg6IDgzLjMzMzMzMzMzMzMzMzM0JQoJCX0KCQkuY29sLWxnLTExIHsKCQl3aWR0aDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtbGctMTIgewoJCXdpZHRoOiAxMDAlCgkJfQoJCS5jb2wtbGctcHVzaC0wIHsKCQlsZWZ0OiBhdXRvCgkJfQoJCS5jb2wtbGctcHVzaC0xIHsKCQlsZWZ0OiA4LjMzMzMzMzMzMzMzMzMzMiUKCQl9CgkJLmNvbC1sZy1wdXNoLTIgewoJCWxlZnQ6IDE2LjY2NjY2NjY2NjY2NjY2NCUKCQl9CgkJLmNvbC1sZy1wdXNoLTMgewoJCWxlZnQ6IDI1JQoJCX0KCQkuY29sLWxnLXB1c2gtNCB7CgkJbGVmdDogMzMuMzMzMzMzMzMzMzMzMzMlCgkJfQoJCS5jb2wtbGctcHVzaC01IHsKCQlsZWZ0OiA0MS42NjY2NjY2NjY2NjY2NyUKCQl9CgkJLmNvbC1sZy1wdXNoLTYgewoJCWxlZnQ6IDUwJQoJCX0KCQkuY29sLWxnLXB1c2gtNyB7CgkJbGVmdDogNTguMzMzMzMzMzMzMzMzMzM2JQoJCX0KCQkuY29sLWxnLXB1c2gtOCB7CgkJbGVmdDogNjYuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCS5jb2wtbGctcHVzaC05IHsKCQlsZWZ0OiA3NSUKCQl9CgkJLmNvbC1sZy1wdXNoLTEwIHsKCQlsZWZ0OiA4My4zMzMzMzMzMzMzMzMzNCUKCQl9CgkJLmNvbC1sZy1wdXNoLTExIHsKCQlsZWZ0OiA5MS42NjY2NjY2NjY2NjY2NiUKCQl9CgkJLmNvbC1sZy1wdWxsLTAgewoJCXJpZ2h0OiBhdXRvCgkJfQoJCS5jb2wtbGctcHVsbC0xIHsKCQlyaWdodDogOC4zMzMzMzMzMzMzMzMzMzIlCgkJfQoJCS5jb2wtbGctcHVsbC0yIHsKCQlyaWdodDogMTYuNjY2NjY2NjY2NjY2NjY0JQoJCX0KCQkuY29sLWxnLXB1bGwtMyB7CgkJcmlnaHQ6IDI1JQoJCX0KCQkuY29sLWxnLXB1bGwtNCB7CgkJcmlnaHQ6IDMzLjMzMzMzMzMzMzMzMzMzJQoJCX0KCQkuY29sLWxnLXB1bGwtNSB7CgkJcmlnaHQ6IDQxLjY2NjY2NjY2NjY2NjY3JQoJCX0KCQkuY29sLWxnLXB1bGwtNiB7CgkJcmlnaHQ6IDUwJQoJCX0KCQkuY29sLWxnLXB1bGwtNyB7CgkJcmlnaHQ6IDU4LjMzMzMzMzMzMzMzMzMzNiUKCQl9CgkJLmNvbC1sZy1wdWxsLTggewoJCXJpZ2h0OiA2Ni42NjY2NjY2NjY2NjY2NiUKCQl9CgkJLmNvbC1sZy1wdWxsLTkgewoJCXJpZ2h0OiA3NSUKCQl9CgkJLmNvbC1sZy1wdWxsLTEwIHsKCQlyaWdodDogODMuMzMzMzMzMzMzMzMzMzQlCgkJfQoJCS5jb2wtbGctcHVsbC0xMSB7CgkJcmlnaHQ6IDkxLjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLWxnLW9mZnNldC0wIHsKCQltYXJnaW4tbGVmdDogMAoJCX0KCQkuY29sLWxnLW9mZnNldC0xIHsKCQltYXJnaW4tbGVmdDogOC4zMzMzMzMzMzMzMzMzMzIlCgkJfQoJCS5jb2wtbGctb2Zmc2V0LTIgewoJCW1hcmdpbi1sZWZ0OiAxNi42NjY2NjY2NjY2NjY2NjQlCgkJfQoJCS5jb2wtbGctb2Zmc2V0LTMgewoJCW1hcmdpbi1sZWZ0OiAyNSUKCQl9CgkJLmNvbC1sZy1vZmZzZXQtNCB7CgkJbWFyZ2luLWxlZnQ6IDMzLjMzMzMzMzMzMzMzMzMzJQoJCX0KCQkuY29sLWxnLW9mZnNldC01IHsKCQltYXJnaW4tbGVmdDogNDEuNjY2NjY2NjY2NjY2NjclCgkJfQoJCS5jb2wtbGctb2Zmc2V0LTYgewoJCW1hcmdpbi1sZWZ0OiA1MCUKCQl9CgkJLmNvbC1sZy1vZmZzZXQtNyB7CgkJbWFyZ2luLWxlZnQ6IDU4LjMzMzMzMzMzMzMzMzMzNiUKCQl9CgkJLmNvbC1sZy1vZmZzZXQtOCB7CgkJbWFyZ2luLWxlZnQ6IDY2LjY2NjY2NjY2NjY2NjY2JQoJCX0KCQkuY29sLWxnLW9mZnNldC05IHsKCQltYXJnaW4tbGVmdDogNzUlCgkJfQoJCS5jb2wtbGctb2Zmc2V0LTEwIHsKCQltYXJnaW4tbGVmdDogODMuMzMzMzMzMzMzMzMzMzQlCgkJfQoJCS5jb2wtbGctb2Zmc2V0LTExIHsKCQltYXJnaW4tbGVmdDogOTEuNjY2NjY2NjY2NjY2NjYlCgkJfQoJCX0KCgkJdGFibGUgewoJCW1heC13aWR0aDogMTAwJTsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJdGggewoJCXRleHQtYWxpZ246IGxlZnQKCQl9CgoJCS50YWJsZSB7CgkJd2lkdGg6IDEwMCU7CgkJbWFyZ2luLWJvdHRvbTogMjFweAoJCX0KCgkJLnRhYmxlIHRoZWFkPnRyPnRoLAoJCS50YWJsZSB0Ym9keT50cj50aCwKCQkudGFibGUgdGZvb3Q+dHI+dGgsCgkJLnRhYmxlIHRoZWFkPnRyPnRkLAoJCS50YWJsZSB0Ym9keT50cj50ZCwKCQkudGFibGUgdGZvb3Q+dHI+dGQgewoJCXBhZGRpbmc6IDhweDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJdmVydGljYWwtYWxpZ246IHRvcDsKCQlib3JkZXItdG9wOiAxcHggc29saWQgI2RkZAoJCX0KCgkJLnRhYmxlIHRoZWFkPnRyPnRoIHsKCQl2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOwoJCWJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZGRkCgkJfQoKCQkudGFibGUgY2FwdGlvbit0aGVhZCB0cjpmaXJzdC1jaGlsZCB0aCwKCQkudGFibGUgY29sZ3JvdXArdGhlYWQgdHI6Zmlyc3QtY2hpbGQgdGgsCgkJLnRhYmxlIHRoZWFkOmZpcnN0LWNoaWxkIHRyOmZpcnN0LWNoaWxkIHRoLAoJCS50YWJsZSBjYXB0aW9uK3RoZWFkIHRyOmZpcnN0LWNoaWxkIHRkLAoJCS50YWJsZSBjb2xncm91cCt0aGVhZCB0cjpmaXJzdC1jaGlsZCB0ZCwKCQkudGFibGUgdGhlYWQ6Zmlyc3QtY2hpbGQgdHI6Zmlyc3QtY2hpbGQgdGQgewoJCWJvcmRlci10b3A6IDAKCQl9CgoJCS50YWJsZSB0Ym9keSt0Ym9keSB7CgkJYm9yZGVyLXRvcDogMnB4IHNvbGlkICNkZGQKCQl9CgoJCS50YWJsZSAudGFibGUgewoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYKCQl9CgoJCS50YWJsZS1jb25kZW5zZWQgdGhlYWQ+dHI+dGgsCgkJLnRhYmxlLWNvbmRlbnNlZCB0Ym9keT50cj50aCwKCQkudGFibGUtY29uZGVuc2VkIHRmb290PnRyPnRoLAoJCS50YWJsZS1jb25kZW5zZWQgdGhlYWQ+dHI+dGQsCgkJLnRhYmxlLWNvbmRlbnNlZCB0Ym9keT50cj50ZCwKCQkudGFibGUtY29uZGVuc2VkIHRmb290PnRyPnRkIHsKCQlwYWRkaW5nOiA1cHgKCQl9CgoJCS50YWJsZS1ib3JkZXJlZCB7CgkJYm9yZGVyOiAxcHggc29saWQgI2RkZAoJCX0KCgkJLnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyPnRoLAoJCS50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50aCwKCQkudGFibGUtYm9yZGVyZWQ+dGZvb3Q+dHI+dGgsCgkJLnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyPnRkLAoJCS50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50ZCwKCQkudGFibGUtYm9yZGVyZWQ+dGZvb3Q+dHI+dGQgewoJCWJvcmRlcjogMXB4IHNvbGlkICNkZGQKCQl9CgoJCS50YWJsZS1ib3JkZXJlZD50aGVhZD50cj50aCwKCQkudGFibGUtYm9yZGVyZWQ+dGhlYWQ+dHI+dGQgewoJCWJvcmRlci1ib3R0b20td2lkdGg6IDJweAoJCX0KCgkJLnRhYmxlLXN0cmlwZWQ+dGJvZHk+dHI6bnRoLWNoaWxkKG9kZCk+dGQsCgkJLnRhYmxlLXN0cmlwZWQ+dGJvZHk+dHI6bnRoLWNoaWxkKG9kZCk+dGggewoJCWJhY2tncm91bmQtY29sb3I6ICNmOWY5ZjkKCQl9CgoJCS50YWJsZS1ob3Zlcj50Ym9keT50cjpob3Zlcj50ZCwKCQkudGFibGUtaG92ZXI+dGJvZHk+dHI6aG92ZXI+dGggewoJCWJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjUKCQl9CgoJCXRhYmxlIGNvbFtjbGFzcyo9ImNvbC0iXSB7CgkJZGlzcGxheTogdGFibGUtY29sdW1uOwoJCWZsb2F0OiBub25lCgkJfQoKCQl0YWJsZSB0ZFtjbGFzcyo9ImNvbC0iXSwKCQl0YWJsZSB0aFtjbGFzcyo9ImNvbC0iXSB7CgkJZGlzcGxheTogdGFibGUtY2VsbDsKCQlmbG9hdDogbm9uZQoJCX0KCgkJLnRhYmxlPnRoZWFkPnRyPnRkLmFjdGl2ZSwKCQkudGFibGU+dGJvZHk+dHI+dGQuYWN0aXZlLAoJCS50YWJsZT50Zm9vdD50cj50ZC5hY3RpdmUsCgkJLnRhYmxlPnRoZWFkPnRyPnRoLmFjdGl2ZSwKCQkudGFibGU+dGJvZHk+dHI+dGguYWN0aXZlLAoJCS50YWJsZT50Zm9vdD50cj50aC5hY3RpdmUsCgkJLnRhYmxlPnRoZWFkPnRyLmFjdGl2ZT50ZCwKCQkudGFibGU+dGJvZHk+dHIuYWN0aXZlPnRkLAoJCS50YWJsZT50Zm9vdD50ci5hY3RpdmU+dGQsCgkJLnRhYmxlPnRoZWFkPnRyLmFjdGl2ZT50aCwKCQkudGFibGU+dGJvZHk+dHIuYWN0aXZlPnRoLAoJCS50YWJsZT50Zm9vdD50ci5hY3RpdmU+dGggewoJCWJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjUKCQl9CgoJCS50YWJsZT50aGVhZD50cj50ZC5zdWNjZXNzLAoJCS50YWJsZT50Ym9keT50cj50ZC5zdWNjZXNzLAoJCS50YWJsZT50Zm9vdD50cj50ZC5zdWNjZXNzLAoJCS50YWJsZT50aGVhZD50cj50aC5zdWNjZXNzLAoJCS50YWJsZT50Ym9keT50cj50aC5zdWNjZXNzLAoJCS50YWJsZT50Zm9vdD50cj50aC5zdWNjZXNzLAoJCS50YWJsZT50aGVhZD50ci5zdWNjZXNzPnRkLAoJCS50YWJsZT50Ym9keT50ci5zdWNjZXNzPnRkLAoJCS50YWJsZT50Zm9vdD50ci5zdWNjZXNzPnRkLAoJCS50YWJsZT50aGVhZD50ci5zdWNjZXNzPnRoLAoJCS50YWJsZT50Ym9keT50ci5zdWNjZXNzPnRoLAoJCS50YWJsZT50Zm9vdD50ci5zdWNjZXNzPnRoIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGZmMGQ4OwoJCWJvcmRlci1jb2xvcjogI2Q2ZTljNgoJCX0KCgkJLnRhYmxlLWhvdmVyPnRib2R5PnRyPnRkLnN1Y2Nlc3M6aG92ZXIsCgkJLnRhYmxlLWhvdmVyPnRib2R5PnRyPnRoLnN1Y2Nlc3M6aG92ZXIsCgkJLnRhYmxlLWhvdmVyPnRib2R5PnRyLnN1Y2Nlc3M6aG92ZXI+dGQgewoJCWJhY2tncm91bmQtY29sb3I6ICNkMGU5YzY7CgkJYm9yZGVyLWNvbG9yOiAjYzllMmIzCgkJfQoKCQkudGFibGU+dGhlYWQ+dHI+dGQuZGFuZ2VyLAoJCS50YWJsZT50Ym9keT50cj50ZC5kYW5nZXIsCgkJLnRhYmxlPnRmb290PnRyPnRkLmRhbmdlciwKCQkudGFibGU+dGhlYWQ+dHI+dGguZGFuZ2VyLAoJCS50YWJsZT50Ym9keT50cj50aC5kYW5nZXIsCgkJLnRhYmxlPnRmb290PnRyPnRoLmRhbmdlciwKCQkudGFibGU+dGhlYWQ+dHIuZGFuZ2VyPnRkLAoJCS50YWJsZT50Ym9keT50ci5kYW5nZXI+dGQsCgkJLnRhYmxlPnRmb290PnRyLmRhbmdlcj50ZCwKCQkudGFibGU+dGhlYWQ+dHIuZGFuZ2VyPnRoLAoJCS50YWJsZT50Ym9keT50ci5kYW5nZXI+dGgsCgkJLnRhYmxlPnRmb290PnRyLmRhbmdlcj50aCB7CgkJYmFja2dyb3VuZC1jb2xvcjogI2YyZGVkZTsKCQlib3JkZXItY29sb3I6ICNlZWQzZDcKCQl9CgoJCS50YWJsZS1ob3Zlcj50Ym9keT50cj50ZC5kYW5nZXI6aG92ZXIsCgkJLnRhYmxlLWhvdmVyPnRib2R5PnRyPnRoLmRhbmdlcjpob3ZlciwKCQkudGFibGUtaG92ZXI+dGJvZHk+dHIuZGFuZ2VyOmhvdmVyPnRkIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWJjY2NjOwoJCWJvcmRlci1jb2xvcjogI2U2YzFjNwoJCX0KCgkJLnRhYmxlPnRoZWFkPnRyPnRkLndhcm5pbmcsCgkJLnRhYmxlPnRib2R5PnRyPnRkLndhcm5pbmcsCgkJLnRhYmxlPnRmb290PnRyPnRkLndhcm5pbmcsCgkJLnRhYmxlPnRoZWFkPnRyPnRoLndhcm5pbmcsCgkJLnRhYmxlPnRib2R5PnRyPnRoLndhcm5pbmcsCgkJLnRhYmxlPnRmb290PnRyPnRoLndhcm5pbmcsCgkJLnRhYmxlPnRoZWFkPnRyLndhcm5pbmc+dGQsCgkJLnRhYmxlPnRib2R5PnRyLndhcm5pbmc+dGQsCgkJLnRhYmxlPnRmb290PnRyLndhcm5pbmc+dGQsCgkJLnRhYmxlPnRoZWFkPnRyLndhcm5pbmc+dGgsCgkJLnRhYmxlPnRib2R5PnRyLndhcm5pbmc+dGgsCgkJLnRhYmxlPnRmb290PnRyLndhcm5pbmc+dGggewoJCWJhY2tncm91bmQtY29sb3I6ICNmY2Y4ZTM7CgkJYm9yZGVyLWNvbG9yOiAjZmJlZWQ1CgkJfQoKCQkudGFibGUtaG92ZXI+dGJvZHk+dHI+dGQud2FybmluZzpob3ZlciwKCQkudGFibGUtaG92ZXI+dGJvZHk+dHI+dGgud2FybmluZzpob3ZlciwKCQkudGFibGUtaG92ZXI+dGJvZHk+dHIud2FybmluZzpob3Zlcj50ZCB7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZhZjJjYzsKCQlib3JkZXItY29sb3I6ICNmOGU1YmUKCQl9CgoJCUBtZWRpYShtYXgtd2lkdGg6NzY4cHgpIHsKCQkudGFibGUtcmVzcG9uc2l2ZSB7CgkJd2lkdGg6IDEwMCU7CgkJbWFyZ2luLWJvdHRvbTogMTVweDsKCQlvdmVyZmxvdy14OiBzY3JvbGw7CgkJb3ZlcmZsb3cteTogaGlkZGVuOwoJCWJvcmRlcjogMXB4IHNvbGlkICNkZGQKCQl9CgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlIHsKCQltYXJnaW4tYm90dG9tOiAwOwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYKCQl9CgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlPnRoZWFkPnRyPnRoLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZT50Ym9keT50cj50aCwKCQkudGFibGUtcmVzcG9uc2l2ZT4udGFibGU+dGZvb3Q+dHI+dGgsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlPnRoZWFkPnRyPnRkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZT50Ym9keT50cj50ZCwKCQkudGFibGUtcmVzcG9uc2l2ZT4udGFibGU+dGZvb3Q+dHI+dGQgewoJCXdoaXRlLXNwYWNlOiBub3dyYXAKCQl9CgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkIHsKCQlib3JkZXI6IDAKCQl9CgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyPnRoOmZpcnN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50aDpmaXJzdC1jaGlsZCwKCQkudGFibGUtcmVzcG9uc2l2ZT4udGFibGUtYm9yZGVyZWQ+dGZvb3Q+dHI+dGg6Zmlyc3QtY2hpbGQsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyPnRkOmZpcnN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50ZDpmaXJzdC1jaGlsZCwKCQkudGFibGUtcmVzcG9uc2l2ZT4udGFibGUtYm9yZGVyZWQ+dGZvb3Q+dHI+dGQ6Zmlyc3QtY2hpbGQgewoJCWJvcmRlci1sZWZ0OiAwCgkJfQoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50aGVhZD50cj50aDpsYXN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50aDpsYXN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Zm9vdD50cj50aDpsYXN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50aGVhZD50cj50ZDpsYXN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Ym9keT50cj50ZDpsYXN0LWNoaWxkLAoJCS50YWJsZS1yZXNwb25zaXZlPi50YWJsZS1ib3JkZXJlZD50Zm9vdD50cj50ZDpsYXN0LWNoaWxkIHsKCQlib3JkZXItcmlnaHQ6IDAKCQl9CgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyOmxhc3QtY2hpbGQ+dGgsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRib2R5PnRyOmxhc3QtY2hpbGQ+dGgsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRmb290PnRyOmxhc3QtY2hpbGQ+dGgsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRoZWFkPnRyOmxhc3QtY2hpbGQ+dGQsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRib2R5PnRyOmxhc3QtY2hpbGQ+dGQsCgkJLnRhYmxlLXJlc3BvbnNpdmU+LnRhYmxlLWJvcmRlcmVkPnRmb290PnRyOmxhc3QtY2hpbGQ+dGQgewoJCWJvcmRlci1ib3R0b206IDAKCQl9CgkJfQoKCQlmaWVsZHNldCB7CgkJcGFkZGluZzogMDsKCQltYXJnaW46IDA7CgkJYm9yZGVyOiAwCgkJfQoKCQlsZWdlbmQgewoJCWRpc3BsYXk6IGJsb2NrOwoJCXdpZHRoOiAxMDAlOwoJCXBhZGRpbmc6IDA7CgkJbWFyZ2luLWJvdHRvbTogMjFweDsKCQlmb250LXNpemU6IDIyLjVweDsKCQlsaW5lLWhlaWdodDogaW5oZXJpdDsKCQljb2xvcjogIzc3NzsKCQlib3JkZXI6IDA7CgkJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU1ZTUKCQl9CgoJCWxhYmVsIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJbWFyZ2luLWJvdHRvbTogNXB4OwoJCWZvbnQtd2VpZ2h0OiBib2xkCgkJfQoKCQlpbnB1dFt0eXBlPSJzZWFyY2giXSB7CgkJLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwoJCS1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsKCQlib3gtc2l6aW5nOiBib3JkZXItYm94CgkJfQoKCQlpbnB1dFt0eXBlPSJyYWRpbyJdLAoJCWlucHV0W3R5cGU9ImNoZWNrYm94Il0gewoJCW1hcmdpbjogNHB4IDAgMDsKCQltYXJnaW4tdG9wOiAxcHggXDk7CgkJbGluZS1oZWlnaHQ6IG5vcm1hbAoJCX0KCgkJaW5wdXRbdHlwZT0iZmlsZSJdIHsKCQlkaXNwbGF5OiBibG9jawoJCX0KCgkJc2VsZWN0W211bHRpcGxlXSwKCQlzZWxlY3Rbc2l6ZV0gewoJCWhlaWdodDogYXV0bwoJCX0KCgkJc2VsZWN0IG9wdGdyb3VwIHsKCQlmb250LWZhbWlseTogaW5oZXJpdDsKCQlmb250LXNpemU6IGluaGVyaXQ7CgkJZm9udC1zdHlsZTogaW5oZXJpdAoJCX0KCgkJaW5wdXRbdHlwZT0iZmlsZSJdOmZvY3VzLAoJCWlucHV0W3R5cGU9InJhZGlvIl06Zm9jdXMsCgkJaW5wdXRbdHlwZT0iY2hlY2tib3giXTpmb2N1cyB7CgkJb3V0bGluZTogdGhpbiBkb3R0ZWQgIzMzMzsKCQlvdXRsaW5lOiA1cHggYXV0byAtd2Via2l0LWZvY3VzLXJpbmctY29sb3I7CgkJb3V0bGluZS1vZmZzZXQ6IC0ycHgKCQl9CgoJCWlucHV0W3R5cGU9Im51bWJlciJdOjotd2Via2l0LW91dGVyLXNwaW4tYnV0dG9uLAoJCWlucHV0W3R5cGU9Im51bWJlciJdOjotd2Via2l0LWlubmVyLXNwaW4tYnV0dG9uIHsKCQloZWlnaHQ6IGF1dG8KCQl9CgoJCS5mb3JtLWNvbnRyb2w6LW1vei1wbGFjZWhvbGRlciB7CgkJY29sb3I6ICM5OTkKCQl9CgoJCS5mb3JtLWNvbnRyb2w6Oi1tb3otcGxhY2Vob2xkZXIgewoJCWNvbG9yOiAjOTk5CgkJfQoKCQkuZm9ybS1jb250cm9sOi1tcy1pbnB1dC1wbGFjZWhvbGRlciB7CgkJY29sb3I6ICM5OTkKCQl9CgoJCS5mb3JtLWNvbnRyb2w6Oi13ZWJraXQtaW5wdXQtcGxhY2Vob2xkZXIgewoJCWNvbG9yOiAjOTk5CgkJfQoKCQkuZm9ybS1jb250cm9sIHsKCQlkaXNwbGF5OiBibG9jazsKCQl3aWR0aDogMTAwJTsKCQloZWlnaHQ6IDM5cHg7CgkJcGFkZGluZzogOHB4IDEycHg7CgkJZm9udC1zaXplOiAxNXB4OwoJCWxpbmUtaGVpZ2h0OiAxLjQyODU3MTQyOTsKCQljb2xvcjogIzc3NzsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgI2NjYzsKCQlib3JkZXItcmFkaXVzOiA0cHg7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjA3NSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNzUpOwoJCS13ZWJraXQtdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIGVhc2UtaW4tb3V0IC4xNXMsIGJveC1zaGFkb3cgZWFzZS1pbi1vdXQgLjE1czsKCQl0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgZWFzZS1pbi1vdXQgLjE1cywgYm94LXNoYWRvdyBlYXNlLWluLW91dCAuMTVzCgkJfQoKCQkuZm9ybS1jb250cm9sOmZvY3VzIHsKCQlib3JkZXItY29sb3I6ICM2NmFmZTk7CgkJb3V0bGluZTogMDsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDhweCByZ2JhKDEwMiwgMTc1LCAyMzMsIDAuNik7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNzUpLCAwIDAgOHB4IHJnYmEoMTAyLCAxNzUsIDIzMywgMC42KQoJCX0KCgkJLmZvcm0tY29udHJvbFtkaXNhYmxlZF0sCgkJLmZvcm0tY29udHJvbFtyZWFkb25seV0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5mb3JtLWNvbnRyb2wgewoJCWN1cnNvcjogbm90LWFsbG93ZWQ7CgkJYmFja2dyb3VuZC1jb2xvcjogI2VlZQoJCX0KCgkJdGV4dGFyZWEuZm9ybS1jb250cm9sIHsKCQloZWlnaHQ6IGF1dG8KCQl9CgoJCS5mb3JtLWdyb3VwIHsKCQltYXJnaW4tYm90dG9tOiAxNXB4CgkJfQoKCQkucmFkaW8sCgkJLmNoZWNrYm94IHsKCQlkaXNwbGF5OiBibG9jazsKCQltaW4taGVpZ2h0OiAyMXB4OwoJCXBhZGRpbmctbGVmdDogMjBweDsKCQltYXJnaW4tdG9wOiAxMHB4OwoJCW1hcmdpbi1ib3R0b206IDEwcHg7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZQoJCX0KCgkJLnJhZGlvIGxhYmVsLAoJCS5jaGVja2JveCBsYWJlbCB7CgkJZGlzcGxheTogaW5saW5lOwoJCW1hcmdpbi1ib3R0b206IDA7CgkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQljdXJzb3I6IHBvaW50ZXIKCQl9CgoJCS5yYWRpbyBpbnB1dFt0eXBlPSJyYWRpbyJdLAoJCS5yYWRpby1pbmxpbmUgaW5wdXRbdHlwZT0icmFkaW8iXSwKCQkuY2hlY2tib3ggaW5wdXRbdHlwZT0iY2hlY2tib3giXSwKCQkuY2hlY2tib3gtaW5saW5lIGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewoJCWZsb2F0OiBsZWZ0OwoJCW1hcmdpbi1sZWZ0OiAtMjBweAoJCX0KCgkJLnJhZGlvKy5yYWRpbywKCQkuY2hlY2tib3grLmNoZWNrYm94IHsKCQltYXJnaW4tdG9wOiAtNXB4CgkJfQoKCQkucmFkaW8taW5saW5lLAoJCS5jaGVja2JveC1pbmxpbmUgewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQlwYWRkaW5nLWxlZnQ6IDIwcHg7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCXZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CgkJY3Vyc29yOiBwb2ludGVyCgkJfQoKCQkucmFkaW8taW5saW5lKy5yYWRpby1pbmxpbmUsCgkJLmNoZWNrYm94LWlubGluZSsuY2hlY2tib3gtaW5saW5lIHsKCQltYXJnaW4tdG9wOiAwOwoJCW1hcmdpbi1sZWZ0OiAxMHB4CgkJfQoKCQlpbnB1dFt0eXBlPSJyYWRpbyJdW2Rpc2FibGVkXSwKCQlpbnB1dFt0eXBlPSJjaGVja2JveCJdW2Rpc2FibGVkXSwKCQkucmFkaW9bZGlzYWJsZWRdLAoJCS5yYWRpby1pbmxpbmVbZGlzYWJsZWRdLAoJCS5jaGVja2JveFtkaXNhYmxlZF0sCgkJLmNoZWNrYm94LWlubGluZVtkaXNhYmxlZF0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIGlucHV0W3R5cGU9InJhZGlvIl0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIGlucHV0W3R5cGU9ImNoZWNrYm94Il0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5yYWRpbywKCQlmaWVsZHNldFtkaXNhYmxlZF0gLnJhZGlvLWlubGluZSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmNoZWNrYm94LAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuY2hlY2tib3gtaW5saW5lIHsKCQljdXJzb3I6IG5vdC1hbGxvd2VkCgkJfQoKCQkuaW5wdXQtc20gewoJCWhlaWdodDogMzFweDsKCQlwYWRkaW5nOiA1cHggMTBweDsKCQlmb250LXNpemU6IDEzcHg7CgkJbGluZS1oZWlnaHQ6IDEuNTsKCQlib3JkZXItcmFkaXVzOiAzcHgKCQl9CgoJCXNlbGVjdC5pbnB1dC1zbSB7CgkJaGVpZ2h0OiAzMXB4OwoJCWxpbmUtaGVpZ2h0OiAzMXB4CgkJfQoKCQl0ZXh0YXJlYS5pbnB1dC1zbSB7CgkJaGVpZ2h0OiBhdXRvCgkJfQoKCQkuaW5wdXQtbGcgewoJCWhlaWdodDogNThweDsKCQlwYWRkaW5nOiAxNHB4IDE2cHg7CgkJZm9udC1zaXplOiAxOXB4OwoJCWxpbmUtaGVpZ2h0OiAxLjMzOwoJCWJvcmRlci1yYWRpdXM6IDZweAoJCX0KCgkJc2VsZWN0LmlucHV0LWxnIHsKCQloZWlnaHQ6IDU4cHg7CgkJbGluZS1oZWlnaHQ6IDU4cHgKCQl9CgoJCXRleHRhcmVhLmlucHV0LWxnIHsKCQloZWlnaHQ6IGF1dG8KCQl9CgoJCS5oYXMtd2FybmluZyAuaGVscC1ibG9jaywKCQkuaGFzLXdhcm5pbmcgLmNvbnRyb2wtbGFiZWwgewoJCWNvbG9yOiAjYzA5ODUzCgkJfQoKCQkuaGFzLXdhcm5pbmcgLmZvcm0tY29udHJvbCB7CgkJYm9yZGVyLWNvbG9yOiAjYzA5ODUzOwoJCS13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNzUpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KQoJCX0KCgkJLmhhcy13YXJuaW5nIC5mb3JtLWNvbnRyb2w6Zm9jdXMgewoJCWJvcmRlci1jb2xvcjogI2E0N2UzYzsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjZGJjNTllOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjZGJjNTllCgkJfQoKCQkuaGFzLXdhcm5pbmcgLmlucHV0LWdyb3VwLWFkZG9uIHsKCQljb2xvcjogI2MwOTg1MzsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmNmOGUzOwoJCWJvcmRlci1jb2xvcjogI2MwOTg1MwoJCX0KCgkJLmhhcy1lcnJvciAuaGVscC1ibG9jaywKCQkuaGFzLWVycm9yIC5jb250cm9sLWxhYmVsIHsKCQljb2xvcjogI2I5NGE0OAoJCX0KCgkJLmhhcy1lcnJvciAuZm9ybS1jb250cm9sIHsKCQlib3JkZXItY29sb3I6ICNiOTRhNDg7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjA3NSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNzUpCgkJfQoKCQkuaGFzLWVycm9yIC5mb3JtLWNvbnRyb2w6Zm9jdXMgewoJCWJvcmRlci1jb2xvcjogIzk1M2IzOTsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjZDU5MzkyOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjZDU5MzkyCgkJfQoKCQkuaGFzLWVycm9yIC5pbnB1dC1ncm91cC1hZGRvbiB7CgkJY29sb3I6ICNiOTRhNDg7CgkJYmFja2dyb3VuZC1jb2xvcjogI2YyZGVkZTsKCQlib3JkZXItY29sb3I6ICNiOTRhNDgKCQl9CgoJCS5oYXMtc3VjY2VzcyAuaGVscC1ibG9jaywKCQkuaGFzLXN1Y2Nlc3MgLmNvbnRyb2wtbGFiZWwgewoJCWNvbG9yOiAjNDY4ODQ3CgkJfQoKCQkuaGFzLXN1Y2Nlc3MgLmZvcm0tY29udHJvbCB7CgkJYm9yZGVyLWNvbG9yOiAjNDY4ODQ3OwoJCS13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNzUpOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KQoJCX0KCgkJLmhhcy1zdWNjZXNzIC5mb3JtLWNvbnRyb2w6Zm9jdXMgewoJCWJvcmRlci1jb2xvcjogIzM1NjYzNTsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjN2FiYTdiOwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMDc1KSwgMCAwIDZweCAjN2FiYTdiCgkJfQoKCQkuaGFzLXN1Y2Nlc3MgLmlucHV0LWdyb3VwLWFkZG9uIHsKCQljb2xvcjogIzQ2ODg0NzsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGZmMGQ4OwoJCWJvcmRlci1jb2xvcjogIzQ2ODg0NwoJCX0KCgkJLmZvcm0tY29udHJvbC1zdGF0aWMgewoJCXBhZGRpbmctdG9wOiA5cHg7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCgkJLmhlbHAtYmxvY2sgewoJCWRpc3BsYXk6IGJsb2NrOwoJCW1hcmdpbi10b3A6IDVweDsKCQltYXJnaW4tYm90dG9tOiAxMHB4OwoJCWNvbG9yOiAjYjdiN2I3CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLmZvcm0taW5saW5lIC5mb3JtLWdyb3VwIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlCgkJfQoJCS5mb3JtLWlubGluZSAuZm9ybS1jb250cm9sIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2sKCQl9CgkJLmZvcm0taW5saW5lIC5yYWRpbywKCQkuZm9ybS1pbmxpbmUgLmNoZWNrYm94IHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJcGFkZGluZy1sZWZ0OiAwOwoJCW1hcmdpbi10b3A6IDA7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCQkuZm9ybS1pbmxpbmUgLnJhZGlvIGlucHV0W3R5cGU9InJhZGlvIl0sCgkJLmZvcm0taW5saW5lIC5jaGVja2JveCBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKCQlmbG9hdDogbm9uZTsKCQltYXJnaW4tbGVmdDogMAoJCX0KCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmNvbnRyb2wtbGFiZWwsCgkJLmZvcm0taG9yaXpvbnRhbCAucmFkaW8sCgkJLmZvcm0taG9yaXpvbnRhbCAuY2hlY2tib3gsCgkJLmZvcm0taG9yaXpvbnRhbCAucmFkaW8taW5saW5lLAoJCS5mb3JtLWhvcml6b250YWwgLmNoZWNrYm94LWlubGluZSB7CgkJcGFkZGluZy10b3A6IDlweDsKCQltYXJnaW4tdG9wOiAwOwoJCW1hcmdpbi1ib3R0b206IDAKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXAgewoJCW1hcmdpbi1yaWdodDogLTE1cHg7CgkJbWFyZ2luLWxlZnQ6IC0xNXB4CgkJfQoKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmJlZm9yZSwKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmJlZm9yZSwKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmJlZm9yZSwKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmJlZm9yZSwKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmJlZm9yZSwKCQkuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLmZvcm0taG9yaXpvbnRhbCAuY29udHJvbC1sYWJlbCB7CgkJdGV4dC1hbGlnbjogcmlnaHQKCQl9CgkJfQoKCQkuYnRuIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJcGFkZGluZzogOHB4IDEycHg7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQlmb250LXNpemU6IDE1cHg7CgkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZTsKCQljdXJzb3I6IHBvaW50ZXI7CgkJYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogNHB4OwoJCS13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CgkJLW1vei11c2VyLXNlbGVjdDogbm9uZTsKCQktbXMtdXNlci1zZWxlY3Q6IG5vbmU7CgkJLW8tdXNlci1zZWxlY3Q6IG5vbmU7CgkJdXNlci1zZWxlY3Q6IG5vbmUKCQl9CgoJCS5idG46Zm9jdXMgewoJCW91dGxpbmU6IHRoaW4gZG90dGVkICMzMzM7CgkJb3V0bGluZTogNXB4IGF1dG8gLXdlYmtpdC1mb2N1cy1yaW5nLWNvbG9yOwoJCW91dGxpbmUtb2Zmc2V0OiAtMnB4CgkJfQoKCQkuYnRuOmhvdmVyLAoJCS5idG46Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZQoJCX0KCgkJLmJ0bjphY3RpdmUsCgkJLmJ0bi5hY3RpdmUgewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmU7CgkJb3V0bGluZTogMDsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAwLjEyNSkKCQl9CgoJCS5idG4uZGlzYWJsZWQsCgkJLmJ0bltkaXNhYmxlZF0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4gewoJCXBvaW50ZXItZXZlbnRzOiBub25lOwoJCWN1cnNvcjogbm90LWFsbG93ZWQ7CgkJb3BhY2l0eTogLjY1OwoJCWZpbHRlcjogYWxwaGEob3BhY2l0eT02NSk7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwoJCWJveC1zaGFkb3c6IG5vbmUKCQl9CgoJCS5idG4tZGVmYXVsdCB7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogIzk5OTsKCQlib3JkZXItY29sb3I6ICM5OTkKCQl9CgoJCS5idG4tZGVmYXVsdDpob3ZlciwKCQkuYnRuLWRlZmF1bHQ6Zm9jdXMsCgkJLmJ0bi1kZWZhdWx0OmFjdGl2ZSwKCQkuYnRuLWRlZmF1bHQuYWN0aXZlLAoJCS5vcGVuIC5kcm9wZG93bi10b2dnbGUuYnRuLWRlZmF1bHQgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6ICM4NTg1ODU7CgkJYm9yZGVyLWNvbG9yOiAjN2E3YTdhCgkJfQoKCQkuYnRuLWRlZmF1bHQ6YWN0aXZlLAoJCS5idG4tZGVmYXVsdC5hY3RpdmUsCgkJLm9wZW4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tZGVmYXVsdCB7CgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZQoJCX0KCgkJLmJ0bi1kZWZhdWx0LmRpc2FibGVkLAoJCS5idG4tZGVmYXVsdFtkaXNhYmxlZF0sCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tZGVmYXVsdCwKCQkuYnRuLWRlZmF1bHQuZGlzYWJsZWQ6aG92ZXIsCgkJLmJ0bi1kZWZhdWx0W2Rpc2FibGVkXTpob3ZlciwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kZWZhdWx0OmhvdmVyLAoJCS5idG4tZGVmYXVsdC5kaXNhYmxlZDpmb2N1cywKCQkuYnRuLWRlZmF1bHRbZGlzYWJsZWRdOmZvY3VzLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWRlZmF1bHQ6Zm9jdXMsCgkJLmJ0bi1kZWZhdWx0LmRpc2FibGVkOmFjdGl2ZSwKCQkuYnRuLWRlZmF1bHRbZGlzYWJsZWRdOmFjdGl2ZSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kZWZhdWx0OmFjdGl2ZSwKCQkuYnRuLWRlZmF1bHQuZGlzYWJsZWQuYWN0aXZlLAoJCS5idG4tZGVmYXVsdFtkaXNhYmxlZF0uYWN0aXZlLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWRlZmF1bHQuYWN0aXZlIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjOTk5OwoJCWJvcmRlci1jb2xvcjogIzk5OQoJCX0KCgkJLmJ0bi1wcmltYXJ5IHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWI2ODY0OwoJCWJvcmRlci1jb2xvcjogI2ViNjg2NAoJCX0KCgkJLmJ0bi1wcmltYXJ5OmhvdmVyLAoJCS5idG4tcHJpbWFyeTpmb2N1cywKCQkuYnRuLXByaW1hcnk6YWN0aXZlLAoJCS5idG4tcHJpbWFyeS5hY3RpdmUsCgkJLm9wZW4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tcHJpbWFyeSB7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogI2U2NDU0MDsKCQlib3JkZXItY29sb3I6ICNlNDMzMmUKCQl9CgoJCS5idG4tcHJpbWFyeTphY3RpdmUsCgkJLmJ0bi1wcmltYXJ5LmFjdGl2ZSwKCQkub3BlbiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1wcmltYXJ5IHsKCQliYWNrZ3JvdW5kLWltYWdlOiBub25lCgkJfQoKCQkuYnRuLXByaW1hcnkuZGlzYWJsZWQsCgkJLmJ0bi1wcmltYXJ5W2Rpc2FibGVkXSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1wcmltYXJ5LAoJCS5idG4tcHJpbWFyeS5kaXNhYmxlZDpob3ZlciwKCQkuYnRuLXByaW1hcnlbZGlzYWJsZWRdOmhvdmVyLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXByaW1hcnk6aG92ZXIsCgkJLmJ0bi1wcmltYXJ5LmRpc2FibGVkOmZvY3VzLAoJCS5idG4tcHJpbWFyeVtkaXNhYmxlZF06Zm9jdXMsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tcHJpbWFyeTpmb2N1cywKCQkuYnRuLXByaW1hcnkuZGlzYWJsZWQ6YWN0aXZlLAoJCS5idG4tcHJpbWFyeVtkaXNhYmxlZF06YWN0aXZlLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXByaW1hcnk6YWN0aXZlLAoJCS5idG4tcHJpbWFyeS5kaXNhYmxlZC5hY3RpdmUsCgkJLmJ0bi1wcmltYXJ5W2Rpc2FibGVkXS5hY3RpdmUsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tcHJpbWFyeS5hY3RpdmUgewoJCWJhY2tncm91bmQtY29sb3I6ICNlYjY4NjQ7CgkJYm9yZGVyLWNvbG9yOiAjZWI2ODY0CgkJfQoKCQkuYnRuLXdhcm5pbmcgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6ICNmNWU2MjU7CgkJYm9yZGVyLWNvbG9yOiAjZjVlNjI1CgkJfQoKCQkuYnRuLXdhcm5pbmc6aG92ZXIsCgkJLmJ0bi13YXJuaW5nOmZvY3VzLAoJCS5idG4td2FybmluZzphY3RpdmUsCgkJLmJ0bi13YXJuaW5nLmFjdGl2ZSwKCQkub3BlbiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi13YXJuaW5nIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZTdkNzBiOwoJCWJvcmRlci1jb2xvcjogI2QzYzUwYQoJCX0KCgkJLmJ0bi13YXJuaW5nOmFjdGl2ZSwKCQkuYnRuLXdhcm5pbmcuYWN0aXZlLAoJCS5vcGVuIC5kcm9wZG93bi10b2dnbGUuYnRuLXdhcm5pbmcgewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmUKCQl9CgoJCS5idG4td2FybmluZy5kaXNhYmxlZCwKCQkuYnRuLXdhcm5pbmdbZGlzYWJsZWRdLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXdhcm5pbmcsCgkJLmJ0bi13YXJuaW5nLmRpc2FibGVkOmhvdmVyLAoJCS5idG4td2FybmluZ1tkaXNhYmxlZF06aG92ZXIsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4td2FybmluZzpob3ZlciwKCQkuYnRuLXdhcm5pbmcuZGlzYWJsZWQ6Zm9jdXMsCgkJLmJ0bi13YXJuaW5nW2Rpc2FibGVkXTpmb2N1cywKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi13YXJuaW5nOmZvY3VzLAoJCS5idG4td2FybmluZy5kaXNhYmxlZDphY3RpdmUsCgkJLmJ0bi13YXJuaW5nW2Rpc2FibGVkXTphY3RpdmUsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4td2FybmluZzphY3RpdmUsCgkJLmJ0bi13YXJuaW5nLmRpc2FibGVkLmFjdGl2ZSwKCQkuYnRuLXdhcm5pbmdbZGlzYWJsZWRdLmFjdGl2ZSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi13YXJuaW5nLmFjdGl2ZSB7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y1ZTYyNTsKCQlib3JkZXItY29sb3I6ICNmNWU2MjUKCQl9CgoJCS5idG4tZGFuZ2VyIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjU3YTAwOwoJCWJvcmRlci1jb2xvcjogI2Y1N2EwMAoJCX0KCgkJLmJ0bi1kYW5nZXI6aG92ZXIsCgkJLmJ0bi1kYW5nZXI6Zm9jdXMsCgkJLmJ0bi1kYW5nZXI6YWN0aXZlLAoJCS5idG4tZGFuZ2VyLmFjdGl2ZSwKCQkub3BlbiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1kYW5nZXIgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6ICNjNjA7CgkJYm9yZGVyLWNvbG9yOiAjYjg1YzAwCgkJfQoKCQkuYnRuLWRhbmdlcjphY3RpdmUsCgkJLmJ0bi1kYW5nZXIuYWN0aXZlLAoJCS5vcGVuIC5kcm9wZG93bi10b2dnbGUuYnRuLWRhbmdlciB7CgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZQoJCX0KCgkJLmJ0bi1kYW5nZXIuZGlzYWJsZWQsCgkJLmJ0bi1kYW5nZXJbZGlzYWJsZWRdLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWRhbmdlciwKCQkuYnRuLWRhbmdlci5kaXNhYmxlZDpob3ZlciwKCQkuYnRuLWRhbmdlcltkaXNhYmxlZF06aG92ZXIsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tZGFuZ2VyOmhvdmVyLAoJCS5idG4tZGFuZ2VyLmRpc2FibGVkOmZvY3VzLAoJCS5idG4tZGFuZ2VyW2Rpc2FibGVkXTpmb2N1cywKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kYW5nZXI6Zm9jdXMsCgkJLmJ0bi1kYW5nZXIuZGlzYWJsZWQ6YWN0aXZlLAoJCS5idG4tZGFuZ2VyW2Rpc2FibGVkXTphY3RpdmUsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tZGFuZ2VyOmFjdGl2ZSwKCQkuYnRuLWRhbmdlci5kaXNhYmxlZC5hY3RpdmUsCgkJLmJ0bi1kYW5nZXJbZGlzYWJsZWRdLmFjdGl2ZSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kYW5nZXIuYWN0aXZlIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjU3YTAwOwoJCWJvcmRlci1jb2xvcjogI2Y1N2EwMAoJCX0KCgkJLmJ0bi1zdWNjZXNzIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjMjJiMjRjOwoJCWJvcmRlci1jb2xvcjogIzIyYjI0YwoJCX0KCgkJLmJ0bi1zdWNjZXNzOmhvdmVyLAoJCS5idG4tc3VjY2Vzczpmb2N1cywKCQkuYnRuLXN1Y2Nlc3M6YWN0aXZlLAoJCS5idG4tc3VjY2Vzcy5hY3RpdmUsCgkJLm9wZW4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tc3VjY2VzcyB7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogIzFiOTAzZDsKCQlib3JkZXItY29sb3I6ICMxODdmMzYKCQl9CgoJCS5idG4tc3VjY2VzczphY3RpdmUsCgkJLmJ0bi1zdWNjZXNzLmFjdGl2ZSwKCQkub3BlbiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1zdWNjZXNzIHsKCQliYWNrZ3JvdW5kLWltYWdlOiBub25lCgkJfQoKCQkuYnRuLXN1Y2Nlc3MuZGlzYWJsZWQsCgkJLmJ0bi1zdWNjZXNzW2Rpc2FibGVkXSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1zdWNjZXNzLAoJCS5idG4tc3VjY2Vzcy5kaXNhYmxlZDpob3ZlciwKCQkuYnRuLXN1Y2Nlc3NbZGlzYWJsZWRdOmhvdmVyLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXN1Y2Nlc3M6aG92ZXIsCgkJLmJ0bi1zdWNjZXNzLmRpc2FibGVkOmZvY3VzLAoJCS5idG4tc3VjY2Vzc1tkaXNhYmxlZF06Zm9jdXMsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tc3VjY2Vzczpmb2N1cywKCQkuYnRuLXN1Y2Nlc3MuZGlzYWJsZWQ6YWN0aXZlLAoJCS5idG4tc3VjY2Vzc1tkaXNhYmxlZF06YWN0aXZlLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXN1Y2Nlc3M6YWN0aXZlLAoJCS5idG4tc3VjY2Vzcy5kaXNhYmxlZC5hY3RpdmUsCgkJLmJ0bi1zdWNjZXNzW2Rpc2FibGVkXS5hY3RpdmUsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tc3VjY2Vzcy5hY3RpdmUgewoJCWJhY2tncm91bmQtY29sb3I6ICMyMmIyNGM7CgkJYm9yZGVyLWNvbG9yOiAjMjJiMjRjCgkJfQoKCQkuYnRuLWluZm8gewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6ICMzNjk7CgkJYm9yZGVyLWNvbG9yOiAjMzY5CgkJfQoKCQkuYnRuLWluZm86aG92ZXIsCgkJLmJ0bi1pbmZvOmZvY3VzLAoJCS5idG4taW5mbzphY3RpdmUsCgkJLmJ0bi1pbmZvLmFjdGl2ZSwKCQkub3BlbiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1pbmZvIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjMjk1MjdhOwoJCWJvcmRlci1jb2xvcjogIzI0NDc2YgoJCX0KCgkJLmJ0bi1pbmZvOmFjdGl2ZSwKCQkuYnRuLWluZm8uYWN0aXZlLAoJCS5vcGVuIC5kcm9wZG93bi10b2dnbGUuYnRuLWluZm8gewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmUKCQl9CgoJCS5idG4taW5mby5kaXNhYmxlZCwKCQkuYnRuLWluZm9bZGlzYWJsZWRdLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWluZm8sCgkJLmJ0bi1pbmZvLmRpc2FibGVkOmhvdmVyLAoJCS5idG4taW5mb1tkaXNhYmxlZF06aG92ZXIsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4taW5mbzpob3ZlciwKCQkuYnRuLWluZm8uZGlzYWJsZWQ6Zm9jdXMsCgkJLmJ0bi1pbmZvW2Rpc2FibGVkXTpmb2N1cywKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1pbmZvOmZvY3VzLAoJCS5idG4taW5mby5kaXNhYmxlZDphY3RpdmUsCgkJLmJ0bi1pbmZvW2Rpc2FibGVkXTphY3RpdmUsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4taW5mbzphY3RpdmUsCgkJLmJ0bi1pbmZvLmRpc2FibGVkLmFjdGl2ZSwKCQkuYnRuLWluZm9bZGlzYWJsZWRdLmFjdGl2ZSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1pbmZvLmFjdGl2ZSB7CgkJYmFja2dyb3VuZC1jb2xvcjogIzM2OTsKCQlib3JkZXItY29sb3I6ICMzNjkKCQl9CgoJCS5idG4tbGluayB7CgkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQljb2xvcjogI2ViNjg2NDsKCQljdXJzb3I6IHBvaW50ZXI7CgkJYm9yZGVyLXJhZGl1czogMAoJCX0KCgkJLmJ0bi1saW5rLAoJCS5idG4tbGluazphY3RpdmUsCgkJLmJ0bi1saW5rW2Rpc2FibGVkXSwKCQlmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1saW5rIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKCQktd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7CgkJYm94LXNoYWRvdzogbm9uZQoJCX0KCgkJLmJ0bi1saW5rLAoJCS5idG4tbGluazpob3ZlciwKCQkuYnRuLWxpbms6Zm9jdXMsCgkJLmJ0bi1saW5rOmFjdGl2ZSB7CgkJYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLmJ0bi1saW5rOmhvdmVyLAoJCS5idG4tbGluazpmb2N1cyB7CgkJY29sb3I6ICNlMjI2MjA7CgkJdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQKCQl9CgoJCS5idG4tbGlua1tkaXNhYmxlZF06aG92ZXIsCgkJZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tbGluazpob3ZlciwKCQkuYnRuLWxpbmtbZGlzYWJsZWRdOmZvY3VzLAoJCWZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWxpbms6Zm9jdXMgewoJCWNvbG9yOiAjOTk5OwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZQoJCX0KCgkJLmJ0bi1sZyB7CgkJcGFkZGluZzogMTRweCAxNnB4OwoJCWZvbnQtc2l6ZTogMTlweDsKCQlsaW5lLWhlaWdodDogMS4zMzsKCQlib3JkZXItcmFkaXVzOiA2cHgKCQl9CgoJCS5idG4tc20sCgkJLmJ0bi14cyB7CgkJcGFkZGluZzogNXB4IDEwcHg7CgkJZm9udC1zaXplOiAxM3B4OwoJCWxpbmUtaGVpZ2h0OiAxLjU7CgkJYm9yZGVyLXJhZGl1czogM3B4CgkJfQoKCQkuYnRuLXhzIHsKCQlwYWRkaW5nOiAxcHggNXB4CgkJfQoKCQkuYnRuLWJsb2NrIHsKCQlkaXNwbGF5OiBibG9jazsKCQl3aWR0aDogMTAwJTsKCQlwYWRkaW5nLXJpZ2h0OiAwOwoJCXBhZGRpbmctbGVmdDogMAoJCX0KCgkJLmJ0bi1ibG9jaysuYnRuLWJsb2NrIHsKCQltYXJnaW4tdG9wOiA1cHgKCQl9CgoJCWlucHV0W3R5cGU9InN1Ym1pdCJdLmJ0bi1ibG9jaywKCQlpbnB1dFt0eXBlPSJyZXNldCJdLmJ0bi1ibG9jaywKCQlpbnB1dFt0eXBlPSJidXR0b24iXS5idG4tYmxvY2sgewoJCXdpZHRoOiAxMDAlCgkJfQoKCQkuZmFkZSB7CgkJb3BhY2l0eTogMDsKCQktd2Via2l0LXRyYW5zaXRpb246IG9wYWNpdHkgLjE1cyBsaW5lYXI7CgkJdHJhbnNpdGlvbjogb3BhY2l0eSAuMTVzIGxpbmVhcgoJCX0KCgkJLmZhZGUuaW4gewoJCW9wYWNpdHk6IDEKCQl9CgoJCS5jb2xsYXBzZSB7CgkJZGlzcGxheTogbm9uZQoJCX0KCgkJLmNvbGxhcHNlLmluIHsKCQlkaXNwbGF5OiBibG9jawoJCX0KCgkJLmNvbGxhcHNpbmcgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQloZWlnaHQ6IDA7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQktd2Via2l0LXRyYW5zaXRpb246IGhlaWdodCAuMzVzIGVhc2U7CgkJdHJhbnNpdGlvbjogaGVpZ2h0IC4zNXMgZWFzZQoJCX0KCgkJQGZvbnQtZmFjZSB7CgkJZm9udC1mYW1pbHk6ICdHbHlwaGljb25zIEhhbGZsaW5ncyc7CgkJc3JjOiB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIuZW90Jyk7CgkJc3JjOiB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIuZW90PyNpZWZpeCcpIGZvcm1hdCgnZW1iZWRkZWQtb3BlbnR5cGUnKSwgdXJsKCcuLi9mb250cy9nbHlwaGljb25zLWhhbGZsaW5ncy1yZWd1bGFyLndvZmYnKSBmb3JtYXQoJ3dvZmYnKSwgdXJsKCcuLi9mb250cy9nbHlwaGljb25zLWhhbGZsaW5ncy1yZWd1bGFyLnR0ZicpIGZvcm1hdCgndHJ1ZXR5cGUnKSwgdXJsKCcuLi9mb250cy9nbHlwaGljb25zLWhhbGZsaW5ncy1yZWd1bGFyLnN2ZyNnbHlwaGljb25zLWhhbGZsaW5nc3JlZ3VsYXInKSBmb3JtYXQoJ3N2ZycpCgkJfQoKCQkuZ2x5cGhpY29uIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJdG9wOiAxcHg7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCWZvbnQtZmFtaWx5OiAnR2x5cGhpY29ucyBIYWxmbGluZ3MnOwoJCS13ZWJraXQtZm9udC1zbW9vdGhpbmc6IGFudGlhbGlhc2VkOwoJCWZvbnQtc3R5bGU6IG5vcm1hbDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCWxpbmUtaGVpZ2h0OiAxCgkJfQoKCQkuZ2x5cGhpY29uLWFzdGVyaXNrOmJlZm9yZSB7CgkJY29udGVudDogIlwyYSIKCQl9CgoJCS5nbHlwaGljb24tcGx1czpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcMmIiCgkJfQoKCQkuZ2x5cGhpY29uLWV1cm86YmVmb3JlIHsKCQljb250ZW50OiAiXDIwYWMiCgkJfQoKCQkuZ2x5cGhpY29uLW1pbnVzOmJlZm9yZSB7CgkJY29udGVudDogIlwyMjEyIgoJCX0KCgkJLmdseXBoaWNvbi1jbG91ZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcMjYwMSIKCQl9CgoJCS5nbHlwaGljb24tZW52ZWxvcGU6YmVmb3JlIHsKCQljb250ZW50OiAiXDI3MDkiCgkJfQoKCQkuZ2x5cGhpY29uLXBlbmNpbDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcMjcwZiIKCQl9CgoJCS5nbHlwaGljb24tZ2xhc3M6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMDEiCgkJfQoKCQkuZ2x5cGhpY29uLW11c2ljOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDAyIgoJCX0KCgkJLmdseXBoaWNvbi1zZWFyY2g6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMDMiCgkJfQoKCQkuZ2x5cGhpY29uLWhlYXJ0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDA1IgoJCX0KCgkJLmdseXBoaWNvbi1zdGFyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDA2IgoJCX0KCgkJLmdseXBoaWNvbi1zdGFyLWVtcHR5OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDA3IgoJCX0KCgkJLmdseXBoaWNvbi11c2VyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDA4IgoJCX0KCgkJLmdseXBoaWNvbi1maWxtOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDA5IgoJCX0KCgkJLmdseXBoaWNvbi10aC1sYXJnZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAxMCIKCQl9CgoJCS5nbHlwaGljb24tdGg6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMTEiCgkJfQoKCQkuZ2x5cGhpY29uLXRoLWxpc3Q6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMTIiCgkJfQoKCQkuZ2x5cGhpY29uLW9rOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDEzIgoJCX0KCgkJLmdseXBoaWNvbi1yZW1vdmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMTQiCgkJfQoKCQkuZ2x5cGhpY29uLXpvb20taW46YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMTUiCgkJfQoKCQkuZ2x5cGhpY29uLXpvb20tb3V0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDE2IgoJCX0KCgkJLmdseXBoaWNvbi1vZmY6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMTciCgkJfQoKCQkuZ2x5cGhpY29uLXNpZ25hbDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAxOCIKCQl9CgoJCS5nbHlwaGljb24tY29nOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDE5IgoJCX0KCgkJLmdseXBoaWNvbi10cmFzaDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyMCIKCQl9CgoJCS5nbHlwaGljb24taG9tZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyMSIKCQl9CgoJCS5nbHlwaGljb24tZmlsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyMiIKCQl9CgoJCS5nbHlwaGljb24tdGltZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyMyIKCQl9CgoJCS5nbHlwaGljb24tcm9hZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyNCIKCQl9CgoJCS5nbHlwaGljb24tZG93bmxvYWQtYWx0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDI1IgoJCX0KCgkJLmdseXBoaWNvbi1kb3dubG9hZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyNiIKCQl9CgoJCS5nbHlwaGljb24tdXBsb2FkOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDI3IgoJCX0KCgkJLmdseXBoaWNvbi1pbmJveDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAyOCIKCQl9CgoJCS5nbHlwaGljb24tcGxheS1jaXJjbGU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMjkiCgkJfQoKCQkuZ2x5cGhpY29uLXJlcGVhdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAzMCIKCQl9CgoJCS5nbHlwaGljb24tcmVmcmVzaDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAzMSIKCQl9CgoJCS5nbHlwaGljb24tbGlzdC1hbHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMzIiCgkJfQoKCQkuZ2x5cGhpY29uLWZsYWc6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMzQiCgkJfQoKCQkuZ2x5cGhpY29uLWhlYWRwaG9uZXM6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMzUiCgkJfQoKCQkuZ2x5cGhpY29uLXZvbHVtZS1vZmY6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMzYiCgkJfQoKCQkuZ2x5cGhpY29uLXZvbHVtZS1kb3duOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDM3IgoJCX0KCgkJLmdseXBoaWNvbi12b2x1bWUtdXA6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwMzgiCgkJfQoKCQkuZ2x5cGhpY29uLXFyY29kZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTAzOSIKCQl9CgoJCS5nbHlwaGljb24tYmFyY29kZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA0MCIKCQl9CgoJCS5nbHlwaGljb24tdGFnOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDQxIgoJCX0KCgkJLmdseXBoaWNvbi10YWdzOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDQyIgoJCX0KCgkJLmdseXBoaWNvbi1ib29rOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDQzIgoJCX0KCgkJLmdseXBoaWNvbi1wcmludDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA0NSIKCQl9CgoJCS5nbHlwaGljb24tZm9udDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA0NyIKCQl9CgoJCS5nbHlwaGljb24tYm9sZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA0OCIKCQl9CgoJCS5nbHlwaGljb24taXRhbGljOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDQ5IgoJCX0KCgkJLmdseXBoaWNvbi10ZXh0LWhlaWdodDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1MCIKCQl9CgoJCS5nbHlwaGljb24tdGV4dC13aWR0aDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1MSIKCQl9CgoJCS5nbHlwaGljb24tYWxpZ24tbGVmdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1MiIKCQl9CgoJCS5nbHlwaGljb24tYWxpZ24tY2VudGVyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDUzIgoJCX0KCgkJLmdseXBoaWNvbi1hbGlnbi1yaWdodDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1NCIKCQl9CgoJCS5nbHlwaGljb24tYWxpZ24tanVzdGlmeTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1NSIKCQl9CgoJCS5nbHlwaGljb24tbGlzdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1NiIKCQl9CgoJCS5nbHlwaGljb24taW5kZW50LWxlZnQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNTciCgkJfQoKCQkuZ2x5cGhpY29uLWluZGVudC1yaWdodDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA1OCIKCQl9CgoJCS5nbHlwaGljb24tZmFjZXRpbWUtdmlkZW86YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNTkiCgkJfQoKCQkuZ2x5cGhpY29uLXBpY3R1cmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNjAiCgkJfQoKCQkuZ2x5cGhpY29uLW1hcC1tYXJrZXI6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNjIiCgkJfQoKCQkuZ2x5cGhpY29uLWFkanVzdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA2MyIKCQl9CgoJCS5nbHlwaGljb24tdGludDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA2NCIKCQl9CgoJCS5nbHlwaGljb24tZWRpdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA2NSIKCQl9CgoJCS5nbHlwaGljb24tc2hhcmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNjYiCgkJfQoKCQkuZ2x5cGhpY29uLWNoZWNrOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDY3IgoJCX0KCgkJLmdseXBoaWNvbi1tb3ZlOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDY4IgoJCX0KCgkJLmdseXBoaWNvbi1zdGVwLWJhY2t3YXJkOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDY5IgoJCX0KCgkJLmdseXBoaWNvbi1mYXN0LWJhY2t3YXJkOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDcwIgoJCX0KCgkJLmdseXBoaWNvbi1iYWNrd2FyZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA3MSIKCQl9CgoJCS5nbHlwaGljb24tcGxheTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA3MiIKCQl9CgoJCS5nbHlwaGljb24tcGF1c2U6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNzMiCgkJfQoKCQkuZ2x5cGhpY29uLXN0b3A6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNzQiCgkJfQoKCQkuZ2x5cGhpY29uLWZvcndhcmQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwNzUiCgkJfQoKCQkuZ2x5cGhpY29uLWZhc3QtZm9yd2FyZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA3NiIKCQl9CgoJCS5nbHlwaGljb24tc3RlcC1mb3J3YXJkOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDc3IgoJCX0KCgkJLmdseXBoaWNvbi1lamVjdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA3OCIKCQl9CgoJCS5nbHlwaGljb24tY2hldnJvbi1sZWZ0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDc5IgoJCX0KCgkJLmdseXBoaWNvbi1jaGV2cm9uLXJpZ2h0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMDgwIgoJCX0KCgkJLmdseXBoaWNvbi1wbHVzLXNpZ246YmVmb3JlIHsKCQljb250ZW50OiAiXGUwODEiCgkJfQoKCQkuZ2x5cGhpY29uLW1pbnVzLXNpZ246YmVmb3JlIHsKCQljb250ZW50OiAiXGUwODIiCgkJfQoKCQkuZ2x5cGhpY29uLXJlbW92ZS1zaWduOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDgzIgoJCX0KCgkJLmdseXBoaWNvbi1vay1zaWduOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDg0IgoJCX0KCgkJLmdseXBoaWNvbi1xdWVzdGlvbi1zaWduOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDg1IgoJCX0KCgkJLmdseXBoaWNvbi1pbmZvLXNpZ246YmVmb3JlIHsKCQljb250ZW50OiAiXGUwODYiCgkJfQoKCQkuZ2x5cGhpY29uLXNjcmVlbnNob3Q6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwODciCgkJfQoKCQkuZ2x5cGhpY29uLXJlbW92ZS1jaXJjbGU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwODgiCgkJfQoKCQkuZ2x5cGhpY29uLW9rLWNpcmNsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA4OSIKCQl9CgoJCS5nbHlwaGljb24tYmFuLWNpcmNsZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA5MCIKCQl9CgoJCS5nbHlwaGljb24tYXJyb3ctbGVmdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTA5MSIKCQl9CgoJCS5nbHlwaGljb24tYXJyb3ctcmlnaHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwOTIiCgkJfQoKCQkuZ2x5cGhpY29uLWFycm93LXVwOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDkzIgoJCX0KCgkJLmdseXBoaWNvbi1hcnJvdy1kb3duOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDk0IgoJCX0KCgkJLmdseXBoaWNvbi1zaGFyZS1hbHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwOTUiCgkJfQoKCQkuZ2x5cGhpY29uLXJlc2l6ZS1mdWxsOmJlZm9yZSB7CgkJY29udGVudDogIlxlMDk2IgoJCX0KCgkJLmdseXBoaWNvbi1yZXNpemUtc21hbGw6YmVmb3JlIHsKCQljb250ZW50OiAiXGUwOTciCgkJfQoKCQkuZ2x5cGhpY29uLWV4Y2xhbWF0aW9uLXNpZ246YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMDEiCgkJfQoKCQkuZ2x5cGhpY29uLWdpZnQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMDIiCgkJfQoKCQkuZ2x5cGhpY29uLWxlYWY6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMDMiCgkJfQoKCQkuZ2x5cGhpY29uLWV5ZS1vcGVuOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTA1IgoJCX0KCgkJLmdseXBoaWNvbi1leWUtY2xvc2U6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMDYiCgkJfQoKCQkuZ2x5cGhpY29uLXdhcm5pbmctc2lnbjpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTEwNyIKCQl9CgoJCS5nbHlwaGljb24tcGxhbmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMDgiCgkJfQoKCQkuZ2x5cGhpY29uLXJhbmRvbTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTExMCIKCQl9CgoJCS5nbHlwaGljb24tY29tbWVudDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTExMSIKCQl9CgoJCS5nbHlwaGljb24tbWFnbmV0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTEyIgoJCX0KCgkJLmdseXBoaWNvbi1jaGV2cm9uLXVwOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTEzIgoJCX0KCgkJLmdseXBoaWNvbi1jaGV2cm9uLWRvd246YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMTQiCgkJfQoKCQkuZ2x5cGhpY29uLXJldHdlZXQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMTUiCgkJfQoKCQkuZ2x5cGhpY29uLXNob3BwaW5nLWNhcnQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMTYiCgkJfQoKCQkuZ2x5cGhpY29uLWZvbGRlci1jbG9zZTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTExNyIKCQl9CgoJCS5nbHlwaGljb24tZm9sZGVyLW9wZW46YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMTgiCgkJfQoKCQkuZ2x5cGhpY29uLXJlc2l6ZS12ZXJ0aWNhbDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTExOSIKCQl9CgoJCS5nbHlwaGljb24tcmVzaXplLWhvcml6b250YWw6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMjAiCgkJfQoKCQkuZ2x5cGhpY29uLWhkZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTEyMSIKCQl9CgoJCS5nbHlwaGljb24tYnVsbGhvcm46YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMjIiCgkJfQoKCQkuZ2x5cGhpY29uLWNlcnRpZmljYXRlOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTI0IgoJCX0KCgkJLmdseXBoaWNvbi10aHVtYnMtdXA6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMjUiCgkJfQoKCQkuZ2x5cGhpY29uLXRodW1icy1kb3duOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTI2IgoJCX0KCgkJLmdseXBoaWNvbi1oYW5kLXJpZ2h0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTI3IgoJCX0KCgkJLmdseXBoaWNvbi1oYW5kLWxlZnQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMjgiCgkJfQoKCQkuZ2x5cGhpY29uLWhhbmQtdXA6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMjkiCgkJfQoKCQkuZ2x5cGhpY29uLWhhbmQtZG93bjpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTEzMCIKCQl9CgoJCS5nbHlwaGljb24tY2lyY2xlLWFycm93LXJpZ2h0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTMxIgoJCX0KCgkJLmdseXBoaWNvbi1jaXJjbGUtYXJyb3ctbGVmdDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTEzMiIKCQl9CgoJCS5nbHlwaGljb24tY2lyY2xlLWFycm93LXVwOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTMzIgoJCX0KCgkJLmdseXBoaWNvbi1jaXJjbGUtYXJyb3ctZG93bjpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTEzNCIKCQl9CgoJCS5nbHlwaGljb24tZ2xvYmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMzUiCgkJfQoKCQkuZ2x5cGhpY29uLXRhc2tzOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTM3IgoJCX0KCgkJLmdseXBoaWNvbi1maWx0ZXI6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxMzgiCgkJfQoKCQkuZ2x5cGhpY29uLWZ1bGxzY3JlZW46YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNDAiCgkJfQoKCQkuZ2x5cGhpY29uLWRhc2hib2FyZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE0MSIKCQl9CgoJCS5nbHlwaGljb24taGVhcnQtZW1wdHk6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNDMiCgkJfQoKCQkuZ2x5cGhpY29uLWxpbms6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNDQiCgkJfQoKCQkuZ2x5cGhpY29uLXBob25lOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTQ1IgoJCX0KCgkJLmdseXBoaWNvbi11c2Q6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNDgiCgkJfQoKCQkuZ2x5cGhpY29uLWdicDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE0OSIKCQl9CgoJCS5nbHlwaGljb24tc29ydDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE1MCIKCQl9CgoJCS5nbHlwaGljb24tc29ydC1ieS1hbHBoYWJldDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE1MSIKCQl9CgoJCS5nbHlwaGljb24tc29ydC1ieS1hbHBoYWJldC1hbHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNTIiCgkJfQoKCQkuZ2x5cGhpY29uLXNvcnQtYnktb3JkZXI6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNTMiCgkJfQoKCQkuZ2x5cGhpY29uLXNvcnQtYnktb3JkZXItYWx0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTU0IgoJCX0KCgkJLmdseXBoaWNvbi1zb3J0LWJ5LWF0dHJpYnV0ZXM6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNTUiCgkJfQoKCQkuZ2x5cGhpY29uLXNvcnQtYnktYXR0cmlidXRlcy1hbHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNTYiCgkJfQoKCQkuZ2x5cGhpY29uLXVuY2hlY2tlZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE1NyIKCQl9CgoJCS5nbHlwaGljb24tZXhwYW5kOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTU4IgoJCX0KCgkJLmdseXBoaWNvbi1jb2xsYXBzZS1kb3duOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTU5IgoJCX0KCgkJLmdseXBoaWNvbi1jb2xsYXBzZS11cDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE2MCIKCQl9CgoJCS5nbHlwaGljb24tbG9nLWluOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTYxIgoJCX0KCgkJLmdseXBoaWNvbi1mbGFzaDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE2MiIKCQl9CgoJCS5nbHlwaGljb24tbG9nLW91dDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE2MyIKCQl9CgoJCS5nbHlwaGljb24tbmV3LXdpbmRvdzpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE2NCIKCQl9CgoJCS5nbHlwaGljb24tcmVjb3JkOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTY1IgoJCX0KCgkJLmdseXBoaWNvbi1zYXZlOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTY2IgoJCX0KCgkJLmdseXBoaWNvbi1vcGVuOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTY3IgoJCX0KCgkJLmdseXBoaWNvbi1zYXZlZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE2OCIKCQl9CgoJCS5nbHlwaGljb24taW1wb3J0OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTY5IgoJCX0KCgkJLmdseXBoaWNvbi1leHBvcnQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNzAiCgkJfQoKCQkuZ2x5cGhpY29uLXNlbmQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNzEiCgkJfQoKCQkuZ2x5cGhpY29uLWZsb3BweS1kaXNrOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTcyIgoJCX0KCgkJLmdseXBoaWNvbi1mbG9wcHktc2F2ZWQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNzMiCgkJfQoKCQkuZ2x5cGhpY29uLWZsb3BweS1yZW1vdmU6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNzQiCgkJfQoKCQkuZ2x5cGhpY29uLWZsb3BweS1zYXZlOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTc1IgoJCX0KCgkJLmdseXBoaWNvbi1mbG9wcHktb3BlbjpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE3NiIKCQl9CgoJCS5nbHlwaGljb24tY3JlZGl0LWNhcmQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxNzciCgkJfQoKCQkuZ2x5cGhpY29uLXRyYW5zZmVyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTc4IgoJCX0KCgkJLmdseXBoaWNvbi1jdXRsZXJ5OmJlZm9yZSB7CgkJY29udGVudDogIlxlMTc5IgoJCX0KCgkJLmdseXBoaWNvbi1oZWFkZXI6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxODAiCgkJfQoKCQkuZ2x5cGhpY29uLWNvbXByZXNzZWQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxODEiCgkJfQoKCQkuZ2x5cGhpY29uLWVhcnBob25lOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTgyIgoJCX0KCgkJLmdseXBoaWNvbi1waG9uZS1hbHQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxODMiCgkJfQoKCQkuZ2x5cGhpY29uLXRvd2VyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTg0IgoJCX0KCgkJLmdseXBoaWNvbi1zdGF0czpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE4NSIKCQl9CgoJCS5nbHlwaGljb24tc2QtdmlkZW86YmVmb3JlIHsKCQljb250ZW50OiAiXGUxODYiCgkJfQoKCQkuZ2x5cGhpY29uLWhkLXZpZGVvOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTg3IgoJCX0KCgkJLmdseXBoaWNvbi1zdWJ0aXRsZXM6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxODgiCgkJfQoKCQkuZ2x5cGhpY29uLXNvdW5kLXN0ZXJlbzpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE4OSIKCQl9CgoJCS5nbHlwaGljb24tc291bmQtZG9sYnk6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxOTAiCgkJfQoKCQkuZ2x5cGhpY29uLXNvdW5kLTUtMTpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE5MSIKCQl9CgoJCS5nbHlwaGljb24tc291bmQtNi0xOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTkyIgoJCX0KCgkJLmdseXBoaWNvbi1zb3VuZC03LTE6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxOTMiCgkJfQoKCQkuZ2x5cGhpY29uLWNvcHlyaWdodC1tYXJrOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTk0IgoJCX0KCgkJLmdseXBoaWNvbi1yZWdpc3RyYXRpb24tbWFyazpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE5NSIKCQl9CgoJCS5nbHlwaGljb24tY2xvdWQtZG93bmxvYWQ6YmVmb3JlIHsKCQljb250ZW50OiAiXGUxOTciCgkJfQoKCQkuZ2x5cGhpY29uLWNsb3VkLXVwbG9hZDpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTE5OCIKCQl9CgoJCS5nbHlwaGljb24tdHJlZS1jb25pZmVyOmJlZm9yZSB7CgkJY29udGVudDogIlxlMTk5IgoJCX0KCgkJLmdseXBoaWNvbi10cmVlLWRlY2lkdW91czpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcZTIwMCIKCQl9CgoJCS5nbHlwaGljb24tYnJpZWZjYXNlOmJlZm9yZSB7CgkJY29udGVudDogIlwxZjRiYyIKCQl9CgoJCS5nbHlwaGljb24tY2FsZW5kYXI6YmVmb3JlIHsKCQljb250ZW50OiAiXDFmNGM1IgoJCX0KCgkJLmdseXBoaWNvbi1wdXNocGluOmJlZm9yZSB7CgkJY29udGVudDogIlwxZjRjYyIKCQl9CgoJCS5nbHlwaGljb24tcGFwZXJjbGlwOmJlZm9yZSB7CgkJY29udGVudDogIlwxZjRjZSIKCQl9CgoJCS5nbHlwaGljb24tY2FtZXJhOmJlZm9yZSB7CgkJY29udGVudDogIlwxZjRmNyIKCQl9CgoJCS5nbHlwaGljb24tbG9jazpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcMWY1MTIiCgkJfQoKCQkuZ2x5cGhpY29uLWJlbGw6YmVmb3JlIHsKCQljb250ZW50OiAiXDFmNTE0IgoJCX0KCgkJLmdseXBoaWNvbi1ib29rbWFyazpiZWZvcmUgewoJCWNvbnRlbnQ6ICJcMWY1MTYiCgkJfQoKCQkuZ2x5cGhpY29uLWZpcmU6YmVmb3JlIHsKCQljb250ZW50OiAiXDFmNTI1IgoJCX0KCgkJLmdseXBoaWNvbi13cmVuY2g6YmVmb3JlIHsKCQljb250ZW50OiAiXDFmNTI3IgoJCX0KCgkJLmNhcmV0IHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJd2lkdGg6IDA7CgkJaGVpZ2h0OiAwOwoJCW1hcmdpbi1sZWZ0OiAycHg7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZTsKCQlib3JkZXItdG9wOiA0cHggc29saWQgIzAwMDsKCQlib3JkZXItcmlnaHQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsKCQlib3JkZXItYm90dG9tOiAwIGRvdHRlZDsKCQlib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50OwoJCWNvbnRlbnQ6ICIiCgkJfQoKCQkuZHJvcGRvd24gewoJCXBvc2l0aW9uOiByZWxhdGl2ZQoJCX0KCgkJLmRyb3Bkb3duLXRvZ2dsZTpmb2N1cyB7CgkJb3V0bGluZTogMAoJCX0KCgkJLmRyb3Bkb3duLW1lbnUgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQl0b3A6IDEwMCU7CgkJbGVmdDogMDsKCQl6LWluZGV4OiAxMDAwOwoJCWRpc3BsYXk6IG5vbmU7CgkJZmxvYXQ6IGxlZnQ7CgkJbWluLXdpZHRoOiAxNjBweDsKCQlwYWRkaW5nOiA1cHggMDsKCQltYXJnaW46IDJweCAwIDA7CgkJZm9udC1zaXplOiAxNXB4OwoJCWxpc3Qtc3R5bGU6IG5vbmU7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCQlib3JkZXI6IDFweCBzb2xpZCAjY2NjOwoJCWJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC4xNSk7CgkJYm9yZGVyLXJhZGl1czogNHB4OwoJCS13ZWJraXQtYm94LXNoYWRvdzogMCA2cHggMTJweCByZ2JhKDAsIDAsIDAsIDAuMTc1KTsKCQlib3gtc2hhZG93OiAwIDZweCAxMnB4IHJnYmEoMCwgMCwgMCwgMC4xNzUpOwoJCWJhY2tncm91bmQtY2xpcDogcGFkZGluZy1ib3gKCQl9CgoJCS5kcm9wZG93bi1tZW51LnB1bGwtcmlnaHQgewoJCXJpZ2h0OiAwOwoJCWxlZnQ6IGF1dG8KCQl9CgoJCS5kcm9wZG93bi1tZW51IC5kaXZpZGVyIHsKCQloZWlnaHQ6IDFweDsKCQltYXJnaW46IDkuNXB4IDA7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZTVlNWU1CgkJfQoKCQkuZHJvcGRvd24tbWVudT5saT5hIHsKCQlkaXNwbGF5OiBibG9jazsKCQlwYWRkaW5nOiAzcHggMjBweDsKCQljbGVhcjogYm90aDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCWxpbmUtaGVpZ2h0OiAxLjQyODU3MTQyOTsKCQljb2xvcjogIzMzMzsKCQl3aGl0ZS1zcGFjZTogbm93cmFwCgkJfQoKCQkuZHJvcGRvd24tbWVudT5saT5hOmhvdmVyLAoJCS5kcm9wZG93bi1tZW51PmxpPmE6Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWI2ODY0CgkJfQoKCQkuZHJvcGRvd24tbWVudT4uYWN0aXZlPmEsCgkJLmRyb3Bkb3duLW1lbnU+LmFjdGl2ZT5hOmhvdmVyLAoJCS5kcm9wZG93bi1tZW51Pi5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICNmZmY7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWJhY2tncm91bmQtY29sb3I6ICNlYjY4NjQ7CgkJb3V0bGluZTogMAoJCX0KCgkJLmRyb3Bkb3duLW1lbnU+LmRpc2FibGVkPmEsCgkJLmRyb3Bkb3duLW1lbnU+LmRpc2FibGVkPmE6aG92ZXIsCgkJLmRyb3Bkb3duLW1lbnU+LmRpc2FibGVkPmE6Zm9jdXMgewoJCWNvbG9yOiAjOTk5CgkJfQoKCQkuZHJvcGRvd24tbWVudT4uZGlzYWJsZWQ+YTpob3ZlciwKCQkuZHJvcGRvd24tbWVudT4uZGlzYWJsZWQ+YTpmb2N1cyB7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWN1cnNvcjogbm90LWFsbG93ZWQ7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CgkJYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKCQlmaWx0ZXI6IHByb2dpZDogRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoZW5hYmxlZD1mYWxzZSkKCQl9CgoJCS5vcGVuPi5kcm9wZG93bi1tZW51IHsKCQlkaXNwbGF5OiBibG9jawoJCX0KCgkJLm9wZW4+YSB7CgkJb3V0bGluZTogMAoJCX0KCgkJLmRyb3Bkb3duLWhlYWRlciB7CgkJZGlzcGxheTogYmxvY2s7CgkJcGFkZGluZzogM3B4IDIwcHg7CgkJZm9udC1zaXplOiAxM3B4OwoJCWxpbmUtaGVpZ2h0OiAxLjQyODU3MTQyOTsKCQljb2xvcjogIzk5OQoJCX0KCgkJLmRyb3Bkb3duLWJhY2tkcm9wIHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJdG9wOiAwOwoJCXJpZ2h0OiAwOwoJCWJvdHRvbTogMDsKCQlsZWZ0OiAwOwoJCXotaW5kZXg6IDk5MAoJCX0KCgkJLnB1bGwtcmlnaHQ+LmRyb3Bkb3duLW1lbnUgewoJCXJpZ2h0OiAwOwoJCWxlZnQ6IGF1dG8KCQl9CgoJCS5kcm9wdXAgLmNhcmV0LAoJCS5uYXZiYXItZml4ZWQtYm90dG9tIC5kcm9wZG93biAuY2FyZXQgewoJCWJvcmRlci10b3A6IDAgZG90dGVkOwoJCWJvcmRlci1ib3R0b206IDRweCBzb2xpZCAjMDAwOwoJCWNvbnRlbnQ6ICIiCgkJfQoKCQkuZHJvcHVwIC5kcm9wZG93bi1tZW51LAoJCS5uYXZiYXItZml4ZWQtYm90dG9tIC5kcm9wZG93biAuZHJvcGRvd24tbWVudSB7CgkJdG9wOiBhdXRvOwoJCWJvdHRvbTogMTAwJTsKCQltYXJnaW4tYm90dG9tOiAxcHgKCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIHsKCQkubmF2YmFyLXJpZ2h0IC5kcm9wZG93bi1tZW51IHsKCQlyaWdodDogMDsKCQlsZWZ0OiBhdXRvCgkJfQoJCX0KCgkJLmJ0bi1kZWZhdWx0IC5jYXJldCB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2ZmZgoJCX0KCgkJLmJ0bi1wcmltYXJ5IC5jYXJldCwKCQkuYnRuLXN1Y2Nlc3MgLmNhcmV0LAoJCS5idG4td2FybmluZyAuY2FyZXQsCgkJLmJ0bi1kYW5nZXIgLmNhcmV0LAoJCS5idG4taW5mbyAuY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICNmZmYKCQl9CgoJCS5kcm9wdXAgLmJ0bi1kZWZhdWx0IC5jYXJldCB7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZgoJCX0KCgkJLmRyb3B1cCAuYnRuLXByaW1hcnkgLmNhcmV0LAoJCS5kcm9wdXAgLmJ0bi1zdWNjZXNzIC5jYXJldCwKCQkuZHJvcHVwIC5idG4td2FybmluZyAuY2FyZXQsCgkJLmRyb3B1cCAuYnRuLWRhbmdlciAuY2FyZXQsCgkJLmRyb3B1cCAuYnRuLWluZm8gLmNhcmV0IHsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmCgkJfQoKCQkuYnRuLWdyb3VwLAoJCS5idG4tZ3JvdXAtdmVydGljYWwgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJdmVydGljYWwtYWxpZ246IG1pZGRsZQoJCX0KCgkJLmJ0bi1ncm91cD4uYnRuLAoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0biB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWZsb2F0OiBsZWZ0CgkJfQoKCQkuYnRuLWdyb3VwPi5idG46aG92ZXIsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuOmhvdmVyLAoJCS5idG4tZ3JvdXA+LmJ0bjpmb2N1cywKCQkuYnRuLWdyb3VwLXZlcnRpY2FsPi5idG46Zm9jdXMsCgkJLmJ0bi1ncm91cD4uYnRuOmFjdGl2ZSwKCQkuYnRuLWdyb3VwLXZlcnRpY2FsPi5idG46YWN0aXZlLAoJCS5idG4tZ3JvdXA+LmJ0bi5hY3RpdmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLmFjdGl2ZSB7CgkJei1pbmRleDogMgoJCX0KCgkJLmJ0bi1ncm91cD4uYnRuOmZvY3VzLAoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bjpmb2N1cyB7CgkJb3V0bGluZTogMAoJCX0KCgkJLmJ0bi1ncm91cCAuYnRuKy5idG4sCgkJLmJ0bi1ncm91cCAuYnRuKy5idG4tZ3JvdXAsCgkJLmJ0bi1ncm91cCAuYnRuLWdyb3VwKy5idG4sCgkJLmJ0bi1ncm91cCAuYnRuLWdyb3VwKy5idG4tZ3JvdXAgewoJCW1hcmdpbi1sZWZ0OiAtMXB4CgkJfQoKCQkuYnRuLXRvb2xiYXI6YmVmb3JlLAoJCS5idG4tdG9vbGJhcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuYnRuLXRvb2xiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuYnRuLXRvb2xiYXI6YmVmb3JlLAoJCS5idG4tdG9vbGJhcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuYnRuLXRvb2xiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuYnRuLXRvb2xiYXI6YmVmb3JlLAoJCS5idG4tdG9vbGJhcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuYnRuLXRvb2xiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuYnRuLXRvb2xiYXI6YmVmb3JlLAoJCS5idG4tdG9vbGJhcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuYnRuLXRvb2xiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuYnRuLXRvb2xiYXI6YmVmb3JlLAoJCS5idG4tdG9vbGJhcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkuYnRuLXRvb2xiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkuYnRuLXRvb2xiYXIgLmJ0bi1ncm91cCB7CgkJZmxvYXQ6IGxlZnQKCQl9CgoJCS5idG4tdG9vbGJhcj4uYnRuKy5idG4sCgkJLmJ0bi10b29sYmFyPi5idG4tZ3JvdXArLmJ0biwKCQkuYnRuLXRvb2xiYXI+LmJ0bisuYnRuLWdyb3VwLAoJCS5idG4tdG9vbGJhcj4uYnRuLWdyb3VwKy5idG4tZ3JvdXAgewoJCW1hcmdpbi1sZWZ0OiA1cHgKCQl9CgoJCS5idG4tZ3JvdXA+LmJ0bjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpOm5vdCguZHJvcGRvd24tdG9nZ2xlKSB7CgkJYm9yZGVyLXJhZGl1czogMAoJCX0KCgkJLmJ0bi1ncm91cD4uYnRuOmZpcnN0LWNoaWxkIHsKCQltYXJnaW4tbGVmdDogMAoJCX0KCgkJLmJ0bi1ncm91cD4uYnRuOmZpcnN0LWNoaWxkOm5vdCg6bGFzdC1jaGlsZCk6bm90KC5kcm9wZG93bi10b2dnbGUpIHsKCQlib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKCQlib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMAoJCX0KCgkJLmJ0bi1ncm91cD4uYnRuOmxhc3QtY2hpbGQ6bm90KDpmaXJzdC1jaGlsZCksCgkJLmJ0bi1ncm91cD4uZHJvcGRvd24tdG9nZ2xlOm5vdCg6Zmlyc3QtY2hpbGQpIHsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwOwoJCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXA+LmJ0bi1ncm91cCB7CgkJZmxvYXQ6IGxlZnQKCQl9CgoJCS5idG4tZ3JvdXA+LmJ0bi1ncm91cDpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpPi5idG4gewoJCWJvcmRlci1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXA+LmJ0bi1ncm91cDpmaXJzdC1jaGlsZD4uYnRuOmxhc3QtY2hpbGQsCgkJLmJ0bi1ncm91cD4uYnRuLWdyb3VwOmZpcnN0LWNoaWxkPi5kcm9wZG93bi10b2dnbGUgewoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOwoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwCgkJfQoKCQkuYnRuLWdyb3VwPi5idG4tZ3JvdXA6bGFzdC1jaGlsZD4uYnRuOmZpcnN0LWNoaWxkIHsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwOwoJCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXAgLmRyb3Bkb3duLXRvZ2dsZTphY3RpdmUsCgkJLmJ0bi1ncm91cC5vcGVuIC5kcm9wZG93bi10b2dnbGUgewoJCW91dGxpbmU6IDAKCQl9CgoJCS5idG4tZ3JvdXAteHM+LmJ0biB7CgkJcGFkZGluZzogNXB4IDEwcHg7CgkJcGFkZGluZzogMXB4IDVweDsKCQlmb250LXNpemU6IDEzcHg7CgkJbGluZS1oZWlnaHQ6IDEuNTsKCQlib3JkZXItcmFkaXVzOiAzcHgKCQl9CgoJCS5idG4tZ3JvdXAtc20+LmJ0biB7CgkJcGFkZGluZzogNXB4IDEwcHg7CgkJZm9udC1zaXplOiAxM3B4OwoJCWxpbmUtaGVpZ2h0OiAxLjU7CgkJYm9yZGVyLXJhZGl1czogM3B4CgkJfQoKCQkuYnRuLWdyb3VwLWxnPi5idG4gewoJCXBhZGRpbmc6IDE0cHggMTZweDsKCQlmb250LXNpemU6IDE5cHg7CgkJbGluZS1oZWlnaHQ6IDEuMzM7CgkJYm9yZGVyLXJhZGl1czogNnB4CgkJfQoKCQkuYnRuLWdyb3VwPi5idG4rLmRyb3Bkb3duLXRvZ2dsZSB7CgkJcGFkZGluZy1yaWdodDogOHB4OwoJCXBhZGRpbmctbGVmdDogOHB4CgkJfQoKCQkuYnRuLWdyb3VwPi5idG4tbGcrLmRyb3Bkb3duLXRvZ2dsZSB7CgkJcGFkZGluZy1yaWdodDogMTJweDsKCQlwYWRkaW5nLWxlZnQ6IDEycHgKCQl9CgoJCS5idG4tZ3JvdXAub3BlbiAuZHJvcGRvd24tdG9nZ2xlIHsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KTsKCQlib3gtc2hhZG93OiBpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAwLjEyNSkKCQl9CgoJCS5idG4gLmNhcmV0IHsKCQltYXJnaW4tbGVmdDogMAoJCX0KCgkJLmJ0bi1sZyAuY2FyZXQgewoJCWJvcmRlci13aWR0aDogNXB4IDVweCAwOwoJCWJvcmRlci1ib3R0b20td2lkdGg6IDAKCQl9CgoJCS5kcm9wdXAgLmJ0bi1sZyAuY2FyZXQgewoJCWJvcmRlci13aWR0aDogMCA1cHggNXB4CgkJfQoKCQkuYnRuLWdyb3VwLXZlcnRpY2FsPi5idG4sCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwIHsKCQlkaXNwbGF5OiBibG9jazsKCQlmbG9hdDogbm9uZTsKCQl3aWR0aDogMTAwJTsKCQltYXgtd2lkdGg6IDEwMCUKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpiZWZvcmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpiZWZvcmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpiZWZvcmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpiZWZvcmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpiZWZvcmUsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cD4uYnRuIHsKCQlmbG9hdDogbm9uZQoJCX0KCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuKy5idG4sCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuKy5idG4tZ3JvdXAsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwKy5idG4sCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwKy5idG4tZ3JvdXAgewoJCW1hcmdpbi10b3A6IC0xcHg7CgkJbWFyZ2luLWxlZnQ6IDAKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpIHsKCQlib3JkZXItcmFkaXVzOiAwCgkJfQoKCQkuYnRuLWdyb3VwLXZlcnRpY2FsPi5idG46Zmlyc3QtY2hpbGQ6bm90KDpsYXN0LWNoaWxkKSB7CgkJYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDRweDsKCQlib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwCgkJfQoKCQkuYnRuLWdyb3VwLXZlcnRpY2FsPi5idG46bGFzdC1jaGlsZDpub3QoOmZpcnN0LWNoaWxkKSB7CgkJYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNHB4OwoJCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpPi5idG4gewoJCWJvcmRlci1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpmaXJzdC1jaGlsZD4uYnRuOmxhc3QtY2hpbGQsCgkJLmJ0bi1ncm91cC12ZXJ0aWNhbD4uYnRuLWdyb3VwOmZpcnN0LWNoaWxkPi5kcm9wZG93bi10b2dnbGUgewoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOwoJCWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXAtdmVydGljYWw+LmJ0bi1ncm91cDpsYXN0LWNoaWxkPi5idG46Zmlyc3QtY2hpbGQgewoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOwoJCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDAKCQl9CgoJCS5idG4tZ3JvdXAtanVzdGlmaWVkIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQl3aWR0aDogMTAwJTsKCQlib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOwoJCXRhYmxlLWxheW91dDogZml4ZWQKCQl9CgoJCS5idG4tZ3JvdXAtanVzdGlmaWVkIC5idG4gewoJCWRpc3BsYXk6IHRhYmxlLWNlbGw7CgkJZmxvYXQ6IG5vbmU7CgkJd2lkdGg6IDElCgkJfQoKCQlbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXT4uYnRuPmlucHV0W3R5cGU9InJhZGlvIl0sCgkJW2RhdGEtdG9nZ2xlPSJidXR0b25zIl0+LmJ0bj5pbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKCQlkaXNwbGF5OiBub25lCgkJfQoKCQkuaW5wdXQtZ3JvdXAgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlkaXNwbGF5OiB0YWJsZTsKCQlib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlCgkJfQoKCQkuaW5wdXQtZ3JvdXAuY29sIHsKCQlmbG9hdDogbm9uZTsKCQlwYWRkaW5nLXJpZ2h0OiAwOwoJCXBhZGRpbmctbGVmdDogMAoJCX0KCgkJLmlucHV0LWdyb3VwIC5mb3JtLWNvbnRyb2wgewoJCXdpZHRoOiAxMDAlOwoJCW1hcmdpbi1ib3R0b206IDAKCQl9CgoJCS5pbnB1dC1ncm91cC1sZz4uZm9ybS1jb250cm9sLAoJCS5pbnB1dC1ncm91cC1sZz4uaW5wdXQtZ3JvdXAtYWRkb24sCgkJLmlucHV0LWdyb3VwLWxnPi5pbnB1dC1ncm91cC1idG4+LmJ0biB7CgkJaGVpZ2h0OiA1OHB4OwoJCXBhZGRpbmc6IDE0cHggMTZweDsKCQlmb250LXNpemU6IDE5cHg7CgkJbGluZS1oZWlnaHQ6IDEuMzM7CgkJYm9yZGVyLXJhZGl1czogNnB4CgkJfQoKCQlzZWxlY3QuaW5wdXQtZ3JvdXAtbGc+LmZvcm0tY29udHJvbCwKCQlzZWxlY3QuaW5wdXQtZ3JvdXAtbGc+LmlucHV0LWdyb3VwLWFkZG9uLAoJCXNlbGVjdC5pbnB1dC1ncm91cC1sZz4uaW5wdXQtZ3JvdXAtYnRuPi5idG4gewoJCWhlaWdodDogNThweDsKCQlsaW5lLWhlaWdodDogNThweAoJCX0KCgkJdGV4dGFyZWEuaW5wdXQtZ3JvdXAtbGc+LmZvcm0tY29udHJvbCwKCQl0ZXh0YXJlYS5pbnB1dC1ncm91cC1sZz4uaW5wdXQtZ3JvdXAtYWRkb24sCgkJdGV4dGFyZWEuaW5wdXQtZ3JvdXAtbGc+LmlucHV0LWdyb3VwLWJ0bj4uYnRuIHsKCQloZWlnaHQ6IGF1dG8KCQl9CgoJCS5pbnB1dC1ncm91cC1zbT4uZm9ybS1jb250cm9sLAoJCS5pbnB1dC1ncm91cC1zbT4uaW5wdXQtZ3JvdXAtYWRkb24sCgkJLmlucHV0LWdyb3VwLXNtPi5pbnB1dC1ncm91cC1idG4+LmJ0biB7CgkJaGVpZ2h0OiAzMXB4OwoJCXBhZGRpbmc6IDVweCAxMHB4OwoJCWZvbnQtc2l6ZTogMTNweDsKCQlsaW5lLWhlaWdodDogMS41OwoJCWJvcmRlci1yYWRpdXM6IDNweAoJCX0KCgkJc2VsZWN0LmlucHV0LWdyb3VwLXNtPi5mb3JtLWNvbnRyb2wsCgkJc2VsZWN0LmlucHV0LWdyb3VwLXNtPi5pbnB1dC1ncm91cC1hZGRvbiwKCQlzZWxlY3QuaW5wdXQtZ3JvdXAtc20+LmlucHV0LWdyb3VwLWJ0bj4uYnRuIHsKCQloZWlnaHQ6IDMxcHg7CgkJbGluZS1oZWlnaHQ6IDMxcHgKCQl9CgoJCXRleHRhcmVhLmlucHV0LWdyb3VwLXNtPi5mb3JtLWNvbnRyb2wsCgkJdGV4dGFyZWEuaW5wdXQtZ3JvdXAtc20+LmlucHV0LWdyb3VwLWFkZG9uLAoJCXRleHRhcmVhLmlucHV0LWdyb3VwLXNtPi5pbnB1dC1ncm91cC1idG4+LmJ0biB7CgkJaGVpZ2h0OiBhdXRvCgkJfQoKCQkuaW5wdXQtZ3JvdXAtYWRkb24sCgkJLmlucHV0LWdyb3VwLWJ0biwKCQkuaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbCB7CgkJZGlzcGxheTogdGFibGUtY2VsbAoJCX0KCgkJLmlucHV0LWdyb3VwLWFkZG9uOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCksCgkJLmlucHV0LWdyb3VwLWJ0bjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpLAoJCS5pbnB1dC1ncm91cCAuZm9ybS1jb250cm9sOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCkgewoJCWJvcmRlci1yYWRpdXM6IDAKCQl9CgoJCS5pbnB1dC1ncm91cC1hZGRvbiwKCQkuaW5wdXQtZ3JvdXAtYnRuIHsKCQl3aWR0aDogMSU7CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlCgkJfQoKCQkuaW5wdXQtZ3JvdXAtYWRkb24gewoJCXBhZGRpbmc6IDhweCAxMnB4OwoJCWZvbnQtc2l6ZTogMTVweDsKCQlmb250LXdlaWdodDogbm9ybWFsOwoJCWxpbmUtaGVpZ2h0OiAxOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOwoJCWJvcmRlcjogMXB4IHNvbGlkICNjY2M7CgkJYm9yZGVyLXJhZGl1czogNHB4CgkJfQoKCQkuaW5wdXQtZ3JvdXAtYWRkb24uaW5wdXQtc20gewoJCXBhZGRpbmc6IDVweCAxMHB4OwoJCWZvbnQtc2l6ZTogMTNweDsKCQlib3JkZXItcmFkaXVzOiAzcHgKCQl9CgoJCS5pbnB1dC1ncm91cC1hZGRvbi5pbnB1dC1sZyB7CgkJcGFkZGluZzogMTRweCAxNnB4OwoJCWZvbnQtc2l6ZTogMTlweDsKCQlib3JkZXItcmFkaXVzOiA2cHgKCQl9CgoJCS5pbnB1dC1ncm91cC1hZGRvbiBpbnB1dFt0eXBlPSJyYWRpbyJdLAoJCS5pbnB1dC1ncm91cC1hZGRvbiBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKCQltYXJnaW4tdG9wOiAwCgkJfQoKCQkuaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbDpmaXJzdC1jaGlsZCwKCQkuaW5wdXQtZ3JvdXAtYWRkb246Zmlyc3QtY2hpbGQsCgkJLmlucHV0LWdyb3VwLWJ0bjpmaXJzdC1jaGlsZD4uYnRuLAoJCS5pbnB1dC1ncm91cC1idG46Zmlyc3QtY2hpbGQ+LmRyb3Bkb3duLXRvZ2dsZSwKCQkuaW5wdXQtZ3JvdXAtYnRuOmxhc3QtY2hpbGQ+LmJ0bjpub3QoOmxhc3QtY2hpbGQpOm5vdCguZHJvcGRvd24tdG9nZ2xlKSB7CgkJYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7CgkJYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDAKCQl9CgoJCS5pbnB1dC1ncm91cC1hZGRvbjpmaXJzdC1jaGlsZCB7CgkJYm9yZGVyLXJpZ2h0OiAwCgkJfQoKCQkuaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbDpsYXN0LWNoaWxkLAoJCS5pbnB1dC1ncm91cC1hZGRvbjpsYXN0LWNoaWxkLAoJCS5pbnB1dC1ncm91cC1idG46bGFzdC1jaGlsZD4uYnRuLAoJCS5pbnB1dC1ncm91cC1idG46bGFzdC1jaGlsZD4uZHJvcGRvd24tdG9nZ2xlLAoJCS5pbnB1dC1ncm91cC1idG46Zmlyc3QtY2hpbGQ+LmJ0bjpub3QoOmZpcnN0LWNoaWxkKSB7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsKCQlib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAwCgkJfQoKCQkuaW5wdXQtZ3JvdXAtYWRkb246bGFzdC1jaGlsZCB7CgkJYm9yZGVyLWxlZnQ6IDAKCQl9CgoJCS5pbnB1dC1ncm91cC1idG4gewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl3aGl0ZS1zcGFjZTogbm93cmFwCgkJfQoKCQkuaW5wdXQtZ3JvdXAtYnRuPi5idG4gewoJCXBvc2l0aW9uOiByZWxhdGl2ZQoJCX0KCgkJLmlucHV0LWdyb3VwLWJ0bj4uYnRuKy5idG4gewoJCW1hcmdpbi1sZWZ0OiAtNHB4CgkJfQoKCQkuaW5wdXQtZ3JvdXAtYnRuPi5idG46aG92ZXIsCgkJLmlucHV0LWdyb3VwLWJ0bj4uYnRuOmFjdGl2ZSB7CgkJei1pbmRleDogMgoJCX0KCgkJLm5hdiB7CgkJcGFkZGluZy1sZWZ0OiAwOwoJCW1hcmdpbi1ib3R0b206IDA7CgkJbGlzdC1zdHlsZTogbm9uZQoJCX0KCgkJLm5hdjpiZWZvcmUsCgkJLm5hdjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdjpiZWZvcmUsCgkJLm5hdjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdjpiZWZvcmUsCgkJLm5hdjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdjpiZWZvcmUsCgkJLm5hdjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdjpiZWZvcmUsCgkJLm5hdjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdj5saSB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWRpc3BsYXk6IGJsb2NrCgkJfQoKCQkubmF2PmxpPmEgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlkaXNwbGF5OiBibG9jazsKCQlwYWRkaW5nOiAxMHB4IDE1cHgKCQl9CgoJCS5uYXY+bGk+YTpob3ZlciwKCQkubmF2PmxpPmE6Zm9jdXMgewoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWVlCgkJfQoKCQkubmF2PmxpLmRpc2FibGVkPmEgewoJCWNvbG9yOiAjOTk5CgkJfQoKCQkubmF2PmxpLmRpc2FibGVkPmE6aG92ZXIsCgkJLm5hdj5saS5kaXNhYmxlZD5hOmZvY3VzIHsKCQljb2xvcjogIzk5OTsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJY3Vyc29yOiBub3QtYWxsb3dlZDsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdiAub3Blbj5hLAoJCS5uYXYgLm9wZW4+YTpob3ZlciwKCQkubmF2IC5vcGVuPmE6Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICNlZWU7CgkJYm9yZGVyLWNvbG9yOiAjZWI2ODY0CgkJfQoKCQkubmF2IC5uYXYtZGl2aWRlciB7CgkJaGVpZ2h0OiAxcHg7CgkJbWFyZ2luOiA5LjVweCAwOwoJCW92ZXJmbG93OiBoaWRkZW47CgkJYmFja2dyb3VuZC1jb2xvcjogI2U1ZTVlNQoJCX0KCgkJLm5hdj5saT5hPmltZyB7CgkJbWF4LXdpZHRoOiBub25lCgkJfQoKCQkubmF2LXRhYnMgewoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkCgkJfQoKCQkubmF2LXRhYnM+bGkgewoJCWZsb2F0OiBsZWZ0OwoJCW1hcmdpbi1ib3R0b206IC0xcHgKCQl9CgoJCS5uYXYtdGFicz5saT5hIHsKCQltYXJnaW4tcmlnaHQ6IDJweDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogNHB4IDRweCAwIDAKCQl9CgoJCS5uYXYtdGFicz5saT5hOmhvdmVyIHsKCQlib3JkZXItY29sb3I6ICNlZWUgI2VlZSAjZGRkCgkJfQoKCQkubmF2LXRhYnM+bGkuYWN0aXZlPmEsCgkJLm5hdi10YWJzPmxpLmFjdGl2ZT5hOmhvdmVyLAoJCS5uYXYtdGFicz5saS5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICM3Nzc7CgkJY3Vyc29yOiBkZWZhdWx0OwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgI2RkZDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQgewoJCXdpZHRoOiAxMDAlOwoJCWJvcmRlci1ib3R0b206IDAKCQl9CgoJCS5uYXYtdGFicy5uYXYtanVzdGlmaWVkPmxpIHsKCQlmbG9hdDogbm9uZQoJCX0KCgkJLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQ+bGk+YSB7CgkJdGV4dC1hbGlnbjogY2VudGVyCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQ+bGkgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGw7CgkJd2lkdGg6IDElCgkJfQoJCX0KCgkJLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQ+bGk+YSB7CgkJbWFyZ2luLXJpZ2h0OiAwOwoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkCgkJfQoKCQkubmF2LXRhYnMubmF2LWp1c3RpZmllZD4uYWN0aXZlPmEgewoJCWJvcmRlci1ib3R0b20tY29sb3I6ICNmZmYKCQl9CgoJCS5uYXYtcGlsbHM+bGkgewoJCWZsb2F0OiBsZWZ0CgkJfQoKCQkubmF2LXBpbGxzPmxpPmEgewoJCWJvcmRlci1yYWRpdXM6IDVweAoJCX0KCgkJLm5hdi1waWxscz5saStsaSB7CgkJbWFyZ2luLWxlZnQ6IDJweAoJCX0KCgkJLm5hdi1waWxscz5saS5hY3RpdmU+YSwKCQkubmF2LXBpbGxzPmxpLmFjdGl2ZT5hOmhvdmVyLAoJCS5uYXYtcGlsbHM+bGkuYWN0aXZlPmE6Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6ICNlYjY4NjQKCQl9CgoJCS5uYXYtc3RhY2tlZD5saSB7CgkJZmxvYXQ6IG5vbmUKCQl9CgoJCS5uYXYtc3RhY2tlZD5saStsaSB7CgkJbWFyZ2luLXRvcDogMnB4OwoJCW1hcmdpbi1sZWZ0OiAwCgkJfQoKCQkubmF2LWp1c3RpZmllZCB7CgkJd2lkdGg6IDEwMCUKCQl9CgoJCS5uYXYtanVzdGlmaWVkPmxpIHsKCQlmbG9hdDogbm9uZQoJCX0KCgkJLm5hdi1qdXN0aWZpZWQ+bGk+YSB7CgkJdGV4dC1hbGlnbjogY2VudGVyCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdi1qdXN0aWZpZWQ+bGkgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGw7CgkJd2lkdGg6IDElCgkJfQoJCX0KCgkJLm5hdi10YWJzLWp1c3RpZmllZCB7CgkJYm9yZGVyLWJvdHRvbTogMAoJCX0KCgkJLm5hdi10YWJzLWp1c3RpZmllZD5saT5hIHsKCQltYXJnaW4tcmlnaHQ6IDA7CgkJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkZGQKCQl9CgoJCS5uYXYtdGFicy1qdXN0aWZpZWQ+LmFjdGl2ZT5hIHsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmCgkJfQoKCQkudGFiYmFibGU6YmVmb3JlLAoJCS50YWJiYWJsZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkudGFiYmFibGU6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkudGFiYmFibGU6YmVmb3JlLAoJCS50YWJiYWJsZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkudGFiYmFibGU6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkudGFiYmFibGU6YmVmb3JlLAoJCS50YWJiYWJsZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkudGFiYmFibGU6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkudGFiYmFibGU6YmVmb3JlLAoJCS50YWJiYWJsZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkudGFiYmFibGU6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkudGFiYmFibGU6YmVmb3JlLAoJCS50YWJiYWJsZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkudGFiYmFibGU6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkudGFiLWNvbnRlbnQ+LnRhYi1wYW5lLAoJCS5waWxsLWNvbnRlbnQ+LnBpbGwtcGFuZSB7CgkJZGlzcGxheTogbm9uZQoJCX0KCgkJLnRhYi1jb250ZW50Pi5hY3RpdmUsCgkJLnBpbGwtY29udGVudD4uYWN0aXZlIHsKCQlkaXNwbGF5OiBibG9jawoJCX0KCgkJLm5hdiAuY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICNlYjY4NjQ7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ViNjg2NAoJCX0KCgkJLm5hdiBhOmhvdmVyIC5jYXJldCB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2UyMjYyMDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZTIyNjIwCgkJfQoKCQkubmF2LXRhYnMgLmRyb3Bkb3duLW1lbnUgewoJCW1hcmdpbi10b3A6IC0xcHg7CgkJYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMAoJCX0KCgkJLm5hdmJhciB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCXotaW5kZXg6IDEwMDA7CgkJbWluLWhlaWdodDogNjBweDsKCQltYXJnaW4tYm90dG9tOiAyMXB4OwoJCWJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50CgkJfQoKCQkubmF2YmFyOmJlZm9yZSwKCQkubmF2YmFyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkubmF2YmFyOmJlZm9yZSwKCQkubmF2YmFyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkubmF2YmFyOmJlZm9yZSwKCQkubmF2YmFyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkubmF2YmFyOmJlZm9yZSwKCQkubmF2YmFyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkubmF2YmFyOmJlZm9yZSwKCQkubmF2YmFyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXI6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdmJhciB7CgkJYm9yZGVyLXJhZGl1czogNHB4CgkJfQoJCX0KCgkJLm5hdmJhci1oZWFkZXI6YmVmb3JlLAoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1oZWFkZXI6YmVmb3JlLAoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1oZWFkZXI6YmVmb3JlLAoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1oZWFkZXI6YmVmb3JlLAoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1oZWFkZXI6YmVmb3JlLAoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5uYXZiYXItaGVhZGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgewoJCS5uYXZiYXItaGVhZGVyIHsKCQlmbG9hdDogbGVmdAoJCX0KCQl9CgoJCS5uYXZiYXItY29sbGFwc2UgewoJCW1heC1oZWlnaHQ6IDM0MHB4OwoJCXBhZGRpbmctcmlnaHQ6IDE1cHg7CgkJcGFkZGluZy1sZWZ0OiAxNXB4OwoJCW92ZXJmbG93LXg6IHZpc2libGU7CgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwoJCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwoJCS13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZTpiZWZvcmUsCgkJLm5hdmJhci1jb2xsYXBzZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2YmFyLWNvbGxhcHNlOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZTpiZWZvcmUsCgkJLm5hdmJhci1jb2xsYXBzZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2YmFyLWNvbGxhcHNlOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZTpiZWZvcmUsCgkJLm5hdmJhci1jb2xsYXBzZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2YmFyLWNvbGxhcHNlOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZTpiZWZvcmUsCgkJLm5hdmJhci1jb2xsYXBzZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2YmFyLWNvbGxhcHNlOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZTpiZWZvcmUsCgkJLm5hdmJhci1jb2xsYXBzZTphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubmF2YmFyLWNvbGxhcHNlOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm5hdmJhci1jb2xsYXBzZS5pbiB7CgkJb3ZlcmZsb3cteTogYXV0bwoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgewoJCS5uYXZiYXItY29sbGFwc2UgewoJCXdpZHRoOiBhdXRvOwoJCWJvcmRlci10b3A6IDA7CgkJYm94LXNoYWRvdzogbm9uZQoJCX0KCQkubmF2YmFyLWNvbGxhcHNlLmNvbGxhcHNlIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQ7CgkJaGVpZ2h0OiBhdXRvIWltcG9ydGFudDsKCQlwYWRkaW5nLWJvdHRvbTogMDsKCQlvdmVyZmxvdzogdmlzaWJsZSFpbXBvcnRhbnQKCQl9CgkJLm5hdmJhci1jb2xsYXBzZS5pbiB7CgkJb3ZlcmZsb3cteTogdmlzaWJsZQoJCX0KCQkubmF2YmFyLWNvbGxhcHNlIC5uYXZiYXItbmF2Lm5hdmJhci1sZWZ0OmZpcnN0LWNoaWxkIHsKCQltYXJnaW4tbGVmdDogLTE1cHgKCQl9CgkJLm5hdmJhci1jb2xsYXBzZSAubmF2YmFyLW5hdi5uYXZiYXItcmlnaHQ6bGFzdC1jaGlsZCB7CgkJbWFyZ2luLXJpZ2h0OiAtMTVweAoJCX0KCQkubmF2YmFyLWNvbGxhcHNlIC5uYXZiYXItdGV4dDpsYXN0LWNoaWxkIHsKCQltYXJnaW4tcmlnaHQ6IDAKCQl9CgkJfQoKCQkuY29udGFpbmVyPi5uYXZiYXItaGVhZGVyLAoJCS5jb250YWluZXI+Lm5hdmJhci1jb2xsYXBzZSB7CgkJbWFyZ2luLXJpZ2h0OiAtMTVweDsKCQltYXJnaW4tbGVmdDogLTE1cHgKCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIHsKCQkuY29udGFpbmVyPi5uYXZiYXItaGVhZGVyLAoJCS5jb250YWluZXI+Lm5hdmJhci1jb2xsYXBzZSB7CgkJbWFyZ2luLXJpZ2h0OiAwOwoJCW1hcmdpbi1sZWZ0OiAwCgkJfQoJCX0KCgkJLm5hdmJhci1zdGF0aWMtdG9wIHsKCQlib3JkZXItd2lkdGg6IDAgMCAxcHgKCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIHsKCQkubmF2YmFyLXN0YXRpYy10b3AgewoJCWJvcmRlci1yYWRpdXM6IDAKCQl9CgkJfQoKCQkubmF2YmFyLWZpeGVkLXRvcCwKCQkubmF2YmFyLWZpeGVkLWJvdHRvbSB7CgkJcG9zaXRpb246IGZpeGVkOwoJCXJpZ2h0OiAwOwoJCWxlZnQ6IDA7CgkJYm9yZGVyLXdpZHRoOiAwIDAgMXB4CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdmJhci1maXhlZC10b3AsCgkJLm5hdmJhci1maXhlZC1ib3R0b20gewoJCWJvcmRlci1yYWRpdXM6IDAKCQl9CgkJfQoKCQkubmF2YmFyLWZpeGVkLXRvcCB7CgkJdG9wOiAwOwoJCXotaW5kZXg6IDEwMzAKCQl9CgoJCS5uYXZiYXItZml4ZWQtYm90dG9tIHsKCQlib3R0b206IDA7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCgkJLm5hdmJhci1icmFuZCB7CgkJZmxvYXQ6IGxlZnQ7CgkJcGFkZGluZzogMTkuNXB4IDE1cHg7CgkJZm9udC1zaXplOiAxOXB4OwoJCWxpbmUtaGVpZ2h0OiAyMXB4CgkJfQoKCQkubmF2YmFyLWJyYW5kOmhvdmVyLAoJCS5uYXZiYXItYnJhbmQ6Zm9jdXMgewoJCXRleHQtZGVjb3JhdGlvbjogbm9uZQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgewoJCS5uYXZiYXI+LmNvbnRhaW5lciAubmF2YmFyLWJyYW5kIHsKCQltYXJnaW4tbGVmdDogLTE1cHgKCQl9CgkJfQoKCQkubmF2YmFyLXRvZ2dsZSB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWZsb2F0OiByaWdodDsKCQlwYWRkaW5nOiA5cHggMTBweDsKCQltYXJnaW4tdG9wOiAxM3B4OwoJCW1hcmdpbi1yaWdodDogMTVweDsKCQltYXJnaW4tYm90dG9tOiAxM3B4OwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwoJCWJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwoJCWJvcmRlci1yYWRpdXM6IDRweAoJCX0KCgkJLm5hdmJhci10b2dnbGUgLmljb24tYmFyIHsKCQlkaXNwbGF5OiBibG9jazsKCQl3aWR0aDogMjJweDsKCQloZWlnaHQ6IDJweDsKCQlib3JkZXItcmFkaXVzOiAxcHgKCQl9CgoJCS5uYXZiYXItdG9nZ2xlIC5pY29uLWJhcisuaWNvbi1iYXIgewoJCW1hcmdpbi10b3A6IDRweAoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgewoJCS5uYXZiYXItdG9nZ2xlIHsKCQlkaXNwbGF5OiBub25lCgkJfQoJCX0KCgkJLm5hdmJhci1uYXYgewoJCW1hcmdpbjogOS43NXB4IC0xNXB4CgkJfQoKCQkubmF2YmFyLW5hdj5saT5hIHsKCQlwYWRkaW5nLXRvcDogMTBweDsKCQlwYWRkaW5nLWJvdHRvbTogMTBweDsKCQlsaW5lLWhlaWdodDogMjFweAoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51IHsKCQlwb3NpdGlvbjogc3RhdGljOwoJCWZsb2F0OiBub25lOwoJCXdpZHRoOiBhdXRvOwoJCW1hcmdpbi10b3A6IDA7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CgkJYm9yZGVyOiAwOwoJCWJveC1zaGFkb3c6IG5vbmUKCQl9CgkJLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnU+bGk+YSwKCQkubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSAuZHJvcGRvd24taGVhZGVyIHsKCQlwYWRkaW5nOiA1cHggMTVweCA1cHggMjVweAoJCX0KCQkubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hIHsKCQlsaW5lLWhlaWdodDogMjFweAoJCX0KCQkubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hOmhvdmVyLAoJCS5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51PmxpPmE6Zm9jdXMgewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmUKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdmJhci1uYXYgewoJCWZsb2F0OiBsZWZ0OwoJCW1hcmdpbjogMAoJCX0KCQkubmF2YmFyLW5hdj5saSB7CgkJZmxvYXQ6IGxlZnQKCQl9CgkJLm5hdmJhci1uYXY+bGk+YSB7CgkJcGFkZGluZy10b3A6IDE5LjVweDsKCQlwYWRkaW5nLWJvdHRvbTogMTkuNXB4CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgewoJCS5uYXZiYXItbGVmdCB7CgkJZmxvYXQ6IGxlZnQhaW1wb3J0YW50CgkJfQoJCS5uYXZiYXItcmlnaHQgewoJCWZsb2F0OiByaWdodCFpbXBvcnRhbnQKCQl9CgkJfQoKCQkubmF2YmFyLWZvcm0gewoJCXBhZGRpbmc6IDEwcHggMTVweDsKCQltYXJnaW4tdG9wOiAxMC41cHg7CgkJbWFyZ2luLXJpZ2h0OiAtMTVweDsKCQltYXJnaW4tYm90dG9tOiAxMC41cHg7CgkJbWFyZ2luLWxlZnQ6IC0xNXB4OwoJCWJvcmRlci10b3A6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKCQlib3JkZXItYm90dG9tOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDFweCAwIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKSwgMCAxcHggMCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSksIDAgMXB4IDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpCgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdmJhci1mb3JtIC5mb3JtLWdyb3VwIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlCgkJfQoJCS5uYXZiYXItZm9ybSAuZm9ybS1jb250cm9sIHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2sKCQl9CgkJLm5hdmJhci1mb3JtIC5yYWRpbywKCQkubmF2YmFyLWZvcm0gLmNoZWNrYm94IHsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJcGFkZGluZy1sZWZ0OiAwOwoJCW1hcmdpbi10b3A6IDA7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCQkubmF2YmFyLWZvcm0gLnJhZGlvIGlucHV0W3R5cGU9InJhZGlvIl0sCgkJLm5hdmJhci1mb3JtIC5jaGVja2JveCBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKCQlmbG9hdDogbm9uZTsKCQltYXJnaW4tbGVmdDogMAoJCX0KCQl9CgoJCUBtZWRpYShtYXgtd2lkdGg6NzY3cHgpIHsKCQkubmF2YmFyLWZvcm0gLmZvcm0tZ3JvdXAgewoJCW1hcmdpbi1ib3R0b206IDVweAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIHsKCQkubmF2YmFyLWZvcm0gewoJCXdpZHRoOiBhdXRvOwoJCXBhZGRpbmctdG9wOiAwOwoJCXBhZGRpbmctYm90dG9tOiAwOwoJCW1hcmdpbi1yaWdodDogMDsKCQltYXJnaW4tbGVmdDogMDsKCQlib3JkZXI6IDA7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwoJCWJveC1zaGFkb3c6IG5vbmUKCQl9CgkJfQoKCQkubmF2YmFyLW5hdj5saT4uZHJvcGRvd24tbWVudSB7CgkJbWFyZ2luLXRvcDogMDsKCQlib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKCQlib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAwCgkJfQoKCQkubmF2YmFyLWZpeGVkLWJvdHRvbSAubmF2YmFyLW5hdj5saT4uZHJvcGRvd24tbWVudSB7CgkJYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMAoJCX0KCgkJLm5hdmJhci1uYXYucHVsbC1yaWdodD5saT4uZHJvcGRvd24tbWVudSwKCQkubmF2YmFyLW5hdj5saT4uZHJvcGRvd24tbWVudS5wdWxsLXJpZ2h0IHsKCQlyaWdodDogMDsKCQlsZWZ0OiBhdXRvCgkJfQoKCQkubmF2YmFyLWJ0biB7CgkJbWFyZ2luLXRvcDogMTAuNXB4OwoJCW1hcmdpbi1ib3R0b206IDEwLjVweAoJCX0KCgkJLm5hdmJhci10ZXh0IHsKCQlmbG9hdDogbGVmdDsKCQltYXJnaW4tdG9wOiAxOS41cHg7CgkJbWFyZ2luLWJvdHRvbTogMTkuNXB4CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSB7CgkJLm5hdmJhci10ZXh0IHsKCQltYXJnaW4tcmlnaHQ6IDE1cHg7CgkJbWFyZ2luLWxlZnQ6IDE1cHgKCQl9CgkJfQoKCQkubmF2YmFyLWRlZmF1bHQgewoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyLWNvbG9yOiAjZWVlCgkJfQoKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1icmFuZCB7CgkJY29sb3I6ICMwMDAKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWJyYW5kOmhvdmVyLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWJyYW5kOmZvY3VzIHsKCQljb2xvcjogIzAwMDsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItdGV4dCB7CgkJY29sb3I6ICMwMDAKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj5saT5hIHsKCQljb2xvcjogIzAwMAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2PmxpPmE6aG92ZXIsCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2PmxpPmE6Zm9jdXMgewoJCWNvbG9yOiAjMDAwOwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50CgkJfQoKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXY+LmFjdGl2ZT5hLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4uYWN0aXZlPmE6aG92ZXIsCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2Pi5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICMwMDA7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4uZGlzYWJsZWQ+YSwKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXY+LmRpc2FibGVkPmE6aG92ZXIsCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2Pi5kaXNhYmxlZD5hOmZvY3VzIHsKCQljb2xvcjogI2NjYzsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItdG9nZ2xlIHsKCQlib3JkZXItY29sb3I6ICNkZGQKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLXRvZ2dsZTpob3ZlciwKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci10b2dnbGU6Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICNkZGQKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLXRvZ2dsZSAuaWNvbi1iYXIgewoJCWJhY2tncm91bmQtY29sb3I6ICNjY2MKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWNvbGxhcHNlLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWZvcm0gewoJCWJvcmRlci1jb2xvcjogI2VkZWRlZAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2Pi5kcm9wZG93bj5hOmhvdmVyIC5jYXJldCwKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXY+LmRyb3Bkb3duPmE6Zm9jdXMgLmNhcmV0IHsKCQlib3JkZXItdG9wLWNvbG9yOiAjMDAwOwoJCWJvcmRlci1ib3R0b20tY29sb3I6ICMwMDAKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4ub3Blbj5hLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4ub3Blbj5hOmhvdmVyLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4ub3Blbj5hOmZvY3VzIHsKCQljb2xvcjogIzAwMDsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2Pi5vcGVuPmEgLmNhcmV0LAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdj4ub3Blbj5hOmhvdmVyIC5jYXJldCwKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXY+Lm9wZW4+YTpmb2N1cyAuY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICMwMDA7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogIzAwMAoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2Pi5kcm9wZG93bj5hIC5jYXJldCB7CgkJYm9yZGVyLXRvcC1jb2xvcjogIzAwMDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjMDAwCgkJfQoKCQlAbWVkaWEobWF4LXdpZHRoOjc2N3B4KSB7CgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51PmxpPmEgewoJCWNvbG9yOiAjMDAwCgkJfQoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hOmhvdmVyLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hOmZvY3VzIHsKCQljb2xvcjogIzAwMDsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnU+LmFjdGl2ZT5hLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT4uYWN0aXZlPmE6aG92ZXIsCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51Pi5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICMwMDA7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQKCQl9CgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51Pi5kaXNhYmxlZD5hLAoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT4uZGlzYWJsZWQ+YTpob3ZlciwKCQkubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnU+LmRpc2FibGVkPmE6Zm9jdXMgewoJCWNvbG9yOiAjY2NjOwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50CgkJfQoJCX0KCgkJLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbGluayB7CgkJY29sb3I6ICMwMDAKCQl9CgoJCS5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWxpbms6aG92ZXIgewoJCWNvbG9yOiAjMDAwCgkJfQoKCQkubmF2YmFyLWludmVyc2UgewoJCWJhY2tncm91bmQtY29sb3I6ICNlYjY4NjQ7CgkJYm9yZGVyLWNvbG9yOiAjZTUzYzM3CgkJfQoKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1icmFuZCB7CgkJY29sb3I6ICNmZmYKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWJyYW5kOmhvdmVyLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWJyYW5kOmZvY3VzIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItdGV4dCB7CgkJY29sb3I6ICNmZmYKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdj5saT5hIHsKCQljb2xvcjogI2ZmZgoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2PmxpPmE6aG92ZXIsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2PmxpPmE6Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50CgkJfQoKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXY+LmFjdGl2ZT5hLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdj4uYWN0aXZlPmE6aG92ZXIsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdj4uZGlzYWJsZWQ+YSwKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXY+LmRpc2FibGVkPmE6aG92ZXIsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5kaXNhYmxlZD5hOmZvY3VzIHsKCQljb2xvcjogIzQ0NDsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItdG9nZ2xlIHsKCQlib3JkZXItY29sb3I6ICNlNTNjMzcKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLXRvZ2dsZTpob3ZlciwKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci10b2dnbGU6Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICNlNTNjMzcKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLXRvZ2dsZSAuaWNvbi1iYXIgewoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWNvbGxhcHNlLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWZvcm0gewoJCWJvcmRlci1jb2xvcjogI2U3NDk0NAoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5vcGVuPmEsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5vcGVuPmE6aG92ZXIsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5vcGVuPmE6Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50CgkJfQoKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXY+LmRyb3Bkb3duPmE6aG92ZXIgLmNhcmV0IHsKCQlib3JkZXItdG9wLWNvbG9yOiAjZmZmOwoJCWJvcmRlci1ib3R0b20tY29sb3I6ICNmZmYKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdj4uZHJvcGRvd24+YSAuY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICNmZmY7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZgoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2Pi5vcGVuPmEgLmNhcmV0LAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdj4ub3Blbj5hOmhvdmVyIC5jYXJldCwKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXY+Lm9wZW4+YTpmb2N1cyAuY2FyZXQgewoJCWJvcmRlci10b3AtY29sb3I6ICNmZmY7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZgoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT4uZHJvcGRvd24taGVhZGVyIHsKCQlib3JkZXItY29sb3I6ICNlNTNjMzcKCQl9CgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51PmxpPmEgewoJCWNvbG9yOiAjZmZmCgkJfQoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hOmhvdmVyLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT5saT5hOmZvY3VzIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudAoJCX0KCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnU+LmFjdGl2ZT5hLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT4uYWN0aXZlPmE6aG92ZXIsCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51Pi5hY3RpdmU+YTpmb2N1cyB7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQKCQl9CgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51Pi5kaXNhYmxlZD5hLAoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudT4uZGlzYWJsZWQ+YTpob3ZlciwKCQkubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnU+LmRpc2FibGVkPmE6Zm9jdXMgewoJCWNvbG9yOiAjNDQ0OwoJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50CgkJfQoJCX0KCgkJLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbGluayB7CgkJY29sb3I6ICNmZmYKCQl9CgoJCS5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWxpbms6aG92ZXIgewoJCWNvbG9yOiAjZmZmCgkJfQoKCQkuYnJlYWRjcnVtYiB7CgkJcGFkZGluZzogOHB4IDE1cHg7CgkJbWFyZ2luLWJvdHRvbTogMjFweDsKCQlsaXN0LXN0eWxlOiBub25lOwoJCWJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CgkJYm9yZGVyLXJhZGl1czogNHB4CgkJfQoKCQkuYnJlYWRjcnVtYj5saSB7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrCgkJfQoKCQkuYnJlYWRjcnVtYj5saStsaTpiZWZvcmUgewoJCXBhZGRpbmc6IDAgNXB4OwoJCWNvbG9yOiAjY2NjOwoJCWNvbnRlbnQ6ICIvXDAwYTAiCgkJfQoKCQkuYnJlYWRjcnVtYj4uYWN0aXZlIHsKCQljb2xvcjogIzk5OQoJCX0KCgkJLnBhZ2luYXRpb24gewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQlwYWRkaW5nLWxlZnQ6IDA7CgkJbWFyZ2luOiAyMXB4IDA7CgkJYm9yZGVyLXJhZGl1czogNHB4CgkJfQoKCQkucGFnaW5hdGlvbj5saSB7CgkJZGlzcGxheTogaW5saW5lCgkJfQoKCQkucGFnaW5hdGlvbj5saT5hLAoJCS5wYWdpbmF0aW9uPmxpPnNwYW4gewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQlmbG9hdDogbGVmdDsKCQlwYWRkaW5nOiA4cHggMTJweDsKCQltYXJnaW4tbGVmdDogLTFweDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgI2RkZAoJCX0KCgkJLnBhZ2luYXRpb24+bGk6Zmlyc3QtY2hpbGQ+YSwKCQkucGFnaW5hdGlvbj5saTpmaXJzdC1jaGlsZD5zcGFuIHsKCQltYXJnaW4tbGVmdDogMDsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA0cHg7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNHB4CgkJfQoKCQkucGFnaW5hdGlvbj5saTpsYXN0LWNoaWxkPmEsCgkJLnBhZ2luYXRpb24+bGk6bGFzdC1jaGlsZD5zcGFuIHsKCQlib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNHB4OwoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA0cHgKCQl9CgoJCS5wYWdpbmF0aW9uPmxpPmE6aG92ZXIsCgkJLnBhZ2luYXRpb24+bGk+c3Bhbjpob3ZlciwKCQkucGFnaW5hdGlvbj5saT5hOmZvY3VzLAoJCS5wYWdpbmF0aW9uPmxpPnNwYW46Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICNlZWUKCQl9CgoJCS5wYWdpbmF0aW9uPi5hY3RpdmU+YSwKCQkucGFnaW5hdGlvbj4uYWN0aXZlPnNwYW4sCgkJLnBhZ2luYXRpb24+LmFjdGl2ZT5hOmhvdmVyLAoJCS5wYWdpbmF0aW9uPi5hY3RpdmU+c3Bhbjpob3ZlciwKCQkucGFnaW5hdGlvbj4uYWN0aXZlPmE6Zm9jdXMsCgkJLnBhZ2luYXRpb24+LmFjdGl2ZT5zcGFuOmZvY3VzIHsKCQl6LWluZGV4OiAyOwoJCWNvbG9yOiAjOTk5OwoJCWN1cnNvcjogZGVmYXVsdDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwoJCWJvcmRlci1jb2xvcjogI2Y1ZjVmNQoJCX0KCgkJLnBhZ2luYXRpb24+LmRpc2FibGVkPnNwYW4sCgkJLnBhZ2luYXRpb24+LmRpc2FibGVkPmEsCgkJLnBhZ2luYXRpb24+LmRpc2FibGVkPmE6aG92ZXIsCgkJLnBhZ2luYXRpb24+LmRpc2FibGVkPmE6Zm9jdXMgewoJCWNvbG9yOiAjOTk5OwoJCWN1cnNvcjogbm90LWFsbG93ZWQ7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCQlib3JkZXItY29sb3I6ICNkZGQKCQl9CgoJCS5wYWdpbmF0aW9uLWxnPmxpPmEsCgkJLnBhZ2luYXRpb24tbGc+bGk+c3BhbiB7CgkJcGFkZGluZzogMTRweCAxNnB4OwoJCWZvbnQtc2l6ZTogMTlweAoJCX0KCgkJLnBhZ2luYXRpb24tbGc+bGk6Zmlyc3QtY2hpbGQ+YSwKCQkucGFnaW5hdGlvbi1sZz5saTpmaXJzdC1jaGlsZD5zcGFuIHsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA2cHg7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNnB4CgkJfQoKCQkucGFnaW5hdGlvbi1sZz5saTpsYXN0LWNoaWxkPmEsCgkJLnBhZ2luYXRpb24tbGc+bGk6bGFzdC1jaGlsZD5zcGFuIHsKCQlib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNnB4OwoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA2cHgKCQl9CgoJCS5wYWdpbmF0aW9uLXNtPmxpPmEsCgkJLnBhZ2luYXRpb24tc20+bGk+c3BhbiB7CgkJcGFkZGluZzogNXB4IDEwcHg7CgkJZm9udC1zaXplOiAxM3B4CgkJfQoKCQkucGFnaW5hdGlvbi1zbT5saTpmaXJzdC1jaGlsZD5hLAoJCS5wYWdpbmF0aW9uLXNtPmxpOmZpcnN0LWNoaWxkPnNwYW4gewoJCWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDNweDsKCQlib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAzcHgKCQl9CgoJCS5wYWdpbmF0aW9uLXNtPmxpOmxhc3QtY2hpbGQ+YSwKCQkucGFnaW5hdGlvbi1zbT5saTpsYXN0LWNoaWxkPnNwYW4gewoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAzcHg7CgkJYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweAoJCX0KCgkJLnBhZ2VyIHsKCQlwYWRkaW5nLWxlZnQ6IDA7CgkJbWFyZ2luOiAyMXB4IDA7CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCWxpc3Qtc3R5bGU6IG5vbmUKCQl9CgoJCS5wYWdlcjpiZWZvcmUsCgkJLnBhZ2VyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wYWdlcjphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wYWdlcjpiZWZvcmUsCgkJLnBhZ2VyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wYWdlcjphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wYWdlcjpiZWZvcmUsCgkJLnBhZ2VyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wYWdlcjphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wYWdlcjpiZWZvcmUsCgkJLnBhZ2VyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wYWdlcjphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wYWdlcjpiZWZvcmUsCgkJLnBhZ2VyOmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wYWdlcjphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wYWdlciBsaSB7CgkJZGlzcGxheTogaW5saW5lCgkJfQoKCQkucGFnZXIgbGk+YSwKCQkucGFnZXIgbGk+c3BhbiB7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCXBhZGRpbmc6IDVweCAxNHB4OwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgI2RkZDsKCQlib3JkZXItcmFkaXVzOiAxNXB4CgkJfQoKCQkucGFnZXIgbGk+YTpob3ZlciwKCQkucGFnZXIgbGk+YTpmb2N1cyB7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWJhY2tncm91bmQtY29sb3I6ICNlZWUKCQl9CgoJCS5wYWdlciAubmV4dD5hLAoJCS5wYWdlciAubmV4dD5zcGFuIHsKCQlmbG9hdDogcmlnaHQKCQl9CgoJCS5wYWdlciAucHJldmlvdXM+YSwKCQkucGFnZXIgLnByZXZpb3VzPnNwYW4gewoJCWZsb2F0OiBsZWZ0CgkJfQoKCQkucGFnZXIgLmRpc2FibGVkPmEsCgkJLnBhZ2VyIC5kaXNhYmxlZD5hOmhvdmVyLAoJCS5wYWdlciAuZGlzYWJsZWQ+YTpmb2N1cywKCQkucGFnZXIgLmRpc2FibGVkPnNwYW4gewoJCWNvbG9yOiAjOTk5OwoJCWN1cnNvcjogbm90LWFsbG93ZWQ7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZgoJCX0KCgkJLmxhYmVsIHsKCQlkaXNwbGF5OiBpbmxpbmU7CgkJcGFkZGluZzogLjJlbSAuNmVtIC4zZW07CgkJZm9udC1zaXplOiA3NSU7CgkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJbGluZS1oZWlnaHQ6IDE7CgkJY29sb3I6ICNmZmY7CgkJdGV4dC1hbGlnbjogY2VudGVyOwoJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwoJCWJvcmRlci1yYWRpdXM6IC4yNWVtCgkJfQoKCQkubGFiZWxbaHJlZl06aG92ZXIsCgkJLmxhYmVsW2hyZWZdOmZvY3VzIHsKCQljb2xvcjogI2ZmZjsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJY3Vyc29yOiBwb2ludGVyCgkJfQoKCQkubGFiZWw6ZW1wdHkgewoJCWRpc3BsYXk6IG5vbmUKCQl9CgoJCS5sYWJlbC1kZWZhdWx0IHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjOTk5CgkJfQoKCQkubGFiZWwtZGVmYXVsdFtocmVmXTpob3ZlciwKCQkubGFiZWwtZGVmYXVsdFtocmVmXTpmb2N1cyB7CgkJYmFja2dyb3VuZC1jb2xvcjogIzgwODA4MAoJCX0KCgkJLmxhYmVsLXByaW1hcnkgewoJCWJhY2tncm91bmQtY29sb3I6ICNlYjY4NjQKCQl9CgoJCS5sYWJlbC1wcmltYXJ5W2hyZWZdOmhvdmVyLAoJCS5sYWJlbC1wcmltYXJ5W2hyZWZdOmZvY3VzIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZTUzYzM3CgkJfQoKCQkubGFiZWwtc3VjY2VzcyB7CgkJYmFja2dyb3VuZC1jb2xvcjogIzIyYjI0YwoJCX0KCgkJLmxhYmVsLXN1Y2Nlc3NbaHJlZl06aG92ZXIsCgkJLmxhYmVsLXN1Y2Nlc3NbaHJlZl06Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICMxYTg3M2EKCQl9CgoJCS5sYWJlbC1pbmZvIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjMzY5CgkJfQoKCQkubGFiZWwtaW5mb1tocmVmXTpob3ZlciwKCQkubGFiZWwtaW5mb1tocmVmXTpmb2N1cyB7CgkJYmFja2dyb3VuZC1jb2xvcjogIzI2NGM3MwoJCX0KCgkJLmxhYmVsLXdhcm5pbmcgewoJCWJhY2tncm91bmQtY29sb3I6ICNmNWU2MjUKCQl9CgoJCS5sYWJlbC13YXJuaW5nW2hyZWZdOmhvdmVyLAoJCS5sYWJlbC13YXJuaW5nW2hyZWZdOmZvY3VzIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGRjZTBhCgkJfQoKCQkubGFiZWwtZGFuZ2VyIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjU3YTAwCgkJfQoKCQkubGFiZWwtZGFuZ2VyW2hyZWZdOmhvdmVyLAoJCS5sYWJlbC1kYW5nZXJbaHJlZl06Zm9jdXMgewoJCWJhY2tncm91bmQtY29sb3I6ICNjMjYxMDAKCQl9CgoJCS5iYWRnZSB7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCW1pbi13aWR0aDogMTBweDsKCQlwYWRkaW5nOiAzcHggN3B4OwoJCWZvbnQtc2l6ZTogMTNweDsKCQlmb250LXdlaWdodDogYm9sZDsKCQlsaW5lLWhlaWdodDogMTsKCQljb2xvcjogI2ZmZjsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJd2hpdGUtc3BhY2U6IG5vd3JhcDsKCQl2ZXJ0aWNhbC1hbGlnbjogYmFzZWxpbmU7CgkJYmFja2dyb3VuZC1jb2xvcjogIzk5OTsKCQlib3JkZXItcmFkaXVzOiAxMHB4CgkJfQoKCQkuYmFkZ2U6ZW1wdHkgewoJCWRpc3BsYXk6IG5vbmUKCQl9CgoJCWEuYmFkZ2U6aG92ZXIsCgkJYS5iYWRnZTpmb2N1cyB7CgkJY29sb3I6ICNmZmY7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWN1cnNvcjogcG9pbnRlcgoJCX0KCgkJLmJ0biAuYmFkZ2UgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl0b3A6IC0xcHgKCQl9CgoJCWEubGlzdC1ncm91cC1pdGVtLmFjdGl2ZT4uYmFkZ2UsCgkJLm5hdi1waWxscz4uYWN0aXZlPmE+LmJhZGdlIHsKCQljb2xvcjogI2ViNjg2NDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmCgkJfQoKCQkubmF2LXBpbGxzPmxpPmE+LmJhZGdlIHsKCQltYXJnaW4tbGVmdDogM3B4CgkJfQoKCQkuanVtYm90cm9uIHsKCQlwYWRkaW5nOiAzMHB4OwoJCW1hcmdpbi1ib3R0b206IDMwcHg7CgkJZm9udC1zaXplOiAyMi41cHg7CgkJZm9udC13ZWlnaHQ6IDIwMDsKCQlsaW5lLWhlaWdodDogMi4xNDI4NTcxNDM1OwoJCWNvbG9yOiBpbmhlcml0OwoJCWJhY2tncm91bmQtY29sb3I6ICNlZWUKCQl9CgoJCS5qdW1ib3Ryb24gaDEgewoJCWxpbmUtaGVpZ2h0OiAxOwoJCWNvbG9yOiBpbmhlcml0CgkJfQoKCQkuanVtYm90cm9uIHAgewoJCWxpbmUtaGVpZ2h0OiAxLjQKCQl9CgoJCS5jb250YWluZXIgLmp1bWJvdHJvbiB7CgkJYm9yZGVyLXJhZGl1czogNnB4CgkJfQoKCQlAbWVkaWEgc2NyZWVuIGFuZCAobWluLXdpZHRoOjc2OHB4KSB7CgkJLmp1bWJvdHJvbiB7CgkJcGFkZGluZy10b3A6IDQ4cHg7CgkJcGFkZGluZy1ib3R0b206IDQ4cHgKCQl9CgkJLmNvbnRhaW5lciAuanVtYm90cm9uIHsKCQlwYWRkaW5nLXJpZ2h0OiA2MHB4OwoJCXBhZGRpbmctbGVmdDogNjBweAoJCX0KCQkuanVtYm90cm9uIGgxIHsKCQlmb250LXNpemU6IDY3LjVweAoJCX0KCQl9CgoJCS50aHVtYm5haWwgewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQlkaXNwbGF5OiBibG9jazsKCQloZWlnaHQ6IGF1dG87CgkJbWF4LXdpZHRoOiAxMDAlOwoJCXBhZGRpbmc6IDRweDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0Mjk7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCQlib3JkZXI6IDFweCBzb2xpZCAjZGRkOwoJCWJvcmRlci1yYWRpdXM6IDRweDsKCQktd2Via2l0LXRyYW5zaXRpb246IGFsbCAuMnMgZWFzZS1pbi1vdXQ7CgkJdHJhbnNpdGlvbjogYWxsIC4ycyBlYXNlLWluLW91dAoJCX0KCgkJLnRodW1ibmFpbD5pbWcgewoJCWRpc3BsYXk6IGJsb2NrOwoJCWhlaWdodDogYXV0bzsKCQltYXgtd2lkdGg6IDEwMCUKCQl9CgoJCWEudGh1bWJuYWlsOmhvdmVyLAoJCWEudGh1bWJuYWlsOmZvY3VzIHsKCQlib3JkZXItY29sb3I6ICNlYjY4NjQKCQl9CgoJCS50aHVtYm5haWw+aW1nIHsKCQltYXJnaW4tcmlnaHQ6IGF1dG87CgkJbWFyZ2luLWxlZnQ6IGF1dG8KCQl9CgoJCS50aHVtYm5haWwgLmNhcHRpb24gewoJCXBhZGRpbmc6IDlweDsKCQljb2xvcjogIzc3NwoJCX0KCgkJLmFsZXJ0IHsKCQlwYWRkaW5nOiAxNXB4OwoJCW1hcmdpbi1ib3R0b206IDIxcHg7CgkJYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogNHB4CgkJfQoKCQkuYWxlcnQgaDQgewoJCW1hcmdpbi10b3A6IDA7CgkJY29sb3I6IGluaGVyaXQKCQl9CgoJCS5hbGVydCAuYWxlcnQtbGluayB7CgkJZm9udC13ZWlnaHQ6IGJvbGQKCQl9CgoJCS5hbGVydD5wLAoJCS5hbGVydD51bCB7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCgkJLmFsZXJ0PnArcCB7CgkJbWFyZ2luLXRvcDogNXB4CgkJfQoKCQkuYWxlcnQtZGlzbWlzc2FibGUgewoJCXBhZGRpbmctcmlnaHQ6IDM1cHgKCQl9CgoJCS5hbGVydC1kaXNtaXNzYWJsZSAuY2xvc2UgewoJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQl0b3A6IC0ycHg7CgkJcmlnaHQ6IC0yMXB4OwoJCWNvbG9yOiBpbmhlcml0CgkJfQoKCQkuYWxlcnQtc3VjY2VzcyB7CgkJY29sb3I6ICM0Njg4NDc7CgkJYmFja2dyb3VuZC1jb2xvcjogI2RmZjBkODsKCQlib3JkZXItY29sb3I6ICNkNmU5YzYKCQl9CgoJCS5hbGVydC1zdWNjZXNzIGhyIHsKCQlib3JkZXItdG9wLWNvbG9yOiAjYzllMmIzCgkJfQoKCQkuYWxlcnQtc3VjY2VzcyAuYWxlcnQtbGluayB7CgkJY29sb3I6ICMzNTY2MzUKCQl9CgoJCS5hbGVydC1pbmZvIHsKCQljb2xvcjogIzNhODdhZDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZDllZGY3OwoJCWJvcmRlci1jb2xvcjogI2JjZThmMQoJCX0KCgkJLmFsZXJ0LWluZm8gaHIgewoJCWJvcmRlci10b3AtY29sb3I6ICNhNmUxZWMKCQl9CgoJCS5hbGVydC1pbmZvIC5hbGVydC1saW5rIHsKCQljb2xvcjogIzJkNjk4NwoJCX0KCgkJLmFsZXJ0LXdhcm5pbmcgewoJCWNvbG9yOiAjYzA5ODUzOwoJCWJhY2tncm91bmQtY29sb3I6ICNmY2Y4ZTM7CgkJYm9yZGVyLWNvbG9yOiAjZmJlZWQ1CgkJfQoKCQkuYWxlcnQtd2FybmluZyBociB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2Y4ZTViZQoJCX0KCgkJLmFsZXJ0LXdhcm5pbmcgLmFsZXJ0LWxpbmsgewoJCWNvbG9yOiAjYTQ3ZTNjCgkJfQoKCQkuYWxlcnQtZGFuZ2VyIHsKCQljb2xvcjogI2I5NGE0ODsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjJkZWRlOwoJCWJvcmRlci1jb2xvcjogI2VlZDNkNwoJCX0KCgkJLmFsZXJ0LWRhbmdlciBociB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2U2YzFjNwoJCX0KCgkJLmFsZXJ0LWRhbmdlciAuYWxlcnQtbGluayB7CgkJY29sb3I6ICM5NTNiMzkKCQl9CgoJCUAtd2Via2l0LWtleWZyYW1lcyBwcm9ncmVzcy1iYXItc3RyaXBlcyB7CgkJZnJvbSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogNDBweCAwCgkJfQoJCXRvIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDAKCQl9CgkJfQoKCQlALW1vei1rZXlmcmFtZXMgcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgewoJCWZyb20gewoJCWJhY2tncm91bmQtcG9zaXRpb246IDQwcHggMAoJCX0KCQl0byB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwCgkJfQoJCX0KCgkJQC1vLWtleWZyYW1lcyBwcm9ncmVzcy1iYXItc3RyaXBlcyB7CgkJZnJvbSB7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwCgkJfQoJCXRvIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiA0MHB4IDAKCQl9CgkJfQoKCQlAa2V5ZnJhbWVzIHByb2dyZXNzLWJhci1zdHJpcGVzIHsKCQlmcm9tIHsKCQliYWNrZ3JvdW5kLXBvc2l0aW9uOiA0MHB4IDAKCQl9CgkJdG8gewoJCWJhY2tncm91bmQtcG9zaXRpb246IDAgMAoJCX0KCQl9CgoJCS5wcm9ncmVzcyB7CgkJaGVpZ2h0OiAyMXB4OwoJCW1hcmdpbi1ib3R0b206IDIxcHg7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwoJCWJvcmRlci1yYWRpdXM6IDRweDsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4xKQoJCX0KCgkJLnByb2dyZXNzLWJhciB7CgkJZmxvYXQ6IGxlZnQ7CgkJd2lkdGg6IDA7CgkJaGVpZ2h0OiAxMDAlOwoJCWZvbnQtc2l6ZTogMTNweDsKCQljb2xvcjogI2ZmZjsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ViNjg2NDsKCQktd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgLTFweCAwIHJnYmEoMCwgMCwgMCwgMC4xNSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAtMXB4IDAgcmdiYSgwLCAwLCAwLCAwLjE1KTsKCQktd2Via2l0LXRyYW5zaXRpb246IHdpZHRoIC42cyBlYXNlOwoJCXRyYW5zaXRpb246IHdpZHRoIC42cyBlYXNlCgkJfQoKCQkucHJvZ3Jlc3Mtc3RyaXBlZCAucHJvZ3Jlc3MtYmFyIHsKCQliYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgMCAxMDAlLCAxMDAlIDAsIGNvbG9yLXN0b3AoMC4yNSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC4yNSwgdHJhbnNwYXJlbnQpLCBjb2xvci1zdG9wKDAuNSwgdHJhbnNwYXJlbnQpLCBjb2xvci1zdG9wKDAuNSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC43NSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC43NSwgdHJhbnNwYXJlbnQpLCB0byh0cmFuc3BhcmVudCkpOwoJCWJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CgkJYmFja2dyb3VuZC1pbWFnZTogLW1vei1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKCQliYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKCQliYWNrZ3JvdW5kLXNpemU6IDQwcHggNDBweAoJCX0KCgkJLnByb2dyZXNzLmFjdGl2ZSAucHJvZ3Jlc3MtYmFyIHsKCQktd2Via2l0LWFuaW1hdGlvbjogcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgMnMgbGluZWFyIGluZmluaXRlOwoJCS1tb3otYW5pbWF0aW9uOiBwcm9ncmVzcy1iYXItc3RyaXBlcyAycyBsaW5lYXIgaW5maW5pdGU7CgkJLW1zLWFuaW1hdGlvbjogcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgMnMgbGluZWFyIGluZmluaXRlOwoJCS1vLWFuaW1hdGlvbjogcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgMnMgbGluZWFyIGluZmluaXRlOwoJCWFuaW1hdGlvbjogcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgMnMgbGluZWFyIGluZmluaXRlCgkJfQoKCQkucHJvZ3Jlc3MtYmFyLXN1Y2Nlc3MgewoJCWJhY2tncm91bmQtY29sb3I6ICMyMmIyNGMKCQl9CgoJCS5wcm9ncmVzcy1zdHJpcGVkIC5wcm9ncmVzcy1iYXItc3VjY2VzcyB7CgkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIDAgMTAwJSwgMTAwJSAwLCBjb2xvci1zdG9wKDAuMjUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkpLCBjb2xvci1zdG9wKDAuMjUsIHRyYW5zcGFyZW50KSwgY29sb3Itc3RvcCgwLjUsIHRyYW5zcGFyZW50KSwgY29sb3Itc3RvcCgwLjUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkpLCBjb2xvci1zdG9wKDAuNzUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkpLCBjb2xvci1zdG9wKDAuNzUsIHRyYW5zcGFyZW50KSwgdG8odHJhbnNwYXJlbnQpKTsKCQliYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwoJCWJhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CgkJYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCkKCQl9CgoJCS5wcm9ncmVzcy1iYXItaW5mbyB7CgkJYmFja2dyb3VuZC1jb2xvcjogIzM2OQoJCX0KCgkJLnByb2dyZXNzLXN0cmlwZWQgLnByb2dyZXNzLWJhci1pbmZvIHsKCQliYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgMCAxMDAlLCAxMDAlIDAsIGNvbG9yLXN0b3AoMC4yNSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC4yNSwgdHJhbnNwYXJlbnQpLCBjb2xvci1zdG9wKDAuNSwgdHJhbnNwYXJlbnQpLCBjb2xvci1zdG9wKDAuNSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC43NSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSksIGNvbG9yLXN0b3AoMC43NSwgdHJhbnNwYXJlbnQpLCB0byh0cmFuc3BhcmVudCkpOwoJCWJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CgkJYmFja2dyb3VuZC1pbWFnZTogLW1vei1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKCQliYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KQoJCX0KCgkJLnByb2dyZXNzLWJhci13YXJuaW5nIHsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjVlNjI1CgkJfQoKCQkucHJvZ3Jlc3Mtc3RyaXBlZCAucHJvZ3Jlc3MtYmFyLXdhcm5pbmcgewoJCWJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCAwIDEwMCUsIDEwMCUgMCwgY29sb3Itc3RvcCgwLjI1LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjI1LCB0cmFuc3BhcmVudCksIGNvbG9yLXN0b3AoMC41LCB0cmFuc3BhcmVudCksIGNvbG9yLXN0b3AoMC41LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjc1LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjc1LCB0cmFuc3BhcmVudCksIHRvKHRyYW5zcGFyZW50KSk7CgkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKCQliYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwoJCWJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpCgkJfQoKCQkucHJvZ3Jlc3MtYmFyLWRhbmdlciB7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y1N2EwMAoJCX0KCgkJLnByb2dyZXNzLXN0cmlwZWQgLnByb2dyZXNzLWJhci1kYW5nZXIgewoJCWJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCAwIDEwMCUsIDEwMCUgMCwgY29sb3Itc3RvcCgwLjI1LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjI1LCB0cmFuc3BhcmVudCksIGNvbG9yLXN0b3AoMC41LCB0cmFuc3BhcmVudCksIGNvbG9yLXN0b3AoMC41LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjc1LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpKSwgY29sb3Itc3RvcCgwLjc1LCB0cmFuc3BhcmVudCksIHRvKHRyYW5zcGFyZW50KSk7CgkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKCQliYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwoJCWJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpCgkJfQoKCQkubWVkaWEsCgkJLm1lZGlhLWJvZHkgewoJCW92ZXJmbG93OiBoaWRkZW47CgkJem9vbTogMQoJCX0KCgkJLm1lZGlhLAoJCS5tZWRpYSAubWVkaWEgewoJCW1hcmdpbi10b3A6IDE1cHgKCQl9CgoJCS5tZWRpYTpmaXJzdC1jaGlsZCB7CgkJbWFyZ2luLXRvcDogMAoJCX0KCgkJLm1lZGlhLW9iamVjdCB7CgkJZGlzcGxheTogYmxvY2sKCQl9CgoJCS5tZWRpYS1oZWFkaW5nIHsKCQltYXJnaW46IDAgMCA1cHgKCQl9CgoJCS5tZWRpYT4ucHVsbC1sZWZ0IHsKCQltYXJnaW4tcmlnaHQ6IDEwcHgKCQl9CgoJCS5tZWRpYT4ucHVsbC1yaWdodCB7CgkJbWFyZ2luLWxlZnQ6IDEwcHgKCQl9CgoJCS5tZWRpYS1saXN0IHsKCQlwYWRkaW5nLWxlZnQ6IDA7CgkJbGlzdC1zdHlsZTogbm9uZQoJCX0KCgkJLmxpc3QtZ3JvdXAgewoJCXBhZGRpbmctbGVmdDogMDsKCQltYXJnaW4tYm90dG9tOiAyMHB4CgkJfQoKCQkubGlzdC1ncm91cC1pdGVtIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJZGlzcGxheTogYmxvY2s7CgkJcGFkZGluZzogMTBweCAxNXB4OwoJCW1hcmdpbi1ib3R0b206IC0xcHg7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCQlib3JkZXI6IDFweCBzb2xpZCAjZGRkCgkJfQoKCQkubGlzdC1ncm91cC1pdGVtOmZpcnN0LWNoaWxkIHsKCQlib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNHB4OwoJCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDRweAoJCX0KCgkJLmxpc3QtZ3JvdXAtaXRlbTpsYXN0LWNoaWxkIHsKCQltYXJnaW4tYm90dG9tOiAwOwoJCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA0cHg7CgkJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNHB4CgkJfQoKCQkubGlzdC1ncm91cC1pdGVtPi5iYWRnZSB7CgkJZmxvYXQ6IHJpZ2h0CgkJfQoKCQkubGlzdC1ncm91cC1pdGVtPi5iYWRnZSsuYmFkZ2UgewoJCW1hcmdpbi1yaWdodDogNXB4CgkJfQoKCQlhLmxpc3QtZ3JvdXAtaXRlbSB7CgkJY29sb3I6ICM1NTUKCQl9CgoJCWEubGlzdC1ncm91cC1pdGVtIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyB7CgkJY29sb3I6ICMzMzMKCQl9CgoJCWEubGlzdC1ncm91cC1pdGVtOmhvdmVyLAoJCWEubGlzdC1ncm91cC1pdGVtOmZvY3VzIHsKCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNQoJCX0KCgkJLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmUsCgkJLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6aG92ZXIsCgkJLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6Zm9jdXMgewoJCXotaW5kZXg6IDI7CgkJY29sb3I6ICNmZmY7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ViNjg2NDsKCQlib3JkZXItY29sb3I6ICNlYjY4NjQKCQl9CgoJCS5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZywKCQkubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpob3ZlciAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcsCgkJLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6Zm9jdXMgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nIHsKCQljb2xvcjogaW5oZXJpdAoJCX0KCgkJLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmUgLmxpc3QtZ3JvdXAtaXRlbS10ZXh0LAoJCS5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlOmhvdmVyIC5saXN0LWdyb3VwLWl0ZW0tdGV4dCwKCQkubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpmb2N1cyAubGlzdC1ncm91cC1pdGVtLXRleHQgewoJCWNvbG9yOiAjZmZmCgkJfQoKCQkubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcgewoJCW1hcmdpbi10b3A6IDA7CgkJbWFyZ2luLWJvdHRvbTogNXB4CgkJfQoKCQkubGlzdC1ncm91cC1pdGVtLXRleHQgewoJCW1hcmdpbi1ib3R0b206IDA7CgkJbGluZS1oZWlnaHQ6IDEuMwoJCX0KCgkJLnBhbmVsIHsKCQltYXJnaW4tYm90dG9tOiAyMXB4OwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXJhZGl1czogNHB4OwoJCS13ZWJraXQtYm94LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNSk7CgkJYm94LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNSkKCQl9CgoJCS5wYW5lbC1ib2R5IHsKCQlwYWRkaW5nOiAxNXB4CgkJfQoKCQkucGFuZWwtYm9keTpiZWZvcmUsCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkucGFuZWwtYm9keTpiZWZvcmUsCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkucGFuZWwtYm9keTpiZWZvcmUsCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkucGFuZWwtYm9keTpiZWZvcmUsCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkucGFuZWwtYm9keTpiZWZvcmUsCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLnBhbmVsLWJvZHk6YWZ0ZXIgewoJCWNsZWFyOiBib3RoCgkJfQoKCQkucGFuZWw+Lmxpc3QtZ3JvdXAgewoJCW1hcmdpbi1ib3R0b206IDAKCQl9CgoJCS5wYW5lbD4ubGlzdC1ncm91cCAubGlzdC1ncm91cC1pdGVtIHsKCQlib3JkZXItd2lkdGg6IDFweCAwCgkJfQoKCQkucGFuZWw+Lmxpc3QtZ3JvdXAgLmxpc3QtZ3JvdXAtaXRlbTpmaXJzdC1jaGlsZCB7CgkJYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMAoJCX0KCgkJLnBhbmVsPi5saXN0LWdyb3VwIC5saXN0LWdyb3VwLWl0ZW06bGFzdC1jaGlsZCB7CgkJYm9yZGVyLWJvdHRvbTogMAoJCX0KCgkJLnBhbmVsLWhlYWRpbmcrLmxpc3QtZ3JvdXAgLmxpc3QtZ3JvdXAtaXRlbTpmaXJzdC1jaGlsZCB7CgkJYm9yZGVyLXRvcC13aWR0aDogMAoJCX0KCgkJLnBhbmVsPi50YWJsZSB7CgkJbWFyZ2luLWJvdHRvbTogMAoJCX0KCgkJLnBhbmVsPi5wYW5lbC1ib2R5Ky50YWJsZSB7CgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNkZGQKCQl9CgoJCS5wYW5lbC1oZWFkaW5nIHsKCQlwYWRkaW5nOiAxMHB4IDE1cHg7CgkJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwoJCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAzcHg7CgkJYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogM3B4CgkJfQoKCQkucGFuZWwtdGl0bGUgewoJCW1hcmdpbi10b3A6IDA7CgkJbWFyZ2luLWJvdHRvbTogMDsKCQlmb250LXNpemU6IDE3cHgKCQl9CgoJCS5wYW5lbC10aXRsZT5hIHsKCQljb2xvcjogaW5oZXJpdAoJCX0KCgkJLnBhbmVsLWZvb3RlciB7CgkJcGFkZGluZzogMTBweCAxNXB4OwoJCWJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNkZGQ7CgkJYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweDsKCQlib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAzcHgKCQl9CgoJCS5wYW5lbC1ncm91cCAucGFuZWwgewoJCW1hcmdpbi1ib3R0b206IDA7CgkJb3ZlcmZsb3c6IGhpZGRlbjsKCQlib3JkZXItcmFkaXVzOiA0cHgKCQl9CgoJCS5wYW5lbC1ncm91cCAucGFuZWwrLnBhbmVsIHsKCQltYXJnaW4tdG9wOiA1cHgKCQl9CgoJCS5wYW5lbC1ncm91cCAucGFuZWwtaGVhZGluZyB7CgkJYm9yZGVyLWJvdHRvbTogMAoJCX0KCgkJLnBhbmVsLWdyb3VwIC5wYW5lbC1oZWFkaW5nKy5wYW5lbC1jb2xsYXBzZSAucGFuZWwtYm9keSB7CgkJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNkZGQKCQl9CgoJCS5wYW5lbC1ncm91cCAucGFuZWwtZm9vdGVyIHsKCQlib3JkZXItdG9wOiAwCgkJfQoKCQkucGFuZWwtZ3JvdXAgLnBhbmVsLWZvb3RlcisucGFuZWwtY29sbGFwc2UgLnBhbmVsLWJvZHkgewoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkCgkJfQoKCQkucGFuZWwtZGVmYXVsdCB7CgkJYm9yZGVyLWNvbG9yOiAjZGRkCgkJfQoKCQkucGFuZWwtZGVmYXVsdD4ucGFuZWwtaGVhZGluZyB7CgkJY29sb3I6ICMzMzM7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKCQlib3JkZXItY29sb3I6ICNkZGQKCQl9CgoJCS5wYW5lbC1kZWZhdWx0Pi5wYW5lbC1oZWFkaW5nKy5wYW5lbC1jb2xsYXBzZSAucGFuZWwtYm9keSB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2RkZAoJCX0KCgkJLnBhbmVsLWRlZmF1bHQ+LnBhbmVsLWZvb3RlcisucGFuZWwtY29sbGFwc2UgLnBhbmVsLWJvZHkgewoJCWJvcmRlci1ib3R0b20tY29sb3I6ICNkZGQKCQl9CgoJCS5wYW5lbC1wcmltYXJ5IHsKCQlib3JkZXItY29sb3I6ICNlYjY4NjQKCQl9CgoJCS5wYW5lbC1wcmltYXJ5Pi5wYW5lbC1oZWFkaW5nIHsKCQljb2xvcjogI2ZmZjsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWI2ODY0OwoJCWJvcmRlci1jb2xvcjogI2ViNjg2NAoJCX0KCgkJLnBhbmVsLXByaW1hcnk+LnBhbmVsLWhlYWRpbmcrLnBhbmVsLWNvbGxhcHNlIC5wYW5lbC1ib2R5IHsKCQlib3JkZXItdG9wLWNvbG9yOiAjZWI2ODY0CgkJfQoKCQkucGFuZWwtcHJpbWFyeT4ucGFuZWwtZm9vdGVyKy5wYW5lbC1jb2xsYXBzZSAucGFuZWwtYm9keSB7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ViNjg2NAoJCX0KCgkJLnBhbmVsLXN1Y2Nlc3MgewoJCWJvcmRlci1jb2xvcjogI2Q2ZTljNgoJCX0KCgkJLnBhbmVsLXN1Y2Nlc3M+LnBhbmVsLWhlYWRpbmcgewoJCWNvbG9yOiAjNDY4ODQ3OwoJCWJhY2tncm91bmQtY29sb3I6ICNkZmYwZDg7CgkJYm9yZGVyLWNvbG9yOiAjZDZlOWM2CgkJfQoKCQkucGFuZWwtc3VjY2Vzcz4ucGFuZWwtaGVhZGluZysucGFuZWwtY29sbGFwc2UgLnBhbmVsLWJvZHkgewoJCWJvcmRlci10b3AtY29sb3I6ICNkNmU5YzYKCQl9CgoJCS5wYW5lbC1zdWNjZXNzPi5wYW5lbC1mb290ZXIrLnBhbmVsLWNvbGxhcHNlIC5wYW5lbC1ib2R5IHsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZDZlOWM2CgkJfQoKCQkucGFuZWwtd2FybmluZyB7CgkJYm9yZGVyLWNvbG9yOiAjZmJlZWQ1CgkJfQoKCQkucGFuZWwtd2FybmluZz4ucGFuZWwtaGVhZGluZyB7CgkJY29sb3I6ICNjMDk4NTM7CgkJYmFja2dyb3VuZC1jb2xvcjogI2ZjZjhlMzsKCQlib3JkZXItY29sb3I6ICNmYmVlZDUKCQl9CgoJCS5wYW5lbC13YXJuaW5nPi5wYW5lbC1oZWFkaW5nKy5wYW5lbC1jb2xsYXBzZSAucGFuZWwtYm9keSB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2ZiZWVkNQoJCX0KCgkJLnBhbmVsLXdhcm5pbmc+LnBhbmVsLWZvb3RlcisucGFuZWwtY29sbGFwc2UgLnBhbmVsLWJvZHkgewoJCWJvcmRlci1ib3R0b20tY29sb3I6ICNmYmVlZDUKCQl9CgoJCS5wYW5lbC1kYW5nZXIgewoJCWJvcmRlci1jb2xvcjogI2VlZDNkNwoJCX0KCgkJLnBhbmVsLWRhbmdlcj4ucGFuZWwtaGVhZGluZyB7CgkJY29sb3I6ICNiOTRhNDg7CgkJYmFja2dyb3VuZC1jb2xvcjogI2YyZGVkZTsKCQlib3JkZXItY29sb3I6ICNlZWQzZDcKCQl9CgoJCS5wYW5lbC1kYW5nZXI+LnBhbmVsLWhlYWRpbmcrLnBhbmVsLWNvbGxhcHNlIC5wYW5lbC1ib2R5IHsKCQlib3JkZXItdG9wLWNvbG9yOiAjZWVkM2Q3CgkJfQoKCQkucGFuZWwtZGFuZ2VyPi5wYW5lbC1mb290ZXIrLnBhbmVsLWNvbGxhcHNlIC5wYW5lbC1ib2R5IHsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZWVkM2Q3CgkJfQoKCQkucGFuZWwtaW5mbyB7CgkJYm9yZGVyLWNvbG9yOiAjYmNlOGYxCgkJfQoKCQkucGFuZWwtaW5mbz4ucGFuZWwtaGVhZGluZyB7CgkJY29sb3I6ICMzYTg3YWQ7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Q5ZWRmNzsKCQlib3JkZXItY29sb3I6ICNiY2U4ZjEKCQl9CgoJCS5wYW5lbC1pbmZvPi5wYW5lbC1oZWFkaW5nKy5wYW5lbC1jb2xsYXBzZSAucGFuZWwtYm9keSB7CgkJYm9yZGVyLXRvcC1jb2xvcjogI2JjZThmMQoJCX0KCgkJLnBhbmVsLWluZm8+LnBhbmVsLWZvb3RlcisucGFuZWwtY29sbGFwc2UgLnBhbmVsLWJvZHkgewoJCWJvcmRlci1ib3R0b20tY29sb3I6ICNiY2U4ZjEKCQl9CgoJCS53ZWxsIHsKCQltaW4taGVpZ2h0OiAyMHB4OwoJCXBhZGRpbmc6IDE5cHg7CgkJbWFyZ2luLWJvdHRvbTogMjBweDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwoJCWJvcmRlcjogMXB4IHNvbGlkICNlM2UzZTM7CgkJYm9yZGVyLXJhZGl1czogNHB4OwoJCS13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNSk7CgkJYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4wNSkKCQl9CgoJCS53ZWxsIGJsb2NrcXVvdGUgewoJCWJvcmRlci1jb2xvcjogI2RkZDsKCQlib3JkZXItY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4xNSkKCQl9CgoJCS53ZWxsLWxnIHsKCQlwYWRkaW5nOiAyNHB4OwoJCWJvcmRlci1yYWRpdXM6IDZweAoJCX0KCgkJLndlbGwtc20gewoJCXBhZGRpbmc6IDlweDsKCQlib3JkZXItcmFkaXVzOiAzcHgKCQl9CgoJCS5jbG9zZSB7CgkJZmxvYXQ6IHJpZ2h0OwoJCWZvbnQtc2l6ZTogMjIuNXB4OwoJCWZvbnQtd2VpZ2h0OiBib2xkOwoJCWxpbmUtaGVpZ2h0OiAxOwoJCWNvbG9yOiAjMDAwOwoJCXRleHQtc2hhZG93OiAwIDFweCAwICNmZmY7CgkJb3BhY2l0eTogLjI7CgkJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTIwKQoJCX0KCgkJLmNsb3NlOmhvdmVyLAoJCS5jbG9zZTpmb2N1cyB7CgkJY29sb3I6ICMwMDA7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWN1cnNvcjogcG9pbnRlcjsKCQlvcGFjaXR5OiAuNTsKCQlmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NTApCgkJfQoKCQlidXR0b24uY2xvc2UgewoJCXBhZGRpbmc6IDA7CgkJY3Vyc29yOiBwb2ludGVyOwoJCWJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwoJCWJvcmRlcjogMDsKCQktd2Via2l0LWFwcGVhcmFuY2U6IG5vbmUKCQl9CgoJCS5tb2RhbC1vcGVuIHsKCQlvdmVyZmxvdzogaGlkZGVuCgkJfQoKCQlib2R5Lm1vZGFsLW9wZW4sCgkJLm1vZGFsLW9wZW4gLm5hdmJhci1maXhlZC10b3AsCgkJLm1vZGFsLW9wZW4gLm5hdmJhci1maXhlZC1ib3R0b20gewoJCW1hcmdpbi1yaWdodDogMTVweAoJCX0KCgkJLm1vZGFsIHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJdG9wOiAwOwoJCXJpZ2h0OiAwOwoJCWJvdHRvbTogMDsKCQlsZWZ0OiAwOwoJCXotaW5kZXg6IDEwNDA7CgkJZGlzcGxheTogbm9uZTsKCQlvdmVyZmxvdzogYXV0bzsKCQlvdmVyZmxvdy15OiBzY3JvbGwKCQl9CgoJCS5tb2RhbC5mYWRlIC5tb2RhbC1kaWFsb2cgewoJCS13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgLTI1JSk7CgkJLW1zLXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIC0yNSUpOwoJCXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIC0yNSUpOwoJCS13ZWJraXQtdHJhbnNpdGlvbjogLXdlYmtpdC10cmFuc2Zvcm0gLjNzIGVhc2Utb3V0OwoJCS1tb3otdHJhbnNpdGlvbjogLW1vei10cmFuc2Zvcm0gLjNzIGVhc2Utb3V0OwoJCS1vLXRyYW5zaXRpb246IC1vLXRyYW5zZm9ybSAuM3MgZWFzZS1vdXQ7CgkJdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4zcyBlYXNlLW91dAoJCX0KCgkJLm1vZGFsLmluIC5tb2RhbC1kaWFsb2cgewoJCS13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7CgkJLW1zLXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIDApOwoJCXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIDApCgkJfQoKCQkubW9kYWwtZGlhbG9nIHsKCQl6LWluZGV4OiAxMDUwOwoJCXdpZHRoOiBhdXRvOwoJCXBhZGRpbmc6IDEwcHg7CgkJbWFyZ2luLXJpZ2h0OiBhdXRvOwoJCW1hcmdpbi1sZWZ0OiBhdXRvCgkJfQoKCQkubW9kYWwtY29udGVudCB7CgkJcG9zaXRpb246IHJlbGF0aXZlOwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJYm9yZGVyOiAxcHggc29saWQgIzk5OTsKCQlib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuMik7CgkJYm9yZGVyLXJhZGl1czogNnB4OwoJCW91dGxpbmU6IDA7CgkJLXdlYmtpdC1ib3gtc2hhZG93OiAwIDNweCA5cHggcmdiYSgwLCAwLCAwLCAwLjUpOwoJCWJveC1zaGFkb3c6IDAgM3B4IDlweCByZ2JhKDAsIDAsIDAsIDAuNSk7CgkJYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveAoJCX0KCgkJLm1vZGFsLWJhY2tkcm9wIHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJdG9wOiAwOwoJCXJpZ2h0OiAwOwoJCWJvdHRvbTogMDsKCQlsZWZ0OiAwOwoJCXotaW5kZXg6IDEwMzA7CgkJYmFja2dyb3VuZC1jb2xvcjogIzAwMAoJCX0KCgkJLm1vZGFsLWJhY2tkcm9wLmZhZGUgewoJCW9wYWNpdHk6IDA7CgkJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTApCgkJfQoKCQkubW9kYWwtYmFja2Ryb3AuaW4gewoJCW9wYWNpdHk6IC41OwoJCWZpbHRlcjogYWxwaGEob3BhY2l0eT01MCkKCQl9CgoJCS5tb2RhbC1oZWFkZXIgewoJCW1pbi1oZWlnaHQ6IDE2LjQyODU3MTQyOXB4OwoJCXBhZGRpbmc6IDE1cHg7CgkJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU1ZTUKCQl9CgoJCS5tb2RhbC1oZWFkZXIgLmNsb3NlIHsKCQltYXJnaW4tdG9wOiAtMnB4CgkJfQoKCQkubW9kYWwtdGl0bGUgewoJCW1hcmdpbjogMDsKCQlsaW5lLWhlaWdodDogMS40Mjg1NzE0MjkKCQl9CgoJCS5tb2RhbC1ib2R5IHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJcGFkZGluZzogMjBweAoJCX0KCgkJLm1vZGFsLWZvb3RlciB7CgkJcGFkZGluZzogMTlweCAyMHB4IDIwcHg7CgkJbWFyZ2luLXRvcDogMTVweDsKCQl0ZXh0LWFsaWduOiByaWdodDsKCQlib3JkZXItdG9wOiAxcHggc29saWQgI2U1ZTVlNQoJCX0KCgkJLm1vZGFsLWZvb3RlcjpiZWZvcmUsCgkJLm1vZGFsLWZvb3RlcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubW9kYWwtZm9vdGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm1vZGFsLWZvb3RlcjpiZWZvcmUsCgkJLm1vZGFsLWZvb3RlcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubW9kYWwtZm9vdGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm1vZGFsLWZvb3RlcjpiZWZvcmUsCgkJLm1vZGFsLWZvb3RlcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubW9kYWwtZm9vdGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm1vZGFsLWZvb3RlcjpiZWZvcmUsCgkJLm1vZGFsLWZvb3RlcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubW9kYWwtZm9vdGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm1vZGFsLWZvb3RlcjpiZWZvcmUsCgkJLm1vZGFsLWZvb3RlcjphZnRlciB7CgkJZGlzcGxheTogdGFibGU7CgkJY29udGVudDogIiAiCgkJfQoKCQkubW9kYWwtZm9vdGVyOmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLm1vZGFsLWZvb3RlciAuYnRuKy5idG4gewoJCW1hcmdpbi1ib3R0b206IDA7CgkJbWFyZ2luLWxlZnQ6IDVweAoJCX0KCgkJLm1vZGFsLWZvb3RlciAuYnRuLWdyb3VwIC5idG4rLmJ0biB7CgkJbWFyZ2luLWxlZnQ6IC0xcHgKCQl9CgoJCS5tb2RhbC1mb290ZXIgLmJ0bi1ibG9jaysuYnRuLWJsb2NrIHsKCQltYXJnaW4tbGVmdDogMAoJCX0KCgkJQG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDo3NjhweCkgewoJCS5tb2RhbC1kaWFsb2cgewoJCXJpZ2h0OiBhdXRvOwoJCWxlZnQ6IDUwJTsKCQl3aWR0aDogNjAwcHg7CgkJcGFkZGluZy10b3A6IDMwcHg7CgkJcGFkZGluZy1ib3R0b206IDMwcHgKCQl9CgkJLm1vZGFsLWNvbnRlbnQgewoJCS13ZWJraXQtYm94LXNoYWRvdzogMCA1cHggMTVweCByZ2JhKDAsIDAsIDAsIDAuNSk7CgkJYm94LXNoYWRvdzogMCA1cHggMTVweCByZ2JhKDAsIDAsIDAsIDAuNSkKCQl9CgkJfQoKCQkudG9vbHRpcCB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXotaW5kZXg6IDEwMzA7CgkJZGlzcGxheTogYmxvY2s7CgkJZm9udC1zaXplOiAxM3B4OwoJCWxpbmUtaGVpZ2h0OiAxLjQ7CgkJb3BhY2l0eTogMDsKCQlmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MCk7CgkJdmlzaWJpbGl0eTogdmlzaWJsZQoJCX0KCgkJLnRvb2x0aXAuaW4gewoJCW9wYWNpdHk6IC45OwoJCWZpbHRlcjogYWxwaGEob3BhY2l0eT05MCkKCQl9CgoJCS50b29sdGlwLnRvcCB7CgkJcGFkZGluZzogNXB4IDA7CgkJbWFyZ2luLXRvcDogLTNweAoJCX0KCgkJLnRvb2x0aXAucmlnaHQgewoJCXBhZGRpbmc6IDAgNXB4OwoJCW1hcmdpbi1sZWZ0OiAzcHgKCQl9CgoJCS50b29sdGlwLmJvdHRvbSB7CgkJcGFkZGluZzogNXB4IDA7CgkJbWFyZ2luLXRvcDogM3B4CgkJfQoKCQkudG9vbHRpcC5sZWZ0IHsKCQlwYWRkaW5nOiAwIDVweDsKCQltYXJnaW4tbGVmdDogLTNweAoJCX0KCgkJLnRvb2x0aXAtaW5uZXIgewoJCW1heC13aWR0aDogMjAwcHg7CgkJcGFkZGluZzogM3B4IDhweDsKCQljb2xvcjogI2ZmZjsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJdGV4dC1kZWNvcmF0aW9uOiBub25lOwoJCWJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItcmFkaXVzOiA0cHgKCQl9CgoJCS50b29sdGlwLWFycm93IHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJd2lkdGg6IDA7CgkJaGVpZ2h0OiAwOwoJCWJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7CgkJYm9yZGVyLXN0eWxlOiBzb2xpZAoJCX0KCgkJLnRvb2x0aXAudG9wIC50b29sdGlwLWFycm93IHsKCQlib3R0b206IDA7CgkJbGVmdDogNTAlOwoJCW1hcmdpbi1sZWZ0OiAtNXB4OwoJCWJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItd2lkdGg6IDVweCA1cHggMAoJCX0KCgkJLnRvb2x0aXAudG9wLWxlZnQgLnRvb2x0aXAtYXJyb3cgewoJCWJvdHRvbTogMDsKCQlsZWZ0OiA1cHg7CgkJYm9yZGVyLXRvcC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOwoJCWJvcmRlci13aWR0aDogNXB4IDVweCAwCgkJfQoKCQkudG9vbHRpcC50b3AtcmlnaHQgLnRvb2x0aXAtYXJyb3cgewoJCXJpZ2h0OiA1cHg7CgkJYm90dG9tOiAwOwoJCWJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItd2lkdGg6IDVweCA1cHggMAoJCX0KCgkJLnRvb2x0aXAucmlnaHQgLnRvb2x0aXAtYXJyb3cgewoJCXRvcDogNTAlOwoJCWxlZnQ6IDA7CgkJbWFyZ2luLXRvcDogLTVweDsKCQlib3JkZXItcmlnaHQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItd2lkdGg6IDVweCA1cHggNXB4IDAKCQl9CgoJCS50b29sdGlwLmxlZnQgLnRvb2x0aXAtYXJyb3cgewoJCXRvcDogNTAlOwoJCXJpZ2h0OiAwOwoJCW1hcmdpbi10b3A6IC01cHg7CgkJYm9yZGVyLWxlZnQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItd2lkdGg6IDVweCAwIDVweCA1cHgKCQl9CgoJCS50b29sdGlwLmJvdHRvbSAudG9vbHRpcC1hcnJvdyB7CgkJdG9wOiAwOwoJCWxlZnQ6IDUwJTsKCQltYXJnaW4tbGVmdDogLTVweDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7CgkJYm9yZGVyLXdpZHRoOiAwIDVweCA1cHgKCQl9CgoJCS50b29sdGlwLmJvdHRvbS1sZWZ0IC50b29sdGlwLWFycm93IHsKCQl0b3A6IDA7CgkJbGVmdDogNXB4OwoJCWJvcmRlci1ib3R0b20tY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsKCQlib3JkZXItd2lkdGg6IDAgNXB4IDVweAoJCX0KCgkJLnRvb2x0aXAuYm90dG9tLXJpZ2h0IC50b29sdGlwLWFycm93IHsKCQl0b3A6IDA7CgkJcmlnaHQ6IDVweDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7CgkJYm9yZGVyLXdpZHRoOiAwIDVweCA1cHgKCQl9CgoJCS5wb3BvdmVyIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwOwoJCWxlZnQ6IDA7CgkJei1pbmRleDogMTAxMDsKCQlkaXNwbGF5OiBub25lOwoJCW1heC13aWR0aDogMjc2cHg7CgkJcGFkZGluZzogMXB4OwoJCXRleHQtYWxpZ246IGxlZnQ7CgkJd2hpdGUtc3BhY2U6IG5vcm1hbDsKCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwoJCWJvcmRlcjogMXB4IHNvbGlkICNjY2M7CgkJYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjIpOwoJCWJvcmRlci1yYWRpdXM6IDZweDsKCQktd2Via2l0LWJveC1zaGFkb3c6IDAgNXB4IDEwcHggcmdiYSgwLCAwLCAwLCAwLjIpOwoJCWJveC1zaGFkb3c6IDAgNXB4IDEwcHggcmdiYSgwLCAwLCAwLCAwLjIpOwoJCWJhY2tncm91bmQtY2xpcDogcGFkZGluZy1ib3gKCQl9CgoJCS5wb3BvdmVyLnRvcCB7CgkJbWFyZ2luLXRvcDogLTEwcHgKCQl9CgoJCS5wb3BvdmVyLnJpZ2h0IHsKCQltYXJnaW4tbGVmdDogMTBweAoJCX0KCgkJLnBvcG92ZXIuYm90dG9tIHsKCQltYXJnaW4tdG9wOiAxMHB4CgkJfQoKCQkucG9wb3Zlci5sZWZ0IHsKCQltYXJnaW4tbGVmdDogLTEwcHgKCQl9CgoJCS5wb3BvdmVyLXRpdGxlIHsKCQlwYWRkaW5nOiA4cHggMTRweDsKCQltYXJnaW46IDA7CgkJZm9udC1zaXplOiAxNXB4OwoJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgkJbGluZS1oZWlnaHQ6IDE4cHg7CgkJYmFja2dyb3VuZC1jb2xvcjogI2Y3ZjdmNzsKCQlib3JkZXItYm90dG9tOiAxcHggc29saWQgI2ViZWJlYjsKCQlib3JkZXItcmFkaXVzOiA1cHggNXB4IDAgMAoJCX0KCgkJLnBvcG92ZXItY29udGVudCB7CgkJcGFkZGluZzogOXB4IDE0cHgKCQl9CgoJCS5wb3BvdmVyIC5hcnJvdywKCQkucG9wb3ZlciAuYXJyb3c6YWZ0ZXIgewoJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQlkaXNwbGF5OiBibG9jazsKCQl3aWR0aDogMDsKCQloZWlnaHQ6IDA7CgkJYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKCQlib3JkZXItc3R5bGU6IHNvbGlkCgkJfQoKCQkucG9wb3ZlciAuYXJyb3cgewoJCWJvcmRlci13aWR0aDogMTFweAoJCX0KCgkJLnBvcG92ZXIgLmFycm93OmFmdGVyIHsKCQlib3JkZXItd2lkdGg6IDEwcHg7CgkJY29udGVudDogIiIKCQl9CgoJCS5wb3BvdmVyLnRvcCAuYXJyb3cgewoJCWJvdHRvbTogLTExcHg7CgkJbGVmdDogNTAlOwoJCW1hcmdpbi1sZWZ0OiAtMTFweDsKCQlib3JkZXItdG9wLWNvbG9yOiAjOTk5OwoJCWJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4yNSk7CgkJYm9yZGVyLWJvdHRvbS13aWR0aDogMAoJCX0KCgkJLnBvcG92ZXIudG9wIC5hcnJvdzphZnRlciB7CgkJYm90dG9tOiAxcHg7CgkJbWFyZ2luLWxlZnQ6IC0xMHB4OwoJCWJvcmRlci10b3AtY29sb3I6ICNmZmY7CgkJYm9yZGVyLWJvdHRvbS13aWR0aDogMDsKCQljb250ZW50OiAiICIKCQl9CgoJCS5wb3BvdmVyLnJpZ2h0IC5hcnJvdyB7CgkJdG9wOiA1MCU7CgkJbGVmdDogLTExcHg7CgkJbWFyZ2luLXRvcDogLTExcHg7CgkJYm9yZGVyLXJpZ2h0LWNvbG9yOiAjOTk5OwoJCWJvcmRlci1yaWdodC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjI1KTsKCQlib3JkZXItbGVmdC13aWR0aDogMAoJCX0KCgkJLnBvcG92ZXIucmlnaHQgLmFycm93OmFmdGVyIHsKCQlib3R0b206IC0xMHB4OwoJCWxlZnQ6IDFweDsKCQlib3JkZXItcmlnaHQtY29sb3I6ICNmZmY7CgkJYm9yZGVyLWxlZnQtd2lkdGg6IDA7CgkJY29udGVudDogIiAiCgkJfQoKCQkucG9wb3Zlci5ib3R0b20gLmFycm93IHsKCQl0b3A6IC0xMXB4OwoJCWxlZnQ6IDUwJTsKCQltYXJnaW4tbGVmdDogLTExcHg7CgkJYm9yZGVyLWJvdHRvbS1jb2xvcjogIzk5OTsKCQlib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMjUpOwoJCWJvcmRlci10b3Atd2lkdGg6IDAKCQl9CgoJCS5wb3BvdmVyLmJvdHRvbSAuYXJyb3c6YWZ0ZXIgewoJCXRvcDogMXB4OwoJCW1hcmdpbi1sZWZ0OiAtMTBweDsKCQlib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmOwoJCWJvcmRlci10b3Atd2lkdGg6IDA7CgkJY29udGVudDogIiAiCgkJfQoKCQkucG9wb3Zlci5sZWZ0IC5hcnJvdyB7CgkJdG9wOiA1MCU7CgkJcmlnaHQ6IC0xMXB4OwoJCW1hcmdpbi10b3A6IC0xMXB4OwoJCWJvcmRlci1sZWZ0LWNvbG9yOiAjOTk5OwoJCWJvcmRlci1sZWZ0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMjUpOwoJCWJvcmRlci1yaWdodC13aWR0aDogMAoJCX0KCgkJLnBvcG92ZXIubGVmdCAuYXJyb3c6YWZ0ZXIgewoJCXJpZ2h0OiAxcHg7CgkJYm90dG9tOiAtMTBweDsKCQlib3JkZXItbGVmdC1jb2xvcjogI2ZmZjsKCQlib3JkZXItcmlnaHQtd2lkdGg6IDA7CgkJY29udGVudDogIiAiCgkJfQoKCQkuY2Fyb3VzZWwgewoJCXBvc2l0aW9uOiByZWxhdGl2ZQoJCX0KCgkJLmNhcm91c2VsLWlubmVyIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IDEwMCU7CgkJb3ZlcmZsb3c6IGhpZGRlbgoJCX0KCgkJLmNhcm91c2VsLWlubmVyPi5pdGVtIHsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJZGlzcGxheTogbm9uZTsKCQktd2Via2l0LXRyYW5zaXRpb246IC42cyBlYXNlLWluLW91dCBsZWZ0OwoJCXRyYW5zaXRpb246IC42cyBlYXNlLWluLW91dCBsZWZ0CgkJfQoKCQkuY2Fyb3VzZWwtaW5uZXI+Lml0ZW0+aW1nLAoJCS5jYXJvdXNlbC1pbm5lcj4uaXRlbT5hPmltZyB7CgkJZGlzcGxheTogYmxvY2s7CgkJaGVpZ2h0OiBhdXRvOwoJCW1heC13aWR0aDogMTAwJTsKCQlsaW5lLWhlaWdodDogMQoJCX0KCgkJLmNhcm91c2VsLWlubmVyPi5hY3RpdmUsCgkJLmNhcm91c2VsLWlubmVyPi5uZXh0LAoJCS5jYXJvdXNlbC1pbm5lcj4ucHJldiB7CgkJZGlzcGxheTogYmxvY2sKCQl9CgoJCS5jYXJvdXNlbC1pbm5lcj4uYWN0aXZlIHsKCQlsZWZ0OiAwCgkJfQoKCQkuY2Fyb3VzZWwtaW5uZXI+Lm5leHQsCgkJLmNhcm91c2VsLWlubmVyPi5wcmV2IHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiAwOwoJCXdpZHRoOiAxMDAlCgkJfQoKCQkuY2Fyb3VzZWwtaW5uZXI+Lm5leHQgewoJCWxlZnQ6IDEwMCUKCQl9CgoJCS5jYXJvdXNlbC1pbm5lcj4ucHJldiB7CgkJbGVmdDogLTEwMCUKCQl9CgoJCS5jYXJvdXNlbC1pbm5lcj4ubmV4dC5sZWZ0LAoJCS5jYXJvdXNlbC1pbm5lcj4ucHJldi5yaWdodCB7CgkJbGVmdDogMAoJCX0KCgkJLmNhcm91c2VsLWlubmVyPi5hY3RpdmUubGVmdCB7CgkJbGVmdDogLTEwMCUKCQl9CgoJCS5jYXJvdXNlbC1pbm5lcj4uYWN0aXZlLnJpZ2h0IHsKCQlsZWZ0OiAxMDAlCgkJfQoKCQkuY2Fyb3VzZWwtY29udHJvbCB7CgkJcG9zaXRpb246IGFic29sdXRlOwoJCXRvcDogMDsKCQlib3R0b206IDA7CgkJbGVmdDogMDsKCQl3aWR0aDogMTUlOwoJCWZvbnQtc2l6ZTogMjBweDsKCQljb2xvcjogI2ZmZjsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJdGV4dC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuNik7CgkJb3BhY2l0eTogLjU7CgkJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTUwKQoJCX0KCgkJLmNhcm91c2VsLWNvbnRyb2wubGVmdCB7CgkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIDAgdG9wLCAxMDAlIHRvcCwgZnJvbShyZ2JhKDAsIDAsIDAsIDAuNSkpLCB0byhyZ2JhKDAsIDAsIDAsIDAuMDAwMSkpKTsKCQliYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChsZWZ0LCBjb2xvci1zdG9wKHJnYmEoMCwgMCwgMCwgMC41KSAwKSwgY29sb3Itc3RvcChyZ2JhKDAsIDAsIDAsIDAuMDAwMSkgMTAwJSkpOwoJCWJhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KGxlZnQsIHJnYmEoMCwgMCwgMCwgMC41KSAwLCByZ2JhKDAsIDAsIDAsIDAuMDAwMSkgMTAwJSk7CgkJYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCByZ2JhKDAsIDAsIDAsIDAuNSkgMCwgcmdiYSgwLCAwLCAwLCAwLjAwMDEpIDEwMCUpOwoJCWJhY2tncm91bmQtcmVwZWF0OiByZXBlYXQteDsKCQlmaWx0ZXI6IHByb2dpZDogRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0nIzgwMDAwMDAwJywgZW5kQ29sb3JzdHI9JyMwMDAwMDAwMCcsIEdyYWRpZW50VHlwZT0xKQoJCX0KCgkJLmNhcm91c2VsLWNvbnRyb2wucmlnaHQgewoJCXJpZ2h0OiAwOwoJCWxlZnQ6IGF1dG87CgkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIDAgdG9wLCAxMDAlIHRvcCwgZnJvbShyZ2JhKDAsIDAsIDAsIDAuMDAwMSkpLCB0byhyZ2JhKDAsIDAsIDAsIDAuNSkpKTsKCQliYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChsZWZ0LCBjb2xvci1zdG9wKHJnYmEoMCwgMCwgMCwgMC4wMDAxKSAwKSwgY29sb3Itc3RvcChyZ2JhKDAsIDAsIDAsIDAuNSkgMTAwJSkpOwoJCWJhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KGxlZnQsIHJnYmEoMCwgMCwgMCwgMC4wMDAxKSAwLCByZ2JhKDAsIDAsIDAsIDAuNSkgMTAwJSk7CgkJYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCByZ2JhKDAsIDAsIDAsIDAuMDAwMSkgMCwgcmdiYSgwLCAwLCAwLCAwLjUpIDEwMCUpOwoJCWJhY2tncm91bmQtcmVwZWF0OiByZXBlYXQteDsKCQlmaWx0ZXI6IHByb2dpZDogRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0nIzAwMDAwMDAwJywgZW5kQ29sb3JzdHI9JyM4MDAwMDAwMCcsIEdyYWRpZW50VHlwZT0xKQoJCX0KCgkJLmNhcm91c2VsLWNvbnRyb2w6aG92ZXIsCgkJLmNhcm91c2VsLWNvbnRyb2w6Zm9jdXMgewoJCWNvbG9yOiAjZmZmOwoJCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCQlvcGFjaXR5OiAuOTsKCQlmaWx0ZXI6IGFscGhhKG9wYWNpdHk9OTApCgkJfQoKCQkuY2Fyb3VzZWwtY29udHJvbCAuaWNvbi1wcmV2LAoJCS5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQsCgkJLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLWxlZnQsCgkJLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLXJpZ2h0IHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJdG9wOiA1MCU7CgkJbGVmdDogNTAlOwoJCXotaW5kZXg6IDU7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrCgkJfQoKCQkuY2Fyb3VzZWwtY29udHJvbCAuaWNvbi1wcmV2LAoJCS5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQgewoJCXdpZHRoOiAyMHB4OwoJCWhlaWdodDogMjBweDsKCQltYXJnaW4tdG9wOiAtMTBweDsKCQltYXJnaW4tbGVmdDogLTEwcHg7CgkJZm9udC1mYW1pbHk6IHNlcmlmCgkJfQoKCQkuY2Fyb3VzZWwtY29udHJvbCAuaWNvbi1wcmV2OmJlZm9yZSB7CgkJY29udGVudDogJ1wyMDM5JwoJCX0KCgkJLmNhcm91c2VsLWNvbnRyb2wgLmljb24tbmV4dDpiZWZvcmUgewoJCWNvbnRlbnQ6ICdcMjAzYScKCQl9CgoJCS5jYXJvdXNlbC1pbmRpY2F0b3JzIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJYm90dG9tOiAxMHB4OwoJCWxlZnQ6IDUwJTsKCQl6LWluZGV4OiAxNTsKCQl3aWR0aDogNjAlOwoJCXBhZGRpbmctbGVmdDogMDsKCQltYXJnaW4tbGVmdDogLTMwJTsKCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJbGlzdC1zdHlsZTogbm9uZQoJCX0KCgkJLmNhcm91c2VsLWluZGljYXRvcnMgbGkgewoJCWRpc3BsYXk6IGlubGluZS1ibG9jazsKCQl3aWR0aDogMTBweDsKCQloZWlnaHQ6IDEwcHg7CgkJbWFyZ2luOiAxcHg7CgkJdGV4dC1pbmRlbnQ6IC05OTlweDsKCQljdXJzb3I6IHBvaW50ZXI7CgkJYm9yZGVyOiAxcHggc29saWQgI2ZmZjsKCQlib3JkZXItcmFkaXVzOiAxMHB4CgkJfQoKCQkuY2Fyb3VzZWwtaW5kaWNhdG9ycyAuYWN0aXZlIHsKCQl3aWR0aDogMTJweDsKCQloZWlnaHQ6IDEycHg7CgkJbWFyZ2luOiAwOwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmYKCQl9CgoJCS5jYXJvdXNlbC1jYXB0aW9uIHsKCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJcmlnaHQ6IDE1JTsKCQlib3R0b206IDIwcHg7CgkJbGVmdDogMTUlOwoJCXotaW5kZXg6IDEwOwoJCXBhZGRpbmctdG9wOiAyMHB4OwoJCXBhZGRpbmctYm90dG9tOiAyMHB4OwoJCWNvbG9yOiAjZmZmOwoJCXRleHQtYWxpZ246IGNlbnRlcjsKCQl0ZXh0LXNoYWRvdzogMCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgMC42KQoJCX0KCgkJLmNhcm91c2VsLWNhcHRpb24gLmJ0biB7CgkJdGV4dC1zaGFkb3c6IG5vbmUKCQl9CgoJCUBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6NzY4cHgpIHsKCQkuY2Fyb3VzZWwtY29udHJvbCAuaWNvbi1wcmV2LAoJCS5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQgewoJCXdpZHRoOiAzMHB4OwoJCWhlaWdodDogMzBweDsKCQltYXJnaW4tdG9wOiAtMTVweDsKCQltYXJnaW4tbGVmdDogLTE1cHg7CgkJZm9udC1zaXplOiAzMHB4CgkJfQoJCS5jYXJvdXNlbC1jYXB0aW9uIHsKCQlyaWdodDogMjAlOwoJCWxlZnQ6IDIwJTsKCQlwYWRkaW5nLWJvdHRvbTogMzBweAoJCX0KCQkuY2Fyb3VzZWwtaW5kaWNhdG9ycyB7CgkJYm90dG9tOiAyMHB4CgkJfQoJCX0KCgkJLmNsZWFyZml4OmJlZm9yZSwKCQkuY2xlYXJmaXg6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLmNsZWFyZml4OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLmNsZWFyZml4OmJlZm9yZSwKCQkuY2xlYXJmaXg6YWZ0ZXIgewoJCWRpc3BsYXk6IHRhYmxlOwoJCWNvbnRlbnQ6ICIgIgoJCX0KCgkJLmNsZWFyZml4OmFmdGVyIHsKCQljbGVhcjogYm90aAoJCX0KCgkJLnB1bGwtcmlnaHQgewoJCWZsb2F0OiByaWdodCFpbXBvcnRhbnQKCQl9CgoJCS5wdWxsLWxlZnQgewoJCWZsb2F0OiBsZWZ0IWltcG9ydGFudAoJCX0KCgkJLmhpZGUgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQkuc2hvdyB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoKCQkuaW52aXNpYmxlIHsKCQl2aXNpYmlsaXR5OiBoaWRkZW4KCQl9CgoJCS50ZXh0LWhpZGUgewoJCWZvbnQ6IDAvMCBhOwoJCWNvbG9yOiB0cmFuc3BhcmVudDsKCQl0ZXh0LXNoYWRvdzogbm9uZTsKCQliYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKCQlib3JkZXI6IDAKCQl9CgoJCS5hZmZpeCB7CgkJcG9zaXRpb246IGZpeGVkCgkJfQoKCQlALW1zLXZpZXdwb3J0IHsKCQl3aWR0aDogZGV2aWNlLXdpZHRoCgkJfQoKCQlAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOjQwMHB4KSB7CgkJQC1tcy12aWV3cG9ydCB7CgkJd2lkdGg6IDMyMHB4CgkJfQoJCX0KCgkJLmhpZGRlbiB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQ7CgkJdmlzaWJpbGl0eTogaGlkZGVuIWltcG9ydGFudAoJCX0KCgkJLnZpc2libGUteHMgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQl0ci52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJdGgudmlzaWJsZS14cywKCQl0ZC52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS14cyB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLXhzLAoJCXRkLnZpc2libGUteHMgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgYW5kIChtYXgtd2lkdGg6OTkxcHgpIHsKCQkudmlzaWJsZS14cy52aXNpYmxlLXNtIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS14cy52aXNpYmxlLXNtIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoJCXRoLnZpc2libGUteHMudmlzaWJsZS1zbSwKCQl0ZC52aXNpYmxlLXhzLnZpc2libGUtc20gewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo5OTJweCkgYW5kIChtYXgtd2lkdGg6MTE5OXB4KSB7CgkJLnZpc2libGUteHMudmlzaWJsZS1tZCB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUteHMudmlzaWJsZS1tZCB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLXhzLnZpc2libGUtbWQsCgkJdGQudmlzaWJsZS14cy52aXNpYmxlLW1kIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6MTIwMHB4KSB7CgkJLnZpc2libGUteHMudmlzaWJsZS1sZyB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUteHMudmlzaWJsZS1sZyB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLXhzLnZpc2libGUtbGcsCgkJdGQudmlzaWJsZS14cy52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCS52aXNpYmxlLXNtIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJdHIudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgoJCXRoLnZpc2libGUtc20sCgkJdGQudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgoJCUBtZWRpYShtYXgtd2lkdGg6NzY3cHgpIHsKCQkudmlzaWJsZS1zbS52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS1zbS52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoJCXRoLnZpc2libGUtc20udmlzaWJsZS14cywKCQl0ZC52aXNpYmxlLXNtLnZpc2libGUteHMgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgYW5kIChtYXgtd2lkdGg6OTkxcHgpIHsKCQkudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUtc20gewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1zbSwKCQl0ZC52aXNpYmxlLXNtIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6OTkycHgpIGFuZCAobWF4LXdpZHRoOjExOTlweCkgewoJCS52aXNpYmxlLXNtLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCQl0ci52aXNpYmxlLXNtLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1zbS52aXNpYmxlLW1kLAoJCXRkLnZpc2libGUtc20udmlzaWJsZS1tZCB7CgkJZGlzcGxheTogdGFibGUtY2VsbCFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjEyMDBweCkgewoJCS52aXNpYmxlLXNtLnZpc2libGUtbGcgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCQl0ci52aXNpYmxlLXNtLnZpc2libGUtbGcgewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1zbS52aXNpYmxlLWxnLAoJCXRkLnZpc2libGUtc20udmlzaWJsZS1sZyB7CgkJZGlzcGxheTogdGFibGUtY2VsbCFpbXBvcnRhbnQKCQl9CgkJfQoKCQkudmlzaWJsZS1tZCB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgoJCXRyLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQl0aC52aXNpYmxlLW1kLAoJCXRkLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQlAbWVkaWEobWF4LXdpZHRoOjc2N3B4KSB7CgkJLnZpc2libGUtbWQudmlzaWJsZS14cyB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUtbWQudmlzaWJsZS14cyB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLW1kLnZpc2libGUteHMsCgkJdGQudmlzaWJsZS1tZC52aXNpYmxlLXhzIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIGFuZCAobWF4LXdpZHRoOjk5MXB4KSB7CgkJLnZpc2libGUtbWQudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUtbWQudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLW1kLnZpc2libGUtc20sCgkJdGQudmlzaWJsZS1tZC52aXNpYmxlLXNtIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6OTkycHgpIGFuZCAobWF4LXdpZHRoOjExOTlweCkgewoJCS52aXNpYmxlLW1kIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS1tZCB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCQl0aC52aXNpYmxlLW1kLAoJCXRkLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDoxMjAwcHgpIHsKCQkudmlzaWJsZS1tZC52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS1tZC52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoJCXRoLnZpc2libGUtbWQudmlzaWJsZS1sZywKCQl0ZC52aXNpYmxlLW1kLnZpc2libGUtbGcgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJLnZpc2libGUtbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQl0ci52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJdGgudmlzaWJsZS1sZywKCQl0ZC52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS52aXNpYmxlLWxnLnZpc2libGUteHMgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCQl0ci52aXNpYmxlLWxnLnZpc2libGUteHMgewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1sZy52aXNpYmxlLXhzLAoJCXRkLnZpc2libGUtbGcudmlzaWJsZS14cyB7CgkJZGlzcGxheTogdGFibGUtY2VsbCFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSBhbmQgKG1heC13aWR0aDo5OTFweCkgewoJCS52aXNpYmxlLWxnLnZpc2libGUtc20gewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCQl0ci52aXNpYmxlLWxnLnZpc2libGUtc20gewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1sZy52aXNpYmxlLXNtLAoJCXRkLnZpc2libGUtbGcudmlzaWJsZS1zbSB7CgkJZGlzcGxheTogdGFibGUtY2VsbCFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjk5MnB4KSBhbmQgKG1heC13aWR0aDoxMTk5cHgpIHsKCQkudmlzaWJsZS1sZy52aXNpYmxlLW1kIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgkJdHIudmlzaWJsZS1sZy52aXNpYmxlLW1kIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoJCXRoLnZpc2libGUtbGcudmlzaWJsZS1tZCwKCQl0ZC52aXNpYmxlLWxnLnZpc2libGUtbWQgewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDoxMjAwcHgpIHsKCQkudmlzaWJsZS1sZyB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUtbGcgewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1sZywKCQl0ZC52aXNpYmxlLWxnIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQl9CgoJCS5oaWRkZW4teHMgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCgkJdHIuaGlkZGVuLXhzIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoKCQl0aC5oaWRkZW4teHMsCgkJdGQuaGlkZGVuLXhzIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS5oaWRkZW4teHMgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi14cyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLXhzLAoJCXRkLmhpZGRlbi14cyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSBhbmQgKG1heC13aWR0aDo5OTFweCkgewoJCS5oaWRkZW4teHMuaGlkZGVuLXNtIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4teHMuaGlkZGVuLXNtIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0aC5oaWRkZW4teHMuaGlkZGVuLXNtLAoJCXRkLmhpZGRlbi14cy5oaWRkZW4tc20gewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo5OTJweCkgYW5kIChtYXgtd2lkdGg6MTE5OXB4KSB7CgkJLmhpZGRlbi14cy5oaWRkZW4tbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi14cy5oaWRkZW4tbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi14cy5oaWRkZW4tbWQsCgkJdGQuaGlkZGVuLXhzLmhpZGRlbi1tZCB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjEyMDBweCkgewoJCS5oaWRkZW4teHMuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4teHMuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0aC5oaWRkZW4teHMuaGlkZGVuLWxnLAoJCXRkLmhpZGRlbi14cy5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoKCQl0ci5oaWRkZW4tc20gewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgoJCXRoLmhpZGRlbi1zbSwKCQl0ZC5oaWRkZW4tc20gewoJCWRpc3BsYXk6IHRhYmxlLWNlbGwhaW1wb3J0YW50CgkJfQoKCQlAbWVkaWEobWF4LXdpZHRoOjc2N3B4KSB7CgkJLmhpZGRlbi1zbS5oaWRkZW4teHMgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi1zbS5oaWRkZW4teHMgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1zbS5oaWRkZW4teHMsCgkJdGQuaGlkZGVuLXNtLmhpZGRlbi14cyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjc2OHB4KSBhbmQgKG1heC13aWR0aDo5OTFweCkgewoJCS5oaWRkZW4tc20gewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLXNtLAoJCXRkLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjk5MnB4KSBhbmQgKG1heC13aWR0aDoxMTk5cHgpIHsKCQkuaGlkZGVuLXNtLmhpZGRlbi1tZCB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdHIuaGlkZGVuLXNtLmhpZGRlbi1tZCB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLXNtLmhpZGRlbi1tZCwKCQl0ZC5oaWRkZW4tc20uaGlkZGVuLW1kIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6MTIwMHB4KSB7CgkJLmhpZGRlbi1zbS5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi1zbS5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1zbS5oaWRkZW4tbGcsCgkJdGQuaGlkZGVuLXNtLmhpZGRlbi1sZyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQkuaGlkZGVuLW1kIHsKCQlkaXNwbGF5OiBibG9jayFpbXBvcnRhbnQKCQl9CgoJCXRyLmhpZGRlbi1tZCB7CgkJZGlzcGxheTogdGFibGUtcm93IWltcG9ydGFudAoJCX0KCgkJdGguaGlkZGVuLW1kLAoJCXRkLmhpZGRlbi1tZCB7CgkJZGlzcGxheTogdGFibGUtY2VsbCFpbXBvcnRhbnQKCQl9CgoJCUBtZWRpYShtYXgtd2lkdGg6NzY3cHgpIHsKCQkuaGlkZGVuLW1kLmhpZGRlbi14cyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdHIuaGlkZGVuLW1kLmhpZGRlbi14cyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLW1kLmhpZGRlbi14cywKCQl0ZC5oaWRkZW4tbWQuaGlkZGVuLXhzIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6NzY4cHgpIGFuZCAobWF4LXdpZHRoOjk5MXB4KSB7CgkJLmhpZGRlbi1tZC5oaWRkZW4tc20gewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRyLmhpZGRlbi1tZC5oaWRkZW4tc20gewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1tZC5oaWRkZW4tc20sCgkJdGQuaGlkZGVuLW1kLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJfQoKCQlAbWVkaWEobWluLXdpZHRoOjk5MnB4KSBhbmQgKG1heC13aWR0aDoxMTk5cHgpIHsKCQkuaGlkZGVuLW1kIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4tbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1tZCwKCQl0ZC5oaWRkZW4tbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDoxMjAwcHgpIHsKCQkuaGlkZGVuLW1kLmhpZGRlbi1sZyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdHIuaGlkZGVuLW1kLmhpZGRlbi1sZyB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLW1kLmhpZGRlbi1sZywKCQl0ZC5oaWRkZW4tbWQuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl9CgoJCS5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCgkJdHIuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiB0YWJsZS1yb3chaW1wb3J0YW50CgkJfQoKCQl0aC5oaWRkZW4tbGcsCgkJdGQuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCgkJQG1lZGlhKG1heC13aWR0aDo3NjdweCkgewoJCS5oaWRkZW4tbGcuaGlkZGVuLXhzIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4tbGcuaGlkZGVuLXhzIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0aC5oaWRkZW4tbGcuaGlkZGVuLXhzLAoJCXRkLmhpZGRlbi1sZy5oaWRkZW4teHMgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDo3NjhweCkgYW5kIChtYXgtd2lkdGg6OTkxcHgpIHsKCQkuaGlkZGVuLWxnLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdHIuaGlkZGVuLWxnLmhpZGRlbi1zbSB7CgkJZGlzcGxheTogbm9uZSFpbXBvcnRhbnQKCQl9CgkJdGguaGlkZGVuLWxnLmhpZGRlbi1zbSwKCQl0ZC5oaWRkZW4tbGcuaGlkZGVuLXNtIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl9CgoJCUBtZWRpYShtaW4td2lkdGg6OTkycHgpIGFuZCAobWF4LXdpZHRoOjExOTlweCkgewoJCS5oaWRkZW4tbGcuaGlkZGVuLW1kIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4tbGcuaGlkZGVuLW1kIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0aC5oaWRkZW4tbGcuaGlkZGVuLW1kLAoJCXRkLmhpZGRlbi1sZy5oaWRkZW4tbWQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJQG1lZGlhKG1pbi13aWR0aDoxMjAwcHgpIHsKCQkuaGlkZGVuLWxnIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1sZywKCQl0ZC5oaWRkZW4tbGcgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJLnZpc2libGUtcHJpbnQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoKCQl0ci52aXNpYmxlLXByaW50IHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJdGgudmlzaWJsZS1wcmludCwKCQl0ZC52aXNpYmxlLXByaW50IHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJQG1lZGlhIHByaW50IHsKCQkudmlzaWJsZS1wcmludCB7CgkJZGlzcGxheTogYmxvY2shaW1wb3J0YW50CgkJfQoJCXRyLnZpc2libGUtcHJpbnQgewoJCWRpc3BsYXk6IHRhYmxlLXJvdyFpbXBvcnRhbnQKCQl9CgkJdGgudmlzaWJsZS1wcmludCwKCQl0ZC52aXNpYmxlLXByaW50IHsKCQlkaXNwbGF5OiB0YWJsZS1jZWxsIWltcG9ydGFudAoJCX0KCQkuaGlkZGVuLXByaW50IHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCQl0ci5oaWRkZW4tcHJpbnQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCXRoLmhpZGRlbi1wcmludCwKCQl0ZC5oaWRkZW4tcHJpbnQgewoJCWRpc3BsYXk6IG5vbmUhaW1wb3J0YW50CgkJfQoJCX0KCgkJLm5hdmJhciB7CgkJZm9udC1mYW1pbHk6ICJOZXdzIEN5Y2xlIiwgIkFyaWFsIE5hcnJvdyBCb2xkIiwgc2Fucy1zZXJpZjsKCQlmb250LXNpemU6IDE4cHg7CgkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJY29sb3I6ICMwMDA7CgkJYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNlZWUKCQl9CgoJCS5uYXZiYXItYnJhbmQgewoJCWZvbnQtc2l6ZTogMThweDsKCQlmb250LXdlaWdodDogYm9sZDsKCQl0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlCgkJfQoKCQloMSwKCQloMiwKCQloMywKCQloNCwKCQloNSwKCQloNiB7CgkJZm9udC1mYW1pbHk6ICJOZXdzIEN5Y2xlIiwgIkFyaWFsIE5hcnJvdyBCb2xkIiwgc2Fucy1zZXJpZjsKCQlmb250LXdlaWdodDogYm9sZDsKCQljb2xvcjogIzAwMAoJCX0KCgkJLmhhcy13YXJuaW5nIC5oZWxwLWJsb2NrLAoJCS5oYXMtd2FybmluZyAuY29udHJvbC1sYWJlbCB7CgkJY29sb3I6ICNmNTdhMDAKCQl9CgoJCS5oYXMtd2FybmluZyAuZm9ybS1jb250cm9sLAoJCS5oYXMtd2FybmluZyAuZm9ybS1jb250cm9sOmZvY3VzIHsKCQlib3JkZXItY29sb3I6ICNmNTdhMDAKCQl9CgoJCS5oYXMtZXJyb3IgLmhlbHAtYmxvY2ssCgkJLmhhcy1lcnJvciAuY29udHJvbC1sYWJlbCB7CgkJY29sb3I6ICNlYjY4NjQKCQl9CgoJCS5oYXMtZXJyb3IgLmZvcm0tY29udHJvbCwKCQkuaGFzLWVycm9yIC5mb3JtLWNvbnRyb2w6Zm9jdXMgewoJCWJvcmRlci1jb2xvcjogI2ViNjg2NAoJCX0KCgkJLmhhcy1zdWNjZXNzIC5oZWxwLWJsb2NrLAoJCS5oYXMtc3VjY2VzcyAuY29udHJvbC1sYWJlbCB7CgkJY29sb3I6ICMyMmIyNGMKCQl9CgoJCS5oYXMtc3VjY2VzcyAuZm9ybS1jb250cm9sLAoJCS5oYXMtc3VjY2VzcyAuZm9ybS1jb250cm9sOmZvY3VzIHsKCQlib3JkZXItY29sb3I6ICMyMmIyNGMKCQl9CgoJCS5wYWdpbmF0aW9uIC5hY3RpdmU+YSwKCQkucGFnaW5hdGlvbiAuYWN0aXZlPmE6aG92ZXIgewoJCWJvcmRlci1jb2xvcjogI2RkZAoJCX0KCgkJLmp1bWJvdHJvbiBoMSwKCQkuanVtYm90cm9uIGgyLAoJCS5qdW1ib3Ryb24gaDMsCgkJLmp1bWJvdHJvbiBoNCwKCQkuanVtYm90cm9uIGg1LAoJCS5qdW1ib3Ryb24gaDYgewoJCWZvbnQtZmFtaWx5OiAiTmV3cyBDeWNsZSIsICJBcmlhbCBOYXJyb3cgQm9sZCIsIHNhbnMtc2VyaWY7CgkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJY29sb3I6ICMwMDAKCQl9CgoJCS5jbGVhcmZpeDpiZWZvcmUsCgkJLmNsZWFyZml4OmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5jbGVhcmZpeDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5jbGVhcmZpeDpiZWZvcmUsCgkJLmNsZWFyZml4OmFmdGVyIHsKCQlkaXNwbGF5OiB0YWJsZTsKCQljb250ZW50OiAiICIKCQl9CgoJCS5jbGVhcmZpeDphZnRlciB7CgkJY2xlYXI6IGJvdGgKCQl9CgoJCS5wdWxsLXJpZ2h0IHsKCQlmbG9hdDogcmlnaHQhaW1wb3J0YW50CgkJfQoKCQkucHVsbC1sZWZ0IHsKCQlmbG9hdDogbGVmdCFpbXBvcnRhbnQKCQl9CgoJCS5oaWRlIHsKCQlkaXNwbGF5OiBub25lIWltcG9ydGFudAoJCX0KCgkJLnNob3cgewoJCWRpc3BsYXk6IGJsb2NrIWltcG9ydGFudAoJCX0KCgkJLmludmlzaWJsZSB7CgkJdmlzaWJpbGl0eTogaGlkZGVuCgkJfQoKCQkudGV4dC1oaWRlIHsKCQlmb250OiAwLzAgYTsKCQljb2xvcjogdHJhbnNwYXJlbnQ7CgkJdGV4dC1zaGFkb3c6IG5vbmU7CgkJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CgkJYm9yZGVyOiAwCgkJfQoKCQkuYWZmaXggewoJCXBvc2l0aW9uOiBmaXhlZAoJCX0KCTwvc3R5bGU+Cgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAgICAgZnVuY3Rpb24gVXBkYXRlVGFibGUoKSB7CiAgICAgICAgICAgICQoIiNqcUdyaWQiKQogICAgICAgICAgICAgICAgLmpxR3JpZCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyBsb2NhdGlvbi5ob3N0bmFtZSArICc6OTk4MS9wcm9ncmVzcy5qc29uJywKICAgICAgICAgICAgICAgICAgICBtdHlwZTogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgYWpheFN1YmdyaWRPcHRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3R5bGVVSTogJ0Jvb3RzdHJhcCcsCiAgICAgICAgICAgICAgICAgICAgZGF0YXR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICBjb2xNb2RlbDogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICcjJywKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0lkJywKICAgICAgICAgICAgICAgICAgICAgICAga2V5OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdGaWxlIE5hbWUnLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnRmlsZU5hbWUnLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTUKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnU2l6ZScsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTaXplJywKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IEZvcm1hdEJ5dGUKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnRG93bmxvYWRlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdEb3dubG9hZGVkJywKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IEZvcm1hdEJ5dGUKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnJScsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQcm9ncmVzcycsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA1CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1NwZWVkJywKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1NwZWVkJywKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDE1LAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IEZvcm1hdFNwZWVkQnl0ZQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdQcm9ncmVzcycsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQcm9ncmVzcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlcjogRm9ybWF0UHJvZ3Jlc3NCYXIKICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICB2aWV3cmVjb3JkczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICByb3dOdW06IDIwLAogICAgICAgICAgICAgICAgICAgIHBhZ2VyOiAiI2pxR3JpZFBhZ2VyIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBGaXhUYWJsZSgpIHsKICAgICAgICAgICAgJC5leHRlbmQoJC5qZ3JpZC5hamF4T3B0aW9ucywgewogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICQoIiNqcUdyaWQiKQogICAgICAgICAgICAgICAgLnNldEdyaWRXaWR0aCgkKHdpbmRvdykKICAgICAgICAgICAgICAgICAgICAud2lkdGgoKSAtIDUpCiAgICAgICAgICAgICQoIiNqcUdyaWQiKQogICAgICAgICAgICAgICAgLnNldEdyaWRIZWlnaHQoJCh3aW5kb3cpCiAgICAgICAgICAgICAgICAgICAgLmhlaWdodCgpKQogICAgICAgICAgICAkKHdpbmRvdykKICAgICAgICAgICAgICAgIC5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCIjanFHcmlkIikKICAgICAgICAgICAgICAgICAgICAgICAgLnNldEdyaWRXaWR0aCgkKHdpbmRvdykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aWR0aCgpIC0gNSk7CiAgICAgICAgICAgICAgICAgICAgJCgiI2pxR3JpZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRHcmlkSGVpZ2h0KCQod2luZG93KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmhlaWdodCgpKQogICAgICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFVwZGF0ZURhdGEoKSB7CiAgICAgICAgICAgIHZhciBncmlkID0gJCgiI2pxR3JpZCIpOwogICAgICAgICAgICB2YXIgcm93S2V5ID0gZ3JpZC5qcUdyaWQoJ2dldEdyaWRQYXJhbScsICJzZWxyb3ciKTsKICAgICAgICAgICAgJCgiI2pxR3JpZCIpLnRyaWdnZXIoInJlbG9hZEdyaWQiKTsKICAgICAgICAgICAgaWYgKHJvd0tleSkgewogICAgICAgICAgICAgICAgJCgnI2pxR3JpZCcpLmpxR3JpZCgicmVzZXRTZWxlY3Rpb24iKQogICAgICAgICAgICAgICAgJCgnI2pxR3JpZCcpLmpxR3JpZCgnc2V0U2VsZWN0aW9uJywgcm93S2V5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gRm9ybWF0UHJvZ3Jlc3NCYXIoY2VsbFZhbHVlLCBvcHRpb25zLCByb3dPYmplY3QpIHsKICAgICAgICAgICAgdmFyIGludFZhbCA9IHBhcnNlSW50KGNlbGxWYWx1ZSk7CgogICAgICAgICAgICB2YXIgY2VsbEh0bWwgPSAnPGRpdiBjbGFzcz0icHJvZ3Jlc3MiPjxkaXYgY2xhc3M9InByb2dyZXNzLWJhciIgc3R5bGU9IndpZHRoOiAnICsgaW50VmFsICsgJyU7Ij48L2Rpdj48L2Rpdj4nCgogICAgICAgICAgICByZXR1cm4gY2VsbEh0bWw7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBGb3JtYXRCeXRlKGNlbGxWYWx1ZSwgb3B0aW9ucywgcm93T2JqZWN0KSB7CiAgICAgICAgICAgIHZhciBpbnRWYWwgPSBwYXJzZUludChjZWxsVmFsdWUpOwogICAgICAgICAgICB2YXIgcmFzID0gIiBCLiIKICAgICAgICAgICAgaWYgKGludFZhbCA+IDEwMjQpIHsKICAgICAgICAgICAgICAgIGludFZhbCAvPSAxMDI0CiAgICAgICAgICAgICAgICByYXMgPSAiIEtCLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaW50VmFsID4gMTAyNCkgewogICAgICAgICAgICAgICAgaW50VmFsIC89IDEwMjQKICAgICAgICAgICAgICAgIHJhcyA9ICIgTUIuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBHQi4iCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBUQi4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNlbGxIdG1sID0gKGludFZhbCkudG9GaXhlZCgxKSArIHJhczsKICAgICAgICAgICAgcmV0dXJuIGNlbGxIdG1sOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gRm9ybWF0U3BlZWRCeXRlKGNlbGxWYWx1ZSwgb3B0aW9ucywgcm93T2JqZWN0KSB7CiAgICAgICAgICAgIHZhciBpbnRWYWwgPSBwYXJzZUludChjZWxsVmFsdWUpOwogICAgICAgICAgICB2YXIgcmFzID0gIiBCL3NlYy4iCiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBLQi9zZWMuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBNQi9zZWMuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBHQi9zZWMiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpbnRWYWwgPiAxMDI0KSB7CiAgICAgICAgICAgICAgICBpbnRWYWwgLz0gMTAyNAogICAgICAgICAgICAgICAgcmFzID0gIiBUQi4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNlbGxIdG1sID0gKGludFZhbCkudG9GaXhlZCgxKSArIHJhczsKICAgICAgICAgICAgcmV0dXJuIGNlbGxIdG1sOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gT25Mb2FkKCkgewoKICAgICAgICAgICAgVXBkYXRlVGFibGUoKQogICAgICAgICAgICBGaXhUYWJsZSgpCiAgICAgICAgICAgIHNldEludGVydmFsKFVwZGF0ZURhdGEsIDUwMCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBBZGREb3dubG9hZCgpIHsKICAgICAgICAgICAgdmFyIHJlcSA9IHsKICAgICAgICAgICAgICAgIFBhcnRDb3VudDogcGFyc2VJbnQoJCgiI3BhcnRfY291bnRfaWQiKS52YWwoKSksCiAgICAgICAgICAgICAgICBGaWxlUGF0aDogJCgiI3NhdmVfcGF0aF9pZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgVXJsOiAkKCIjdXJsX2lkIikudmFsKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6ICIvYWRkX3Rhc2siLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXEpLAogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oanNvbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqc29uRGF0YSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBSZW1vdmVEb3dubG9hZCgpIHsKICAgICAgICAgICAgdmFyIGdyaWQgPSAkKCIjanFHcmlkIik7CiAgICAgICAgICAgIHZhciByb3dLZXkgPSBwYXJzZUludChncmlkLmpxR3JpZCgnZ2V0R3JpZFBhcmFtJywgInNlbHJvdyIpKTsKICAgICAgICAgICAgdmFyIHJlcSA9IHJvd0tleTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6ICIvcmVtb3ZlX3Rhc2siLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXEpLAogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oanNvbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqc29uRGF0YSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTdGFydERvd25sb2FkKCkgewogICAgICAgICAgICB2YXIgZ3JpZCA9ICQoIiNqcUdyaWQiKTsKICAgICAgICAgICAgdmFyIHJvd0tleSA9IHBhcnNlSW50KGdyaWQuanFHcmlkKCdnZXRHcmlkUGFyYW0nLCAic2Vscm93IikpOwogICAgICAgICAgICB2YXIgcmVxID0gcm93S2V5OwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogIi9zdGFydF90YXNrIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkocmVxKSwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogInRleHQiCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGpzb25EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coanNvbkRhdGEpCiAgICAgICAgICAgICAgICB9KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gU3RvcERvd25sb2FkKCkgewogICAgICAgICAgICB2YXIgZ3JpZCA9ICQoIiNqcUdyaWQiKTsKICAgICAgICAgICAgdmFyIHJvd0tleSA9IHBhcnNlSW50KGdyaWQuanFHcmlkKCdnZXRHcmlkUGFyYW0nLCAic2Vscm93IikpOwogICAgICAgICAgICB2YXIgcmVxID0gcm93S2V5OwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogIi9zdG9wX3Rhc2siLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXEpLAogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oanNvbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqc29uRGF0YSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTdGFydEFsbERvd25sb2FkKCkgewogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogIi9zdGFydF9hbGxfdGFzayIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oanNvbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqc29uRGF0YSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTdG9wQWxsRG93bmxvYWQoKSB7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiAiL3N0b3BfYWxsX3Rhc2siLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogInRleHQiCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGpzb25EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coanNvbkRhdGEpCiAgICAgICAgICAgICAgICB9KQogICAgICAgIH0KCgogICAgICAgIGZ1bmN0aW9uIE9uQ2hhbmdlVXJsKCkgewogICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAkKCIjdXJsX2lkIikudmFsKCkuc3BsaXQoJy8nKS5wb3AoKQogICAgICAgICAgICAkKCIjc2F2ZV9wYXRoX2lkIikudmFsKGZpbGVuYW1lKQogICAgICAgIH0KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cgo8Ym9keSBvbmxvYWQ9Ik9uTG9hZCgpIj4KPGRpdiBjbGFzcz0ibmF2YmFyIG5hdmJhci1pbnZlcnNlIG5hdmJhci1maXhlZC10b3AiPgoJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQk8ZGl2IGNsYXNzPSJuYXZiYXItaGVhZGVyIj4KCQkJPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJuYXZiYXItdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iY29sbGFwc2UiIGRhdGEtdGFyZ2V0PSIubmF2YmFyLWNvbGxhcHNlIj4KCQkJCTxzcGFuIGNsYXNzPSJpY29uLWJhciI+PC9zcGFuPjxzcGFuIGNsYXNzPSJpY29uLWJhciI+PC9zcGFuPjxzcGFuIGNsYXNzPSJpY29uLWJhciI+PC9zcGFuPgoJCQk8L2J1dHRvbj4KCQkJPGEgY2xhc3M9Im5hdmJhci1icmFuZCIgaHJlZj0iIyI+R08gRG93bmxvYWRlcjwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJuYXZiYXItY29sbGFwc2UgY29sbGFwc2UiPgoJCQk8dWwgY2xhc3M9Im5hdiBuYXZiYXItbmF2Ij4KCQkJCTxsaSBjbGFzcz0iZHJvcGRvd24iPgoJCQkJCTxhIGhyZWY9IiMiIGNsYXNzPSJkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+RmlsZSA8YiBjbGFzcz0iY2FyZXQiPjwvYj48L2E+CgkJCQkJPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4KCQkJCQkJPGxpPgoJCQkJCQkJPGEgZGF0YS10b2dnbGU9Im1vZGFsIiBkYXRhLXRhcmdldD0iI215TW9kYWwiPkFkZCBkb3dubG9hZDwvYT4KCQkJCQkJPC9saT4KCQkJCQkJPGxpIG9uY2xpY2s9IlJlbW92ZURvd25sb2FkKCkiPgoJCQkJCQkJPGEgaHJlZj0iIyI+RGVsZXRlIGRvd25sb2FkPC9hPgoJCQkJCQk8L2xpPgoJCQkJCTwvdWw+CgkJCQk8L2xpPgoJCQkJPGxpIGNsYXNzPSJkcm9wZG93biI+CgkJCQkJPGEgaHJlZj0iIyIgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj5BY3Rpb24gPGIgY2xhc3M9ImNhcmV0Ij48L2I+PC9hPgoJCQkJCTx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+CgkJCQkJCTxsaSBvbmNsaWNrPSJTdGFydERvd25sb2FkKCkiPgoJCQkJCQkJPGEgaHJlZj0iIyI+U3RhcnQ8L2E+CgkJCQkJCTwvbGk+CgkJCQkJCTxsaSBvbmNsaWNrPSJTdG9wRG93bmxvYWQoKSI+CgkJCQkJCQk8YSBocmVmPSIjIj5TdG9wPC9hPgoJCQkJCQk8L2xpPgoJCQkJCQk8bGkgY2xhc3M9ImRpdmlkZXIiPjwvbGk+CgkJCQkJCTxsaSBvbmNsaWNrPSJTdGFydEFsbERvd25sb2FkKCkiPgoJCQkJCQkJPGEgaHJlZj0iIyI+U3RhcnQgYWxsPC9hPgoJCQkJCQk8L2xpPgoJCQkJCQk8bGkgb25jbGljaz0iU3RvcEFsbERvd25sb2FkKCkiPgoJCQkJCQkJPGEgaHJlZj0iIyI+U3RvcCBhbGw8L2E+CgkJCQkJCTwvbGk+CgkJCQkJPC91bD4KCQkJCTwvbGk+CgkJCQk8bGk+CgkJCQkJPGEgaHJlZj0iI2Fib3V0Ij5BYm91dDwvYT4KCQkJCTwvbGk+CgkJCTwvdWw+CgkJPC9kaXY+CgkJPCEtLS8ubmF2YmFyLWNvbGxhcHNlIC0tPgoJPC9kaXY+CjwvZGl2Pgo8L1A+Cjx0YWJsZSBpZD0ianFHcmlkIj48L3RhYmxlPgoKPCEtLSBNb2RhbCAtLT4KPGRpdiBjbGFzcz0ibW9kYWwgZmFkZSIgaWQ9Im15TW9kYWwiIHJvbGU9ImRpYWxvZyI+Cgk8ZGl2IGNsYXNzPSJtb2RhbC1kaWFsb2ciPgoKCQk8IS0tIE1vZGFsIGNvbnRlbnQtLT4KCQk8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KCQkJPGRpdiBjbGFzcz0ibW9kYWwtaGVhZGVyIj4KCQkJCTxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiPiZ0aW1lczs8L2J1dHRvbj4KCQkJCTxoNCBjbGFzcz0ibW9kYWwtdGl0bGUiPkVudGVyIFVybDwvaDQ+CgkJCTwvZGl2PgoJCQk8ZGl2IGNsYXNzPSJtb2RhbC1ib2R5Ij4KCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgoJCQkJCTxsYWJlbCBjbGFzcz0iY29udHJvbC1sYWJlbCI+VXJsPC9sYWJlbD4KCgkJCQkJPGRpdiBjbGFzcz0iY29udHJvbHMiPgoJCQkJCQk8aW5wdXQgdHlwZT0idGV4dCIgb25jaGFuZ2U9Ik9uQ2hhbmdlVXJsKCkiIGlkPSJ1cmxfaWQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHZhbHVlPSJodHRwOi8vbWlycm9yLnlhbmRleC5ydS91YnVudHUtY2RpbWFnZS9yZWxlYXNlcy8xNS4xMC9hbHBoYS0yL3NvdXJjZS93aWx5LXNyYy0xLmlzbyI+CgkJCQkJPC9kaXY+CgkJCQkJPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5TYXZlIHBhdGg8L2xhYmVsPgoKCQkJCQk8ZGl2IGNsYXNzPSJjb250cm9scyI+CgkJCQkJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic2F2ZV9wYXRoX2lkIiBjbGFzcz0iZm9ybS1jb250cm9sIiB2YWx1ZT0id2lseS1zcmMtMS5pc28iPgoJCQkJCTwvZGl2PgoJCQkJCTxsYWJlbCBjbGFzcz0iY29udHJvbC1sYWJlbCI+UGFydHMgY291bnQ8L2xhYmVsPgoJCQkJCTxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCIgaWQ9InBhcnRfY291bnRfaWQiPgoJCQkJCQk8b3B0aW9uPjE8L29wdGlvbj4KCQkJCQkJPG9wdGlvbj4yPC9vcHRpb24+CgkJCQkJCTxvcHRpb24+NDwvb3B0aW9uPgoJCQkJCQk8b3B0aW9uPjg8L29wdGlvbj4KCQkJCQkJPG9wdGlvbj4xNjwvb3B0aW9uPgoJCQkJCTwvc2VsZWN0PgoKCQkJCQk8ZGl2IGNsYXNzPSJtb2RhbC1mb290ZXIiPgoJCQkJCQk8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJBZGREb3dubG9hZCgpIiBkYXRhLWRpc21pc3M9Im1vZGFsIj5TdGFydCBkb3dubG9hZDwvYT4KCQkJCQk8L2Rpdj4KCQkJCTwvZGl2PgoJCQk8L2Rpdj4KCQk8L2Rpdj4KCgk8L2Rpdj4KPC9kaXY+CjwvYm9keT4KCjwvaHRtbD5z"

func (srv *DServ) index(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	rwr.Header().Set("Content-Type: text/html", "*")
	content, err := ioutil.ReadFile("index.html")
	if err != nil {
		log.Println("warning: start page not found, return included page")
		val, _ := base64.StdEncoding.DecodeString(htmlData)
		rwr.Write(val)
		return
	}
	rwr.Write(content)
}

func (srv *DServ) addTask(rwr http.ResponseWriter, req *http.Request) {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
		req.Body.Close()
	}()
	bodyData, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	var nj NewJob
	if err := json.Unmarshal(bodyData, &nj); err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	dl, err := httpclient.CreateDownloader(nj.Url, nj.FilePath, nj.PartCount)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	srv.dls = append(srv.dls, dl)
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) startTask(rwr http.ResponseWriter, req *http.Request) {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
		req.Body.Close()
	}()
	bodyData, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	var ind int
	if err := json.Unmarshal(bodyData, &ind); err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	if !(len(srv.dls) > ind) {
		http.Error(rwr, "error: id is out of jobs list", http.StatusInternalServerError)
		return
	}

	if errs := srv.dls[ind].StartAll(); len(errs) > 0 {
		http.Error(rwr, "error: can't start all part", http.StatusInternalServerError)
		return
	}
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) stopTask(rwr http.ResponseWriter, req *http.Request) {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
		req.Body.Close()
	}()
	bodyData, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	var ind int
	if err := json.Unmarshal(bodyData, &ind); err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	if !(len(srv.dls) > ind) {
		http.Error(rwr, "error: id is out of jobs list", http.StatusInternalServerError)
		return
	}

	srv.dls[ind].StopAll()
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) startAllTask(rwr http.ResponseWriter, req *http.Request) {
	defer func() {
		req.Body.Close()
	}()
	_, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	srv.StartAllTask()
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) StopAllTask() {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
	}()
	for _, e := range srv.dls {
		log.Println("info stopall result:", e.StopAll())
	}
}

func (srv *DServ) StartAllTask() {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
	}()
	for _, e := range srv.dls {
		log.Println("info start all result:", e.StartAll())
	}
}
func (srv *DServ) stopAllTask(rwr http.ResponseWriter, req *http.Request) {
	defer func() {
		req.Body.Close()
	}()
	_, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	srv.StopAllTask()
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) removeTask(rwr http.ResponseWriter, req *http.Request) {
	srv.oplock.Lock()
	defer func() {
		srv.oplock.Unlock()
		req.Body.Close()
	}()
	bodyData, err := ioutil.ReadAll(req.Body)
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	var ind int
	if err := json.Unmarshal(bodyData, &ind); err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	if !(len(srv.dls) > ind) {
		http.Error(rwr, "error: id is out of jobs list", http.StatusInternalServerError)
		return
	}

	log.Printf("try stop segment download %v", srv.dls[ind].StopAll())
	srv.dls = append(srv.dls[:ind], srv.dls[ind+1:]...)
	js, _ := json.Marshal("ok")
	rwr.Write(js)
}

func (srv *DServ) progressJson(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	jbs := make([]DJob, 0, len(srv.dls))
	for ind, i := range srv.dls {
		prs := i.GetProgress()
		var d int64
		var s int64
		for _, p := range prs {
			d = d + (p.Pos - p.From)
			s += p.Speed
		}
		j := DJob{
			Id:         ind,
			FileName:   i.Fi.FileName,
			Size:       i.Fi.Size,
			Progress:   (d * 100 / i.Fi.Size),
			Downloaded: d,
			Speed:      s,
		}
		jbs = append(jbs, j)
	}
	js, err := json.Marshal(jbs)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return
	}
	rwr.Write(js)

}
func (service *DServ) Redirect(responseWriter http.ResponseWriter, request *http.Request) {
	defer request.Body.Close()
	http.Redirect(responseWriter, request, "/index.html", 301)
}
